{"ast":null,"code":"/**\n * Copyright (c) Tiny Technologies, Inc. All rights reserved.\n * Licensed under the LGPL or a commercial license.\n * For LGPL see License.txt in the project root for license information.\n * For commercial licenses see https://www.tiny.cloud/\n *\n * Version: 5.5.1 (2020-10-01)\n */\n(function () {\n  'use strict';\n\n  var typeOf = function (x) {\n    if (x === null) {\n      return 'null';\n    }\n\n    if (x === undefined) {\n      return 'undefined';\n    }\n\n    var t = typeof x;\n\n    if (t === 'object' && (Array.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'Array')) {\n      return 'array';\n    }\n\n    if (t === 'object' && (String.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'String')) {\n      return 'string';\n    }\n\n    return t;\n  };\n\n  var isEquatableType = function (x) {\n    return ['undefined', 'boolean', 'number', 'string', 'function', 'xml', 'null'].indexOf(x) !== -1;\n  };\n\n  var sort = function (xs, compareFn) {\n    var clone = Array.prototype.slice.call(xs);\n    return clone.sort(compareFn);\n  };\n\n  var contramap = function (eqa, f) {\n    return eq(function (x, y) {\n      return eqa.eq(f(x), f(y));\n    });\n  };\n\n  var eq = function (f) {\n    return {\n      eq: f\n    };\n  };\n\n  var tripleEq = eq(function (x, y) {\n    return x === y;\n  });\n  var eqString = tripleEq;\n\n  var eqArray = function (eqa) {\n    return eq(function (x, y) {\n      if (x.length !== y.length) {\n        return false;\n      }\n\n      var len = x.length;\n\n      for (var i = 0; i < len; i++) {\n        if (!eqa.eq(x[i], y[i])) {\n          return false;\n        }\n      }\n\n      return true;\n    });\n  };\n\n  var eqSortedArray = function (eqa, compareFn) {\n    return contramap(eqArray(eqa), function (xs) {\n      return sort(xs, compareFn);\n    });\n  };\n\n  var eqRecord = function (eqa) {\n    return eq(function (x, y) {\n      var kx = Object.keys(x);\n      var ky = Object.keys(y);\n\n      if (!eqSortedArray(eqString).eq(kx, ky)) {\n        return false;\n      }\n\n      var len = kx.length;\n\n      for (var i = 0; i < len; i++) {\n        var q = kx[i];\n\n        if (!eqa.eq(x[q], y[q])) {\n          return false;\n        }\n      }\n\n      return true;\n    });\n  };\n\n  var eqAny = eq(function (x, y) {\n    if (x === y) {\n      return true;\n    }\n\n    var tx = typeOf(x);\n    var ty = typeOf(y);\n\n    if (tx !== ty) {\n      return false;\n    }\n\n    if (isEquatableType(tx)) {\n      return x === y;\n    } else if (tx === 'array') {\n      return eqArray(eqAny).eq(x, y);\n    } else if (tx === 'object') {\n      return eqRecord(eqAny).eq(x, y);\n    }\n\n    return false;\n  });\n\n  var noop = function () {};\n\n  var compose = function (fa, fb) {\n    return function () {\n      var args = [];\n\n      for (var _i = 0; _i < arguments.length; _i++) {\n        args[_i] = arguments[_i];\n      }\n\n      return fa(fb.apply(null, args));\n    };\n  };\n\n  var compose1 = function (fbc, fab) {\n    return function (a) {\n      return fbc(fab(a));\n    };\n  };\n\n  var constant = function (value) {\n    return function () {\n      return value;\n    };\n  };\n\n  var identity = function (x) {\n    return x;\n  };\n\n  function curry(fn) {\n    var initialArgs = [];\n\n    for (var _i = 1; _i < arguments.length; _i++) {\n      initialArgs[_i - 1] = arguments[_i];\n    }\n\n    return function () {\n      var restArgs = [];\n\n      for (var _i = 0; _i < arguments.length; _i++) {\n        restArgs[_i] = arguments[_i];\n      }\n\n      var all = initialArgs.concat(restArgs);\n      return fn.apply(null, all);\n    };\n  }\n\n  var not = function (f) {\n    return function (t) {\n      return !f(t);\n    };\n  };\n\n  var die = function (msg) {\n    return function () {\n      throw new Error(msg);\n    };\n  };\n\n  var never = constant(false);\n  var always = constant(true);\n\n  var none = function () {\n    return NONE;\n  };\n\n  var NONE = function () {\n    var eq = function (o) {\n      return o.isNone();\n    };\n\n    var call = function (thunk) {\n      return thunk();\n    };\n\n    var id = function (n) {\n      return n;\n    };\n\n    var me = {\n      fold: function (n, _s) {\n        return n();\n      },\n      is: never,\n      isSome: never,\n      isNone: always,\n      getOr: id,\n      getOrThunk: call,\n      getOrDie: function (msg) {\n        throw new Error(msg || 'error: getOrDie called on none.');\n      },\n      getOrNull: constant(null),\n      getOrUndefined: constant(undefined),\n      or: id,\n      orThunk: call,\n      map: none,\n      each: noop,\n      bind: none,\n      exists: never,\n      forall: always,\n      filter: none,\n      equals: eq,\n      equals_: eq,\n      toArray: function () {\n        return [];\n      },\n      toString: constant('none()')\n    };\n    return me;\n  }();\n\n  var some = function (a) {\n    var constant_a = constant(a);\n\n    var self = function () {\n      return me;\n    };\n\n    var bind = function (f) {\n      return f(a);\n    };\n\n    var me = {\n      fold: function (n, s) {\n        return s(a);\n      },\n      is: function (v) {\n        return a === v;\n      },\n      isSome: always,\n      isNone: never,\n      getOr: constant_a,\n      getOrThunk: constant_a,\n      getOrDie: constant_a,\n      getOrNull: constant_a,\n      getOrUndefined: constant_a,\n      or: self,\n      orThunk: self,\n      map: function (f) {\n        return some(f(a));\n      },\n      each: function (f) {\n        f(a);\n      },\n      bind: bind,\n      exists: bind,\n      forall: bind,\n      filter: function (f) {\n        return f(a) ? me : NONE;\n      },\n      toArray: function () {\n        return [a];\n      },\n      toString: function () {\n        return 'some(' + a + ')';\n      },\n      equals: function (o) {\n        return o.is(a);\n      },\n      equals_: function (o, elementEq) {\n        return o.fold(never, function (b) {\n          return elementEq(a, b);\n        });\n      }\n    };\n    return me;\n  };\n\n  var from = function (value) {\n    return value === null || value === undefined ? NONE : some(value);\n  };\n\n  var Optional = {\n    some: some,\n    none: none,\n    from: from\n  };\n\n  var typeOf$1 = function (x) {\n    var t = typeof x;\n\n    if (x === null) {\n      return 'null';\n    } else if (t === 'object' && (Array.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'Array')) {\n      return 'array';\n    } else if (t === 'object' && (String.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'String')) {\n      return 'string';\n    } else {\n      return t;\n    }\n  };\n\n  var isType = function (type) {\n    return function (value) {\n      return typeOf$1(value) === type;\n    };\n  };\n\n  var isSimpleType = function (type) {\n    return function (value) {\n      return typeof value === type;\n    };\n  };\n\n  var eq$1 = function (t) {\n    return function (a) {\n      return t === a;\n    };\n  };\n\n  var isString = isType('string');\n  var isObject = isType('object');\n  var isArray = isType('array');\n  var isNull = eq$1(null);\n  var isBoolean = isSimpleType('boolean');\n  var isUndefined = eq$1(undefined);\n\n  var isNullable = function (a) {\n    return a === null || a === undefined;\n  };\n\n  var isNonNullable = function (a) {\n    return !isNullable(a);\n  };\n\n  var isFunction = isSimpleType('function');\n  var isNumber = isSimpleType('number');\n  var nativeSlice = Array.prototype.slice;\n  var nativeIndexOf = Array.prototype.indexOf;\n  var nativePush = Array.prototype.push;\n\n  var rawIndexOf = function (ts, t) {\n    return nativeIndexOf.call(ts, t);\n  };\n\n  var indexOf = function (xs, x) {\n    var r = rawIndexOf(xs, x);\n    return r === -1 ? Optional.none() : Optional.some(r);\n  };\n\n  var contains = function (xs, x) {\n    return rawIndexOf(xs, x) > -1;\n  };\n\n  var exists = function (xs, pred) {\n    for (var i = 0, len = xs.length; i < len; i++) {\n      var x = xs[i];\n\n      if (pred(x, i)) {\n        return true;\n      }\n    }\n\n    return false;\n  };\n\n  var map = function (xs, f) {\n    var len = xs.length;\n    var r = new Array(len);\n\n    for (var i = 0; i < len; i++) {\n      var x = xs[i];\n      r[i] = f(x, i);\n    }\n\n    return r;\n  };\n\n  var each = function (xs, f) {\n    for (var i = 0, len = xs.length; i < len; i++) {\n      var x = xs[i];\n      f(x, i);\n    }\n  };\n\n  var eachr = function (xs, f) {\n    for (var i = xs.length - 1; i >= 0; i--) {\n      var x = xs[i];\n      f(x, i);\n    }\n  };\n\n  var partition = function (xs, pred) {\n    var pass = [];\n    var fail = [];\n\n    for (var i = 0, len = xs.length; i < len; i++) {\n      var x = xs[i];\n      var arr = pred(x, i) ? pass : fail;\n      arr.push(x);\n    }\n\n    return {\n      pass: pass,\n      fail: fail\n    };\n  };\n\n  var filter = function (xs, pred) {\n    var r = [];\n\n    for (var i = 0, len = xs.length; i < len; i++) {\n      var x = xs[i];\n\n      if (pred(x, i)) {\n        r.push(x);\n      }\n    }\n\n    return r;\n  };\n\n  var foldr = function (xs, f, acc) {\n    eachr(xs, function (x) {\n      acc = f(acc, x);\n    });\n    return acc;\n  };\n\n  var foldl = function (xs, f, acc) {\n    each(xs, function (x) {\n      acc = f(acc, x);\n    });\n    return acc;\n  };\n\n  var findUntil = function (xs, pred, until) {\n    for (var i = 0, len = xs.length; i < len; i++) {\n      var x = xs[i];\n\n      if (pred(x, i)) {\n        return Optional.some(x);\n      } else if (until(x, i)) {\n        break;\n      }\n    }\n\n    return Optional.none();\n  };\n\n  var find = function (xs, pred) {\n    return findUntil(xs, pred, never);\n  };\n\n  var findIndex = function (xs, pred) {\n    for (var i = 0, len = xs.length; i < len; i++) {\n      var x = xs[i];\n\n      if (pred(x, i)) {\n        return Optional.some(i);\n      }\n    }\n\n    return Optional.none();\n  };\n\n  var flatten = function (xs) {\n    var r = [];\n\n    for (var i = 0, len = xs.length; i < len; ++i) {\n      if (!isArray(xs[i])) {\n        throw new Error('Arr.flatten item ' + i + ' was not an array, input: ' + xs);\n      }\n\n      nativePush.apply(r, xs[i]);\n    }\n\n    return r;\n  };\n\n  var bind = function (xs, f) {\n    return flatten(map(xs, f));\n  };\n\n  var forall = function (xs, pred) {\n    for (var i = 0, len = xs.length; i < len; ++i) {\n      var x = xs[i];\n\n      if (pred(x, i) !== true) {\n        return false;\n      }\n    }\n\n    return true;\n  };\n\n  var reverse = function (xs) {\n    var r = nativeSlice.call(xs, 0);\n    r.reverse();\n    return r;\n  };\n\n  var difference = function (a1, a2) {\n    return filter(a1, function (x) {\n      return !contains(a2, x);\n    });\n  };\n\n  var mapToObject = function (xs, f) {\n    var r = {};\n\n    for (var i = 0, len = xs.length; i < len; i++) {\n      var x = xs[i];\n      r[String(x)] = f(x, i);\n    }\n\n    return r;\n  };\n\n  var sort$1 = function (xs, comparator) {\n    var copy = nativeSlice.call(xs, 0);\n    copy.sort(comparator);\n    return copy;\n  };\n\n  var head = function (xs) {\n    return xs.length === 0 ? Optional.none() : Optional.some(xs[0]);\n  };\n\n  var last = function (xs) {\n    return xs.length === 0 ? Optional.none() : Optional.some(xs[xs.length - 1]);\n  };\n\n  var from$1 = isFunction(Array.from) ? Array.from : function (x) {\n    return nativeSlice.call(x);\n  };\n  var keys = Object.keys;\n  var hasOwnProperty = Object.hasOwnProperty;\n\n  var each$1 = function (obj, f) {\n    var props = keys(obj);\n\n    for (var k = 0, len = props.length; k < len; k++) {\n      var i = props[k];\n      var x = obj[i];\n      f(x, i);\n    }\n  };\n\n  var map$1 = function (obj, f) {\n    return tupleMap(obj, function (x, i) {\n      return {\n        k: i,\n        v: f(x, i)\n      };\n    });\n  };\n\n  var tupleMap = function (obj, f) {\n    var r = {};\n    each$1(obj, function (x, i) {\n      var tuple = f(x, i);\n      r[tuple.k] = tuple.v;\n    });\n    return r;\n  };\n\n  var objAcc = function (r) {\n    return function (x, i) {\n      r[i] = x;\n    };\n  };\n\n  var internalFilter = function (obj, pred, onTrue, onFalse) {\n    var r = {};\n    each$1(obj, function (x, i) {\n      (pred(x, i) ? onTrue : onFalse)(x, i);\n    });\n    return r;\n  };\n\n  var bifilter = function (obj, pred) {\n    var t = {};\n    var f = {};\n    internalFilter(obj, pred, objAcc(t), objAcc(f));\n    return {\n      t: t,\n      f: f\n    };\n  };\n\n  var filter$1 = function (obj, pred) {\n    var t = {};\n    internalFilter(obj, pred, objAcc(t), noop);\n    return t;\n  };\n\n  var mapToArray = function (obj, f) {\n    var r = [];\n    each$1(obj, function (value, name) {\n      r.push(f(value, name));\n    });\n    return r;\n  };\n\n  var values = function (obj) {\n    return mapToArray(obj, function (v) {\n      return v;\n    });\n  };\n\n  var get = function (obj, key) {\n    return has(obj, key) ? Optional.from(obj[key]) : Optional.none();\n  };\n\n  var has = function (obj, key) {\n    return hasOwnProperty.call(obj, key);\n  };\n\n  var equal = function (a1, a2, eq) {\n    if (eq === void 0) {\n      eq = eqAny;\n    }\n\n    return eqRecord(eq).eq(a1, a2);\n  };\n\n  var isArray$1 = Array.isArray;\n\n  var toArray = function (obj) {\n    if (!isArray$1(obj)) {\n      var array = [];\n\n      for (var i = 0, l = obj.length; i < l; i++) {\n        array[i] = obj[i];\n      }\n\n      return array;\n    } else {\n      return obj;\n    }\n  };\n\n  var each$2 = function (o, cb, s) {\n    var n, l;\n\n    if (!o) {\n      return false;\n    }\n\n    s = s || o;\n\n    if (o.length !== undefined) {\n      for (n = 0, l = o.length; n < l; n++) {\n        if (cb.call(s, o[n], n, o) === false) {\n          return false;\n        }\n      }\n    } else {\n      for (n in o) {\n        if (o.hasOwnProperty(n)) {\n          if (cb.call(s, o[n], n, o) === false) {\n            return false;\n          }\n        }\n      }\n    }\n\n    return true;\n  };\n\n  var map$2 = function (array, callback) {\n    var out = [];\n    each$2(array, function (item, index) {\n      out.push(callback(item, index, array));\n    });\n    return out;\n  };\n\n  var filter$2 = function (a, f) {\n    var o = [];\n    each$2(a, function (v, index) {\n      if (!f || f(v, index, a)) {\n        o.push(v);\n      }\n    });\n    return o;\n  };\n\n  var indexOf$1 = function (a, v) {\n    if (a) {\n      for (var i = 0, l = a.length; i < l; i++) {\n        if (a[i] === v) {\n          return i;\n        }\n      }\n    }\n\n    return -1;\n  };\n\n  var reduce = function (collection, iteratee, accumulator, thisArg) {\n    var acc = isUndefined(accumulator) ? collection[0] : accumulator;\n\n    for (var i = 0; i < collection.length; i++) {\n      acc = iteratee.call(thisArg, acc, collection[i], i);\n    }\n\n    return acc;\n  };\n\n  var findIndex$1 = function (array, predicate, thisArg) {\n    var i, l;\n\n    for (i = 0, l = array.length; i < l; i++) {\n      if (predicate.call(thisArg, array[i], i, array)) {\n        return i;\n      }\n    }\n\n    return -1;\n  };\n\n  var last$1 = function (collection) {\n    return collection[collection.length - 1];\n  };\n\n  var __assign = function () {\n    __assign = Object.assign || function __assign(t) {\n      for (var s, i = 1, n = arguments.length; i < n; i++) {\n        s = arguments[i];\n\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n\n      return t;\n    };\n\n    return __assign.apply(this, arguments);\n  };\n\n  function __rest(s, e) {\n    var t = {};\n\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n\n    if (s != null && typeof Object.getOwnPropertySymbols === 'function') for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n      if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n    }\n    return t;\n  }\n\n  function __spreadArrays() {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n\n    for (var r = Array(s), k = 0, i = 0; i < il; i++) for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++) r[k] = a[j];\n\n    return r;\n  }\n\n  var cached = function (f) {\n    var called = false;\n    var r;\n    return function () {\n      var args = [];\n\n      for (var _i = 0; _i < arguments.length; _i++) {\n        args[_i] = arguments[_i];\n      }\n\n      if (!called) {\n        called = true;\n        r = f.apply(null, args);\n      }\n\n      return r;\n    };\n  };\n\n  var DeviceType = function (os, browser, userAgent, mediaMatch) {\n    var isiPad = os.isiOS() && /ipad/i.test(userAgent) === true;\n    var isiPhone = os.isiOS() && !isiPad;\n    var isMobile = os.isiOS() || os.isAndroid();\n    var isTouch = isMobile || mediaMatch('(pointer:coarse)');\n    var isTablet = isiPad || !isiPhone && isMobile && mediaMatch('(min-device-width:768px)');\n    var isPhone = isiPhone || isMobile && !isTablet;\n    var iOSwebview = browser.isSafari() && os.isiOS() && /safari/i.test(userAgent) === false;\n    var isDesktop = !isPhone && !isTablet && !iOSwebview;\n    return {\n      isiPad: constant(isiPad),\n      isiPhone: constant(isiPhone),\n      isTablet: constant(isTablet),\n      isPhone: constant(isPhone),\n      isTouch: constant(isTouch),\n      isAndroid: os.isAndroid,\n      isiOS: os.isiOS,\n      isWebView: constant(iOSwebview),\n      isDesktop: constant(isDesktop)\n    };\n  };\n\n  var firstMatch = function (regexes, s) {\n    for (var i = 0; i < regexes.length; i++) {\n      var x = regexes[i];\n\n      if (x.test(s)) {\n        return x;\n      }\n    }\n\n    return undefined;\n  };\n\n  var find$1 = function (regexes, agent) {\n    var r = firstMatch(regexes, agent);\n\n    if (!r) {\n      return {\n        major: 0,\n        minor: 0\n      };\n    }\n\n    var group = function (i) {\n      return Number(agent.replace(r, '$' + i));\n    };\n\n    return nu(group(1), group(2));\n  };\n\n  var detect = function (versionRegexes, agent) {\n    var cleanedAgent = String(agent).toLowerCase();\n\n    if (versionRegexes.length === 0) {\n      return unknown();\n    }\n\n    return find$1(versionRegexes, cleanedAgent);\n  };\n\n  var unknown = function () {\n    return nu(0, 0);\n  };\n\n  var nu = function (major, minor) {\n    return {\n      major: major,\n      minor: minor\n    };\n  };\n\n  var Version = {\n    nu: nu,\n    detect: detect,\n    unknown: unknown\n  };\n\n  var detect$1 = function (candidates, userAgent) {\n    var agent = String(userAgent).toLowerCase();\n    return find(candidates, function (candidate) {\n      return candidate.search(agent);\n    });\n  };\n\n  var detectBrowser = function (browsers, userAgent) {\n    return detect$1(browsers, userAgent).map(function (browser) {\n      var version = Version.detect(browser.versionRegexes, userAgent);\n      return {\n        current: browser.name,\n        version: version\n      };\n    });\n  };\n\n  var detectOs = function (oses, userAgent) {\n    return detect$1(oses, userAgent).map(function (os) {\n      var version = Version.detect(os.versionRegexes, userAgent);\n      return {\n        current: os.name,\n        version: version\n      };\n    });\n  };\n\n  var UaString = {\n    detectBrowser: detectBrowser,\n    detectOs: detectOs\n  };\n\n  var checkRange = function (str, substr, start) {\n    return substr === '' || str.length >= substr.length && str.substr(start, start + substr.length) === substr;\n  };\n\n  var contains$1 = function (str, substr) {\n    return str.indexOf(substr) !== -1;\n  };\n\n  var startsWith = function (str, prefix) {\n    return checkRange(str, prefix, 0);\n  };\n\n  var blank = function (r) {\n    return function (s) {\n      return s.replace(r, '');\n    };\n  };\n\n  var trim = blank(/^\\s+|\\s+$/g);\n  var lTrim = blank(/^\\s+/g);\n  var rTrim = blank(/\\s+$/g);\n  var normalVersionRegex = /.*?version\\/\\ ?([0-9]+)\\.([0-9]+).*/;\n\n  var checkContains = function (target) {\n    return function (uastring) {\n      return contains$1(uastring, target);\n    };\n  };\n\n  var browsers = [{\n    name: 'Edge',\n    versionRegexes: [/.*?edge\\/ ?([0-9]+)\\.([0-9]+)$/],\n    search: function (uastring) {\n      return contains$1(uastring, 'edge/') && contains$1(uastring, 'chrome') && contains$1(uastring, 'safari') && contains$1(uastring, 'applewebkit');\n    }\n  }, {\n    name: 'Chrome',\n    versionRegexes: [/.*?chrome\\/([0-9]+)\\.([0-9]+).*/, normalVersionRegex],\n    search: function (uastring) {\n      return contains$1(uastring, 'chrome') && !contains$1(uastring, 'chromeframe');\n    }\n  }, {\n    name: 'IE',\n    versionRegexes: [/.*?msie\\ ?([0-9]+)\\.([0-9]+).*/, /.*?rv:([0-9]+)\\.([0-9]+).*/],\n    search: function (uastring) {\n      return contains$1(uastring, 'msie') || contains$1(uastring, 'trident');\n    }\n  }, {\n    name: 'Opera',\n    versionRegexes: [normalVersionRegex, /.*?opera\\/([0-9]+)\\.([0-9]+).*/],\n    search: checkContains('opera')\n  }, {\n    name: 'Firefox',\n    versionRegexes: [/.*?firefox\\/\\ ?([0-9]+)\\.([0-9]+).*/],\n    search: checkContains('firefox')\n  }, {\n    name: 'Safari',\n    versionRegexes: [normalVersionRegex, /.*?cpu os ([0-9]+)_([0-9]+).*/],\n    search: function (uastring) {\n      return (contains$1(uastring, 'safari') || contains$1(uastring, 'mobile/')) && contains$1(uastring, 'applewebkit');\n    }\n  }];\n  var oses = [{\n    name: 'Windows',\n    search: checkContains('win'),\n    versionRegexes: [/.*?windows\\ nt\\ ?([0-9]+)\\.([0-9]+).*/]\n  }, {\n    name: 'iOS',\n    search: function (uastring) {\n      return contains$1(uastring, 'iphone') || contains$1(uastring, 'ipad');\n    },\n    versionRegexes: [/.*?version\\/\\ ?([0-9]+)\\.([0-9]+).*/, /.*cpu os ([0-9]+)_([0-9]+).*/, /.*cpu iphone os ([0-9]+)_([0-9]+).*/]\n  }, {\n    name: 'Android',\n    search: checkContains('android'),\n    versionRegexes: [/.*?android\\ ?([0-9]+)\\.([0-9]+).*/]\n  }, {\n    name: 'OSX',\n    search: checkContains('mac os x'),\n    versionRegexes: [/.*?mac\\ os\\ x\\ ?([0-9]+)_([0-9]+).*/]\n  }, {\n    name: 'Linux',\n    search: checkContains('linux'),\n    versionRegexes: []\n  }, {\n    name: 'Solaris',\n    search: checkContains('sunos'),\n    versionRegexes: []\n  }, {\n    name: 'FreeBSD',\n    search: checkContains('freebsd'),\n    versionRegexes: []\n  }, {\n    name: 'ChromeOS',\n    search: checkContains('cros'),\n    versionRegexes: [/.*?chrome\\/([0-9]+)\\.([0-9]+).*/]\n  }];\n  var PlatformInfo = {\n    browsers: constant(browsers),\n    oses: constant(oses)\n  };\n  var edge = 'Edge';\n  var chrome = 'Chrome';\n  var ie = 'IE';\n  var opera = 'Opera';\n  var firefox = 'Firefox';\n  var safari = 'Safari';\n\n  var unknown$1 = function () {\n    return nu$1({\n      current: undefined,\n      version: Version.unknown()\n    });\n  };\n\n  var nu$1 = function (info) {\n    var current = info.current;\n    var version = info.version;\n\n    var isBrowser = function (name) {\n      return function () {\n        return current === name;\n      };\n    };\n\n    return {\n      current: current,\n      version: version,\n      isEdge: isBrowser(edge),\n      isChrome: isBrowser(chrome),\n      isIE: isBrowser(ie),\n      isOpera: isBrowser(opera),\n      isFirefox: isBrowser(firefox),\n      isSafari: isBrowser(safari)\n    };\n  };\n\n  var Browser = {\n    unknown: unknown$1,\n    nu: nu$1,\n    edge: constant(edge),\n    chrome: constant(chrome),\n    ie: constant(ie),\n    opera: constant(opera),\n    firefox: constant(firefox),\n    safari: constant(safari)\n  };\n  var windows = 'Windows';\n  var ios = 'iOS';\n  var android = 'Android';\n  var linux = 'Linux';\n  var osx = 'OSX';\n  var solaris = 'Solaris';\n  var freebsd = 'FreeBSD';\n  var chromeos = 'ChromeOS';\n\n  var unknown$2 = function () {\n    return nu$2({\n      current: undefined,\n      version: Version.unknown()\n    });\n  };\n\n  var nu$2 = function (info) {\n    var current = info.current;\n    var version = info.version;\n\n    var isOS = function (name) {\n      return function () {\n        return current === name;\n      };\n    };\n\n    return {\n      current: current,\n      version: version,\n      isWindows: isOS(windows),\n      isiOS: isOS(ios),\n      isAndroid: isOS(android),\n      isOSX: isOS(osx),\n      isLinux: isOS(linux),\n      isSolaris: isOS(solaris),\n      isFreeBSD: isOS(freebsd),\n      isChromeOS: isOS(chromeos)\n    };\n  };\n\n  var OperatingSystem = {\n    unknown: unknown$2,\n    nu: nu$2,\n    windows: constant(windows),\n    ios: constant(ios),\n    android: constant(android),\n    linux: constant(linux),\n    osx: constant(osx),\n    solaris: constant(solaris),\n    freebsd: constant(freebsd),\n    chromeos: constant(chromeos)\n  };\n\n  var detect$2 = function (userAgent, mediaMatch) {\n    var browsers = PlatformInfo.browsers();\n    var oses = PlatformInfo.oses();\n    var browser = UaString.detectBrowser(browsers, userAgent).fold(Browser.unknown, Browser.nu);\n    var os = UaString.detectOs(oses, userAgent).fold(OperatingSystem.unknown, OperatingSystem.nu);\n    var deviceType = DeviceType(os, browser, userAgent, mediaMatch);\n    return {\n      browser: browser,\n      os: os,\n      deviceType: deviceType\n    };\n  };\n\n  var PlatformDetection = {\n    detect: detect$2\n  };\n\n  var mediaMatch = function (query) {\n    return window.matchMedia(query).matches;\n  };\n\n  var platform = cached(function () {\n    return PlatformDetection.detect(navigator.userAgent, mediaMatch);\n  });\n\n  var detect$3 = function () {\n    return platform();\n  };\n\n  var userAgent = navigator.userAgent;\n  var platform$1 = detect$3();\n  var browser = platform$1.browser;\n  var os = platform$1.os;\n  var deviceType = platform$1.deviceType;\n  var webkit = /WebKit/.test(userAgent) && !browser.isEdge();\n  var fileApi = 'FormData' in window && 'FileReader' in window && 'URL' in window && !!URL.createObjectURL;\n  var windowsPhone = userAgent.indexOf('Windows Phone') !== -1;\n  var Env = {\n    opera: browser.isOpera(),\n    webkit: webkit,\n    ie: browser.isIE() || browser.isEdge() ? browser.version.major : false,\n    gecko: browser.isFirefox(),\n    mac: os.isOSX() || os.isiOS(),\n    iOS: deviceType.isiPad() || deviceType.isiPhone(),\n    android: os.isAndroid(),\n    contentEditable: true,\n    transparentSrc: 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7',\n    caretAfter: true,\n    range: window.getSelection && 'Range' in window,\n    documentMode: browser.isIE() ? document.documentMode || 7 : 10,\n    fileApi: fileApi,\n    ceFalse: true,\n    cacheSuffix: null,\n    container: null,\n    experimentalShadowDom: false,\n    canHaveCSP: !browser.isIE(),\n    desktop: deviceType.isDesktop(),\n    windowsPhone: windowsPhone,\n    browser: {\n      current: browser.current,\n      version: browser.version,\n      isChrome: browser.isChrome,\n      isEdge: browser.isEdge,\n      isFirefox: browser.isFirefox,\n      isIE: browser.isIE,\n      isOpera: browser.isOpera,\n      isSafari: browser.isSafari\n    },\n    os: {\n      current: os.current,\n      version: os.version,\n      isAndroid: os.isAndroid,\n      isChromeOS: os.isChromeOS,\n      isFreeBSD: os.isFreeBSD,\n      isiOS: os.isiOS,\n      isLinux: os.isLinux,\n      isOSX: os.isOSX,\n      isSolaris: os.isSolaris,\n      isWindows: os.isWindows\n    },\n    deviceType: {\n      isDesktop: deviceType.isDesktop,\n      isiPad: deviceType.isiPad,\n      isiPhone: deviceType.isiPhone,\n      isPhone: deviceType.isPhone,\n      isTablet: deviceType.isTablet,\n      isTouch: deviceType.isTouch,\n      isWebView: deviceType.isWebView\n    }\n  };\n  var whiteSpaceRegExp = /^\\s*|\\s*$/g;\n\n  var trim$1 = function (str) {\n    return str === null || str === undefined ? '' : ('' + str).replace(whiteSpaceRegExp, '');\n  };\n\n  var is = function (obj, type) {\n    if (!type) {\n      return obj !== undefined;\n    }\n\n    if (type === 'array' && isArray$1(obj)) {\n      return true;\n    }\n\n    return typeof obj === type;\n  };\n\n  var makeMap = function (items, delim, map) {\n    var i;\n    items = items || [];\n    delim = delim || ',';\n\n    if (typeof items === 'string') {\n      items = items.split(delim);\n    }\n\n    map = map || {};\n    i = items.length;\n\n    while (i--) {\n      map[items[i]] = {};\n    }\n\n    return map;\n  };\n\n  var hasOwnProperty$1 = function (obj, prop) {\n    return Object.prototype.hasOwnProperty.call(obj, prop);\n  };\n\n  var create = function (s, p, root) {\n    var self = this;\n    var sp,\n        scn,\n        c,\n        de = 0;\n    s = /^((static) )?([\\w.]+)(:([\\w.]+))?/.exec(s);\n    var cn = s[3].match(/(^|\\.)(\\w+)$/i)[2];\n    var ns = self.createNS(s[3].replace(/\\.\\w+$/, ''), root);\n\n    if (ns[cn]) {\n      return;\n    }\n\n    if (s[2] === 'static') {\n      ns[cn] = p;\n\n      if (this.onCreate) {\n        this.onCreate(s[2], s[3], ns[cn]);\n      }\n\n      return;\n    }\n\n    if (!p[cn]) {\n      p[cn] = function () {};\n\n      de = 1;\n    }\n\n    ns[cn] = p[cn];\n    self.extend(ns[cn].prototype, p);\n\n    if (s[5]) {\n      sp = self.resolve(s[5]).prototype;\n      scn = s[5].match(/\\.(\\w+)$/i)[1];\n      c = ns[cn];\n\n      if (de) {\n        ns[cn] = function () {\n          return sp[scn].apply(this, arguments);\n        };\n      } else {\n        ns[cn] = function () {\n          this.parent = sp[scn];\n          return c.apply(this, arguments);\n        };\n      }\n\n      ns[cn].prototype[cn] = ns[cn];\n      self.each(sp, function (f, n) {\n        ns[cn].prototype[n] = sp[n];\n      });\n      self.each(p, function (f, n) {\n        if (sp[n]) {\n          ns[cn].prototype[n] = function () {\n            this.parent = sp[n];\n            return f.apply(this, arguments);\n          };\n        } else {\n          if (n !== cn) {\n            ns[cn].prototype[n] = f;\n          }\n        }\n      });\n    }\n\n    self.each(p.static, function (f, n) {\n      ns[cn][n] = f;\n    });\n  };\n\n  var extend = function (obj) {\n    var exts = [];\n\n    for (var _i = 1; _i < arguments.length; _i++) {\n      exts[_i - 1] = arguments[_i];\n    }\n\n    for (var i = 0; i < exts.length; i++) {\n      var ext = exts[i];\n\n      for (var name_1 in ext) {\n        if (ext.hasOwnProperty(name_1)) {\n          var value = ext[name_1];\n\n          if (value !== undefined) {\n            obj[name_1] = value;\n          }\n        }\n      }\n    }\n\n    return obj;\n  };\n\n  var walk = function (o, f, n, s) {\n    s = s || this;\n\n    if (o) {\n      if (n) {\n        o = o[n];\n      }\n\n      each$2(o, function (o, i) {\n        if (f.call(s, o, i, n) === false) {\n          return false;\n        }\n\n        walk(o, f, n, s);\n      });\n    }\n  };\n\n  var createNS = function (n, o) {\n    var i, v;\n    o = o || window;\n    n = n.split('.');\n\n    for (i = 0; i < n.length; i++) {\n      v = n[i];\n\n      if (!o[v]) {\n        o[v] = {};\n      }\n\n      o = o[v];\n    }\n\n    return o;\n  };\n\n  var resolve = function (n, o) {\n    var i, l;\n    o = o || window;\n    n = n.split('.');\n\n    for (i = 0, l = n.length; i < l; i++) {\n      o = o[n[i]];\n\n      if (!o) {\n        break;\n      }\n    }\n\n    return o;\n  };\n\n  var explode = function (s, d) {\n    if (!s || is(s, 'array')) {\n      return s;\n    }\n\n    return map$2(s.split(d || ','), trim$1);\n  };\n\n  var _addCacheSuffix = function (url) {\n    var cacheSuffix = Env.cacheSuffix;\n\n    if (cacheSuffix) {\n      url += (url.indexOf('?') === -1 ? '?' : '&') + cacheSuffix;\n    }\n\n    return url;\n  };\n\n  var Tools = {\n    trim: trim$1,\n    isArray: isArray$1,\n    is: is,\n    toArray: toArray,\n    makeMap: makeMap,\n    each: each$2,\n    map: map$2,\n    grep: filter$2,\n    inArray: indexOf$1,\n    hasOwn: hasOwnProperty$1,\n    extend: extend,\n    create: create,\n    walk: walk,\n    createNS: createNS,\n    resolve: resolve,\n    explode: explode,\n    _addCacheSuffix: _addCacheSuffix\n  };\n\n  var fromHtml = function (html, scope) {\n    var doc = scope || document;\n    var div = doc.createElement('div');\n    div.innerHTML = html;\n\n    if (!div.hasChildNodes() || div.childNodes.length > 1) {\n      console.error('HTML does not have a single root node', html);\n      throw new Error('HTML must have a single root node');\n    }\n\n    return fromDom(div.childNodes[0]);\n  };\n\n  var fromTag = function (tag, scope) {\n    var doc = scope || document;\n    var node = doc.createElement(tag);\n    return fromDom(node);\n  };\n\n  var fromText = function (text, scope) {\n    var doc = scope || document;\n    var node = doc.createTextNode(text);\n    return fromDom(node);\n  };\n\n  var fromDom = function (node) {\n    if (node === null || node === undefined) {\n      throw new Error('Node cannot be null or undefined');\n    }\n\n    return {\n      dom: node\n    };\n  };\n\n  var fromPoint = function (docElm, x, y) {\n    return Optional.from(docElm.dom.elementFromPoint(x, y)).map(fromDom);\n  };\n\n  var SugarElement = {\n    fromHtml: fromHtml,\n    fromTag: fromTag,\n    fromText: fromText,\n    fromDom: fromDom,\n    fromPoint: fromPoint\n  };\n\n  var toArray$1 = function (target, f) {\n    var r = [];\n\n    var recurse = function (e) {\n      r.push(e);\n      return f(e);\n    };\n\n    var cur = f(target);\n\n    do {\n      cur = cur.bind(recurse);\n    } while (cur.isSome());\n\n    return r;\n  };\n\n  var compareDocumentPosition = function (a, b, match) {\n    return (a.compareDocumentPosition(b) & match) !== 0;\n  };\n\n  var documentPositionContainedBy = function (a, b) {\n    return compareDocumentPosition(a, b, Node.DOCUMENT_POSITION_CONTAINED_BY);\n  };\n\n  var COMMENT = 8;\n  var DOCUMENT = 9;\n  var DOCUMENT_FRAGMENT = 11;\n  var ELEMENT = 1;\n  var TEXT = 3;\n\n  var is$1 = function (element, selector) {\n    var dom = element.dom;\n\n    if (dom.nodeType !== ELEMENT) {\n      return false;\n    } else {\n      var elem = dom;\n\n      if (elem.matches !== undefined) {\n        return elem.matches(selector);\n      } else if (elem.msMatchesSelector !== undefined) {\n        return elem.msMatchesSelector(selector);\n      } else if (elem.webkitMatchesSelector !== undefined) {\n        return elem.webkitMatchesSelector(selector);\n      } else if (elem.mozMatchesSelector !== undefined) {\n        return elem.mozMatchesSelector(selector);\n      } else {\n        throw new Error('Browser lacks native selectors');\n      }\n    }\n  };\n\n  var bypassSelector = function (dom) {\n    return dom.nodeType !== ELEMENT && dom.nodeType !== DOCUMENT && dom.nodeType !== DOCUMENT_FRAGMENT || dom.childElementCount === 0;\n  };\n\n  var all = function (selector, scope) {\n    var base = scope === undefined ? document : scope.dom;\n    return bypassSelector(base) ? [] : map(base.querySelectorAll(selector), SugarElement.fromDom);\n  };\n\n  var one = function (selector, scope) {\n    var base = scope === undefined ? document : scope.dom;\n    return bypassSelector(base) ? Optional.none() : Optional.from(base.querySelector(selector)).map(SugarElement.fromDom);\n  };\n\n  var eq$2 = function (e1, e2) {\n    return e1.dom === e2.dom;\n  };\n\n  var regularContains = function (e1, e2) {\n    var d1 = e1.dom;\n    var d2 = e2.dom;\n    return d1 === d2 ? false : d1.contains(d2);\n  };\n\n  var ieContains = function (e1, e2) {\n    return documentPositionContainedBy(e1.dom, e2.dom);\n  };\n\n  var contains$2 = function (e1, e2) {\n    return detect$3().browser.isIE() ? ieContains(e1, e2) : regularContains(e1, e2);\n  };\n\n  var Global = typeof window !== 'undefined' ? window : Function('return this;')();\n\n  var name = function (element) {\n    var r = element.dom.nodeName;\n    return r.toLowerCase();\n  };\n\n  var type = function (element) {\n    return element.dom.nodeType;\n  };\n\n  var isType$1 = function (t) {\n    return function (element) {\n      return type(element) === t;\n    };\n  };\n\n  var isComment = function (element) {\n    return type(element) === COMMENT || name(element) === '#comment';\n  };\n\n  var isElement = isType$1(ELEMENT);\n  var isText = isType$1(TEXT);\n  var isDocument = isType$1(DOCUMENT);\n  var isDocumentFragment = isType$1(DOCUMENT_FRAGMENT);\n\n  var owner = function (element) {\n    return SugarElement.fromDom(element.dom.ownerDocument);\n  };\n\n  var documentOrOwner = function (dos) {\n    return isDocument(dos) ? dos : owner(dos);\n  };\n\n  var documentElement = function (element) {\n    return SugarElement.fromDom(documentOrOwner(element).dom.documentElement);\n  };\n\n  var defaultView = function (element) {\n    return SugarElement.fromDom(documentOrOwner(element).dom.defaultView);\n  };\n\n  var parent = function (element) {\n    return Optional.from(element.dom.parentNode).map(SugarElement.fromDom);\n  };\n\n  var parents = function (element, isRoot) {\n    var stop = isFunction(isRoot) ? isRoot : never;\n    var dom = element.dom;\n    var ret = [];\n\n    while (dom.parentNode !== null && dom.parentNode !== undefined) {\n      var rawParent = dom.parentNode;\n      var p = SugarElement.fromDom(rawParent);\n      ret.push(p);\n\n      if (stop(p) === true) {\n        break;\n      } else {\n        dom = rawParent;\n      }\n    }\n\n    return ret;\n  };\n\n  var siblings = function (element) {\n    var filterSelf = function (elements) {\n      return filter(elements, function (x) {\n        return !eq$2(element, x);\n      });\n    };\n\n    return parent(element).map(children).map(filterSelf).getOr([]);\n  };\n\n  var prevSibling = function (element) {\n    return Optional.from(element.dom.previousSibling).map(SugarElement.fromDom);\n  };\n\n  var nextSibling = function (element) {\n    return Optional.from(element.dom.nextSibling).map(SugarElement.fromDom);\n  };\n\n  var prevSiblings = function (element) {\n    return reverse(toArray$1(element, prevSibling));\n  };\n\n  var nextSiblings = function (element) {\n    return toArray$1(element, nextSibling);\n  };\n\n  var children = function (element) {\n    return map(element.dom.childNodes, SugarElement.fromDom);\n  };\n\n  var child = function (element, index) {\n    var cs = element.dom.childNodes;\n    return Optional.from(cs[index]).map(SugarElement.fromDom);\n  };\n\n  var firstChild = function (element) {\n    return child(element, 0);\n  };\n\n  var lastChild = function (element) {\n    return child(element, element.dom.childNodes.length - 1);\n  };\n\n  var childNodesCount = function (element) {\n    return element.dom.childNodes.length;\n  };\n\n  var getHead = function (doc) {\n    var b = doc.dom.head;\n\n    if (b === null || b === undefined) {\n      throw new Error('Head is not available yet');\n    }\n\n    return SugarElement.fromDom(b);\n  };\n\n  var isShadowRoot = function (dos) {\n    return isDocumentFragment(dos);\n  };\n\n  var supported = isFunction(Element.prototype.attachShadow) && isFunction(Node.prototype.getRootNode);\n  var isSupported = constant(supported);\n  var getRootNode = supported ? function (e) {\n    return SugarElement.fromDom(e.dom.getRootNode());\n  } : documentOrOwner;\n\n  var getStyleContainer = function (dos) {\n    return isShadowRoot(dos) ? dos : getHead(documentOrOwner(dos));\n  };\n\n  var getShadowRoot = function (e) {\n    var r = getRootNode(e);\n    return isShadowRoot(r) ? Optional.some(r) : Optional.none();\n  };\n\n  var getShadowHost = function (e) {\n    return SugarElement.fromDom(e.dom.host);\n  };\n\n  var getOriginalEventTarget = function (event) {\n    if (isSupported() && isNonNullable(event.target)) {\n      var el = SugarElement.fromDom(event.target);\n\n      if (isElement(el) && isOpenShadowHost(el)) {\n        if (event.composed && event.composedPath) {\n          var composedPath = event.composedPath();\n\n          if (composedPath) {\n            return head(composedPath);\n          }\n        }\n      }\n    }\n\n    return Optional.from(event.target);\n  };\n\n  var isOpenShadowHost = function (element) {\n    return isNonNullable(element.dom.shadowRoot);\n  };\n\n  var before = function (marker, element) {\n    var parent$1 = parent(marker);\n    parent$1.each(function (v) {\n      v.dom.insertBefore(element.dom, marker.dom);\n    });\n  };\n\n  var after = function (marker, element) {\n    var sibling = nextSibling(marker);\n    sibling.fold(function () {\n      var parent$1 = parent(marker);\n      parent$1.each(function (v) {\n        append(v, element);\n      });\n    }, function (v) {\n      before(v, element);\n    });\n  };\n\n  var prepend = function (parent, element) {\n    var firstChild$1 = firstChild(parent);\n    firstChild$1.fold(function () {\n      append(parent, element);\n    }, function (v) {\n      parent.dom.insertBefore(element.dom, v.dom);\n    });\n  };\n\n  var append = function (parent, element) {\n    parent.dom.appendChild(element.dom);\n  };\n\n  var wrap = function (element, wrapper) {\n    before(element, wrapper);\n    append(wrapper, element);\n  };\n\n  var before$1 = function (marker, elements) {\n    each(elements, function (x) {\n      before(marker, x);\n    });\n  };\n\n  var append$1 = function (parent, elements) {\n    each(elements, function (x) {\n      append(parent, x);\n    });\n  };\n\n  var empty = function (element) {\n    element.dom.textContent = '';\n    each(children(element), function (rogue) {\n      remove(rogue);\n    });\n  };\n\n  var remove = function (element) {\n    var dom = element.dom;\n\n    if (dom.parentNode !== null) {\n      dom.parentNode.removeChild(dom);\n    }\n  };\n\n  var unwrap = function (wrapper) {\n    var children$1 = children(wrapper);\n\n    if (children$1.length > 0) {\n      before$1(wrapper, children$1);\n    }\n\n    remove(wrapper);\n  };\n\n  var inBody = function (element) {\n    var dom = isText(element) ? element.dom.parentNode : element.dom;\n\n    if (dom === undefined || dom === null || dom.ownerDocument === null) {\n      return false;\n    }\n\n    var doc = dom.ownerDocument;\n    return getShadowRoot(SugarElement.fromDom(dom)).fold(function () {\n      return doc.body.contains(dom);\n    }, compose1(inBody, getShadowHost));\n  };\n\n  var r = function (left, top) {\n    var translate = function (x, y) {\n      return r(left + x, top + y);\n    };\n\n    return {\n      left: left,\n      top: top,\n      translate: translate\n    };\n  };\n\n  var SugarPosition = r;\n\n  var boxPosition = function (dom) {\n    var box = dom.getBoundingClientRect();\n    return SugarPosition(box.left, box.top);\n  };\n\n  var firstDefinedOrZero = function (a, b) {\n    if (a !== undefined) {\n      return a;\n    } else {\n      return b !== undefined ? b : 0;\n    }\n  };\n\n  var absolute = function (element) {\n    var doc = element.dom.ownerDocument;\n    var body = doc.body;\n    var win = doc.defaultView;\n    var html = doc.documentElement;\n\n    if (body === element.dom) {\n      return SugarPosition(body.offsetLeft, body.offsetTop);\n    }\n\n    var scrollTop = firstDefinedOrZero(win === null || win === void 0 ? void 0 : win.pageYOffset, html.scrollTop);\n    var scrollLeft = firstDefinedOrZero(win === null || win === void 0 ? void 0 : win.pageXOffset, html.scrollLeft);\n    var clientTop = firstDefinedOrZero(html.clientTop, body.clientTop);\n    var clientLeft = firstDefinedOrZero(html.clientLeft, body.clientLeft);\n    return viewport(element).translate(scrollLeft - clientLeft, scrollTop - clientTop);\n  };\n\n  var viewport = function (element) {\n    var dom = element.dom;\n    var doc = dom.ownerDocument;\n    var body = doc.body;\n\n    if (body === dom) {\n      return SugarPosition(body.offsetLeft, body.offsetTop);\n    }\n\n    if (!inBody(element)) {\n      return SugarPosition(0, 0);\n    }\n\n    return boxPosition(dom);\n  };\n\n  var get$1 = function (_DOC) {\n    var doc = _DOC !== undefined ? _DOC.dom : document;\n    var x = doc.body.scrollLeft || doc.documentElement.scrollLeft;\n    var y = doc.body.scrollTop || doc.documentElement.scrollTop;\n    return SugarPosition(x, y);\n  };\n\n  var to = function (x, y, _DOC) {\n    var doc = _DOC !== undefined ? _DOC.dom : document;\n    var win = doc.defaultView;\n\n    if (win) {\n      win.scrollTo(x, y);\n    }\n  };\n\n  var intoView = function (element, alignToTop) {\n    var isSafari = detect$3().browser.isSafari();\n\n    if (isSafari && isFunction(element.dom.scrollIntoViewIfNeeded)) {\n      element.dom.scrollIntoViewIfNeeded(false);\n    } else {\n      element.dom.scrollIntoView(alignToTop);\n    }\n  };\n\n  var get$2 = function (_win) {\n    var win = _win === undefined ? window : _win;\n    return Optional.from(win['visualViewport']);\n  };\n\n  var bounds = function (x, y, width, height) {\n    return {\n      x: x,\n      y: y,\n      width: width,\n      height: height,\n      right: x + width,\n      bottom: y + height\n    };\n  };\n\n  var getBounds = function (_win) {\n    var win = _win === undefined ? window : _win;\n    var doc = win.document;\n    var scroll = get$1(SugarElement.fromDom(doc));\n    return get$2(win).fold(function () {\n      var html = win.document.documentElement;\n      var width = html.clientWidth;\n      var height = html.clientHeight;\n      return bounds(scroll.left, scroll.top, width, height);\n    }, function (visualViewport) {\n      return bounds(Math.max(visualViewport.pageLeft, scroll.left), Math.max(visualViewport.pageTop, scroll.top), visualViewport.width, visualViewport.height);\n    });\n  };\n\n  var isNodeType = function (type) {\n    return function (node) {\n      return !!node && node.nodeType === type;\n    };\n  };\n\n  var isRestrictedNode = function (node) {\n    return !!node && !Object.getPrototypeOf(node);\n  };\n\n  var isElement$1 = isNodeType(1);\n\n  var matchNodeNames = function (names) {\n    var lowercasedNames = names.map(function (s) {\n      return s.toLowerCase();\n    });\n    return function (node) {\n      if (node && node.nodeName) {\n        var nodeName = node.nodeName.toLowerCase();\n        return contains(lowercasedNames, nodeName);\n      }\n\n      return false;\n    };\n  };\n\n  var matchStyleValues = function (name, values) {\n    var items = values.toLowerCase().split(' ');\n    return function (node) {\n      var i, cssValue;\n\n      if (isElement$1(node)) {\n        for (i = 0; i < items.length; i++) {\n          var computed = node.ownerDocument.defaultView.getComputedStyle(node, null);\n          cssValue = computed ? computed.getPropertyValue(name) : null;\n\n          if (cssValue === items[i]) {\n            return true;\n          }\n        }\n      }\n\n      return false;\n    };\n  };\n\n  var hasAttribute = function (attrName) {\n    return function (node) {\n      return isElement$1(node) && node.hasAttribute(attrName);\n    };\n  };\n\n  var hasAttributeValue = function (attrName, attrValue) {\n    return function (node) {\n      return isElement$1(node) && node.getAttribute(attrName) === attrValue;\n    };\n  };\n\n  var isBogus = function (node) {\n    return isElement$1(node) && node.hasAttribute('data-mce-bogus');\n  };\n\n  var isBogusAll = function (node) {\n    return isElement$1(node) && node.getAttribute('data-mce-bogus') === 'all';\n  };\n\n  var isTable = function (node) {\n    return isElement$1(node) && node.tagName === 'TABLE';\n  };\n\n  var hasContentEditableState = function (value) {\n    return function (node) {\n      if (isElement$1(node)) {\n        if (node.contentEditable === value) {\n          return true;\n        }\n\n        if (node.getAttribute('data-mce-contenteditable') === value) {\n          return true;\n        }\n      }\n\n      return false;\n    };\n  };\n\n  var isTextareaOrInput = matchNodeNames(['textarea', 'input']);\n  var isText$1 = isNodeType(3);\n  var isComment$1 = isNodeType(8);\n  var isDocument$1 = isNodeType(9);\n  var isDocumentFragment$1 = isNodeType(11);\n  var isBr = matchNodeNames(['br']);\n  var isImg = matchNodeNames(['img']);\n  var isContentEditableTrue = hasContentEditableState('true');\n  var isContentEditableFalse = hasContentEditableState('false');\n  var isTableCell = matchNodeNames(['td', 'th']);\n  var isMedia = matchNodeNames(['video', 'audio', 'object', 'embed']);\n\n  var isSupported$1 = function (dom) {\n    return dom.style !== undefined && isFunction(dom.style.getPropertyValue);\n  };\n\n  var rawSet = function (dom, key, value) {\n    if (isString(value) || isBoolean(value) || isNumber(value)) {\n      dom.setAttribute(key, value + '');\n    } else {\n      console.error('Invalid call to Attribute.set. Key ', key, ':: Value ', value, ':: Element ', dom);\n      throw new Error('Attribute value was not simple');\n    }\n  };\n\n  var set = function (element, key, value) {\n    rawSet(element.dom, key, value);\n  };\n\n  var setAll = function (element, attrs) {\n    var dom = element.dom;\n    each$1(attrs, function (v, k) {\n      rawSet(dom, k, v);\n    });\n  };\n\n  var get$3 = function (element, key) {\n    var v = element.dom.getAttribute(key);\n    return v === null ? undefined : v;\n  };\n\n  var getOpt = function (element, key) {\n    return Optional.from(get$3(element, key));\n  };\n\n  var has$1 = function (element, key) {\n    var dom = element.dom;\n    return dom && dom.hasAttribute ? dom.hasAttribute(key) : false;\n  };\n\n  var remove$1 = function (element, key) {\n    element.dom.removeAttribute(key);\n  };\n\n  var clone = function (element) {\n    return foldl(element.dom.attributes, function (acc, attr) {\n      acc[attr.name] = attr.value;\n      return acc;\n    }, {});\n  };\n\n  var internalSet = function (dom, property, value) {\n    if (!isString(value)) {\n      console.error('Invalid call to CSS.set. Property ', property, ':: Value ', value, ':: Element ', dom);\n      throw new Error('CSS value must be a string: ' + value);\n    }\n\n    if (isSupported$1(dom)) {\n      dom.style.setProperty(property, value);\n    }\n  };\n\n  var setAll$1 = function (element, css) {\n    var dom = element.dom;\n    each$1(css, function (v, k) {\n      internalSet(dom, k, v);\n    });\n  };\n\n  var get$4 = function (element, property) {\n    var dom = element.dom;\n    var styles = window.getComputedStyle(dom);\n    var r = styles.getPropertyValue(property);\n    return r === '' && !inBody(element) ? getUnsafeProperty(dom, property) : r;\n  };\n\n  var getUnsafeProperty = function (dom, property) {\n    return isSupported$1(dom) ? dom.style.getPropertyValue(property) : '';\n  };\n\n  var getRaw = function (element, property) {\n    var dom = element.dom;\n    var raw = getUnsafeProperty(dom, property);\n    return Optional.from(raw).filter(function (r) {\n      return r.length > 0;\n    });\n  };\n\n  var getAllRaw = function (element) {\n    var css = {};\n    var dom = element.dom;\n\n    if (isSupported$1(dom)) {\n      for (var i = 0; i < dom.style.length; i++) {\n        var ruleName = dom.style.item(i);\n        css[ruleName] = dom.style[ruleName];\n      }\n    }\n\n    return css;\n  };\n\n  var reflow = function (e) {\n    return e.dom.offsetWidth;\n  };\n\n  var browser$1 = detect$3().browser;\n\n  var firstElement = function (nodes) {\n    return find(nodes, isElement);\n  };\n\n  var getTableCaptionDeltaY = function (elm) {\n    if (browser$1.isFirefox() && name(elm) === 'table') {\n      return firstElement(children(elm)).filter(function (elm) {\n        return name(elm) === 'caption';\n      }).bind(function (caption) {\n        return firstElement(nextSiblings(caption)).map(function (body) {\n          var bodyTop = body.dom.offsetTop;\n          var captionTop = caption.dom.offsetTop;\n          var captionHeight = caption.dom.offsetHeight;\n          return bodyTop <= captionTop ? -captionHeight : 0;\n        });\n      }).getOr(0);\n    } else {\n      return 0;\n    }\n  };\n\n  var hasChild = function (elm, child) {\n    return elm.children && contains(elm.children, child);\n  };\n\n  var getPos = function (body, elm, rootElm) {\n    var x = 0,\n        y = 0,\n        offsetParent;\n    var doc = body.ownerDocument;\n    var pos;\n    rootElm = rootElm ? rootElm : body;\n\n    if (elm) {\n      if (rootElm === body && elm.getBoundingClientRect && get$4(SugarElement.fromDom(body), 'position') === 'static') {\n        pos = elm.getBoundingClientRect();\n        x = pos.left + (doc.documentElement.scrollLeft || body.scrollLeft) - doc.documentElement.clientLeft;\n        y = pos.top + (doc.documentElement.scrollTop || body.scrollTop) - doc.documentElement.clientTop;\n        return {\n          x: x,\n          y: y\n        };\n      }\n\n      offsetParent = elm;\n\n      while (offsetParent && offsetParent !== rootElm && offsetParent.nodeType && !hasChild(offsetParent, rootElm)) {\n        x += offsetParent.offsetLeft || 0;\n        y += offsetParent.offsetTop || 0;\n        offsetParent = offsetParent.offsetParent;\n      }\n\n      offsetParent = elm.parentNode;\n\n      while (offsetParent && offsetParent !== rootElm && offsetParent.nodeType && !hasChild(offsetParent, rootElm)) {\n        x -= offsetParent.scrollLeft || 0;\n        y -= offsetParent.scrollTop || 0;\n        offsetParent = offsetParent.parentNode;\n      }\n\n      y += getTableCaptionDeltaY(SugarElement.fromDom(elm));\n    }\n\n    return {\n      x: x,\n      y: y\n    };\n  };\n\n  var exports$1 = {},\n      module$1 = {\n    exports: exports$1\n  };\n\n  (function (define, exports, module, require) {\n    (function (f) {\n      if (typeof exports === 'object' && typeof module !== 'undefined') {\n        module.exports = f();\n      } else if (typeof define === 'function' && define.amd) {\n        define([], f);\n      } else {\n        var g;\n\n        if (typeof window !== 'undefined') {\n          g = window;\n        } else if (typeof global !== 'undefined') {\n          g = global;\n        } else if (typeof self !== 'undefined') {\n          g = self;\n        } else {\n          g = this;\n        }\n\n        g.EphoxContactWrapper = f();\n      }\n    })(function () {\n      return function () {\n        function r(e, n, t) {\n          function o(i, f) {\n            if (!n[i]) {\n              if (!e[i]) {\n                var c = 'function' == typeof require && require;\n                if (!f && c) return c(i, !0);\n                if (u) return u(i, !0);\n                var a = new Error('Cannot find module \\'' + i + '\\'');\n                throw a.code = 'MODULE_NOT_FOUND', a;\n              }\n\n              var p = n[i] = {\n                exports: {}\n              };\n              e[i][0].call(p.exports, function (r) {\n                var n = e[i][1][r];\n                return o(n || r);\n              }, p, p.exports, r, e, n, t);\n            }\n\n            return n[i].exports;\n          }\n\n          for (var u = 'function' == typeof require && require, i = 0; i < t.length; i++) o(t[i]);\n\n          return o;\n        }\n\n        return r;\n      }()({\n        1: [function (require, module, exports) {\n          var process = module.exports = {};\n          var cachedSetTimeout;\n          var cachedClearTimeout;\n\n          function defaultSetTimout() {\n            throw new Error('setTimeout has not been defined');\n          }\n\n          function defaultClearTimeout() {\n            throw new Error('clearTimeout has not been defined');\n          }\n\n          (function () {\n            try {\n              if (typeof setTimeout === 'function') {\n                cachedSetTimeout = setTimeout;\n              } else {\n                cachedSetTimeout = defaultSetTimout;\n              }\n            } catch (e) {\n              cachedSetTimeout = defaultSetTimout;\n            }\n\n            try {\n              if (typeof clearTimeout === 'function') {\n                cachedClearTimeout = clearTimeout;\n              } else {\n                cachedClearTimeout = defaultClearTimeout;\n              }\n            } catch (e) {\n              cachedClearTimeout = defaultClearTimeout;\n            }\n          })();\n\n          function runTimeout(fun) {\n            if (cachedSetTimeout === setTimeout) {\n              return setTimeout(fun, 0);\n            }\n\n            if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n              cachedSetTimeout = setTimeout;\n              return setTimeout(fun, 0);\n            }\n\n            try {\n              return cachedSetTimeout(fun, 0);\n            } catch (e) {\n              try {\n                return cachedSetTimeout.call(null, fun, 0);\n              } catch (e) {\n                return cachedSetTimeout.call(this, fun, 0);\n              }\n            }\n          }\n\n          function runClearTimeout(marker) {\n            if (cachedClearTimeout === clearTimeout) {\n              return clearTimeout(marker);\n            }\n\n            if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n              cachedClearTimeout = clearTimeout;\n              return clearTimeout(marker);\n            }\n\n            try {\n              return cachedClearTimeout(marker);\n            } catch (e) {\n              try {\n                return cachedClearTimeout.call(null, marker);\n              } catch (e) {\n                return cachedClearTimeout.call(this, marker);\n              }\n            }\n          }\n\n          var queue = [];\n          var draining = false;\n          var currentQueue;\n          var queueIndex = -1;\n\n          function cleanUpNextTick() {\n            if (!draining || !currentQueue) {\n              return;\n            }\n\n            draining = false;\n\n            if (currentQueue.length) {\n              queue = currentQueue.concat(queue);\n            } else {\n              queueIndex = -1;\n            }\n\n            if (queue.length) {\n              drainQueue();\n            }\n          }\n\n          function drainQueue() {\n            if (draining) {\n              return;\n            }\n\n            var timeout = runTimeout(cleanUpNextTick);\n            draining = true;\n            var len = queue.length;\n\n            while (len) {\n              currentQueue = queue;\n              queue = [];\n\n              while (++queueIndex < len) {\n                if (currentQueue) {\n                  currentQueue[queueIndex].run();\n                }\n              }\n\n              queueIndex = -1;\n              len = queue.length;\n            }\n\n            currentQueue = null;\n            draining = false;\n            runClearTimeout(timeout);\n          }\n\n          process.nextTick = function (fun) {\n            var args = new Array(arguments.length - 1);\n\n            if (arguments.length > 1) {\n              for (var i = 1; i < arguments.length; i++) {\n                args[i - 1] = arguments[i];\n              }\n            }\n\n            queue.push(new Item(fun, args));\n\n            if (queue.length === 1 && !draining) {\n              runTimeout(drainQueue);\n            }\n          };\n\n          function Item(fun, array) {\n            this.fun = fun;\n            this.array = array;\n          }\n\n          Item.prototype.run = function () {\n            this.fun.apply(null, this.array);\n          };\n\n          process.title = 'browser';\n          process.browser = true;\n          process.env = {};\n          process.argv = [];\n          process.version = '';\n          process.versions = {};\n\n          function noop() {}\n\n          process.on = noop;\n          process.addListener = noop;\n          process.once = noop;\n          process.off = noop;\n          process.removeListener = noop;\n          process.removeAllListeners = noop;\n          process.emit = noop;\n          process.prependListener = noop;\n          process.prependOnceListener = noop;\n\n          process.listeners = function (name) {\n            return [];\n          };\n\n          process.binding = function (name) {\n            throw new Error('process.binding is not supported');\n          };\n\n          process.cwd = function () {\n            return '/';\n          };\n\n          process.chdir = function (dir) {\n            throw new Error('process.chdir is not supported');\n          };\n\n          process.umask = function () {\n            return 0;\n          };\n        }, {}],\n        2: [function (require, module, exports) {\n          (function (setImmediate) {\n            (function (root) {\n              var setTimeoutFunc = setTimeout;\n\n              function noop() {}\n\n              function bind(fn, thisArg) {\n                return function () {\n                  fn.apply(thisArg, arguments);\n                };\n              }\n\n              function Promise(fn) {\n                if (typeof this !== 'object') throw new TypeError('Promises must be constructed via new');\n                if (typeof fn !== 'function') throw new TypeError('not a function');\n                this._state = 0;\n                this._handled = false;\n                this._value = undefined;\n                this._deferreds = [];\n                doResolve(fn, this);\n              }\n\n              function handle(self, deferred) {\n                while (self._state === 3) {\n                  self = self._value;\n                }\n\n                if (self._state === 0) {\n                  self._deferreds.push(deferred);\n\n                  return;\n                }\n\n                self._handled = true;\n\n                Promise._immediateFn(function () {\n                  var cb = self._state === 1 ? deferred.onFulfilled : deferred.onRejected;\n\n                  if (cb === null) {\n                    (self._state === 1 ? resolve : reject)(deferred.promise, self._value);\n                    return;\n                  }\n\n                  var ret;\n\n                  try {\n                    ret = cb(self._value);\n                  } catch (e) {\n                    reject(deferred.promise, e);\n                    return;\n                  }\n\n                  resolve(deferred.promise, ret);\n                });\n              }\n\n              function resolve(self, newValue) {\n                try {\n                  if (newValue === self) throw new TypeError('A promise cannot be resolved with itself.');\n\n                  if (newValue && (typeof newValue === 'object' || typeof newValue === 'function')) {\n                    var then = newValue.then;\n\n                    if (newValue instanceof Promise) {\n                      self._state = 3;\n                      self._value = newValue;\n                      finale(self);\n                      return;\n                    } else if (typeof then === 'function') {\n                      doResolve(bind(then, newValue), self);\n                      return;\n                    }\n                  }\n\n                  self._state = 1;\n                  self._value = newValue;\n                  finale(self);\n                } catch (e) {\n                  reject(self, e);\n                }\n              }\n\n              function reject(self, newValue) {\n                self._state = 2;\n                self._value = newValue;\n                finale(self);\n              }\n\n              function finale(self) {\n                if (self._state === 2 && self._deferreds.length === 0) {\n                  Promise._immediateFn(function () {\n                    if (!self._handled) {\n                      Promise._unhandledRejectionFn(self._value);\n                    }\n                  });\n                }\n\n                for (var i = 0, len = self._deferreds.length; i < len; i++) {\n                  handle(self, self._deferreds[i]);\n                }\n\n                self._deferreds = null;\n              }\n\n              function Handler(onFulfilled, onRejected, promise) {\n                this.onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : null;\n                this.onRejected = typeof onRejected === 'function' ? onRejected : null;\n                this.promise = promise;\n              }\n\n              function doResolve(fn, self) {\n                var done = false;\n\n                try {\n                  fn(function (value) {\n                    if (done) return;\n                    done = true;\n                    resolve(self, value);\n                  }, function (reason) {\n                    if (done) return;\n                    done = true;\n                    reject(self, reason);\n                  });\n                } catch (ex) {\n                  if (done) return;\n                  done = true;\n                  reject(self, ex);\n                }\n              }\n\n              Promise.prototype['catch'] = function (onRejected) {\n                return this.then(null, onRejected);\n              };\n\n              Promise.prototype.then = function (onFulfilled, onRejected) {\n                var prom = new this.constructor(noop);\n                handle(this, new Handler(onFulfilled, onRejected, prom));\n                return prom;\n              };\n\n              Promise.all = function (arr) {\n                var args = Array.prototype.slice.call(arr);\n                return new Promise(function (resolve, reject) {\n                  if (args.length === 0) return resolve([]);\n                  var remaining = args.length;\n\n                  function res(i, val) {\n                    try {\n                      if (val && (typeof val === 'object' || typeof val === 'function')) {\n                        var then = val.then;\n\n                        if (typeof then === 'function') {\n                          then.call(val, function (val) {\n                            res(i, val);\n                          }, reject);\n                          return;\n                        }\n                      }\n\n                      args[i] = val;\n\n                      if (--remaining === 0) {\n                        resolve(args);\n                      }\n                    } catch (ex) {\n                      reject(ex);\n                    }\n                  }\n\n                  for (var i = 0; i < args.length; i++) {\n                    res(i, args[i]);\n                  }\n                });\n              };\n\n              Promise.resolve = function (value) {\n                if (value && typeof value === 'object' && value.constructor === Promise) {\n                  return value;\n                }\n\n                return new Promise(function (resolve) {\n                  resolve(value);\n                });\n              };\n\n              Promise.reject = function (value) {\n                return new Promise(function (resolve, reject) {\n                  reject(value);\n                });\n              };\n\n              Promise.race = function (values) {\n                return new Promise(function (resolve, reject) {\n                  for (var i = 0, len = values.length; i < len; i++) {\n                    values[i].then(resolve, reject);\n                  }\n                });\n              };\n\n              Promise._immediateFn = typeof setImmediate === 'function' ? function (fn) {\n                setImmediate(fn);\n              } : function (fn) {\n                setTimeoutFunc(fn, 0);\n              };\n\n              Promise._unhandledRejectionFn = function _unhandledRejectionFn(err) {\n                if (typeof console !== 'undefined' && console) {\n                  console.warn('Possible Unhandled Promise Rejection:', err);\n                }\n              };\n\n              Promise._setImmediateFn = function _setImmediateFn(fn) {\n                Promise._immediateFn = fn;\n              };\n\n              Promise._setUnhandledRejectionFn = function _setUnhandledRejectionFn(fn) {\n                Promise._unhandledRejectionFn = fn;\n              };\n\n              if (typeof module !== 'undefined' && module.exports) {\n                module.exports = Promise;\n              } else if (!root.Promise) {\n                root.Promise = Promise;\n              }\n            })(this);\n          }).call(this, require('timers').setImmediate);\n        }, {\n          'timers': 3\n        }],\n        3: [function (require, module, exports) {\n          (function (setImmediate, clearImmediate) {\n            var nextTick = require('process/browser.js').nextTick;\n\n            var apply = Function.prototype.apply;\n            var slice = Array.prototype.slice;\n            var immediateIds = {};\n            var nextImmediateId = 0;\n\n            exports.setTimeout = function () {\n              return new Timeout(apply.call(setTimeout, window, arguments), clearTimeout);\n            };\n\n            exports.setInterval = function () {\n              return new Timeout(apply.call(setInterval, window, arguments), clearInterval);\n            };\n\n            exports.clearTimeout = exports.clearInterval = function (timeout) {\n              timeout.close();\n            };\n\n            function Timeout(id, clearFn) {\n              this._id = id;\n              this._clearFn = clearFn;\n            }\n\n            Timeout.prototype.unref = Timeout.prototype.ref = function () {};\n\n            Timeout.prototype.close = function () {\n              this._clearFn.call(window, this._id);\n            };\n\n            exports.enroll = function (item, msecs) {\n              clearTimeout(item._idleTimeoutId);\n              item._idleTimeout = msecs;\n            };\n\n            exports.unenroll = function (item) {\n              clearTimeout(item._idleTimeoutId);\n              item._idleTimeout = -1;\n            };\n\n            exports._unrefActive = exports.active = function (item) {\n              clearTimeout(item._idleTimeoutId);\n              var msecs = item._idleTimeout;\n\n              if (msecs >= 0) {\n                item._idleTimeoutId = setTimeout(function onTimeout() {\n                  if (item._onTimeout) item._onTimeout();\n                }, msecs);\n              }\n            };\n\n            exports.setImmediate = typeof setImmediate === 'function' ? setImmediate : function (fn) {\n              var id = nextImmediateId++;\n              var args = arguments.length < 2 ? false : slice.call(arguments, 1);\n              immediateIds[id] = true;\n              nextTick(function onNextTick() {\n                if (immediateIds[id]) {\n                  if (args) {\n                    fn.apply(null, args);\n                  } else {\n                    fn.call(null);\n                  }\n\n                  exports.clearImmediate(id);\n                }\n              });\n              return id;\n            };\n            exports.clearImmediate = typeof clearImmediate === 'function' ? clearImmediate : function (id) {\n              delete immediateIds[id];\n            };\n          }).call(this, require('timers').setImmediate, require('timers').clearImmediate);\n        }, {\n          'process/browser.js': 1,\n          'timers': 3\n        }],\n        4: [function (require, module, exports) {\n          var promisePolyfill = require('promise-polyfill');\n\n          var Global = function () {\n            if (typeof window !== 'undefined') {\n              return window;\n            } else {\n              return Function('return this;')();\n            }\n          }();\n\n          module.exports = {\n            boltExport: Global.Promise || promisePolyfill\n          };\n        }, {\n          'promise-polyfill': 2\n        }]\n      }, {}, [4])(4);\n    });\n  })(undefined, exports$1, module$1, undefined);\n\n  var Promise = module$1.exports.boltExport;\n\n  var nu$3 = function (baseFn) {\n    var data = Optional.none();\n    var callbacks = [];\n\n    var map = function (f) {\n      return nu$3(function (nCallback) {\n        get(function (data) {\n          nCallback(f(data));\n        });\n      });\n    };\n\n    var get = function (nCallback) {\n      if (isReady()) {\n        call(nCallback);\n      } else {\n        callbacks.push(nCallback);\n      }\n    };\n\n    var set = function (x) {\n      if (!isReady()) {\n        data = Optional.some(x);\n        run(callbacks);\n        callbacks = [];\n      }\n    };\n\n    var isReady = function () {\n      return data.isSome();\n    };\n\n    var run = function (cbs) {\n      each(cbs, call);\n    };\n\n    var call = function (cb) {\n      data.each(function (x) {\n        setTimeout(function () {\n          cb(x);\n        }, 0);\n      });\n    };\n\n    baseFn(set);\n    return {\n      get: get,\n      map: map,\n      isReady: isReady\n    };\n  };\n\n  var pure = function (a) {\n    return nu$3(function (callback) {\n      callback(a);\n    });\n  };\n\n  var LazyValue = {\n    nu: nu$3,\n    pure: pure\n  };\n\n  var errorReporter = function (err) {\n    setTimeout(function () {\n      throw err;\n    }, 0);\n  };\n\n  var make = function (run) {\n    var get = function (callback) {\n      run().then(callback, errorReporter);\n    };\n\n    var map = function (fab) {\n      return make(function () {\n        return run().then(fab);\n      });\n    };\n\n    var bind = function (aFutureB) {\n      return make(function () {\n        return run().then(function (v) {\n          return aFutureB(v).toPromise();\n        });\n      });\n    };\n\n    var anonBind = function (futureB) {\n      return make(function () {\n        return run().then(function () {\n          return futureB.toPromise();\n        });\n      });\n    };\n\n    var toLazy = function () {\n      return LazyValue.nu(get);\n    };\n\n    var toCached = function () {\n      var cache = null;\n      return make(function () {\n        if (cache === null) {\n          cache = run();\n        }\n\n        return cache;\n      });\n    };\n\n    var toPromise = run;\n    return {\n      map: map,\n      bind: bind,\n      anonBind: anonBind,\n      toLazy: toLazy,\n      toCached: toCached,\n      toPromise: toPromise,\n      get: get\n    };\n  };\n\n  var nu$4 = function (baseFn) {\n    return make(function () {\n      return new Promise(baseFn);\n    });\n  };\n\n  var pure$1 = function (a) {\n    return make(function () {\n      return Promise.resolve(a);\n    });\n  };\n\n  var Future = {\n    nu: nu$4,\n    pure: pure$1\n  };\n\n  var par = function (asyncValues, nu) {\n    return nu(function (callback) {\n      var r = [];\n      var count = 0;\n\n      var cb = function (i) {\n        return function (value) {\n          r[i] = value;\n          count++;\n\n          if (count >= asyncValues.length) {\n            callback(r);\n          }\n        };\n      };\n\n      if (asyncValues.length === 0) {\n        callback([]);\n      } else {\n        each(asyncValues, function (asyncValue, i) {\n          asyncValue.get(cb(i));\n        });\n      }\n    });\n  };\n\n  var par$1 = function (futures) {\n    return par(futures, Future.nu);\n  };\n\n  var value = function (o) {\n    var is = function (v) {\n      return o === v;\n    };\n\n    var or = function (_opt) {\n      return value(o);\n    };\n\n    var orThunk = function (_f) {\n      return value(o);\n    };\n\n    var map = function (f) {\n      return value(f(o));\n    };\n\n    var mapError = function (_f) {\n      return value(o);\n    };\n\n    var each = function (f) {\n      f(o);\n    };\n\n    var bind = function (f) {\n      return f(o);\n    };\n\n    var fold = function (_, onValue) {\n      return onValue(o);\n    };\n\n    var exists = function (f) {\n      return f(o);\n    };\n\n    var forall = function (f) {\n      return f(o);\n    };\n\n    var toOptional = function () {\n      return Optional.some(o);\n    };\n\n    return {\n      is: is,\n      isValue: always,\n      isError: never,\n      getOr: constant(o),\n      getOrThunk: constant(o),\n      getOrDie: constant(o),\n      or: or,\n      orThunk: orThunk,\n      fold: fold,\n      map: map,\n      mapError: mapError,\n      each: each,\n      bind: bind,\n      exists: exists,\n      forall: forall,\n      toOptional: toOptional\n    };\n  };\n\n  var error = function (message) {\n    var getOrThunk = function (f) {\n      return f();\n    };\n\n    var getOrDie = function () {\n      return die(String(message))();\n    };\n\n    var or = function (opt) {\n      return opt;\n    };\n\n    var orThunk = function (f) {\n      return f();\n    };\n\n    var map = function (_f) {\n      return error(message);\n    };\n\n    var mapError = function (f) {\n      return error(f(message));\n    };\n\n    var bind = function (_f) {\n      return error(message);\n    };\n\n    var fold = function (onError, _) {\n      return onError(message);\n    };\n\n    return {\n      is: never,\n      isValue: never,\n      isError: always,\n      getOr: identity,\n      getOrThunk: getOrThunk,\n      getOrDie: getOrDie,\n      or: or,\n      orThunk: orThunk,\n      fold: fold,\n      map: map,\n      mapError: mapError,\n      each: noop,\n      bind: bind,\n      exists: never,\n      forall: always,\n      toOptional: Optional.none\n    };\n  };\n\n  var fromOption = function (opt, err) {\n    return opt.fold(function () {\n      return error(err);\n    }, value);\n  };\n\n  var Result = {\n    value: value,\n    error: error,\n    fromOption: fromOption\n  };\n\n  var generate = function (cases) {\n    if (!isArray(cases)) {\n      throw new Error('cases must be an array');\n    }\n\n    if (cases.length === 0) {\n      throw new Error('there must be at least one case');\n    }\n\n    var constructors = [];\n    var adt = {};\n    each(cases, function (acase, count) {\n      var keys$1 = keys(acase);\n\n      if (keys$1.length !== 1) {\n        throw new Error('one and only one name per case');\n      }\n\n      var key = keys$1[0];\n      var value = acase[key];\n\n      if (adt[key] !== undefined) {\n        throw new Error('duplicate key detected:' + key);\n      } else if (key === 'cata') {\n        throw new Error('cannot have a case named cata (sorry)');\n      } else if (!isArray(value)) {\n        throw new Error('case arguments must be an array');\n      }\n\n      constructors.push(key);\n\n      adt[key] = function () {\n        var argLength = arguments.length;\n\n        if (argLength !== value.length) {\n          throw new Error('Wrong number of arguments to case ' + key + '. Expected ' + value.length + ' (' + value + '), got ' + argLength);\n        }\n\n        var args = new Array(argLength);\n\n        for (var i = 0; i < args.length; i++) {\n          args[i] = arguments[i];\n        }\n\n        var match = function (branches) {\n          var branchKeys = keys(branches);\n\n          if (constructors.length !== branchKeys.length) {\n            throw new Error('Wrong number of arguments to match. Expected: ' + constructors.join(',') + '\\nActual: ' + branchKeys.join(','));\n          }\n\n          var allReqd = forall(constructors, function (reqKey) {\n            return contains(branchKeys, reqKey);\n          });\n\n          if (!allReqd) {\n            throw new Error('Not all branches were specified when using match. Specified: ' + branchKeys.join(', ') + '\\nRequired: ' + constructors.join(', '));\n          }\n\n          return branches[key].apply(null, args);\n        };\n\n        return {\n          fold: function () {\n            if (arguments.length !== cases.length) {\n              throw new Error('Wrong number of arguments to fold. Expected ' + cases.length + ', got ' + arguments.length);\n            }\n\n            var target = arguments[count];\n            return target.apply(null, args);\n          },\n          match: match,\n          log: function (label) {\n            console.log(label, {\n              constructors: constructors,\n              constructor: key,\n              params: args\n            });\n          }\n        };\n      };\n    });\n    return adt;\n  };\n\n  var Adt = {\n    generate: generate\n  };\n  var comparison = Adt.generate([{\n    bothErrors: ['error1', 'error2']\n  }, {\n    firstError: ['error1', 'value2']\n  }, {\n    secondError: ['value1', 'error2']\n  }, {\n    bothValues: ['value1', 'value2']\n  }]);\n\n  var unite = function (result) {\n    return result.fold(identity, identity);\n  };\n\n  function ClosestOrAncestor(is, ancestor, scope, a, isRoot) {\n    return is(scope, a) ? Optional.some(scope) : isFunction(isRoot) && isRoot(scope) ? Optional.none() : ancestor(scope, a, isRoot);\n  }\n\n  var ancestor = function (scope, predicate, isRoot) {\n    var element = scope.dom;\n    var stop = isFunction(isRoot) ? isRoot : never;\n\n    while (element.parentNode) {\n      element = element.parentNode;\n      var el = SugarElement.fromDom(element);\n\n      if (predicate(el)) {\n        return Optional.some(el);\n      } else if (stop(el)) {\n        break;\n      }\n    }\n\n    return Optional.none();\n  };\n\n  var closest = function (scope, predicate, isRoot) {\n    var is = function (s, test) {\n      return test(s);\n    };\n\n    return ClosestOrAncestor(is, ancestor, scope, predicate, isRoot);\n  };\n\n  var ancestor$1 = function (scope, selector, isRoot) {\n    return ancestor(scope, function (e) {\n      return is$1(e, selector);\n    }, isRoot);\n  };\n\n  var descendant = function (scope, selector) {\n    return one(selector, scope);\n  };\n\n  var closest$1 = function (scope, selector, isRoot) {\n    var is = function (element, selector) {\n      return is$1(element, selector);\n    };\n\n    return ClosestOrAncestor(is, ancestor$1, scope, selector, isRoot);\n  };\n\n  var promise = function () {\n    function bind(fn, thisArg) {\n      return function () {\n        fn.apply(thisArg, arguments);\n      };\n    }\n\n    var isArray = Array.isArray || function (value) {\n      return Object.prototype.toString.call(value) === '[object Array]';\n    };\n\n    var Promise = function (fn) {\n      if (typeof this !== 'object') {\n        throw new TypeError('Promises must be constructed via new');\n      }\n\n      if (typeof fn !== 'function') {\n        throw new TypeError('not a function');\n      }\n\n      this._state = null;\n      this._value = null;\n      this._deferreds = [];\n      doResolve(fn, bind(resolve, this), bind(reject, this));\n    };\n\n    var asap = Promise.immediateFn || typeof setImmediate === 'function' && setImmediate || function (fn) {\n      setTimeout(fn, 1);\n    };\n\n    function handle(deferred) {\n      var me = this;\n\n      if (this._state === null) {\n        this._deferreds.push(deferred);\n\n        return;\n      }\n\n      asap(function () {\n        var cb = me._state ? deferred.onFulfilled : deferred.onRejected;\n\n        if (cb === null) {\n          (me._state ? deferred.resolve : deferred.reject)(me._value);\n          return;\n        }\n\n        var ret;\n\n        try {\n          ret = cb(me._value);\n        } catch (e) {\n          deferred.reject(e);\n          return;\n        }\n\n        deferred.resolve(ret);\n      });\n    }\n\n    function resolve(newValue) {\n      try {\n        if (newValue === this) {\n          throw new TypeError('A promise cannot be resolved with itself.');\n        }\n\n        if (newValue && (typeof newValue === 'object' || typeof newValue === 'function')) {\n          var then = newValue.then;\n\n          if (typeof then === 'function') {\n            doResolve(bind(then, newValue), bind(resolve, this), bind(reject, this));\n            return;\n          }\n        }\n\n        this._state = true;\n        this._value = newValue;\n        finale.call(this);\n      } catch (e) {\n        reject.call(this, e);\n      }\n    }\n\n    function reject(newValue) {\n      this._state = false;\n      this._value = newValue;\n      finale.call(this);\n    }\n\n    function finale() {\n      for (var i = 0, len = this._deferreds.length; i < len; i++) {\n        handle.call(this, this._deferreds[i]);\n      }\n\n      this._deferreds = null;\n    }\n\n    function Handler(onFulfilled, onRejected, resolve, reject) {\n      this.onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : null;\n      this.onRejected = typeof onRejected === 'function' ? onRejected : null;\n      this.resolve = resolve;\n      this.reject = reject;\n    }\n\n    function doResolve(fn, onFulfilled, onRejected) {\n      var done = false;\n\n      try {\n        fn(function (value) {\n          if (done) {\n            return;\n          }\n\n          done = true;\n          onFulfilled(value);\n        }, function (reason) {\n          if (done) {\n            return;\n          }\n\n          done = true;\n          onRejected(reason);\n        });\n      } catch (ex) {\n        if (done) {\n          return;\n        }\n\n        done = true;\n        onRejected(ex);\n      }\n    }\n\n    Promise.prototype.catch = function (onRejected) {\n      return this.then(null, onRejected);\n    };\n\n    Promise.prototype.then = function (onFulfilled, onRejected) {\n      var me = this;\n      return new Promise(function (resolve, reject) {\n        handle.call(me, new Handler(onFulfilled, onRejected, resolve, reject));\n      });\n    };\n\n    Promise.all = function () {\n      var args = Array.prototype.slice.call(arguments.length === 1 && isArray(arguments[0]) ? arguments[0] : arguments);\n      return new Promise(function (resolve, reject) {\n        if (args.length === 0) {\n          return resolve([]);\n        }\n\n        var remaining = args.length;\n\n        function res(i, val) {\n          try {\n            if (val && (typeof val === 'object' || typeof val === 'function')) {\n              var then = val.then;\n\n              if (typeof then === 'function') {\n                then.call(val, function (val) {\n                  res(i, val);\n                }, reject);\n                return;\n              }\n            }\n\n            args[i] = val;\n\n            if (--remaining === 0) {\n              resolve(args);\n            }\n          } catch (ex) {\n            reject(ex);\n          }\n        }\n\n        for (var i = 0; i < args.length; i++) {\n          res(i, args[i]);\n        }\n      });\n    };\n\n    Promise.resolve = function (value) {\n      if (value && typeof value === 'object' && value.constructor === Promise) {\n        return value;\n      }\n\n      return new Promise(function (resolve) {\n        resolve(value);\n      });\n    };\n\n    Promise.reject = function (value) {\n      return new Promise(function (resolve, reject) {\n        reject(value);\n      });\n    };\n\n    Promise.race = function (values) {\n      return new Promise(function (resolve, reject) {\n        for (var i = 0, len = values.length; i < len; i++) {\n          values[i].then(resolve, reject);\n        }\n      });\n    };\n\n    return Promise;\n  };\n\n  var promiseObj = window.Promise ? window.Promise : promise();\n  var requestAnimationFramePromise;\n\n  var requestAnimationFrame = function (callback, element) {\n    var i,\n        requestAnimationFrameFunc = window.requestAnimationFrame;\n    var vendors = ['ms', 'moz', 'webkit'];\n\n    var featurefill = function (callback) {\n      window.setTimeout(callback, 0);\n    };\n\n    for (i = 0; i < vendors.length && !requestAnimationFrameFunc; i++) {\n      requestAnimationFrameFunc = window[vendors[i] + 'RequestAnimationFrame'];\n    }\n\n    if (!requestAnimationFrameFunc) {\n      requestAnimationFrameFunc = featurefill;\n    }\n\n    requestAnimationFrameFunc(callback, element);\n  };\n\n  var wrappedSetTimeout = function (callback, time) {\n    if (typeof time !== 'number') {\n      time = 0;\n    }\n\n    return setTimeout(callback, time);\n  };\n\n  var wrappedSetInterval = function (callback, time) {\n    if (typeof time !== 'number') {\n      time = 1;\n    }\n\n    return setInterval(callback, time);\n  };\n\n  var wrappedClearTimeout = function (id) {\n    return clearTimeout(id);\n  };\n\n  var wrappedClearInterval = function (id) {\n    return clearInterval(id);\n  };\n\n  var debounce = function (callback, time) {\n    var timer;\n\n    var func = function () {\n      var args = [];\n\n      for (var _i = 0; _i < arguments.length; _i++) {\n        args[_i] = arguments[_i];\n      }\n\n      clearTimeout(timer);\n      timer = wrappedSetTimeout(function () {\n        callback.apply(this, args);\n      }, time);\n    };\n\n    func.stop = function () {\n      clearTimeout(timer);\n    };\n\n    return func;\n  };\n\n  var Delay = {\n    requestAnimationFrame: function (callback, element) {\n      if (requestAnimationFramePromise) {\n        requestAnimationFramePromise.then(callback);\n        return;\n      }\n\n      requestAnimationFramePromise = new promiseObj(function (resolve) {\n        if (!element) {\n          element = document.body;\n        }\n\n        requestAnimationFrame(resolve, element);\n      }).then(callback);\n    },\n    setTimeout: wrappedSetTimeout,\n    setInterval: wrappedSetInterval,\n    setEditorTimeout: function (editor, callback, time) {\n      return wrappedSetTimeout(function () {\n        if (!editor.removed) {\n          callback();\n        }\n      }, time);\n    },\n    setEditorInterval: function (editor, callback, time) {\n      var timer = wrappedSetInterval(function () {\n        if (!editor.removed) {\n          callback();\n        } else {\n          clearInterval(timer);\n        }\n      }, time);\n      return timer;\n    },\n    debounce: debounce,\n    throttle: debounce,\n    clearInterval: wrappedClearInterval,\n    clearTimeout: wrappedClearTimeout\n  };\n\n  function StyleSheetLoader(documentOrShadowRoot, settings) {\n    if (settings === void 0) {\n      settings = {};\n    }\n\n    var idCount = 0;\n    var loadedStates = {};\n    var edos = SugarElement.fromDom(documentOrShadowRoot);\n    var doc = documentOrOwner(edos);\n    var maxLoadTime = settings.maxLoadTime || 5000;\n\n    var _setReferrerPolicy = function (referrerPolicy) {\n      settings.referrerPolicy = referrerPolicy;\n    };\n\n    var addStyle = function (element) {\n      append(getStyleContainer(edos), element);\n    };\n\n    var removeStyle = function (id) {\n      var styleContainer = getStyleContainer(edos);\n      descendant(styleContainer, '#' + id).each(remove);\n    };\n\n    var getOrCreateState = function (url) {\n      return get(loadedStates, url).getOrThunk(function () {\n        return {\n          id: 'mce-u' + idCount++,\n          passed: [],\n          failed: [],\n          count: 0\n        };\n      });\n    };\n\n    var load = function (url, success, failure) {\n      var link;\n\n      var urlWithSuffix = Tools._addCacheSuffix(url);\n\n      var state = getOrCreateState(urlWithSuffix);\n      loadedStates[urlWithSuffix] = state;\n      state.count++;\n\n      var resolve = function (callbacks, status) {\n        var i = callbacks.length;\n\n        while (i--) {\n          callbacks[i]();\n        }\n\n        state.status = status;\n        state.passed = [];\n        state.failed = [];\n\n        if (link) {\n          link.onload = null;\n          link.onerror = null;\n          link = null;\n        }\n      };\n\n      var passed = function () {\n        return resolve(state.passed, 2);\n      };\n\n      var failed = function () {\n        return resolve(state.failed, 3);\n      };\n\n      var wait = function (testCallback, waitCallback) {\n        if (!testCallback()) {\n          if (Date.now() - startTime < maxLoadTime) {\n            Delay.setTimeout(waitCallback);\n          } else {\n            failed();\n          }\n        }\n      };\n\n      var waitForWebKitLinkLoaded = function () {\n        wait(function () {\n          var styleSheets = documentOrShadowRoot.styleSheets;\n          var i = styleSheets.length;\n\n          while (i--) {\n            var styleSheet = styleSheets[i];\n            var owner = styleSheet.ownerNode;\n\n            if (owner && owner.id === link.id) {\n              passed();\n              return true;\n            }\n          }\n\n          return false;\n        }, waitForWebKitLinkLoaded);\n      };\n\n      if (success) {\n        state.passed.push(success);\n      }\n\n      if (failure) {\n        state.failed.push(failure);\n      }\n\n      if (state.status === 1) {\n        return;\n      }\n\n      if (state.status === 2) {\n        passed();\n        return;\n      }\n\n      if (state.status === 3) {\n        failed();\n        return;\n      }\n\n      state.status = 1;\n      var linkElem = SugarElement.fromTag('link', doc.dom);\n      setAll(linkElem, {\n        rel: 'stylesheet',\n        type: 'text/css',\n        id: state.id\n      });\n      var startTime = Date.now();\n\n      if (settings.contentCssCors) {\n        set(linkElem, 'crossOrigin', 'anonymous');\n      }\n\n      if (settings.referrerPolicy) {\n        set(linkElem, 'referrerpolicy', settings.referrerPolicy);\n      }\n\n      link = linkElem.dom;\n      link.onload = waitForWebKitLinkLoaded;\n      link.onerror = failed;\n      addStyle(linkElem);\n      set(linkElem, 'href', urlWithSuffix);\n    };\n\n    var loadF = function (url) {\n      return Future.nu(function (resolve) {\n        load(url, compose(resolve, constant(Result.value(url))), compose(resolve, constant(Result.error(url))));\n      });\n    };\n\n    var loadAll = function (urls, success, failure) {\n      par$1(map(urls, loadF)).get(function (result) {\n        var parts = partition(result, function (r) {\n          return r.isValue();\n        });\n\n        if (parts.fail.length > 0) {\n          failure(parts.fail.map(unite));\n        } else {\n          success(parts.pass.map(unite));\n        }\n      });\n    };\n\n    var unload = function (url) {\n      var urlWithSuffix = Tools._addCacheSuffix(url);\n\n      get(loadedStates, urlWithSuffix).each(function (state) {\n        var count = --state.count;\n\n        if (count === 0) {\n          delete loadedStates[urlWithSuffix];\n          removeStyle(state.id);\n        }\n      });\n    };\n\n    var unloadAll = function (urls) {\n      each(urls, function (url) {\n        unload(url);\n      });\n    };\n\n    return {\n      load: load,\n      loadAll: loadAll,\n      unload: unload,\n      unloadAll: unloadAll,\n      _setReferrerPolicy: _setReferrerPolicy\n    };\n  }\n\n  var create$1 = function () {\n    var map = new WeakMap();\n\n    var forElement = function (referenceElement, settings) {\n      var root = getRootNode(referenceElement);\n      var rootDom = root.dom;\n      return Optional.from(map.get(rootDom)).getOrThunk(function () {\n        var sl = StyleSheetLoader(rootDom, settings);\n        map.set(rootDom, sl);\n        return sl;\n      });\n    };\n\n    return {\n      forElement: forElement\n    };\n  };\n\n  var instance = create$1();\n\n  var DomTreeWalker = function () {\n    function DomTreeWalker(startNode, rootNode) {\n      this.node = startNode;\n      this.rootNode = rootNode;\n      this.current = this.current.bind(this);\n      this.next = this.next.bind(this);\n      this.prev = this.prev.bind(this);\n      this.prev2 = this.prev2.bind(this);\n    }\n\n    DomTreeWalker.prototype.current = function () {\n      return this.node;\n    };\n\n    DomTreeWalker.prototype.next = function (shallow) {\n      this.node = this.findSibling(this.node, 'firstChild', 'nextSibling', shallow);\n      return this.node;\n    };\n\n    DomTreeWalker.prototype.prev = function (shallow) {\n      this.node = this.findSibling(this.node, 'lastChild', 'previousSibling', shallow);\n      return this.node;\n    };\n\n    DomTreeWalker.prototype.prev2 = function (shallow) {\n      this.node = this.findPreviousNode(this.node, 'lastChild', 'previousSibling', shallow);\n      return this.node;\n    };\n\n    DomTreeWalker.prototype.findSibling = function (node, startName, siblingName, shallow) {\n      var sibling, parent;\n\n      if (node) {\n        if (!shallow && node[startName]) {\n          return node[startName];\n        }\n\n        if (node !== this.rootNode) {\n          sibling = node[siblingName];\n\n          if (sibling) {\n            return sibling;\n          }\n\n          for (parent = node.parentNode; parent && parent !== this.rootNode; parent = parent.parentNode) {\n            sibling = parent[siblingName];\n\n            if (sibling) {\n              return sibling;\n            }\n          }\n        }\n      }\n    };\n\n    DomTreeWalker.prototype.findPreviousNode = function (node, startName, siblingName, shallow) {\n      var sibling, parent, child;\n\n      if (node) {\n        sibling = node[siblingName];\n\n        if (this.rootNode && sibling === this.rootNode) {\n          return;\n        }\n\n        if (sibling) {\n          if (!shallow) {\n            for (child = sibling[startName]; child; child = child[startName]) {\n              if (!child[startName]) {\n                return child;\n              }\n            }\n          }\n\n          return sibling;\n        }\n\n        parent = node.parentNode;\n\n        if (parent && parent !== this.rootNode) {\n          return parent;\n        }\n      }\n    };\n\n    return DomTreeWalker;\n  }();\n\n  var blocks = ['article', 'aside', 'details', 'div', 'dt', 'figcaption', 'footer', 'form', 'fieldset', 'header', 'hgroup', 'html', 'main', 'nav', 'section', 'summary', 'body', 'p', 'dl', 'multicol', 'dd', 'figure', 'address', 'center', 'blockquote', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'listing', 'xmp', 'pre', 'plaintext', 'menu', 'dir', 'ul', 'ol', 'li', 'hr', 'table', 'tbody', 'thead', 'tfoot', 'th', 'tr', 'td', 'caption'];\n  var tableCells = ['td', 'th'];\n  var tableSections = ['thead', 'tbody', 'tfoot'];\n  var textBlocks = ['h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'p', 'div', 'address', 'pre', 'form', 'blockquote', 'center', 'dir', 'fieldset', 'header', 'footer', 'article', 'section', 'hgroup', 'aside', 'nav', 'figure'];\n  var headings = ['h1', 'h2', 'h3', 'h4', 'h5', 'h6'];\n  var listItems = ['li', 'dd', 'dt'];\n  var lists = ['ul', 'ol', 'dl'];\n  var wsElements = ['pre', 'script', 'textarea', 'style'];\n\n  var lazyLookup = function (items) {\n    var lookup;\n    return function (node) {\n      lookup = lookup ? lookup : mapToObject(items, always);\n      return lookup.hasOwnProperty(name(node));\n    };\n  };\n\n  var isHeading = lazyLookup(headings);\n  var isBlock = lazyLookup(blocks);\n\n  var isTable$1 = function (node) {\n    return name(node) === 'table';\n  };\n\n  var isInline = function (node) {\n    return isElement(node) && !isBlock(node);\n  };\n\n  var isBr$1 = function (node) {\n    return isElement(node) && name(node) === 'br';\n  };\n\n  var isTextBlock = lazyLookup(textBlocks);\n  var isList = lazyLookup(lists);\n  var isListItem = lazyLookup(listItems);\n  var isTableSection = lazyLookup(tableSections);\n  var isTableCell$1 = lazyLookup(tableCells);\n  var isWsPreserveElement = lazyLookup(wsElements);\n\n  var ancestor$2 = function (scope, selector, isRoot) {\n    return ancestor$1(scope, selector, isRoot).isSome();\n  };\n\n  var zeroWidth = '\\uFEFF';\n  var nbsp = '\\xA0';\n\n  var isZwsp = function (char) {\n    return char === zeroWidth;\n  };\n\n  var removeZwsp = function (s) {\n    return s.replace(/\\uFEFF/g, '');\n  };\n\n  var ZWSP = zeroWidth;\n  var isZwsp$1 = isZwsp;\n  var trim$2 = removeZwsp;\n  var isElement$2 = isElement$1;\n  var isText$2 = isText$1;\n\n  var isCaretContainerBlock = function (node) {\n    if (isText$2(node)) {\n      node = node.parentNode;\n    }\n\n    return isElement$2(node) && node.hasAttribute('data-mce-caret');\n  };\n\n  var isCaretContainerInline = function (node) {\n    return isText$2(node) && isZwsp$1(node.data);\n  };\n\n  var isCaretContainer = function (node) {\n    return isCaretContainerBlock(node) || isCaretContainerInline(node);\n  };\n\n  var hasContent = function (node) {\n    return node.firstChild !== node.lastChild || !isBr(node.firstChild);\n  };\n\n  var insertInline = function (node, before) {\n    var sibling;\n    var doc = node.ownerDocument;\n    var textNode = doc.createTextNode(ZWSP);\n    var parentNode = node.parentNode;\n\n    if (!before) {\n      sibling = node.nextSibling;\n\n      if (isText$2(sibling)) {\n        if (isCaretContainer(sibling)) {\n          return sibling;\n        }\n\n        if (startsWithCaretContainer(sibling)) {\n          sibling.splitText(1);\n          return sibling;\n        }\n      }\n\n      if (node.nextSibling) {\n        parentNode.insertBefore(textNode, node.nextSibling);\n      } else {\n        parentNode.appendChild(textNode);\n      }\n    } else {\n      sibling = node.previousSibling;\n\n      if (isText$2(sibling)) {\n        if (isCaretContainer(sibling)) {\n          return sibling;\n        }\n\n        if (endsWithCaretContainer(sibling)) {\n          return sibling.splitText(sibling.data.length - 1);\n        }\n      }\n\n      parentNode.insertBefore(textNode, node);\n    }\n\n    return textNode;\n  };\n\n  var isBeforeInline = function (pos) {\n    var container = pos.container();\n\n    if (!isText$1(container)) {\n      return false;\n    }\n\n    return container.data.charAt(pos.offset()) === ZWSP || pos.isAtStart() && isCaretContainerInline(container.previousSibling);\n  };\n\n  var isAfterInline = function (pos) {\n    var container = pos.container();\n\n    if (!isText$1(container)) {\n      return false;\n    }\n\n    return container.data.charAt(pos.offset() - 1) === ZWSP || pos.isAtEnd() && isCaretContainerInline(container.nextSibling);\n  };\n\n  var createBogusBr = function () {\n    var br = document.createElement('br');\n    br.setAttribute('data-mce-bogus', '1');\n    return br;\n  };\n\n  var insertBlock = function (blockName, node, before) {\n    var doc = node.ownerDocument;\n    var blockNode = doc.createElement(blockName);\n    blockNode.setAttribute('data-mce-caret', before ? 'before' : 'after');\n    blockNode.setAttribute('data-mce-bogus', 'all');\n    blockNode.appendChild(createBogusBr());\n    var parentNode = node.parentNode;\n\n    if (!before) {\n      if (node.nextSibling) {\n        parentNode.insertBefore(blockNode, node.nextSibling);\n      } else {\n        parentNode.appendChild(blockNode);\n      }\n    } else {\n      parentNode.insertBefore(blockNode, node);\n    }\n\n    return blockNode;\n  };\n\n  var startsWithCaretContainer = function (node) {\n    return isText$2(node) && node.data[0] === ZWSP;\n  };\n\n  var endsWithCaretContainer = function (node) {\n    return isText$2(node) && node.data[node.data.length - 1] === ZWSP;\n  };\n\n  var trimBogusBr = function (elm) {\n    var brs = elm.getElementsByTagName('br');\n    var lastBr = brs[brs.length - 1];\n\n    if (isBogus(lastBr)) {\n      lastBr.parentNode.removeChild(lastBr);\n    }\n  };\n\n  var showCaretContainerBlock = function (caretContainer) {\n    if (caretContainer && caretContainer.hasAttribute('data-mce-caret')) {\n      trimBogusBr(caretContainer);\n      caretContainer.removeAttribute('data-mce-caret');\n      caretContainer.removeAttribute('data-mce-bogus');\n      caretContainer.removeAttribute('style');\n      caretContainer.removeAttribute('_moz_abspos');\n      return caretContainer;\n    }\n\n    return null;\n  };\n\n  var isRangeInCaretContainerBlock = function (range) {\n    return isCaretContainerBlock(range.startContainer);\n  };\n\n  var isContentEditableTrue$1 = isContentEditableTrue;\n  var isContentEditableFalse$1 = isContentEditableFalse;\n  var isBr$2 = isBr;\n  var isText$3 = isText$1;\n  var isInvalidTextElement = matchNodeNames(['script', 'style', 'textarea']);\n  var isAtomicInline = matchNodeNames(['img', 'input', 'textarea', 'hr', 'iframe', 'video', 'audio', 'object', 'embed']);\n  var isTable$2 = matchNodeNames(['table']);\n  var isCaretContainer$1 = isCaretContainer;\n\n  var isCaretCandidate = function (node) {\n    if (isCaretContainer$1(node)) {\n      return false;\n    }\n\n    if (isText$3(node)) {\n      return !isInvalidTextElement(node.parentNode);\n    }\n\n    return isAtomicInline(node) || isBr$2(node) || isTable$2(node) || isNonUiContentEditableFalse(node);\n  };\n\n  var isUnselectable = function (node) {\n    return isElement$1(node) && node.getAttribute('unselectable') === 'true';\n  };\n\n  var isNonUiContentEditableFalse = function (node) {\n    return isUnselectable(node) === false && isContentEditableFalse$1(node);\n  };\n\n  var isInEditable = function (node, root) {\n    for (node = node.parentNode; node && node !== root; node = node.parentNode) {\n      if (isNonUiContentEditableFalse(node)) {\n        return false;\n      }\n\n      if (isContentEditableTrue$1(node)) {\n        return true;\n      }\n    }\n\n    return true;\n  };\n\n  var isAtomicContentEditableFalse = function (node) {\n    if (!isNonUiContentEditableFalse(node)) {\n      return false;\n    }\n\n    return foldl(from$1(node.getElementsByTagName('*')), function (result, elm) {\n      return result || isContentEditableTrue$1(elm);\n    }, false) !== true;\n  };\n\n  var isAtomic = function (node) {\n    return isAtomicInline(node) || isAtomicContentEditableFalse(node);\n  };\n\n  var isEditableCaretCandidate = function (node, root) {\n    return isCaretCandidate(node) && isInEditable(node, root);\n  };\n\n  var whiteSpaceRegExp$1 = /^[ \\t\\r\\n]*$/;\n\n  var isWhitespaceText = function (text) {\n    return whiteSpaceRegExp$1.test(text);\n  };\n\n  var hasWhitespacePreserveParent = function (node, rootNode) {\n    var rootElement = SugarElement.fromDom(rootNode);\n    var startNode = SugarElement.fromDom(node);\n    return ancestor$2(startNode, 'pre,code', curry(eq$2, rootElement));\n  };\n\n  var isWhitespace = function (node, rootNode) {\n    return isText$1(node) && isWhitespaceText(node.data) && hasWhitespacePreserveParent(node, rootNode) === false;\n  };\n\n  var isNamedAnchor = function (node) {\n    return isElement$1(node) && node.nodeName === 'A' && !node.hasAttribute('href') && (node.hasAttribute('name') || node.hasAttribute('id'));\n  };\n\n  var isContent = function (node, rootNode) {\n    return isCaretCandidate(node) && isWhitespace(node, rootNode) === false || isNamedAnchor(node) || isBookmark(node);\n  };\n\n  var isBookmark = hasAttribute('data-mce-bookmark');\n  var isBogus$1 = hasAttribute('data-mce-bogus');\n  var isBogusAll$1 = hasAttributeValue('data-mce-bogus', 'all');\n\n  var isEmptyNode = function (targetNode, skipBogus) {\n    var node,\n        brCount = 0;\n\n    if (isContent(targetNode, targetNode)) {\n      return false;\n    } else {\n      node = targetNode.firstChild;\n\n      if (!node) {\n        return true;\n      }\n\n      var walker = new DomTreeWalker(node, targetNode);\n\n      do {\n        if (skipBogus) {\n          if (isBogusAll$1(node)) {\n            node = walker.next(true);\n            continue;\n          }\n\n          if (isBogus$1(node)) {\n            node = walker.next();\n            continue;\n          }\n        }\n\n        if (isBr(node)) {\n          brCount++;\n          node = walker.next();\n          continue;\n        }\n\n        if (isContent(node, targetNode)) {\n          return false;\n        }\n\n        node = walker.next();\n      } while (node);\n\n      return brCount <= 1;\n    }\n  };\n\n  var isEmpty = function (elm, skipBogus) {\n    if (skipBogus === void 0) {\n      skipBogus = true;\n    }\n\n    return isEmptyNode(elm.dom, skipBogus);\n  };\n\n  var isSpan = function (node) {\n    return node.nodeName.toLowerCase() === 'span';\n  };\n\n  var isInlineContent = function (node, root) {\n    return isNonNullable(node) && (isContent(node, root) || isInline(SugarElement.fromDom(node)));\n  };\n\n  var surroundedByInlineContent = function (node, root) {\n    var prev = new DomTreeWalker(node, root).prev(false);\n    var next = new DomTreeWalker(node, root).next(false);\n    var prevIsInline = isUndefined(prev) || isInlineContent(prev, root);\n    var nextIsInline = isUndefined(next) || isInlineContent(next, root);\n    return prevIsInline && nextIsInline;\n  };\n\n  var isBookmarkNode = function (node) {\n    return isSpan(node) && node.getAttribute('data-mce-type') === 'bookmark';\n  };\n\n  var isKeepTextNode = function (node, root) {\n    return isText$1(node) && node.data.length > 0 && surroundedByInlineContent(node, root);\n  };\n\n  var isKeepElement = function (node) {\n    return isElement$1(node) ? node.childNodes.length > 0 : false;\n  };\n\n  var isDocument$2 = function (node) {\n    return isDocumentFragment$1(node) || isDocument$1(node);\n  };\n\n  var trimNode = function (dom, node, root) {\n    var rootNode = root || node;\n\n    if (isElement$1(node) && isBookmarkNode(node)) {\n      return node;\n    }\n\n    var children = node.childNodes;\n\n    for (var i = children.length - 1; i >= 0; i--) {\n      trimNode(dom, children[i], rootNode);\n    }\n\n    if (isElement$1(node)) {\n      var currentChildren = node.childNodes;\n\n      if (currentChildren.length === 1 && isBookmarkNode(currentChildren[0])) {\n        node.parentNode.insertBefore(currentChildren[0], node);\n      }\n    }\n\n    if (!isDocument$2(node) && !isContent(node, rootNode) && !isKeepElement(node) && !isKeepTextNode(node, rootNode)) {\n      dom.remove(node);\n    }\n\n    return node;\n  };\n\n  var makeMap$1 = Tools.makeMap;\n  var attrsCharsRegExp = /[&<>\\\"\\u0060\\u007E-\\uD7FF\\uE000-\\uFFEF]|[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]/g;\n  var textCharsRegExp = /[<>&\\u007E-\\uD7FF\\uE000-\\uFFEF]|[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]/g;\n  var rawCharsRegExp = /[<>&\\\"\\']/g;\n  var entityRegExp = /&#([a-z0-9]+);?|&([a-z0-9]+);/gi;\n  var asciiMap = {\n    128: '\\u20AC',\n    130: '\\u201A',\n    131: '\\u0192',\n    132: '\\u201E',\n    133: '\\u2026',\n    134: '\\u2020',\n    135: '\\u2021',\n    136: '\\u02c6',\n    137: '\\u2030',\n    138: '\\u0160',\n    139: '\\u2039',\n    140: '\\u0152',\n    142: '\\u017d',\n    145: '\\u2018',\n    146: '\\u2019',\n    147: '\\u201C',\n    148: '\\u201D',\n    149: '\\u2022',\n    150: '\\u2013',\n    151: '\\u2014',\n    152: '\\u02DC',\n    153: '\\u2122',\n    154: '\\u0161',\n    155: '\\u203A',\n    156: '\\u0153',\n    158: '\\u017e',\n    159: '\\u0178'\n  };\n  var baseEntities = {\n    '\"': '&quot;',\n    '\\'': '&#39;',\n    '<': '&lt;',\n    '>': '&gt;',\n    '&': '&amp;',\n    '`': '&#96;'\n  };\n  var reverseEntities = {\n    '&lt;': '<',\n    '&gt;': '>',\n    '&amp;': '&',\n    '&quot;': '\"',\n    '&apos;': '\\''\n  };\n\n  var nativeDecode = function (text) {\n    var elm = SugarElement.fromTag('div').dom;\n    elm.innerHTML = text;\n    return elm.textContent || elm.innerText || text;\n  };\n\n  var buildEntitiesLookup = function (items, radix) {\n    var i, chr, entity;\n    var lookup = {};\n\n    if (items) {\n      items = items.split(',');\n      radix = radix || 10;\n\n      for (i = 0; i < items.length; i += 2) {\n        chr = String.fromCharCode(parseInt(items[i], radix));\n\n        if (!baseEntities[chr]) {\n          entity = '&' + items[i + 1] + ';';\n          lookup[chr] = entity;\n          lookup[entity] = chr;\n        }\n      }\n\n      return lookup;\n    }\n  };\n\n  var namedEntities = buildEntitiesLookup('50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,' + '5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,' + '5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,' + '5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,' + '68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,' + '6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,' + '6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,' + '75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,' + '7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,' + '7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,' + 'sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,' + 'st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,' + 't9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,' + 'tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,' + 'u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,' + '81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,' + '8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,' + '8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,' + '8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,' + '8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,' + 'nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,' + 'rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,' + 'Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,' + '80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,' + '811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro', 32);\n\n  var encodeRaw = function (text, attr) {\n    return text.replace(attr ? attrsCharsRegExp : textCharsRegExp, function (chr) {\n      return baseEntities[chr] || chr;\n    });\n  };\n\n  var encodeAllRaw = function (text) {\n    return ('' + text).replace(rawCharsRegExp, function (chr) {\n      return baseEntities[chr] || chr;\n    });\n  };\n\n  var encodeNumeric = function (text, attr) {\n    return text.replace(attr ? attrsCharsRegExp : textCharsRegExp, function (chr) {\n      if (chr.length > 1) {\n        return '&#' + ((chr.charCodeAt(0) - 55296) * 1024 + (chr.charCodeAt(1) - 56320) + 65536) + ';';\n      }\n\n      return baseEntities[chr] || '&#' + chr.charCodeAt(0) + ';';\n    });\n  };\n\n  var encodeNamed = function (text, attr, entities) {\n    entities = entities || namedEntities;\n    return text.replace(attr ? attrsCharsRegExp : textCharsRegExp, function (chr) {\n      return baseEntities[chr] || entities[chr] || chr;\n    });\n  };\n\n  var getEncodeFunc = function (name, entities) {\n    var entitiesMap = buildEntitiesLookup(entities) || namedEntities;\n\n    var encodeNamedAndNumeric = function (text, attr) {\n      return text.replace(attr ? attrsCharsRegExp : textCharsRegExp, function (chr) {\n        if (baseEntities[chr] !== undefined) {\n          return baseEntities[chr];\n        }\n\n        if (entitiesMap[chr] !== undefined) {\n          return entitiesMap[chr];\n        }\n\n        if (chr.length > 1) {\n          return '&#' + ((chr.charCodeAt(0) - 55296) * 1024 + (chr.charCodeAt(1) - 56320) + 65536) + ';';\n        }\n\n        return '&#' + chr.charCodeAt(0) + ';';\n      });\n    };\n\n    var encodeCustomNamed = function (text, attr) {\n      return encodeNamed(text, attr, entitiesMap);\n    };\n\n    var nameMap = makeMap$1(name.replace(/\\+/g, ','));\n\n    if (nameMap.named && nameMap.numeric) {\n      return encodeNamedAndNumeric;\n    }\n\n    if (nameMap.named) {\n      if (entities) {\n        return encodeCustomNamed;\n      }\n\n      return encodeNamed;\n    }\n\n    if (nameMap.numeric) {\n      return encodeNumeric;\n    }\n\n    return encodeRaw;\n  };\n\n  var decode = function (text) {\n    return text.replace(entityRegExp, function (all, numeric) {\n      if (numeric) {\n        if (numeric.charAt(0).toLowerCase() === 'x') {\n          numeric = parseInt(numeric.substr(1), 16);\n        } else {\n          numeric = parseInt(numeric, 10);\n        }\n\n        if (numeric > 65535) {\n          numeric -= 65536;\n          return String.fromCharCode(55296 + (numeric >> 10), 56320 + (numeric & 1023));\n        }\n\n        return asciiMap[numeric] || String.fromCharCode(numeric);\n      }\n\n      return reverseEntities[all] || namedEntities[all] || nativeDecode(all);\n    });\n  };\n\n  var Entities = {\n    encodeRaw: encodeRaw,\n    encodeAllRaw: encodeAllRaw,\n    encodeNumeric: encodeNumeric,\n    encodeNamed: encodeNamed,\n    getEncodeFunc: getEncodeFunc,\n    decode: decode\n  };\n  var mapCache = {},\n      dummyObj = {};\n  var makeMap$2 = Tools.makeMap,\n      each$3 = Tools.each,\n      extend$1 = Tools.extend,\n      explode$1 = Tools.explode,\n      inArray = Tools.inArray;\n\n  var split = function (items, delim) {\n    items = Tools.trim(items);\n    return items ? items.split(delim || ' ') : [];\n  };\n\n  var compileSchema = function (type) {\n    var schema = {};\n    var globalAttributes, blockContent;\n    var phrasingContent, flowContent, html4BlockContent, html4PhrasingContent;\n\n    var add = function (name, attributes, children) {\n      var ni, attributesOrder, element;\n\n      var arrayToMap = function (array, obj) {\n        var map = {};\n        var i, l;\n\n        for (i = 0, l = array.length; i < l; i++) {\n          map[array[i]] = obj || {};\n        }\n\n        return map;\n      };\n\n      children = children || [];\n      attributes = attributes || '';\n\n      if (typeof children === 'string') {\n        children = split(children);\n      }\n\n      var names = split(name);\n      ni = names.length;\n\n      while (ni--) {\n        attributesOrder = split([globalAttributes, attributes].join(' '));\n        element = {\n          attributes: arrayToMap(attributesOrder),\n          attributesOrder: attributesOrder,\n          children: arrayToMap(children, dummyObj)\n        };\n        schema[names[ni]] = element;\n      }\n    };\n\n    var addAttrs = function (name, attributes) {\n      var ni, schemaItem, i, l;\n      var names = split(name);\n      ni = names.length;\n      var attrs = split(attributes);\n\n      while (ni--) {\n        schemaItem = schema[names[ni]];\n\n        for (i = 0, l = attrs.length; i < l; i++) {\n          schemaItem.attributes[attrs[i]] = {};\n          schemaItem.attributesOrder.push(attrs[i]);\n        }\n      }\n    };\n\n    if (mapCache[type]) {\n      return mapCache[type];\n    }\n\n    globalAttributes = 'id accesskey class dir lang style tabindex title role';\n    blockContent = 'address blockquote div dl fieldset form h1 h2 h3 h4 h5 h6 hr menu ol p pre table ul';\n    phrasingContent = 'a abbr b bdo br button cite code del dfn em embed i iframe img input ins kbd ' + 'label map noscript object q s samp script select small span strong sub sup ' + 'textarea u var #text #comment';\n\n    if (type !== 'html4') {\n      globalAttributes += ' contenteditable contextmenu draggable dropzone ' + 'hidden spellcheck translate';\n      blockContent += ' article aside details dialog figure main header footer hgroup section nav';\n      phrasingContent += ' audio canvas command datalist mark meter output picture ' + 'progress time wbr video ruby bdi keygen';\n    }\n\n    if (type !== 'html5-strict') {\n      globalAttributes += ' xml:lang';\n      html4PhrasingContent = 'acronym applet basefont big font strike tt';\n      phrasingContent = [phrasingContent, html4PhrasingContent].join(' ');\n      each$3(split(html4PhrasingContent), function (name) {\n        add(name, '', phrasingContent);\n      });\n      html4BlockContent = 'center dir isindex noframes';\n      blockContent = [blockContent, html4BlockContent].join(' ');\n      flowContent = [blockContent, phrasingContent].join(' ');\n      each$3(split(html4BlockContent), function (name) {\n        add(name, '', flowContent);\n      });\n    }\n\n    flowContent = flowContent || [blockContent, phrasingContent].join(' ');\n    add('html', 'manifest', 'head body');\n    add('head', '', 'base command link meta noscript script style title');\n    add('title hr noscript br');\n    add('base', 'href target');\n    add('link', 'href rel media hreflang type sizes hreflang');\n    add('meta', 'name http-equiv content charset');\n    add('style', 'media type scoped');\n    add('script', 'src async defer type charset');\n    add('body', 'onafterprint onbeforeprint onbeforeunload onblur onerror onfocus ' + 'onhashchange onload onmessage onoffline ononline onpagehide onpageshow ' + 'onpopstate onresize onscroll onstorage onunload', flowContent);\n    add('address dt dd div caption', '', flowContent);\n    add('h1 h2 h3 h4 h5 h6 pre p abbr code var samp kbd sub sup i b u bdo span legend em strong small s cite dfn', '', phrasingContent);\n    add('blockquote', 'cite', flowContent);\n    add('ol', 'reversed start type', 'li');\n    add('ul', '', 'li');\n    add('li', 'value', flowContent);\n    add('dl', '', 'dt dd');\n    add('a', 'href target rel media hreflang type', phrasingContent);\n    add('q', 'cite', phrasingContent);\n    add('ins del', 'cite datetime', flowContent);\n    add('img', 'src sizes srcset alt usemap ismap width height');\n    add('iframe', 'src name width height', flowContent);\n    add('embed', 'src type width height');\n    add('object', 'data type typemustmatch name usemap form width height', [flowContent, 'param'].join(' '));\n    add('param', 'name value');\n    add('map', 'name', [flowContent, 'area'].join(' '));\n    add('area', 'alt coords shape href target rel media hreflang type');\n    add('table', 'border', 'caption colgroup thead tfoot tbody tr' + (type === 'html4' ? ' col' : ''));\n    add('colgroup', 'span', 'col');\n    add('col', 'span');\n    add('tbody thead tfoot', '', 'tr');\n    add('tr', '', 'td th');\n    add('td', 'colspan rowspan headers', flowContent);\n    add('th', 'colspan rowspan headers scope abbr', flowContent);\n    add('form', 'accept-charset action autocomplete enctype method name novalidate target', flowContent);\n    add('fieldset', 'disabled form name', [flowContent, 'legend'].join(' '));\n    add('label', 'form for', phrasingContent);\n    add('input', 'accept alt autocomplete checked dirname disabled form formaction formenctype formmethod formnovalidate ' + 'formtarget height list max maxlength min multiple name pattern readonly required size src step type value width');\n    add('button', 'disabled form formaction formenctype formmethod formnovalidate formtarget name type value', type === 'html4' ? flowContent : phrasingContent);\n    add('select', 'disabled form multiple name required size', 'option optgroup');\n    add('optgroup', 'disabled label', 'option');\n    add('option', 'disabled label selected value');\n    add('textarea', 'cols dirname disabled form maxlength name readonly required rows wrap');\n    add('menu', 'type label', [flowContent, 'li'].join(' '));\n    add('noscript', '', flowContent);\n\n    if (type !== 'html4') {\n      add('wbr');\n      add('ruby', '', [phrasingContent, 'rt rp'].join(' '));\n      add('figcaption', '', flowContent);\n      add('mark rt rp summary bdi', '', phrasingContent);\n      add('canvas', 'width height', flowContent);\n      add('video', 'src crossorigin poster preload autoplay mediagroup loop ' + 'muted controls width height buffered', [flowContent, 'track source'].join(' '));\n      add('audio', 'src crossorigin preload autoplay mediagroup loop muted controls ' + 'buffered volume', [flowContent, 'track source'].join(' '));\n      add('picture', '', 'img source');\n      add('source', 'src srcset type media sizes');\n      add('track', 'kind src srclang label default');\n      add('datalist', '', [phrasingContent, 'option'].join(' '));\n      add('article section nav aside main header footer', '', flowContent);\n      add('hgroup', '', 'h1 h2 h3 h4 h5 h6');\n      add('figure', '', [flowContent, 'figcaption'].join(' '));\n      add('time', 'datetime', phrasingContent);\n      add('dialog', 'open', flowContent);\n      add('command', 'type label icon disabled checked radiogroup command');\n      add('output', 'for form name', phrasingContent);\n      add('progress', 'value max', phrasingContent);\n      add('meter', 'value min max low high optimum', phrasingContent);\n      add('details', 'open', [flowContent, 'summary'].join(' '));\n      add('keygen', 'autofocus challenge disabled form keytype name');\n    }\n\n    if (type !== 'html5-strict') {\n      addAttrs('script', 'language xml:space');\n      addAttrs('style', 'xml:space');\n      addAttrs('object', 'declare classid code codebase codetype archive standby align border hspace vspace');\n      addAttrs('embed', 'align name hspace vspace');\n      addAttrs('param', 'valuetype type');\n      addAttrs('a', 'charset name rev shape coords');\n      addAttrs('br', 'clear');\n      addAttrs('applet', 'codebase archive code object alt name width height align hspace vspace');\n      addAttrs('img', 'name longdesc align border hspace vspace');\n      addAttrs('iframe', 'longdesc frameborder marginwidth marginheight scrolling align');\n      addAttrs('font basefont', 'size color face');\n      addAttrs('input', 'usemap align');\n      addAttrs('select');\n      addAttrs('textarea');\n      addAttrs('h1 h2 h3 h4 h5 h6 div p legend caption', 'align');\n      addAttrs('ul', 'type compact');\n      addAttrs('li', 'type');\n      addAttrs('ol dl menu dir', 'compact');\n      addAttrs('pre', 'width xml:space');\n      addAttrs('hr', 'align noshade size width');\n      addAttrs('isindex', 'prompt');\n      addAttrs('table', 'summary width frame rules cellspacing cellpadding align bgcolor');\n      addAttrs('col', 'width align char charoff valign');\n      addAttrs('colgroup', 'width align char charoff valign');\n      addAttrs('thead', 'align char charoff valign');\n      addAttrs('tr', 'align char charoff valign bgcolor');\n      addAttrs('th', 'axis align char charoff valign nowrap bgcolor width height');\n      addAttrs('form', 'accept');\n      addAttrs('td', 'abbr axis scope align char charoff valign nowrap bgcolor width height');\n      addAttrs('tfoot', 'align char charoff valign');\n      addAttrs('tbody', 'align char charoff valign');\n      addAttrs('area', 'nohref');\n      addAttrs('body', 'background bgcolor text link vlink alink');\n    }\n\n    if (type !== 'html4') {\n      addAttrs('input button select textarea', 'autofocus');\n      addAttrs('input textarea', 'placeholder');\n      addAttrs('a', 'download');\n      addAttrs('link script img', 'crossorigin');\n      addAttrs('img', 'loading');\n      addAttrs('iframe', 'sandbox seamless allowfullscreen loading');\n    }\n\n    each$3(split('a form meter progress dfn'), function (name) {\n      if (schema[name]) {\n        delete schema[name].children[name];\n      }\n    });\n    delete schema.caption.children.table;\n    delete schema.script;\n    mapCache[type] = schema;\n    return schema;\n  };\n\n  var compileElementMap = function (value, mode) {\n    var styles;\n\n    if (value) {\n      styles = {};\n\n      if (typeof value === 'string') {\n        value = {\n          '*': value\n        };\n      }\n\n      each$3(value, function (value, key) {\n        styles[key] = styles[key.toUpperCase()] = mode === 'map' ? makeMap$2(value, /[, ]/) : explode$1(value, /[, ]/);\n      });\n    }\n\n    return styles;\n  };\n\n  function Schema(settings) {\n    var elements = {};\n    var children = {};\n    var patternElements = [];\n    var customElementsMap = {},\n        specialElements = {};\n\n    var createLookupTable = function (option, defaultValue, extendWith) {\n      var value = settings[option];\n\n      if (!value) {\n        value = mapCache[option];\n\n        if (!value) {\n          value = makeMap$2(defaultValue, ' ', makeMap$2(defaultValue.toUpperCase(), ' '));\n          value = extend$1(value, extendWith);\n          mapCache[option] = value;\n        }\n      } else {\n        value = makeMap$2(value, /[, ]/, makeMap$2(value.toUpperCase(), /[, ]/));\n      }\n\n      return value;\n    };\n\n    settings = settings || {};\n    var schemaItems = compileSchema(settings.schema);\n\n    if (settings.verify_html === false) {\n      settings.valid_elements = '*[*]';\n    }\n\n    var validStyles = compileElementMap(settings.valid_styles);\n    var invalidStyles = compileElementMap(settings.invalid_styles, 'map');\n    var validClasses = compileElementMap(settings.valid_classes, 'map');\n    var whiteSpaceElementsMap = createLookupTable('whitespace_elements', 'pre script noscript style textarea video audio iframe object code');\n    var selfClosingElementsMap = createLookupTable('self_closing_elements', 'colgroup dd dt li option p td tfoot th thead tr');\n    var shortEndedElementsMap = createLookupTable('short_ended_elements', 'area base basefont br col frame hr img input isindex link ' + 'meta param embed source wbr track');\n    var boolAttrMap = createLookupTable('boolean_attributes', 'checked compact declare defer disabled ismap multiple nohref noresize ' + 'noshade nowrap readonly selected autoplay loop controls');\n    var nonEmptyOrMoveCaretBeforeOnEnter = 'td th iframe video audio object script code';\n    var nonEmptyElementsMap = createLookupTable('non_empty_elements', nonEmptyOrMoveCaretBeforeOnEnter + ' pre', shortEndedElementsMap);\n    var moveCaretBeforeOnEnterElementsMap = createLookupTable('move_caret_before_on_enter_elements', nonEmptyOrMoveCaretBeforeOnEnter + ' table', shortEndedElementsMap);\n    var textBlockElementsMap = createLookupTable('text_block_elements', 'h1 h2 h3 h4 h5 h6 p div address pre form ' + 'blockquote center dir fieldset header footer article section hgroup aside main nav figure');\n    var blockElementsMap = createLookupTable('block_elements', 'hr table tbody thead tfoot ' + 'th tr td li ol ul caption dl dt dd noscript menu isindex option ' + 'datalist select optgroup figcaption details summary', textBlockElementsMap);\n    var textInlineElementsMap = createLookupTable('text_inline_elements', 'span strong b em i font strike u var cite ' + 'dfn code mark q sup sub samp');\n    each$3((settings.special || 'script noscript iframe noframes noembed title style textarea xmp').split(' '), function (name) {\n      specialElements[name] = new RegExp('</' + name + '[^>]*>', 'gi');\n    });\n\n    var patternToRegExp = function (str) {\n      return new RegExp('^' + str.replace(/([?+*])/g, '.$1') + '$');\n    };\n\n    var addValidElements = function (validElements) {\n      var ei, el, ai, al, matches, element, attr, attrData, elementName, attrName, attrType, attributes, attributesOrder, prefix, outputName, globalAttributes, globalAttributesOrder, value;\n      var elementRuleRegExp = /^([#+\\-])?([^\\[!\\/]+)(?:\\/([^\\[!]+))?(?:(!?)\\[([^\\]]+)])?$/,\n          attrRuleRegExp = /^([!\\-])?(\\w+[\\\\:]:\\w+|[^=:<]+)?(?:([=:<])(.*))?$/,\n          hasPatternsRegExp = /[*?+]/;\n\n      if (validElements) {\n        var validElementsArr = split(validElements, ',');\n\n        if (elements['@']) {\n          globalAttributes = elements['@'].attributes;\n          globalAttributesOrder = elements['@'].attributesOrder;\n        }\n\n        for (ei = 0, el = validElementsArr.length; ei < el; ei++) {\n          matches = elementRuleRegExp.exec(validElementsArr[ei]);\n\n          if (matches) {\n            prefix = matches[1];\n            elementName = matches[2];\n            outputName = matches[3];\n            attrData = matches[5];\n            attributes = {};\n            attributesOrder = [];\n            element = {\n              attributes: attributes,\n              attributesOrder: attributesOrder\n            };\n\n            if (prefix === '#') {\n              element.paddEmpty = true;\n            }\n\n            if (prefix === '-') {\n              element.removeEmpty = true;\n            }\n\n            if (matches[4] === '!') {\n              element.removeEmptyAttrs = true;\n            }\n\n            if (globalAttributes) {\n              each$1(globalAttributes, function (value, key) {\n                attributes[key] = value;\n              });\n              attributesOrder.push.apply(attributesOrder, globalAttributesOrder);\n            }\n\n            if (attrData) {\n              attrData = split(attrData, '|');\n\n              for (ai = 0, al = attrData.length; ai < al; ai++) {\n                matches = attrRuleRegExp.exec(attrData[ai]);\n\n                if (matches) {\n                  attr = {};\n                  attrType = matches[1];\n                  attrName = matches[2].replace(/[\\\\:]:/g, ':');\n                  prefix = matches[3];\n                  value = matches[4];\n\n                  if (attrType === '!') {\n                    element.attributesRequired = element.attributesRequired || [];\n                    element.attributesRequired.push(attrName);\n                    attr.required = true;\n                  }\n\n                  if (attrType === '-') {\n                    delete attributes[attrName];\n                    attributesOrder.splice(inArray(attributesOrder, attrName), 1);\n                    continue;\n                  }\n\n                  if (prefix) {\n                    if (prefix === '=') {\n                      element.attributesDefault = element.attributesDefault || [];\n                      element.attributesDefault.push({\n                        name: attrName,\n                        value: value\n                      });\n                      attr.defaultValue = value;\n                    }\n\n                    if (prefix === ':') {\n                      element.attributesForced = element.attributesForced || [];\n                      element.attributesForced.push({\n                        name: attrName,\n                        value: value\n                      });\n                      attr.forcedValue = value;\n                    }\n\n                    if (prefix === '<') {\n                      attr.validValues = makeMap$2(value, '?');\n                    }\n                  }\n\n                  if (hasPatternsRegExp.test(attrName)) {\n                    element.attributePatterns = element.attributePatterns || [];\n                    attr.pattern = patternToRegExp(attrName);\n                    element.attributePatterns.push(attr);\n                  } else {\n                    if (!attributes[attrName]) {\n                      attributesOrder.push(attrName);\n                    }\n\n                    attributes[attrName] = attr;\n                  }\n                }\n              }\n            }\n\n            if (!globalAttributes && elementName === '@') {\n              globalAttributes = attributes;\n              globalAttributesOrder = attributesOrder;\n            }\n\n            if (outputName) {\n              element.outputName = elementName;\n              elements[outputName] = element;\n            }\n\n            if (hasPatternsRegExp.test(elementName)) {\n              element.pattern = patternToRegExp(elementName);\n              patternElements.push(element);\n            } else {\n              elements[elementName] = element;\n            }\n          }\n        }\n      }\n    };\n\n    var setValidElements = function (validElements) {\n      elements = {};\n      patternElements = [];\n      addValidElements(validElements);\n      each$3(schemaItems, function (element, name) {\n        children[name] = element.children;\n      });\n    };\n\n    var addCustomElements = function (customElements) {\n      var customElementRegExp = /^(~)?(.+)$/;\n\n      if (customElements) {\n        mapCache.text_block_elements = mapCache.block_elements = null;\n        each$3(split(customElements, ','), function (rule) {\n          var matches = customElementRegExp.exec(rule),\n              inline = matches[1] === '~',\n              cloneName = inline ? 'span' : 'div',\n              name = matches[2];\n          children[name] = children[cloneName];\n          customElementsMap[name] = cloneName;\n\n          if (!inline) {\n            blockElementsMap[name.toUpperCase()] = {};\n            blockElementsMap[name] = {};\n          }\n\n          if (!elements[name]) {\n            var customRule = elements[cloneName];\n            customRule = extend$1({}, customRule);\n            delete customRule.removeEmptyAttrs;\n            delete customRule.removeEmpty;\n            elements[name] = customRule;\n          }\n\n          each$3(children, function (element, elmName) {\n            if (element[cloneName]) {\n              children[elmName] = element = extend$1({}, children[elmName]);\n              element[name] = element[cloneName];\n            }\n          });\n        });\n      }\n    };\n\n    var addValidChildren = function (validChildren) {\n      var childRuleRegExp = /^([+\\-]?)([A-Za-z0-9_\\-.\\u00b7\\u00c0-\\u00d6\\u00d8-\\u00f6\\u00f8-\\u037d\\u037f-\\u1fff\\u200c-\\u200d\\u203f-\\u2040\\u2070-\\u218f\\u2c00-\\u2fef\\u3001-\\ud7ff\\uf900-\\ufdcf\\ufdf0-\\ufffd]+)\\[([^\\]]+)]$/;\n      mapCache[settings.schema] = null;\n\n      if (validChildren) {\n        each$3(split(validChildren, ','), function (rule) {\n          var matches = childRuleRegExp.exec(rule);\n          var parent, prefix;\n\n          if (matches) {\n            prefix = matches[1];\n\n            if (prefix) {\n              parent = children[matches[2]];\n            } else {\n              parent = children[matches[2]] = {\n                '#comment': {}\n              };\n            }\n\n            parent = children[matches[2]];\n            each$3(split(matches[3], '|'), function (child) {\n              if (prefix === '-') {\n                delete parent[child];\n              } else {\n                parent[child] = {};\n              }\n            });\n          }\n        });\n      }\n    };\n\n    var getElementRule = function (name) {\n      var element = elements[name],\n          i;\n\n      if (element) {\n        return element;\n      }\n\n      i = patternElements.length;\n\n      while (i--) {\n        element = patternElements[i];\n\n        if (element.pattern.test(name)) {\n          return element;\n        }\n      }\n    };\n\n    if (!settings.valid_elements) {\n      each$3(schemaItems, function (element, name) {\n        elements[name] = {\n          attributes: element.attributes,\n          attributesOrder: element.attributesOrder\n        };\n        children[name] = element.children;\n      });\n\n      if (settings.schema !== 'html5') {\n        each$3(split('strong/b em/i'), function (item) {\n          var items = split(item, '/');\n          elements[items[1]].outputName = items[0];\n        });\n      }\n\n      each$3(split('ol ul sub sup blockquote span font a table tbody tr strong em b i'), function (name) {\n        if (elements[name]) {\n          elements[name].removeEmpty = true;\n        }\n      });\n      each$3(split('p h1 h2 h3 h4 h5 h6 th td pre div address caption li'), function (name) {\n        elements[name].paddEmpty = true;\n      });\n      each$3(split('span'), function (name) {\n        elements[name].removeEmptyAttrs = true;\n      });\n    } else {\n      setValidElements(settings.valid_elements);\n    }\n\n    addCustomElements(settings.custom_elements);\n    addValidChildren(settings.valid_children);\n    addValidElements(settings.extended_valid_elements);\n    addValidChildren('+ol[ul|ol],+ul[ul|ol]');\n    each$3({\n      dd: 'dl',\n      dt: 'dl',\n      li: 'ul ol',\n      td: 'tr',\n      th: 'tr',\n      tr: 'tbody thead tfoot',\n      tbody: 'table',\n      thead: 'table',\n      tfoot: 'table',\n      legend: 'fieldset',\n      area: 'map',\n      param: 'video audio object'\n    }, function (parents, item) {\n      if (elements[item]) {\n        elements[item].parentsRequired = split(parents);\n      }\n    });\n\n    if (settings.invalid_elements) {\n      each$3(explode$1(settings.invalid_elements), function (item) {\n        if (elements[item]) {\n          delete elements[item];\n        }\n      });\n    }\n\n    if (!getElementRule('span')) {\n      addValidElements('span[!data-mce-type|*]');\n    }\n\n    var getValidStyles = function () {\n      return validStyles;\n    };\n\n    var getInvalidStyles = function () {\n      return invalidStyles;\n    };\n\n    var getValidClasses = function () {\n      return validClasses;\n    };\n\n    var getBoolAttrs = function () {\n      return boolAttrMap;\n    };\n\n    var getBlockElements = function () {\n      return blockElementsMap;\n    };\n\n    var getTextBlockElements = function () {\n      return textBlockElementsMap;\n    };\n\n    var getTextInlineElements = function () {\n      return textInlineElementsMap;\n    };\n\n    var getShortEndedElements = function () {\n      return shortEndedElementsMap;\n    };\n\n    var getSelfClosingElements = function () {\n      return selfClosingElementsMap;\n    };\n\n    var getNonEmptyElements = function () {\n      return nonEmptyElementsMap;\n    };\n\n    var getMoveCaretBeforeOnEnterElements = function () {\n      return moveCaretBeforeOnEnterElementsMap;\n    };\n\n    var getWhiteSpaceElements = function () {\n      return whiteSpaceElementsMap;\n    };\n\n    var getSpecialElements = function () {\n      return specialElements;\n    };\n\n    var isValidChild = function (name, child) {\n      var parent = children[name.toLowerCase()];\n      return !!(parent && parent[child.toLowerCase()]);\n    };\n\n    var isValid = function (name, attr) {\n      var attrPatterns, i;\n      var rule = getElementRule(name);\n\n      if (rule) {\n        if (attr) {\n          if (rule.attributes[attr]) {\n            return true;\n          }\n\n          attrPatterns = rule.attributePatterns;\n\n          if (attrPatterns) {\n            i = attrPatterns.length;\n\n            while (i--) {\n              if (attrPatterns[i].pattern.test(name)) {\n                return true;\n              }\n            }\n          }\n        } else {\n          return true;\n        }\n      }\n\n      return false;\n    };\n\n    var getCustomElements = function () {\n      return customElementsMap;\n    };\n\n    return {\n      children: children,\n      elements: elements,\n      getValidStyles: getValidStyles,\n      getValidClasses: getValidClasses,\n      getBlockElements: getBlockElements,\n      getInvalidStyles: getInvalidStyles,\n      getShortEndedElements: getShortEndedElements,\n      getTextBlockElements: getTextBlockElements,\n      getTextInlineElements: getTextInlineElements,\n      getBoolAttrs: getBoolAttrs,\n      getElementRule: getElementRule,\n      getSelfClosingElements: getSelfClosingElements,\n      getNonEmptyElements: getNonEmptyElements,\n      getMoveCaretBeforeOnEnterElements: getMoveCaretBeforeOnEnterElements,\n      getWhiteSpaceElements: getWhiteSpaceElements,\n      getSpecialElements: getSpecialElements,\n      isValidChild: isValidChild,\n      isValid: isValid,\n      getCustomElements: getCustomElements,\n      addValidElements: addValidElements,\n      setValidElements: setValidElements,\n      addCustomElements: addCustomElements,\n      addValidChildren: addValidChildren\n    };\n  }\n\n  var toHex = function (match, r, g, b) {\n    var hex = function (val) {\n      val = parseInt(val, 10).toString(16);\n      return val.length > 1 ? val : '0' + val;\n    };\n\n    return '#' + hex(r) + hex(g) + hex(b);\n  };\n\n  var Styles = function (settings, schema) {\n    var rgbRegExp = /rgb\\s*\\(\\s*([0-9]+)\\s*,\\s*([0-9]+)\\s*,\\s*([0-9]+)\\s*\\)/gi;\n    var urlOrStrRegExp = /(?:url(?:(?:\\(\\s*\\\"([^\\\"]+)\\\"\\s*\\))|(?:\\(\\s*\\'([^\\']+)\\'\\s*\\))|(?:\\(\\s*([^)\\s]+)\\s*\\))))|(?:\\'([^\\']+)\\')|(?:\\\"([^\\\"]+)\\\")/gi;\n    var styleRegExp = /\\s*([^:]+):\\s*([^;]+);?/g;\n    var trimRightRegExp = /\\s+$/;\n    var i;\n    var encodingLookup = {};\n    var validStyles;\n    var invalidStyles;\n    var invisibleChar = zeroWidth;\n    settings = settings || {};\n\n    if (schema) {\n      validStyles = schema.getValidStyles();\n      invalidStyles = schema.getInvalidStyles();\n    }\n\n    var encodingItems = ('\\\\\" \\\\\\' \\\\; \\\\: ; : ' + invisibleChar).split(' ');\n\n    for (i = 0; i < encodingItems.length; i++) {\n      encodingLookup[encodingItems[i]] = invisibleChar + i;\n      encodingLookup[invisibleChar + i] = encodingItems[i];\n    }\n\n    return {\n      toHex: function (color) {\n        return color.replace(rgbRegExp, toHex);\n      },\n      parse: function (css) {\n        var styles = {};\n        var matches, name, value, isEncoded;\n        var urlConverter = settings.url_converter;\n        var urlConverterScope = settings.url_converter_scope || this;\n\n        var compress = function (prefix, suffix, noJoin) {\n          var top = styles[prefix + '-top' + suffix];\n\n          if (!top) {\n            return;\n          }\n\n          var right = styles[prefix + '-right' + suffix];\n\n          if (!right) {\n            return;\n          }\n\n          var bottom = styles[prefix + '-bottom' + suffix];\n\n          if (!bottom) {\n            return;\n          }\n\n          var left = styles[prefix + '-left' + suffix];\n\n          if (!left) {\n            return;\n          }\n\n          var box = [top, right, bottom, left];\n          i = box.length - 1;\n\n          while (i--) {\n            if (box[i] !== box[i + 1]) {\n              break;\n            }\n          }\n\n          if (i > -1 && noJoin) {\n            return;\n          }\n\n          styles[prefix + suffix] = i === -1 ? box[0] : box.join(' ');\n          delete styles[prefix + '-top' + suffix];\n          delete styles[prefix + '-right' + suffix];\n          delete styles[prefix + '-bottom' + suffix];\n          delete styles[prefix + '-left' + suffix];\n        };\n\n        var canCompress = function (key) {\n          var value = styles[key],\n              i;\n\n          if (!value) {\n            return;\n          }\n\n          value = value.split(' ');\n          i = value.length;\n\n          while (i--) {\n            if (value[i] !== value[0]) {\n              return false;\n            }\n          }\n\n          styles[key] = value[0];\n          return true;\n        };\n\n        var compress2 = function (target, a, b, c) {\n          if (!canCompress(a)) {\n            return;\n          }\n\n          if (!canCompress(b)) {\n            return;\n          }\n\n          if (!canCompress(c)) {\n            return;\n          }\n\n          styles[target] = styles[a] + ' ' + styles[b] + ' ' + styles[c];\n          delete styles[a];\n          delete styles[b];\n          delete styles[c];\n        };\n\n        var encode = function (str) {\n          isEncoded = true;\n          return encodingLookup[str];\n        };\n\n        var decode = function (str, keepSlashes) {\n          if (isEncoded) {\n            str = str.replace(/\\uFEFF[0-9]/g, function (str) {\n              return encodingLookup[str];\n            });\n          }\n\n          if (!keepSlashes) {\n            str = str.replace(/\\\\([\\'\\\";:])/g, '$1');\n          }\n\n          return str;\n        };\n\n        var decodeSingleHexSequence = function (escSeq) {\n          return String.fromCharCode(parseInt(escSeq.slice(1), 16));\n        };\n\n        var decodeHexSequences = function (value) {\n          return value.replace(/\\\\[0-9a-f]+/gi, decodeSingleHexSequence);\n        };\n\n        var processUrl = function (match, url, url2, url3, str, str2) {\n          str = str || str2;\n\n          if (str) {\n            str = decode(str);\n            return '\\'' + str.replace(/\\'/g, '\\\\\\'') + '\\'';\n          }\n\n          url = decode(url || url2 || url3);\n\n          if (!settings.allow_script_urls) {\n            var scriptUrl = url.replace(/[\\s\\r\\n]+/g, '');\n\n            if (/(java|vb)script:/i.test(scriptUrl)) {\n              return '';\n            }\n\n            if (!settings.allow_svg_data_urls && /^data:image\\/svg/i.test(scriptUrl)) {\n              return '';\n            }\n          }\n\n          if (urlConverter) {\n            url = urlConverter.call(urlConverterScope, url, 'style');\n          }\n\n          return 'url(\\'' + url.replace(/\\'/g, '\\\\\\'') + '\\')';\n        };\n\n        if (css) {\n          css = css.replace(/[\\u0000-\\u001F]/g, '');\n          css = css.replace(/\\\\[\\\"\\';:\\uFEFF]/g, encode).replace(/\\\"[^\\\"]+\\\"|\\'[^\\']+\\'/g, function (str) {\n            return str.replace(/[;:]/g, encode);\n          });\n\n          while (matches = styleRegExp.exec(css)) {\n            styleRegExp.lastIndex = matches.index + matches[0].length;\n            name = matches[1].replace(trimRightRegExp, '').toLowerCase();\n            value = matches[2].replace(trimRightRegExp, '');\n\n            if (name && value) {\n              name = decodeHexSequences(name);\n              value = decodeHexSequences(value);\n\n              if (name.indexOf(invisibleChar) !== -1 || name.indexOf('\"') !== -1) {\n                continue;\n              }\n\n              if (!settings.allow_script_urls && (name === 'behavior' || /expression\\s*\\(|\\/\\*|\\*\\//.test(value))) {\n                continue;\n              }\n\n              if (name === 'font-weight' && value === '700') {\n                value = 'bold';\n              } else if (name === 'color' || name === 'background-color') {\n                value = value.toLowerCase();\n              }\n\n              value = value.replace(rgbRegExp, toHex);\n              value = value.replace(urlOrStrRegExp, processUrl);\n              styles[name] = isEncoded ? decode(value, true) : value;\n            }\n          }\n\n          compress('border', '', true);\n          compress('border', '-width');\n          compress('border', '-color');\n          compress('border', '-style');\n          compress('padding', '');\n          compress('margin', '');\n          compress2('border', 'border-width', 'border-style', 'border-color');\n\n          if (styles.border === 'medium none') {\n            delete styles.border;\n          }\n\n          if (styles['border-image'] === 'none') {\n            delete styles['border-image'];\n          }\n        }\n\n        return styles;\n      },\n      serialize: function (styles, elementName) {\n        var css = '';\n\n        var serializeStyles = function (name) {\n          var value;\n          var styleList = validStyles[name];\n\n          if (styleList) {\n            for (var i_1 = 0, l = styleList.length; i_1 < l; i_1++) {\n              name = styleList[i_1];\n              value = styles[name];\n\n              if (value) {\n                css += (css.length > 0 ? ' ' : '') + name + ': ' + value + ';';\n              }\n            }\n          }\n        };\n\n        var isValid = function (name, elementName) {\n          var styleMap = invalidStyles['*'];\n\n          if (styleMap && styleMap[name]) {\n            return false;\n          }\n\n          styleMap = invalidStyles[elementName];\n          return !(styleMap && styleMap[name]);\n        };\n\n        if (elementName && validStyles) {\n          serializeStyles('*');\n          serializeStyles(elementName);\n        } else {\n          each$1(styles, function (value, name) {\n            if (value && (!invalidStyles || isValid(name, elementName))) {\n              css += (css.length > 0 ? ' ' : '') + name + ': ' + value + ';';\n            }\n          });\n        }\n\n        return css;\n      }\n    };\n  };\n\n  var eventExpandoPrefix = 'mce-data-';\n  var mouseEventRe = /^(?:mouse|contextmenu)|click/;\n  var deprecated = {\n    keyLocation: 1,\n    layerX: 1,\n    layerY: 1,\n    returnValue: 1,\n    webkitMovementX: 1,\n    webkitMovementY: 1,\n    keyIdentifier: 1,\n    mozPressure: 1\n  };\n\n  var hasIsDefaultPrevented = function (event) {\n    return event.isDefaultPrevented === returnTrue || event.isDefaultPrevented === returnFalse;\n  };\n\n  var returnFalse = function () {\n    return false;\n  };\n\n  var returnTrue = function () {\n    return true;\n  };\n\n  var addEvent = function (target, name, callback, capture) {\n    if (target.addEventListener) {\n      target.addEventListener(name, callback, capture || false);\n    } else if (target.attachEvent) {\n      target.attachEvent('on' + name, callback);\n    }\n  };\n\n  var removeEvent = function (target, name, callback, capture) {\n    if (target.removeEventListener) {\n      target.removeEventListener(name, callback, capture || false);\n    } else if (target.detachEvent) {\n      target.detachEvent('on' + name, callback);\n    }\n  };\n\n  var isMouseEvent = function (event) {\n    return mouseEventRe.test(event.type);\n  };\n\n  var fix = function (originalEvent, data) {\n    var name;\n    var event = data || {};\n\n    for (name in originalEvent) {\n      if (!deprecated[name]) {\n        event[name] = originalEvent[name];\n      }\n    }\n\n    if (!event.target) {\n      event.target = event.srcElement || document;\n    }\n\n    if (event.composedPath) {\n      event.composedPath = function () {\n        return originalEvent.composedPath();\n      };\n    }\n\n    if (originalEvent && isMouseEvent(originalEvent) && originalEvent.pageX === undefined && originalEvent.clientX !== undefined) {\n      var eventDoc = event.target.ownerDocument || document;\n      var doc = eventDoc.documentElement;\n      var body = eventDoc.body;\n      event.pageX = originalEvent.clientX + (doc && doc.scrollLeft || body && body.scrollLeft || 0) - (doc && doc.clientLeft || body && body.clientLeft || 0);\n      event.pageY = originalEvent.clientY + (doc && doc.scrollTop || body && body.scrollTop || 0) - (doc && doc.clientTop || body && body.clientTop || 0);\n    }\n\n    event.preventDefault = function () {\n      event.isDefaultPrevented = returnTrue;\n\n      if (originalEvent) {\n        if (originalEvent.preventDefault) {\n          originalEvent.preventDefault();\n        } else {\n          originalEvent.returnValue = false;\n        }\n      }\n    };\n\n    event.stopPropagation = function () {\n      event.isPropagationStopped = returnTrue;\n\n      if (originalEvent) {\n        if (originalEvent.stopPropagation) {\n          originalEvent.stopPropagation();\n        } else {\n          originalEvent.cancelBubble = true;\n        }\n      }\n    };\n\n    event.stopImmediatePropagation = function () {\n      event.isImmediatePropagationStopped = returnTrue;\n      event.stopPropagation();\n    };\n\n    if (hasIsDefaultPrevented(event) === false) {\n      event.isDefaultPrevented = returnFalse;\n      event.isPropagationStopped = returnFalse;\n      event.isImmediatePropagationStopped = returnFalse;\n    }\n\n    if (typeof event.metaKey === 'undefined') {\n      event.metaKey = false;\n    }\n\n    return event;\n  };\n\n  var bindOnReady = function (win, callback, eventUtils) {\n    var doc = win.document,\n        event = {\n      type: 'ready'\n    };\n\n    if (eventUtils.domLoaded) {\n      callback(event);\n      return;\n    }\n\n    var isDocReady = function () {\n      return doc.readyState === 'complete' || doc.readyState === 'interactive' && doc.body;\n    };\n\n    var readyHandler = function () {\n      removeEvent(win, 'DOMContentLoaded', readyHandler);\n      removeEvent(win, 'load', readyHandler);\n\n      if (!eventUtils.domLoaded) {\n        eventUtils.domLoaded = true;\n        callback(event);\n      }\n    };\n\n    if (isDocReady()) {\n      readyHandler();\n    } else {\n      addEvent(win, 'DOMContentLoaded', readyHandler);\n    }\n\n    addEvent(win, 'load', readyHandler);\n  };\n\n  var EventUtils = function () {\n    function EventUtils() {\n      this.domLoaded = false;\n      this.events = {};\n      this.count = 1;\n      this.expando = eventExpandoPrefix + (+new Date()).toString(32);\n      this.hasMouseEnterLeave = 'onmouseenter' in document.documentElement;\n      this.hasFocusIn = 'onfocusin' in document.documentElement;\n      this.count = 1;\n    }\n\n    EventUtils.prototype.bind = function (target, names, callback, scope) {\n      var self = this;\n      var id, callbackList, i, name, fakeName, nativeHandler, capture;\n      var win = window;\n\n      var defaultNativeHandler = function (evt) {\n        self.executeHandlers(fix(evt || win.event), id);\n      };\n\n      if (!target || target.nodeType === 3 || target.nodeType === 8) {\n        return;\n      }\n\n      if (!target[self.expando]) {\n        id = self.count++;\n        target[self.expando] = id;\n        self.events[id] = {};\n      } else {\n        id = target[self.expando];\n      }\n\n      scope = scope || target;\n      var namesList = names.split(' ');\n      i = namesList.length;\n\n      while (i--) {\n        name = namesList[i];\n        nativeHandler = defaultNativeHandler;\n        fakeName = capture = false;\n\n        if (name === 'DOMContentLoaded') {\n          name = 'ready';\n        }\n\n        if (self.domLoaded && name === 'ready' && target.readyState === 'complete') {\n          callback.call(scope, fix({\n            type: name\n          }));\n          continue;\n        }\n\n        if (!self.hasMouseEnterLeave) {\n          fakeName = self.mouseEnterLeave[name];\n\n          if (fakeName) {\n            nativeHandler = function (evt) {\n              var current = evt.currentTarget;\n              var related = evt.relatedTarget;\n\n              if (related && current.contains) {\n                related = current.contains(related);\n              } else {\n                while (related && related !== current) {\n                  related = related.parentNode;\n                }\n              }\n\n              if (!related) {\n                evt = fix(evt || win.event);\n                evt.type = evt.type === 'mouseout' ? 'mouseleave' : 'mouseenter';\n                evt.target = current;\n                self.executeHandlers(evt, id);\n              }\n            };\n          }\n        }\n\n        if (!self.hasFocusIn && (name === 'focusin' || name === 'focusout')) {\n          capture = true;\n          fakeName = name === 'focusin' ? 'focus' : 'blur';\n\n          nativeHandler = function (evt) {\n            evt = fix(evt || win.event);\n            evt.type = evt.type === 'focus' ? 'focusin' : 'focusout';\n            self.executeHandlers(evt, id);\n          };\n        }\n\n        callbackList = self.events[id][name];\n\n        if (!callbackList) {\n          self.events[id][name] = callbackList = [{\n            func: callback,\n            scope: scope\n          }];\n          callbackList.fakeName = fakeName;\n          callbackList.capture = capture;\n          callbackList.nativeHandler = nativeHandler;\n\n          if (name === 'ready') {\n            bindOnReady(target, nativeHandler, self);\n          } else {\n            addEvent(target, fakeName || name, nativeHandler, capture);\n          }\n        } else {\n          if (name === 'ready' && self.domLoaded) {\n            callback(fix({\n              type: name\n            }));\n          } else {\n            callbackList.push({\n              func: callback,\n              scope: scope\n            });\n          }\n        }\n      }\n\n      target = callbackList = null;\n      return callback;\n    };\n\n    EventUtils.prototype.unbind = function (target, names, callback) {\n      var callbackList, i, ci, name, eventMap;\n\n      if (!target || target.nodeType === 3 || target.nodeType === 8) {\n        return this;\n      }\n\n      var id = target[this.expando];\n\n      if (id) {\n        eventMap = this.events[id];\n\n        if (names) {\n          var namesList = names.split(' ');\n          i = namesList.length;\n\n          while (i--) {\n            name = namesList[i];\n            callbackList = eventMap[name];\n\n            if (callbackList) {\n              if (callback) {\n                ci = callbackList.length;\n\n                while (ci--) {\n                  if (callbackList[ci].func === callback) {\n                    var nativeHandler = callbackList.nativeHandler;\n                    var fakeName = callbackList.fakeName,\n                        capture = callbackList.capture;\n                    callbackList = callbackList.slice(0, ci).concat(callbackList.slice(ci + 1));\n                    callbackList.nativeHandler = nativeHandler;\n                    callbackList.fakeName = fakeName;\n                    callbackList.capture = capture;\n                    eventMap[name] = callbackList;\n                  }\n                }\n              }\n\n              if (!callback || callbackList.length === 0) {\n                delete eventMap[name];\n                removeEvent(target, callbackList.fakeName || name, callbackList.nativeHandler, callbackList.capture);\n              }\n            }\n          }\n        } else {\n          each$1(eventMap, function (callbackList, name) {\n            removeEvent(target, callbackList.fakeName || name, callbackList.nativeHandler, callbackList.capture);\n          });\n          eventMap = {};\n        }\n\n        for (name in eventMap) {\n          if (has(eventMap, name)) {\n            return this;\n          }\n        }\n\n        delete this.events[id];\n\n        try {\n          delete target[this.expando];\n        } catch (ex) {\n          target[this.expando] = null;\n        }\n      }\n\n      return this;\n    };\n\n    EventUtils.prototype.fire = function (target, name, args) {\n      var id;\n\n      if (!target || target.nodeType === 3 || target.nodeType === 8) {\n        return this;\n      }\n\n      var event = fix(null, args);\n      event.type = name;\n      event.target = target;\n\n      do {\n        id = target[this.expando];\n\n        if (id) {\n          this.executeHandlers(event, id);\n        }\n\n        target = target.parentNode || target.ownerDocument || target.defaultView || target.parentWindow;\n      } while (target && !event.isPropagationStopped());\n\n      return this;\n    };\n\n    EventUtils.prototype.clean = function (target) {\n      var i, children;\n\n      if (!target || target.nodeType === 3 || target.nodeType === 8) {\n        return this;\n      }\n\n      if (target[this.expando]) {\n        this.unbind(target);\n      }\n\n      if (!target.getElementsByTagName) {\n        target = target.document;\n      }\n\n      if (target && target.getElementsByTagName) {\n        this.unbind(target);\n        children = target.getElementsByTagName('*');\n        i = children.length;\n\n        while (i--) {\n          target = children[i];\n\n          if (target[this.expando]) {\n            this.unbind(target);\n          }\n        }\n      }\n\n      return this;\n    };\n\n    EventUtils.prototype.destroy = function () {\n      this.events = {};\n    };\n\n    EventUtils.prototype.cancel = function (e) {\n      if (e) {\n        e.preventDefault();\n        e.stopImmediatePropagation();\n      }\n\n      return false;\n    };\n\n    EventUtils.prototype.executeHandlers = function (evt, id) {\n      var container = this.events[id];\n      var callbackList = container && container[evt.type];\n\n      if (callbackList) {\n        for (var i = 0, l = callbackList.length; i < l; i++) {\n          var callback = callbackList[i];\n\n          if (callback && callback.func.call(callback.scope, evt) === false) {\n            evt.preventDefault();\n          }\n\n          if (evt.isImmediatePropagationStopped()) {\n            return;\n          }\n        }\n      }\n    };\n\n    EventUtils.Event = new EventUtils();\n    return EventUtils;\n  }();\n\n  var support,\n      Expr,\n      getText,\n      isXML,\n      tokenize,\n      compile,\n      select,\n      outermostContext,\n      sortInput,\n      hasDuplicate,\n      setDocument,\n      document$1,\n      docElem,\n      documentIsHTML,\n      rbuggyQSA,\n      rbuggyMatches,\n      matches,\n      contains$3,\n      expando = 'sizzle' + -new Date(),\n      preferredDoc = window.document,\n      dirruns = 0,\n      done = 0,\n      classCache = createCache(),\n      tokenCache = createCache(),\n      compilerCache = createCache(),\n      sortOrder = function (a, b) {\n    if (a === b) {\n      hasDuplicate = true;\n    }\n\n    return 0;\n  },\n      strundefined = typeof undefined,\n      MAX_NEGATIVE = 1 << 31,\n      hasOwn = {}.hasOwnProperty,\n      arr = [],\n      pop = arr.pop,\n      push_native = arr.push,\n      push = arr.push,\n      slice = arr.slice,\n      indexOf$2 = arr.indexOf || function (elem) {\n    var i = 0,\n        len = this.length;\n\n    for (; i < len; i++) {\n      if (this[i] === elem) {\n        return i;\n      }\n    }\n\n    return -1;\n  },\n      booleans = 'checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped',\n      whitespace = '[\\\\x20\\\\t\\\\r\\\\n\\\\f]',\n      identifier = '(?:\\\\\\\\.|[\\\\w-]|[^\\\\x00-\\\\xa0])+',\n      attributes = '\\\\[' + whitespace + '*(' + identifier + ')(?:' + whitespace + '*([*^$|!~]?=)' + whitespace + '*(?:\\'((?:\\\\\\\\.|[^\\\\\\\\\\'])*)\\'|\"((?:\\\\\\\\.|[^\\\\\\\\\"])*)\"|(' + identifier + '))|)' + whitespace + '*\\\\]',\n      pseudos = ':(' + identifier + ')(?:\\\\((' + '(\\'((?:\\\\\\\\.|[^\\\\\\\\\\'])*)\\'|\"((?:\\\\\\\\.|[^\\\\\\\\\"])*)\")|' + '((?:\\\\\\\\.|[^\\\\\\\\()[\\\\]]|' + attributes + ')*)|' + '.*' + ')\\\\)|)',\n      rtrim = new RegExp('^' + whitespace + '+|((?:^|[^\\\\\\\\])(?:\\\\\\\\.)*)' + whitespace + '+$', 'g'),\n      rcomma = new RegExp('^' + whitespace + '*,' + whitespace + '*'),\n      rcombinators = new RegExp('^' + whitespace + '*([>+~]|' + whitespace + ')' + whitespace + '*'),\n      rattributeQuotes = new RegExp('=' + whitespace + '*([^\\\\]\\'\"]*?)' + whitespace + '*\\\\]', 'g'),\n      rpseudo = new RegExp(pseudos),\n      ridentifier = new RegExp('^' + identifier + '$'),\n      matchExpr = {\n    ID: new RegExp('^#(' + identifier + ')'),\n    CLASS: new RegExp('^\\\\.(' + identifier + ')'),\n    TAG: new RegExp('^(' + identifier + '|[*])'),\n    ATTR: new RegExp('^' + attributes),\n    PSEUDO: new RegExp('^' + pseudos),\n    CHILD: new RegExp('^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\\\(' + whitespace + '*(even|odd|(([+-]|)(\\\\d*)n|)' + whitespace + '*(?:([+-]|)' + whitespace + '*(\\\\d+)|))' + whitespace + '*\\\\)|)', 'i'),\n    bool: new RegExp('^(?:' + booleans + ')$', 'i'),\n    needsContext: new RegExp('^' + whitespace + '*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\\\(' + whitespace + '*((?:-\\\\d)?\\\\d*)' + whitespace + '*\\\\)|)(?=[^-]|$)', 'i')\n  },\n      rinputs = /^(?:input|select|textarea|button)$/i,\n      rheader = /^h\\d$/i,\n      rnative = /^[^{]+\\{\\s*\\[native \\w/,\n      rquickExpr = /^(?:#([\\w-]+)|(\\w+)|\\.([\\w-]+))$/,\n      rsibling = /[+~]/,\n      rescape = /'|\\\\/g,\n      runescape = new RegExp('\\\\\\\\([\\\\da-f]{1,6}' + whitespace + '?|(' + whitespace + ')|.)', 'ig'),\n      funescape = function (_, escaped, escapedWhitespace) {\n    var high = '0x' + escaped - 65536;\n    return high !== high || escapedWhitespace ? escaped : high < 0 ? String.fromCharCode(high + 65536) : String.fromCharCode(high >> 10 | 55296, high & 1023 | 56320);\n  };\n\n  try {\n    push.apply(arr = slice.call(preferredDoc.childNodes), preferredDoc.childNodes);\n    arr[preferredDoc.childNodes.length].nodeType;\n  } catch (e) {\n    push = {\n      apply: arr.length ? function (target, els) {\n        push_native.apply(target, slice.call(els));\n      } : function (target, els) {\n        var j = target.length,\n            i = 0;\n\n        while (target[j++] = els[i++]) {}\n\n        target.length = j - 1;\n      }\n    };\n  }\n\n  var Sizzle = function (selector, context, results, seed) {\n    var match, elem, m, nodeType, i, groups, old, nid, newContext, newSelector;\n\n    if ((context ? context.ownerDocument || context : preferredDoc) !== document$1) {\n      setDocument(context);\n    }\n\n    context = context || document$1;\n    results = results || [];\n\n    if (!selector || typeof selector !== 'string') {\n      return results;\n    }\n\n    if ((nodeType = context.nodeType) !== 1 && nodeType !== 9) {\n      return [];\n    }\n\n    if (documentIsHTML && !seed) {\n      if (match = rquickExpr.exec(selector)) {\n        if (m = match[1]) {\n          if (nodeType === 9) {\n            elem = context.getElementById(m);\n\n            if (elem && elem.parentNode) {\n              if (elem.id === m) {\n                results.push(elem);\n                return results;\n              }\n            } else {\n              return results;\n            }\n          } else {\n            if (context.ownerDocument && (elem = context.ownerDocument.getElementById(m)) && contains$3(context, elem) && elem.id === m) {\n              results.push(elem);\n              return results;\n            }\n          }\n        } else if (match[2]) {\n          push.apply(results, context.getElementsByTagName(selector));\n          return results;\n        } else if ((m = match[3]) && support.getElementsByClassName) {\n          push.apply(results, context.getElementsByClassName(m));\n          return results;\n        }\n      }\n\n      if (support.qsa && (!rbuggyQSA || !rbuggyQSA.test(selector))) {\n        nid = old = expando;\n        newContext = context;\n        newSelector = nodeType === 9 && selector;\n\n        if (nodeType === 1 && context.nodeName.toLowerCase() !== 'object') {\n          groups = tokenize(selector);\n\n          if (old = context.getAttribute('id')) {\n            nid = old.replace(rescape, '\\\\$&');\n          } else {\n            context.setAttribute('id', nid);\n          }\n\n          nid = '[id=\\'' + nid + '\\'] ';\n          i = groups.length;\n\n          while (i--) {\n            groups[i] = nid + toSelector(groups[i]);\n          }\n\n          newContext = rsibling.test(selector) && testContext(context.parentNode) || context;\n          newSelector = groups.join(',');\n        }\n\n        if (newSelector) {\n          try {\n            push.apply(results, newContext.querySelectorAll(newSelector));\n            return results;\n          } catch (qsaError) {} finally {\n            if (!old) {\n              context.removeAttribute('id');\n            }\n          }\n        }\n      }\n    }\n\n    return select(selector.replace(rtrim, '$1'), context, results, seed);\n  };\n\n  function createCache() {\n    var keys = [];\n\n    function cache(key, value) {\n      if (keys.push(key + ' ') > Expr.cacheLength) {\n        delete cache[keys.shift()];\n      }\n\n      return cache[key + ' '] = value;\n    }\n\n    return cache;\n  }\n\n  function markFunction(fn) {\n    fn[expando] = true;\n    return fn;\n  }\n\n  function siblingCheck(a, b) {\n    var cur = b && a,\n        diff = cur && a.nodeType === 1 && b.nodeType === 1 && (~b.sourceIndex || MAX_NEGATIVE) - (~a.sourceIndex || MAX_NEGATIVE);\n\n    if (diff) {\n      return diff;\n    }\n\n    if (cur) {\n      while (cur = cur.nextSibling) {\n        if (cur === b) {\n          return -1;\n        }\n      }\n    }\n\n    return a ? 1 : -1;\n  }\n\n  function createInputPseudo(type) {\n    return function (elem) {\n      var name = elem.nodeName.toLowerCase();\n      return name === 'input' && elem.type === type;\n    };\n  }\n\n  function createButtonPseudo(type) {\n    return function (elem) {\n      var name = elem.nodeName.toLowerCase();\n      return (name === 'input' || name === 'button') && elem.type === type;\n    };\n  }\n\n  function createPositionalPseudo(fn) {\n    return markFunction(function (argument) {\n      argument = +argument;\n      return markFunction(function (seed, matches) {\n        var j,\n            matchIndexes = fn([], seed.length, argument),\n            i = matchIndexes.length;\n\n        while (i--) {\n          if (seed[j = matchIndexes[i]]) {\n            seed[j] = !(matches[j] = seed[j]);\n          }\n        }\n      });\n    });\n  }\n\n  function testContext(context) {\n    return context && typeof context.getElementsByTagName !== strundefined && context;\n  }\n\n  support = Sizzle.support = {};\n\n  isXML = Sizzle.isXML = function (elem) {\n    var documentElement = elem && (elem.ownerDocument || elem).documentElement;\n    return documentElement ? documentElement.nodeName !== 'HTML' : false;\n  };\n\n  setDocument = Sizzle.setDocument = function (node) {\n    var hasCompare,\n        doc = node ? node.ownerDocument || node : preferredDoc,\n        parent = doc.defaultView;\n\n    function getTop(win) {\n      try {\n        return win.top;\n      } catch (ex) {}\n\n      return null;\n    }\n\n    if (doc === document$1 || doc.nodeType !== 9 || !doc.documentElement) {\n      return document$1;\n    }\n\n    document$1 = doc;\n    docElem = doc.documentElement;\n    documentIsHTML = !isXML(doc);\n\n    if (parent && parent !== getTop(parent)) {\n      if (parent.addEventListener) {\n        parent.addEventListener('unload', function () {\n          setDocument();\n        }, false);\n      } else if (parent.attachEvent) {\n        parent.attachEvent('onunload', function () {\n          setDocument();\n        });\n      }\n    }\n\n    support.attributes = true;\n    support.getElementsByTagName = true;\n    support.getElementsByClassName = rnative.test(doc.getElementsByClassName);\n    support.getById = true;\n\n    Expr.find.ID = function (id, context) {\n      if (typeof context.getElementById !== strundefined && documentIsHTML) {\n        var m = context.getElementById(id);\n        return m && m.parentNode ? [m] : [];\n      }\n    };\n\n    Expr.filter.ID = function (id) {\n      var attrId = id.replace(runescape, funescape);\n      return function (elem) {\n        return elem.getAttribute('id') === attrId;\n      };\n    };\n\n    Expr.find.TAG = support.getElementsByTagName ? function (tag, context) {\n      if (typeof context.getElementsByTagName !== strundefined) {\n        return context.getElementsByTagName(tag);\n      }\n    } : function (tag, context) {\n      var elem,\n          tmp = [],\n          i = 0,\n          results = context.getElementsByTagName(tag);\n\n      if (tag === '*') {\n        while (elem = results[i++]) {\n          if (elem.nodeType === 1) {\n            tmp.push(elem);\n          }\n        }\n\n        return tmp;\n      }\n\n      return results;\n    };\n\n    Expr.find.CLASS = support.getElementsByClassName && function (className, context) {\n      if (documentIsHTML) {\n        return context.getElementsByClassName(className);\n      }\n    };\n\n    rbuggyMatches = [];\n    rbuggyQSA = [];\n    support.disconnectedMatch = true;\n    rbuggyQSA = rbuggyQSA.length && new RegExp(rbuggyQSA.join('|'));\n    rbuggyMatches = rbuggyMatches.length && new RegExp(rbuggyMatches.join('|'));\n    hasCompare = rnative.test(docElem.compareDocumentPosition);\n    contains$3 = hasCompare || rnative.test(docElem.contains) ? function (a, b) {\n      var adown = a.nodeType === 9 ? a.documentElement : a,\n          bup = b && b.parentNode;\n      return a === bup || !!(bup && bup.nodeType === 1 && (adown.contains ? adown.contains(bup) : a.compareDocumentPosition && a.compareDocumentPosition(bup) & 16));\n    } : function (a, b) {\n      if (b) {\n        while (b = b.parentNode) {\n          if (b === a) {\n            return true;\n          }\n        }\n      }\n\n      return false;\n    };\n    sortOrder = hasCompare ? function (a, b) {\n      if (a === b) {\n        hasDuplicate = true;\n        return 0;\n      }\n\n      var compare = !a.compareDocumentPosition - !b.compareDocumentPosition;\n\n      if (compare) {\n        return compare;\n      }\n\n      compare = (a.ownerDocument || a) === (b.ownerDocument || b) ? a.compareDocumentPosition(b) : 1;\n\n      if (compare & 1 || !support.sortDetached && b.compareDocumentPosition(a) === compare) {\n        if (a === doc || a.ownerDocument === preferredDoc && contains$3(preferredDoc, a)) {\n          return -1;\n        }\n\n        if (b === doc || b.ownerDocument === preferredDoc && contains$3(preferredDoc, b)) {\n          return 1;\n        }\n\n        return sortInput ? indexOf$2.call(sortInput, a) - indexOf$2.call(sortInput, b) : 0;\n      }\n\n      return compare & 4 ? -1 : 1;\n    } : function (a, b) {\n      if (a === b) {\n        hasDuplicate = true;\n        return 0;\n      }\n\n      var cur,\n          i = 0,\n          aup = a.parentNode,\n          bup = b.parentNode,\n          ap = [a],\n          bp = [b];\n\n      if (!aup || !bup) {\n        return a === doc ? -1 : b === doc ? 1 : aup ? -1 : bup ? 1 : sortInput ? indexOf$2.call(sortInput, a) - indexOf$2.call(sortInput, b) : 0;\n      } else if (aup === bup) {\n        return siblingCheck(a, b);\n      }\n\n      cur = a;\n\n      while (cur = cur.parentNode) {\n        ap.unshift(cur);\n      }\n\n      cur = b;\n\n      while (cur = cur.parentNode) {\n        bp.unshift(cur);\n      }\n\n      while (ap[i] === bp[i]) {\n        i++;\n      }\n\n      return i ? siblingCheck(ap[i], bp[i]) : ap[i] === preferredDoc ? -1 : bp[i] === preferredDoc ? 1 : 0;\n    };\n    return doc;\n  };\n\n  Sizzle.matches = function (expr, elements) {\n    return Sizzle(expr, null, null, elements);\n  };\n\n  Sizzle.matchesSelector = function (elem, expr) {\n    if ((elem.ownerDocument || elem) !== document$1) {\n      setDocument(elem);\n    }\n\n    expr = expr.replace(rattributeQuotes, '=\\'$1\\']');\n\n    if (support.matchesSelector && documentIsHTML && (!rbuggyMatches || !rbuggyMatches.test(expr)) && (!rbuggyQSA || !rbuggyQSA.test(expr))) {\n      try {\n        var ret = matches.call(elem, expr);\n\n        if (ret || support.disconnectedMatch || elem.document && elem.document.nodeType !== 11) {\n          return ret;\n        }\n      } catch (e) {}\n    }\n\n    return Sizzle(expr, document$1, null, [elem]).length > 0;\n  };\n\n  Sizzle.contains = function (context, elem) {\n    if ((context.ownerDocument || context) !== document$1) {\n      setDocument(context);\n    }\n\n    return contains$3(context, elem);\n  };\n\n  Sizzle.attr = function (elem, name) {\n    if ((elem.ownerDocument || elem) !== document$1) {\n      setDocument(elem);\n    }\n\n    var fn = Expr.attrHandle[name.toLowerCase()],\n        val = fn && hasOwn.call(Expr.attrHandle, name.toLowerCase()) ? fn(elem, name, !documentIsHTML) : undefined;\n    return val !== undefined ? val : support.attributes || !documentIsHTML ? elem.getAttribute(name) : (val = elem.getAttributeNode(name)) && val.specified ? val.value : null;\n  };\n\n  Sizzle.error = function (msg) {\n    throw new Error('Syntax error, unrecognized expression: ' + msg);\n  };\n\n  Sizzle.uniqueSort = function (results) {\n    var elem,\n        duplicates = [],\n        j = 0,\n        i = 0;\n    hasDuplicate = !support.detectDuplicates;\n    sortInput = !support.sortStable && results.slice(0);\n    results.sort(sortOrder);\n\n    if (hasDuplicate) {\n      while (elem = results[i++]) {\n        if (elem === results[i]) {\n          j = duplicates.push(i);\n        }\n      }\n\n      while (j--) {\n        results.splice(duplicates[j], 1);\n      }\n    }\n\n    sortInput = null;\n    return results;\n  };\n\n  getText = Sizzle.getText = function (elem) {\n    var node,\n        ret = '',\n        i = 0,\n        nodeType = elem.nodeType;\n\n    if (!nodeType) {\n      while (node = elem[i++]) {\n        ret += getText(node);\n      }\n    } else if (nodeType === 1 || nodeType === 9 || nodeType === 11) {\n      if (typeof elem.textContent === 'string') {\n        return elem.textContent;\n      } else {\n        for (elem = elem.firstChild; elem; elem = elem.nextSibling) {\n          ret += getText(elem);\n        }\n      }\n    } else if (nodeType === 3 || nodeType === 4) {\n      return elem.nodeValue;\n    }\n\n    return ret;\n  };\n\n  Expr = Sizzle.selectors = {\n    cacheLength: 50,\n    createPseudo: markFunction,\n    match: matchExpr,\n    attrHandle: {},\n    find: {},\n    relative: {\n      '>': {\n        dir: 'parentNode',\n        first: true\n      },\n      ' ': {\n        dir: 'parentNode'\n      },\n      '+': {\n        dir: 'previousSibling',\n        first: true\n      },\n      '~': {\n        dir: 'previousSibling'\n      }\n    },\n    preFilter: {\n      ATTR: function (match) {\n        match[1] = match[1].replace(runescape, funescape);\n        match[3] = (match[3] || match[4] || match[5] || '').replace(runescape, funescape);\n\n        if (match[2] === '~=') {\n          match[3] = ' ' + match[3] + ' ';\n        }\n\n        return match.slice(0, 4);\n      },\n      CHILD: function (match) {\n        match[1] = match[1].toLowerCase();\n\n        if (match[1].slice(0, 3) === 'nth') {\n          if (!match[3]) {\n            Sizzle.error(match[0]);\n          }\n\n          match[4] = +(match[4] ? match[5] + (match[6] || 1) : 2 * (match[3] === 'even' || match[3] === 'odd'));\n          match[5] = +(match[7] + match[8] || match[3] === 'odd');\n        } else if (match[3]) {\n          Sizzle.error(match[0]);\n        }\n\n        return match;\n      },\n      PSEUDO: function (match) {\n        var excess,\n            unquoted = !match[6] && match[2];\n\n        if (matchExpr.CHILD.test(match[0])) {\n          return null;\n        }\n\n        if (match[3]) {\n          match[2] = match[4] || match[5] || '';\n        } else if (unquoted && rpseudo.test(unquoted) && (excess = tokenize(unquoted, true)) && (excess = unquoted.indexOf(')', unquoted.length - excess) - unquoted.length)) {\n          match[0] = match[0].slice(0, excess);\n          match[2] = unquoted.slice(0, excess);\n        }\n\n        return match.slice(0, 3);\n      }\n    },\n    filter: {\n      TAG: function (nodeNameSelector) {\n        var nodeName = nodeNameSelector.replace(runescape, funescape).toLowerCase();\n        return nodeNameSelector === '*' ? function () {\n          return true;\n        } : function (elem) {\n          return elem.nodeName && elem.nodeName.toLowerCase() === nodeName;\n        };\n      },\n      CLASS: function (className) {\n        var pattern = classCache[className + ' '];\n        return pattern || (pattern = new RegExp('(^|' + whitespace + ')' + className + '(' + whitespace + '|$)')) && classCache(className, function (elem) {\n          return pattern.test(typeof elem.className === 'string' && elem.className || typeof elem.getAttribute !== strundefined && elem.getAttribute('class') || '');\n        });\n      },\n      ATTR: function (name, operator, check) {\n        return function (elem) {\n          var result = Sizzle.attr(elem, name);\n\n          if (result == null) {\n            return operator === '!=';\n          }\n\n          if (!operator) {\n            return true;\n          }\n\n          result += '';\n          return operator === '=' ? result === check : operator === '!=' ? result !== check : operator === '^=' ? check && result.indexOf(check) === 0 : operator === '*=' ? check && result.indexOf(check) > -1 : operator === '$=' ? check && result.slice(-check.length) === check : operator === '~=' ? (' ' + result + ' ').indexOf(check) > -1 : operator === '|=' ? result === check || result.slice(0, check.length + 1) === check + '-' : false;\n        };\n      },\n      CHILD: function (type, what, argument, first, last) {\n        var simple = type.slice(0, 3) !== 'nth',\n            forward = type.slice(-4) !== 'last',\n            ofType = what === 'of-type';\n        return first === 1 && last === 0 ? function (elem) {\n          return !!elem.parentNode;\n        } : function (elem, context, xml) {\n          var cache,\n              outerCache,\n              node,\n              diff,\n              nodeIndex,\n              start,\n              dir = simple !== forward ? 'nextSibling' : 'previousSibling',\n              parent = elem.parentNode,\n              name = ofType && elem.nodeName.toLowerCase(),\n              useCache = !xml && !ofType;\n\n          if (parent) {\n            if (simple) {\n              while (dir) {\n                node = elem;\n\n                while (node = node[dir]) {\n                  if (ofType ? node.nodeName.toLowerCase() === name : node.nodeType === 1) {\n                    return false;\n                  }\n                }\n\n                start = dir = type === 'only' && !start && 'nextSibling';\n              }\n\n              return true;\n            }\n\n            start = [forward ? parent.firstChild : parent.lastChild];\n\n            if (forward && useCache) {\n              outerCache = parent[expando] || (parent[expando] = {});\n              cache = outerCache[type] || [];\n              nodeIndex = cache[0] === dirruns && cache[1];\n              diff = cache[0] === dirruns && cache[2];\n              node = nodeIndex && parent.childNodes[nodeIndex];\n\n              while (node = ++nodeIndex && node && node[dir] || (diff = nodeIndex = 0) || start.pop()) {\n                if (node.nodeType === 1 && ++diff && node === elem) {\n                  outerCache[type] = [dirruns, nodeIndex, diff];\n                  break;\n                }\n              }\n            } else if (useCache && (cache = (elem[expando] || (elem[expando] = {}))[type]) && cache[0] === dirruns) {\n              diff = cache[1];\n            } else {\n              while (node = ++nodeIndex && node && node[dir] || (diff = nodeIndex = 0) || start.pop()) {\n                if ((ofType ? node.nodeName.toLowerCase() === name : node.nodeType === 1) && ++diff) {\n                  if (useCache) {\n                    (node[expando] || (node[expando] = {}))[type] = [dirruns, diff];\n                  }\n\n                  if (node === elem) {\n                    break;\n                  }\n                }\n              }\n            }\n\n            diff -= last;\n            return diff === first || diff % first === 0 && diff / first >= 0;\n          }\n        };\n      },\n      PSEUDO: function (pseudo, argument) {\n        var args,\n            fn = Expr.pseudos[pseudo] || Expr.setFilters[pseudo.toLowerCase()] || Sizzle.error('unsupported pseudo: ' + pseudo);\n\n        if (fn[expando]) {\n          return fn(argument);\n        }\n\n        if (fn.length > 1) {\n          args = [pseudo, pseudo, '', argument];\n          return Expr.setFilters.hasOwnProperty(pseudo.toLowerCase()) ? markFunction(function (seed, matches) {\n            var idx,\n                matched = fn(seed, argument),\n                i = matched.length;\n\n            while (i--) {\n              idx = indexOf$2.call(seed, matched[i]);\n              seed[idx] = !(matches[idx] = matched[i]);\n            }\n          }) : function (elem) {\n            return fn(elem, 0, args);\n          };\n        }\n\n        return fn;\n      }\n    },\n    pseudos: {\n      not: markFunction(function (selector) {\n        var input = [],\n            results = [],\n            matcher = compile(selector.replace(rtrim, '$1'));\n        return matcher[expando] ? markFunction(function (seed, matches, context, xml) {\n          var elem,\n              unmatched = matcher(seed, null, xml, []),\n              i = seed.length;\n\n          while (i--) {\n            if (elem = unmatched[i]) {\n              seed[i] = !(matches[i] = elem);\n            }\n          }\n        }) : function (elem, context, xml) {\n          input[0] = elem;\n          matcher(input, null, xml, results);\n          return !results.pop();\n        };\n      }),\n      has: markFunction(function (selector) {\n        return function (elem) {\n          return Sizzle(selector, elem).length > 0;\n        };\n      }),\n      contains: markFunction(function (text) {\n        text = text.replace(runescape, funescape);\n        return function (elem) {\n          return (elem.textContent || elem.innerText || getText(elem)).indexOf(text) > -1;\n        };\n      }),\n      lang: markFunction(function (lang) {\n        if (!ridentifier.test(lang || '')) {\n          Sizzle.error('unsupported lang: ' + lang);\n        }\n\n        lang = lang.replace(runescape, funescape).toLowerCase();\n        return function (elem) {\n          var elemLang;\n\n          do {\n            if (elemLang = documentIsHTML ? elem.lang : elem.getAttribute('xml:lang') || elem.getAttribute('lang')) {\n              elemLang = elemLang.toLowerCase();\n              return elemLang === lang || elemLang.indexOf(lang + '-') === 0;\n            }\n          } while ((elem = elem.parentNode) && elem.nodeType === 1);\n\n          return false;\n        };\n      }),\n      target: function (elem) {\n        var hash = window.location && window.location.hash;\n        return hash && hash.slice(1) === elem.id;\n      },\n      root: function (elem) {\n        return elem === docElem;\n      },\n      focus: function (elem) {\n        return elem === document$1.activeElement && (!document$1.hasFocus || document$1.hasFocus()) && !!(elem.type || elem.href || ~elem.tabIndex);\n      },\n      enabled: function (elem) {\n        return elem.disabled === false;\n      },\n      disabled: function (elem) {\n        return elem.disabled === true;\n      },\n      checked: function (elem) {\n        var nodeName = elem.nodeName.toLowerCase();\n        return nodeName === 'input' && !!elem.checked || nodeName === 'option' && !!elem.selected;\n      },\n      selected: function (elem) {\n        if (elem.parentNode) {\n          elem.parentNode.selectedIndex;\n        }\n\n        return elem.selected === true;\n      },\n      empty: function (elem) {\n        for (elem = elem.firstChild; elem; elem = elem.nextSibling) {\n          if (elem.nodeType < 6) {\n            return false;\n          }\n        }\n\n        return true;\n      },\n      parent: function (elem) {\n        return !Expr.pseudos.empty(elem);\n      },\n      header: function (elem) {\n        return rheader.test(elem.nodeName);\n      },\n      input: function (elem) {\n        return rinputs.test(elem.nodeName);\n      },\n      button: function (elem) {\n        var name = elem.nodeName.toLowerCase();\n        return name === 'input' && elem.type === 'button' || name === 'button';\n      },\n      text: function (elem) {\n        var attr;\n        return elem.nodeName.toLowerCase() === 'input' && elem.type === 'text' && ((attr = elem.getAttribute('type')) == null || attr.toLowerCase() === 'text');\n      },\n      first: createPositionalPseudo(function () {\n        return [0];\n      }),\n      last: createPositionalPseudo(function (matchIndexes, length) {\n        return [length - 1];\n      }),\n      eq: createPositionalPseudo(function (matchIndexes, length, argument) {\n        return [argument < 0 ? argument + length : argument];\n      }),\n      even: createPositionalPseudo(function (matchIndexes, length) {\n        var i = 0;\n\n        for (; i < length; i += 2) {\n          matchIndexes.push(i);\n        }\n\n        return matchIndexes;\n      }),\n      odd: createPositionalPseudo(function (matchIndexes, length) {\n        var i = 1;\n\n        for (; i < length; i += 2) {\n          matchIndexes.push(i);\n        }\n\n        return matchIndexes;\n      }),\n      lt: createPositionalPseudo(function (matchIndexes, length, argument) {\n        var i = argument < 0 ? argument + length : argument;\n\n        for (; --i >= 0;) {\n          matchIndexes.push(i);\n        }\n\n        return matchIndexes;\n      }),\n      gt: createPositionalPseudo(function (matchIndexes, length, argument) {\n        var i = argument < 0 ? argument + length : argument;\n\n        for (; ++i < length;) {\n          matchIndexes.push(i);\n        }\n\n        return matchIndexes;\n      })\n    }\n  };\n  Expr.pseudos.nth = Expr.pseudos.eq;\n  each(['radio', 'checkbox', 'file', 'password', 'image'], function (i) {\n    Expr.pseudos[i] = createInputPseudo(i);\n  });\n  each(['submit', 'reset'], function (i) {\n    Expr.pseudos[i] = createButtonPseudo(i);\n  });\n\n  function setFilters() {}\n\n  setFilters.prototype = Expr.filters = Expr.pseudos;\n  Expr.setFilters = new setFilters();\n\n  tokenize = Sizzle.tokenize = function (selector, parseOnly) {\n    var matched,\n        match,\n        tokens,\n        type,\n        soFar,\n        groups,\n        preFilters,\n        cached = tokenCache[selector + ' '];\n\n    if (cached) {\n      return parseOnly ? 0 : cached.slice(0);\n    }\n\n    soFar = selector;\n    groups = [];\n    preFilters = Expr.preFilter;\n\n    while (soFar) {\n      if (!matched || (match = rcomma.exec(soFar))) {\n        if (match) {\n          soFar = soFar.slice(match[0].length) || soFar;\n        }\n\n        groups.push(tokens = []);\n      }\n\n      matched = false;\n\n      if (match = rcombinators.exec(soFar)) {\n        matched = match.shift();\n        tokens.push({\n          value: matched,\n          type: match[0].replace(rtrim, ' ')\n        });\n        soFar = soFar.slice(matched.length);\n      }\n\n      for (type in Expr.filter) {\n        if (!Expr.filter.hasOwnProperty(type)) {\n          continue;\n        }\n\n        if ((match = matchExpr[type].exec(soFar)) && (!preFilters[type] || (match = preFilters[type](match)))) {\n          matched = match.shift();\n          tokens.push({\n            value: matched,\n            type: type,\n            matches: match\n          });\n          soFar = soFar.slice(matched.length);\n        }\n      }\n\n      if (!matched) {\n        break;\n      }\n    }\n\n    return parseOnly ? soFar.length : soFar ? Sizzle.error(selector) : tokenCache(selector, groups).slice(0);\n  };\n\n  function toSelector(tokens) {\n    var i = 0,\n        len = tokens.length,\n        selector = '';\n\n    for (; i < len; i++) {\n      selector += tokens[i].value;\n    }\n\n    return selector;\n  }\n\n  function addCombinator(matcher, combinator, base) {\n    var dir = combinator.dir,\n        checkNonElements = base && dir === 'parentNode',\n        doneName = done++;\n    return combinator.first ? function (elem, context, xml) {\n      while (elem = elem[dir]) {\n        if (elem.nodeType === 1 || checkNonElements) {\n          return matcher(elem, context, xml);\n        }\n      }\n    } : function (elem, context, xml) {\n      var oldCache,\n          outerCache,\n          newCache = [dirruns, doneName];\n\n      if (xml) {\n        while (elem = elem[dir]) {\n          if (elem.nodeType === 1 || checkNonElements) {\n            if (matcher(elem, context, xml)) {\n              return true;\n            }\n          }\n        }\n      } else {\n        while (elem = elem[dir]) {\n          if (elem.nodeType === 1 || checkNonElements) {\n            outerCache = elem[expando] || (elem[expando] = {});\n\n            if ((oldCache = outerCache[dir]) && oldCache[0] === dirruns && oldCache[1] === doneName) {\n              return newCache[2] = oldCache[2];\n            } else {\n              outerCache[dir] = newCache;\n\n              if (newCache[2] = matcher(elem, context, xml)) {\n                return true;\n              }\n            }\n          }\n        }\n      }\n    };\n  }\n\n  function elementMatcher(matchers) {\n    return matchers.length > 1 ? function (elem, context, xml) {\n      var i = matchers.length;\n\n      while (i--) {\n        if (!matchers[i](elem, context, xml)) {\n          return false;\n        }\n      }\n\n      return true;\n    } : matchers[0];\n  }\n\n  function multipleContexts(selector, contexts, results) {\n    var i = 0,\n        len = contexts.length;\n\n    for (; i < len; i++) {\n      Sizzle(selector, contexts[i], results);\n    }\n\n    return results;\n  }\n\n  function condense(unmatched, map, filter, context, xml) {\n    var elem,\n        newUnmatched = [],\n        i = 0,\n        len = unmatched.length,\n        mapped = map != null;\n\n    for (; i < len; i++) {\n      if (elem = unmatched[i]) {\n        if (!filter || filter(elem, context, xml)) {\n          newUnmatched.push(elem);\n\n          if (mapped) {\n            map.push(i);\n          }\n        }\n      }\n    }\n\n    return newUnmatched;\n  }\n\n  function setMatcher(preFilter, selector, matcher, postFilter, postFinder, postSelector) {\n    if (postFilter && !postFilter[expando]) {\n      postFilter = setMatcher(postFilter);\n    }\n\n    if (postFinder && !postFinder[expando]) {\n      postFinder = setMatcher(postFinder, postSelector);\n    }\n\n    return markFunction(function (seed, results, context, xml) {\n      var temp,\n          i,\n          elem,\n          preMap = [],\n          postMap = [],\n          preexisting = results.length,\n          elems = seed || multipleContexts(selector || '*', context.nodeType ? [context] : context, []),\n          matcherIn = preFilter && (seed || !selector) ? condense(elems, preMap, preFilter, context, xml) : elems,\n          matcherOut = matcher ? postFinder || (seed ? preFilter : preexisting || postFilter) ? [] : results : matcherIn;\n\n      if (matcher) {\n        matcher(matcherIn, matcherOut, context, xml);\n      }\n\n      if (postFilter) {\n        temp = condense(matcherOut, postMap);\n        postFilter(temp, [], context, xml);\n        i = temp.length;\n\n        while (i--) {\n          if (elem = temp[i]) {\n            matcherOut[postMap[i]] = !(matcherIn[postMap[i]] = elem);\n          }\n        }\n      }\n\n      if (seed) {\n        if (postFinder || preFilter) {\n          if (postFinder) {\n            temp = [];\n            i = matcherOut.length;\n\n            while (i--) {\n              if (elem = matcherOut[i]) {\n                temp.push(matcherIn[i] = elem);\n              }\n            }\n\n            postFinder(null, matcherOut = [], temp, xml);\n          }\n\n          i = matcherOut.length;\n\n          while (i--) {\n            if ((elem = matcherOut[i]) && (temp = postFinder ? indexOf$2.call(seed, elem) : preMap[i]) > -1) {\n              seed[temp] = !(results[temp] = elem);\n            }\n          }\n        }\n      } else {\n        matcherOut = condense(matcherOut === results ? matcherOut.splice(preexisting, matcherOut.length) : matcherOut);\n\n        if (postFinder) {\n          postFinder(null, results, matcherOut, xml);\n        } else {\n          push.apply(results, matcherOut);\n        }\n      }\n    });\n  }\n\n  function matcherFromTokens(tokens) {\n    var checkContext,\n        matcher,\n        j,\n        len = tokens.length,\n        leadingRelative = Expr.relative[tokens[0].type],\n        implicitRelative = leadingRelative || Expr.relative[' '],\n        i = leadingRelative ? 1 : 0,\n        matchContext = addCombinator(function (elem) {\n      return elem === checkContext;\n    }, implicitRelative, true),\n        matchAnyContext = addCombinator(function (elem) {\n      return indexOf$2.call(checkContext, elem) > -1;\n    }, implicitRelative, true),\n        matchers = [function (elem, context, xml) {\n      return !leadingRelative && (xml || context !== outermostContext) || ((checkContext = context).nodeType ? matchContext(elem, context, xml) : matchAnyContext(elem, context, xml));\n    }];\n\n    for (; i < len; i++) {\n      if (matcher = Expr.relative[tokens[i].type]) {\n        matchers = [addCombinator(elementMatcher(matchers), matcher)];\n      } else {\n        matcher = Expr.filter[tokens[i].type].apply(null, tokens[i].matches);\n\n        if (matcher[expando]) {\n          j = ++i;\n\n          for (; j < len; j++) {\n            if (Expr.relative[tokens[j].type]) {\n              break;\n            }\n          }\n\n          return setMatcher(i > 1 && elementMatcher(matchers), i > 1 && toSelector(tokens.slice(0, i - 1).concat({\n            value: tokens[i - 2].type === ' ' ? '*' : ''\n          })).replace(rtrim, '$1'), matcher, i < j && matcherFromTokens(tokens.slice(i, j)), j < len && matcherFromTokens(tokens = tokens.slice(j)), j < len && toSelector(tokens));\n        }\n\n        matchers.push(matcher);\n      }\n    }\n\n    return elementMatcher(matchers);\n  }\n\n  function matcherFromGroupMatchers(elementMatchers, setMatchers) {\n    var bySet = setMatchers.length > 0,\n        byElement = elementMatchers.length > 0,\n        superMatcher = function (seed, context, xml, results, outermost) {\n      var elem,\n          j,\n          matcher,\n          matchedCount = 0,\n          i = '0',\n          unmatched = seed && [],\n          setMatched = [],\n          contextBackup = outermostContext,\n          elems = seed || byElement && Expr.find.TAG('*', outermost),\n          dirrunsUnique = dirruns += contextBackup == null ? 1 : Math.random() || 0.1,\n          len = elems.length;\n\n      if (outermost) {\n        outermostContext = context !== document$1 && context;\n      }\n\n      for (; i !== len && (elem = elems[i]) != null; i++) {\n        if (byElement && elem) {\n          j = 0;\n\n          while (matcher = elementMatchers[j++]) {\n            if (matcher(elem, context, xml)) {\n              results.push(elem);\n              break;\n            }\n          }\n\n          if (outermost) {\n            dirruns = dirrunsUnique;\n          }\n        }\n\n        if (bySet) {\n          if (elem = !matcher && elem) {\n            matchedCount--;\n          }\n\n          if (seed) {\n            unmatched.push(elem);\n          }\n        }\n      }\n\n      matchedCount += i;\n\n      if (bySet && i !== matchedCount) {\n        j = 0;\n\n        while (matcher = setMatchers[j++]) {\n          matcher(unmatched, setMatched, context, xml);\n        }\n\n        if (seed) {\n          if (matchedCount > 0) {\n            while (i--) {\n              if (!(unmatched[i] || setMatched[i])) {\n                setMatched[i] = pop.call(results);\n              }\n            }\n          }\n\n          setMatched = condense(setMatched);\n        }\n\n        push.apply(results, setMatched);\n\n        if (outermost && !seed && setMatched.length > 0 && matchedCount + setMatchers.length > 1) {\n          Sizzle.uniqueSort(results);\n        }\n      }\n\n      if (outermost) {\n        dirruns = dirrunsUnique;\n        outermostContext = contextBackup;\n      }\n\n      return unmatched;\n    };\n\n    return bySet ? markFunction(superMatcher) : superMatcher;\n  }\n\n  compile = Sizzle.compile = function (selector, match) {\n    var i,\n        setMatchers = [],\n        elementMatchers = [],\n        cached = compilerCache[selector + ' '];\n\n    if (!cached) {\n      if (!match) {\n        match = tokenize(selector);\n      }\n\n      i = match.length;\n\n      while (i--) {\n        cached = matcherFromTokens(match[i]);\n\n        if (cached[expando]) {\n          setMatchers.push(cached);\n        } else {\n          elementMatchers.push(cached);\n        }\n      }\n\n      cached = compilerCache(selector, matcherFromGroupMatchers(elementMatchers, setMatchers));\n      cached.selector = selector;\n    }\n\n    return cached;\n  };\n\n  select = Sizzle.select = function (selector, context, results, seed) {\n    var i,\n        tokens,\n        token,\n        type,\n        find,\n        compiled = typeof selector === 'function' && selector,\n        match = !seed && tokenize(selector = compiled.selector || selector);\n    results = results || [];\n\n    if (match.length === 1) {\n      tokens = match[0] = match[0].slice(0);\n\n      if (tokens.length > 2 && (token = tokens[0]).type === 'ID' && support.getById && context.nodeType === 9 && documentIsHTML && Expr.relative[tokens[1].type]) {\n        context = (Expr.find.ID(token.matches[0].replace(runescape, funescape), context) || [])[0];\n\n        if (!context) {\n          return results;\n        } else if (compiled) {\n          context = context.parentNode;\n        }\n\n        selector = selector.slice(tokens.shift().value.length);\n      }\n\n      i = matchExpr.needsContext.test(selector) ? 0 : tokens.length;\n\n      while (i--) {\n        token = tokens[i];\n\n        if (Expr.relative[type = token.type]) {\n          break;\n        }\n\n        if (find = Expr.find[type]) {\n          if (seed = find(token.matches[0].replace(runescape, funescape), rsibling.test(tokens[0].type) && testContext(context.parentNode) || context)) {\n            tokens.splice(i, 1);\n            selector = seed.length && toSelector(tokens);\n\n            if (!selector) {\n              push.apply(results, seed);\n              return results;\n            }\n\n            break;\n          }\n        }\n      }\n    }\n\n    (compiled || compile(selector, match))(seed, context, !documentIsHTML, results, rsibling.test(selector) && testContext(context.parentNode) || context);\n    return results;\n  };\n\n  support.sortStable = expando.split('').sort(sortOrder).join('') === expando;\n  support.detectDuplicates = !!hasDuplicate;\n  setDocument();\n  support.sortDetached = true;\n  var doc = document,\n      push$1 = Array.prototype.push,\n      slice$1 = Array.prototype.slice;\n  var rquickExpr$1 = /^(?:[^#<]*(<[\\w\\W]+>)[^>]*$|#([\\w\\-]*)$)/;\n  var Event = EventUtils.Event;\n  var skipUniques = Tools.makeMap('children,contents,next,prev');\n\n  var isDefined = function (obj) {\n    return typeof obj !== 'undefined';\n  };\n\n  var isString$1 = function (obj) {\n    return typeof obj === 'string';\n  };\n\n  var isWindow = function (obj) {\n    return obj && obj === obj.window;\n  };\n\n  var createFragment = function (html, fragDoc) {\n    fragDoc = fragDoc || doc;\n    var container = fragDoc.createElement('div');\n    var frag = fragDoc.createDocumentFragment();\n    container.innerHTML = html;\n    var node;\n\n    while (node = container.firstChild) {\n      frag.appendChild(node);\n    }\n\n    return frag;\n  };\n\n  var domManipulate = function (targetNodes, sourceItem, callback, reverse) {\n    var i;\n\n    if (isString$1(sourceItem)) {\n      sourceItem = createFragment(sourceItem, getElementDocument(targetNodes[0]));\n    } else if (sourceItem.length && !sourceItem.nodeType) {\n      sourceItem = DomQuery.makeArray(sourceItem);\n\n      if (reverse) {\n        for (i = sourceItem.length - 1; i >= 0; i--) {\n          domManipulate(targetNodes, sourceItem[i], callback, reverse);\n        }\n      } else {\n        for (i = 0; i < sourceItem.length; i++) {\n          domManipulate(targetNodes, sourceItem[i], callback, reverse);\n        }\n      }\n\n      return targetNodes;\n    }\n\n    if (sourceItem.nodeType) {\n      i = targetNodes.length;\n\n      while (i--) {\n        callback.call(targetNodes[i], sourceItem);\n      }\n    }\n\n    return targetNodes;\n  };\n\n  var hasClass = function (node, className) {\n    return node && className && (' ' + node.className + ' ').indexOf(' ' + className + ' ') !== -1;\n  };\n\n  var wrap$1 = function (elements, wrapper, all) {\n    var lastParent, newWrapper;\n    wrapper = DomQuery(wrapper)[0];\n    elements.each(function () {\n      var self = this;\n\n      if (!all || lastParent !== self.parentNode) {\n        lastParent = self.parentNode;\n        newWrapper = wrapper.cloneNode(false);\n        self.parentNode.insertBefore(newWrapper, self);\n        newWrapper.appendChild(self);\n      } else {\n        newWrapper.appendChild(self);\n      }\n    });\n    return elements;\n  };\n\n  var numericCssMap = Tools.makeMap('fillOpacity fontWeight lineHeight opacity orphans widows zIndex zoom', ' ');\n  var booleanMap = Tools.makeMap('checked compact declare defer disabled ismap multiple nohref noshade nowrap readonly selected', ' ');\n  var propFix = {\n    for: 'htmlFor',\n    class: 'className',\n    readonly: 'readOnly'\n  };\n  var cssFix = {\n    float: 'cssFloat'\n  };\n  var attrHooks = {},\n      cssHooks = {};\n\n  var DomQueryConstructor = function (selector, context) {\n    return new DomQuery.fn.init(selector, context);\n  };\n\n  var inArray$1 = function (item, array) {\n    var i;\n\n    if (array.indexOf) {\n      return array.indexOf(item);\n    }\n\n    i = array.length;\n\n    while (i--) {\n      if (array[i] === item) {\n        return i;\n      }\n    }\n\n    return -1;\n  };\n\n  var whiteSpaceRegExp$2 = /^\\s*|\\s*$/g;\n\n  var trim$3 = function (str) {\n    return str === null || str === undefined ? '' : ('' + str).replace(whiteSpaceRegExp$2, '');\n  };\n\n  var each$4 = function (obj, callback) {\n    var length, key, i, value;\n\n    if (obj) {\n      length = obj.length;\n\n      if (length === undefined) {\n        for (key in obj) {\n          if (obj.hasOwnProperty(key)) {\n            value = obj[key];\n\n            if (callback.call(value, key, value) === false) {\n              break;\n            }\n          }\n        }\n      } else {\n        for (i = 0; i < length; i++) {\n          value = obj[i];\n\n          if (callback.call(value, i, value) === false) {\n            break;\n          }\n        }\n      }\n    }\n\n    return obj;\n  };\n\n  var grep = function (array, callback) {\n    var out = [];\n    each$4(array, function (i, item) {\n      if (callback(item, i)) {\n        out.push(item);\n      }\n    });\n    return out;\n  };\n\n  var getElementDocument = function (element) {\n    if (!element) {\n      return doc;\n    }\n\n    if (element.nodeType === 9) {\n      return element;\n    }\n\n    return element.ownerDocument;\n  };\n\n  DomQueryConstructor.fn = DomQueryConstructor.prototype = {\n    constructor: DomQueryConstructor,\n    selector: '',\n    context: null,\n    length: 0,\n    init: function (selector, context) {\n      var self = this;\n      var match, node;\n\n      if (!selector) {\n        return self;\n      }\n\n      if (selector.nodeType) {\n        self.context = self[0] = selector;\n        self.length = 1;\n        return self;\n      }\n\n      if (context && context.nodeType) {\n        self.context = context;\n      } else {\n        if (context) {\n          return DomQuery(selector).attr(context);\n        }\n\n        self.context = context = document;\n      }\n\n      if (isString$1(selector)) {\n        self.selector = selector;\n\n        if (selector.charAt(0) === '<' && selector.charAt(selector.length - 1) === '>' && selector.length >= 3) {\n          match = [null, selector, null];\n        } else {\n          match = rquickExpr$1.exec(selector);\n        }\n\n        if (match) {\n          if (match[1]) {\n            node = createFragment(selector, getElementDocument(context)).firstChild;\n\n            while (node) {\n              push$1.call(self, node);\n              node = node.nextSibling;\n            }\n          } else {\n            node = getElementDocument(context).getElementById(match[2]);\n\n            if (!node) {\n              return self;\n            }\n\n            if (node.id !== match[2]) {\n              return self.find(selector);\n            }\n\n            self.length = 1;\n            self[0] = node;\n          }\n        } else {\n          return DomQuery(context).find(selector);\n        }\n      } else {\n        this.add(selector, false);\n      }\n\n      return self;\n    },\n    toArray: function () {\n      return Tools.toArray(this);\n    },\n    add: function (items, sort) {\n      var self = this;\n      var nodes, i;\n\n      if (isString$1(items)) {\n        return self.add(DomQuery(items));\n      }\n\n      if (sort !== false) {\n        nodes = DomQuery.unique(self.toArray().concat(DomQuery.makeArray(items)));\n        self.length = nodes.length;\n\n        for (i = 0; i < nodes.length; i++) {\n          self[i] = nodes[i];\n        }\n      } else {\n        push$1.apply(self, DomQuery.makeArray(items));\n      }\n\n      return self;\n    },\n    attr: function (name, value) {\n      var self = this;\n      var hook;\n\n      if (typeof name === 'object') {\n        each$4(name, function (name, value) {\n          self.attr(name, value);\n        });\n      } else if (isDefined(value)) {\n        this.each(function () {\n          var hook;\n\n          if (this.nodeType === 1) {\n            hook = attrHooks[name];\n\n            if (hook && hook.set) {\n              hook.set(this, value);\n              return;\n            }\n\n            if (value === null) {\n              this.removeAttribute(name, 2);\n            } else {\n              this.setAttribute(name, value, 2);\n            }\n          }\n        });\n      } else {\n        if (self[0] && self[0].nodeType === 1) {\n          hook = attrHooks[name];\n\n          if (hook && hook.get) {\n            return hook.get(self[0], name);\n          }\n\n          if (booleanMap[name]) {\n            return self.prop(name) ? name : undefined;\n          }\n\n          value = self[0].getAttribute(name, 2);\n\n          if (value === null) {\n            value = undefined;\n          }\n        }\n\n        return value;\n      }\n\n      return self;\n    },\n    removeAttr: function (name) {\n      return this.attr(name, null);\n    },\n    prop: function (name, value) {\n      var self = this;\n      name = propFix[name] || name;\n\n      if (typeof name === 'object') {\n        each$4(name, function (name, value) {\n          self.prop(name, value);\n        });\n      } else if (isDefined(value)) {\n        this.each(function () {\n          if (this.nodeType === 1) {\n            this[name] = value;\n          }\n        });\n      } else {\n        if (self[0] && self[0].nodeType && name in self[0]) {\n          return self[0][name];\n        }\n\n        return value;\n      }\n\n      return self;\n    },\n    css: function (name, value) {\n      var self = this;\n      var elm, hook;\n\n      var camel = function (name) {\n        return name.replace(/-(\\D)/g, function (a, b) {\n          return b.toUpperCase();\n        });\n      };\n\n      var dashed = function (name) {\n        return name.replace(/[A-Z]/g, function (a) {\n          return '-' + a;\n        });\n      };\n\n      if (typeof name === 'object') {\n        each$4(name, function (name, value) {\n          self.css(name, value);\n        });\n      } else {\n        if (isDefined(value)) {\n          name = camel(name);\n\n          if (typeof value === 'number' && !numericCssMap[name]) {\n            value = value.toString() + 'px';\n          }\n\n          self.each(function () {\n            var style = this.style;\n            hook = cssHooks[name];\n\n            if (hook && hook.set) {\n              hook.set(this, value);\n              return;\n            }\n\n            try {\n              this.style[cssFix[name] || name] = value;\n            } catch (ex) {}\n\n            if (value === null || value === '') {\n              if (style.removeProperty) {\n                style.removeProperty(dashed(name));\n              } else {\n                style.removeAttribute(name);\n              }\n            }\n          });\n        } else {\n          elm = self[0];\n          hook = cssHooks[name];\n\n          if (hook && hook.get) {\n            return hook.get(elm);\n          }\n\n          if (elm.ownerDocument.defaultView) {\n            try {\n              return elm.ownerDocument.defaultView.getComputedStyle(elm, null).getPropertyValue(dashed(name));\n            } catch (ex) {\n              return undefined;\n            }\n          } else if (elm.currentStyle) {\n            return elm.currentStyle[camel(name)];\n          } else {\n            return '';\n          }\n        }\n      }\n\n      return self;\n    },\n    remove: function () {\n      var self = this;\n      var node,\n          i = this.length;\n\n      while (i--) {\n        node = self[i];\n        Event.clean(node);\n\n        if (node.parentNode) {\n          node.parentNode.removeChild(node);\n        }\n      }\n\n      return this;\n    },\n    empty: function () {\n      var self = this;\n      var node,\n          i = this.length;\n\n      while (i--) {\n        node = self[i];\n\n        while (node.firstChild) {\n          node.removeChild(node.firstChild);\n        }\n      }\n\n      return this;\n    },\n    html: function (value) {\n      var self = this;\n      var i;\n\n      if (isDefined(value)) {\n        i = self.length;\n\n        try {\n          while (i--) {\n            self[i].innerHTML = value;\n          }\n        } catch (ex) {\n          DomQuery(self[i]).empty().append(value);\n        }\n\n        return self;\n      }\n\n      return self[0] ? self[0].innerHTML : '';\n    },\n    text: function (value) {\n      var self = this;\n      var i;\n\n      if (isDefined(value)) {\n        i = self.length;\n\n        while (i--) {\n          if ('innerText' in self[i]) {\n            self[i].innerText = value;\n          } else {\n            self[0].textContent = value;\n          }\n        }\n\n        return self;\n      }\n\n      return self[0] ? self[0].innerText || self[0].textContent : '';\n    },\n    append: function () {\n      return domManipulate(this, arguments, function (node) {\n        if (this.nodeType === 1 || this.host && this.host.nodeType === 1) {\n          this.appendChild(node);\n        }\n      });\n    },\n    prepend: function () {\n      return domManipulate(this, arguments, function (node) {\n        if (this.nodeType === 1 || this.host && this.host.nodeType === 1) {\n          this.insertBefore(node, this.firstChild);\n        }\n      }, true);\n    },\n    before: function () {\n      var self = this;\n\n      if (self[0] && self[0].parentNode) {\n        return domManipulate(self, arguments, function (node) {\n          this.parentNode.insertBefore(node, this);\n        });\n      }\n\n      return self;\n    },\n    after: function () {\n      var self = this;\n\n      if (self[0] && self[0].parentNode) {\n        return domManipulate(self, arguments, function (node) {\n          this.parentNode.insertBefore(node, this.nextSibling);\n        }, true);\n      }\n\n      return self;\n    },\n    appendTo: function (val) {\n      DomQuery(val).append(this);\n      return this;\n    },\n    prependTo: function (val) {\n      DomQuery(val).prepend(this);\n      return this;\n    },\n    replaceWith: function (content) {\n      return this.before(content).remove();\n    },\n    wrap: function (content) {\n      return wrap$1(this, content);\n    },\n    wrapAll: function (content) {\n      return wrap$1(this, content, true);\n    },\n    wrapInner: function (content) {\n      this.each(function () {\n        DomQuery(this).contents().wrapAll(content);\n      });\n      return this;\n    },\n    unwrap: function () {\n      return this.parent().each(function () {\n        DomQuery(this).replaceWith(this.childNodes);\n      });\n    },\n    clone: function () {\n      var result = [];\n      this.each(function () {\n        result.push(this.cloneNode(true));\n      });\n      return DomQuery(result);\n    },\n    addClass: function (className) {\n      return this.toggleClass(className, true);\n    },\n    removeClass: function (className) {\n      return this.toggleClass(className, false);\n    },\n    toggleClass: function (className, state) {\n      var self = this;\n\n      if (typeof className !== 'string') {\n        return self;\n      }\n\n      if (className.indexOf(' ') !== -1) {\n        each$4(className.split(' '), function () {\n          self.toggleClass(this, state);\n        });\n      } else {\n        self.each(function (index, node) {\n          var classState = hasClass(node, className);\n\n          if (classState !== state) {\n            var existingClassName = node.className;\n\n            if (classState) {\n              node.className = trim$3((' ' + existingClassName + ' ').replace(' ' + className + ' ', ' '));\n            } else {\n              node.className += existingClassName ? ' ' + className : className;\n            }\n          }\n        });\n      }\n\n      return self;\n    },\n    hasClass: function (className) {\n      return hasClass(this[0], className);\n    },\n    each: function (callback) {\n      return each$4(this, callback);\n    },\n    on: function (name, callback) {\n      return this.each(function () {\n        Event.bind(this, name, callback);\n      });\n    },\n    off: function (name, callback) {\n      return this.each(function () {\n        Event.unbind(this, name, callback);\n      });\n    },\n    trigger: function (name) {\n      return this.each(function () {\n        if (typeof name === 'object') {\n          Event.fire(this, name.type, name);\n        } else {\n          Event.fire(this, name);\n        }\n      });\n    },\n    show: function () {\n      return this.css('display', '');\n    },\n    hide: function () {\n      return this.css('display', 'none');\n    },\n    slice: function () {\n      return new DomQuery(slice$1.apply(this, arguments));\n    },\n    eq: function (index) {\n      return index === -1 ? this.slice(index) : this.slice(index, +index + 1);\n    },\n    first: function () {\n      return this.eq(0);\n    },\n    last: function () {\n      return this.eq(-1);\n    },\n    find: function (selector) {\n      var i, l;\n      var ret = [];\n\n      for (i = 0, l = this.length; i < l; i++) {\n        DomQuery.find(selector, this[i], ret);\n      }\n\n      return DomQuery(ret);\n    },\n    filter: function (selector) {\n      if (typeof selector === 'function') {\n        return DomQuery(grep(this.toArray(), function (item, i) {\n          return selector(i, item);\n        }));\n      }\n\n      return DomQuery(DomQuery.filter(selector, this.toArray()));\n    },\n    closest: function (selector) {\n      var result = [];\n\n      if (selector instanceof DomQuery) {\n        selector = selector[0];\n      }\n\n      this.each(function (i, node) {\n        while (node) {\n          if (typeof selector === 'string' && DomQuery(node).is(selector)) {\n            result.push(node);\n            break;\n          } else if (node === selector) {\n            result.push(node);\n            break;\n          }\n\n          node = node.parentNode;\n        }\n      });\n      return DomQuery(result);\n    },\n    offset: function (offset) {\n      var elm, doc, docElm;\n      var x = 0,\n          y = 0,\n          pos;\n\n      if (!offset) {\n        elm = this[0];\n\n        if (elm) {\n          doc = elm.ownerDocument;\n          docElm = doc.documentElement;\n\n          if (elm.getBoundingClientRect) {\n            pos = elm.getBoundingClientRect();\n            x = pos.left + (docElm.scrollLeft || doc.body.scrollLeft) - docElm.clientLeft;\n            y = pos.top + (docElm.scrollTop || doc.body.scrollTop) - docElm.clientTop;\n          }\n        }\n\n        return {\n          left: x,\n          top: y\n        };\n      }\n\n      return this.css(offset);\n    },\n    push: push$1,\n    sort: Array.prototype.sort,\n    splice: Array.prototype.splice\n  };\n  Tools.extend(DomQueryConstructor, {\n    extend: Tools.extend,\n    makeArray: function (object) {\n      if (isWindow(object) || object.nodeType) {\n        return [object];\n      }\n\n      return Tools.toArray(object);\n    },\n    inArray: inArray$1,\n    isArray: Tools.isArray,\n    each: each$4,\n    trim: trim$3,\n    grep: grep,\n    find: Sizzle,\n    expr: Sizzle.selectors,\n    unique: Sizzle.uniqueSort,\n    text: Sizzle.getText,\n    contains: Sizzle.contains,\n    filter: function (expr, elems, not) {\n      var i = elems.length;\n\n      if (not) {\n        expr = ':not(' + expr + ')';\n      }\n\n      while (i--) {\n        if (elems[i].nodeType !== 1) {\n          elems.splice(i, 1);\n        }\n      }\n\n      if (elems.length === 1) {\n        elems = DomQuery.find.matchesSelector(elems[0], expr) ? [elems[0]] : [];\n      } else {\n        elems = DomQuery.find.matches(expr, elems);\n      }\n\n      return elems;\n    }\n  });\n\n  var dir = function (el, prop, until) {\n    var matched = [];\n    var cur = el[prop];\n\n    if (typeof until !== 'string' && until instanceof DomQuery) {\n      until = until[0];\n    }\n\n    while (cur && cur.nodeType !== 9) {\n      if (until !== undefined) {\n        if (cur === until) {\n          break;\n        }\n\n        if (typeof until === 'string' && DomQuery(cur).is(until)) {\n          break;\n        }\n      }\n\n      if (cur.nodeType === 1) {\n        matched.push(cur);\n      }\n\n      cur = cur[prop];\n    }\n\n    return matched;\n  };\n\n  var sibling = function (node, siblingName, nodeType, until) {\n    var result = [];\n\n    if (until instanceof DomQuery) {\n      until = until[0];\n    }\n\n    for (; node; node = node[siblingName]) {\n      if (nodeType && node.nodeType !== nodeType) {\n        continue;\n      }\n\n      if (until !== undefined) {\n        if (node === until) {\n          break;\n        }\n\n        if (typeof until === 'string' && DomQuery(node).is(until)) {\n          break;\n        }\n      }\n\n      result.push(node);\n    }\n\n    return result;\n  };\n\n  var firstSibling = function (node, siblingName, nodeType) {\n    for (node = node[siblingName]; node; node = node[siblingName]) {\n      if (node.nodeType === nodeType) {\n        return node;\n      }\n    }\n\n    return null;\n  };\n\n  each$4({\n    parent: function (node) {\n      var parent = node.parentNode;\n      return parent && parent.nodeType !== 11 ? parent : null;\n    },\n    parents: function (node) {\n      return dir(node, 'parentNode');\n    },\n    next: function (node) {\n      return firstSibling(node, 'nextSibling', 1);\n    },\n    prev: function (node) {\n      return firstSibling(node, 'previousSibling', 1);\n    },\n    children: function (node) {\n      return sibling(node.firstChild, 'nextSibling', 1);\n    },\n    contents: function (node) {\n      return Tools.toArray((node.nodeName === 'iframe' ? node.contentDocument || node.contentWindow.document : node).childNodes);\n    }\n  }, function (name, fn) {\n    DomQueryConstructor.fn[name] = function (selector) {\n      var self = this;\n      var result = [];\n      self.each(function () {\n        var nodes = fn.call(result, this, selector, result);\n\n        if (nodes) {\n          if (DomQuery.isArray(nodes)) {\n            result.push.apply(result, nodes);\n          } else {\n            result.push(nodes);\n          }\n        }\n      });\n\n      if (this.length > 1) {\n        if (!skipUniques[name]) {\n          result = DomQuery.unique(result);\n        }\n\n        if (name.indexOf('parents') === 0) {\n          result = result.reverse();\n        }\n      }\n\n      var wrappedResult = DomQuery(result);\n\n      if (selector) {\n        return wrappedResult.filter(selector);\n      }\n\n      return wrappedResult;\n    };\n  });\n  each$4({\n    parentsUntil: function (node, until) {\n      return dir(node, 'parentNode', until);\n    },\n    nextUntil: function (node, until) {\n      return sibling(node, 'nextSibling', 1, until).slice(1);\n    },\n    prevUntil: function (node, until) {\n      return sibling(node, 'previousSibling', 1, until).slice(1);\n    }\n  }, function (name, fn) {\n    DomQueryConstructor.fn[name] = function (selector, filter) {\n      var self = this;\n      var result = [];\n      self.each(function () {\n        var nodes = fn.call(result, this, selector, result);\n\n        if (nodes) {\n          if (DomQuery.isArray(nodes)) {\n            result.push.apply(result, nodes);\n          } else {\n            result.push(nodes);\n          }\n        }\n      });\n\n      if (this.length > 1) {\n        result = DomQuery.unique(result);\n\n        if (name.indexOf('parents') === 0 || name === 'prevUntil') {\n          result = result.reverse();\n        }\n      }\n\n      var wrappedResult = DomQuery(result);\n\n      if (filter) {\n        return wrappedResult.filter(filter);\n      }\n\n      return wrappedResult;\n    };\n  });\n\n  DomQueryConstructor.fn.is = function (selector) {\n    return !!selector && this.filter(selector).length > 0;\n  };\n\n  DomQueryConstructor.fn.init.prototype = DomQueryConstructor.fn;\n\n  DomQueryConstructor.overrideDefaults = function (callback) {\n    var defaults;\n\n    var sub = function (selector, context) {\n      defaults = defaults || callback();\n\n      if (arguments.length === 0) {\n        selector = defaults.element;\n      }\n\n      if (!context) {\n        context = defaults.context;\n      }\n\n      return new sub.fn.init(selector, context);\n    };\n\n    DomQuery.extend(sub, this);\n    return sub;\n  };\n\n  DomQueryConstructor.attrHooks = attrHooks;\n  DomQueryConstructor.cssHooks = cssHooks;\n  var DomQuery = DomQueryConstructor;\n  var each$5 = Tools.each;\n  var grep$1 = Tools.grep;\n  var isIE = Env.ie;\n  var simpleSelectorRe = /^([a-z0-9],?)+$/i;\n\n  var setupAttrHooks = function (styles, settings, getContext) {\n    var keepValues = settings.keep_values;\n    var keepUrlHook = {\n      set: function ($elm, value, name) {\n        if (settings.url_converter) {\n          value = settings.url_converter.call(settings.url_converter_scope || getContext(), value, name, $elm[0]);\n        }\n\n        $elm.attr('data-mce-' + name, value).attr(name, value);\n      },\n      get: function ($elm, name) {\n        return $elm.attr('data-mce-' + name) || $elm.attr(name);\n      }\n    };\n    var attrHooks = {\n      style: {\n        set: function ($elm, value) {\n          if (value !== null && typeof value === 'object') {\n            $elm.css(value);\n            return;\n          }\n\n          if (keepValues) {\n            $elm.attr('data-mce-style', value);\n          }\n\n          if (value !== null && typeof value === 'string') {\n            $elm.removeAttr('style');\n            $elm.css(styles.parse(value));\n          } else {\n            $elm.attr('style', value);\n          }\n        },\n        get: function ($elm) {\n          var value = $elm.attr('data-mce-style') || $elm.attr('style');\n          value = styles.serialize(styles.parse(value), $elm[0].nodeName);\n          return value;\n        }\n      }\n    };\n\n    if (keepValues) {\n      attrHooks.href = attrHooks.src = keepUrlHook;\n    }\n\n    return attrHooks;\n  };\n\n  var updateInternalStyleAttr = function (styles, $elm) {\n    var rawValue = $elm.attr('style');\n    var value = styles.serialize(styles.parse(rawValue), $elm[0].nodeName);\n\n    if (!value) {\n      value = null;\n    }\n\n    $elm.attr('data-mce-style', value);\n  };\n\n  var findNodeIndex = function (node, normalized) {\n    var idx = 0,\n        lastNodeType,\n        nodeType;\n\n    if (node) {\n      for (lastNodeType = node.nodeType, node = node.previousSibling; node; node = node.previousSibling) {\n        nodeType = node.nodeType;\n\n        if (normalized && nodeType === 3) {\n          if (nodeType === lastNodeType || !node.nodeValue.length) {\n            continue;\n          }\n        }\n\n        idx++;\n        lastNodeType = nodeType;\n      }\n    }\n\n    return idx;\n  };\n\n  function DOMUtils(doc, settings) {\n    var _this = this;\n\n    if (settings === void 0) {\n      settings = {};\n    }\n\n    var addedStyles = {};\n    var win = window;\n    var files = {};\n    var counter = 0;\n    var stdMode = true;\n    var boxModel = true;\n    var styleSheetLoader = instance.forElement(SugarElement.fromDom(doc), {\n      contentCssCors: settings.contentCssCors,\n      referrerPolicy: settings.referrerPolicy\n    });\n    var boundEvents = [];\n    var schema = settings.schema ? settings.schema : Schema({});\n    var styles = Styles({\n      url_converter: settings.url_converter,\n      url_converter_scope: settings.url_converter_scope\n    }, settings.schema);\n    var events = settings.ownEvents ? new EventUtils() : EventUtils.Event;\n    var blockElementsMap = schema.getBlockElements();\n    var $ = DomQuery.overrideDefaults(function () {\n      return {\n        context: doc,\n        element: self.getRoot()\n      };\n    });\n\n    var isBlock = function (node) {\n      if (typeof node === 'string') {\n        return !!blockElementsMap[node];\n      } else if (node) {\n        var type = node.nodeType;\n\n        if (type) {\n          return !!(type === 1 && blockElementsMap[node.nodeName]);\n        }\n      }\n\n      return false;\n    };\n\n    var get = function (elm) {\n      return elm && doc && isString(elm) ? doc.getElementById(elm) : elm;\n    };\n\n    var $$ = function (elm) {\n      return $(typeof elm === 'string' ? get(elm) : elm);\n    };\n\n    var getAttrib = function (elm, name, defaultVal) {\n      var hook, value;\n      var $elm = $$(elm);\n\n      if ($elm.length) {\n        hook = attrHooks[name];\n\n        if (hook && hook.get) {\n          value = hook.get($elm, name);\n        } else {\n          value = $elm.attr(name);\n        }\n      }\n\n      if (typeof value === 'undefined') {\n        value = defaultVal || '';\n      }\n\n      return value;\n    };\n\n    var getAttribs = function (elm) {\n      var node = get(elm);\n\n      if (!node) {\n        return [];\n      }\n\n      return node.attributes;\n    };\n\n    var setAttrib = function (elm, name, value) {\n      if (value === '') {\n        value = null;\n      }\n\n      var $elm = $$(elm);\n      var originalValue = $elm.attr(name);\n\n      if (!$elm.length) {\n        return;\n      }\n\n      var hook = attrHooks[name];\n\n      if (hook && hook.set) {\n        hook.set($elm, value, name);\n      } else {\n        $elm.attr(name, value);\n      }\n\n      if (originalValue !== value && settings.onSetAttrib) {\n        settings.onSetAttrib({\n          attrElm: $elm,\n          attrName: name,\n          attrValue: value\n        });\n      }\n    };\n\n    var clone = function (node, deep) {\n      if (!isIE || node.nodeType !== 1 || deep) {\n        return node.cloneNode(deep);\n      } else {\n        var clone_1 = doc.createElement(node.nodeName);\n        each$5(getAttribs(node), function (attr) {\n          setAttrib(clone_1, attr.nodeName, getAttrib(node, attr.nodeName));\n        });\n        return clone_1;\n      }\n    };\n\n    var getRoot = function () {\n      return settings.root_element || doc.body;\n    };\n\n    var getViewPort = function (argWin) {\n      var vp = getBounds(argWin);\n      return {\n        x: vp.x,\n        y: vp.y,\n        w: vp.width,\n        h: vp.height\n      };\n    };\n\n    var getPos$1 = function (elm, rootElm) {\n      return getPos(doc.body, get(elm), rootElm);\n    };\n\n    var setStyle = function (elm, name, value) {\n      var $elm = isString(name) ? $$(elm).css(name, value) : $$(elm).css(name);\n\n      if (settings.update_styles) {\n        updateInternalStyleAttr(styles, $elm);\n      }\n    };\n\n    var setStyles = function (elm, stylesArg) {\n      var $elm = $$(elm).css(stylesArg);\n\n      if (settings.update_styles) {\n        updateInternalStyleAttr(styles, $elm);\n      }\n    };\n\n    var getStyle = function (elm, name, computed) {\n      var $elm = $$(elm);\n\n      if (computed) {\n        return $elm.css(name);\n      }\n\n      name = name.replace(/-(\\D)/g, function (a, b) {\n        return b.toUpperCase();\n      });\n\n      if (name === 'float') {\n        name = Env.browser.isIE() ? 'styleFloat' : 'cssFloat';\n      }\n\n      return $elm[0] && $elm[0].style ? $elm[0].style[name] : undefined;\n    };\n\n    var getSize = function (elm) {\n      var w, h;\n      elm = get(elm);\n      w = getStyle(elm, 'width');\n      h = getStyle(elm, 'height');\n\n      if (w.indexOf('px') === -1) {\n        w = 0;\n      }\n\n      if (h.indexOf('px') === -1) {\n        h = 0;\n      }\n\n      return {\n        w: parseInt(w, 10) || elm.offsetWidth || elm.clientWidth,\n        h: parseInt(h, 10) || elm.offsetHeight || elm.clientHeight\n      };\n    };\n\n    var getRect = function (elm) {\n      elm = get(elm);\n      var pos = getPos$1(elm);\n      var size = getSize(elm);\n      return {\n        x: pos.x,\n        y: pos.y,\n        w: size.w,\n        h: size.h\n      };\n    };\n\n    var is = function (elm, selector) {\n      var i;\n\n      if (!elm) {\n        return false;\n      }\n\n      if (!Array.isArray(elm)) {\n        if (selector === '*') {\n          return elm.nodeType === 1;\n        }\n\n        if (simpleSelectorRe.test(selector)) {\n          var selectors = selector.toLowerCase().split(/,/);\n          var elmName = elm.nodeName.toLowerCase();\n\n          for (i = selectors.length - 1; i >= 0; i--) {\n            if (selectors[i] === elmName) {\n              return true;\n            }\n          }\n\n          return false;\n        }\n\n        if (elm.nodeType && elm.nodeType !== 1) {\n          return false;\n        }\n      }\n\n      var elms = !Array.isArray(elm) ? [elm] : elm;\n      return Sizzle(selector, elms[0].ownerDocument || elms[0], null, elms).length > 0;\n    };\n\n    var getParents = function (elm, selector, root, collect) {\n      var result = [];\n      var selectorVal;\n      var node = get(elm);\n      collect = collect === undefined;\n      root = root || (getRoot().nodeName !== 'BODY' ? getRoot().parentNode : null);\n\n      if (Tools.is(selector, 'string')) {\n        selectorVal = selector;\n\n        if (selector === '*') {\n          selector = function (node) {\n            return node.nodeType === 1;\n          };\n        } else {\n          selector = function (node) {\n            return is(node, selectorVal);\n          };\n        }\n      }\n\n      while (node) {\n        if (node === root || !node.nodeType || node.nodeType === 9) {\n          break;\n        }\n\n        if (!selector || typeof selector === 'function' && selector(node)) {\n          if (collect) {\n            result.push(node);\n          } else {\n            return [node];\n          }\n        }\n\n        node = node.parentNode;\n      }\n\n      return collect ? result : null;\n    };\n\n    var getParent = function (node, selector, root) {\n      var parents = getParents(node, selector, root, false);\n      return parents && parents.length > 0 ? parents[0] : null;\n    };\n\n    var _findSib = function (node, selector, name) {\n      var func = selector;\n\n      if (node) {\n        if (typeof selector === 'string') {\n          func = function (node) {\n            return is(node, selector);\n          };\n        }\n\n        for (node = node[name]; node; node = node[name]) {\n          if (typeof func === 'function' && func(node)) {\n            return node;\n          }\n        }\n      }\n\n      return null;\n    };\n\n    var getNext = function (node, selector) {\n      return _findSib(node, selector, 'nextSibling');\n    };\n\n    var getPrev = function (node, selector) {\n      return _findSib(node, selector, 'previousSibling');\n    };\n\n    var select = function (selector, scope) {\n      return Sizzle(selector, get(scope) || settings.root_element || doc, []);\n    };\n\n    var run = function (elm, func, scope) {\n      var result;\n      var node = typeof elm === 'string' ? get(elm) : elm;\n\n      if (!node) {\n        return false;\n      }\n\n      if (Tools.isArray(node) && (node.length || node.length === 0)) {\n        result = [];\n        each$5(node, function (elm, i) {\n          if (elm) {\n            result.push(func.call(scope, typeof elm === 'string' ? get(elm) : elm, i));\n          }\n        });\n        return result;\n      }\n\n      var context = scope ? scope : _this;\n      return func.call(context, node);\n    };\n\n    var setAttribs = function (elm, attrs) {\n      $$(elm).each(function (i, node) {\n        each$5(attrs, function (value, name) {\n          setAttrib(node, name, value);\n        });\n      });\n    };\n\n    var setHTML = function (elm, html) {\n      var $elm = $$(elm);\n\n      if (isIE) {\n        $elm.each(function (i, target) {\n          if (target.canHaveHTML === false) {\n            return;\n          }\n\n          while (target.firstChild) {\n            target.removeChild(target.firstChild);\n          }\n\n          try {\n            target.innerHTML = '<br>' + html;\n            target.removeChild(target.firstChild);\n          } catch (ex) {\n            DomQuery('<div></div>').html('<br>' + html).contents().slice(1).appendTo(target);\n          }\n\n          return html;\n        });\n      } else {\n        $elm.html(html);\n      }\n    };\n\n    var add = function (parentElm, name, attrs, html, create) {\n      return run(parentElm, function (parentElm) {\n        var newElm = typeof name === 'string' ? doc.createElement(name) : name;\n        setAttribs(newElm, attrs);\n\n        if (html) {\n          if (typeof html !== 'string' && html.nodeType) {\n            newElm.appendChild(html);\n          } else if (typeof html === 'string') {\n            setHTML(newElm, html);\n          }\n        }\n\n        return !create ? parentElm.appendChild(newElm) : newElm;\n      });\n    };\n\n    var create = function (name, attrs, html) {\n      return add(doc.createElement(name), name, attrs, html, true);\n    };\n\n    var decode = Entities.decode;\n    var encode = Entities.encodeAllRaw;\n\n    var createHTML = function (name, attrs, html) {\n      var outHtml = '',\n          key;\n      outHtml += '<' + name;\n\n      for (key in attrs) {\n        if (attrs.hasOwnProperty(key) && attrs[key] !== null && typeof attrs[key] !== 'undefined') {\n          outHtml += ' ' + key + '=\"' + encode(attrs[key]) + '\"';\n        }\n      }\n\n      if (typeof html !== 'undefined') {\n        return outHtml + '>' + html + '</' + name + '>';\n      }\n\n      return outHtml + ' />';\n    };\n\n    var createFragment = function (html) {\n      var node;\n      var container = doc.createElement('div');\n      var frag = doc.createDocumentFragment();\n      frag.appendChild(container);\n\n      if (html) {\n        container.innerHTML = html;\n      }\n\n      while (node = container.firstChild) {\n        frag.appendChild(node);\n      }\n\n      frag.removeChild(container);\n      return frag;\n    };\n\n    var remove = function (node, keepChildren) {\n      var $node = $$(node);\n\n      if (keepChildren) {\n        $node.each(function () {\n          var child;\n\n          while (child = this.firstChild) {\n            if (child.nodeType === 3 && child.data.length === 0) {\n              this.removeChild(child);\n            } else {\n              this.parentNode.insertBefore(child, this);\n            }\n          }\n        }).remove();\n      } else {\n        $node.remove();\n      }\n\n      return $node.length > 1 ? $node.toArray() : $node[0];\n    };\n\n    var removeAllAttribs = function (e) {\n      return run(e, function (e) {\n        var i;\n        var attrs = e.attributes;\n\n        for (i = attrs.length - 1; i >= 0; i--) {\n          e.removeAttributeNode(attrs.item(i));\n        }\n      });\n    };\n\n    var parseStyle = function (cssText) {\n      return styles.parse(cssText);\n    };\n\n    var serializeStyle = function (stylesArg, name) {\n      return styles.serialize(stylesArg, name);\n    };\n\n    var addStyle = function (cssText) {\n      var head, styleElm;\n\n      if (self !== DOMUtils.DOM && doc === document) {\n        if (addedStyles[cssText]) {\n          return;\n        }\n\n        addedStyles[cssText] = true;\n      }\n\n      styleElm = doc.getElementById('mceDefaultStyles');\n\n      if (!styleElm) {\n        styleElm = doc.createElement('style');\n        styleElm.id = 'mceDefaultStyles';\n        styleElm.type = 'text/css';\n        head = doc.getElementsByTagName('head')[0];\n\n        if (head.firstChild) {\n          head.insertBefore(styleElm, head.firstChild);\n        } else {\n          head.appendChild(styleElm);\n        }\n      }\n\n      if (styleElm.styleSheet) {\n        styleElm.styleSheet.cssText += cssText;\n      } else {\n        styleElm.appendChild(doc.createTextNode(cssText));\n      }\n    };\n\n    var loadCSS = function (urls) {\n      if (!urls) {\n        urls = '';\n      }\n\n      each(urls.split(','), function (url) {\n        files[url] = true;\n        styleSheetLoader.load(url, noop);\n      });\n    };\n\n    var toggleClass = function (elm, cls, state) {\n      $$(elm).toggleClass(cls, state).each(function () {\n        if (this.className === '') {\n          DomQuery(this).attr('class', null);\n        }\n      });\n    };\n\n    var addClass = function (elm, cls) {\n      $$(elm).addClass(cls);\n    };\n\n    var removeClass = function (elm, cls) {\n      toggleClass(elm, cls, false);\n    };\n\n    var hasClass = function (elm, cls) {\n      return $$(elm).hasClass(cls);\n    };\n\n    var show = function (elm) {\n      $$(elm).show();\n    };\n\n    var hide = function (elm) {\n      $$(elm).hide();\n    };\n\n    var isHidden = function (elm) {\n      return $$(elm).css('display') === 'none';\n    };\n\n    var uniqueId = function (prefix) {\n      return (!prefix ? 'mce_' : prefix) + counter++;\n    };\n\n    var getOuterHTML = function (elm) {\n      var node = typeof elm === 'string' ? get(elm) : elm;\n      return isElement$1(node) ? node.outerHTML : DomQuery('<div></div>').append(DomQuery(node).clone()).html();\n    };\n\n    var setOuterHTML = function (elm, html) {\n      $$(elm).each(function () {\n        try {\n          if ('outerHTML' in this) {\n            this.outerHTML = html;\n            return;\n          }\n        } catch (ex) {}\n\n        remove(DomQuery(this).html(html), true);\n      });\n    };\n\n    var insertAfter = function (node, reference) {\n      var referenceNode = get(reference);\n      return run(node, function (node) {\n        var parent = referenceNode.parentNode;\n        var nextSibling = referenceNode.nextSibling;\n\n        if (nextSibling) {\n          parent.insertBefore(node, nextSibling);\n        } else {\n          parent.appendChild(node);\n        }\n\n        return node;\n      });\n    };\n\n    var replace = function (newElm, oldElm, keepChildren) {\n      return run(oldElm, function (oldElm) {\n        if (Tools.is(oldElm, 'array')) {\n          newElm = newElm.cloneNode(true);\n        }\n\n        if (keepChildren) {\n          each$5(grep$1(oldElm.childNodes), function (node) {\n            newElm.appendChild(node);\n          });\n        }\n\n        return oldElm.parentNode.replaceChild(newElm, oldElm);\n      });\n    };\n\n    var rename = function (elm, name) {\n      var newElm;\n\n      if (elm.nodeName !== name.toUpperCase()) {\n        newElm = create(name);\n        each$5(getAttribs(elm), function (attrNode) {\n          setAttrib(newElm, attrNode.nodeName, getAttrib(elm, attrNode.nodeName));\n        });\n        replace(newElm, elm, true);\n      }\n\n      return newElm || elm;\n    };\n\n    var findCommonAncestor = function (a, b) {\n      var ps = a,\n          pe;\n\n      while (ps) {\n        pe = b;\n\n        while (pe && ps !== pe) {\n          pe = pe.parentNode;\n        }\n\n        if (ps === pe) {\n          break;\n        }\n\n        ps = ps.parentNode;\n      }\n\n      if (!ps && a.ownerDocument) {\n        return a.ownerDocument.documentElement;\n      }\n\n      return ps;\n    };\n\n    var toHex = function (rgbVal) {\n      return styles.toHex(Tools.trim(rgbVal));\n    };\n\n    var isNonEmptyElement = function (node) {\n      if (isElement$1(node)) {\n        var isNamedAnchor = node.nodeName.toLowerCase() === 'a' && !getAttrib(node, 'href') && getAttrib(node, 'id');\n\n        if (getAttrib(node, 'name') || getAttrib(node, 'data-mce-bookmark') || isNamedAnchor) {\n          return true;\n        }\n      }\n\n      return false;\n    };\n\n    var isEmpty = function (node, elements) {\n      var type,\n          name,\n          brCount = 0;\n\n      if (isNonEmptyElement(node)) {\n        return false;\n      }\n\n      node = node.firstChild;\n\n      if (node) {\n        var walker = new DomTreeWalker(node, node.parentNode);\n        var whitespace = schema ? schema.getWhiteSpaceElements() : {};\n        elements = elements || (schema ? schema.getNonEmptyElements() : null);\n\n        do {\n          type = node.nodeType;\n\n          if (isElement$1(node)) {\n            var bogusVal = node.getAttribute('data-mce-bogus');\n\n            if (bogusVal) {\n              node = walker.next(bogusVal === 'all');\n              continue;\n            }\n\n            name = node.nodeName.toLowerCase();\n\n            if (elements && elements[name]) {\n              if (name === 'br') {\n                brCount++;\n                node = walker.next();\n                continue;\n              }\n\n              return false;\n            }\n\n            if (isNonEmptyElement(node)) {\n              return false;\n            }\n          }\n\n          if (type === 8) {\n            return false;\n          }\n\n          if (type === 3 && !isWhitespaceText(node.nodeValue)) {\n            return false;\n          }\n\n          if (type === 3 && node.parentNode && whitespace[node.parentNode.nodeName] && isWhitespaceText(node.nodeValue)) {\n            return false;\n          }\n\n          node = walker.next();\n        } while (node);\n      }\n\n      return brCount <= 1;\n    };\n\n    var createRng = function () {\n      return doc.createRange();\n    };\n\n    var split = function (parentElm, splitElm, replacementElm) {\n      var range = createRng();\n      var beforeFragment;\n      var afterFragment;\n      var parentNode;\n\n      if (parentElm && splitElm) {\n        range.setStart(parentElm.parentNode, findNodeIndex(parentElm));\n        range.setEnd(splitElm.parentNode, findNodeIndex(splitElm));\n        beforeFragment = range.extractContents();\n        range = createRng();\n        range.setStart(splitElm.parentNode, findNodeIndex(splitElm) + 1);\n        range.setEnd(parentElm.parentNode, findNodeIndex(parentElm) + 1);\n        afterFragment = range.extractContents();\n        parentNode = parentElm.parentNode;\n        parentNode.insertBefore(trimNode(self, beforeFragment), parentElm);\n\n        if (replacementElm) {\n          parentNode.insertBefore(replacementElm, parentElm);\n        } else {\n          parentNode.insertBefore(splitElm, parentElm);\n        }\n\n        parentNode.insertBefore(trimNode(self, afterFragment), parentElm);\n        remove(parentElm);\n        return replacementElm || splitElm;\n      }\n    };\n\n    var bind = function (target, name, func, scope) {\n      if (Tools.isArray(target)) {\n        var i = target.length;\n        var rv = [];\n\n        while (i--) {\n          rv[i] = bind(target[i], name, func, scope);\n        }\n\n        return rv;\n      }\n\n      if (settings.collect && (target === doc || target === win)) {\n        boundEvents.push([target, name, func, scope]);\n      }\n\n      var output = events.bind(target, name, func, scope || self);\n      return output;\n    };\n\n    var unbind = function (target, name, func) {\n      if (Tools.isArray(target)) {\n        var i = target.length;\n        var rv = [];\n\n        while (i--) {\n          rv[i] = unbind(target[i], name, func);\n        }\n\n        return rv;\n      } else {\n        if (boundEvents.length > 0 && (target === doc || target === win)) {\n          var i = boundEvents.length;\n\n          while (i--) {\n            var item = boundEvents[i];\n\n            if (target === item[0] && (!name || name === item[1]) && (!func || func === item[2])) {\n              events.unbind(item[0], item[1], item[2]);\n            }\n          }\n        }\n\n        return events.unbind(target, name, func);\n      }\n    };\n\n    var fire = function (target, name, evt) {\n      return events.fire(target, name, evt);\n    };\n\n    var getContentEditable = function (node) {\n      if (node && isElement$1(node)) {\n        var contentEditable = node.getAttribute('data-mce-contenteditable');\n\n        if (contentEditable && contentEditable !== 'inherit') {\n          return contentEditable;\n        }\n\n        return node.contentEditable !== 'inherit' ? node.contentEditable : null;\n      } else {\n        return null;\n      }\n    };\n\n    var getContentEditableParent = function (node) {\n      var root = getRoot();\n      var state = null;\n\n      for (; node && node !== root; node = node.parentNode) {\n        state = getContentEditable(node);\n\n        if (state !== null) {\n          break;\n        }\n      }\n\n      return state;\n    };\n\n    var destroy = function () {\n      if (boundEvents.length > 0) {\n        var i = boundEvents.length;\n\n        while (i--) {\n          var item = boundEvents[i];\n          events.unbind(item[0], item[1], item[2]);\n        }\n      }\n\n      each$1(files, function (_, url) {\n        styleSheetLoader.unload(url);\n        delete files[url];\n      });\n\n      if (Sizzle.setDocument) {\n        Sizzle.setDocument();\n      }\n    };\n\n    var isChildOf = function (node, parent) {\n      while (node) {\n        if (parent === node) {\n          return true;\n        }\n\n        node = node.parentNode;\n      }\n\n      return false;\n    };\n\n    var dumpRng = function (r) {\n      return 'startContainer: ' + r.startContainer.nodeName + ', startOffset: ' + r.startOffset + ', endContainer: ' + r.endContainer.nodeName + ', endOffset: ' + r.endOffset;\n    };\n\n    var self = {\n      doc: doc,\n      settings: settings,\n      win: win,\n      files: files,\n      stdMode: stdMode,\n      boxModel: boxModel,\n      styleSheetLoader: styleSheetLoader,\n      boundEvents: boundEvents,\n      styles: styles,\n      schema: schema,\n      events: events,\n      isBlock: isBlock,\n      $: $,\n      $$: $$,\n      root: null,\n      clone: clone,\n      getRoot: getRoot,\n      getViewPort: getViewPort,\n      getRect: getRect,\n      getSize: getSize,\n      getParent: getParent,\n      getParents: getParents,\n      get: get,\n      getNext: getNext,\n      getPrev: getPrev,\n      select: select,\n      is: is,\n      add: add,\n      create: create,\n      createHTML: createHTML,\n      createFragment: createFragment,\n      remove: remove,\n      setStyle: setStyle,\n      getStyle: getStyle,\n      setStyles: setStyles,\n      removeAllAttribs: removeAllAttribs,\n      setAttrib: setAttrib,\n      setAttribs: setAttribs,\n      getAttrib: getAttrib,\n      getPos: getPos$1,\n      parseStyle: parseStyle,\n      serializeStyle: serializeStyle,\n      addStyle: addStyle,\n      loadCSS: loadCSS,\n      addClass: addClass,\n      removeClass: removeClass,\n      hasClass: hasClass,\n      toggleClass: toggleClass,\n      show: show,\n      hide: hide,\n      isHidden: isHidden,\n      uniqueId: uniqueId,\n      setHTML: setHTML,\n      getOuterHTML: getOuterHTML,\n      setOuterHTML: setOuterHTML,\n      decode: decode,\n      encode: encode,\n      insertAfter: insertAfter,\n      replace: replace,\n      rename: rename,\n      findCommonAncestor: findCommonAncestor,\n      toHex: toHex,\n      run: run,\n      getAttribs: getAttribs,\n      isEmpty: isEmpty,\n      createRng: createRng,\n      nodeIndex: findNodeIndex,\n      split: split,\n      bind: bind,\n      unbind: unbind,\n      fire: fire,\n      getContentEditable: getContentEditable,\n      getContentEditableParent: getContentEditableParent,\n      destroy: destroy,\n      isChildOf: isChildOf,\n      dumpRng: dumpRng\n    };\n    var attrHooks = setupAttrHooks(styles, settings, function () {\n      return self;\n    });\n    return self;\n  }\n\n  (function (DOMUtils) {\n    DOMUtils.DOM = DOMUtils(document);\n    DOMUtils.nodeIndex = findNodeIndex;\n  })(DOMUtils || (DOMUtils = {}));\n\n  var DOMUtils$1 = DOMUtils;\n  var DOM = DOMUtils$1.DOM;\n  var each$6 = Tools.each,\n      grep$2 = Tools.grep;\n  var QUEUED = 0;\n  var LOADING = 1;\n  var LOADED = 2;\n  var FAILED = 3;\n\n  var ScriptLoader = function () {\n    function ScriptLoader(settings) {\n      if (settings === void 0) {\n        settings = {};\n      }\n\n      this.states = {};\n      this.queue = [];\n      this.scriptLoadedCallbacks = {};\n      this.queueLoadedCallbacks = [];\n      this.loading = 0;\n      this.settings = settings;\n    }\n\n    ScriptLoader.prototype._setReferrerPolicy = function (referrerPolicy) {\n      this.settings.referrerPolicy = referrerPolicy;\n    };\n\n    ScriptLoader.prototype.loadScript = function (url, success, failure) {\n      var dom = DOM;\n      var elm;\n\n      var done = function () {\n        dom.remove(id);\n\n        if (elm) {\n          elm.onreadystatechange = elm.onload = elm = null;\n        }\n\n        success();\n      };\n\n      var error = function () {\n        if (isFunction(failure)) {\n          failure();\n        } else {\n          if (typeof console !== 'undefined' && console.log) {\n            console.log('Failed to load script: ' + url);\n          }\n        }\n      };\n\n      var id = dom.uniqueId();\n      elm = document.createElement('script');\n      elm.id = id;\n      elm.type = 'text/javascript';\n      elm.src = Tools._addCacheSuffix(url);\n\n      if (this.settings.referrerPolicy) {\n        dom.setAttrib(elm, 'referrerpolicy', this.settings.referrerPolicy);\n      }\n\n      elm.onload = done;\n      elm.onerror = error;\n      (document.getElementsByTagName('head')[0] || document.body).appendChild(elm);\n    };\n\n    ScriptLoader.prototype.isDone = function (url) {\n      return this.states[url] === LOADED;\n    };\n\n    ScriptLoader.prototype.markDone = function (url) {\n      this.states[url] = LOADED;\n    };\n\n    ScriptLoader.prototype.add = function (url, success, scope, failure) {\n      var state = this.states[url];\n\n      if (state === undefined) {\n        this.queue.push(url);\n        this.states[url] = QUEUED;\n      }\n\n      if (success) {\n        if (!this.scriptLoadedCallbacks[url]) {\n          this.scriptLoadedCallbacks[url] = [];\n        }\n\n        this.scriptLoadedCallbacks[url].push({\n          success: success,\n          failure: failure,\n          scope: scope || this\n        });\n      }\n    };\n\n    ScriptLoader.prototype.load = function (url, success, scope, failure) {\n      return this.add(url, success, scope, failure);\n    };\n\n    ScriptLoader.prototype.remove = function (url) {\n      delete this.states[url];\n      delete this.scriptLoadedCallbacks[url];\n    };\n\n    ScriptLoader.prototype.loadQueue = function (success, scope, failure) {\n      this.loadScripts(this.queue, success, scope, failure);\n    };\n\n    ScriptLoader.prototype.loadScripts = function (scripts, success, scope, failure) {\n      var self = this;\n      var failures = [];\n\n      var execCallbacks = function (name, url) {\n        each$6(self.scriptLoadedCallbacks[url], function (callback) {\n          if (isFunction(callback[name])) {\n            callback[name].call(callback.scope);\n          }\n        });\n        self.scriptLoadedCallbacks[url] = undefined;\n      };\n\n      self.queueLoadedCallbacks.push({\n        success: success,\n        failure: failure,\n        scope: scope || this\n      });\n\n      var loadScripts = function () {\n        var loadingScripts = grep$2(scripts);\n        scripts.length = 0;\n        each$6(loadingScripts, function (url) {\n          if (self.states[url] === LOADED) {\n            execCallbacks('success', url);\n            return;\n          }\n\n          if (self.states[url] === FAILED) {\n            execCallbacks('failure', url);\n            return;\n          }\n\n          if (self.states[url] !== LOADING) {\n            self.states[url] = LOADING;\n            self.loading++;\n            self.loadScript(url, function () {\n              self.states[url] = LOADED;\n              self.loading--;\n              execCallbacks('success', url);\n              loadScripts();\n            }, function () {\n              self.states[url] = FAILED;\n              self.loading--;\n              failures.push(url);\n              execCallbacks('failure', url);\n              loadScripts();\n            });\n          }\n        });\n\n        if (!self.loading) {\n          var notifyCallbacks = self.queueLoadedCallbacks.slice(0);\n          self.queueLoadedCallbacks.length = 0;\n          each$6(notifyCallbacks, function (callback) {\n            if (failures.length === 0) {\n              if (isFunction(callback.success)) {\n                callback.success.call(callback.scope);\n              }\n            } else {\n              if (isFunction(callback.failure)) {\n                callback.failure.call(callback.scope, failures);\n              }\n            }\n          });\n        }\n      };\n\n      loadScripts();\n    };\n\n    ScriptLoader.ScriptLoader = new ScriptLoader();\n    return ScriptLoader;\n  }();\n\n  var Cell = function (initial) {\n    var value = initial;\n\n    var get = function () {\n      return value;\n    };\n\n    var set = function (v) {\n      value = v;\n    };\n\n    return {\n      get: get,\n      set: set\n    };\n  };\n\n  var isRaw = function (str) {\n    return isObject(str) && has(str, 'raw');\n  };\n\n  var isTokenised = function (str) {\n    return isArray(str) && str.length > 1;\n  };\n\n  var data = {};\n  var currentCode = Cell('en');\n\n  var getLanguageData = function () {\n    return get(data, currentCode.get());\n  };\n\n  var getData = function () {\n    return map$1(data, function (value) {\n      return __assign({}, value);\n    });\n  };\n\n  var setCode = function (newCode) {\n    if (newCode) {\n      currentCode.set(newCode);\n    }\n  };\n\n  var getCode = function () {\n    return currentCode.get();\n  };\n\n  var add = function (code, items) {\n    var langData = data[code];\n\n    if (!langData) {\n      data[code] = langData = {};\n    }\n\n    each$1(items, function (translation, name) {\n      langData[name.toLowerCase()] = translation;\n    });\n  };\n\n  var translate = function (text) {\n    var langData = getLanguageData().getOr({});\n\n    var toString = function (obj) {\n      if (isFunction(obj)) {\n        return Object.prototype.toString.call(obj);\n      }\n\n      return !isEmpty(obj) ? '' + obj : '';\n    };\n\n    var isEmpty = function (text) {\n      return text === '' || text === null || text === undefined;\n    };\n\n    var getLangData = function (text) {\n      var textstr = toString(text);\n      return get(langData, textstr.toLowerCase()).map(toString).getOr(textstr);\n    };\n\n    var removeContext = function (str) {\n      return str.replace(/{context:\\w+}$/, '');\n    };\n\n    if (isEmpty(text)) {\n      return '';\n    }\n\n    if (isRaw(text)) {\n      return toString(text.raw);\n    }\n\n    if (isTokenised(text)) {\n      var values_1 = text.slice(1);\n      var substitued = getLangData(text[0]).replace(/\\{([0-9]+)\\}/g, function ($1, $2) {\n        return has(values_1, $2) ? toString(values_1[$2]) : $1;\n      });\n      return removeContext(substitued);\n    }\n\n    return removeContext(getLangData(text));\n  };\n\n  var isRtl = function () {\n    return getLanguageData().bind(function (items) {\n      return get(items, '_dir');\n    }).exists(function (dir) {\n      return dir === 'rtl';\n    });\n  };\n\n  var hasCode = function (code) {\n    return has(data, code);\n  };\n\n  var I18n = {\n    getData: getData,\n    setCode: setCode,\n    getCode: getCode,\n    add: add,\n    translate: translate,\n    isRtl: isRtl,\n    hasCode: hasCode\n  };\n\n  function AddOnManager() {\n    var _this = this;\n\n    var items = [];\n    var urls = {};\n    var lookup = {};\n    var _listeners = [];\n\n    var runListeners = function (name, state) {\n      var matchedListeners = filter(_listeners, function (listener) {\n        return listener.name === name && listener.state === state;\n      });\n      each(matchedListeners, function (listener) {\n        return listener.callback();\n      });\n    };\n\n    var get = function (name) {\n      if (lookup[name]) {\n        return lookup[name].instance;\n      }\n\n      return undefined;\n    };\n\n    var dependencies = function (name) {\n      var result;\n\n      if (lookup[name]) {\n        result = lookup[name].dependencies;\n      }\n\n      return result || [];\n    };\n\n    var requireLangPack = function (name, languages) {\n      if (AddOnManager.languageLoad !== false) {\n        waitFor(name, function () {\n          var language = I18n.getCode();\n          var wrappedLanguages = ',' + (languages || '') + ',';\n\n          if (!language || languages && wrappedLanguages.indexOf(',' + language + ',') === -1) {\n            return;\n          }\n\n          ScriptLoader.ScriptLoader.add(urls[name] + '/langs/' + language + '.js');\n        }, 'loaded');\n      }\n    };\n\n    var add = function (id, addOn, dependencies) {\n      var addOnConstructor = addOn;\n      items.push(addOnConstructor);\n      lookup[id] = {\n        instance: addOnConstructor,\n        dependencies: dependencies\n      };\n      runListeners(id, 'added');\n      return addOnConstructor;\n    };\n\n    var remove = function (name) {\n      delete urls[name];\n      delete lookup[name];\n    };\n\n    var createUrl = function (baseUrl, dep) {\n      if (typeof dep === 'object') {\n        return dep;\n      }\n\n      return typeof baseUrl === 'string' ? {\n        prefix: '',\n        resource: dep,\n        suffix: ''\n      } : {\n        prefix: baseUrl.prefix,\n        resource: dep,\n        suffix: baseUrl.suffix\n      };\n    };\n\n    var addComponents = function (pluginName, scripts) {\n      var pluginUrl = _this.urls[pluginName];\n      each(scripts, function (script) {\n        ScriptLoader.ScriptLoader.add(pluginUrl + '/' + script);\n      });\n    };\n\n    var loadDependencies = function (name, addOnUrl, success, scope) {\n      var deps = dependencies(name);\n      each(deps, function (dep) {\n        var newUrl = createUrl(addOnUrl, dep);\n        load(newUrl.resource, newUrl, undefined, undefined);\n      });\n\n      if (success) {\n        if (scope) {\n          success.call(scope);\n        } else {\n          success.call(ScriptLoader);\n        }\n      }\n    };\n\n    var load = function (name, addOnUrl, success, scope, failure) {\n      if (urls[name]) {\n        return;\n      }\n\n      var urlString = typeof addOnUrl === 'string' ? addOnUrl : addOnUrl.prefix + addOnUrl.resource + addOnUrl.suffix;\n\n      if (urlString.indexOf('/') !== 0 && urlString.indexOf('://') === -1) {\n        urlString = AddOnManager.baseURL + '/' + urlString;\n      }\n\n      urls[name] = urlString.substring(0, urlString.lastIndexOf('/'));\n\n      var done = function () {\n        runListeners(name, 'loaded');\n        loadDependencies(name, addOnUrl, success, scope);\n      };\n\n      if (lookup[name]) {\n        done();\n      } else {\n        ScriptLoader.ScriptLoader.add(urlString, done, scope, failure);\n      }\n    };\n\n    var waitFor = function (name, callback, state) {\n      if (state === void 0) {\n        state = 'added';\n      }\n\n      if (has(lookup, name) && state === 'added') {\n        callback();\n      } else if (has(urls, name) && state === 'loaded') {\n        callback();\n      } else {\n        _listeners.push({\n          name: name,\n          state: state,\n          callback: callback\n        });\n      }\n    };\n\n    return {\n      items: items,\n      urls: urls,\n      lookup: lookup,\n      _listeners: _listeners,\n      get: get,\n      dependencies: dependencies,\n      requireLangPack: requireLangPack,\n      add: add,\n      remove: remove,\n      createUrl: createUrl,\n      addComponents: addComponents,\n      load: load,\n      waitFor: waitFor\n    };\n  }\n\n  (function (AddOnManager) {\n    AddOnManager.PluginManager = AddOnManager();\n    AddOnManager.ThemeManager = AddOnManager();\n  })(AddOnManager || (AddOnManager = {}));\n\n  var AddOnManager$1 = AddOnManager;\n\n  var first = function (fn, rate) {\n    var timer = null;\n\n    var cancel = function () {\n      if (timer !== null) {\n        clearTimeout(timer);\n        timer = null;\n      }\n    };\n\n    var throttle = function () {\n      var args = [];\n\n      for (var _i = 0; _i < arguments.length; _i++) {\n        args[_i] = arguments[_i];\n      }\n\n      if (timer === null) {\n        timer = setTimeout(function () {\n          fn.apply(null, args);\n          timer = null;\n        }, rate);\n      }\n    };\n\n    return {\n      cancel: cancel,\n      throttle: throttle\n    };\n  };\n\n  var last$2 = function (fn, rate) {\n    var timer = null;\n\n    var cancel = function () {\n      if (timer !== null) {\n        clearTimeout(timer);\n        timer = null;\n      }\n    };\n\n    var throttle = function () {\n      var args = [];\n\n      for (var _i = 0; _i < arguments.length; _i++) {\n        args[_i] = arguments[_i];\n      }\n\n      if (timer !== null) {\n        clearTimeout(timer);\n      }\n\n      timer = setTimeout(function () {\n        fn.apply(null, args);\n        timer = null;\n      }, rate);\n    };\n\n    return {\n      cancel: cancel,\n      throttle: throttle\n    };\n  };\n\n  var read = function (element, attr) {\n    var value = get$3(element, attr);\n    return value === undefined || value === '' ? [] : value.split(' ');\n  };\n\n  var add$1 = function (element, attr, id) {\n    var old = read(element, attr);\n    var nu = old.concat([id]);\n    set(element, attr, nu.join(' '));\n    return true;\n  };\n\n  var remove$2 = function (element, attr, id) {\n    var nu = filter(read(element, attr), function (v) {\n      return v !== id;\n    });\n\n    if (nu.length > 0) {\n      set(element, attr, nu.join(' '));\n    } else {\n      remove$1(element, attr);\n    }\n\n    return false;\n  };\n\n  var supports = function (element) {\n    return element.dom.classList !== undefined;\n  };\n\n  var get$5 = function (element) {\n    return read(element, 'class');\n  };\n\n  var add$2 = function (element, clazz) {\n    return add$1(element, 'class', clazz);\n  };\n\n  var remove$3 = function (element, clazz) {\n    return remove$2(element, 'class', clazz);\n  };\n\n  var add$3 = function (element, clazz) {\n    if (supports(element)) {\n      element.dom.classList.add(clazz);\n    } else {\n      add$2(element, clazz);\n    }\n  };\n\n  var cleanClass = function (element) {\n    var classList = supports(element) ? element.dom.classList : get$5(element);\n\n    if (classList.length === 0) {\n      remove$1(element, 'class');\n    }\n  };\n\n  var remove$4 = function (element, clazz) {\n    if (supports(element)) {\n      var classList = element.dom.classList;\n      classList.remove(clazz);\n    } else {\n      remove$3(element, clazz);\n    }\n\n    cleanClass(element);\n  };\n\n  var has$2 = function (element, clazz) {\n    return supports(element) && element.dom.classList.contains(clazz);\n  };\n\n  var descendants = function (scope, predicate) {\n    var result = [];\n    each(children(scope), function (x) {\n      if (predicate(x)) {\n        result = result.concat([x]);\n      }\n\n      result = result.concat(descendants(x, predicate));\n    });\n    return result;\n  };\n\n  var descendants$1 = function (scope, selector) {\n    return all(selector, scope);\n  };\n\n  var annotation = constant('mce-annotation');\n  var dataAnnotation = constant('data-mce-annotation');\n  var dataAnnotationId = constant('data-mce-annotation-uid');\n\n  var identify = function (editor, annotationName) {\n    var rng = editor.selection.getRng();\n    var start = SugarElement.fromDom(rng.startContainer);\n    var root = SugarElement.fromDom(editor.getBody());\n    var selector = annotationName.fold(function () {\n      return '.' + annotation();\n    }, function (an) {\n      return '[' + dataAnnotation() + '=\"' + an + '\"]';\n    });\n    var newStart = child(start, rng.startOffset).getOr(start);\n    var closest = closest$1(newStart, selector, function (n) {\n      return eq$2(n, root);\n    });\n\n    var getAttr = function (c, property) {\n      if (has$1(c, property)) {\n        return Optional.some(get$3(c, property));\n      } else {\n        return Optional.none();\n      }\n    };\n\n    return closest.bind(function (c) {\n      return getAttr(c, '' + dataAnnotationId()).bind(function (uid) {\n        return getAttr(c, '' + dataAnnotation()).map(function (name) {\n          var elements = findMarkers(editor, uid);\n          return {\n            uid: uid,\n            name: name,\n            elements: elements\n          };\n        });\n      });\n    });\n  };\n\n  var isAnnotation = function (elem) {\n    return isElement(elem) && has$2(elem, annotation());\n  };\n\n  var findMarkers = function (editor, uid) {\n    var body = SugarElement.fromDom(editor.getBody());\n    return descendants$1(body, '[' + dataAnnotationId() + '=\"' + uid + '\"]');\n  };\n\n  var findAll = function (editor, name) {\n    var body = SugarElement.fromDom(editor.getBody());\n    var markers = descendants$1(body, '[' + dataAnnotation() + '=\"' + name + '\"]');\n    var directory = {};\n    each(markers, function (m) {\n      var uid = get$3(m, dataAnnotationId());\n      var nodesAlready = directory.hasOwnProperty(uid) ? directory[uid] : [];\n      directory[uid] = nodesAlready.concat([m]);\n    });\n    return directory;\n  };\n\n  var setup = function (editor, _registry) {\n    var changeCallbacks = Cell({});\n\n    var initData = function () {\n      return {\n        listeners: [],\n        previous: Cell(Optional.none())\n      };\n    };\n\n    var withCallbacks = function (name, f) {\n      updateCallbacks(name, function (data) {\n        f(data);\n        return data;\n      });\n    };\n\n    var updateCallbacks = function (name, f) {\n      var callbackMap = changeCallbacks.get();\n      var data = callbackMap.hasOwnProperty(name) ? callbackMap[name] : initData();\n      var outputData = f(data);\n      callbackMap[name] = outputData;\n      changeCallbacks.set(callbackMap);\n    };\n\n    var fireCallbacks = function (name, uid, elements) {\n      withCallbacks(name, function (data) {\n        each(data.listeners, function (f) {\n          return f(true, name, {\n            uid: uid,\n            nodes: map(elements, function (elem) {\n              return elem.dom;\n            })\n          });\n        });\n      });\n    };\n\n    var fireNoAnnotation = function (name) {\n      withCallbacks(name, function (data) {\n        each(data.listeners, function (f) {\n          return f(false, name);\n        });\n      });\n    };\n\n    var onNodeChange = last$2(function () {\n      var callbackMap = changeCallbacks.get();\n      var annotations = sort$1(keys(callbackMap));\n      each(annotations, function (name) {\n        updateCallbacks(name, function (data) {\n          var prev = data.previous.get();\n          identify(editor, Optional.some(name)).fold(function () {\n            if (prev.isSome()) {\n              fireNoAnnotation(name);\n              data.previous.set(Optional.none());\n            }\n          }, function (_a) {\n            var uid = _a.uid,\n                name = _a.name,\n                elements = _a.elements;\n\n            if (!prev.is(uid)) {\n              fireCallbacks(name, uid, elements);\n              data.previous.set(Optional.some(uid));\n            }\n          });\n          return {\n            previous: data.previous,\n            listeners: data.listeners\n          };\n        });\n      });\n    }, 30);\n    editor.on('remove', function () {\n      onNodeChange.cancel();\n    });\n    editor.on('NodeChange', function () {\n      onNodeChange.throttle();\n    });\n\n    var addListener = function (name, f) {\n      updateCallbacks(name, function (data) {\n        return {\n          previous: data.previous,\n          listeners: data.listeners.concat([f])\n        };\n      });\n    };\n\n    return {\n      addListener: addListener\n    };\n  };\n\n  var setup$1 = function (editor, registry) {\n    var identifyParserNode = function (span) {\n      return Optional.from(span.attr(dataAnnotation())).bind(registry.lookup);\n    };\n\n    editor.on('init', function () {\n      editor.serializer.addNodeFilter('span', function (spans) {\n        each(spans, function (span) {\n          identifyParserNode(span).each(function (settings) {\n            if (settings.persistent === false) {\n              span.unwrap();\n            }\n          });\n        });\n      });\n    });\n  };\n\n  var create$2 = function () {\n    var annotations = {};\n\n    var register = function (name, settings) {\n      annotations[name] = {\n        name: name,\n        settings: settings\n      };\n    };\n\n    var lookup = function (name) {\n      return annotations.hasOwnProperty(name) ? Optional.from(annotations[name]).map(function (a) {\n        return a.settings;\n      }) : Optional.none();\n    };\n\n    return {\n      register: register,\n      lookup: lookup\n    };\n  };\n\n  var unique = 0;\n\n  var generate$1 = function (prefix) {\n    var date = new Date();\n    var time = date.getTime();\n    var random = Math.floor(Math.random() * 1000000000);\n    unique++;\n    return prefix + '_' + random + unique + String(time);\n  };\n\n  var add$4 = function (element, classes) {\n    each(classes, function (x) {\n      add$3(element, x);\n    });\n  };\n\n  var fromHtml$1 = function (html, scope) {\n    var doc = scope || document;\n    var div = doc.createElement('div');\n    div.innerHTML = html;\n    return children(SugarElement.fromDom(div));\n  };\n\n  var get$6 = function (element) {\n    return element.dom.innerHTML;\n  };\n\n  var set$1 = function (element, content) {\n    var owner$1 = owner(element);\n    var docDom = owner$1.dom;\n    var fragment = SugarElement.fromDom(docDom.createDocumentFragment());\n    var contentElements = fromHtml$1(content, docDom);\n    append$1(fragment, contentElements);\n    empty(element);\n    append(element, fragment);\n  };\n\n  var clone$1 = function (original, isDeep) {\n    return SugarElement.fromDom(original.dom.cloneNode(isDeep));\n  };\n\n  var shallow = function (original) {\n    return clone$1(original, false);\n  };\n\n  var deep = function (original) {\n    return clone$1(original, true);\n  };\n\n  var TextWalker = function (startNode, rootNode, isBoundary) {\n    if (isBoundary === void 0) {\n      isBoundary = never;\n    }\n\n    var walker = new DomTreeWalker(startNode, rootNode);\n\n    var walk = function (direction) {\n      var next;\n\n      do {\n        next = walker[direction]();\n      } while (next && !isText$1(next) && !isBoundary(next));\n\n      return Optional.from(next).filter(isText$1);\n    };\n\n    return {\n      current: function () {\n        return Optional.from(walker.current()).filter(isText$1);\n      },\n      next: function () {\n        return walk('next');\n      },\n      prev: function () {\n        return walk('prev');\n      },\n      prev2: function () {\n        return walk('prev2');\n      }\n    };\n  };\n\n  var TextSeeker = function (dom, isBoundary) {\n    var isBlockBoundary = isBoundary ? isBoundary : function (node) {\n      return dom.isBlock(node) || isBr(node) || isContentEditableFalse(node);\n    };\n\n    var walk = function (node, offset, walker, process) {\n      if (isText$1(node)) {\n        var newOffset = process(node, offset, node.data);\n\n        if (newOffset !== -1) {\n          return Optional.some({\n            container: node,\n            offset: newOffset\n          });\n        }\n      }\n\n      return walker().bind(function (next) {\n        return walk(next.container, next.offset, walker, process);\n      });\n    };\n\n    var backwards = function (node, offset, process, root) {\n      var walker = TextWalker(node, root, isBlockBoundary);\n      return walk(node, offset, function () {\n        return walker.prev().map(function (prev) {\n          return {\n            container: prev,\n            offset: prev.length\n          };\n        });\n      }, process).getOrNull();\n    };\n\n    var forwards = function (node, offset, process, root) {\n      var walker = TextWalker(node, root, isBlockBoundary);\n      return walk(node, offset, function () {\n        return walker.next().map(function (next) {\n          return {\n            container: next,\n            offset: 0\n          };\n        });\n      }, process).getOrNull();\n    };\n\n    return {\n      backwards: backwards,\n      forwards: forwards\n    };\n  };\n\n  var cat = function (arr) {\n    var r = [];\n\n    var push = function (x) {\n      r.push(x);\n    };\n\n    for (var i = 0; i < arr.length; i++) {\n      arr[i].each(push);\n    }\n\n    return r;\n  };\n\n  var lift2 = function (oa, ob, f) {\n    return oa.isSome() && ob.isSome() ? Optional.some(f(oa.getOrDie(), ob.getOrDie())) : Optional.none();\n  };\n\n  var lift3 = function (oa, ob, oc, f) {\n    return oa.isSome() && ob.isSome() && oc.isSome() ? Optional.some(f(oa.getOrDie(), ob.getOrDie(), oc.getOrDie())) : Optional.none();\n  };\n\n  var someIf = function (b, a) {\n    return b ? Optional.some(a) : Optional.none();\n  };\n\n  var round = Math.round;\n\n  var clone$2 = function (rect) {\n    if (!rect) {\n      return {\n        left: 0,\n        top: 0,\n        bottom: 0,\n        right: 0,\n        width: 0,\n        height: 0\n      };\n    }\n\n    return {\n      left: round(rect.left),\n      top: round(rect.top),\n      bottom: round(rect.bottom),\n      right: round(rect.right),\n      width: round(rect.width),\n      height: round(rect.height)\n    };\n  };\n\n  var collapse = function (rect, toStart) {\n    rect = clone$2(rect);\n\n    if (toStart) {\n      rect.right = rect.left;\n    } else {\n      rect.left = rect.left + rect.width;\n      rect.right = rect.left;\n    }\n\n    rect.width = 0;\n    return rect;\n  };\n\n  var isEqual = function (rect1, rect2) {\n    return rect1.left === rect2.left && rect1.top === rect2.top && rect1.bottom === rect2.bottom && rect1.right === rect2.right;\n  };\n\n  var isValidOverflow = function (overflowY, rect1, rect2) {\n    return overflowY >= 0 && overflowY <= Math.min(rect1.height, rect2.height) / 2;\n  };\n\n  var isAbove = function (rect1, rect2) {\n    var halfHeight = Math.min(rect2.height / 2, rect1.height / 2);\n\n    if (rect1.bottom - halfHeight < rect2.top) {\n      return true;\n    }\n\n    if (rect1.top > rect2.bottom) {\n      return false;\n    }\n\n    return isValidOverflow(rect2.top - rect1.bottom, rect1, rect2);\n  };\n\n  var isBelow = function (rect1, rect2) {\n    if (rect1.top > rect2.bottom) {\n      return true;\n    }\n\n    if (rect1.bottom < rect2.top) {\n      return false;\n    }\n\n    return isValidOverflow(rect2.bottom - rect1.top, rect1, rect2);\n  };\n\n  var containsXY = function (rect, clientX, clientY) {\n    return clientX >= rect.left && clientX <= rect.right && clientY >= rect.top && clientY <= rect.bottom;\n  };\n\n  var getSelectedNode = function (range) {\n    var startContainer = range.startContainer,\n        startOffset = range.startOffset;\n\n    if (startContainer.hasChildNodes() && range.endOffset === startOffset + 1) {\n      return startContainer.childNodes[startOffset];\n    }\n\n    return null;\n  };\n\n  var getNode = function (container, offset) {\n    if (container.nodeType === 1 && container.hasChildNodes()) {\n      if (offset >= container.childNodes.length) {\n        offset = container.childNodes.length - 1;\n      }\n\n      container = container.childNodes[offset];\n    }\n\n    return container;\n  };\n\n  var extendingChars = new RegExp('[\\u0300-\\u036f\\u0483-\\u0487\\u0488-\\u0489\\u0591-\\u05bd\\u05bf\\u05c1-\\u05c2\\u05c4-\\u05c5\\u05c7\\u0610-\\u061a' + '\\u064b-\\u065f\\u0670\\u06d6-\\u06dc\\u06df-\\u06e4\\u06e7-\\u06e8\\u06ea-\\u06ed\\u0711\\u0730-\\u074a\\u07a6-\\u07b0' + '\\u07eb-\\u07f3\\u0816-\\u0819\\u081b-\\u0823\\u0825-\\u0827\\u0829-\\u082d\\u0859-\\u085b\\u08e3-\\u0902\\u093a\\u093c' + '\\u0941-\\u0948\\u094d\\u0951-\\u0957\\u0962-\\u0963\\u0981\\u09bc\\u09be\\u09c1-\\u09c4\\u09cd\\u09d7\\u09e2-\\u09e3' + '\\u0a01-\\u0a02\\u0a3c\\u0a41-\\u0a42\\u0a47-\\u0a48\\u0a4b-\\u0a4d\\u0a51\\u0a70-\\u0a71\\u0a75\\u0a81-\\u0a82\\u0abc' + '\\u0ac1-\\u0ac5\\u0ac7-\\u0ac8\\u0acd\\u0ae2-\\u0ae3\\u0b01\\u0b3c\\u0b3e\\u0b3f\\u0b41-\\u0b44\\u0b4d\\u0b56\\u0b57' + '\\u0b62-\\u0b63\\u0b82\\u0bbe\\u0bc0\\u0bcd\\u0bd7\\u0c00\\u0c3e-\\u0c40\\u0c46-\\u0c48\\u0c4a-\\u0c4d\\u0c55-\\u0c56' + '\\u0c62-\\u0c63\\u0c81\\u0cbc\\u0cbf\\u0cc2\\u0cc6\\u0ccc-\\u0ccd\\u0cd5-\\u0cd6\\u0ce2-\\u0ce3\\u0d01\\u0d3e\\u0d41-\\u0d44' + '\\u0d4d\\u0d57\\u0d62-\\u0d63\\u0dca\\u0dcf\\u0dd2-\\u0dd4\\u0dd6\\u0ddf\\u0e31\\u0e34-\\u0e3a\\u0e47-\\u0e4e\\u0eb1\\u0eb4-\\u0eb9' + '\\u0ebb-\\u0ebc\\u0ec8-\\u0ecd\\u0f18-\\u0f19\\u0f35\\u0f37\\u0f39\\u0f71-\\u0f7e\\u0f80-\\u0f84\\u0f86-\\u0f87\\u0f8d-\\u0f97' + '\\u0f99-\\u0fbc\\u0fc6\\u102d-\\u1030\\u1032-\\u1037\\u1039-\\u103a\\u103d-\\u103e\\u1058-\\u1059\\u105e-\\u1060\\u1071-\\u1074' + '\\u1082\\u1085-\\u1086\\u108d\\u109d\\u135d-\\u135f\\u1712-\\u1714\\u1732-\\u1734\\u1752-\\u1753\\u1772-\\u1773\\u17b4-\\u17b5' + '\\u17b7-\\u17bd\\u17c6\\u17c9-\\u17d3\\u17dd\\u180b-\\u180d\\u18a9\\u1920-\\u1922\\u1927-\\u1928\\u1932\\u1939-\\u193b\\u1a17-\\u1a18' + '\\u1a1b\\u1a56\\u1a58-\\u1a5e\\u1a60\\u1a62\\u1a65-\\u1a6c\\u1a73-\\u1a7c\\u1a7f\\u1ab0-\\u1abd\\u1ABE\\u1b00-\\u1b03\\u1b34' + '\\u1b36-\\u1b3a\\u1b3c\\u1b42\\u1b6b-\\u1b73\\u1b80-\\u1b81\\u1ba2-\\u1ba5\\u1ba8-\\u1ba9\\u1bab-\\u1bad\\u1be6\\u1be8-\\u1be9' + '\\u1bed\\u1bef-\\u1bf1\\u1c2c-\\u1c33\\u1c36-\\u1c37\\u1cd0-\\u1cd2\\u1cd4-\\u1ce0\\u1ce2-\\u1ce8\\u1ced\\u1cf4\\u1cf8-\\u1cf9' + '\\u1dc0-\\u1df5\\u1dfc-\\u1dff\\u200c-\\u200d\\u20d0-\\u20dc\\u20DD-\\u20E0\\u20e1\\u20E2-\\u20E4\\u20e5-\\u20f0\\u2cef-\\u2cf1' + '\\u2d7f\\u2de0-\\u2dff\\u302a-\\u302d\\u302e-\\u302f\\u3099-\\u309a\\ua66f\\uA670-\\uA672\\ua674-\\ua67d\\ua69e-\\ua69f\\ua6f0-\\ua6f1' + '\\ua802\\ua806\\ua80b\\ua825-\\ua826\\ua8c4\\ua8e0-\\ua8f1\\ua926-\\ua92d\\ua947-\\ua951\\ua980-\\ua982\\ua9b3\\ua9b6-\\ua9b9\\ua9bc' + '\\ua9e5\\uaa29-\\uaa2e\\uaa31-\\uaa32\\uaa35-\\uaa36\\uaa43\\uaa4c\\uaa7c\\uaab0\\uaab2-\\uaab4\\uaab7-\\uaab8\\uaabe-\\uaabf\\uaac1' + '\\uaaec-\\uaaed\\uaaf6\\uabe5\\uabe8\\uabed\\ufb1e\\ufe00-\\ufe0f\\ufe20-\\ufe2f\\uff9e-\\uff9f]');\n\n  var isExtendingChar = function (ch) {\n    return typeof ch === 'string' && ch.charCodeAt(0) >= 768 && extendingChars.test(ch);\n  };\n\n  var or = function () {\n    var args = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n\n    return function (x) {\n      for (var i = 0; i < args.length; i++) {\n        if (args[i](x)) {\n          return true;\n        }\n      }\n\n      return false;\n    };\n  };\n\n  var and = function () {\n    var args = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n\n    return function (x) {\n      for (var i = 0; i < args.length; i++) {\n        if (!args[i](x)) {\n          return false;\n        }\n      }\n\n      return true;\n    };\n  };\n\n  var isElement$3 = isElement$1;\n  var isCaretCandidate$1 = isCaretCandidate;\n  var isBlock$1 = matchStyleValues('display', 'block table');\n  var isFloated = matchStyleValues('float', 'left right');\n  var isValidElementCaretCandidate = and(isElement$3, isCaretCandidate$1, not(isFloated));\n  var isNotPre = not(matchStyleValues('white-space', 'pre pre-line pre-wrap'));\n  var isText$4 = isText$1;\n  var isBr$3 = isBr;\n  var nodeIndex = DOMUtils$1.nodeIndex;\n  var resolveIndex = getNode;\n\n  var createRange = function (doc) {\n    return 'createRange' in doc ? doc.createRange() : DOMUtils$1.DOM.createRng();\n  };\n\n  var isWhiteSpace = function (chr) {\n    return chr && /[\\r\\n\\t ]/.test(chr);\n  };\n\n  var isRange = function (rng) {\n    return !!rng.setStart && !!rng.setEnd;\n  };\n\n  var isHiddenWhiteSpaceRange = function (range) {\n    var container = range.startContainer;\n    var offset = range.startOffset;\n    var text;\n\n    if (isWhiteSpace(range.toString()) && isNotPre(container.parentNode) && isText$1(container)) {\n      text = container.data;\n\n      if (isWhiteSpace(text[offset - 1]) || isWhiteSpace(text[offset + 1])) {\n        return true;\n      }\n    }\n\n    return false;\n  };\n\n  var getBrClientRect = function (brNode) {\n    var doc = brNode.ownerDocument;\n    var rng = createRange(doc);\n    var nbsp$1 = doc.createTextNode(nbsp);\n    var parentNode = brNode.parentNode;\n    parentNode.insertBefore(nbsp$1, brNode);\n    rng.setStart(nbsp$1, 0);\n    rng.setEnd(nbsp$1, 1);\n    var clientRect = clone$2(rng.getBoundingClientRect());\n    parentNode.removeChild(nbsp$1);\n    return clientRect;\n  };\n\n  var getBoundingClientRectWebKitText = function (rng) {\n    var sc = rng.startContainer;\n    var ec = rng.endContainer;\n    var so = rng.startOffset;\n    var eo = rng.endOffset;\n\n    if (sc === ec && isText$1(ec) && so === 0 && eo === 1) {\n      var newRng = rng.cloneRange();\n      newRng.setEndAfter(ec);\n      return getBoundingClientRect(newRng);\n    } else {\n      return null;\n    }\n  };\n\n  var isZeroRect = function (r) {\n    return r.left === 0 && r.right === 0 && r.top === 0 && r.bottom === 0;\n  };\n\n  var getBoundingClientRect = function (item) {\n    var clientRect;\n    var clientRects = item.getClientRects();\n\n    if (clientRects.length > 0) {\n      clientRect = clone$2(clientRects[0]);\n    } else {\n      clientRect = clone$2(item.getBoundingClientRect());\n    }\n\n    if (!isRange(item) && isBr$3(item) && isZeroRect(clientRect)) {\n      return getBrClientRect(item);\n    }\n\n    if (isZeroRect(clientRect) && isRange(item)) {\n      return getBoundingClientRectWebKitText(item);\n    }\n\n    return clientRect;\n  };\n\n  var collapseAndInflateWidth = function (clientRect, toStart) {\n    var newClientRect = collapse(clientRect, toStart);\n    newClientRect.width = 1;\n    newClientRect.right = newClientRect.left + 1;\n    return newClientRect;\n  };\n\n  var getCaretPositionClientRects = function (caretPosition) {\n    var clientRects = [];\n    var beforeNode, node;\n\n    var addUniqueAndValidRect = function (clientRect) {\n      if (clientRect.height === 0) {\n        return;\n      }\n\n      if (clientRects.length > 0) {\n        if (isEqual(clientRect, clientRects[clientRects.length - 1])) {\n          return;\n        }\n      }\n\n      clientRects.push(clientRect);\n    };\n\n    var addCharacterOffset = function (container, offset) {\n      var range = createRange(container.ownerDocument);\n\n      if (offset < container.data.length) {\n        if (isExtendingChar(container.data[offset])) {\n          return clientRects;\n        }\n\n        if (isExtendingChar(container.data[offset - 1])) {\n          range.setStart(container, offset);\n          range.setEnd(container, offset + 1);\n\n          if (!isHiddenWhiteSpaceRange(range)) {\n            addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(range), false));\n            return clientRects;\n          }\n        }\n      }\n\n      if (offset > 0) {\n        range.setStart(container, offset - 1);\n        range.setEnd(container, offset);\n\n        if (!isHiddenWhiteSpaceRange(range)) {\n          addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(range), false));\n        }\n      }\n\n      if (offset < container.data.length) {\n        range.setStart(container, offset);\n        range.setEnd(container, offset + 1);\n\n        if (!isHiddenWhiteSpaceRange(range)) {\n          addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(range), true));\n        }\n      }\n    };\n\n    if (isText$4(caretPosition.container())) {\n      addCharacterOffset(caretPosition.container(), caretPosition.offset());\n      return clientRects;\n    }\n\n    if (isElement$3(caretPosition.container())) {\n      if (caretPosition.isAtEnd()) {\n        node = resolveIndex(caretPosition.container(), caretPosition.offset());\n\n        if (isText$4(node)) {\n          addCharacterOffset(node, node.data.length);\n        }\n\n        if (isValidElementCaretCandidate(node) && !isBr$3(node)) {\n          addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(node), false));\n        }\n      } else {\n        node = resolveIndex(caretPosition.container(), caretPosition.offset());\n\n        if (isText$4(node)) {\n          addCharacterOffset(node, 0);\n        }\n\n        if (isValidElementCaretCandidate(node) && caretPosition.isAtEnd()) {\n          addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(node), false));\n          return clientRects;\n        }\n\n        beforeNode = resolveIndex(caretPosition.container(), caretPosition.offset() - 1);\n\n        if (isValidElementCaretCandidate(beforeNode) && !isBr$3(beforeNode)) {\n          if (isBlock$1(beforeNode) || isBlock$1(node) || !isValidElementCaretCandidate(node)) {\n            addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(beforeNode), false));\n          }\n        }\n\n        if (isValidElementCaretCandidate(node)) {\n          addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(node), true));\n        }\n      }\n    }\n\n    return clientRects;\n  };\n\n  function CaretPosition(container, offset, clientRects) {\n    var isAtStart = function () {\n      if (isText$4(container)) {\n        return offset === 0;\n      }\n\n      return offset === 0;\n    };\n\n    var isAtEnd = function () {\n      if (isText$4(container)) {\n        return offset >= container.data.length;\n      }\n\n      return offset >= container.childNodes.length;\n    };\n\n    var toRange = function () {\n      var range = createRange(container.ownerDocument);\n      range.setStart(container, offset);\n      range.setEnd(container, offset);\n      return range;\n    };\n\n    var getClientRects = function () {\n      if (!clientRects) {\n        clientRects = getCaretPositionClientRects(CaretPosition(container, offset));\n      }\n\n      return clientRects;\n    };\n\n    var isVisible = function () {\n      return getClientRects().length > 0;\n    };\n\n    var isEqual = function (caretPosition) {\n      return caretPosition && container === caretPosition.container() && offset === caretPosition.offset();\n    };\n\n    var getNode = function (before) {\n      return resolveIndex(container, before ? offset - 1 : offset);\n    };\n\n    return {\n      container: constant(container),\n      offset: constant(offset),\n      toRange: toRange,\n      getClientRects: getClientRects,\n      isVisible: isVisible,\n      isAtStart: isAtStart,\n      isAtEnd: isAtEnd,\n      isEqual: isEqual,\n      getNode: getNode\n    };\n  }\n\n  (function (CaretPosition) {\n    CaretPosition.fromRangeStart = function (range) {\n      return CaretPosition(range.startContainer, range.startOffset);\n    };\n\n    CaretPosition.fromRangeEnd = function (range) {\n      return CaretPosition(range.endContainer, range.endOffset);\n    };\n\n    CaretPosition.after = function (node) {\n      return CaretPosition(node.parentNode, nodeIndex(node) + 1);\n    };\n\n    CaretPosition.before = function (node) {\n      return CaretPosition(node.parentNode, nodeIndex(node));\n    };\n\n    CaretPosition.isAbove = function (pos1, pos2) {\n      return lift2(head(pos2.getClientRects()), last(pos1.getClientRects()), isAbove).getOr(false);\n    };\n\n    CaretPosition.isBelow = function (pos1, pos2) {\n      return lift2(last(pos2.getClientRects()), head(pos1.getClientRects()), isBelow).getOr(false);\n    };\n\n    CaretPosition.isAtStart = function (pos) {\n      return pos ? pos.isAtStart() : false;\n    };\n\n    CaretPosition.isAtEnd = function (pos) {\n      return pos ? pos.isAtEnd() : false;\n    };\n\n    CaretPosition.isTextPosition = function (pos) {\n      return pos ? isText$1(pos.container()) : false;\n    };\n\n    CaretPosition.isElementPosition = function (pos) {\n      return CaretPosition.isTextPosition(pos) === false;\n    };\n  })(CaretPosition || (CaretPosition = {}));\n\n  var CaretPosition$1 = CaretPosition;\n\n  var trimEmptyTextNode = function (dom, node) {\n    if (isText$1(node) && node.data.length === 0) {\n      dom.remove(node);\n    }\n  };\n\n  var insertNode = function (dom, rng, node) {\n    rng.insertNode(node);\n    trimEmptyTextNode(dom, node.previousSibling);\n    trimEmptyTextNode(dom, node.nextSibling);\n  };\n\n  var insertFragment = function (dom, rng, frag) {\n    var firstChild = Optional.from(frag.firstChild);\n    var lastChild = Optional.from(frag.lastChild);\n    rng.insertNode(frag);\n    firstChild.each(function (child) {\n      return trimEmptyTextNode(dom, child.previousSibling);\n    });\n    lastChild.each(function (child) {\n      return trimEmptyTextNode(dom, child.nextSibling);\n    });\n  };\n\n  var rangeInsertNode = function (dom, rng, node) {\n    if (isDocumentFragment$1(node)) {\n      insertFragment(dom, rng, node);\n    } else {\n      insertNode(dom, rng, node);\n    }\n  };\n\n  var isText$5 = isText$1;\n  var isBogus$2 = isBogus;\n  var nodeIndex$1 = DOMUtils$1.nodeIndex;\n\n  var normalizedParent = function (node) {\n    var parentNode = node.parentNode;\n\n    if (isBogus$2(parentNode)) {\n      return normalizedParent(parentNode);\n    }\n\n    return parentNode;\n  };\n\n  var getChildNodes = function (node) {\n    if (!node) {\n      return [];\n    }\n\n    return reduce(node.childNodes, function (result, node) {\n      if (isBogus$2(node) && node.nodeName !== 'BR') {\n        result = result.concat(getChildNodes(node));\n      } else {\n        result.push(node);\n      }\n\n      return result;\n    }, []);\n  };\n\n  var normalizedTextOffset = function (node, offset) {\n    while (node = node.previousSibling) {\n      if (!isText$5(node)) {\n        break;\n      }\n\n      offset += node.data.length;\n    }\n\n    return offset;\n  };\n\n  var equal$1 = function (a) {\n    return function (b) {\n      return a === b;\n    };\n  };\n\n  var normalizedNodeIndex = function (node) {\n    var nodes, index;\n    nodes = getChildNodes(normalizedParent(node));\n    index = findIndex$1(nodes, equal$1(node), node);\n    nodes = nodes.slice(0, index + 1);\n    var numTextFragments = reduce(nodes, function (result, node, i) {\n      if (isText$5(node) && isText$5(nodes[i - 1])) {\n        result++;\n      }\n\n      return result;\n    }, 0);\n    nodes = filter$2(nodes, matchNodeNames([node.nodeName]));\n    index = findIndex$1(nodes, equal$1(node), node);\n    return index - numTextFragments;\n  };\n\n  var createPathItem = function (node) {\n    var name;\n\n    if (isText$5(node)) {\n      name = 'text()';\n    } else {\n      name = node.nodeName.toLowerCase();\n    }\n\n    return name + '[' + normalizedNodeIndex(node) + ']';\n  };\n\n  var parentsUntil = function (root, node, predicate) {\n    var parents = [];\n\n    for (node = node.parentNode; node !== root; node = node.parentNode) {\n      if (predicate && predicate(node)) {\n        break;\n      }\n\n      parents.push(node);\n    }\n\n    return parents;\n  };\n\n  var create$3 = function (root, caretPosition) {\n    var container,\n        offset,\n        path = [],\n        outputOffset,\n        childNodes,\n        parents;\n    container = caretPosition.container();\n    offset = caretPosition.offset();\n\n    if (isText$5(container)) {\n      outputOffset = normalizedTextOffset(container, offset);\n    } else {\n      childNodes = container.childNodes;\n\n      if (offset >= childNodes.length) {\n        outputOffset = 'after';\n        offset = childNodes.length - 1;\n      } else {\n        outputOffset = 'before';\n      }\n\n      container = childNodes[offset];\n    }\n\n    path.push(createPathItem(container));\n    parents = parentsUntil(root, container);\n    parents = filter$2(parents, not(isBogus));\n    path = path.concat(map$2(parents, function (node) {\n      return createPathItem(node);\n    }));\n    return path.reverse().join('/') + ',' + outputOffset;\n  };\n\n  var resolvePathItem = function (node, name, index) {\n    var nodes = getChildNodes(node);\n    nodes = filter$2(nodes, function (node, index) {\n      return !isText$5(node) || !isText$5(nodes[index - 1]);\n    });\n    nodes = filter$2(nodes, matchNodeNames([name]));\n    return nodes[index];\n  };\n\n  var findTextPosition = function (container, offset) {\n    var node = container,\n        targetOffset = 0,\n        dataLen;\n\n    while (isText$5(node)) {\n      dataLen = node.data.length;\n\n      if (offset >= targetOffset && offset <= targetOffset + dataLen) {\n        container = node;\n        offset = offset - targetOffset;\n        break;\n      }\n\n      if (!isText$5(node.nextSibling)) {\n        container = node;\n        offset = dataLen;\n        break;\n      }\n\n      targetOffset += dataLen;\n      node = node.nextSibling;\n    }\n\n    if (isText$5(container) && offset > container.data.length) {\n      offset = container.data.length;\n    }\n\n    return CaretPosition$1(container, offset);\n  };\n\n  var resolve$1 = function (root, path) {\n    var offset;\n\n    if (!path) {\n      return null;\n    }\n\n    var parts = path.split(',');\n    var paths = parts[0].split('/');\n    offset = parts.length > 1 ? parts[1] : 'before';\n    var container = reduce(paths, function (result, value) {\n      var match = /([\\w\\-\\(\\)]+)\\[([0-9]+)\\]/.exec(value);\n\n      if (!match) {\n        return null;\n      }\n\n      if (match[1] === 'text()') {\n        match[1] = '#text';\n      }\n\n      return resolvePathItem(result, match[1], parseInt(match[2], 10));\n    }, root);\n\n    if (!container) {\n      return null;\n    }\n\n    if (!isText$5(container)) {\n      if (offset === 'after') {\n        offset = nodeIndex$1(container) + 1;\n      } else {\n        offset = nodeIndex$1(container);\n      }\n\n      return CaretPosition$1(container.parentNode, offset);\n    }\n\n    return findTextPosition(container, parseInt(offset, 10));\n  };\n\n  var isContentEditableFalse$2 = isContentEditableFalse;\n\n  var getNormalizedTextOffset = function (trim, container, offset) {\n    var node, trimmedOffset;\n    trimmedOffset = trim(container.data.slice(0, offset)).length;\n\n    for (node = container.previousSibling; node && isText$1(node); node = node.previousSibling) {\n      trimmedOffset += trim(node.data).length;\n    }\n\n    return trimmedOffset;\n  };\n\n  var getPoint = function (dom, trim, normalized, rng, start) {\n    var container = rng[start ? 'startContainer' : 'endContainer'];\n    var offset = rng[start ? 'startOffset' : 'endOffset'];\n    var point = [];\n    var childNodes,\n        after = 0;\n    var root = dom.getRoot();\n\n    if (isText$1(container)) {\n      point.push(normalized ? getNormalizedTextOffset(trim, container, offset) : offset);\n    } else {\n      childNodes = container.childNodes;\n\n      if (offset >= childNodes.length && childNodes.length) {\n        after = 1;\n        offset = Math.max(0, childNodes.length - 1);\n      }\n\n      point.push(dom.nodeIndex(childNodes[offset], normalized) + after);\n    }\n\n    for (; container && container !== root; container = container.parentNode) {\n      point.push(dom.nodeIndex(container, normalized));\n    }\n\n    return point;\n  };\n\n  var getLocation = function (trim, selection, normalized, rng) {\n    var dom = selection.dom,\n        bookmark = {};\n    bookmark.start = getPoint(dom, trim, normalized, rng, true);\n\n    if (!selection.isCollapsed()) {\n      bookmark.end = getPoint(dom, trim, normalized, rng, false);\n    }\n\n    return bookmark;\n  };\n\n  var findIndex$2 = function (dom, name, element) {\n    var count = 0;\n    Tools.each(dom.select(name), function (node) {\n      if (node.getAttribute('data-mce-bogus') === 'all') {\n        return;\n      }\n\n      if (node === element) {\n        return false;\n      }\n\n      count++;\n    });\n    return count;\n  };\n\n  var moveEndPoint = function (rng, start) {\n    var container, offset, childNodes;\n    var prefix = start ? 'start' : 'end';\n    container = rng[prefix + 'Container'];\n    offset = rng[prefix + 'Offset'];\n\n    if (isElement$1(container) && container.nodeName === 'TR') {\n      childNodes = container.childNodes;\n      container = childNodes[Math.min(start ? offset : offset - 1, childNodes.length - 1)];\n\n      if (container) {\n        offset = start ? 0 : container.childNodes.length;\n        rng['set' + (start ? 'Start' : 'End')](container, offset);\n      }\n    }\n  };\n\n  var normalizeTableCellSelection = function (rng) {\n    moveEndPoint(rng, true);\n    moveEndPoint(rng, false);\n    return rng;\n  };\n\n  var findSibling = function (node, offset) {\n    var sibling;\n\n    if (isElement$1(node)) {\n      node = getNode(node, offset);\n\n      if (isContentEditableFalse$2(node)) {\n        return node;\n      }\n    }\n\n    if (isCaretContainer(node)) {\n      if (isText$1(node) && isCaretContainerBlock(node)) {\n        node = node.parentNode;\n      }\n\n      sibling = node.previousSibling;\n\n      if (isContentEditableFalse$2(sibling)) {\n        return sibling;\n      }\n\n      sibling = node.nextSibling;\n\n      if (isContentEditableFalse$2(sibling)) {\n        return sibling;\n      }\n    }\n  };\n\n  var findAdjacentContentEditableFalseElm = function (rng) {\n    return findSibling(rng.startContainer, rng.startOffset) || findSibling(rng.endContainer, rng.endOffset);\n  };\n\n  var getOffsetBookmark = function (trim, normalized, selection) {\n    var element = selection.getNode();\n    var name = element ? element.nodeName : null;\n    var rng = selection.getRng();\n\n    if (isContentEditableFalse$2(element) || name === 'IMG') {\n      return {\n        name: name,\n        index: findIndex$2(selection.dom, name, element)\n      };\n    }\n\n    var sibling = findAdjacentContentEditableFalseElm(rng);\n\n    if (sibling) {\n      name = sibling.tagName;\n      return {\n        name: name,\n        index: findIndex$2(selection.dom, name, sibling)\n      };\n    }\n\n    return getLocation(trim, selection, normalized, rng);\n  };\n\n  var getCaretBookmark = function (selection) {\n    var rng = selection.getRng();\n    return {\n      start: create$3(selection.dom.getRoot(), CaretPosition$1.fromRangeStart(rng)),\n      end: create$3(selection.dom.getRoot(), CaretPosition$1.fromRangeEnd(rng))\n    };\n  };\n\n  var getRangeBookmark = function (selection) {\n    return {\n      rng: selection.getRng()\n    };\n  };\n\n  var createBookmarkSpan = function (dom, id, filled) {\n    var args = {\n      'data-mce-type': 'bookmark',\n      id: id,\n      'style': 'overflow:hidden;line-height:0px'\n    };\n    return filled ? dom.create('span', args, '&#xFEFF;') : dom.create('span', args);\n  };\n\n  var getPersistentBookmark = function (selection, filled) {\n    var dom = selection.dom;\n    var rng = selection.getRng();\n    var id = dom.uniqueId();\n    var collapsed = selection.isCollapsed();\n    var element = selection.getNode();\n    var name = element.nodeName;\n\n    if (name === 'IMG') {\n      return {\n        name: name,\n        index: findIndex$2(dom, name, element)\n      };\n    }\n\n    var rng2 = normalizeTableCellSelection(rng.cloneRange());\n\n    if (!collapsed) {\n      rng2.collapse(false);\n      var endBookmarkNode = createBookmarkSpan(dom, id + '_end', filled);\n      rangeInsertNode(dom, rng2, endBookmarkNode);\n    }\n\n    rng = normalizeTableCellSelection(rng);\n    rng.collapse(true);\n    var startBookmarkNode = createBookmarkSpan(dom, id + '_start', filled);\n    rangeInsertNode(dom, rng, startBookmarkNode);\n    selection.moveToBookmark({\n      id: id,\n      keep: true\n    });\n    return {\n      id: id\n    };\n  };\n\n  var getBookmark = function (selection, type, normalized) {\n    if (type === 2) {\n      return getOffsetBookmark(trim$2, normalized, selection);\n    } else if (type === 3) {\n      return getCaretBookmark(selection);\n    } else if (type) {\n      return getRangeBookmark(selection);\n    } else {\n      return getPersistentBookmark(selection, false);\n    }\n  };\n\n  var getUndoBookmark = curry(getOffsetBookmark, identity, true);\n  var DOM$1 = DOMUtils$1.DOM;\n  var defaultPreviewStyles = 'font-family font-size font-weight font-style text-decoration text-transform color background-color border border-radius outline text-shadow';\n\n  var getBodySetting = function (editor, name, defaultValue) {\n    var value = editor.getParam(name, defaultValue);\n\n    if (value.indexOf('=') !== -1) {\n      var bodyObj = editor.getParam(name, '', 'hash');\n      return bodyObj.hasOwnProperty(editor.id) ? bodyObj[editor.id] : defaultValue;\n    } else {\n      return value;\n    }\n  };\n\n  var getIframeAttrs = function (editor) {\n    return editor.getParam('iframe_attrs', {});\n  };\n\n  var getDocType = function (editor) {\n    return editor.getParam('doctype', '<!DOCTYPE html>');\n  };\n\n  var getDocumentBaseUrl = function (editor) {\n    return editor.getParam('document_base_url', '');\n  };\n\n  var getBodyId = function (editor) {\n    return getBodySetting(editor, 'body_id', 'tinymce');\n  };\n\n  var getBodyClass = function (editor) {\n    return getBodySetting(editor, 'body_class', '');\n  };\n\n  var getContentSecurityPolicy = function (editor) {\n    return editor.getParam('content_security_policy', '');\n  };\n\n  var shouldPutBrInPre = function (editor) {\n    return editor.getParam('br_in_pre', true);\n  };\n\n  var getForcedRootBlock = function (editor) {\n    if (editor.getParam('force_p_newlines', false)) {\n      return 'p';\n    }\n\n    var block = editor.getParam('forced_root_block', 'p');\n\n    if (block === false) {\n      return '';\n    } else if (block === true) {\n      return 'p';\n    } else {\n      return block;\n    }\n  };\n\n  var getForcedRootBlockAttrs = function (editor) {\n    return editor.getParam('forced_root_block_attrs', {});\n  };\n\n  var getBrNewLineSelector = function (editor) {\n    return editor.getParam('br_newline_selector', '.mce-toc h2,figcaption,caption');\n  };\n\n  var getNoNewLineSelector = function (editor) {\n    return editor.getParam('no_newline_selector', '');\n  };\n\n  var shouldKeepStyles = function (editor) {\n    return editor.getParam('keep_styles', true);\n  };\n\n  var shouldEndContainerOnEmptyBlock = function (editor) {\n    return editor.getParam('end_container_on_empty_block', false);\n  };\n\n  var getFontStyleValues = function (editor) {\n    return Tools.explode(editor.getParam('font_size_style_values', 'xx-small,x-small,small,medium,large,x-large,xx-large'));\n  };\n\n  var getFontSizeClasses = function (editor) {\n    return Tools.explode(editor.getParam('font_size_classes', ''));\n  };\n\n  var getImagesDataImgFilter = function (editor) {\n    return editor.getParam('images_dataimg_filter', always, 'function');\n  };\n\n  var isAutomaticUploadsEnabled = function (editor) {\n    return editor.getParam('automatic_uploads', true, 'boolean');\n  };\n\n  var shouldReuseFileName = function (editor) {\n    return editor.getParam('images_reuse_filename', false, 'boolean');\n  };\n\n  var shouldReplaceBlobUris = function (editor) {\n    return editor.getParam('images_replace_blob_uris', true, 'boolean');\n  };\n\n  var getIconPackName = function (editor) {\n    return editor.getParam('icons', '', 'string');\n  };\n\n  var getIconsUrl = function (editor) {\n    return editor.getParam('icons_url', '', 'string');\n  };\n\n  var getImageUploadUrl = function (editor) {\n    return editor.getParam('images_upload_url', '', 'string');\n  };\n\n  var getImageUploadBasePath = function (editor) {\n    return editor.getParam('images_upload_base_path', '', 'string');\n  };\n\n  var getImagesUploadCredentials = function (editor) {\n    return editor.getParam('images_upload_credentials', false, 'boolean');\n  };\n\n  var getImagesUploadHandler = function (editor) {\n    return editor.getParam('images_upload_handler', null, 'function');\n  };\n\n  var shouldUseContentCssCors = function (editor) {\n    return editor.getParam('content_css_cors', false, 'boolean');\n  };\n\n  var getReferrerPolicy = function (editor) {\n    return editor.getParam('referrer_policy', '', 'string');\n  };\n\n  var getLanguageCode = function (editor) {\n    return editor.getParam('language', 'en', 'string');\n  };\n\n  var getLanguageUrl = function (editor) {\n    return editor.getParam('language_url', '', 'string');\n  };\n\n  var shouldIndentUseMargin = function (editor) {\n    return editor.getParam('indent_use_margin', false);\n  };\n\n  var getIndentation = function (editor) {\n    return editor.getParam('indentation', '40px', 'string');\n  };\n\n  var getContentCss = function (editor) {\n    var contentCss = editor.getParam('content_css');\n\n    if (isString(contentCss)) {\n      return map(contentCss.split(','), trim);\n    } else if (isArray(contentCss)) {\n      return contentCss;\n    } else if (contentCss === false || editor.inline) {\n      return [];\n    } else {\n      return ['default'];\n    }\n  };\n\n  var getDirectionality = function (editor) {\n    return editor.getParam('directionality', I18n.isRtl() ? 'rtl' : undefined);\n  };\n\n  var getInlineBoundarySelector = function (editor) {\n    return editor.getParam('inline_boundaries_selector', 'a[href],code,.mce-annotation', 'string');\n  };\n\n  var getObjectResizing = function (editor) {\n    var selector = editor.getParam('object_resizing');\n\n    if (selector === false || Env.iOS) {\n      return false;\n    } else {\n      return isString(selector) ? selector : 'table,img,figure.image,div';\n    }\n  };\n\n  var getResizeImgProportional = function (editor) {\n    return editor.getParam('resize_img_proportional', true, 'boolean');\n  };\n\n  var getPlaceholder = function (editor) {\n    return editor.getParam('placeholder', DOM$1.getAttrib(editor.getElement(), 'placeholder'), 'string');\n  };\n\n  var getEventRoot = function (editor) {\n    return editor.getParam('event_root');\n  };\n\n  var getServiceMessage = function (editor) {\n    return editor.getParam('service_message');\n  };\n\n  var getTheme = function (editor) {\n    return editor.getParam('theme');\n  };\n\n  var shouldValidate = function (editor) {\n    return editor.getParam('validate');\n  };\n\n  var isInlineBoundariesEnabled = function (editor) {\n    return editor.getParam('inline_boundaries') !== false;\n  };\n\n  var getFormats = function (editor) {\n    return editor.getParam('formats');\n  };\n\n  var getPreviewStyles = function (editor) {\n    var style = editor.getParam('preview_styles', defaultPreviewStyles);\n\n    if (isString(style)) {\n      return style;\n    } else {\n      return '';\n    }\n  };\n\n  var getCustomUiSelector = function (editor) {\n    return editor.getParam('custom_ui_selector', '', 'string');\n  };\n\n  var getThemeUrl = function (editor) {\n    return editor.getParam('theme_url');\n  };\n\n  var isInline$1 = function (editor) {\n    return editor.getParam('inline');\n  };\n\n  var hasHiddenInput = function (editor) {\n    return editor.getParam('hidden_input');\n  };\n\n  var shouldPatchSubmit = function (editor) {\n    return editor.getParam('submit_patch');\n  };\n\n  var isEncodingXml = function (editor) {\n    return editor.getParam('encoding') === 'xml';\n  };\n\n  var shouldAddFormSubmitTrigger = function (editor) {\n    return editor.getParam('add_form_submit_trigger');\n  };\n\n  var shouldAddUnloadTrigger = function (editor) {\n    return editor.getParam('add_unload_trigger');\n  };\n\n  var hasForcedRootBlock = function (editor) {\n    return getForcedRootBlock(editor) !== '';\n  };\n\n  var getCustomUndoRedoLevels = function (editor) {\n    return editor.getParam('custom_undo_redo_levels', 0, 'number');\n  };\n\n  var shouldDisableNodeChange = function (editor) {\n    return editor.getParam('disable_nodechange');\n  };\n\n  var isReadOnly = function (editor) {\n    return editor.getParam('readonly');\n  };\n\n  var hasContentCssCors = function (editor) {\n    return editor.getParam('content_css_cors');\n  };\n\n  var getPlugins = function (editor) {\n    return editor.getParam('plugins', '', 'string');\n  };\n\n  var getExternalPlugins = function (editor) {\n    return editor.getParam('external_plugins');\n  };\n\n  var shouldBlockUnsupportedDrop = function (editor) {\n    return editor.getParam('block_unsupported_drop', true, 'boolean');\n  };\n\n  var isElement$4 = isElement$1;\n  var isText$6 = isText$1;\n\n  var removeNode = function (node) {\n    var parentNode = node.parentNode;\n\n    if (parentNode) {\n      parentNode.removeChild(node);\n    }\n  };\n\n  var trimCount = function (text) {\n    var trimmedText = trim$2(text);\n    return {\n      count: text.length - trimmedText.length,\n      text: trimmedText\n    };\n  };\n\n  var deleteZwspChars = function (caretContainer) {\n    var idx;\n\n    while ((idx = caretContainer.data.lastIndexOf(ZWSP)) !== -1) {\n      caretContainer.deleteData(idx, 1);\n    }\n  };\n\n  var removeUnchanged = function (caretContainer, pos) {\n    remove$5(caretContainer);\n    return pos;\n  };\n\n  var removeTextAndReposition = function (caretContainer, pos) {\n    var before = trimCount(caretContainer.data.substr(0, pos.offset()));\n    var after = trimCount(caretContainer.data.substr(pos.offset()));\n    var text = before.text + after.text;\n\n    if (text.length > 0) {\n      deleteZwspChars(caretContainer);\n      return CaretPosition$1(caretContainer, pos.offset() - before.count);\n    } else {\n      return pos;\n    }\n  };\n\n  var removeElementAndReposition = function (caretContainer, pos) {\n    var parentNode = pos.container();\n    var newPosition = indexOf(from$1(parentNode.childNodes), caretContainer).map(function (index) {\n      return index < pos.offset() ? CaretPosition$1(parentNode, pos.offset() - 1) : pos;\n    }).getOr(pos);\n    remove$5(caretContainer);\n    return newPosition;\n  };\n\n  var removeTextCaretContainer = function (caretContainer, pos) {\n    return isText$6(caretContainer) && pos.container() === caretContainer ? removeTextAndReposition(caretContainer, pos) : removeUnchanged(caretContainer, pos);\n  };\n\n  var removeElementCaretContainer = function (caretContainer, pos) {\n    return pos.container() === caretContainer.parentNode ? removeElementAndReposition(caretContainer, pos) : removeUnchanged(caretContainer, pos);\n  };\n\n  var removeAndReposition = function (container, pos) {\n    return CaretPosition$1.isTextPosition(pos) ? removeTextCaretContainer(container, pos) : removeElementCaretContainer(container, pos);\n  };\n\n  var remove$5 = function (caretContainerNode) {\n    if (isElement$4(caretContainerNode) && isCaretContainer(caretContainerNode)) {\n      if (hasContent(caretContainerNode)) {\n        caretContainerNode.removeAttribute('data-mce-caret');\n      } else {\n        removeNode(caretContainerNode);\n      }\n    }\n\n    if (isText$6(caretContainerNode)) {\n      deleteZwspChars(caretContainerNode);\n\n      if (caretContainerNode.data.length === 0) {\n        removeNode(caretContainerNode);\n      }\n    }\n  };\n\n  var browser$2 = detect$3().browser;\n  var isContentEditableFalse$3 = isContentEditableFalse;\n  var isMedia$1 = isMedia;\n  var isTableCell$2 = isTableCell;\n  var inlineFakeCaretSelector = '*[contentEditable=false],video,audio,embed,object';\n\n  var getAbsoluteClientRect = function (root, element, before) {\n    var clientRect = collapse(element.getBoundingClientRect(), before);\n    var docElm, scrollX, scrollY, margin, rootRect;\n\n    if (root.tagName === 'BODY') {\n      docElm = root.ownerDocument.documentElement;\n      scrollX = root.scrollLeft || docElm.scrollLeft;\n      scrollY = root.scrollTop || docElm.scrollTop;\n    } else {\n      rootRect = root.getBoundingClientRect();\n      scrollX = root.scrollLeft - rootRect.left;\n      scrollY = root.scrollTop - rootRect.top;\n    }\n\n    clientRect.left += scrollX;\n    clientRect.right += scrollX;\n    clientRect.top += scrollY;\n    clientRect.bottom += scrollY;\n    clientRect.width = 1;\n    margin = element.offsetWidth - element.clientWidth;\n\n    if (margin > 0) {\n      if (before) {\n        margin *= -1;\n      }\n\n      clientRect.left += margin;\n      clientRect.right += margin;\n    }\n\n    return clientRect;\n  };\n\n  var trimInlineCaretContainers = function (root) {\n    var fakeCaretTargetNodes = descendants$1(SugarElement.fromDom(root), inlineFakeCaretSelector);\n\n    for (var i = 0; i < fakeCaretTargetNodes.length; i++) {\n      var node = fakeCaretTargetNodes[i].dom;\n      var sibling = node.previousSibling;\n\n      if (endsWithCaretContainer(sibling)) {\n        var data = sibling.data;\n\n        if (data.length === 1) {\n          sibling.parentNode.removeChild(sibling);\n        } else {\n          sibling.deleteData(data.length - 1, 1);\n        }\n      }\n\n      sibling = node.nextSibling;\n\n      if (startsWithCaretContainer(sibling)) {\n        var data = sibling.data;\n\n        if (data.length === 1) {\n          sibling.parentNode.removeChild(sibling);\n        } else {\n          sibling.deleteData(0, 1);\n        }\n      }\n    }\n  };\n\n  var FakeCaret = function (editor, root, isBlock, hasFocus) {\n    var lastVisualCaret = Cell(Optional.none());\n    var cursorInterval, caretContainerNode;\n    var rootBlock = getForcedRootBlock(editor);\n    var caretBlock = rootBlock.length > 0 ? rootBlock : 'p';\n\n    var show = function (before, element) {\n      var clientRect, rng;\n      hide();\n\n      if (isTableCell$2(element)) {\n        return null;\n      }\n\n      if (isBlock(element)) {\n        caretContainerNode = insertBlock(caretBlock, element, before);\n        clientRect = getAbsoluteClientRect(root, element, before);\n        DomQuery(caretContainerNode).css('top', clientRect.top);\n        var caret = DomQuery('<div class=\"mce-visual-caret\" data-mce-bogus=\"all\"></div>').css(clientRect).appendTo(root)[0];\n        lastVisualCaret.set(Optional.some({\n          caret: caret,\n          element: element,\n          before: before\n        }));\n        lastVisualCaret.get().each(function (caretState) {\n          if (before) {\n            DomQuery(caretState.caret).addClass('mce-visual-caret-before');\n          }\n        });\n        startBlink();\n        rng = element.ownerDocument.createRange();\n        rng.setStart(caretContainerNode, 0);\n        rng.setEnd(caretContainerNode, 0);\n      } else {\n        caretContainerNode = insertInline(element, before);\n        rng = element.ownerDocument.createRange();\n\n        if (isInlineFakeCaretTarget(caretContainerNode.nextSibling)) {\n          rng.setStart(caretContainerNode, 0);\n          rng.setEnd(caretContainerNode, 0);\n        } else {\n          rng.setStart(caretContainerNode, 1);\n          rng.setEnd(caretContainerNode, 1);\n        }\n\n        return rng;\n      }\n\n      return rng;\n    };\n\n    var hide = function () {\n      trimInlineCaretContainers(root);\n\n      if (caretContainerNode) {\n        remove$5(caretContainerNode);\n        caretContainerNode = null;\n      }\n\n      lastVisualCaret.get().each(function (caretState) {\n        DomQuery(caretState.caret).remove();\n        lastVisualCaret.set(Optional.none());\n      });\n\n      if (cursorInterval) {\n        Delay.clearInterval(cursorInterval);\n        cursorInterval = null;\n      }\n    };\n\n    var startBlink = function () {\n      cursorInterval = Delay.setInterval(function () {\n        if (hasFocus()) {\n          DomQuery('div.mce-visual-caret', root).toggleClass('mce-visual-caret-hidden');\n        } else {\n          DomQuery('div.mce-visual-caret', root).addClass('mce-visual-caret-hidden');\n        }\n      }, 500);\n    };\n\n    var reposition = function () {\n      lastVisualCaret.get().each(function (caretState) {\n        var clientRect = getAbsoluteClientRect(root, caretState.element, caretState.before);\n        DomQuery(caretState.caret).css(__assign({}, clientRect));\n      });\n    };\n\n    var destroy = function () {\n      return Delay.clearInterval(cursorInterval);\n    };\n\n    var getCss = function () {\n      return '.mce-visual-caret {' + 'position: absolute;' + 'background-color: black;' + 'background-color: currentcolor;' + '}' + '.mce-visual-caret-hidden {' + 'display: none;' + '}' + '*[data-mce-caret] {' + 'position: absolute;' + 'left: -1000px;' + 'right: auto;' + 'top: 0;' + 'margin: 0;' + 'padding: 0;' + '}';\n    };\n\n    return {\n      show: show,\n      hide: hide,\n      getCss: getCss,\n      reposition: reposition,\n      destroy: destroy\n    };\n  };\n\n  var isFakeCaretTableBrowser = function () {\n    return browser$2.isIE() || browser$2.isEdge() || browser$2.isFirefox();\n  };\n\n  var isInlineFakeCaretTarget = function (node) {\n    return isContentEditableFalse$3(node) || isMedia$1(node);\n  };\n\n  var isFakeCaretTarget = function (node) {\n    return isInlineFakeCaretTarget(node) || isTable(node) && isFakeCaretTableBrowser();\n  };\n\n  var isContentEditableFalse$4 = isContentEditableFalse;\n  var isMedia$2 = isMedia;\n  var isBlockLike = matchStyleValues('display', 'block table table-cell table-caption list-item');\n  var isCaretContainer$2 = isCaretContainer;\n  var isCaretContainerBlock$1 = isCaretContainerBlock;\n  var isElement$5 = isElement$1;\n  var isCaretCandidate$2 = isCaretCandidate;\n\n  var isForwards = function (direction) {\n    return direction > 0;\n  };\n\n  var isBackwards = function (direction) {\n    return direction < 0;\n  };\n\n  var skipCaretContainers = function (walk, shallow) {\n    var node;\n\n    while (node = walk(shallow)) {\n      if (!isCaretContainerBlock$1(node)) {\n        return node;\n      }\n    }\n\n    return null;\n  };\n\n  var findNode = function (node, direction, predicateFn, rootNode, shallow) {\n    var walker = new DomTreeWalker(node, rootNode);\n    var isCefOrCaretContainer = isContentEditableFalse$4(node) || isCaretContainerBlock$1(node);\n\n    if (isBackwards(direction)) {\n      if (isCefOrCaretContainer) {\n        node = skipCaretContainers(walker.prev, true);\n\n        if (predicateFn(node)) {\n          return node;\n        }\n      }\n\n      while (node = skipCaretContainers(walker.prev, shallow)) {\n        if (predicateFn(node)) {\n          return node;\n        }\n      }\n    }\n\n    if (isForwards(direction)) {\n      if (isCefOrCaretContainer) {\n        node = skipCaretContainers(walker.next, true);\n\n        if (predicateFn(node)) {\n          return node;\n        }\n      }\n\n      while (node = skipCaretContainers(walker.next, shallow)) {\n        if (predicateFn(node)) {\n          return node;\n        }\n      }\n    }\n\n    return null;\n  };\n\n  var getParentBlock = function (node, rootNode) {\n    while (node && node !== rootNode) {\n      if (isBlockLike(node)) {\n        return node;\n      }\n\n      node = node.parentNode;\n    }\n\n    return null;\n  };\n\n  var isInSameBlock = function (caretPosition1, caretPosition2, rootNode) {\n    return getParentBlock(caretPosition1.container(), rootNode) === getParentBlock(caretPosition2.container(), rootNode);\n  };\n\n  var getChildNodeAtRelativeOffset = function (relativeOffset, caretPosition) {\n    if (!caretPosition) {\n      return null;\n    }\n\n    var container = caretPosition.container();\n    var offset = caretPosition.offset();\n\n    if (!isElement$5(container)) {\n      return null;\n    }\n\n    return container.childNodes[offset + relativeOffset];\n  };\n\n  var beforeAfter = function (before, node) {\n    var range = node.ownerDocument.createRange();\n\n    if (before) {\n      range.setStartBefore(node);\n      range.setEndBefore(node);\n    } else {\n      range.setStartAfter(node);\n      range.setEndAfter(node);\n    }\n\n    return range;\n  };\n\n  var isNodesInSameBlock = function (root, node1, node2) {\n    return getParentBlock(node1, root) === getParentBlock(node2, root);\n  };\n\n  var lean = function (left, root, node) {\n    var sibling, siblingName;\n\n    if (left) {\n      siblingName = 'previousSibling';\n    } else {\n      siblingName = 'nextSibling';\n    }\n\n    while (node && node !== root) {\n      sibling = node[siblingName];\n\n      if (isCaretContainer$2(sibling)) {\n        sibling = sibling[siblingName];\n      }\n\n      if (isContentEditableFalse$4(sibling) || isMedia$2(sibling)) {\n        if (isNodesInSameBlock(root, sibling, node)) {\n          return sibling;\n        }\n\n        break;\n      }\n\n      if (isCaretCandidate$2(sibling)) {\n        break;\n      }\n\n      node = node.parentNode;\n    }\n\n    return null;\n  };\n\n  var before$2 = curry(beforeAfter, true);\n  var after$1 = curry(beforeAfter, false);\n\n  var normalizeRange = function (direction, root, range) {\n    var node, container, location;\n    var leanLeft = curry(lean, true, root);\n    var leanRight = curry(lean, false, root);\n    container = range.startContainer;\n    var offset = range.startOffset;\n\n    if (isCaretContainerBlock(container)) {\n      if (!isElement$5(container)) {\n        container = container.parentNode;\n      }\n\n      location = container.getAttribute('data-mce-caret');\n\n      if (location === 'before') {\n        node = container.nextSibling;\n\n        if (isFakeCaretTarget(node)) {\n          return before$2(node);\n        }\n      }\n\n      if (location === 'after') {\n        node = container.previousSibling;\n\n        if (isFakeCaretTarget(node)) {\n          return after$1(node);\n        }\n      }\n    }\n\n    if (!range.collapsed) {\n      return range;\n    }\n\n    if (isText$1(container)) {\n      if (isCaretContainer$2(container)) {\n        if (direction === 1) {\n          node = leanRight(container);\n\n          if (node) {\n            return before$2(node);\n          }\n\n          node = leanLeft(container);\n\n          if (node) {\n            return after$1(node);\n          }\n        }\n\n        if (direction === -1) {\n          node = leanLeft(container);\n\n          if (node) {\n            return after$1(node);\n          }\n\n          node = leanRight(container);\n\n          if (node) {\n            return before$2(node);\n          }\n        }\n\n        return range;\n      }\n\n      if (endsWithCaretContainer(container) && offset >= container.data.length - 1) {\n        if (direction === 1) {\n          node = leanRight(container);\n\n          if (node) {\n            return before$2(node);\n          }\n        }\n\n        return range;\n      }\n\n      if (startsWithCaretContainer(container) && offset <= 1) {\n        if (direction === -1) {\n          node = leanLeft(container);\n\n          if (node) {\n            return after$1(node);\n          }\n        }\n\n        return range;\n      }\n\n      if (offset === container.data.length) {\n        node = leanRight(container);\n\n        if (node) {\n          return before$2(node);\n        }\n\n        return range;\n      }\n\n      if (offset === 0) {\n        node = leanLeft(container);\n\n        if (node) {\n          return after$1(node);\n        }\n\n        return range;\n      }\n    }\n\n    return range;\n  };\n\n  var getRelativeCefElm = function (forward, caretPosition) {\n    return Optional.from(getChildNodeAtRelativeOffset(forward ? 0 : -1, caretPosition)).filter(isContentEditableFalse$4);\n  };\n\n  var getNormalizedRangeEndPoint = function (direction, root, range) {\n    var normalizedRange = normalizeRange(direction, root, range);\n\n    if (direction === -1) {\n      return CaretPosition.fromRangeStart(normalizedRange);\n    }\n\n    return CaretPosition.fromRangeEnd(normalizedRange);\n  };\n\n  var getElementFromPosition = function (pos) {\n    return Optional.from(pos.getNode()).map(SugarElement.fromDom);\n  };\n\n  var getElementFromPrevPosition = function (pos) {\n    return Optional.from(pos.getNode(true)).map(SugarElement.fromDom);\n  };\n\n  var getVisualCaretPosition = function (walkFn, caretPosition) {\n    while (caretPosition = walkFn(caretPosition)) {\n      if (caretPosition.isVisible()) {\n        return caretPosition;\n      }\n    }\n\n    return caretPosition;\n  };\n\n  var isMoveInsideSameBlock = function (from, to) {\n    var inSameBlock = isInSameBlock(from, to);\n\n    if (!inSameBlock && isBr(from.getNode())) {\n      return true;\n    }\n\n    return inSameBlock;\n  };\n\n  var HDirection;\n\n  (function (HDirection) {\n    HDirection[HDirection['Backwards'] = -1] = 'Backwards';\n    HDirection[HDirection['Forwards'] = 1] = 'Forwards';\n  })(HDirection || (HDirection = {}));\n\n  var isContentEditableFalse$5 = isContentEditableFalse;\n  var isText$7 = isText$1;\n  var isElement$6 = isElement$1;\n  var isBr$4 = isBr;\n  var isCaretCandidate$3 = isCaretCandidate;\n  var isAtomic$1 = isAtomic;\n  var isEditableCaretCandidate$1 = isEditableCaretCandidate;\n\n  var getParents = function (node, root) {\n    var parents = [];\n\n    while (node && node !== root) {\n      parents.push(node);\n      node = node.parentNode;\n    }\n\n    return parents;\n  };\n\n  var nodeAtIndex = function (container, offset) {\n    if (container.hasChildNodes() && offset < container.childNodes.length) {\n      return container.childNodes[offset];\n    }\n\n    return null;\n  };\n\n  var getCaretCandidatePosition = function (direction, node) {\n    if (isForwards(direction)) {\n      if (isCaretCandidate$3(node.previousSibling) && !isText$7(node.previousSibling)) {\n        return CaretPosition$1.before(node);\n      }\n\n      if (isText$7(node)) {\n        return CaretPosition$1(node, 0);\n      }\n    }\n\n    if (isBackwards(direction)) {\n      if (isCaretCandidate$3(node.nextSibling) && !isText$7(node.nextSibling)) {\n        return CaretPosition$1.after(node);\n      }\n\n      if (isText$7(node)) {\n        return CaretPosition$1(node, node.data.length);\n      }\n    }\n\n    if (isBackwards(direction)) {\n      if (isBr$4(node)) {\n        return CaretPosition$1.before(node);\n      }\n\n      return CaretPosition$1.after(node);\n    }\n\n    return CaretPosition$1.before(node);\n  };\n\n  var moveForwardFromBr = function (root, nextNode) {\n    var nextSibling = nextNode.nextSibling;\n\n    if (nextSibling && isCaretCandidate$3(nextSibling)) {\n      if (isText$7(nextSibling)) {\n        return CaretPosition$1(nextSibling, 0);\n      } else {\n        return CaretPosition$1.before(nextSibling);\n      }\n    } else {\n      return findCaretPosition(HDirection.Forwards, CaretPosition$1.after(nextNode), root);\n    }\n  };\n\n  var findCaretPosition = function (direction, startPos, root) {\n    var node, nextNode, innerNode;\n    var caretPosition;\n\n    if (!isElement$6(root) || !startPos) {\n      return null;\n    }\n\n    if (startPos.isEqual(CaretPosition$1.after(root)) && root.lastChild) {\n      caretPosition = CaretPosition$1.after(root.lastChild);\n\n      if (isBackwards(direction) && isCaretCandidate$3(root.lastChild) && isElement$6(root.lastChild)) {\n        return isBr$4(root.lastChild) ? CaretPosition$1.before(root.lastChild) : caretPosition;\n      }\n    } else {\n      caretPosition = startPos;\n    }\n\n    var container = caretPosition.container();\n    var offset = caretPosition.offset();\n\n    if (isText$7(container)) {\n      if (isBackwards(direction) && offset > 0) {\n        return CaretPosition$1(container, --offset);\n      }\n\n      if (isForwards(direction) && offset < container.length) {\n        return CaretPosition$1(container, ++offset);\n      }\n\n      node = container;\n    } else {\n      if (isBackwards(direction) && offset > 0) {\n        nextNode = nodeAtIndex(container, offset - 1);\n\n        if (isCaretCandidate$3(nextNode)) {\n          if (!isAtomic$1(nextNode)) {\n            innerNode = findNode(nextNode, direction, isEditableCaretCandidate$1, nextNode);\n\n            if (innerNode) {\n              if (isText$7(innerNode)) {\n                return CaretPosition$1(innerNode, innerNode.data.length);\n              }\n\n              return CaretPosition$1.after(innerNode);\n            }\n          }\n\n          if (isText$7(nextNode)) {\n            return CaretPosition$1(nextNode, nextNode.data.length);\n          }\n\n          return CaretPosition$1.before(nextNode);\n        }\n      }\n\n      if (isForwards(direction) && offset < container.childNodes.length) {\n        nextNode = nodeAtIndex(container, offset);\n\n        if (isCaretCandidate$3(nextNode)) {\n          if (isBr$4(nextNode)) {\n            return moveForwardFromBr(root, nextNode);\n          }\n\n          if (!isAtomic$1(nextNode)) {\n            innerNode = findNode(nextNode, direction, isEditableCaretCandidate$1, nextNode);\n\n            if (innerNode) {\n              if (isText$7(innerNode)) {\n                return CaretPosition$1(innerNode, 0);\n              }\n\n              return CaretPosition$1.before(innerNode);\n            }\n          }\n\n          if (isText$7(nextNode)) {\n            return CaretPosition$1(nextNode, 0);\n          }\n\n          return CaretPosition$1.after(nextNode);\n        }\n      }\n\n      node = nextNode ? nextNode : caretPosition.getNode();\n    }\n\n    if (isForwards(direction) && caretPosition.isAtEnd() || isBackwards(direction) && caretPosition.isAtStart()) {\n      node = findNode(node, direction, always, root, true);\n\n      if (isEditableCaretCandidate$1(node, root)) {\n        return getCaretCandidatePosition(direction, node);\n      }\n    }\n\n    nextNode = findNode(node, direction, isEditableCaretCandidate$1, root);\n    var rootContentEditableFalseElm = last$1(filter(getParents(container, root), isContentEditableFalse$5));\n\n    if (rootContentEditableFalseElm && (!nextNode || !rootContentEditableFalseElm.contains(nextNode))) {\n      if (isForwards(direction)) {\n        caretPosition = CaretPosition$1.after(rootContentEditableFalseElm);\n      } else {\n        caretPosition = CaretPosition$1.before(rootContentEditableFalseElm);\n      }\n\n      return caretPosition;\n    }\n\n    if (nextNode) {\n      return getCaretCandidatePosition(direction, nextNode);\n    }\n\n    return null;\n  };\n\n  var CaretWalker = function (root) {\n    return {\n      next: function (caretPosition) {\n        return findCaretPosition(HDirection.Forwards, caretPosition, root);\n      },\n      prev: function (caretPosition) {\n        return findCaretPosition(HDirection.Backwards, caretPosition, root);\n      }\n    };\n  };\n\n  var walkToPositionIn = function (forward, root, start) {\n    var position = forward ? CaretPosition$1.before(start) : CaretPosition$1.after(start);\n    return fromPosition(forward, root, position);\n  };\n\n  var afterElement = function (node) {\n    return isBr(node) ? CaretPosition$1.before(node) : CaretPosition$1.after(node);\n  };\n\n  var isBeforeOrStart = function (position) {\n    if (CaretPosition$1.isTextPosition(position)) {\n      return position.offset() === 0;\n    } else {\n      return isCaretCandidate(position.getNode());\n    }\n  };\n\n  var isAfterOrEnd = function (position) {\n    if (CaretPosition$1.isTextPosition(position)) {\n      var container = position.container();\n      return position.offset() === container.data.length;\n    } else {\n      return isCaretCandidate(position.getNode(true));\n    }\n  };\n\n  var isBeforeAfterSameElement = function (from, to) {\n    return !CaretPosition$1.isTextPosition(from) && !CaretPosition$1.isTextPosition(to) && from.getNode() === to.getNode(true);\n  };\n\n  var isAtBr = function (position) {\n    return !CaretPosition$1.isTextPosition(position) && isBr(position.getNode());\n  };\n\n  var shouldSkipPosition = function (forward, from, to) {\n    if (forward) {\n      return !isBeforeAfterSameElement(from, to) && !isAtBr(from) && isAfterOrEnd(from) && isBeforeOrStart(to);\n    } else {\n      return !isBeforeAfterSameElement(to, from) && isBeforeOrStart(from) && isAfterOrEnd(to);\n    }\n  };\n\n  var fromPosition = function (forward, root, pos) {\n    var walker = CaretWalker(root);\n    return Optional.from(forward ? walker.next(pos) : walker.prev(pos));\n  };\n\n  var navigate = function (forward, root, from) {\n    return fromPosition(forward, root, from).bind(function (to) {\n      if (isInSameBlock(from, to, root) && shouldSkipPosition(forward, from, to)) {\n        return fromPosition(forward, root, to);\n      } else {\n        return Optional.some(to);\n      }\n    });\n  };\n\n  var navigateIgnore = function (forward, root, from, ignoreFilter) {\n    return navigate(forward, root, from).bind(function (pos) {\n      return ignoreFilter(pos) ? navigateIgnore(forward, root, pos, ignoreFilter) : Optional.some(pos);\n    });\n  };\n\n  var positionIn = function (forward, element) {\n    var startNode = forward ? element.firstChild : element.lastChild;\n\n    if (isText$1(startNode)) {\n      return Optional.some(CaretPosition$1(startNode, forward ? 0 : startNode.data.length));\n    } else if (startNode) {\n      if (isCaretCandidate(startNode)) {\n        return Optional.some(forward ? CaretPosition$1.before(startNode) : afterElement(startNode));\n      } else {\n        return walkToPositionIn(forward, element, startNode);\n      }\n    } else {\n      return Optional.none();\n    }\n  };\n\n  var nextPosition = curry(fromPosition, true);\n  var prevPosition = curry(fromPosition, false);\n  var firstPositionIn = curry(positionIn, true);\n  var lastPositionIn = curry(positionIn, false);\n  var CARET_ID = '_mce_caret';\n\n  var isCaretNode = function (node) {\n    return isElement$1(node) && node.id === CARET_ID;\n  };\n\n  var getParentCaretContainer = function (body, node) {\n    while (node && node !== body) {\n      if (node.id === CARET_ID) {\n        return node;\n      }\n\n      node = node.parentNode;\n    }\n\n    return null;\n  };\n\n  var isStringPathBookmark = function (bookmark) {\n    return typeof bookmark.start === 'string';\n  };\n\n  var isRangeBookmark = function (bookmark) {\n    return bookmark.hasOwnProperty('rng');\n  };\n\n  var isIdBookmark = function (bookmark) {\n    return bookmark.hasOwnProperty('id');\n  };\n\n  var isIndexBookmark = function (bookmark) {\n    return bookmark.hasOwnProperty('name');\n  };\n\n  var isPathBookmark = function (bookmark) {\n    return Tools.isArray(bookmark.start);\n  };\n\n  var addBogus = function (dom, node) {\n    if (isElement$1(node) && dom.isBlock(node) && !node.innerHTML && !Env.ie) {\n      node.innerHTML = '<br data-mce-bogus=\"1\" />';\n    }\n\n    return node;\n  };\n\n  var resolveCaretPositionBookmark = function (dom, bookmark) {\n    var pos;\n    var rng = dom.createRng();\n    pos = resolve$1(dom.getRoot(), bookmark.start);\n    rng.setStart(pos.container(), pos.offset());\n    pos = resolve$1(dom.getRoot(), bookmark.end);\n    rng.setEnd(pos.container(), pos.offset());\n    return rng;\n  };\n\n  var insertZwsp = function (node, rng) {\n    var textNode = node.ownerDocument.createTextNode(ZWSP);\n    node.appendChild(textNode);\n    rng.setStart(textNode, 0);\n    rng.setEnd(textNode, 0);\n  };\n\n  var isEmpty$1 = function (node) {\n    return node.hasChildNodes() === false;\n  };\n\n  var tryFindRangePosition = function (node, rng) {\n    return lastPositionIn(node).fold(function () {\n      return false;\n    }, function (pos) {\n      rng.setStart(pos.container(), pos.offset());\n      rng.setEnd(pos.container(), pos.offset());\n      return true;\n    });\n  };\n\n  var padEmptyCaretContainer = function (root, node, rng) {\n    if (isEmpty$1(node) && getParentCaretContainer(root, node)) {\n      insertZwsp(node, rng);\n      return true;\n    } else {\n      return false;\n    }\n  };\n\n  var setEndPoint = function (dom, start, bookmark, rng) {\n    var point = bookmark[start ? 'start' : 'end'];\n    var i, node, offset, children;\n    var root = dom.getRoot();\n\n    if (point) {\n      offset = point[0];\n\n      for (node = root, i = point.length - 1; i >= 1; i--) {\n        children = node.childNodes;\n\n        if (padEmptyCaretContainer(root, node, rng)) {\n          return true;\n        }\n\n        if (point[i] > children.length - 1) {\n          if (padEmptyCaretContainer(root, node, rng)) {\n            return true;\n          }\n\n          return tryFindRangePosition(node, rng);\n        }\n\n        node = children[point[i]];\n      }\n\n      if (node.nodeType === 3) {\n        offset = Math.min(point[0], node.nodeValue.length);\n      }\n\n      if (node.nodeType === 1) {\n        offset = Math.min(point[0], node.childNodes.length);\n      }\n\n      if (start) {\n        rng.setStart(node, offset);\n      } else {\n        rng.setEnd(node, offset);\n      }\n    }\n\n    return true;\n  };\n\n  var isValidTextNode = function (node) {\n    return isText$1(node) && node.data.length > 0;\n  };\n\n  var restoreEndPoint = function (dom, suffix, bookmark) {\n    var marker = dom.get(bookmark.id + '_' + suffix),\n        node,\n        idx,\n        next,\n        prev;\n    var keep = bookmark.keep;\n    var container, offset;\n\n    if (marker) {\n      node = marker.parentNode;\n\n      if (suffix === 'start') {\n        if (!keep) {\n          idx = dom.nodeIndex(marker);\n        } else {\n          if (marker.hasChildNodes()) {\n            node = marker.firstChild;\n            idx = 1;\n          } else if (isValidTextNode(marker.nextSibling)) {\n            node = marker.nextSibling;\n            idx = 0;\n          } else if (isValidTextNode(marker.previousSibling)) {\n            node = marker.previousSibling;\n            idx = marker.previousSibling.data.length;\n          } else {\n            node = marker.parentNode;\n            idx = dom.nodeIndex(marker) + 1;\n          }\n        }\n\n        container = node;\n        offset = idx;\n      } else {\n        if (!keep) {\n          idx = dom.nodeIndex(marker);\n        } else {\n          if (marker.hasChildNodes()) {\n            node = marker.firstChild;\n            idx = 1;\n          } else if (isValidTextNode(marker.previousSibling)) {\n            node = marker.previousSibling;\n            idx = marker.previousSibling.data.length;\n          } else {\n            node = marker.parentNode;\n            idx = dom.nodeIndex(marker);\n          }\n        }\n\n        container = node;\n        offset = idx;\n      }\n\n      if (!keep) {\n        prev = marker.previousSibling;\n        next = marker.nextSibling;\n        Tools.each(Tools.grep(marker.childNodes), function (node) {\n          if (isText$1(node)) {\n            node.nodeValue = node.nodeValue.replace(/\\uFEFF/g, '');\n          }\n        });\n\n        while (marker = dom.get(bookmark.id + '_' + suffix)) {\n          dom.remove(marker, true);\n        }\n\n        if (prev && next && prev.nodeType === next.nodeType && isText$1(prev) && !Env.opera) {\n          idx = prev.nodeValue.length;\n          prev.appendData(next.nodeValue);\n          dom.remove(next);\n          container = prev;\n          offset = idx;\n        }\n      }\n\n      return Optional.some(CaretPosition$1(container, offset));\n    } else {\n      return Optional.none();\n    }\n  };\n\n  var resolvePaths = function (dom, bookmark) {\n    var rng = dom.createRng();\n\n    if (setEndPoint(dom, true, bookmark, rng) && setEndPoint(dom, false, bookmark, rng)) {\n      return Optional.some(rng);\n    } else {\n      return Optional.none();\n    }\n  };\n\n  var resolveId = function (dom, bookmark) {\n    var startPos = restoreEndPoint(dom, 'start', bookmark);\n    var endPos = restoreEndPoint(dom, 'end', bookmark);\n    return lift2(startPos, endPos.or(startPos), function (spos, epos) {\n      var rng = dom.createRng();\n      rng.setStart(addBogus(dom, spos.container()), spos.offset());\n      rng.setEnd(addBogus(dom, epos.container()), epos.offset());\n      return rng;\n    });\n  };\n\n  var resolveIndex$1 = function (dom, bookmark) {\n    return Optional.from(dom.select(bookmark.name)[bookmark.index]).map(function (elm) {\n      var rng = dom.createRng();\n      rng.selectNode(elm);\n      return rng;\n    });\n  };\n\n  var resolve$2 = function (selection, bookmark) {\n    var dom = selection.dom;\n\n    if (bookmark) {\n      if (isPathBookmark(bookmark)) {\n        return resolvePaths(dom, bookmark);\n      } else if (isStringPathBookmark(bookmark)) {\n        return Optional.some(resolveCaretPositionBookmark(dom, bookmark));\n      } else if (isIdBookmark(bookmark)) {\n        return resolveId(dom, bookmark);\n      } else if (isIndexBookmark(bookmark)) {\n        return resolveIndex$1(dom, bookmark);\n      } else if (isRangeBookmark(bookmark)) {\n        return Optional.some(bookmark.rng);\n      }\n    }\n\n    return Optional.none();\n  };\n\n  var getBookmark$1 = function (selection, type, normalized) {\n    return getBookmark(selection, type, normalized);\n  };\n\n  var moveToBookmark = function (selection, bookmark) {\n    resolve$2(selection, bookmark).each(function (rng) {\n      selection.setRng(rng);\n    });\n  };\n\n  var isBookmarkNode$1 = function (node) {\n    return isElement$1(node) && node.tagName === 'SPAN' && node.getAttribute('data-mce-type') === 'bookmark';\n  };\n\n  var is$2 = function (expected) {\n    return function (actual) {\n      return expected === actual;\n    };\n  };\n\n  var isNbsp = is$2(nbsp);\n\n  var isWhiteSpace$1 = function (chr) {\n    return chr !== '' && ' \\f\\n\\r\\t\\x0B'.indexOf(chr) !== -1;\n  };\n\n  var isContent$1 = function (chr) {\n    return !isWhiteSpace$1(chr) && !isNbsp(chr);\n  };\n\n  var isNode = function (node) {\n    return !!node.nodeType;\n  };\n\n  var isInlineBlock = function (node) {\n    return node && /^(IMG)$/.test(node.nodeName);\n  };\n\n  var moveStart = function (dom, selection, rng) {\n    var offset = rng.startOffset;\n    var container = rng.startContainer,\n        walker,\n        node,\n        nodes;\n\n    if (rng.startContainer === rng.endContainer) {\n      if (isInlineBlock(rng.startContainer.childNodes[rng.startOffset])) {\n        return;\n      }\n    }\n\n    if (container.nodeType === 1) {\n      nodes = container.childNodes;\n\n      if (offset < nodes.length) {\n        container = nodes[offset];\n        walker = new DomTreeWalker(container, dom.getParent(container, dom.isBlock));\n      } else {\n        container = nodes[nodes.length - 1];\n        walker = new DomTreeWalker(container, dom.getParent(container, dom.isBlock));\n        walker.next(true);\n      }\n\n      for (node = walker.current(); node; node = walker.next()) {\n        if (node.nodeType === 3 && !isWhiteSpaceNode(node)) {\n          rng.setStart(node, 0);\n          selection.setRng(rng);\n          return;\n        }\n      }\n    }\n  };\n\n  var getNonWhiteSpaceSibling = function (node, next, inc) {\n    if (node) {\n      var nextName = next ? 'nextSibling' : 'previousSibling';\n\n      for (node = inc ? node : node[nextName]; node; node = node[nextName]) {\n        if (node.nodeType === 1 || !isWhiteSpaceNode(node)) {\n          return node;\n        }\n      }\n    }\n  };\n\n  var isTextBlock$1 = function (editor, name) {\n    if (isNode(name)) {\n      name = name.nodeName;\n    }\n\n    return !!editor.schema.getTextBlockElements()[name.toLowerCase()];\n  };\n\n  var isValid = function (ed, parent, child) {\n    return ed.schema.isValidChild(parent, child);\n  };\n\n  var isWhiteSpaceNode = function (node) {\n    return node && isText$1(node) && /^([\\t \\r\\n]+|)$/.test(node.nodeValue);\n  };\n\n  var isEmptyTextNode = function (node) {\n    return node && isText$1(node) && node.length === 0;\n  };\n\n  var replaceVars = function (value, vars) {\n    if (typeof value !== 'string') {\n      value = value(vars);\n    } else if (vars) {\n      value = value.replace(/%(\\w+)/g, function (str, name) {\n        return vars[name] || str;\n      });\n    }\n\n    return value;\n  };\n\n  var isEq = function (str1, str2) {\n    str1 = str1 || '';\n    str2 = str2 || '';\n    str1 = '' + (str1.nodeName || str1);\n    str2 = '' + (str2.nodeName || str2);\n    return str1.toLowerCase() === str2.toLowerCase();\n  };\n\n  var normalizeStyleValue = function (dom, value, name) {\n    if (name === 'color' || name === 'backgroundColor') {\n      value = dom.toHex(value);\n    }\n\n    if (name === 'fontWeight' && value === 700) {\n      value = 'bold';\n    }\n\n    if (name === 'fontFamily') {\n      value = value.replace(/[\\'\\\"]/g, '').replace(/,\\s+/g, ',');\n    }\n\n    return '' + value;\n  };\n\n  var getStyle = function (dom, node, name) {\n    return normalizeStyleValue(dom, dom.getStyle(node, name), name);\n  };\n\n  var getTextDecoration = function (dom, node) {\n    var decoration;\n    dom.getParent(node, function (n) {\n      decoration = dom.getStyle(n, 'text-decoration');\n      return decoration && decoration !== 'none';\n    });\n    return decoration;\n  };\n\n  var getParents$1 = function (dom, node, selector) {\n    return dom.getParents(node, selector, dom.getRoot());\n  };\n\n  var isVariableFormatName = function (editor, formatName) {\n    var hasVariableValues = function (format) {\n      var isVariableValue = function (val) {\n        return val.length > 1 && val.charAt(0) === '%';\n      };\n\n      return exists(['styles', 'attributes'], function (key) {\n        return get(format, key).exists(function (field) {\n          var fieldValues = isArray(field) ? field : values(field);\n          return exists(fieldValues, isVariableValue);\n        });\n      });\n    };\n\n    return exists(editor.formatter.get(formatName), hasVariableValues);\n  };\n\n  var areSimilarFormats = function (editor, formatName, otherFormatName) {\n    var validKeys = ['inline', 'block', 'selector', 'attributes', 'styles', 'classes'];\n\n    var filterObj = function (format) {\n      return filter$1(format, function (_, key) {\n        return exists(validKeys, function (validKey) {\n          return validKey === key;\n        });\n      });\n    };\n\n    return exists(editor.formatter.get(formatName), function (fmt1) {\n      var filteredFmt1 = filterObj(fmt1);\n      return exists(editor.formatter.get(otherFormatName), function (fmt2) {\n        var filteredFmt2 = filterObj(fmt2);\n        return equal(filteredFmt1, filteredFmt2);\n      });\n    });\n  };\n\n  var isBookmarkNode$2 = isBookmarkNode$1;\n  var getParents$2 = getParents$1;\n  var isWhiteSpaceNode$1 = isWhiteSpaceNode;\n  var isTextBlock$2 = isTextBlock$1;\n\n  var isBogusBr = function (node) {\n    return node.nodeName === 'BR' && node.getAttribute('data-mce-bogus') && !node.nextSibling;\n  };\n\n  var findParentContentEditable = function (dom, node) {\n    var parent = node;\n\n    while (parent) {\n      if (isElement$1(parent) && dom.getContentEditable(parent)) {\n        return dom.getContentEditable(parent) === 'false' ? parent : node;\n      }\n\n      parent = parent.parentNode;\n    }\n\n    return node;\n  };\n\n  var walkText = function (start, node, offset, predicate) {\n    var str = node.data;\n\n    for (var i = offset; start ? i >= 0 : i < str.length; start ? i-- : i++) {\n      if (predicate(str.charAt(i))) {\n        return start ? i + 1 : i;\n      }\n    }\n\n    return -1;\n  };\n\n  var findSpace = function (start, node, offset) {\n    return walkText(start, node, offset, function (c) {\n      return isNbsp(c) || isWhiteSpace$1(c);\n    });\n  };\n\n  var findContent = function (start, node, offset) {\n    return walkText(start, node, offset, isContent$1);\n  };\n\n  var findWordEndPoint = function (dom, body, container, offset, start, includeTrailingSpaces) {\n    var lastTextNode;\n    var rootNode = dom.getParent(container, dom.isBlock) || body;\n\n    var walk = function (container, offset, pred) {\n      var textSeeker = TextSeeker(dom);\n      var walker = start ? textSeeker.backwards : textSeeker.forwards;\n      return Optional.from(walker(container, offset, function (text, textOffset) {\n        if (isBookmarkNode$2(text.parentNode)) {\n          return -1;\n        } else {\n          lastTextNode = text;\n          return pred(start, text, textOffset);\n        }\n      }, rootNode));\n    };\n\n    var spaceResult = walk(container, offset, findSpace);\n    return spaceResult.bind(function (result) {\n      return includeTrailingSpaces ? walk(result.container, result.offset + (start ? -1 : 0), findContent) : Optional.some(result);\n    }).orThunk(function () {\n      return lastTextNode ? Optional.some({\n        container: lastTextNode,\n        offset: start ? 0 : lastTextNode.length\n      }) : Optional.none();\n    });\n  };\n\n  var findSelectorEndPoint = function (dom, format, rng, container, siblingName) {\n    if (isText$1(container) && container.nodeValue.length === 0 && container[siblingName]) {\n      container = container[siblingName];\n    }\n\n    var parents = getParents$2(dom, container);\n\n    for (var i = 0; i < parents.length; i++) {\n      for (var y = 0; y < format.length; y++) {\n        var curFormat = format[y];\n\n        if ('collapsed' in curFormat && curFormat.collapsed !== rng.collapsed) {\n          continue;\n        }\n\n        if (dom.is(parents[i], curFormat.selector)) {\n          return parents[i];\n        }\n      }\n    }\n\n    return container;\n  };\n\n  var findBlockEndPoint = function (editor, format, container, siblingName) {\n    var node;\n    var dom = editor.dom;\n    var root = dom.getRoot();\n\n    if (!format[0].wrapper) {\n      node = dom.getParent(container, format[0].block, root);\n    }\n\n    if (!node) {\n      var scopeRoot = dom.getParent(container, 'LI,TD,TH');\n      node = dom.getParent(isText$1(container) ? container.parentNode : container, function (node) {\n        return node !== root && isTextBlock$2(editor, node);\n      }, scopeRoot);\n    }\n\n    if (node && format[0].wrapper) {\n      node = getParents$2(dom, node, 'ul,ol').reverse()[0] || node;\n    }\n\n    if (!node) {\n      node = container;\n\n      while (node[siblingName] && !dom.isBlock(node[siblingName])) {\n        node = node[siblingName];\n\n        if (isEq(node, 'br')) {\n          break;\n        }\n      }\n    }\n\n    return node || container;\n  };\n\n  var findParentContainer = function (dom, format, startContainer, startOffset, endContainer, endOffset, start) {\n    var container, parent, sibling;\n    container = parent = start ? startContainer : endContainer;\n    var siblingName = start ? 'previousSibling' : 'nextSibling';\n    var root = dom.getRoot();\n\n    if (isText$1(container) && !isWhiteSpaceNode$1(container)) {\n      if (start ? startOffset > 0 : endOffset < container.nodeValue.length) {\n        return container;\n      }\n    }\n\n    while (true) {\n      if (!format[0].block_expand && dom.isBlock(parent)) {\n        return parent;\n      }\n\n      for (sibling = parent[siblingName]; sibling; sibling = sibling[siblingName]) {\n        if (!isBookmarkNode$2(sibling) && !isWhiteSpaceNode$1(sibling) && !isBogusBr(sibling)) {\n          return parent;\n        }\n      }\n\n      if (parent === root || parent.parentNode === root) {\n        container = parent;\n        break;\n      }\n\n      parent = parent.parentNode;\n    }\n\n    return container;\n  };\n\n  var expandRng = function (editor, rng, format, includeTrailingSpace) {\n    if (includeTrailingSpace === void 0) {\n      includeTrailingSpace = false;\n    }\n\n    var startContainer = rng.startContainer,\n        startOffset = rng.startOffset,\n        endContainer = rng.endContainer,\n        endOffset = rng.endOffset;\n    var dom = editor.dom;\n\n    if (isElement$1(startContainer) && startContainer.hasChildNodes()) {\n      startContainer = getNode(startContainer, startOffset);\n\n      if (isText$1(startContainer)) {\n        startOffset = 0;\n      }\n    }\n\n    if (isElement$1(endContainer) && endContainer.hasChildNodes()) {\n      endContainer = getNode(endContainer, rng.collapsed ? endOffset : endOffset - 1);\n\n      if (isText$1(endContainer)) {\n        endOffset = endContainer.nodeValue.length;\n      }\n    }\n\n    startContainer = findParentContentEditable(dom, startContainer);\n    endContainer = findParentContentEditable(dom, endContainer);\n\n    if (isBookmarkNode$2(startContainer.parentNode) || isBookmarkNode$2(startContainer)) {\n      startContainer = isBookmarkNode$2(startContainer) ? startContainer : startContainer.parentNode;\n\n      if (rng.collapsed) {\n        startContainer = startContainer.previousSibling || startContainer;\n      } else {\n        startContainer = startContainer.nextSibling || startContainer;\n      }\n\n      if (isText$1(startContainer)) {\n        startOffset = rng.collapsed ? startContainer.length : 0;\n      }\n    }\n\n    if (isBookmarkNode$2(endContainer.parentNode) || isBookmarkNode$2(endContainer)) {\n      endContainer = isBookmarkNode$2(endContainer) ? endContainer : endContainer.parentNode;\n\n      if (rng.collapsed) {\n        endContainer = endContainer.nextSibling || endContainer;\n      } else {\n        endContainer = endContainer.previousSibling || endContainer;\n      }\n\n      if (isText$1(endContainer)) {\n        endOffset = rng.collapsed ? 0 : endContainer.length;\n      }\n    }\n\n    if (rng.collapsed) {\n      var startPoint = findWordEndPoint(dom, editor.getBody(), startContainer, startOffset, true, includeTrailingSpace);\n      startPoint.each(function (_a) {\n        var container = _a.container,\n            offset = _a.offset;\n        startContainer = container;\n        startOffset = offset;\n      });\n      var endPoint = findWordEndPoint(dom, editor.getBody(), endContainer, endOffset, false, includeTrailingSpace);\n      endPoint.each(function (_a) {\n        var container = _a.container,\n            offset = _a.offset;\n        endContainer = container;\n        endOffset = offset;\n      });\n    }\n\n    if (format[0].inline || format[0].block_expand) {\n      if (!format[0].inline || !isText$1(startContainer) || startOffset === 0) {\n        startContainer = findParentContainer(dom, format, startContainer, startOffset, endContainer, endOffset, true);\n      }\n\n      if (!format[0].inline || !isText$1(endContainer) || endOffset === endContainer.nodeValue.length) {\n        endContainer = findParentContainer(dom, format, startContainer, startOffset, endContainer, endOffset, false);\n      }\n    }\n\n    if (format[0].selector && format[0].expand !== false && !format[0].inline) {\n      startContainer = findSelectorEndPoint(dom, format, rng, startContainer, 'previousSibling');\n      endContainer = findSelectorEndPoint(dom, format, rng, endContainer, 'nextSibling');\n    }\n\n    if (format[0].block || format[0].selector) {\n      startContainer = findBlockEndPoint(editor, format, startContainer, 'previousSibling');\n      endContainer = findBlockEndPoint(editor, format, endContainer, 'nextSibling');\n\n      if (format[0].block) {\n        if (!dom.isBlock(startContainer)) {\n          startContainer = findParentContainer(dom, format, startContainer, startOffset, endContainer, endOffset, true);\n        }\n\n        if (!dom.isBlock(endContainer)) {\n          endContainer = findParentContainer(dom, format, startContainer, startOffset, endContainer, endOffset, false);\n        }\n      }\n    }\n\n    if (isElement$1(startContainer)) {\n      startOffset = dom.nodeIndex(startContainer);\n      startContainer = startContainer.parentNode;\n    }\n\n    if (isElement$1(endContainer)) {\n      endOffset = dom.nodeIndex(endContainer) + 1;\n      endContainer = endContainer.parentNode;\n    }\n\n    return {\n      startContainer: startContainer,\n      startOffset: startOffset,\n      endContainer: endContainer,\n      endOffset: endOffset\n    };\n  };\n\n  var clampToExistingChildren = function (container, index) {\n    var childNodes = container.childNodes;\n\n    if (index >= childNodes.length) {\n      index = childNodes.length - 1;\n    } else if (index < 0) {\n      index = 0;\n    }\n\n    return childNodes[index] || container;\n  };\n\n  var getEndChild = function (container, index) {\n    return clampToExistingChildren(container, index - 1);\n  };\n\n  var walk$1 = function (dom, rng, callback) {\n    var startContainer = rng.startContainer;\n    var startOffset = rng.startOffset;\n    var endContainer = rng.endContainer;\n    var endOffset = rng.endOffset;\n\n    var exclude = function (nodes) {\n      var node;\n      node = nodes[0];\n\n      if (node.nodeType === 3 && node === startContainer && startOffset >= node.nodeValue.length) {\n        nodes.splice(0, 1);\n      }\n\n      node = nodes[nodes.length - 1];\n\n      if (endOffset === 0 && nodes.length > 0 && node === endContainer && node.nodeType === 3) {\n        nodes.splice(nodes.length - 1, 1);\n      }\n\n      return nodes;\n    };\n\n    var collectSiblings = function (node, name, endNode) {\n      var siblings = [];\n\n      for (; node && node !== endNode; node = node[name]) {\n        siblings.push(node);\n      }\n\n      return siblings;\n    };\n\n    var findEndPoint = function (node, root) {\n      do {\n        if (node.parentNode === root) {\n          return node;\n        }\n\n        node = node.parentNode;\n      } while (node);\n    };\n\n    var walkBoundary = function (startNode, endNode, next) {\n      var siblingName = next ? 'nextSibling' : 'previousSibling';\n\n      for (var node = startNode, parent_1 = node.parentNode; node && node !== endNode; node = parent_1) {\n        parent_1 = node.parentNode;\n        var siblings_1 = collectSiblings(node === startNode ? node : node[siblingName], siblingName);\n\n        if (siblings_1.length) {\n          if (!next) {\n            siblings_1.reverse();\n          }\n\n          callback(exclude(siblings_1));\n        }\n      }\n    };\n\n    if (startContainer.nodeType === 1 && startContainer.hasChildNodes()) {\n      startContainer = clampToExistingChildren(startContainer, startOffset);\n    }\n\n    if (endContainer.nodeType === 1 && endContainer.hasChildNodes()) {\n      endContainer = getEndChild(endContainer, endOffset);\n    }\n\n    if (startContainer === endContainer) {\n      return callback(exclude([startContainer]));\n    }\n\n    var ancestor = dom.findCommonAncestor(startContainer, endContainer);\n\n    for (var node = startContainer; node; node = node.parentNode) {\n      if (node === endContainer) {\n        return walkBoundary(startContainer, ancestor, true);\n      }\n\n      if (node === ancestor) {\n        break;\n      }\n    }\n\n    for (var node = endContainer; node; node = node.parentNode) {\n      if (node === startContainer) {\n        return walkBoundary(endContainer, ancestor);\n      }\n\n      if (node === ancestor) {\n        break;\n      }\n    }\n\n    var startPoint = findEndPoint(startContainer, ancestor) || startContainer;\n    var endPoint = findEndPoint(endContainer, ancestor) || endContainer;\n    walkBoundary(startContainer, startPoint, true);\n    var siblings = collectSiblings(startPoint === startContainer ? startPoint : startPoint.nextSibling, 'nextSibling', endPoint === endContainer ? endPoint.nextSibling : endPoint);\n\n    if (siblings.length) {\n      callback(exclude(siblings));\n    }\n\n    walkBoundary(endContainer, endPoint);\n  };\n\n  var getRanges = function (selection) {\n    var ranges = [];\n\n    if (selection) {\n      for (var i = 0; i < selection.rangeCount; i++) {\n        ranges.push(selection.getRangeAt(i));\n      }\n    }\n\n    return ranges;\n  };\n\n  var getSelectedNodes = function (ranges) {\n    return bind(ranges, function (range) {\n      var node = getSelectedNode(range);\n      return node ? [SugarElement.fromDom(node)] : [];\n    });\n  };\n\n  var hasMultipleRanges = function (selection) {\n    return getRanges(selection).length > 1;\n  };\n\n  var getCellsFromRanges = function (ranges) {\n    return filter(getSelectedNodes(ranges), isTableCell$1);\n  };\n\n  var getCellsFromElement = function (elm) {\n    return descendants$1(elm, 'td[data-mce-selected],th[data-mce-selected]');\n  };\n\n  var getCellsFromElementOrRanges = function (ranges, element) {\n    var selectedCells = getCellsFromElement(element);\n    return selectedCells.length > 0 ? selectedCells : getCellsFromRanges(ranges);\n  };\n\n  var getCellsFromEditor = function (editor) {\n    return getCellsFromElementOrRanges(getRanges(editor.selection.getSel()), SugarElement.fromDom(editor.getBody()));\n  };\n\n  var getStartNode = function (rng) {\n    var sc = rng.startContainer,\n        so = rng.startOffset;\n\n    if (isText$1(sc)) {\n      return so === 0 ? Optional.some(SugarElement.fromDom(sc)) : Optional.none();\n    } else {\n      return Optional.from(sc.childNodes[so]).map(SugarElement.fromDom);\n    }\n  };\n\n  var getEndNode = function (rng) {\n    var ec = rng.endContainer,\n        eo = rng.endOffset;\n\n    if (isText$1(ec)) {\n      return eo === ec.data.length ? Optional.some(SugarElement.fromDom(ec)) : Optional.none();\n    } else {\n      return Optional.from(ec.childNodes[eo - 1]).map(SugarElement.fromDom);\n    }\n  };\n\n  var getFirstChildren = function (node) {\n    return firstChild(node).fold(constant([node]), function (child) {\n      return [node].concat(getFirstChildren(child));\n    });\n  };\n\n  var getLastChildren = function (node) {\n    return lastChild(node).fold(constant([node]), function (child) {\n      if (name(child) === 'br') {\n        return prevSibling(child).map(function (sibling) {\n          return [node].concat(getLastChildren(sibling));\n        }).getOr([]);\n      } else {\n        return [node].concat(getLastChildren(child));\n      }\n    });\n  };\n\n  var hasAllContentsSelected = function (elm, rng) {\n    return lift2(getStartNode(rng), getEndNode(rng), function (startNode, endNode) {\n      var start = find(getFirstChildren(elm), curry(eq$2, startNode));\n      var end = find(getLastChildren(elm), curry(eq$2, endNode));\n      return start.isSome() && end.isSome();\n    }).getOr(false);\n  };\n\n  var moveEndPoint$1 = function (dom, rng, node, start) {\n    var root = node,\n        walker = new DomTreeWalker(node, root);\n    var moveCaretBeforeOnEnterElementsMap = filter$1(dom.schema.getMoveCaretBeforeOnEnterElements(), function (_, name) {\n      return !contains(['td', 'th', 'table'], name.toLowerCase());\n    });\n\n    do {\n      if (isText$1(node) && Tools.trim(node.nodeValue).length !== 0) {\n        if (start) {\n          rng.setStart(node, 0);\n        } else {\n          rng.setEnd(node, node.nodeValue.length);\n        }\n\n        return;\n      }\n\n      if (moveCaretBeforeOnEnterElementsMap[node.nodeName]) {\n        if (start) {\n          rng.setStartBefore(node);\n        } else {\n          if (node.nodeName === 'BR') {\n            rng.setEndBefore(node);\n          } else {\n            rng.setEndAfter(node);\n          }\n        }\n\n        return;\n      }\n    } while (node = start ? walker.next() : walker.prev());\n\n    if (root.nodeName === 'BODY') {\n      if (start) {\n        rng.setStart(root, 0);\n      } else {\n        rng.setEnd(root, root.childNodes.length);\n      }\n    }\n  };\n\n  var hasAnyRanges = function (editor) {\n    var sel = editor.selection.getSel();\n    return sel && sel.rangeCount > 0;\n  };\n\n  var runOnRanges = function (editor, executor) {\n    var fakeSelectionNodes = getCellsFromEditor(editor);\n\n    if (fakeSelectionNodes.length > 0) {\n      each(fakeSelectionNodes, function (elem) {\n        var node = elem.dom;\n        var fakeNodeRng = editor.dom.createRng();\n        fakeNodeRng.setStartBefore(node);\n        fakeNodeRng.setEndAfter(node);\n        executor(fakeNodeRng, true);\n      });\n    } else {\n      executor(editor.selection.getRng(), false);\n    }\n  };\n\n  var preserve = function (selection, fillBookmark, executor) {\n    var bookmark = getPersistentBookmark(selection, fillBookmark);\n    executor(bookmark);\n    selection.moveToBookmark(bookmark);\n  };\n\n  function NodeValue(is, name) {\n    var get = function (element) {\n      if (!is(element)) {\n        throw new Error('Can only get ' + name + ' value of a ' + name + ' node');\n      }\n\n      return getOption(element).getOr('');\n    };\n\n    var getOption = function (element) {\n      return is(element) ? Optional.from(element.dom.nodeValue) : Optional.none();\n    };\n\n    var set = function (element, value) {\n      if (!is(element)) {\n        throw new Error('Can only set raw ' + name + ' value of a ' + name + ' node');\n      }\n\n      element.dom.nodeValue = value;\n    };\n\n    return {\n      get: get,\n      getOption: getOption,\n      set: set\n    };\n  }\n\n  var api = NodeValue(isText, 'text');\n\n  var get$7 = function (element) {\n    return api.get(element);\n  };\n\n  var isZeroWidth = function (elem) {\n    return isText(elem) && get$7(elem) === ZWSP;\n  };\n\n  var context = function (editor, elem, wrapName, nodeName) {\n    return parent(elem).fold(function () {\n      return 'skipping';\n    }, function (parent) {\n      if (nodeName === 'br' || isZeroWidth(elem)) {\n        return 'valid';\n      } else if (isAnnotation(elem)) {\n        return 'existing';\n      } else if (isCaretNode(elem.dom)) {\n        return 'caret';\n      } else if (!isValid(editor, wrapName, nodeName) || !isValid(editor, name(parent), wrapName)) {\n        return 'invalid-child';\n      } else {\n        return 'valid';\n      }\n    });\n  };\n\n  var applyWordGrab = function (editor, rng) {\n    var r = expandRng(editor, rng, [{\n      inline: true\n    }]);\n    rng.setStart(r.startContainer, r.startOffset);\n    rng.setEnd(r.endContainer, r.endOffset);\n    editor.selection.setRng(rng);\n  };\n\n  var makeAnnotation = function (eDoc, _a, annotationName, decorate) {\n    var _b = _a.uid,\n        uid = _b === void 0 ? generate$1('mce-annotation') : _b,\n        data = __rest(_a, ['uid']);\n\n    var master = SugarElement.fromTag('span', eDoc);\n    add$3(master, annotation());\n    set(master, '' + dataAnnotationId(), uid);\n    set(master, '' + dataAnnotation(), annotationName);\n\n    var _c = decorate(uid, data),\n        _d = _c.attributes,\n        attributes = _d === void 0 ? {} : _d,\n        _e = _c.classes,\n        classes = _e === void 0 ? [] : _e;\n\n    setAll(master, attributes);\n    add$4(master, classes);\n    return master;\n  };\n\n  var annotate = function (editor, rng, annotationName, decorate, data) {\n    var newWrappers = [];\n    var master = makeAnnotation(editor.getDoc(), data, annotationName, decorate);\n    var wrapper = Cell(Optional.none());\n\n    var finishWrapper = function () {\n      wrapper.set(Optional.none());\n    };\n\n    var getOrOpenWrapper = function () {\n      return wrapper.get().getOrThunk(function () {\n        var nu = shallow(master);\n        newWrappers.push(nu);\n        wrapper.set(Optional.some(nu));\n        return nu;\n      });\n    };\n\n    var processElements = function (elems) {\n      each(elems, processElement);\n    };\n\n    var processElement = function (elem) {\n      var ctx = context(editor, elem, 'span', name(elem));\n\n      switch (ctx) {\n        case 'invalid-child':\n          {\n            finishWrapper();\n            var children$1 = children(elem);\n            processElements(children$1);\n            finishWrapper();\n            break;\n          }\n\n        case 'valid':\n          {\n            var w = getOrOpenWrapper();\n            wrap(elem, w);\n            break;\n          }\n      }\n    };\n\n    var processNodes = function (nodes) {\n      var elems = map(nodes, SugarElement.fromDom);\n      processElements(elems);\n    };\n\n    walk$1(editor.dom, rng, function (nodes) {\n      finishWrapper();\n      processNodes(nodes);\n    });\n    return newWrappers;\n  };\n\n  var annotateWithBookmark = function (editor, name, settings, data) {\n    editor.undoManager.transact(function () {\n      var selection = editor.selection;\n      var initialRng = selection.getRng();\n      var hasFakeSelection = getCellsFromEditor(editor).length > 0;\n\n      if (initialRng.collapsed && !hasFakeSelection) {\n        applyWordGrab(editor, initialRng);\n      }\n\n      if (selection.getRng().collapsed && !hasFakeSelection) {\n        var wrapper = makeAnnotation(editor.getDoc(), data, name, settings.decorate);\n        set$1(wrapper, nbsp);\n        selection.getRng().insertNode(wrapper.dom);\n        selection.select(wrapper.dom);\n      } else {\n        preserve(selection, false, function () {\n          runOnRanges(editor, function (selectionRng) {\n            annotate(editor, selectionRng, name, settings.decorate, data);\n          });\n        });\n      }\n    });\n  };\n\n  var Annotator = function (editor) {\n    var registry = create$2();\n    setup$1(editor, registry);\n    var changes = setup(editor);\n    return {\n      register: function (name, settings) {\n        registry.register(name, settings);\n      },\n      annotate: function (name, data) {\n        registry.lookup(name).each(function (settings) {\n          annotateWithBookmark(editor, name, settings, data);\n        });\n      },\n      annotationChanged: function (name, callback) {\n        changes.addListener(name, callback);\n      },\n      remove: function (name) {\n        identify(editor, Optional.some(name)).each(function (_a) {\n          var elements = _a.elements;\n          each(elements, unwrap);\n        });\n      },\n      getAll: function (name) {\n        var directory = findAll(editor, name);\n        return map$1(directory, function (elems) {\n          return map(elems, function (elem) {\n            return elem.dom;\n          });\n        });\n      }\n    };\n  };\n\n  function BookmarkManager(selection) {\n    return {\n      getBookmark: curry(getBookmark$1, selection),\n      moveToBookmark: curry(moveToBookmark, selection)\n    };\n  }\n\n  (function (BookmarkManager) {\n    BookmarkManager.isBookmarkNode = isBookmarkNode$1;\n  })(BookmarkManager || (BookmarkManager = {}));\n\n  var BookmarkManager$1 = BookmarkManager;\n\n  var getContentEditableRoot = function (root, node) {\n    while (node && node !== root) {\n      if (isContentEditableTrue(node) || isContentEditableFalse(node)) {\n        return node;\n      }\n\n      node = node.parentNode;\n    }\n\n    return null;\n  };\n\n  var isXYWithinRange = function (clientX, clientY, range) {\n    if (range.collapsed) {\n      return false;\n    }\n\n    if (Env.browser.isIE() && range.startOffset === range.endOffset - 1 && range.startContainer === range.endContainer) {\n      var elm = range.startContainer.childNodes[range.startOffset];\n\n      if (isElement$1(elm)) {\n        return exists(elm.getClientRects(), function (rect) {\n          return containsXY(rect, clientX, clientY);\n        });\n      }\n    }\n\n    return exists(range.getClientRects(), function (rect) {\n      return containsXY(rect, clientX, clientY);\n    });\n  };\n\n  var firePreProcess = function (editor, args) {\n    return editor.fire('PreProcess', args);\n  };\n\n  var firePostProcess = function (editor, args) {\n    return editor.fire('PostProcess', args);\n  };\n\n  var fireRemove = function (editor) {\n    return editor.fire('remove');\n  };\n\n  var fireDetach = function (editor) {\n    return editor.fire('detach');\n  };\n\n  var fireSwitchMode = function (editor, mode) {\n    return editor.fire('SwitchMode', {\n      mode: mode\n    });\n  };\n\n  var fireObjectResizeStart = function (editor, target, width, height, origin) {\n    editor.fire('ObjectResizeStart', {\n      target: target,\n      width: width,\n      height: height,\n      origin: origin\n    });\n  };\n\n  var fireObjectResized = function (editor, target, width, height, origin) {\n    editor.fire('ObjectResized', {\n      target: target,\n      width: width,\n      height: height,\n      origin: origin\n    });\n  };\n\n  var firePreInit = function (editor) {\n    return editor.fire('PreInit');\n  };\n\n  var firePostRender = function (editor) {\n    return editor.fire('PostRender');\n  };\n\n  var fireInit = function (editor) {\n    return editor.fire('Init');\n  };\n\n  var firePlaceholderToggle = function (editor, state) {\n    return editor.fire('PlaceholderToggle', {\n      state: state\n    });\n  };\n\n  var fireError = function (editor, errorType, error) {\n    return editor.fire(errorType, error);\n  };\n\n  var VK = {\n    BACKSPACE: 8,\n    DELETE: 46,\n    DOWN: 40,\n    ENTER: 13,\n    LEFT: 37,\n    RIGHT: 39,\n    SPACEBAR: 32,\n    TAB: 9,\n    UP: 38,\n    END: 35,\n    HOME: 36,\n    modifierPressed: function (e) {\n      return e.shiftKey || e.ctrlKey || e.altKey || this.metaKeyPressed(e);\n    },\n    metaKeyPressed: function (e) {\n      return Env.mac ? e.metaKey : e.ctrlKey && !e.altKey;\n    }\n  };\n  var isContentEditableFalse$6 = isContentEditableFalse;\n\n  var ControlSelection = function (selection, editor) {\n    var dom = editor.dom,\n        each = Tools.each;\n    var selectedElm, selectedElmGhost, resizeHelper, selectedHandle;\n    var startX, startY, selectedElmX, selectedElmY, startW, startH, ratio, resizeStarted;\n    var width, height;\n    var editableDoc = editor.getDoc(),\n        rootDocument = document;\n    var abs = Math.abs,\n        round = Math.round,\n        rootElement = editor.getBody();\n    var startScrollWidth, startScrollHeight;\n    var resizeHandles = {\n      nw: [0, 0, -1, -1],\n      ne: [1, 0, 1, -1],\n      se: [1, 1, 1, 1],\n      sw: [0, 1, -1, 1]\n    };\n\n    var isImage = function (elm) {\n      return elm && (elm.nodeName === 'IMG' || editor.dom.is(elm, 'figure.image'));\n    };\n\n    var isEventOnImageOutsideRange = function (evt, range) {\n      if (evt.type === 'longpress' || evt.type.indexOf('touch') === 0) {\n        var touch = evt.touches[0];\n        return isImage(evt.target) && !isXYWithinRange(touch.clientX, touch.clientY, range);\n      } else {\n        return isImage(evt.target) && !isXYWithinRange(evt.clientX, evt.clientY, range);\n      }\n    };\n\n    var contextMenuSelectImage = function (evt) {\n      var target = evt.target;\n\n      if (isEventOnImageOutsideRange(evt, editor.selection.getRng()) && !evt.isDefaultPrevented()) {\n        editor.selection.select(target);\n      }\n    };\n\n    var getResizeTarget = function (elm) {\n      return editor.dom.is(elm, 'figure.image') ? elm.querySelector('img') : elm;\n    };\n\n    var isResizable = function (elm) {\n      var selector = getObjectResizing(editor);\n\n      if (!selector) {\n        return false;\n      }\n\n      if (elm.getAttribute('data-mce-resize') === 'false') {\n        return false;\n      }\n\n      if (elm === editor.getBody()) {\n        return false;\n      }\n\n      return is$1(SugarElement.fromDom(elm), selector);\n    };\n\n    var setGhostElmSize = function (ghostElm, width, height) {\n      dom.setStyles(getResizeTarget(ghostElm), {\n        width: width,\n        height: height\n      });\n    };\n\n    var resizeGhostElement = function (e) {\n      var deltaX, deltaY, proportional;\n      var resizeHelperX, resizeHelperY;\n      deltaX = e.screenX - startX;\n      deltaY = e.screenY - startY;\n      width = deltaX * selectedHandle[2] + startW;\n      height = deltaY * selectedHandle[3] + startH;\n      width = width < 5 ? 5 : width;\n      height = height < 5 ? 5 : height;\n\n      if (isImage(selectedElm) && getResizeImgProportional(editor) !== false) {\n        proportional = !VK.modifierPressed(e);\n      } else {\n        proportional = VK.modifierPressed(e);\n      }\n\n      if (proportional) {\n        if (abs(deltaX) > abs(deltaY)) {\n          height = round(width * ratio);\n          width = round(height / ratio);\n        } else {\n          width = round(height / ratio);\n          height = round(width * ratio);\n        }\n      }\n\n      setGhostElmSize(selectedElmGhost, width, height);\n      resizeHelperX = selectedHandle.startPos.x + deltaX;\n      resizeHelperY = selectedHandle.startPos.y + deltaY;\n      resizeHelperX = resizeHelperX > 0 ? resizeHelperX : 0;\n      resizeHelperY = resizeHelperY > 0 ? resizeHelperY : 0;\n      dom.setStyles(resizeHelper, {\n        left: resizeHelperX,\n        top: resizeHelperY,\n        display: 'block'\n      });\n      resizeHelper.innerHTML = width + ' &times; ' + height;\n\n      if (selectedHandle[2] < 0 && selectedElmGhost.clientWidth <= width) {\n        dom.setStyle(selectedElmGhost, 'left', selectedElmX + (startW - width));\n      }\n\n      if (selectedHandle[3] < 0 && selectedElmGhost.clientHeight <= height) {\n        dom.setStyle(selectedElmGhost, 'top', selectedElmY + (startH - height));\n      }\n\n      deltaX = rootElement.scrollWidth - startScrollWidth;\n      deltaY = rootElement.scrollHeight - startScrollHeight;\n\n      if (deltaX + deltaY !== 0) {\n        dom.setStyles(resizeHelper, {\n          left: resizeHelperX - deltaX,\n          top: resizeHelperY - deltaY\n        });\n      }\n\n      if (!resizeStarted) {\n        fireObjectResizeStart(editor, selectedElm, startW, startH, 'corner-' + selectedHandle.name);\n        resizeStarted = true;\n      }\n    };\n\n    var endGhostResize = function () {\n      var wasResizeStarted = resizeStarted;\n      resizeStarted = false;\n\n      var setSizeProp = function (name, value) {\n        if (value) {\n          if (selectedElm.style[name] || !editor.schema.isValid(selectedElm.nodeName.toLowerCase(), name)) {\n            dom.setStyle(getResizeTarget(selectedElm), name, value);\n          } else {\n            dom.setAttrib(getResizeTarget(selectedElm), name, '' + value);\n          }\n        }\n      };\n\n      if (wasResizeStarted) {\n        setSizeProp('width', width);\n        setSizeProp('height', height);\n      }\n\n      dom.unbind(editableDoc, 'mousemove', resizeGhostElement);\n      dom.unbind(editableDoc, 'mouseup', endGhostResize);\n\n      if (rootDocument !== editableDoc) {\n        dom.unbind(rootDocument, 'mousemove', resizeGhostElement);\n        dom.unbind(rootDocument, 'mouseup', endGhostResize);\n      }\n\n      dom.remove(selectedElmGhost);\n      dom.remove(resizeHelper);\n      showResizeRect(selectedElm);\n\n      if (wasResizeStarted) {\n        fireObjectResized(editor, selectedElm, width, height, 'corner-' + selectedHandle.name);\n        dom.setAttrib(selectedElm, 'style', dom.getAttrib(selectedElm, 'style'));\n      }\n\n      editor.nodeChanged();\n    };\n\n    var showResizeRect = function (targetElm) {\n      hideResizeRect();\n      unbindResizeHandleEvents();\n      var position = dom.getPos(targetElm, rootElement);\n      var selectedElmX = position.x;\n      var selectedElmY = position.y;\n      var rect = targetElm.getBoundingClientRect();\n      var targetWidth = rect.width || rect.right - rect.left;\n      var targetHeight = rect.height || rect.bottom - rect.top;\n\n      if (selectedElm !== targetElm) {\n        selectedElm = targetElm;\n        width = height = 0;\n      }\n\n      var e = editor.fire('ObjectSelected', {\n        target: targetElm\n      });\n\n      if (isResizable(targetElm) && !e.isDefaultPrevented()) {\n        each(resizeHandles, function (handle, name) {\n          var handleElm;\n\n          var startDrag = function (e) {\n            startX = e.screenX;\n            startY = e.screenY;\n            startW = getResizeTarget(selectedElm).clientWidth;\n            startH = getResizeTarget(selectedElm).clientHeight;\n            ratio = startH / startW;\n            selectedHandle = handle;\n            selectedHandle.name = name;\n            selectedHandle.startPos = {\n              x: targetWidth * handle[0] + selectedElmX,\n              y: targetHeight * handle[1] + selectedElmY\n            };\n            startScrollWidth = rootElement.scrollWidth;\n            startScrollHeight = rootElement.scrollHeight;\n            selectedElmGhost = selectedElm.cloneNode(true);\n            dom.addClass(selectedElmGhost, 'mce-clonedresizable');\n            dom.setAttrib(selectedElmGhost, 'data-mce-bogus', 'all');\n            selectedElmGhost.contentEditable = false;\n            selectedElmGhost.unSelectabe = true;\n            dom.setStyles(selectedElmGhost, {\n              left: selectedElmX,\n              top: selectedElmY,\n              margin: 0\n            });\n            setGhostElmSize(selectedElmGhost, targetWidth, targetHeight);\n            selectedElmGhost.removeAttribute('data-mce-selected');\n            rootElement.appendChild(selectedElmGhost);\n            dom.bind(editableDoc, 'mousemove', resizeGhostElement);\n            dom.bind(editableDoc, 'mouseup', endGhostResize);\n\n            if (rootDocument !== editableDoc) {\n              dom.bind(rootDocument, 'mousemove', resizeGhostElement);\n              dom.bind(rootDocument, 'mouseup', endGhostResize);\n            }\n\n            resizeHelper = dom.add(rootElement, 'div', {\n              'class': 'mce-resize-helper',\n              'data-mce-bogus': 'all'\n            }, startW + ' &times; ' + startH);\n          };\n\n          handleElm = dom.get('mceResizeHandle' + name);\n\n          if (handleElm) {\n            dom.remove(handleElm);\n          }\n\n          handleElm = dom.add(rootElement, 'div', {\n            'id': 'mceResizeHandle' + name,\n            'data-mce-bogus': 'all',\n            'class': 'mce-resizehandle',\n            'unselectable': true,\n            'style': 'cursor:' + name + '-resize; margin:0; padding:0'\n          });\n\n          if (Env.ie === 11) {\n            handleElm.contentEditable = false;\n          }\n\n          dom.bind(handleElm, 'mousedown', function (e) {\n            e.stopImmediatePropagation();\n            e.preventDefault();\n            startDrag(e);\n          });\n          handle.elm = handleElm;\n          dom.setStyles(handleElm, {\n            left: targetWidth * handle[0] + selectedElmX - handleElm.offsetWidth / 2,\n            top: targetHeight * handle[1] + selectedElmY - handleElm.offsetHeight / 2\n          });\n        });\n      } else {\n        hideResizeRect();\n      }\n\n      selectedElm.setAttribute('data-mce-selected', '1');\n    };\n\n    var hideResizeRect = function () {\n      unbindResizeHandleEvents();\n\n      if (selectedElm) {\n        selectedElm.removeAttribute('data-mce-selected');\n      }\n\n      each$1(resizeHandles, function (value, name) {\n        var handleElm = dom.get('mceResizeHandle' + name);\n\n        if (handleElm) {\n          dom.unbind(handleElm);\n          dom.remove(handleElm);\n        }\n      });\n    };\n\n    var updateResizeRect = function (e) {\n      var startElm, controlElm;\n\n      var isChildOrEqual = function (node, parent) {\n        if (node) {\n          do {\n            if (node === parent) {\n              return true;\n            }\n          } while (node = node.parentNode);\n        }\n      };\n\n      if (resizeStarted || editor.removed) {\n        return;\n      }\n\n      each(dom.select('img[data-mce-selected],hr[data-mce-selected]'), function (img) {\n        img.removeAttribute('data-mce-selected');\n      });\n      controlElm = e.type === 'mousedown' ? e.target : selection.getNode();\n      controlElm = dom.$(controlElm).closest('table,img,figure.image,hr')[0];\n\n      if (isChildOrEqual(controlElm, rootElement)) {\n        disableGeckoResize();\n        startElm = selection.getStart(true);\n\n        if (isChildOrEqual(startElm, controlElm) && isChildOrEqual(selection.getEnd(true), controlElm)) {\n          showResizeRect(controlElm);\n          return;\n        }\n      }\n\n      hideResizeRect();\n    };\n\n    var isWithinContentEditableFalse = function (elm) {\n      return isContentEditableFalse$6(getContentEditableRoot(editor.getBody(), elm));\n    };\n\n    var unbindResizeHandleEvents = function () {\n      each$1(resizeHandles, function (handle) {\n        if (handle.elm) {\n          dom.unbind(handle.elm);\n          delete handle.elm;\n        }\n      });\n    };\n\n    var disableGeckoResize = function () {\n      try {\n        editor.getDoc().execCommand('enableObjectResizing', false, 'false');\n      } catch (ex) {}\n    };\n\n    editor.on('init', function () {\n      disableGeckoResize();\n\n      if (Env.browser.isIE() || Env.browser.isEdge()) {\n        editor.on('mousedown click', function (e) {\n          var target = e.target,\n              nodeName = target.nodeName;\n\n          if (!resizeStarted && /^(TABLE|IMG|HR)$/.test(nodeName) && !isWithinContentEditableFalse(target)) {\n            if (e.button !== 2) {\n              editor.selection.select(target, nodeName === 'TABLE');\n            }\n\n            if (e.type === 'mousedown') {\n              editor.nodeChanged();\n            }\n          }\n        });\n\n        var handleMSControlSelect_1 = function (e) {\n          var delayedSelect = function (node) {\n            Delay.setEditorTimeout(editor, function () {\n              return editor.selection.select(node);\n            });\n          };\n\n          if (isWithinContentEditableFalse(e.target) || isMedia(e.target)) {\n            e.preventDefault();\n            delayedSelect(e.target);\n            return;\n          }\n\n          if (/^(TABLE|IMG|HR)$/.test(e.target.nodeName)) {\n            e.preventDefault();\n\n            if (e.target.tagName === 'IMG') {\n              delayedSelect(e.target);\n            }\n          }\n        };\n\n        dom.bind(rootElement, 'mscontrolselect', handleMSControlSelect_1);\n        editor.on('remove', function () {\n          return dom.unbind(rootElement, 'mscontrolselect', handleMSControlSelect_1);\n        });\n      }\n\n      var throttledUpdateResizeRect = Delay.throttle(function (e) {\n        if (!editor.composing) {\n          updateResizeRect(e);\n        }\n      });\n      editor.on('nodechange ResizeEditor ResizeWindow ResizeContent drop FullscreenStateChanged', throttledUpdateResizeRect);\n      editor.on('keyup compositionend', function (e) {\n        if (selectedElm && selectedElm.nodeName === 'TABLE') {\n          throttledUpdateResizeRect(e);\n        }\n      });\n      editor.on('hide blur', hideResizeRect);\n      editor.on('contextmenu longpress', contextMenuSelectImage, true);\n    });\n    editor.on('remove', unbindResizeHandleEvents);\n\n    var destroy = function () {\n      selectedElm = selectedElmGhost = null;\n    };\n\n    return {\n      isResizable: isResizable,\n      showResizeRect: showResizeRect,\n      hideResizeRect: hideResizeRect,\n      updateResizeRect: updateResizeRect,\n      destroy: destroy\n    };\n  };\n\n  var hasCeProperty = function (node) {\n    return isContentEditableTrue(node) || isContentEditableFalse(node);\n  };\n\n  var findParent = function (node, rootNode, predicate) {\n    while (node && node !== rootNode) {\n      if (predicate(node)) {\n        return node;\n      }\n\n      node = node.parentNode;\n    }\n\n    return null;\n  };\n\n  var findClosestIeRange = function (clientX, clientY, doc) {\n    var rects;\n    var element = doc.elementFromPoint(clientX, clientY);\n    var rng = doc.body.createTextRange();\n\n    if (!element || element.tagName === 'HTML') {\n      element = doc.body;\n    }\n\n    rng.moveToElementText(element);\n    rects = Tools.toArray(rng.getClientRects());\n    rects = rects.sort(function (a, b) {\n      a = Math.abs(Math.max(a.top - clientY, a.bottom - clientY));\n      b = Math.abs(Math.max(b.top - clientY, b.bottom - clientY));\n      return a - b;\n    });\n\n    if (rects.length > 0) {\n      clientY = (rects[0].bottom + rects[0].top) / 2;\n\n      try {\n        rng.moveToPoint(clientX, clientY);\n        rng.collapse(true);\n        return rng;\n      } catch (ex) {}\n    }\n\n    return null;\n  };\n\n  var moveOutOfContentEditableFalse = function (rng, rootNode) {\n    var parentElement = rng && rng.parentElement ? rng.parentElement() : null;\n    return isContentEditableFalse(findParent(parentElement, rootNode, hasCeProperty)) ? null : rng;\n  };\n\n  var fromPoint$1 = function (clientX, clientY, doc) {\n    var rng, point;\n    var pointDoc = doc;\n\n    if (pointDoc.caretPositionFromPoint) {\n      point = pointDoc.caretPositionFromPoint(clientX, clientY);\n\n      if (point) {\n        rng = doc.createRange();\n        rng.setStart(point.offsetNode, point.offset);\n        rng.collapse(true);\n      }\n    } else if (doc.caretRangeFromPoint) {\n      rng = doc.caretRangeFromPoint(clientX, clientY);\n    } else if (pointDoc.body.createTextRange) {\n      rng = pointDoc.body.createTextRange();\n\n      try {\n        rng.moveToPoint(clientX, clientY);\n        rng.collapse(true);\n      } catch (ex) {\n        rng = findClosestIeRange(clientX, clientY, doc);\n      }\n\n      return moveOutOfContentEditableFalse(rng, doc.body);\n    }\n\n    return rng;\n  };\n\n  var isEq$1 = function (rng1, rng2) {\n    return rng1 && rng2 && rng1.startContainer === rng2.startContainer && rng1.startOffset === rng2.startOffset && rng1.endContainer === rng2.endContainer && rng1.endOffset === rng2.endOffset;\n  };\n\n  var findParent$1 = function (node, rootNode, predicate) {\n    while (node && node !== rootNode) {\n      if (predicate(node)) {\n        return node;\n      }\n\n      node = node.parentNode;\n    }\n\n    return null;\n  };\n\n  var hasParent = function (node, rootNode, predicate) {\n    return findParent$1(node, rootNode, predicate) !== null;\n  };\n\n  var hasParentWithName = function (node, rootNode, name) {\n    return hasParent(node, rootNode, function (node) {\n      return node.nodeName === name;\n    });\n  };\n\n  var isTable$3 = function (node) {\n    return node && node.nodeName === 'TABLE';\n  };\n\n  var isTableCell$3 = function (node) {\n    return node && /^(TD|TH|CAPTION)$/.test(node.nodeName);\n  };\n\n  var isCeFalseCaretContainer = function (node, rootNode) {\n    return isCaretContainer(node) && hasParent(node, rootNode, isCaretNode) === false;\n  };\n\n  var hasBrBeforeAfter = function (dom, node, left) {\n    var walker = new DomTreeWalker(node, dom.getParent(node.parentNode, dom.isBlock) || dom.getRoot());\n\n    while (node = walker[left ? 'prev' : 'next']()) {\n      if (isBr(node)) {\n        return true;\n      }\n    }\n  };\n\n  var isPrevNode = function (node, name) {\n    return node.previousSibling && node.previousSibling.nodeName === name;\n  };\n\n  var hasContentEditableFalseParent = function (body, node) {\n    while (node && node !== body) {\n      if (isContentEditableFalse(node)) {\n        return true;\n      }\n\n      node = node.parentNode;\n    }\n\n    return false;\n  };\n\n  var findTextNodeRelative = function (dom, isAfterNode, collapsed, left, startNode) {\n    var lastInlineElement;\n    var body = dom.getRoot();\n    var node;\n    var nonEmptyElementsMap = dom.schema.getNonEmptyElements();\n    var parentBlockContainer = dom.getParent(startNode.parentNode, dom.isBlock) || body;\n\n    if (left && isBr(startNode) && isAfterNode && dom.isEmpty(parentBlockContainer)) {\n      return Optional.some(CaretPosition(startNode.parentNode, dom.nodeIndex(startNode)));\n    }\n\n    var walker = new DomTreeWalker(startNode, parentBlockContainer);\n\n    while (node = walker[left ? 'prev' : 'next']()) {\n      if (dom.getContentEditableParent(node) === 'false' || isCeFalseCaretContainer(node, body)) {\n        return Optional.none();\n      }\n\n      if (isText$1(node) && node.nodeValue.length > 0) {\n        if (hasParentWithName(node, body, 'A') === false) {\n          return Optional.some(CaretPosition(node, left ? node.nodeValue.length : 0));\n        }\n\n        return Optional.none();\n      }\n\n      if (dom.isBlock(node) || nonEmptyElementsMap[node.nodeName.toLowerCase()]) {\n        return Optional.none();\n      }\n\n      lastInlineElement = node;\n    }\n\n    if (collapsed && lastInlineElement) {\n      return Optional.some(CaretPosition(lastInlineElement, 0));\n    }\n\n    return Optional.none();\n  };\n\n  var normalizeEndPoint = function (dom, collapsed, start, rng) {\n    var container, offset;\n    var body = dom.getRoot();\n    var node;\n    var directionLeft,\n        normalized = false;\n    container = rng[(start ? 'start' : 'end') + 'Container'];\n    offset = rng[(start ? 'start' : 'end') + 'Offset'];\n    var isAfterNode = isElement$1(container) && offset === container.childNodes.length;\n    var nonEmptyElementsMap = dom.schema.getNonEmptyElements();\n    directionLeft = start;\n\n    if (isCaretContainer(container)) {\n      return Optional.none();\n    }\n\n    if (isElement$1(container) && offset > container.childNodes.length - 1) {\n      directionLeft = false;\n    }\n\n    if (isDocument$1(container)) {\n      container = body;\n      offset = 0;\n    }\n\n    if (container === body) {\n      if (directionLeft) {\n        node = container.childNodes[offset > 0 ? offset - 1 : 0];\n\n        if (node) {\n          if (isCaretContainer(node)) {\n            return Optional.none();\n          }\n\n          if (nonEmptyElementsMap[node.nodeName] || isTable$3(node)) {\n            return Optional.none();\n          }\n        }\n      }\n\n      if (container.hasChildNodes()) {\n        offset = Math.min(!directionLeft && offset > 0 ? offset - 1 : offset, container.childNodes.length - 1);\n        container = container.childNodes[offset];\n        offset = isText$1(container) && isAfterNode ? container.data.length : 0;\n\n        if (!collapsed && container === body.lastChild && isTable$3(container)) {\n          return Optional.none();\n        }\n\n        if (hasContentEditableFalseParent(body, container) || isCaretContainer(container)) {\n          return Optional.none();\n        }\n\n        if (container.hasChildNodes() && isTable$3(container) === false) {\n          node = container;\n          var walker = new DomTreeWalker(container, body);\n\n          do {\n            if (isContentEditableFalse(node) || isCaretContainer(node)) {\n              normalized = false;\n              break;\n            }\n\n            if (isText$1(node) && node.nodeValue.length > 0) {\n              offset = directionLeft ? 0 : node.nodeValue.length;\n              container = node;\n              normalized = true;\n              break;\n            }\n\n            if (nonEmptyElementsMap[node.nodeName.toLowerCase()] && !isTableCell$3(node)) {\n              offset = dom.nodeIndex(node);\n              container = node.parentNode;\n\n              if (!directionLeft) {\n                offset++;\n              }\n\n              normalized = true;\n              break;\n            }\n          } while (node = directionLeft ? walker.next() : walker.prev());\n        }\n      }\n    }\n\n    if (collapsed) {\n      if (isText$1(container) && offset === 0) {\n        findTextNodeRelative(dom, isAfterNode, collapsed, true, container).each(function (pos) {\n          container = pos.container();\n          offset = pos.offset();\n          normalized = true;\n        });\n      }\n\n      if (isElement$1(container)) {\n        node = container.childNodes[offset];\n\n        if (!node) {\n          node = container.childNodes[offset - 1];\n        }\n\n        if (node && isBr(node) && !isPrevNode(node, 'A') && !hasBrBeforeAfter(dom, node, false) && !hasBrBeforeAfter(dom, node, true)) {\n          findTextNodeRelative(dom, isAfterNode, collapsed, true, node).each(function (pos) {\n            container = pos.container();\n            offset = pos.offset();\n            normalized = true;\n          });\n        }\n      }\n    }\n\n    if (directionLeft && !collapsed && isText$1(container) && offset === container.nodeValue.length) {\n      findTextNodeRelative(dom, isAfterNode, collapsed, false, container).each(function (pos) {\n        container = pos.container();\n        offset = pos.offset();\n        normalized = true;\n      });\n    }\n\n    return normalized ? Optional.some(CaretPosition(container, offset)) : Optional.none();\n  };\n\n  var normalize = function (dom, rng) {\n    var collapsed = rng.collapsed,\n        normRng = rng.cloneRange();\n    var startPos = CaretPosition.fromRangeStart(rng);\n    normalizeEndPoint(dom, collapsed, true, normRng).each(function (pos) {\n      if (!collapsed || !CaretPosition.isAbove(startPos, pos)) {\n        normRng.setStart(pos.container(), pos.offset());\n      }\n    });\n\n    if (!collapsed) {\n      normalizeEndPoint(dom, collapsed, false, normRng).each(function (pos) {\n        normRng.setEnd(pos.container(), pos.offset());\n      });\n    }\n\n    if (collapsed) {\n      normRng.collapse(true);\n    }\n\n    return isEq$1(rng, normRng) ? Optional.none() : Optional.some(normRng);\n  };\n\n  var splitText = function (node, offset) {\n    return node.splitText(offset);\n  };\n\n  var split$1 = function (rng) {\n    var startContainer = rng.startContainer,\n        startOffset = rng.startOffset,\n        endContainer = rng.endContainer,\n        endOffset = rng.endOffset;\n\n    if (startContainer === endContainer && isText$1(startContainer)) {\n      if (startOffset > 0 && startOffset < startContainer.nodeValue.length) {\n        endContainer = splitText(startContainer, startOffset);\n        startContainer = endContainer.previousSibling;\n\n        if (endOffset > startOffset) {\n          endOffset = endOffset - startOffset;\n          startContainer = endContainer = splitText(endContainer, endOffset).previousSibling;\n          endOffset = endContainer.nodeValue.length;\n          startOffset = 0;\n        } else {\n          endOffset = 0;\n        }\n      }\n    } else {\n      if (isText$1(startContainer) && startOffset > 0 && startOffset < startContainer.nodeValue.length) {\n        startContainer = splitText(startContainer, startOffset);\n        startOffset = 0;\n      }\n\n      if (isText$1(endContainer) && endOffset > 0 && endOffset < endContainer.nodeValue.length) {\n        endContainer = splitText(endContainer, endOffset).previousSibling;\n        endOffset = endContainer.nodeValue.length;\n      }\n    }\n\n    return {\n      startContainer: startContainer,\n      startOffset: startOffset,\n      endContainer: endContainer,\n      endOffset: endOffset\n    };\n  };\n\n  function RangeUtils(dom) {\n    var walk = function (rng, callback) {\n      return walk$1(dom, rng, callback);\n    };\n\n    var split = split$1;\n\n    var normalize$1 = function (rng) {\n      return normalize(dom, rng).fold(never, function (normalizedRng) {\n        rng.setStart(normalizedRng.startContainer, normalizedRng.startOffset);\n        rng.setEnd(normalizedRng.endContainer, normalizedRng.endOffset);\n        return true;\n      });\n    };\n\n    return {\n      walk: walk,\n      split: split,\n      normalize: normalize$1\n    };\n  }\n\n  (function (RangeUtils) {\n    RangeUtils.compareRanges = isEq$1;\n    RangeUtils.getCaretRangeFromPoint = fromPoint$1;\n    RangeUtils.getSelectedNode = getSelectedNode;\n    RangeUtils.getNode = getNode;\n  })(RangeUtils || (RangeUtils = {}));\n\n  var RangeUtils$1 = RangeUtils;\n\n  function Dimension(name, getOffset) {\n    var set = function (element, h) {\n      if (!isNumber(h) && !h.match(/^[0-9]+$/)) {\n        throw new Error(name + '.set accepts only positive integer values. Value was ' + h);\n      }\n\n      var dom = element.dom;\n\n      if (isSupported$1(dom)) {\n        dom.style[name] = h + 'px';\n      }\n    };\n\n    var get = function (element) {\n      var r = getOffset(element);\n\n      if (r <= 0 || r === null) {\n        var css = get$4(element, name);\n        return parseFloat(css) || 0;\n      }\n\n      return r;\n    };\n\n    var getOuter = get;\n\n    var aggregate = function (element, properties) {\n      return foldl(properties, function (acc, property) {\n        var val = get$4(element, property);\n        var value = val === undefined ? 0 : parseInt(val, 10);\n        return isNaN(value) ? acc : acc + value;\n      }, 0);\n    };\n\n    var max = function (element, value, properties) {\n      var cumulativeInclusions = aggregate(element, properties);\n      var absoluteMax = value > cumulativeInclusions ? value - cumulativeInclusions : 0;\n      return absoluteMax;\n    };\n\n    return {\n      set: set,\n      get: get,\n      getOuter: getOuter,\n      aggregate: aggregate,\n      max: max\n    };\n  }\n\n  var api$1 = Dimension('height', function (element) {\n    var dom = element.dom;\n    return inBody(element) ? dom.getBoundingClientRect().height : dom.offsetHeight;\n  });\n\n  var get$8 = function (element) {\n    return api$1.get(element);\n  };\n\n  var walkUp = function (navigation, doc) {\n    var frame = navigation.view(doc);\n    return frame.fold(constant([]), function (f) {\n      var parent = navigation.owner(f);\n      var rest = walkUp(navigation, parent);\n      return [f].concat(rest);\n    });\n  };\n\n  var pathTo = function (element, navigation) {\n    var d = navigation.owner(element);\n    return walkUp(navigation, d);\n  };\n\n  var view = function (doc) {\n    var _a;\n\n    var element = doc.dom === document ? Optional.none() : Optional.from((_a = doc.dom.defaultView) === null || _a === void 0 ? void 0 : _a.frameElement);\n    return element.map(SugarElement.fromDom);\n  };\n\n  var owner$1 = function (element) {\n    return documentOrOwner(element);\n  };\n\n  var Navigation = /*#__PURE__*/Object.freeze({\n    __proto__: null,\n    view: view,\n    owner: owner$1\n  });\n\n  var find$2 = function (element) {\n    var doc = SugarElement.fromDom(document);\n    var scroll = get$1(doc);\n    var frames = pathTo(element, Navigation);\n    var offset = viewport(element);\n    var r = foldr(frames, function (b, a) {\n      var loc = viewport(a);\n      return {\n        left: b.left + loc.left,\n        top: b.top + loc.top\n      };\n    }, {\n      left: 0,\n      top: 0\n    });\n    return SugarPosition(r.left + offset.left + scroll.left, r.top + offset.top + scroll.top);\n  };\n\n  var excludeFromDescend = function (element) {\n    return name(element) === 'textarea';\n  };\n\n  var fireScrollIntoViewEvent = function (editor, data) {\n    var scrollEvent = editor.fire('ScrollIntoView', data);\n    return scrollEvent.isDefaultPrevented();\n  };\n\n  var fireAfterScrollIntoViewEvent = function (editor, data) {\n    editor.fire('AfterScrollIntoView', data);\n  };\n\n  var descend = function (element, offset) {\n    var children$1 = children(element);\n\n    if (children$1.length === 0 || excludeFromDescend(element)) {\n      return {\n        element: element,\n        offset: offset\n      };\n    } else if (offset < children$1.length && !excludeFromDescend(children$1[offset])) {\n      return {\n        element: children$1[offset],\n        offset: 0\n      };\n    } else {\n      var last = children$1[children$1.length - 1];\n\n      if (excludeFromDescend(last)) {\n        return {\n          element: element,\n          offset: offset\n        };\n      } else {\n        if (name(last) === 'img') {\n          return {\n            element: last,\n            offset: 1\n          };\n        } else if (isText(last)) {\n          return {\n            element: last,\n            offset: get$7(last).length\n          };\n        } else {\n          return {\n            element: last,\n            offset: children(last).length\n          };\n        }\n      }\n    }\n  };\n\n  var markerInfo = function (element, cleanupFun) {\n    var pos = absolute(element);\n    var height = get$8(element);\n    return {\n      element: element,\n      bottom: pos.top + height,\n      height: height,\n      pos: pos,\n      cleanup: cleanupFun\n    };\n  };\n\n  var createMarker = function (element, offset) {\n    var startPoint = descend(element, offset);\n    var span = SugarElement.fromHtml('<span data-mce-bogus=\"all\">' + ZWSP + '</span>');\n    before(startPoint.element, span);\n    return markerInfo(span, function () {\n      return remove(span);\n    });\n  };\n\n  var elementMarker = function (element) {\n    return markerInfo(SugarElement.fromDom(element), noop);\n  };\n\n  var withMarker = function (editor, f, rng, alignToTop) {\n    preserveWith(editor, function (_s, _e) {\n      return applyWithMarker(editor, f, rng, alignToTop);\n    }, rng);\n  };\n\n  var withScrollEvents = function (editor, doc, f, marker, alignToTop) {\n    var data = {\n      elm: marker.element.dom,\n      alignToTop: alignToTop\n    };\n\n    if (fireScrollIntoViewEvent(editor, data)) {\n      return;\n    }\n\n    var scrollTop = get$1(doc).top;\n    f(doc, scrollTop, marker, alignToTop);\n    fireAfterScrollIntoViewEvent(editor, data);\n  };\n\n  var applyWithMarker = function (editor, f, rng, alignToTop) {\n    var body = SugarElement.fromDom(editor.getBody());\n    var doc = SugarElement.fromDom(editor.getDoc());\n    reflow(body);\n    var marker = createMarker(SugarElement.fromDom(rng.startContainer), rng.startOffset);\n    withScrollEvents(editor, doc, f, marker, alignToTop);\n    marker.cleanup();\n  };\n\n  var withElement = function (editor, element, f, alignToTop) {\n    var doc = SugarElement.fromDom(editor.getDoc());\n    withScrollEvents(editor, doc, f, elementMarker(element), alignToTop);\n  };\n\n  var preserveWith = function (editor, f, rng) {\n    var startElement = rng.startContainer;\n    var startOffset = rng.startOffset;\n    var endElement = rng.endContainer;\n    var endOffset = rng.endOffset;\n    f(SugarElement.fromDom(startElement), SugarElement.fromDom(endElement));\n    var newRng = editor.dom.createRng();\n    newRng.setStart(startElement, startOffset);\n    newRng.setEnd(endElement, endOffset);\n    editor.selection.setRng(rng);\n  };\n\n  var scrollToMarker = function (marker, viewHeight, alignToTop, doc) {\n    var pos = marker.pos;\n\n    if (alignToTop) {\n      to(pos.left, pos.top, doc);\n    } else {\n      var y = pos.top - viewHeight + marker.height;\n      to(pos.left, y, doc);\n    }\n  };\n\n  var intoWindowIfNeeded = function (doc, scrollTop, viewHeight, marker, alignToTop) {\n    var viewportBottom = viewHeight + scrollTop;\n    var markerTop = marker.pos.top;\n    var markerBottom = marker.bottom;\n    var largerThanViewport = markerBottom - markerTop >= viewHeight;\n\n    if (markerTop < scrollTop) {\n      scrollToMarker(marker, viewHeight, alignToTop !== false, doc);\n    } else if (markerTop > viewportBottom) {\n      var align = largerThanViewport ? alignToTop !== false : alignToTop === true;\n      scrollToMarker(marker, viewHeight, align, doc);\n    } else if (markerBottom > viewportBottom && !largerThanViewport) {\n      scrollToMarker(marker, viewHeight, alignToTop === true, doc);\n    }\n  };\n\n  var intoWindow = function (doc, scrollTop, marker, alignToTop) {\n    var viewHeight = doc.dom.defaultView.innerHeight;\n    intoWindowIfNeeded(doc, scrollTop, viewHeight, marker, alignToTop);\n  };\n\n  var intoFrame = function (doc, scrollTop, marker, alignToTop) {\n    var frameViewHeight = doc.dom.defaultView.innerHeight;\n    intoWindowIfNeeded(doc, scrollTop, frameViewHeight, marker, alignToTop);\n    var op = find$2(marker.element);\n    var viewportBounds = getBounds(window);\n\n    if (op.top < viewportBounds.y) {\n      intoView(marker.element, alignToTop !== false);\n    } else if (op.top > viewportBounds.bottom) {\n      intoView(marker.element, alignToTop === true);\n    }\n  };\n\n  var rangeIntoWindow = function (editor, rng, alignToTop) {\n    return withMarker(editor, intoWindow, rng, alignToTop);\n  };\n\n  var elementIntoWindow = function (editor, element, alignToTop) {\n    return withElement(editor, element, intoWindow, alignToTop);\n  };\n\n  var rangeIntoFrame = function (editor, rng, alignToTop) {\n    return withMarker(editor, intoFrame, rng, alignToTop);\n  };\n\n  var elementIntoFrame = function (editor, element, alignToTop) {\n    return withElement(editor, element, intoFrame, alignToTop);\n  };\n\n  var scrollElementIntoView = function (editor, element, alignToTop) {\n    var scroller = editor.inline ? elementIntoWindow : elementIntoFrame;\n    scroller(editor, element, alignToTop);\n  };\n\n  var scrollRangeIntoView = function (editor, rng, alignToTop) {\n    var scroller = editor.inline ? rangeIntoWindow : rangeIntoFrame;\n    scroller(editor, rng, alignToTop);\n  };\n\n  var getDocument = function () {\n    return SugarElement.fromDom(document);\n  };\n\n  var focus = function (element) {\n    return element.dom.focus();\n  };\n\n  var hasFocus = function (element) {\n    var root = getRootNode(element).dom;\n    return element.dom === root.activeElement;\n  };\n\n  var active = function (root) {\n    if (root === void 0) {\n      root = getDocument();\n    }\n\n    return Optional.from(root.dom.activeElement).map(SugarElement.fromDom);\n  };\n\n  var search = function (element) {\n    return active(getRootNode(element)).filter(function (e) {\n      return element.dom.contains(e.dom);\n    });\n  };\n\n  var create$4 = function (start, soffset, finish, foffset) {\n    return {\n      start: start,\n      soffset: soffset,\n      finish: finish,\n      foffset: foffset\n    };\n  };\n\n  var SimRange = {\n    create: create$4\n  };\n  var adt = Adt.generate([{\n    before: ['element']\n  }, {\n    on: ['element', 'offset']\n  }, {\n    after: ['element']\n  }]);\n\n  var cata = function (subject, onBefore, onOn, onAfter) {\n    return subject.fold(onBefore, onOn, onAfter);\n  };\n\n  var getStart = function (situ) {\n    return situ.fold(identity, identity, identity);\n  };\n\n  var before$3 = adt.before;\n  var on = adt.on;\n  var after$2 = adt.after;\n  var Situ = {\n    before: before$3,\n    on: on,\n    after: after$2,\n    cata: cata,\n    getStart: getStart\n  };\n  var adt$1 = Adt.generate([{\n    domRange: ['rng']\n  }, {\n    relative: ['startSitu', 'finishSitu']\n  }, {\n    exact: ['start', 'soffset', 'finish', 'foffset']\n  }]);\n\n  var exactFromRange = function (simRange) {\n    return adt$1.exact(simRange.start, simRange.soffset, simRange.finish, simRange.foffset);\n  };\n\n  var getStart$1 = function (selection) {\n    return selection.match({\n      domRange: function (rng) {\n        return SugarElement.fromDom(rng.startContainer);\n      },\n      relative: function (startSitu, _finishSitu) {\n        return Situ.getStart(startSitu);\n      },\n      exact: function (start, _soffset, _finish, _foffset) {\n        return start;\n      }\n    });\n  };\n\n  var domRange = adt$1.domRange;\n  var relative = adt$1.relative;\n  var exact = adt$1.exact;\n\n  var getWin = function (selection) {\n    var start = getStart$1(selection);\n    return defaultView(start);\n  };\n\n  var range = SimRange.create;\n  var SimSelection = {\n    domRange: domRange,\n    relative: relative,\n    exact: exact,\n    exactFromRange: exactFromRange,\n    getWin: getWin,\n    range: range\n  };\n  var browser$3 = detect$3().browser;\n\n  var clamp = function (offset, element) {\n    var max = isText(element) ? get$7(element).length : children(element).length + 1;\n\n    if (offset > max) {\n      return max;\n    } else if (offset < 0) {\n      return 0;\n    }\n\n    return offset;\n  };\n\n  var normalizeRng = function (rng) {\n    return SimSelection.range(rng.start, clamp(rng.soffset, rng.start), rng.finish, clamp(rng.foffset, rng.finish));\n  };\n\n  var isOrContains = function (root, elm) {\n    return !isRestrictedNode(elm.dom) && (contains$2(root, elm) || eq$2(root, elm));\n  };\n\n  var isRngInRoot = function (root) {\n    return function (rng) {\n      return isOrContains(root, rng.start) && isOrContains(root, rng.finish);\n    };\n  };\n\n  var shouldStore = function (editor) {\n    return editor.inline === true || browser$3.isIE();\n  };\n\n  var nativeRangeToSelectionRange = function (r) {\n    return SimSelection.range(SugarElement.fromDom(r.startContainer), r.startOffset, SugarElement.fromDom(r.endContainer), r.endOffset);\n  };\n\n  var readRange = function (win) {\n    var selection = win.getSelection();\n    var rng = !selection || selection.rangeCount === 0 ? Optional.none() : Optional.from(selection.getRangeAt(0));\n    return rng.map(nativeRangeToSelectionRange);\n  };\n\n  var getBookmark$2 = function (root) {\n    var win = defaultView(root);\n    return readRange(win.dom).filter(isRngInRoot(root));\n  };\n\n  var validate = function (root, bookmark) {\n    return Optional.from(bookmark).filter(isRngInRoot(root)).map(normalizeRng);\n  };\n\n  var bookmarkToNativeRng = function (bookmark) {\n    var rng = document.createRange();\n\n    try {\n      rng.setStart(bookmark.start.dom, bookmark.soffset);\n      rng.setEnd(bookmark.finish.dom, bookmark.foffset);\n      return Optional.some(rng);\n    } catch (_) {\n      return Optional.none();\n    }\n  };\n\n  var store = function (editor) {\n    var newBookmark = shouldStore(editor) ? getBookmark$2(SugarElement.fromDom(editor.getBody())) : Optional.none();\n    editor.bookmark = newBookmark.isSome() ? newBookmark : editor.bookmark;\n  };\n\n  var storeNative = function (editor, rng) {\n    var root = SugarElement.fromDom(editor.getBody());\n    var range = shouldStore(editor) ? Optional.from(rng) : Optional.none();\n    var newBookmark = range.map(nativeRangeToSelectionRange).filter(isRngInRoot(root));\n    editor.bookmark = newBookmark.isSome() ? newBookmark : editor.bookmark;\n  };\n\n  var getRng = function (editor) {\n    var bookmark = editor.bookmark ? editor.bookmark : Optional.none();\n    return bookmark.bind(function (x) {\n      return validate(SugarElement.fromDom(editor.getBody()), x);\n    }).bind(bookmarkToNativeRng);\n  };\n\n  var restore = function (editor) {\n    getRng(editor).each(function (rng) {\n      return editor.selection.setRng(rng);\n    });\n  };\n\n  var isEditorUIElement = function (elm) {\n    var className = elm.className.toString();\n    return className.indexOf('tox-') !== -1 || className.indexOf('mce-') !== -1;\n  };\n\n  var FocusManager = {\n    isEditorUIElement: isEditorUIElement\n  };\n\n  var isManualNodeChange = function (e) {\n    return e.type === 'nodechange' && e.selectionChange;\n  };\n\n  var registerPageMouseUp = function (editor, throttledStore) {\n    var mouseUpPage = function () {\n      throttledStore.throttle();\n    };\n\n    DOMUtils$1.DOM.bind(document, 'mouseup', mouseUpPage);\n    editor.on('remove', function () {\n      DOMUtils$1.DOM.unbind(document, 'mouseup', mouseUpPage);\n    });\n  };\n\n  var registerFocusOut = function (editor) {\n    editor.on('focusout', function () {\n      store(editor);\n    });\n  };\n\n  var registerMouseUp = function (editor, throttledStore) {\n    editor.on('mouseup touchend', function (_e) {\n      throttledStore.throttle();\n    });\n  };\n\n  var registerEditorEvents = function (editor, throttledStore) {\n    var browser = detect$3().browser;\n\n    if (browser.isIE()) {\n      registerFocusOut(editor);\n    } else {\n      registerMouseUp(editor, throttledStore);\n    }\n\n    editor.on('keyup NodeChange', function (e) {\n      if (!isManualNodeChange(e)) {\n        store(editor);\n      }\n    });\n  };\n\n  var register = function (editor) {\n    var throttledStore = first(function () {\n      store(editor);\n    }, 0);\n    editor.on('init', function () {\n      if (editor.inline) {\n        registerPageMouseUp(editor, throttledStore);\n      }\n\n      registerEditorEvents(editor, throttledStore);\n    });\n    editor.on('remove', function () {\n      throttledStore.cancel();\n    });\n  };\n\n  var documentFocusInHandler;\n  var DOM$2 = DOMUtils$1.DOM;\n\n  var isEditorUIElement$1 = function (elm) {\n    return FocusManager.isEditorUIElement(elm);\n  };\n\n  var isEditorContentAreaElement = function (elm) {\n    var classList = elm.classList;\n\n    if (classList !== undefined) {\n      return classList.contains('tox-edit-area') || classList.contains('tox-edit-area__iframe') || classList.contains('mce-content-body');\n    } else {\n      return false;\n    }\n  };\n\n  var isUIElement = function (editor, elm) {\n    var customSelector = getCustomUiSelector(editor);\n    var parent = DOM$2.getParent(elm, function (elm) {\n      return isEditorUIElement$1(elm) || (customSelector ? editor.dom.is(elm, customSelector) : false);\n    });\n    return parent !== null;\n  };\n\n  var getActiveElement = function (editor) {\n    try {\n      var root = getRootNode(SugarElement.fromDom(editor.getElement()));\n      return active(root).fold(function () {\n        return document.body;\n      }, function (x) {\n        return x.dom;\n      });\n    } catch (ex) {\n      return document.body;\n    }\n  };\n\n  var registerEvents = function (editorManager, e) {\n    var editor = e.editor;\n    register(editor);\n    editor.on('focusin', function () {\n      var self = this;\n      var focusedEditor = editorManager.focusedEditor;\n\n      if (focusedEditor !== self) {\n        if (focusedEditor) {\n          focusedEditor.fire('blur', {\n            focusedEditor: self\n          });\n        }\n\n        editorManager.setActive(self);\n        editorManager.focusedEditor = self;\n        self.fire('focus', {\n          blurredEditor: focusedEditor\n        });\n        self.focus(true);\n      }\n    });\n    editor.on('focusout', function () {\n      var self = this;\n      Delay.setEditorTimeout(self, function () {\n        var focusedEditor = editorManager.focusedEditor;\n\n        if (!isUIElement(self, getActiveElement(self)) && focusedEditor === self) {\n          self.fire('blur', {\n            focusedEditor: null\n          });\n          editorManager.focusedEditor = null;\n        }\n      });\n    });\n\n    if (!documentFocusInHandler) {\n      documentFocusInHandler = function (e) {\n        var activeEditor = editorManager.activeEditor;\n\n        if (activeEditor) {\n          getOriginalEventTarget(e).each(function (target) {\n            if (target.ownerDocument === document) {\n              if (target !== document.body && !isUIElement(activeEditor, target) && editorManager.focusedEditor === activeEditor) {\n                activeEditor.fire('blur', {\n                  focusedEditor: null\n                });\n                editorManager.focusedEditor = null;\n              }\n            }\n          });\n        }\n      };\n\n      DOM$2.bind(document, 'focusin', documentFocusInHandler);\n    }\n  };\n\n  var unregisterDocumentEvents = function (editorManager, e) {\n    if (editorManager.focusedEditor === e.editor) {\n      editorManager.focusedEditor = null;\n    }\n\n    if (!editorManager.activeEditor) {\n      DOM$2.unbind(document, 'focusin', documentFocusInHandler);\n      documentFocusInHandler = null;\n    }\n  };\n\n  var setup$2 = function (editorManager) {\n    editorManager.on('AddEditor', curry(registerEvents, editorManager));\n    editorManager.on('RemoveEditor', curry(unregisterDocumentEvents, editorManager));\n  };\n\n  var getContentEditableHost = function (editor, node) {\n    return editor.dom.getParent(node, function (node) {\n      return editor.dom.getContentEditable(node) === 'true';\n    });\n  };\n\n  var getCollapsedNode = function (rng) {\n    return rng.collapsed ? Optional.from(getNode(rng.startContainer, rng.startOffset)).map(SugarElement.fromDom) : Optional.none();\n  };\n\n  var getFocusInElement = function (root, rng) {\n    return getCollapsedNode(rng).bind(function (node) {\n      if (isTableSection(node)) {\n        return Optional.some(node);\n      } else if (contains$2(root, node) === false) {\n        return Optional.some(root);\n      } else {\n        return Optional.none();\n      }\n    });\n  };\n\n  var normalizeSelection = function (editor, rng) {\n    getFocusInElement(SugarElement.fromDom(editor.getBody()), rng).bind(function (elm) {\n      return firstPositionIn(elm.dom);\n    }).fold(function () {\n      editor.selection.normalize();\n      return;\n    }, function (caretPos) {\n      return editor.selection.setRng(caretPos.toRange());\n    });\n  };\n\n  var focusBody = function (body) {\n    if (body.setActive) {\n      try {\n        body.setActive();\n      } catch (ex) {\n        body.focus();\n      }\n    } else {\n      body.focus();\n    }\n  };\n\n  var hasElementFocus = function (elm) {\n    return hasFocus(elm) || search(elm).isSome();\n  };\n\n  var hasIframeFocus = function (editor) {\n    return editor.iframeElement && hasFocus(SugarElement.fromDom(editor.iframeElement));\n  };\n\n  var hasInlineFocus = function (editor) {\n    var rawBody = editor.getBody();\n    return rawBody && hasElementFocus(SugarElement.fromDom(rawBody));\n  };\n\n  var hasUiFocus = function (editor) {\n    return active().filter(function (elem) {\n      return !isEditorContentAreaElement(elem.dom) && isUIElement(editor, elem.dom);\n    }).isSome();\n  };\n\n  var hasFocus$1 = function (editor) {\n    return editor.inline ? hasInlineFocus(editor) : hasIframeFocus(editor);\n  };\n\n  var hasEditorOrUiFocus = function (editor) {\n    return hasFocus$1(editor) || hasUiFocus(editor);\n  };\n\n  var focusEditor = function (editor) {\n    var selection = editor.selection;\n    var body = editor.getBody();\n    var rng = selection.getRng();\n    editor.quirks.refreshContentEditable();\n\n    if (editor.bookmark !== undefined && hasFocus$1(editor) === false) {\n      getRng(editor).each(function (bookmarkRng) {\n        editor.selection.setRng(bookmarkRng);\n        rng = bookmarkRng;\n      });\n    }\n\n    var contentEditableHost = getContentEditableHost(editor, selection.getNode());\n\n    if (editor.$.contains(body, contentEditableHost)) {\n      focusBody(contentEditableHost);\n      normalizeSelection(editor, rng);\n      activateEditor(editor);\n      return;\n    }\n\n    if (!editor.inline) {\n      if (!Env.opera) {\n        focusBody(body);\n      }\n\n      editor.getWin().focus();\n    }\n\n    if (Env.gecko || editor.inline) {\n      focusBody(body);\n      normalizeSelection(editor, rng);\n    }\n\n    activateEditor(editor);\n  };\n\n  var activateEditor = function (editor) {\n    return editor.editorManager.setActive(editor);\n  };\n\n  var focus$1 = function (editor, skipFocus) {\n    if (editor.removed) {\n      return;\n    }\n\n    skipFocus ? activateEditor(editor) : focusEditor(editor);\n  };\n\n  var getEndpointElement = function (root, rng, start, real, resolve) {\n    var container = start ? rng.startContainer : rng.endContainer;\n    var offset = start ? rng.startOffset : rng.endOffset;\n    return Optional.from(container).map(SugarElement.fromDom).map(function (elm) {\n      return !real || !rng.collapsed ? child(elm, resolve(elm, offset)).getOr(elm) : elm;\n    }).bind(function (elm) {\n      return isElement(elm) ? Optional.some(elm) : parent(elm).filter(isElement);\n    }).map(function (elm) {\n      return elm.dom;\n    }).getOr(root);\n  };\n\n  var getStart$2 = function (root, rng, real) {\n    return getEndpointElement(root, rng, true, real, function (elm, offset) {\n      return Math.min(childNodesCount(elm), offset);\n    });\n  };\n\n  var getEnd = function (root, rng, real) {\n    return getEndpointElement(root, rng, false, real, function (elm, offset) {\n      return offset > 0 ? offset - 1 : offset;\n    });\n  };\n\n  var skipEmptyTextNodes = function (node, forwards) {\n    var orig = node;\n\n    while (node && isText$1(node) && node.length === 0) {\n      node = forwards ? node.nextSibling : node.previousSibling;\n    }\n\n    return node || orig;\n  };\n\n  var getNode$1 = function (root, rng) {\n    var elm, startContainer, endContainer;\n\n    if (!rng) {\n      return root;\n    }\n\n    startContainer = rng.startContainer;\n    endContainer = rng.endContainer;\n    var startOffset = rng.startOffset;\n    var endOffset = rng.endOffset;\n    elm = rng.commonAncestorContainer;\n\n    if (!rng.collapsed) {\n      if (startContainer === endContainer) {\n        if (endOffset - startOffset < 2) {\n          if (startContainer.hasChildNodes()) {\n            elm = startContainer.childNodes[startOffset];\n          }\n        }\n      }\n\n      if (startContainer.nodeType === 3 && endContainer.nodeType === 3) {\n        if (startContainer.length === startOffset) {\n          startContainer = skipEmptyTextNodes(startContainer.nextSibling, true);\n        } else {\n          startContainer = startContainer.parentNode;\n        }\n\n        if (endOffset === 0) {\n          endContainer = skipEmptyTextNodes(endContainer.previousSibling, false);\n        } else {\n          endContainer = endContainer.parentNode;\n        }\n\n        if (startContainer && startContainer === endContainer) {\n          return startContainer;\n        }\n      }\n    }\n\n    if (elm && elm.nodeType === 3) {\n      return elm.parentNode;\n    }\n\n    return elm;\n  };\n\n  var getSelectedBlocks = function (dom, rng, startElm, endElm) {\n    var node;\n    var selectedBlocks = [];\n    var root = dom.getRoot();\n    startElm = dom.getParent(startElm || getStart$2(root, rng, rng.collapsed), dom.isBlock);\n    endElm = dom.getParent(endElm || getEnd(root, rng, rng.collapsed), dom.isBlock);\n\n    if (startElm && startElm !== root) {\n      selectedBlocks.push(startElm);\n    }\n\n    if (startElm && endElm && startElm !== endElm) {\n      node = startElm;\n      var walker = new DomTreeWalker(startElm, root);\n\n      while ((node = walker.next()) && node !== endElm) {\n        if (dom.isBlock(node)) {\n          selectedBlocks.push(node);\n        }\n      }\n    }\n\n    if (endElm && startElm !== endElm && endElm !== root) {\n      selectedBlocks.push(endElm);\n    }\n\n    return selectedBlocks;\n  };\n\n  var select$1 = function (dom, node, content) {\n    return Optional.from(node).map(function (node) {\n      var idx = dom.nodeIndex(node);\n      var rng = dom.createRng();\n      rng.setStart(node.parentNode, idx);\n      rng.setEnd(node.parentNode, idx + 1);\n\n      if (content) {\n        moveEndPoint$1(dom, rng, node, true);\n        moveEndPoint$1(dom, rng, node, false);\n      }\n\n      return rng;\n    });\n  };\n\n  var processRanges = function (editor, ranges) {\n    return map(ranges, function (range) {\n      var evt = editor.fire('GetSelectionRange', {\n        range: range\n      });\n      return evt.range !== range ? evt.range : range;\n    });\n  };\n\n  var typeLookup = {\n    '#text': 3,\n    '#comment': 8,\n    '#cdata': 4,\n    '#pi': 7,\n    '#doctype': 10,\n    '#document-fragment': 11\n  };\n\n  var walk$2 = function (node, root, prev) {\n    var startName = prev ? 'lastChild' : 'firstChild';\n    var siblingName = prev ? 'prev' : 'next';\n\n    if (node[startName]) {\n      return node[startName];\n    }\n\n    if (node !== root) {\n      var sibling = node[siblingName];\n\n      if (sibling) {\n        return sibling;\n      }\n\n      for (var parent_1 = node.parent; parent_1 && parent_1 !== root; parent_1 = parent_1.parent) {\n        sibling = parent_1[siblingName];\n\n        if (sibling) {\n          return sibling;\n        }\n      }\n    }\n  };\n\n  var isEmptyTextNode$1 = function (node) {\n    if (!isWhitespaceText(node.value)) {\n      return false;\n    }\n\n    var parentNode = node.parent;\n\n    if (parentNode && (parentNode.name !== 'span' || parentNode.attr('style')) && /^[ ]+$/.test(node.value)) {\n      return false;\n    }\n\n    return true;\n  };\n\n  var isNonEmptyElement = function (node) {\n    var isNamedAnchor = node.name === 'a' && !node.attr('href') && node.attr('id');\n    return node.attr('name') || node.attr('id') && !node.firstChild || node.attr('data-mce-bookmark') || isNamedAnchor;\n  };\n\n  var AstNode = function () {\n    function AstNode(name, type) {\n      this.name = name;\n      this.type = type;\n\n      if (type === 1) {\n        this.attributes = [];\n        this.attributes.map = {};\n      }\n    }\n\n    AstNode.create = function (name, attrs) {\n      var node = new AstNode(name, typeLookup[name] || 1);\n\n      if (attrs) {\n        each$1(attrs, function (value, attrName) {\n          node.attr(attrName, value);\n        });\n      }\n\n      return node;\n    };\n\n    AstNode.prototype.replace = function (node) {\n      var self = this;\n\n      if (node.parent) {\n        node.remove();\n      }\n\n      self.insert(node, self);\n      self.remove();\n      return self;\n    };\n\n    AstNode.prototype.attr = function (name, value) {\n      var self = this;\n      var attrs;\n\n      if (typeof name !== 'string') {\n        if (name !== undefined && name !== null) {\n          each$1(name, function (value, key) {\n            self.attr(key, value);\n          });\n        }\n\n        return self;\n      }\n\n      if (attrs = self.attributes) {\n        if (value !== undefined) {\n          if (value === null) {\n            if (name in attrs.map) {\n              delete attrs.map[name];\n              var i = attrs.length;\n\n              while (i--) {\n                if (attrs[i].name === name) {\n                  attrs.splice(i, 1);\n                  return self;\n                }\n              }\n            }\n\n            return self;\n          }\n\n          if (name in attrs.map) {\n            var i = attrs.length;\n\n            while (i--) {\n              if (attrs[i].name === name) {\n                attrs[i].value = value;\n                break;\n              }\n            }\n          } else {\n            attrs.push({\n              name: name,\n              value: value\n            });\n          }\n\n          attrs.map[name] = value;\n          return self;\n        }\n\n        return attrs.map[name];\n      }\n    };\n\n    AstNode.prototype.clone = function () {\n      var self = this;\n      var clone = new AstNode(self.name, self.type);\n      var selfAttrs;\n\n      if (selfAttrs = self.attributes) {\n        var cloneAttrs = [];\n        cloneAttrs.map = {};\n\n        for (var i = 0, l = selfAttrs.length; i < l; i++) {\n          var selfAttr = selfAttrs[i];\n\n          if (selfAttr.name !== 'id') {\n            cloneAttrs[cloneAttrs.length] = {\n              name: selfAttr.name,\n              value: selfAttr.value\n            };\n            cloneAttrs.map[selfAttr.name] = selfAttr.value;\n          }\n        }\n\n        clone.attributes = cloneAttrs;\n      }\n\n      clone.value = self.value;\n      clone.shortEnded = self.shortEnded;\n      return clone;\n    };\n\n    AstNode.prototype.wrap = function (wrapper) {\n      var self = this;\n      self.parent.insert(wrapper, self);\n      wrapper.append(self);\n      return self;\n    };\n\n    AstNode.prototype.unwrap = function () {\n      var self = this;\n\n      for (var node = self.firstChild; node;) {\n        var next = node.next;\n        self.insert(node, self, true);\n        node = next;\n      }\n\n      self.remove();\n    };\n\n    AstNode.prototype.remove = function () {\n      var self = this,\n          parent = self.parent,\n          next = self.next,\n          prev = self.prev;\n\n      if (parent) {\n        if (parent.firstChild === self) {\n          parent.firstChild = next;\n\n          if (next) {\n            next.prev = null;\n          }\n        } else {\n          prev.next = next;\n        }\n\n        if (parent.lastChild === self) {\n          parent.lastChild = prev;\n\n          if (prev) {\n            prev.next = null;\n          }\n        } else {\n          next.prev = prev;\n        }\n\n        self.parent = self.next = self.prev = null;\n      }\n\n      return self;\n    };\n\n    AstNode.prototype.append = function (node) {\n      var self = this;\n\n      if (node.parent) {\n        node.remove();\n      }\n\n      var last = self.lastChild;\n\n      if (last) {\n        last.next = node;\n        node.prev = last;\n        self.lastChild = node;\n      } else {\n        self.lastChild = self.firstChild = node;\n      }\n\n      node.parent = self;\n      return node;\n    };\n\n    AstNode.prototype.insert = function (node, refNode, before) {\n      if (node.parent) {\n        node.remove();\n      }\n\n      var parent = refNode.parent || this;\n\n      if (before) {\n        if (refNode === parent.firstChild) {\n          parent.firstChild = node;\n        } else {\n          refNode.prev.next = node;\n        }\n\n        node.prev = refNode.prev;\n        node.next = refNode;\n        refNode.prev = node;\n      } else {\n        if (refNode === parent.lastChild) {\n          parent.lastChild = node;\n        } else {\n          refNode.next.prev = node;\n        }\n\n        node.next = refNode.next;\n        node.prev = refNode;\n        refNode.next = node;\n      }\n\n      node.parent = parent;\n      return node;\n    };\n\n    AstNode.prototype.getAll = function (name) {\n      var self = this;\n      var collection = [];\n\n      for (var node = self.firstChild; node; node = walk$2(node, self)) {\n        if (node.name === name) {\n          collection.push(node);\n        }\n      }\n\n      return collection;\n    };\n\n    AstNode.prototype.empty = function () {\n      var self = this;\n\n      if (self.firstChild) {\n        var nodes = [];\n\n        for (var node = self.firstChild; node; node = walk$2(node, self)) {\n          nodes.push(node);\n        }\n\n        var i = nodes.length;\n\n        while (i--) {\n          var node = nodes[i];\n          node.parent = node.firstChild = node.lastChild = node.next = node.prev = null;\n        }\n      }\n\n      self.firstChild = self.lastChild = null;\n      return self;\n    };\n\n    AstNode.prototype.isEmpty = function (elements, whitespace, predicate) {\n      if (whitespace === void 0) {\n        whitespace = {};\n      }\n\n      var self = this;\n      var node = self.firstChild;\n\n      if (isNonEmptyElement(self)) {\n        return false;\n      }\n\n      if (node) {\n        do {\n          if (node.type === 1) {\n            if (node.attr('data-mce-bogus')) {\n              continue;\n            }\n\n            if (elements[node.name]) {\n              return false;\n            }\n\n            if (isNonEmptyElement(node)) {\n              return false;\n            }\n          }\n\n          if (node.type === 8) {\n            return false;\n          }\n\n          if (node.type === 3 && !isEmptyTextNode$1(node)) {\n            return false;\n          }\n\n          if (node.type === 3 && node.parent && whitespace[node.parent.name] && isWhitespaceText(node.value)) {\n            return false;\n          }\n\n          if (predicate && predicate(node)) {\n            return false;\n          }\n        } while (node = walk$2(node, self));\n      }\n\n      return true;\n    };\n\n    AstNode.prototype.walk = function (prev) {\n      return walk$2(this, null, prev);\n    };\n\n    return AstNode;\n  }();\n\n  var makeMap$3 = Tools.makeMap;\n\n  var Writer = function (settings) {\n    var html = [];\n    settings = settings || {};\n    var indent = settings.indent;\n    var indentBefore = makeMap$3(settings.indent_before || '');\n    var indentAfter = makeMap$3(settings.indent_after || '');\n    var encode = Entities.getEncodeFunc(settings.entity_encoding || 'raw', settings.entities);\n    var htmlOutput = settings.element_format === 'html';\n    return {\n      start: function (name, attrs, empty) {\n        var i, l, attr, value;\n\n        if (indent && indentBefore[name] && html.length > 0) {\n          value = html[html.length - 1];\n\n          if (value.length > 0 && value !== '\\n') {\n            html.push('\\n');\n          }\n        }\n\n        html.push('<', name);\n\n        if (attrs) {\n          for (i = 0, l = attrs.length; i < l; i++) {\n            attr = attrs[i];\n            html.push(' ', attr.name, '=\"', encode(attr.value, true), '\"');\n          }\n        }\n\n        if (!empty || htmlOutput) {\n          html[html.length] = '>';\n        } else {\n          html[html.length] = ' />';\n        }\n\n        if (empty && indent && indentAfter[name] && html.length > 0) {\n          value = html[html.length - 1];\n\n          if (value.length > 0 && value !== '\\n') {\n            html.push('\\n');\n          }\n        }\n      },\n      end: function (name) {\n        var value;\n        html.push('</', name, '>');\n\n        if (indent && indentAfter[name] && html.length > 0) {\n          value = html[html.length - 1];\n\n          if (value.length > 0 && value !== '\\n') {\n            html.push('\\n');\n          }\n        }\n      },\n      text: function (text, raw) {\n        if (text.length > 0) {\n          html[html.length] = raw ? text : encode(text);\n        }\n      },\n      cdata: function (text) {\n        html.push('<![CDATA[', text, ']]>');\n      },\n      comment: function (text) {\n        html.push('<!--', text, '-->');\n      },\n      pi: function (name, text) {\n        if (text) {\n          html.push('<?', name, ' ', encode(text), '?>');\n        } else {\n          html.push('<?', name, '?>');\n        }\n\n        if (indent) {\n          html.push('\\n');\n        }\n      },\n      doctype: function (text) {\n        html.push('<!DOCTYPE', text, '>', indent ? '\\n' : '');\n      },\n      reset: function () {\n        html.length = 0;\n      },\n      getContent: function () {\n        return html.join('').replace(/\\n$/, '');\n      }\n    };\n  };\n\n  var HtmlSerializer = function (settings, schema) {\n    if (schema === void 0) {\n      schema = Schema();\n    }\n\n    var writer = Writer(settings);\n    settings = settings || {};\n    settings.validate = 'validate' in settings ? settings.validate : true;\n\n    var serialize = function (node) {\n      var validate = settings.validate;\n      var handlers = {\n        3: function (node) {\n          writer.text(node.value, node.raw);\n        },\n        8: function (node) {\n          writer.comment(node.value);\n        },\n        7: function (node) {\n          writer.pi(node.name, node.value);\n        },\n        10: function (node) {\n          writer.doctype(node.value);\n        },\n        4: function (node) {\n          writer.cdata(node.value);\n        },\n        11: function (node) {\n          if (node = node.firstChild) {\n            do {\n              walk(node);\n            } while (node = node.next);\n          }\n        }\n      };\n      writer.reset();\n\n      var walk = function (node) {\n        var handler = handlers[node.type];\n        var name, isEmpty, attrs, attrName, attrValue, sortedAttrs, i, l, elementRule;\n\n        if (!handler) {\n          name = node.name;\n          isEmpty = node.shortEnded;\n          attrs = node.attributes;\n\n          if (validate && attrs && attrs.length > 1) {\n            sortedAttrs = [];\n            sortedAttrs.map = {};\n            elementRule = schema.getElementRule(node.name);\n\n            if (elementRule) {\n              for (i = 0, l = elementRule.attributesOrder.length; i < l; i++) {\n                attrName = elementRule.attributesOrder[i];\n\n                if (attrName in attrs.map) {\n                  attrValue = attrs.map[attrName];\n                  sortedAttrs.map[attrName] = attrValue;\n                  sortedAttrs.push({\n                    name: attrName,\n                    value: attrValue\n                  });\n                }\n              }\n\n              for (i = 0, l = attrs.length; i < l; i++) {\n                attrName = attrs[i].name;\n\n                if (!(attrName in sortedAttrs.map)) {\n                  attrValue = attrs.map[attrName];\n                  sortedAttrs.map[attrName] = attrValue;\n                  sortedAttrs.push({\n                    name: attrName,\n                    value: attrValue\n                  });\n                }\n              }\n\n              attrs = sortedAttrs;\n            }\n          }\n\n          writer.start(node.name, attrs, isEmpty);\n\n          if (!isEmpty) {\n            if (node = node.firstChild) {\n              do {\n                walk(node);\n              } while (node = node.next);\n            }\n\n            writer.end(name);\n          }\n        } else {\n          handler(node);\n        }\n      };\n\n      if (node.type === 1 && !settings.inner) {\n        walk(node);\n      } else {\n        handlers[11](node);\n      }\n\n      return writer.getContent();\n    };\n\n    return {\n      serialize: serialize\n    };\n  };\n\n  var extractBase64DataUris = function (html) {\n    var dataImageUri = /data:[^;]+;base64,([a-z0-9\\+\\/=]+)/gi;\n    var chunks = [];\n    var uris = {};\n    var prefix = generate$1('img');\n    var matches;\n    var index = 0;\n    var count = 0;\n\n    while (matches = dataImageUri.exec(html)) {\n      var uri = matches[0];\n      var imageId = prefix + '_' + count++;\n      uris[imageId] = uri;\n\n      if (index < matches.index) {\n        chunks.push(html.substr(index, matches.index - index));\n      }\n\n      chunks.push(imageId);\n      index = matches.index + uri.length;\n    }\n\n    if (index === 0) {\n      return {\n        prefix: prefix,\n        uris: uris,\n        html: html\n      };\n    } else {\n      if (index < html.length) {\n        chunks.push(html.substr(index));\n      }\n\n      return {\n        prefix: prefix,\n        uris: uris,\n        html: chunks.join('')\n      };\n    }\n  };\n\n  var restoreDataUris = function (html, result) {\n    return html.replace(new RegExp(result.prefix + '_[0-9]+', 'g'), function (imageId) {\n      return get(result.uris, imageId).getOr(imageId);\n    });\n  };\n\n  var parseDataUri = function (uri) {\n    var matches = /data:([^;]+);base64,([a-z0-9\\+\\/=]+)/i.exec(uri);\n\n    if (matches) {\n      return Optional.some({\n        type: matches[1],\n        data: decodeURIComponent(matches[2])\n      });\n    } else {\n      return Optional.none();\n    }\n  };\n\n  var isValidPrefixAttrName = function (name) {\n    return name.indexOf('data-') === 0 || name.indexOf('aria-') === 0;\n  };\n\n  var isInvalidUri = function (settings, uri) {\n    if (settings.allow_html_data_urls) {\n      return false;\n    } else if (/^data:image\\//i.test(uri)) {\n      return settings.allow_svg_data_urls === false && /^data:image\\/svg\\+xml/i.test(uri);\n    } else {\n      return /^data:/i.test(uri);\n    }\n  };\n\n  var findEndTagIndex = function (schema, html, startIndex) {\n    var count = 1,\n        index,\n        matches;\n    var shortEndedElements = schema.getShortEndedElements();\n    var tokenRegExp = /<([!?\\/])?([A-Za-z0-9\\-_\\:\\.]+)((?:\\s+[^\"\\'>]+(?:(?:\"[^\"]*\")|(?:\\'[^\\']*\\')|[^>]*))*|\\/|\\s+)>/g;\n    tokenRegExp.lastIndex = index = startIndex;\n\n    while (matches = tokenRegExp.exec(html)) {\n      index = tokenRegExp.lastIndex;\n\n      if (matches[1] === '/') {\n        count--;\n      } else if (!matches[1]) {\n        if (matches[2] in shortEndedElements) {\n          continue;\n        }\n\n        count++;\n      }\n\n      if (count === 0) {\n        break;\n      }\n    }\n\n    return index;\n  };\n\n  var isConditionalComment = function (html, startIndex) {\n    return /^\\s*\\[if [\\w\\W]+\\]>.*<!\\[endif\\](--!?)?>/.test(html.substr(startIndex));\n  };\n\n  var findCommentEndIndex = function (html, isBogus, startIndex) {\n    if (startIndex === void 0) {\n      startIndex = 0;\n    }\n\n    var lcHtml = html.toLowerCase();\n\n    if (lcHtml.indexOf('[if ', startIndex) !== -1 && isConditionalComment(lcHtml, startIndex)) {\n      var endIfIndex = lcHtml.indexOf('[endif]', startIndex);\n      return lcHtml.indexOf('>', endIfIndex);\n    } else {\n      if (isBogus) {\n        var endIndex = lcHtml.indexOf('>', startIndex);\n        return endIndex !== -1 ? endIndex : lcHtml.length;\n      } else {\n        var endCommentRegexp = /--!?>/;\n        endCommentRegexp.lastIndex = startIndex;\n        var match = endCommentRegexp.exec(html);\n        return match ? match.index + match[0].length : lcHtml.length;\n      }\n    }\n  };\n\n  var checkBogusAttribute = function (regExp, attrString) {\n    var matches = regExp.exec(attrString);\n\n    if (matches) {\n      var name_1 = matches[1];\n      var value = matches[2];\n      return typeof name_1 === 'string' && name_1.toLowerCase() === 'data-mce-bogus' ? value : null;\n    } else {\n      return null;\n    }\n  };\n\n  function SaxParser(settings, schema) {\n    if (schema === void 0) {\n      schema = Schema();\n    }\n\n    var noop = function () {};\n\n    settings = settings || {};\n\n    if (settings.fix_self_closing !== false) {\n      settings.fix_self_closing = true;\n    }\n\n    var comment = settings.comment ? settings.comment : noop;\n    var cdata = settings.cdata ? settings.cdata : noop;\n    var text = settings.text ? settings.text : noop;\n    var start = settings.start ? settings.start : noop;\n    var end = settings.end ? settings.end : noop;\n    var pi = settings.pi ? settings.pi : noop;\n    var doctype = settings.doctype ? settings.doctype : noop;\n\n    var parseInternal = function (base64Extract, format) {\n      if (format === void 0) {\n        format = 'html';\n      }\n\n      var html = base64Extract.html;\n      var matches,\n          index = 0,\n          value,\n          endRegExp;\n      var stack = [];\n      var attrList, i, textData, name;\n      var isInternalElement, isShortEnded;\n      var elementRule, isValidElement, attr, attribsValue, validAttributesMap, validAttributePatterns;\n      var attributesRequired, attributesDefault, attributesForced;\n      var anyAttributesRequired,\n          attrValue,\n          idCount = 0;\n      var decode = Entities.decode;\n      var filteredUrlAttrs = Tools.makeMap('src,href,data,background,formaction,poster,xlink:href');\n      var scriptUriRegExp = /((java|vb)script|mhtml):/i;\n      var parsingMode = format === 'html' ? 0 : 1;\n\n      var processEndTag = function (name) {\n        var pos, i;\n        pos = stack.length;\n\n        while (pos--) {\n          if (stack[pos].name === name) {\n            break;\n          }\n        }\n\n        if (pos >= 0) {\n          for (i = stack.length - 1; i >= pos; i--) {\n            name = stack[i];\n\n            if (name.valid) {\n              end(name.name);\n            }\n          }\n\n          stack.length = pos;\n        }\n      };\n\n      var processText = function (value, raw) {\n        return text(restoreDataUris(value, base64Extract), raw);\n      };\n\n      var processComment = function (value) {\n        if (value === '') {\n          return;\n        }\n\n        if (value.charAt(0) === '>') {\n          value = ' ' + value;\n        }\n\n        if (!settings.allow_conditional_comments && value.substr(0, 3).toLowerCase() === '[if') {\n          value = ' ' + value;\n        }\n\n        comment(restoreDataUris(value, base64Extract));\n      };\n\n      var processAttr = function (value) {\n        return get(base64Extract.uris, value).getOr(value);\n      };\n\n      var processMalformedComment = function (value, startIndex) {\n        var startTag = value || '';\n        var isBogus = !startsWith(startTag, '--');\n        var endIndex = findCommentEndIndex(html, isBogus, startIndex);\n        value = html.substr(startIndex, endIndex - startIndex);\n        processComment(isBogus ? startTag + value : value);\n        return endIndex + 1;\n      };\n\n      var parseAttribute = function (match, name, value, val2, val3) {\n        var attrRule, i;\n        var trimRegExp = /[\\s\\u0000-\\u001F]+/g;\n        name = name.toLowerCase();\n        value = processAttr(name in fillAttrsMap ? name : decode(value || val2 || val3 || ''));\n\n        if (validate && !isInternalElement && isValidPrefixAttrName(name) === false) {\n          attrRule = validAttributesMap[name];\n\n          if (!attrRule && validAttributePatterns) {\n            i = validAttributePatterns.length;\n\n            while (i--) {\n              attrRule = validAttributePatterns[i];\n\n              if (attrRule.pattern.test(name)) {\n                break;\n              }\n            }\n\n            if (i === -1) {\n              attrRule = null;\n            }\n          }\n\n          if (!attrRule) {\n            return;\n          }\n\n          if (attrRule.validValues && !(value in attrRule.validValues)) {\n            return;\n          }\n        }\n\n        if (filteredUrlAttrs[name] && !settings.allow_script_urls) {\n          var uri = value.replace(trimRegExp, '');\n\n          try {\n            uri = decodeURIComponent(uri);\n          } catch (ex) {\n            uri = unescape(uri);\n          }\n\n          if (scriptUriRegExp.test(uri)) {\n            return;\n          }\n\n          if (isInvalidUri(settings, uri)) {\n            return;\n          }\n        }\n\n        if (isInternalElement && (name in filteredUrlAttrs || name.indexOf('on') === 0)) {\n          return;\n        }\n\n        attrList.map[name] = value;\n        attrList.push({\n          name: name,\n          value: value\n        });\n      };\n\n      var tokenRegExp = new RegExp('<(?:' + '(?:!--([\\\\w\\\\W]*?)--!?>)|' + '(?:!\\\\[CDATA\\\\[([\\\\w\\\\W]*?)\\\\]\\\\]>)|' + '(?:![Dd][Oo][Cc][Tt][Yy][Pp][Ee]([\\\\w\\\\W]*?)>)|' + '(?:!(--)?)|' + '(?:\\\\?([^\\\\s\\\\/<>]+) ?([\\\\w\\\\W]*?)[?/]>)|' + '(?:\\\\/([A-Za-z][A-Za-z0-9\\\\-_\\\\:\\\\.]*)>)|' + '(?:([A-Za-z][A-Za-z0-9\\\\-_\\\\:\\\\.]*)((?:\\\\s+[^\"\\'>]+(?:(?:\"[^\"]*\")|(?:\\'[^\\']*\\')|[^>]*))*|\\\\/|\\\\s+)>)' + ')', 'g');\n      var attrRegExp = /([\\w:\\-]+)(?:\\s*=\\s*(?:(?:\\\"((?:[^\\\"])*)\\\")|(?:\\'((?:[^\\'])*)\\')|([^>\\s]+)))?/g;\n      var shortEndedElements = schema.getShortEndedElements();\n      var selfClosing = settings.self_closing_elements || schema.getSelfClosingElements();\n      var fillAttrsMap = schema.getBoolAttrs();\n      var validate = settings.validate;\n      var removeInternalElements = settings.remove_internals;\n      var fixSelfClosing = settings.fix_self_closing;\n      var specialElements = schema.getSpecialElements();\n      var processHtml = html + '>';\n\n      while (matches = tokenRegExp.exec(processHtml)) {\n        var matchText = matches[0];\n\n        if (index < matches.index) {\n          processText(decode(html.substr(index, matches.index - index)));\n        }\n\n        if (value = matches[7]) {\n          value = value.toLowerCase();\n\n          if (value.charAt(0) === ':') {\n            value = value.substr(1);\n          }\n\n          processEndTag(value);\n        } else if (value = matches[8]) {\n          if (matches.index + matchText.length > html.length) {\n            processText(decode(html.substr(matches.index)));\n            index = matches.index + matchText.length;\n            continue;\n          }\n\n          value = value.toLowerCase();\n\n          if (value.charAt(0) === ':') {\n            value = value.substr(1);\n          }\n\n          isShortEnded = value in shortEndedElements;\n\n          if (fixSelfClosing && selfClosing[value] && stack.length > 0 && stack[stack.length - 1].name === value) {\n            processEndTag(value);\n          }\n\n          var bogusValue = checkBogusAttribute(attrRegExp, matches[9]);\n\n          if (bogusValue !== null) {\n            if (bogusValue === 'all') {\n              index = findEndTagIndex(schema, html, tokenRegExp.lastIndex);\n              tokenRegExp.lastIndex = index;\n              continue;\n            }\n\n            isValidElement = false;\n          }\n\n          if (!validate || (elementRule = schema.getElementRule(value))) {\n            isValidElement = true;\n\n            if (validate) {\n              validAttributesMap = elementRule.attributes;\n              validAttributePatterns = elementRule.attributePatterns;\n            }\n\n            if (attribsValue = matches[9]) {\n              isInternalElement = attribsValue.indexOf('data-mce-type') !== -1;\n\n              if (isInternalElement && removeInternalElements) {\n                isValidElement = false;\n              }\n\n              attrList = [];\n              attrList.map = {};\n              attribsValue.replace(attrRegExp, parseAttribute);\n            } else {\n              attrList = [];\n              attrList.map = {};\n            }\n\n            if (validate && !isInternalElement) {\n              attributesRequired = elementRule.attributesRequired;\n              attributesDefault = elementRule.attributesDefault;\n              attributesForced = elementRule.attributesForced;\n              anyAttributesRequired = elementRule.removeEmptyAttrs;\n\n              if (anyAttributesRequired && !attrList.length) {\n                isValidElement = false;\n              }\n\n              if (attributesForced) {\n                i = attributesForced.length;\n\n                while (i--) {\n                  attr = attributesForced[i];\n                  name = attr.name;\n                  attrValue = attr.value;\n\n                  if (attrValue === '{$uid}') {\n                    attrValue = 'mce_' + idCount++;\n                  }\n\n                  attrList.map[name] = attrValue;\n                  attrList.push({\n                    name: name,\n                    value: attrValue\n                  });\n                }\n              }\n\n              if (attributesDefault) {\n                i = attributesDefault.length;\n\n                while (i--) {\n                  attr = attributesDefault[i];\n                  name = attr.name;\n\n                  if (!(name in attrList.map)) {\n                    attrValue = attr.value;\n\n                    if (attrValue === '{$uid}') {\n                      attrValue = 'mce_' + idCount++;\n                    }\n\n                    attrList.map[name] = attrValue;\n                    attrList.push({\n                      name: name,\n                      value: attrValue\n                    });\n                  }\n                }\n              }\n\n              if (attributesRequired) {\n                i = attributesRequired.length;\n\n                while (i--) {\n                  if (attributesRequired[i] in attrList.map) {\n                    break;\n                  }\n                }\n\n                if (i === -1) {\n                  isValidElement = false;\n                }\n              }\n\n              if (attr = attrList.map['data-mce-bogus']) {\n                if (attr === 'all') {\n                  index = findEndTagIndex(schema, html, tokenRegExp.lastIndex);\n                  tokenRegExp.lastIndex = index;\n                  continue;\n                }\n\n                isValidElement = false;\n              }\n            }\n\n            if (isValidElement) {\n              start(value, attrList, isShortEnded);\n            }\n          } else {\n            isValidElement = false;\n          }\n\n          if (endRegExp = specialElements[value]) {\n            endRegExp.lastIndex = index = matches.index + matchText.length;\n\n            if (matches = endRegExp.exec(html)) {\n              if (isValidElement) {\n                textData = html.substr(index, matches.index - index);\n              }\n\n              index = matches.index + matches[0].length;\n            } else {\n              textData = html.substr(index);\n              index = html.length;\n            }\n\n            if (isValidElement) {\n              if (textData.length > 0) {\n                processText(textData, true);\n              }\n\n              end(value);\n            }\n\n            tokenRegExp.lastIndex = index;\n            continue;\n          }\n\n          if (!isShortEnded) {\n            if (!attribsValue || attribsValue.indexOf('/') !== attribsValue.length - 1) {\n              stack.push({\n                name: value,\n                valid: isValidElement\n              });\n            } else if (isValidElement) {\n              end(value);\n            }\n          }\n        } else if (value = matches[1]) {\n          processComment(value);\n        } else if (value = matches[2]) {\n          var isValidCdataSection = parsingMode === 1 || settings.preserve_cdata || stack.length > 0 && schema.isValidChild(stack[stack.length - 1].name, '#cdata');\n\n          if (isValidCdataSection) {\n            cdata(value);\n          } else {\n            index = processMalformedComment('', matches.index + 2);\n            tokenRegExp.lastIndex = index;\n            continue;\n          }\n        } else if (value = matches[3]) {\n          doctype(value);\n        } else if ((value = matches[4]) || matchText === '<!') {\n          index = processMalformedComment(value, matches.index + matchText.length);\n          tokenRegExp.lastIndex = index;\n          continue;\n        } else if (value = matches[5]) {\n          if (parsingMode === 1) {\n            pi(value, matches[6]);\n          } else {\n            index = processMalformedComment('?', matches.index + 2);\n            tokenRegExp.lastIndex = index;\n            continue;\n          }\n        }\n\n        index = matches.index + matchText.length;\n      }\n\n      if (index < html.length) {\n        processText(decode(html.substr(index)));\n      }\n\n      for (i = stack.length - 1; i >= 0; i--) {\n        value = stack[i];\n\n        if (value.valid) {\n          end(value.name);\n        }\n      }\n    };\n\n    var parse = function (html, format) {\n      if (format === void 0) {\n        format = 'html';\n      }\n\n      parseInternal(extractBase64DataUris(html), format);\n    };\n\n    return {\n      parse: parse\n    };\n  }\n\n  (function (SaxParser) {\n    SaxParser.findEndTag = findEndTagIndex;\n  })(SaxParser || (SaxParser = {}));\n\n  var SaxParser$1 = SaxParser;\n\n  var trimHtml = function (tempAttrs, html) {\n    var trimContentRegExp = new RegExp(['\\\\s?(' + tempAttrs.join('|') + ')=\"[^\"]+\"'].join('|'), 'gi');\n    return html.replace(trimContentRegExp, '');\n  };\n\n  var trimInternal = function (serializer, html) {\n    var content = html;\n    var bogusAllRegExp = /<(\\w+) [^>]*data-mce-bogus=\"all\"[^>]*>/g;\n    var endTagIndex, index, matchLength, matches;\n    var schema = serializer.schema;\n    content = trimHtml(serializer.getTempAttrs(), content);\n    var shortEndedElements = schema.getShortEndedElements();\n\n    while (matches = bogusAllRegExp.exec(content)) {\n      index = bogusAllRegExp.lastIndex;\n      matchLength = matches[0].length;\n\n      if (shortEndedElements[matches[1]]) {\n        endTagIndex = index;\n      } else {\n        endTagIndex = SaxParser$1.findEndTag(schema, content, index);\n      }\n\n      content = content.substring(0, index - matchLength) + content.substring(endTagIndex);\n      bogusAllRegExp.lastIndex = index - matchLength;\n    }\n\n    return trim$2(content);\n  };\n\n  var trimExternal = trimInternal;\n\n  var trimEmptyContents = function (editor, html) {\n    var blockName = getForcedRootBlock(editor);\n    var emptyRegExp = new RegExp('^(<' + blockName + '[^>]*>(&nbsp;|&#160;|\\\\s|\\xA0|<br \\\\/>|)<\\\\/' + blockName + '>[\\r\\n]*|<br \\\\/>[\\r\\n]*)$');\n    return html.replace(emptyRegExp, '');\n  };\n\n  var getContentFromBody = function (editor, args, format, body) {\n    var content;\n    args.format = format;\n    args.get = true;\n    args.getInner = true;\n\n    if (!args.no_events) {\n      editor.fire('BeforeGetContent', args);\n    }\n\n    if (args.format === 'raw') {\n      content = Tools.trim(trimExternal(editor.serializer, body.innerHTML));\n    } else if (args.format === 'text') {\n      content = trim$2(body.innerText || body.textContent);\n    } else if (args.format === 'tree') {\n      return editor.serializer.serialize(body, args);\n    } else {\n      content = trimEmptyContents(editor, editor.serializer.serialize(body, args));\n    }\n\n    if (args.format !== 'text' && !isWsPreserveElement(SugarElement.fromDom(body))) {\n      args.content = Tools.trim(content);\n    } else {\n      args.content = content;\n    }\n\n    if (!args.no_events) {\n      editor.fire('GetContent', args);\n    }\n\n    return args.content;\n  };\n\n  var getContentInternal = function (editor, args, format) {\n    return Optional.from(editor.getBody()).fold(constant(args.format === 'tree' ? new AstNode('body', 11) : ''), function (body) {\n      return getContentFromBody(editor, args, format, body);\n    });\n  };\n\n  var each$7 = Tools.each;\n\n  var ElementUtils = function (dom) {\n    this.compare = function (node1, node2) {\n      if (node1.nodeName !== node2.nodeName) {\n        return false;\n      }\n\n      var getAttribs = function (node) {\n        var attribs = {};\n        each$7(dom.getAttribs(node), function (attr) {\n          var name = attr.nodeName.toLowerCase();\n\n          if (name.indexOf('_') !== 0 && name !== 'style' && name.indexOf('data-') !== 0) {\n            attribs[name] = dom.getAttrib(node, name);\n          }\n        });\n        return attribs;\n      };\n\n      var compareObjects = function (obj1, obj2) {\n        var value, name;\n\n        for (name in obj1) {\n          if (obj1.hasOwnProperty(name)) {\n            value = obj2[name];\n\n            if (typeof value === 'undefined') {\n              return false;\n            }\n\n            if (obj1[name] !== value) {\n              return false;\n            }\n\n            delete obj2[name];\n          }\n        }\n\n        for (name in obj2) {\n          if (obj2.hasOwnProperty(name)) {\n            return false;\n          }\n        }\n\n        return true;\n      };\n\n      if (!compareObjects(getAttribs(node1), getAttribs(node2))) {\n        return false;\n      }\n\n      if (!compareObjects(dom.parseStyle(dom.getAttrib(node1, 'style')), dom.parseStyle(dom.getAttrib(node2, 'style')))) {\n        return false;\n      }\n\n      return !isBookmarkNode$1(node1) && !isBookmarkNode$1(node2);\n    };\n  };\n\n  var isChar = function (forward, predicate, pos) {\n    return Optional.from(pos.container()).filter(isText$1).exists(function (text) {\n      var delta = forward ? 0 : -1;\n      return predicate(text.data.charAt(pos.offset() + delta));\n    });\n  };\n\n  var isBeforeSpace = curry(isChar, true, isWhiteSpace$1);\n  var isAfterSpace = curry(isChar, false, isWhiteSpace$1);\n\n  var isEmptyText = function (pos) {\n    var container = pos.container();\n    return isText$1(container) && (container.data.length === 0 || isZwsp$1(container.data) && BookmarkManager$1.isBookmarkNode(container.parentNode));\n  };\n\n  var matchesElementPosition = function (before, predicate) {\n    return function (pos) {\n      return Optional.from(getChildNodeAtRelativeOffset(before ? 0 : -1, pos)).filter(predicate).isSome();\n    };\n  };\n\n  var isImageBlock = function (node) {\n    return isImg(node) && get$4(SugarElement.fromDom(node), 'display') === 'block';\n  };\n\n  var isCefNode = function (node) {\n    return isContentEditableFalse(node) && !isBogusAll(node);\n  };\n\n  var isBeforeImageBlock = matchesElementPosition(true, isImageBlock);\n  var isAfterImageBlock = matchesElementPosition(false, isImageBlock);\n  var isBeforeMedia = matchesElementPosition(true, isMedia);\n  var isAfterMedia = matchesElementPosition(false, isMedia);\n  var isBeforeTable = matchesElementPosition(true, isTable);\n  var isAfterTable = matchesElementPosition(false, isTable);\n  var isBeforeContentEditableFalse = matchesElementPosition(true, isCefNode);\n  var isAfterContentEditableFalse = matchesElementPosition(false, isCefNode);\n\n  var getLastChildren$1 = function (elm) {\n    var children = [];\n    var rawNode = elm.dom;\n\n    while (rawNode) {\n      children.push(SugarElement.fromDom(rawNode));\n      rawNode = rawNode.lastChild;\n    }\n\n    return children;\n  };\n\n  var removeTrailingBr = function (elm) {\n    var allBrs = descendants$1(elm, 'br');\n    var brs = filter(getLastChildren$1(elm).slice(-1), isBr$1);\n\n    if (allBrs.length === brs.length) {\n      each(brs, remove);\n    }\n  };\n\n  var fillWithPaddingBr = function (elm) {\n    empty(elm);\n    append(elm, SugarElement.fromHtml('<br data-mce-bogus=\"1\">'));\n  };\n\n  var trimBlockTrailingBr = function (elm) {\n    lastChild(elm).each(function (lastChild) {\n      prevSibling(lastChild).each(function (lastChildPrevSibling) {\n        if (isBlock(elm) && isBr$1(lastChild) && isBlock(lastChildPrevSibling)) {\n          remove(lastChild);\n        }\n      });\n    });\n  };\n\n  var dropLast = function (xs) {\n    return xs.slice(0, -1);\n  };\n\n  var parentsUntil$1 = function (start, root, predicate) {\n    if (contains$2(root, start)) {\n      return dropLast(parents(start, function (elm) {\n        return predicate(elm) || eq$2(elm, root);\n      }));\n    } else {\n      return [];\n    }\n  };\n\n  var parents$1 = function (start, root) {\n    return parentsUntil$1(start, root, never);\n  };\n\n  var parentsAndSelf = function (start, root) {\n    return [start].concat(parents$1(start, root));\n  };\n\n  var navigateIgnoreEmptyTextNodes = function (forward, root, from) {\n    return navigateIgnore(forward, root, from, isEmptyText);\n  };\n\n  var getClosestBlock = function (root, pos) {\n    return find(parentsAndSelf(SugarElement.fromDom(pos.container()), root), isBlock);\n  };\n\n  var isAtBeforeAfterBlockBoundary = function (forward, root, pos) {\n    return navigateIgnoreEmptyTextNodes(forward, root.dom, pos).forall(function (newPos) {\n      return getClosestBlock(root, pos).fold(function () {\n        return isInSameBlock(newPos, pos, root.dom) === false;\n      }, function (fromBlock) {\n        return isInSameBlock(newPos, pos, root.dom) === false && contains$2(fromBlock, SugarElement.fromDom(newPos.container()));\n      });\n    });\n  };\n\n  var isAtBlockBoundary = function (forward, root, pos) {\n    return getClosestBlock(root, pos).fold(function () {\n      return navigateIgnoreEmptyTextNodes(forward, root.dom, pos).forall(function (newPos) {\n        return isInSameBlock(newPos, pos, root.dom) === false;\n      });\n    }, function (parent) {\n      return navigateIgnoreEmptyTextNodes(forward, parent.dom, pos).isNone();\n    });\n  };\n\n  var isAtStartOfBlock = curry(isAtBlockBoundary, false);\n  var isAtEndOfBlock = curry(isAtBlockBoundary, true);\n  var isBeforeBlock = curry(isAtBeforeAfterBlockBoundary, false);\n  var isAfterBlock = curry(isAtBeforeAfterBlockBoundary, true);\n\n  var isBr$5 = function (pos) {\n    return getElementFromPosition(pos).exists(isBr$1);\n  };\n\n  var findBr = function (forward, root, pos) {\n    var parentBlocks = filter(parentsAndSelf(SugarElement.fromDom(pos.container()), root), isBlock);\n    var scope = head(parentBlocks).getOr(root);\n    return fromPosition(forward, scope.dom, pos).filter(isBr$5);\n  };\n\n  var isBeforeBr = function (root, pos) {\n    return getElementFromPosition(pos).exists(isBr$1) || findBr(true, root, pos).isSome();\n  };\n\n  var isAfterBr = function (root, pos) {\n    return getElementFromPrevPosition(pos).exists(isBr$1) || findBr(false, root, pos).isSome();\n  };\n\n  var findPreviousBr = curry(findBr, false);\n  var findNextBr = curry(findBr, true);\n\n  var isInMiddleOfText = function (pos) {\n    return CaretPosition.isTextPosition(pos) && !pos.isAtStart() && !pos.isAtEnd();\n  };\n\n  var getClosestBlock$1 = function (root, pos) {\n    var parentBlocks = filter(parentsAndSelf(SugarElement.fromDom(pos.container()), root), isBlock);\n    return head(parentBlocks).getOr(root);\n  };\n\n  var hasSpaceBefore = function (root, pos) {\n    if (isInMiddleOfText(pos)) {\n      return isAfterSpace(pos);\n    } else {\n      return isAfterSpace(pos) || prevPosition(getClosestBlock$1(root, pos).dom, pos).exists(isAfterSpace);\n    }\n  };\n\n  var hasSpaceAfter = function (root, pos) {\n    if (isInMiddleOfText(pos)) {\n      return isBeforeSpace(pos);\n    } else {\n      return isBeforeSpace(pos) || nextPosition(getClosestBlock$1(root, pos).dom, pos).exists(isBeforeSpace);\n    }\n  };\n\n  var isPreValue = function (value) {\n    return contains(['pre', 'pre-wrap'], value);\n  };\n\n  var isInPre = function (pos) {\n    return getElementFromPosition(pos).bind(function (elm) {\n      return closest(elm, isElement);\n    }).exists(function (elm) {\n      return isPreValue(get$4(elm, 'white-space'));\n    });\n  };\n\n  var isAtBeginningOfBody = function (root, pos) {\n    return prevPosition(root.dom, pos).isNone();\n  };\n\n  var isAtEndOfBody = function (root, pos) {\n    return nextPosition(root.dom, pos).isNone();\n  };\n\n  var isAtLineBoundary = function (root, pos) {\n    return isAtBeginningOfBody(root, pos) || isAtEndOfBody(root, pos) || isAtStartOfBlock(root, pos) || isAtEndOfBlock(root, pos) || isAfterBr(root, pos) || isBeforeBr(root, pos);\n  };\n\n  var needsToHaveNbsp = function (root, pos) {\n    if (isInPre(pos)) {\n      return false;\n    } else {\n      return isAtLineBoundary(root, pos) || hasSpaceBefore(root, pos) || hasSpaceAfter(root, pos);\n    }\n  };\n\n  var needsToBeNbspLeft = function (root, pos) {\n    if (isInPre(pos)) {\n      return false;\n    } else {\n      return isAtStartOfBlock(root, pos) || isBeforeBlock(root, pos) || isAfterBr(root, pos) || hasSpaceBefore(root, pos);\n    }\n  };\n\n  var leanRight = function (pos) {\n    var container = pos.container();\n    var offset = pos.offset();\n\n    if (isText$1(container) && offset < container.data.length) {\n      return CaretPosition(container, offset + 1);\n    } else {\n      return pos;\n    }\n  };\n\n  var needsToBeNbspRight = function (root, pos) {\n    if (isInPre(pos)) {\n      return false;\n    } else {\n      return isAtEndOfBlock(root, pos) || isAfterBlock(root, pos) || isBeforeBr(root, pos) || hasSpaceAfter(root, pos);\n    }\n  };\n\n  var needsToBeNbsp = function (root, pos) {\n    return needsToBeNbspLeft(root, pos) || needsToBeNbspRight(root, leanRight(pos));\n  };\n\n  var isNbspAt = function (text, offset) {\n    return isNbsp(text.charAt(offset));\n  };\n\n  var hasNbsp = function (pos) {\n    var container = pos.container();\n    return isText$1(container) && contains$1(container.data, nbsp);\n  };\n\n  var normalizeNbspMiddle = function (text) {\n    var chars = text.split('');\n    return map(chars, function (chr, i) {\n      if (isNbsp(chr) && i > 0 && i < chars.length - 1 && isContent$1(chars[i - 1]) && isContent$1(chars[i + 1])) {\n        return ' ';\n      } else {\n        return chr;\n      }\n    }).join('');\n  };\n\n  var normalizeNbspAtStart = function (root, node) {\n    var text = node.data;\n    var firstPos = CaretPosition(node, 0);\n\n    if (isNbspAt(text, 0) && !needsToBeNbsp(root, firstPos)) {\n      node.data = ' ' + text.slice(1);\n      return true;\n    } else {\n      return false;\n    }\n  };\n\n  var normalizeNbspInMiddleOfTextNode = function (node) {\n    var text = node.data;\n    var newText = normalizeNbspMiddle(text);\n\n    if (newText !== text) {\n      node.data = newText;\n      return true;\n    } else {\n      return false;\n    }\n  };\n\n  var normalizeNbspAtEnd = function (root, node) {\n    var text = node.data;\n    var lastPos = CaretPosition(node, text.length - 1);\n\n    if (isNbspAt(text, text.length - 1) && !needsToBeNbsp(root, lastPos)) {\n      node.data = text.slice(0, -1) + ' ';\n      return true;\n    } else {\n      return false;\n    }\n  };\n\n  var normalizeNbsps = function (root, pos) {\n    return Optional.some(pos).filter(hasNbsp).bind(function (pos) {\n      var container = pos.container();\n      var normalized = normalizeNbspAtStart(root, container) || normalizeNbspInMiddleOfTextNode(container) || normalizeNbspAtEnd(root, container);\n      return normalized ? Optional.some(pos) : Optional.none();\n    });\n  };\n\n  var normalizeNbspsInEditor = function (editor) {\n    var root = SugarElement.fromDom(editor.getBody());\n\n    if (editor.selection.isCollapsed()) {\n      normalizeNbsps(root, CaretPosition.fromRangeStart(editor.selection.getRng())).each(function (pos) {\n        editor.selection.setRng(pos.toRange());\n      });\n    }\n  };\n\n  var normalizeContent = function (content, isStartOfContent, isEndOfContent) {\n    var result = foldl(content, function (acc, c) {\n      if (isWhiteSpace$1(c) || isNbsp(c)) {\n        if (acc.previousCharIsSpace || acc.str === '' && isStartOfContent || acc.str.length === content.length - 1 && isEndOfContent) {\n          return {\n            previousCharIsSpace: false,\n            str: acc.str + nbsp\n          };\n        } else {\n          return {\n            previousCharIsSpace: true,\n            str: acc.str + ' '\n          };\n        }\n      } else {\n        return {\n          previousCharIsSpace: false,\n          str: acc.str + c\n        };\n      }\n    }, {\n      previousCharIsSpace: false,\n      str: ''\n    });\n    return result.str;\n  };\n\n  var normalize$1 = function (node, offset, count) {\n    if (count === 0) {\n      return;\n    }\n\n    var elm = SugarElement.fromDom(node);\n    var root = ancestor(elm, isBlock).getOr(elm);\n    var whitespace = node.data.slice(offset, offset + count);\n    var isEndOfContent = offset + count >= node.data.length && needsToBeNbspRight(root, CaretPosition$1(node, node.data.length));\n    var isStartOfContent = offset === 0 && needsToBeNbspLeft(root, CaretPosition$1(node, 0));\n    node.replaceData(offset, count, normalizeContent(whitespace, isStartOfContent, isEndOfContent));\n  };\n\n  var normalizeWhitespaceAfter = function (node, offset) {\n    var content = node.data.slice(offset);\n    var whitespaceCount = content.length - lTrim(content).length;\n    return normalize$1(node, offset, whitespaceCount);\n  };\n\n  var normalizeWhitespaceBefore = function (node, offset) {\n    var content = node.data.slice(0, offset);\n    var whitespaceCount = content.length - rTrim(content).length;\n    return normalize$1(node, offset - whitespaceCount, whitespaceCount);\n  };\n\n  var mergeTextNodes = function (prevNode, nextNode, normalizeWhitespace, mergeToPrev) {\n    if (mergeToPrev === void 0) {\n      mergeToPrev = true;\n    }\n\n    var whitespaceOffset = rTrim(prevNode.data).length;\n    var newNode = mergeToPrev ? prevNode : nextNode;\n    var removeNode = mergeToPrev ? nextNode : prevNode;\n\n    if (mergeToPrev) {\n      newNode.appendData(removeNode.data);\n    } else {\n      newNode.insertData(0, removeNode.data);\n    }\n\n    remove(SugarElement.fromDom(removeNode));\n\n    if (normalizeWhitespace) {\n      normalizeWhitespaceAfter(newNode, whitespaceOffset);\n    }\n\n    return newNode;\n  };\n\n  var needsReposition = function (pos, elm) {\n    var container = pos.container();\n    var offset = pos.offset();\n    return CaretPosition$1.isTextPosition(pos) === false && container === elm.parentNode && offset > CaretPosition$1.before(elm).offset();\n  };\n\n  var reposition = function (elm, pos) {\n    return needsReposition(pos, elm) ? CaretPosition$1(pos.container(), pos.offset() - 1) : pos;\n  };\n\n  var beforeOrStartOf = function (node) {\n    return isText$1(node) ? CaretPosition$1(node, 0) : CaretPosition$1.before(node);\n  };\n\n  var afterOrEndOf = function (node) {\n    return isText$1(node) ? CaretPosition$1(node, node.data.length) : CaretPosition$1.after(node);\n  };\n\n  var getPreviousSiblingCaretPosition = function (elm) {\n    if (isCaretCandidate(elm.previousSibling)) {\n      return Optional.some(afterOrEndOf(elm.previousSibling));\n    } else {\n      return elm.previousSibling ? lastPositionIn(elm.previousSibling) : Optional.none();\n    }\n  };\n\n  var getNextSiblingCaretPosition = function (elm) {\n    if (isCaretCandidate(elm.nextSibling)) {\n      return Optional.some(beforeOrStartOf(elm.nextSibling));\n    } else {\n      return elm.nextSibling ? firstPositionIn(elm.nextSibling) : Optional.none();\n    }\n  };\n\n  var findCaretPositionBackwardsFromElm = function (rootElement, elm) {\n    var startPosition = CaretPosition$1.before(elm.previousSibling ? elm.previousSibling : elm.parentNode);\n    return prevPosition(rootElement, startPosition).fold(function () {\n      return nextPosition(rootElement, CaretPosition$1.after(elm));\n    }, Optional.some);\n  };\n\n  var findCaretPositionForwardsFromElm = function (rootElement, elm) {\n    return nextPosition(rootElement, CaretPosition$1.after(elm)).fold(function () {\n      return prevPosition(rootElement, CaretPosition$1.before(elm));\n    }, Optional.some);\n  };\n\n  var findCaretPositionBackwards = function (rootElement, elm) {\n    return getPreviousSiblingCaretPosition(elm).orThunk(function () {\n      return getNextSiblingCaretPosition(elm);\n    }).orThunk(function () {\n      return findCaretPositionBackwardsFromElm(rootElement, elm);\n    });\n  };\n\n  var findCaretPositionForward = function (rootElement, elm) {\n    return getNextSiblingCaretPosition(elm).orThunk(function () {\n      return getPreviousSiblingCaretPosition(elm);\n    }).orThunk(function () {\n      return findCaretPositionForwardsFromElm(rootElement, elm);\n    });\n  };\n\n  var findCaretPosition$1 = function (forward, rootElement, elm) {\n    return forward ? findCaretPositionForward(rootElement, elm) : findCaretPositionBackwards(rootElement, elm);\n  };\n\n  var findCaretPosOutsideElmAfterDelete = function (forward, rootElement, elm) {\n    return findCaretPosition$1(forward, rootElement, elm).map(curry(reposition, elm));\n  };\n\n  var setSelection = function (editor, forward, pos) {\n    pos.fold(function () {\n      editor.focus();\n    }, function (pos) {\n      editor.selection.setRng(pos.toRange(), forward);\n    });\n  };\n\n  var eqRawNode = function (rawNode) {\n    return function (elm) {\n      return elm.dom === rawNode;\n    };\n  };\n\n  var isBlock$2 = function (editor, elm) {\n    return elm && has(editor.schema.getBlockElements(), name(elm));\n  };\n\n  var paddEmptyBlock = function (elm) {\n    if (isEmpty(elm)) {\n      var br = SugarElement.fromHtml('<br data-mce-bogus=\"1\">');\n      empty(elm);\n      append(elm, br);\n      return Optional.some(CaretPosition$1.before(br.dom));\n    } else {\n      return Optional.none();\n    }\n  };\n\n  var deleteNormalized = function (elm, afterDeletePosOpt, normalizeWhitespace) {\n    var prevTextOpt = prevSibling(elm).filter(isText);\n    var nextTextOpt = nextSibling(elm).filter(isText);\n    remove(elm);\n    return lift3(prevTextOpt, nextTextOpt, afterDeletePosOpt, function (prev, next, pos) {\n      var prevNode = prev.dom,\n          nextNode = next.dom;\n      var offset = prevNode.data.length;\n      mergeTextNodes(prevNode, nextNode, normalizeWhitespace);\n      return pos.container() === nextNode ? CaretPosition$1(prevNode, offset) : pos;\n    }).orThunk(function () {\n      if (normalizeWhitespace) {\n        prevTextOpt.each(function (elm) {\n          return normalizeWhitespaceBefore(elm.dom, elm.dom.length);\n        });\n        nextTextOpt.each(function (elm) {\n          return normalizeWhitespaceAfter(elm.dom, 0);\n        });\n      }\n\n      return afterDeletePosOpt;\n    });\n  };\n\n  var isInlineElement = function (editor, element) {\n    return has(editor.schema.getTextInlineElements(), name(element));\n  };\n\n  var deleteElement = function (editor, forward, elm, moveCaret) {\n    if (moveCaret === void 0) {\n      moveCaret = true;\n    }\n\n    var afterDeletePos = findCaretPosOutsideElmAfterDelete(forward, editor.getBody(), elm.dom);\n    var parentBlock = ancestor(elm, curry(isBlock$2, editor), eqRawNode(editor.getBody()));\n    var normalizedAfterDeletePos = deleteNormalized(elm, afterDeletePos, isInlineElement(editor, elm));\n\n    if (editor.dom.isEmpty(editor.getBody())) {\n      editor.setContent('');\n      editor.selection.setCursorLocation();\n    } else {\n      parentBlock.bind(paddEmptyBlock).fold(function () {\n        if (moveCaret) {\n          setSelection(editor, forward, normalizedAfterDeletePos);\n        }\n      }, function (paddPos) {\n        if (moveCaret) {\n          setSelection(editor, forward, Optional.some(paddPos));\n        }\n      });\n    }\n  };\n\n  var tableCellRng = function (start, end) {\n    return {\n      start: start,\n      end: end\n    };\n  };\n\n  var tableSelection = function (rng, table, cells) {\n    return {\n      rng: rng,\n      table: table,\n      cells: cells\n    };\n  };\n\n  var deleteAction = Adt.generate([{\n    removeTable: ['element']\n  }, {\n    emptyCells: ['cells']\n  }, {\n    deleteCellSelection: ['rng', 'cell']\n  }]);\n\n  var isRootFromElement = function (root) {\n    return function (cur) {\n      return eq$2(root, cur);\n    };\n  };\n\n  var getClosestCell = function (container, isRoot) {\n    return closest$1(SugarElement.fromDom(container), 'td,th', isRoot);\n  };\n\n  var getClosestTable = function (cell, isRoot) {\n    return ancestor$1(cell, 'table', isRoot);\n  };\n\n  var isExpandedCellRng = function (cellRng) {\n    return !eq$2(cellRng.start, cellRng.end);\n  };\n\n  var getTableFromCellRng = function (cellRng, isRoot) {\n    return getClosestTable(cellRng.start, isRoot).bind(function (startParentTable) {\n      return getClosestTable(cellRng.end, isRoot).bind(function (endParentTable) {\n        return someIf(eq$2(startParentTable, endParentTable), startParentTable);\n      });\n    });\n  };\n\n  var isSingleCellTable = function (cellRng, isRoot) {\n    return !isExpandedCellRng(cellRng) && getTableFromCellRng(cellRng, isRoot).exists(function (table) {\n      var rows = table.dom.rows;\n      return rows.length === 1 && rows[0].cells.length === 1;\n    });\n  };\n\n  var getTableCells = function (table) {\n    return descendants$1(table, 'td,th');\n  };\n\n  var getCellRng = function (rng, isRoot) {\n    var startCell = getClosestCell(rng.startContainer, isRoot);\n    var endCell = getClosestCell(rng.endContainer, isRoot);\n    return lift2(startCell, endCell, tableCellRng);\n  };\n\n  var getCellRangeFromStartTable = function (cellRng, isRoot) {\n    return getClosestTable(cellRng.start, isRoot).bind(function (table) {\n      return last(getTableCells(table)).map(function (endCell) {\n        return tableCellRng(cellRng.start, endCell);\n      });\n    });\n  };\n\n  var partialSelection = function (isRoot, rng) {\n    var startCell = getClosestCell(rng.startContainer, isRoot);\n    var endCell = getClosestCell(rng.endContainer, isRoot);\n    return rng.collapsed ? Optional.none() : lift2(startCell, endCell, tableCellRng).fold(function () {\n      return startCell.fold(function () {\n        return endCell.bind(function (endCell) {\n          return getClosestTable(endCell, isRoot).bind(function (table) {\n            return head(getTableCells(table)).map(function (startCell) {\n              return tableCellRng(startCell, endCell);\n            });\n          });\n        });\n      }, function (startCell) {\n        return getClosestTable(startCell, isRoot).bind(function (table) {\n          return last(getTableCells(table)).map(function (endCell) {\n            return tableCellRng(startCell, endCell);\n          });\n        });\n      });\n    }, function (cellRng) {\n      return isWithinSameTable(isRoot, cellRng) ? Optional.none() : getCellRangeFromStartTable(cellRng, isRoot);\n    });\n  };\n\n  var isWithinSameTable = function (isRoot, cellRng) {\n    return getTableFromCellRng(cellRng, isRoot).isSome();\n  };\n\n  var getTableSelectionFromCellRng = function (cellRng, isRoot) {\n    return getTableFromCellRng(cellRng, isRoot).map(function (table) {\n      return tableSelection(cellRng, table, getTableCells(table));\n    });\n  };\n\n  var getTableSelection = function (optCellRng, rng, isRoot) {\n    return optCellRng.filter(function (cellRng) {\n      return isExpandedCellRng(cellRng) && isWithinSameTable(isRoot, cellRng);\n    }).orThunk(function () {\n      return partialSelection(isRoot, rng);\n    }).bind(function (cRng) {\n      return getTableSelectionFromCellRng(cRng, isRoot);\n    });\n  };\n\n  var getCellIndex = function (cells, cell) {\n    return findIndex(cells, function (x) {\n      return eq$2(x, cell);\n    });\n  };\n\n  var getSelectedCells = function (tableSelection) {\n    return lift2(getCellIndex(tableSelection.cells, tableSelection.rng.start), getCellIndex(tableSelection.cells, tableSelection.rng.end), function (startIndex, endIndex) {\n      return tableSelection.cells.slice(startIndex, endIndex + 1);\n    });\n  };\n\n  var isSingleCellTableContentSelected = function (optCellRng, rng, isRoot) {\n    return optCellRng.filter(function (cellRng) {\n      return isSingleCellTable(cellRng, isRoot) && hasAllContentsSelected(cellRng.start, rng);\n    }).map(function (cellRng) {\n      return cellRng.start;\n    });\n  };\n\n  var getAction = function (tableSelection) {\n    return getSelectedCells(tableSelection).map(function (selected) {\n      var cells = tableSelection.cells;\n      return selected.length === cells.length ? deleteAction.removeTable(tableSelection.table) : deleteAction.emptyCells(selected);\n    });\n  };\n\n  var getActionFromRange = function (root, rng) {\n    var isRoot = isRootFromElement(root);\n    var optCellRng = getCellRng(rng, isRoot);\n    return isSingleCellTableContentSelected(optCellRng, rng, isRoot).map(function (cell) {\n      return deleteAction.deleteCellSelection(rng, cell);\n    }).orThunk(function () {\n      return getTableSelection(optCellRng, rng, isRoot).bind(getAction);\n    });\n  };\n\n  var freefallRtl = function (root) {\n    var child = isComment(root) ? prevSibling(root) : lastChild(root);\n    return child.bind(freefallRtl).orThunk(function () {\n      return Optional.some(root);\n    });\n  };\n\n  var emptyCells = function (editor, cells) {\n    each(cells, fillWithPaddingBr);\n    editor.selection.setCursorLocation(cells[0].dom, 0);\n    return true;\n  };\n\n  var deleteCellContents = function (editor, rng, cell) {\n    rng.deleteContents();\n    var lastNode = freefallRtl(cell).getOr(cell);\n    var lastBlock = SugarElement.fromDom(editor.dom.getParent(lastNode.dom, editor.dom.isBlock));\n\n    if (isEmpty(lastBlock)) {\n      fillWithPaddingBr(lastBlock);\n      editor.selection.setCursorLocation(lastBlock.dom, 0);\n    }\n\n    if (!eq$2(cell, lastBlock)) {\n      var additionalCleanupNodes = parent(lastBlock).is(cell) ? [] : siblings(lastBlock);\n      each(additionalCleanupNodes.concat(children(cell)), function (node) {\n        if (!eq$2(node, lastBlock) && !contains$2(node, lastBlock)) {\n          remove(node);\n        }\n      });\n    }\n\n    return true;\n  };\n\n  var deleteTableElement = function (editor, table) {\n    deleteElement(editor, false, table);\n    return true;\n  };\n\n  var deleteCellRange = function (editor, rootElm, rng) {\n    return getActionFromRange(rootElm, rng).map(function (action) {\n      return action.fold(curry(deleteTableElement, editor), curry(emptyCells, editor), curry(deleteCellContents, editor));\n    });\n  };\n\n  var deleteCaptionRange = function (editor, caption) {\n    return emptyElement(editor, caption);\n  };\n\n  var deleteTableRange = function (editor, rootElm, rng, startElm) {\n    return getParentCaption(rootElm, startElm).fold(function () {\n      return deleteCellRange(editor, rootElm, rng);\n    }, function (caption) {\n      return deleteCaptionRange(editor, caption);\n    }).getOr(false);\n  };\n\n  var deleteRange = function (editor, startElm) {\n    var rootNode = SugarElement.fromDom(editor.getBody());\n    var rng = editor.selection.getRng();\n    var selectedCells = getCellsFromEditor(editor);\n    return selectedCells.length !== 0 ? emptyCells(editor, selectedCells) : deleteTableRange(editor, rootNode, rng, startElm);\n  };\n\n  var getParentCell = function (rootElm, elm) {\n    return find(parentsAndSelf(elm, rootElm), isTableCell$1);\n  };\n\n  var getParentCaption = function (rootElm, elm) {\n    return find(parentsAndSelf(elm, rootElm), function (elm) {\n      return name(elm) === 'caption';\n    });\n  };\n\n  var deleteBetweenCells = function (editor, rootElm, forward, fromCell, from) {\n    return navigate(forward, editor.getBody(), from).bind(function (to) {\n      return getParentCell(rootElm, SugarElement.fromDom(to.getNode())).map(function (toCell) {\n        return eq$2(toCell, fromCell) === false;\n      });\n    });\n  };\n\n  var emptyElement = function (editor, elm) {\n    fillWithPaddingBr(elm);\n    editor.selection.setCursorLocation(elm.dom, 0);\n    return Optional.some(true);\n  };\n\n  var isDeleteOfLastCharPos = function (fromCaption, forward, from, to) {\n    return firstPositionIn(fromCaption.dom).bind(function (first) {\n      return lastPositionIn(fromCaption.dom).map(function (last) {\n        return forward ? from.isEqual(first) && to.isEqual(last) : from.isEqual(last) && to.isEqual(first);\n      });\n    }).getOr(true);\n  };\n\n  var emptyCaretCaption = function (editor, elm) {\n    return emptyElement(editor, elm);\n  };\n\n  var validateCaretCaption = function (rootElm, fromCaption, to) {\n    return getParentCaption(rootElm, SugarElement.fromDom(to.getNode())).map(function (toCaption) {\n      return eq$2(toCaption, fromCaption) === false;\n    });\n  };\n\n  var deleteCaretInsideCaption = function (editor, rootElm, forward, fromCaption, from) {\n    return navigate(forward, editor.getBody(), from).bind(function (to) {\n      return isDeleteOfLastCharPos(fromCaption, forward, from, to) ? emptyCaretCaption(editor, fromCaption) : validateCaretCaption(rootElm, fromCaption, to);\n    }).or(Optional.some(true));\n  };\n\n  var deleteCaretCells = function (editor, forward, rootElm, startElm) {\n    var from = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n    return getParentCell(rootElm, startElm).bind(function (fromCell) {\n      return isEmpty(fromCell) ? emptyElement(editor, fromCell) : deleteBetweenCells(editor, rootElm, forward, fromCell, from);\n    }).getOr(false);\n  };\n\n  var deleteCaretCaption = function (editor, forward, rootElm, fromCaption) {\n    var from = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n    return isEmpty(fromCaption) ? emptyElement(editor, fromCaption) : deleteCaretInsideCaption(editor, rootElm, forward, fromCaption, from);\n  };\n\n  var isNearTable = function (forward, pos) {\n    return forward ? isBeforeTable(pos) : isAfterTable(pos);\n  };\n\n  var isBeforeOrAfterTable = function (editor, forward) {\n    var fromPos = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n    return isNearTable(forward, fromPos) || fromPosition(forward, editor.getBody(), fromPos).exists(function (pos) {\n      return isNearTable(forward, pos);\n    });\n  };\n\n  var deleteCaret = function (editor, forward, startElm) {\n    var rootElm = SugarElement.fromDom(editor.getBody());\n    return getParentCaption(rootElm, startElm).fold(function () {\n      return deleteCaretCells(editor, forward, rootElm, startElm) || isBeforeOrAfterTable(editor, forward);\n    }, function (fromCaption) {\n      return deleteCaretCaption(editor, forward, rootElm, fromCaption).getOr(false);\n    });\n  };\n\n  var backspaceDelete = function (editor, forward) {\n    var startElm = SugarElement.fromDom(editor.selection.getStart(true));\n    var cells = getCellsFromEditor(editor);\n    return editor.selection.isCollapsed() && cells.length === 0 ? deleteCaret(editor, forward, startElm) : deleteRange(editor, startElm);\n  };\n\n  var createRange$1 = function (sc, so, ec, eo) {\n    var rng = document.createRange();\n    rng.setStart(sc, so);\n    rng.setEnd(ec, eo);\n    return rng;\n  };\n\n  var normalizeBlockSelectionRange = function (rng) {\n    var startPos = CaretPosition$1.fromRangeStart(rng);\n    var endPos = CaretPosition$1.fromRangeEnd(rng);\n    var rootNode = rng.commonAncestorContainer;\n    return fromPosition(false, rootNode, endPos).map(function (newEndPos) {\n      if (!isInSameBlock(startPos, endPos, rootNode) && isInSameBlock(startPos, newEndPos, rootNode)) {\n        return createRange$1(startPos.container(), startPos.offset(), newEndPos.container(), newEndPos.offset());\n      } else {\n        return rng;\n      }\n    }).getOr(rng);\n  };\n\n  var normalize$2 = function (rng) {\n    return rng.collapsed ? rng : normalizeBlockSelectionRange(rng);\n  };\n\n  var hasOnlyOneChild = function (node) {\n    return node.firstChild && node.firstChild === node.lastChild;\n  };\n\n  var isPaddingNode = function (node) {\n    return node.name === 'br' || node.value === nbsp;\n  };\n\n  var isPaddedEmptyBlock = function (schema, node) {\n    var blockElements = schema.getBlockElements();\n    return blockElements[node.name] && hasOnlyOneChild(node) && isPaddingNode(node.firstChild);\n  };\n\n  var isEmptyFragmentElement = function (schema, node) {\n    var nonEmptyElements = schema.getNonEmptyElements();\n    return node && (node.isEmpty(nonEmptyElements) || isPaddedEmptyBlock(schema, node));\n  };\n\n  var isListFragment = function (schema, fragment) {\n    var firstChild = fragment.firstChild;\n    var lastChild = fragment.lastChild;\n\n    if (firstChild && firstChild.name === 'meta') {\n      firstChild = firstChild.next;\n    }\n\n    if (lastChild && lastChild.attr('id') === 'mce_marker') {\n      lastChild = lastChild.prev;\n    }\n\n    if (isEmptyFragmentElement(schema, lastChild)) {\n      lastChild = lastChild.prev;\n    }\n\n    if (!firstChild || firstChild !== lastChild) {\n      return false;\n    }\n\n    return firstChild.name === 'ul' || firstChild.name === 'ol';\n  };\n\n  var cleanupDomFragment = function (domFragment) {\n    var firstChild = domFragment.firstChild;\n    var lastChild = domFragment.lastChild;\n\n    if (firstChild && firstChild.nodeName === 'META') {\n      firstChild.parentNode.removeChild(firstChild);\n    }\n\n    if (lastChild && lastChild.id === 'mce_marker') {\n      lastChild.parentNode.removeChild(lastChild);\n    }\n\n    return domFragment;\n  };\n\n  var toDomFragment = function (dom, serializer, fragment) {\n    var html = serializer.serialize(fragment);\n    var domFragment = dom.createFragment(html);\n    return cleanupDomFragment(domFragment);\n  };\n\n  var listItems$1 = function (elm) {\n    return Tools.grep(elm.childNodes, function (child) {\n      return child.nodeName === 'LI';\n    });\n  };\n\n  var isPadding = function (node) {\n    return node.data === nbsp || isBr(node);\n  };\n\n  var isListItemPadded = function (node) {\n    return node && node.firstChild && node.firstChild === node.lastChild && isPadding(node.firstChild);\n  };\n\n  var isEmptyOrPadded = function (elm) {\n    return !elm.firstChild || isListItemPadded(elm);\n  };\n\n  var trimListItems = function (elms) {\n    return elms.length > 0 && isEmptyOrPadded(elms[elms.length - 1]) ? elms.slice(0, -1) : elms;\n  };\n\n  var getParentLi = function (dom, node) {\n    var parentBlock = dom.getParent(node, dom.isBlock);\n    return parentBlock && parentBlock.nodeName === 'LI' ? parentBlock : null;\n  };\n\n  var isParentBlockLi = function (dom, node) {\n    return !!getParentLi(dom, node);\n  };\n\n  var getSplit = function (parentNode, rng) {\n    var beforeRng = rng.cloneRange();\n    var afterRng = rng.cloneRange();\n    beforeRng.setStartBefore(parentNode);\n    afterRng.setEndAfter(parentNode);\n    return [beforeRng.cloneContents(), afterRng.cloneContents()];\n  };\n\n  var findFirstIn = function (node, rootNode) {\n    var caretPos = CaretPosition$1.before(node);\n    var caretWalker = CaretWalker(rootNode);\n    var newCaretPos = caretWalker.next(caretPos);\n    return newCaretPos ? newCaretPos.toRange() : null;\n  };\n\n  var findLastOf = function (node, rootNode) {\n    var caretPos = CaretPosition$1.after(node);\n    var caretWalker = CaretWalker(rootNode);\n    var newCaretPos = caretWalker.prev(caretPos);\n    return newCaretPos ? newCaretPos.toRange() : null;\n  };\n\n  var insertMiddle = function (target, elms, rootNode, rng) {\n    var parts = getSplit(target, rng);\n    var parentElm = target.parentNode;\n    parentElm.insertBefore(parts[0], target);\n    Tools.each(elms, function (li) {\n      parentElm.insertBefore(li, target);\n    });\n    parentElm.insertBefore(parts[1], target);\n    parentElm.removeChild(target);\n    return findLastOf(elms[elms.length - 1], rootNode);\n  };\n\n  var insertBefore = function (target, elms, rootNode) {\n    var parentElm = target.parentNode;\n    Tools.each(elms, function (elm) {\n      parentElm.insertBefore(elm, target);\n    });\n    return findFirstIn(target, rootNode);\n  };\n\n  var insertAfter = function (target, elms, rootNode, dom) {\n    dom.insertAfter(elms.reverse(), target);\n    return findLastOf(elms[0], rootNode);\n  };\n\n  var insertAtCaret = function (serializer, dom, rng, fragment) {\n    var domFragment = toDomFragment(dom, serializer, fragment);\n    var liTarget = getParentLi(dom, rng.startContainer);\n    var liElms = trimListItems(listItems$1(domFragment.firstChild));\n    var BEGINNING = 1,\n        END = 2;\n    var rootNode = dom.getRoot();\n\n    var isAt = function (location) {\n      var caretPos = CaretPosition$1.fromRangeStart(rng);\n      var caretWalker = CaretWalker(dom.getRoot());\n      var newPos = location === BEGINNING ? caretWalker.prev(caretPos) : caretWalker.next(caretPos);\n      return newPos ? getParentLi(dom, newPos.getNode()) !== liTarget : true;\n    };\n\n    if (isAt(BEGINNING)) {\n      return insertBefore(liTarget, liElms, rootNode);\n    } else if (isAt(END)) {\n      return insertAfter(liTarget, liElms, rootNode, dom);\n    }\n\n    return insertMiddle(liTarget, liElms, rootNode, rng);\n  };\n\n  var trimOrPadLeftRight = function (dom, rng, html) {\n    var root = SugarElement.fromDom(dom.getRoot());\n\n    if (needsToBeNbspLeft(root, CaretPosition$1.fromRangeStart(rng))) {\n      html = html.replace(/^ /, '&nbsp;');\n    } else {\n      html = html.replace(/^&nbsp;/, ' ');\n    }\n\n    if (needsToBeNbspRight(root, CaretPosition$1.fromRangeEnd(rng))) {\n      html = html.replace(/(&nbsp;| )(<br( \\/)>)?$/, '&nbsp;');\n    } else {\n      html = html.replace(/&nbsp;(<br( \\/)?>)?$/, ' ');\n    }\n\n    return html;\n  };\n\n  var isTableCell$4 = isTableCell;\n\n  var isTableCellContentSelected = function (dom, rng, cell) {\n    if (cell !== null) {\n      var endCell = dom.getParent(rng.endContainer, isTableCell$4);\n      return cell === endCell && hasAllContentsSelected(SugarElement.fromDom(cell), rng);\n    } else {\n      return false;\n    }\n  };\n\n  var validInsertion = function (editor, value, parentNode) {\n    if (parentNode.getAttribute('data-mce-bogus') === 'all') {\n      parentNode.parentNode.insertBefore(editor.dom.createFragment(value), parentNode);\n    } else {\n      var node = parentNode.firstChild;\n      var node2 = parentNode.lastChild;\n\n      if (!node || node === node2 && node.nodeName === 'BR') {\n        editor.dom.setHTML(parentNode, value);\n      } else {\n        editor.selection.setContent(value);\n      }\n    }\n  };\n\n  var trimBrsFromTableCell = function (dom, elm) {\n    Optional.from(dom.getParent(elm, 'td,th')).map(SugarElement.fromDom).each(trimBlockTrailingBr);\n  };\n\n  var reduceInlineTextElements = function (editor, merge) {\n    var textInlineElements = editor.schema.getTextInlineElements();\n    var dom = editor.dom;\n\n    if (merge) {\n      var root_1 = editor.getBody(),\n          elementUtils_1 = new ElementUtils(dom);\n      Tools.each(dom.select('*[data-mce-fragment]'), function (node) {\n        for (var testNode = node.parentNode; testNode && testNode !== root_1; testNode = testNode.parentNode) {\n          if (textInlineElements[node.nodeName.toLowerCase()] && elementUtils_1.compare(testNode, node)) {\n            dom.remove(node, true);\n          }\n        }\n      });\n    }\n  };\n\n  var markFragmentElements = function (fragment) {\n    var node = fragment;\n\n    while (node = node.walk()) {\n      if (node.type === 1) {\n        node.attr('data-mce-fragment', '1');\n      }\n    }\n  };\n\n  var unmarkFragmentElements = function (elm) {\n    Tools.each(elm.getElementsByTagName('*'), function (elm) {\n      elm.removeAttribute('data-mce-fragment');\n    });\n  };\n\n  var isPartOfFragment = function (node) {\n    return !!node.getAttribute('data-mce-fragment');\n  };\n\n  var canHaveChildren = function (editor, node) {\n    return node && !editor.schema.getShortEndedElements()[node.nodeName];\n  };\n\n  var moveSelectionToMarker = function (editor, marker) {\n    var nextRng;\n    var dom = editor.dom,\n        selection = editor.selection;\n    var node2;\n\n    var getContentEditableFalseParent = function (node) {\n      var root = editor.getBody();\n\n      for (; node && node !== root; node = node.parentNode) {\n        if (dom.getContentEditable(node) === 'false') {\n          return node;\n        }\n      }\n\n      return null;\n    };\n\n    if (!marker) {\n      return;\n    }\n\n    selection.scrollIntoView(marker);\n    var parentEditableFalseElm = getContentEditableFalseParent(marker);\n\n    if (parentEditableFalseElm) {\n      dom.remove(marker);\n      selection.select(parentEditableFalseElm);\n      return;\n    }\n\n    var rng = dom.createRng();\n    var node = marker.previousSibling;\n\n    if (node && node.nodeType === 3) {\n      rng.setStart(node, node.nodeValue.length);\n\n      if (!Env.ie) {\n        node2 = marker.nextSibling;\n\n        if (node2 && node2.nodeType === 3) {\n          node.appendData(node2.data);\n          node2.parentNode.removeChild(node2);\n        }\n      }\n    } else {\n      rng.setStartBefore(marker);\n      rng.setEndBefore(marker);\n    }\n\n    var findNextCaretRng = function (rng) {\n      var caretPos = CaretPosition$1.fromRangeStart(rng);\n      var caretWalker = CaretWalker(editor.getBody());\n      caretPos = caretWalker.next(caretPos);\n\n      if (caretPos) {\n        return caretPos.toRange();\n      }\n    };\n\n    var parentBlock = dom.getParent(marker, dom.isBlock);\n    dom.remove(marker);\n\n    if (parentBlock && dom.isEmpty(parentBlock)) {\n      editor.$(parentBlock).empty();\n      rng.setStart(parentBlock, 0);\n      rng.setEnd(parentBlock, 0);\n\n      if (!isTableCell$4(parentBlock) && !isPartOfFragment(parentBlock) && (nextRng = findNextCaretRng(rng))) {\n        rng = nextRng;\n        dom.remove(parentBlock);\n      } else {\n        dom.add(parentBlock, dom.create('br', {\n          'data-mce-bogus': '1'\n        }));\n      }\n    }\n\n    selection.setRng(rng);\n  };\n\n  var deleteSelectedContent = function (editor) {\n    var dom = editor.dom;\n    var rng = normalize$2(editor.selection.getRng());\n    editor.selection.setRng(rng);\n    var startCell = dom.getParent(rng.startContainer, isTableCell$4);\n\n    if (isTableCellContentSelected(dom, rng, startCell)) {\n      deleteCellContents(editor, rng, SugarElement.fromDom(startCell));\n    } else {\n      editor.getDoc().execCommand('Delete', false, null);\n    }\n  };\n\n  var insertHtmlAtCaret = function (editor, value, details) {\n    var parentNode, rootNode, args;\n    var marker, rng, node;\n    var selection = editor.selection,\n        dom = editor.dom;\n\n    if (/^ | $/.test(value)) {\n      value = trimOrPadLeftRight(dom, selection.getRng(), value);\n    }\n\n    var parser = editor.parser;\n    var merge = details.merge;\n    var serializer = HtmlSerializer({\n      validate: shouldValidate(editor)\n    }, editor.schema);\n    var bookmarkHtml = '<span id=\"mce_marker\" data-mce-type=\"bookmark\">&#xFEFF;</span>';\n    args = {\n      content: value,\n      format: 'html',\n      selection: true,\n      paste: details.paste\n    };\n    args = editor.fire('BeforeSetContent', args);\n\n    if (args.isDefaultPrevented()) {\n      editor.fire('SetContent', {\n        content: args.content,\n        format: 'html',\n        selection: true,\n        paste: details.paste\n      });\n      return;\n    }\n\n    value = args.content;\n\n    if (value.indexOf('{$caret}') === -1) {\n      value += '{$caret}';\n    }\n\n    value = value.replace(/\\{\\$caret\\}/, bookmarkHtml);\n    rng = selection.getRng();\n    var caretElement = rng.startContainer || (rng.parentElement ? rng.parentElement() : null);\n    var body = editor.getBody();\n\n    if (caretElement === body && selection.isCollapsed()) {\n      if (dom.isBlock(body.firstChild) && canHaveChildren(editor, body.firstChild) && dom.isEmpty(body.firstChild)) {\n        rng = dom.createRng();\n        rng.setStart(body.firstChild, 0);\n        rng.setEnd(body.firstChild, 0);\n        selection.setRng(rng);\n      }\n    }\n\n    if (!selection.isCollapsed()) {\n      deleteSelectedContent(editor);\n    }\n\n    parentNode = selection.getNode();\n    var parserArgs = {\n      context: parentNode.nodeName.toLowerCase(),\n      data: details.data,\n      insert: true\n    };\n    var fragment = parser.parse(value, parserArgs);\n\n    if (details.paste === true && isListFragment(editor.schema, fragment) && isParentBlockLi(dom, parentNode)) {\n      rng = insertAtCaret(serializer, dom, selection.getRng(), fragment);\n      selection.setRng(rng);\n      editor.fire('SetContent', args);\n      return;\n    }\n\n    markFragmentElements(fragment);\n    node = fragment.lastChild;\n\n    if (node.attr('id') === 'mce_marker') {\n      marker = node;\n\n      for (node = node.prev; node; node = node.walk(true)) {\n        if (node.type === 3 || !dom.isBlock(node.name)) {\n          if (editor.schema.isValidChild(node.parent.name, 'span')) {\n            node.parent.insert(marker, node, node.name === 'br');\n          }\n\n          break;\n        }\n      }\n    }\n\n    editor._selectionOverrides.showBlockCaretContainer(parentNode);\n\n    if (!parserArgs.invalid) {\n      value = serializer.serialize(fragment);\n      validInsertion(editor, value, parentNode);\n    } else {\n      editor.selection.setContent(bookmarkHtml);\n      parentNode = selection.getNode();\n      rootNode = editor.getBody();\n\n      if (parentNode.nodeType === 9) {\n        parentNode = node = rootNode;\n      } else {\n        node = parentNode;\n      }\n\n      while (node !== rootNode) {\n        parentNode = node;\n        node = node.parentNode;\n      }\n\n      value = parentNode === rootNode ? rootNode.innerHTML : dom.getOuterHTML(parentNode);\n      value = serializer.serialize(parser.parse(value.replace(/<span (id=\"mce_marker\"|id=mce_marker).+?<\\/span>/i, function () {\n        return serializer.serialize(fragment);\n      })));\n\n      if (parentNode === rootNode) {\n        dom.setHTML(rootNode, value);\n      } else {\n        dom.setOuterHTML(parentNode, value);\n      }\n    }\n\n    reduceInlineTextElements(editor, merge);\n    moveSelectionToMarker(editor, dom.get('mce_marker'));\n    unmarkFragmentElements(editor.getBody());\n    trimBrsFromTableCell(dom, selection.getStart());\n    editor.fire('SetContent', args);\n    editor.addVisual();\n  };\n\n  var traverse = function (node, fn) {\n    fn(node);\n\n    if (node.firstChild) {\n      traverse(node.firstChild, fn);\n    }\n\n    if (node.next) {\n      traverse(node.next, fn);\n    }\n  };\n\n  var findMatchingNodes = function (nodeFilters, attributeFilters, node) {\n    var nodeMatches = {};\n    var attrMatches = {};\n    var matches = [];\n\n    if (node.firstChild) {\n      traverse(node.firstChild, function (node) {\n        each(nodeFilters, function (filter) {\n          if (filter.name === node.name) {\n            if (nodeMatches[filter.name]) {\n              nodeMatches[filter.name].nodes.push(node);\n            } else {\n              nodeMatches[filter.name] = {\n                filter: filter,\n                nodes: [node]\n              };\n            }\n          }\n        });\n        each(attributeFilters, function (filter) {\n          if (typeof node.attr(filter.name) === 'string') {\n            if (attrMatches[filter.name]) {\n              attrMatches[filter.name].nodes.push(node);\n            } else {\n              attrMatches[filter.name] = {\n                filter: filter,\n                nodes: [node]\n              };\n            }\n          }\n        });\n      });\n    }\n\n    for (var name_1 in nodeMatches) {\n      if (nodeMatches.hasOwnProperty(name_1)) {\n        matches.push(nodeMatches[name_1]);\n      }\n    }\n\n    for (var name_2 in attrMatches) {\n      if (attrMatches.hasOwnProperty(name_2)) {\n        matches.push(attrMatches[name_2]);\n      }\n    }\n\n    return matches;\n  };\n\n  var filter$3 = function (nodeFilters, attributeFilters, node) {\n    var matches = findMatchingNodes(nodeFilters, attributeFilters, node);\n    each(matches, function (match) {\n      each(match.filter.callbacks, function (callback) {\n        callback(match.nodes, match.filter.name, {});\n      });\n    });\n  };\n\n  var defaultFormat = 'html';\n\n  var isTreeNode = function (content) {\n    return content instanceof AstNode;\n  };\n\n  var moveSelection = function (editor) {\n    if (hasFocus$1(editor)) {\n      firstPositionIn(editor.getBody()).each(function (pos) {\n        var node = pos.getNode();\n        var caretPos = isTable(node) ? firstPositionIn(node).getOr(pos) : pos;\n        editor.selection.setRng(caretPos.toRange());\n      });\n    }\n  };\n\n  var setEditorHtml = function (editor, html) {\n    editor.dom.setHTML(editor.getBody(), html);\n    moveSelection(editor);\n  };\n\n  var setContentString = function (editor, body, content, args) {\n    var forcedRootBlockName, padd;\n\n    if (content.length === 0 || /^\\s+$/.test(content)) {\n      padd = '<br data-mce-bogus=\"1\">';\n\n      if (body.nodeName === 'TABLE') {\n        content = '<tr><td>' + padd + '</td></tr>';\n      } else if (/^(UL|OL)$/.test(body.nodeName)) {\n        content = '<li>' + padd + '</li>';\n      }\n\n      forcedRootBlockName = getForcedRootBlock(editor);\n\n      if (forcedRootBlockName && editor.schema.isValidChild(body.nodeName.toLowerCase(), forcedRootBlockName.toLowerCase())) {\n        content = padd;\n        content = editor.dom.createHTML(forcedRootBlockName, getForcedRootBlockAttrs(editor), content);\n      } else if (!content) {\n        content = '<br data-mce-bogus=\"1\">';\n      }\n\n      setEditorHtml(editor, content);\n      editor.fire('SetContent', args);\n    } else {\n      if (args.format !== 'raw') {\n        content = HtmlSerializer({\n          validate: editor.validate\n        }, editor.schema).serialize(editor.parser.parse(content, {\n          isRootContent: true,\n          insert: true\n        }));\n      }\n\n      args.content = isWsPreserveElement(SugarElement.fromDom(body)) ? content : Tools.trim(content);\n      setEditorHtml(editor, args.content);\n\n      if (!args.no_events) {\n        editor.fire('SetContent', args);\n      }\n    }\n\n    return args.content;\n  };\n\n  var setContentTree = function (editor, body, content, args) {\n    filter$3(editor.parser.getNodeFilters(), editor.parser.getAttributeFilters(), content);\n    var html = HtmlSerializer({\n      validate: editor.validate\n    }, editor.schema).serialize(content);\n    args.content = isWsPreserveElement(SugarElement.fromDom(body)) ? html : Tools.trim(html);\n    setEditorHtml(editor, args.content);\n\n    if (!args.no_events) {\n      editor.fire('SetContent', args);\n    }\n\n    return content;\n  };\n\n  var setContentInternal = function (editor, content, args) {\n    args.format = args.format ? args.format : defaultFormat;\n    args.set = true;\n    args.content = isTreeNode(content) ? '' : content;\n\n    if (!isTreeNode(content) && !args.no_events) {\n      editor.fire('BeforeSetContent', args);\n      content = args.content;\n    }\n\n    return Optional.from(editor.getBody()).fold(constant(content), function (body) {\n      return isTreeNode(content) ? setContentTree(editor, body, content, args) : setContentString(editor, body, content, args);\n    });\n  };\n\n  var isEq$2 = isEq;\n\n  var matchesUnInheritedFormatSelector = function (ed, node, name) {\n    var formatList = ed.formatter.get(name);\n\n    if (formatList) {\n      for (var i = 0; i < formatList.length; i++) {\n        if (formatList[i].inherit === false && ed.dom.is(node, formatList[i].selector)) {\n          return true;\n        }\n      }\n    }\n\n    return false;\n  };\n\n  var matchParents = function (editor, node, name, vars) {\n    var root = editor.dom.getRoot();\n\n    if (node === root) {\n      return false;\n    }\n\n    node = editor.dom.getParent(node, function (node) {\n      if (matchesUnInheritedFormatSelector(editor, node, name)) {\n        return true;\n      }\n\n      return node.parentNode === root || !!matchNode(editor, node, name, vars, true);\n    });\n    return matchNode(editor, node, name, vars);\n  };\n\n  var matchName = function (dom, node, format) {\n    if (isEq$2(node, format.inline)) {\n      return true;\n    }\n\n    if (isEq$2(node, format.block)) {\n      return true;\n    }\n\n    if (format.selector) {\n      return node.nodeType === 1 && dom.is(node, format.selector);\n    }\n  };\n\n  var matchItems = function (dom, node, format, itemName, similar, vars) {\n    var key, value;\n    var items = format[itemName];\n    var i;\n\n    if (format.onmatch) {\n      return format.onmatch(node, format, itemName);\n    }\n\n    if (items) {\n      if (typeof items.length === 'undefined') {\n        for (key in items) {\n          if (items.hasOwnProperty(key)) {\n            if (itemName === 'attributes') {\n              value = dom.getAttrib(node, key);\n            } else {\n              value = getStyle(dom, node, key);\n            }\n\n            if (similar && !value && !format.exact) {\n              return;\n            }\n\n            if ((!similar || format.exact) && !isEq$2(value, normalizeStyleValue(dom, replaceVars(items[key], vars), key))) {\n              return;\n            }\n          }\n        }\n      } else {\n        for (i = 0; i < items.length; i++) {\n          if (itemName === 'attributes' ? dom.getAttrib(node, items[i]) : getStyle(dom, node, items[i])) {\n            return format;\n          }\n        }\n      }\n    }\n\n    return format;\n  };\n\n  var matchNode = function (ed, node, name, vars, similar) {\n    var formatList = ed.formatter.get(name);\n    var format, i, x, classes;\n    var dom = ed.dom;\n\n    if (formatList && node) {\n      for (i = 0; i < formatList.length; i++) {\n        format = formatList[i];\n\n        if (matchName(ed.dom, node, format) && matchItems(dom, node, format, 'attributes', similar, vars) && matchItems(dom, node, format, 'styles', similar, vars)) {\n          if (classes = format.classes) {\n            for (x = 0; x < classes.length; x++) {\n              if (!ed.dom.hasClass(node, classes[x])) {\n                return;\n              }\n            }\n          }\n\n          return format;\n        }\n      }\n    }\n  };\n\n  var match = function (editor, name, vars, node) {\n    if (node) {\n      return matchParents(editor, node, name, vars);\n    }\n\n    node = editor.selection.getNode();\n\n    if (matchParents(editor, node, name, vars)) {\n      return true;\n    }\n\n    var startNode = editor.selection.getStart();\n\n    if (startNode !== node) {\n      if (matchParents(editor, startNode, name, vars)) {\n        return true;\n      }\n    }\n\n    return false;\n  };\n\n  var matchAll = function (editor, names, vars) {\n    var matchedFormatNames = [];\n    var checkedMap = {};\n    var startElement = editor.selection.getStart();\n    editor.dom.getParent(startElement, function (node) {\n      for (var i = 0; i < names.length; i++) {\n        var name_1 = names[i];\n\n        if (!checkedMap[name_1] && matchNode(editor, node, name_1, vars)) {\n          checkedMap[name_1] = true;\n          matchedFormatNames.push(name_1);\n        }\n      }\n    }, editor.dom.getRoot());\n    return matchedFormatNames;\n  };\n\n  var canApply = function (editor, name) {\n    var formatList = editor.formatter.get(name);\n    var startNode, parents, i, x, selector;\n    var dom = editor.dom;\n\n    if (formatList) {\n      startNode = editor.selection.getStart();\n      parents = getParents$1(dom, startNode);\n\n      for (x = formatList.length - 1; x >= 0; x--) {\n        selector = formatList[x].selector;\n\n        if (!selector || formatList[x].defaultBlock) {\n          return true;\n        }\n\n        for (i = parents.length - 1; i >= 0; i--) {\n          if (dom.is(parents[i], selector)) {\n            return true;\n          }\n        }\n      }\n    }\n\n    return false;\n  };\n\n  var matchAllOnNode = function (editor, node, formatNames) {\n    return foldl(formatNames, function (acc, name) {\n      var matchSimilar = isVariableFormatName(editor, name);\n\n      if (editor.formatter.matchNode(node, name, {}, matchSimilar)) {\n        return acc.concat([name]);\n      } else {\n        return acc;\n      }\n    }, []);\n  };\n\n  var ZWSP$1 = ZWSP,\n      CARET_ID$1 = '_mce_caret';\n\n  var importNode = function (ownerDocument, node) {\n    return ownerDocument.importNode(node, true);\n  };\n\n  var getEmptyCaretContainers = function (node) {\n    var nodes = [];\n\n    while (node) {\n      if (node.nodeType === 3 && node.nodeValue !== ZWSP$1 || node.childNodes.length > 1) {\n        return [];\n      }\n\n      if (node.nodeType === 1) {\n        nodes.push(node);\n      }\n\n      node = node.firstChild;\n    }\n\n    return nodes;\n  };\n\n  var isCaretContainerEmpty = function (node) {\n    return getEmptyCaretContainers(node).length > 0;\n  };\n\n  var findFirstTextNode = function (node) {\n    if (node) {\n      var walker = new DomTreeWalker(node, node);\n\n      for (node = walker.current(); node; node = walker.next()) {\n        if (isText$1(node)) {\n          return node;\n        }\n      }\n    }\n\n    return null;\n  };\n\n  var createCaretContainer = function (fill) {\n    var caretContainer = SugarElement.fromTag('span');\n    setAll(caretContainer, {\n      'id': CARET_ID$1,\n      'data-mce-bogus': '1',\n      'data-mce-type': 'format-caret'\n    });\n\n    if (fill) {\n      append(caretContainer, SugarElement.fromText(ZWSP$1));\n    }\n\n    return caretContainer;\n  };\n\n  var trimZwspFromCaretContainer = function (caretContainerNode) {\n    var textNode = findFirstTextNode(caretContainerNode);\n\n    if (textNode && textNode.nodeValue.charAt(0) === ZWSP$1) {\n      textNode.deleteData(0, 1);\n    }\n\n    return textNode;\n  };\n\n  var removeCaretContainerNode = function (editor, node, moveCaret) {\n    if (moveCaret === void 0) {\n      moveCaret = true;\n    }\n\n    var dom = editor.dom,\n        selection = editor.selection;\n\n    if (isCaretContainerEmpty(node)) {\n      deleteElement(editor, false, SugarElement.fromDom(node), moveCaret);\n    } else {\n      var rng = selection.getRng();\n      var block = dom.getParent(node, dom.isBlock);\n      var startContainer = rng.startContainer;\n      var startOffset = rng.startOffset;\n      var endContainer = rng.endContainer;\n      var endOffset = rng.endOffset;\n      var textNode = trimZwspFromCaretContainer(node);\n      dom.remove(node, true);\n\n      if (startContainer === textNode && startOffset > 0) {\n        rng.setStart(textNode, startOffset - 1);\n      }\n\n      if (endContainer === textNode && endOffset > 0) {\n        rng.setEnd(textNode, endOffset - 1);\n      }\n\n      if (block && dom.isEmpty(block)) {\n        fillWithPaddingBr(SugarElement.fromDom(block));\n      }\n\n      selection.setRng(rng);\n    }\n  };\n\n  var removeCaretContainer = function (editor, node, moveCaret) {\n    if (moveCaret === void 0) {\n      moveCaret = true;\n    }\n\n    var dom = editor.dom,\n        selection = editor.selection;\n\n    if (!node) {\n      node = getParentCaretContainer(editor.getBody(), selection.getStart());\n\n      if (!node) {\n        while (node = dom.get(CARET_ID$1)) {\n          removeCaretContainerNode(editor, node, false);\n        }\n      }\n    } else {\n      removeCaretContainerNode(editor, node, moveCaret);\n    }\n  };\n\n  var insertCaretContainerNode = function (editor, caretContainer, formatNode) {\n    var dom = editor.dom,\n        block = dom.getParent(formatNode, curry(isTextBlock$1, editor));\n\n    if (block && dom.isEmpty(block)) {\n      formatNode.parentNode.replaceChild(caretContainer, formatNode);\n    } else {\n      removeTrailingBr(SugarElement.fromDom(formatNode));\n\n      if (dom.isEmpty(formatNode)) {\n        formatNode.parentNode.replaceChild(caretContainer, formatNode);\n      } else {\n        dom.insertAfter(caretContainer, formatNode);\n      }\n    }\n  };\n\n  var appendNode = function (parentNode, node) {\n    parentNode.appendChild(node);\n    return node;\n  };\n\n  var insertFormatNodesIntoCaretContainer = function (formatNodes, caretContainer) {\n    var innerMostFormatNode = foldr(formatNodes, function (parentNode, formatNode) {\n      return appendNode(parentNode, formatNode.cloneNode(false));\n    }, caretContainer);\n    return appendNode(innerMostFormatNode, innerMostFormatNode.ownerDocument.createTextNode(ZWSP$1));\n  };\n\n  var cleanFormatNode = function (editor, caretContainer, formatNode, name, vars, similar) {\n    var formatter = editor.formatter;\n    var dom = editor.dom;\n    var validFormats = filter(keys(formatter.get()), function (formatName) {\n      return formatName !== name && !contains$1(formatName, 'removeformat');\n    });\n    var matchedFormats = matchAllOnNode(editor, formatNode, validFormats);\n    var uniqueFormats = filter(matchedFormats, function (fmtName) {\n      return !areSimilarFormats(editor, fmtName, name);\n    });\n\n    if (uniqueFormats.length > 0) {\n      var clonedFormatNode = formatNode.cloneNode(false);\n      dom.add(caretContainer, clonedFormatNode);\n      formatter.remove(name, vars, clonedFormatNode, similar);\n      dom.remove(clonedFormatNode);\n      return Optional.some(clonedFormatNode);\n    } else {\n      return Optional.none();\n    }\n  };\n\n  var applyCaretFormat = function (editor, name, vars) {\n    var caretContainer, textNode;\n    var selection = editor.selection;\n    var selectionRng = selection.getRng();\n    var offset = selectionRng.startOffset;\n    var container = selectionRng.startContainer;\n    var text = container.nodeValue;\n    caretContainer = getParentCaretContainer(editor.getBody(), selection.getStart());\n\n    if (caretContainer) {\n      textNode = findFirstTextNode(caretContainer);\n    }\n\n    var wordcharRegex = /[^\\s\\u00a0\\u00ad\\u200b\\ufeff]/;\n\n    if (text && offset > 0 && offset < text.length && wordcharRegex.test(text.charAt(offset)) && wordcharRegex.test(text.charAt(offset - 1))) {\n      var bookmark = selection.getBookmark();\n      selectionRng.collapse(true);\n      var rng = expandRng(editor, selectionRng, editor.formatter.get(name));\n      rng = split$1(rng);\n      editor.formatter.apply(name, vars, rng);\n      selection.moveToBookmark(bookmark);\n    } else {\n      if (!caretContainer || textNode.nodeValue !== ZWSP$1) {\n        caretContainer = importNode(editor.getDoc(), createCaretContainer(true).dom);\n        textNode = caretContainer.firstChild;\n        selectionRng.insertNode(caretContainer);\n        offset = 1;\n        editor.formatter.apply(name, vars, caretContainer);\n      } else {\n        editor.formatter.apply(name, vars, caretContainer);\n      }\n\n      selection.setCursorLocation(textNode, offset);\n    }\n  };\n\n  var removeCaretFormat = function (editor, name, vars, similar) {\n    var dom = editor.dom;\n    var selection = editor.selection;\n    var hasContentAfter, node, formatNode;\n    var parents = [];\n    var rng = selection.getRng();\n    var container = rng.startContainer;\n    var offset = rng.startOffset;\n    node = container;\n\n    if (container.nodeType === 3) {\n      if (offset !== container.nodeValue.length) {\n        hasContentAfter = true;\n      }\n\n      node = node.parentNode;\n    }\n\n    while (node) {\n      if (matchNode(editor, node, name, vars, similar)) {\n        formatNode = node;\n        break;\n      }\n\n      if (node.nextSibling) {\n        hasContentAfter = true;\n      }\n\n      parents.push(node);\n      node = node.parentNode;\n    }\n\n    if (!formatNode) {\n      return;\n    }\n\n    if (hasContentAfter) {\n      var bookmark = selection.getBookmark();\n      rng.collapse(true);\n      var expandedRng = expandRng(editor, rng, editor.formatter.get(name), true);\n      expandedRng = split$1(expandedRng);\n      editor.formatter.remove(name, vars, expandedRng, similar);\n      selection.moveToBookmark(bookmark);\n    } else {\n      var caretContainer = getParentCaretContainer(editor.getBody(), formatNode);\n      var newCaretContainer = createCaretContainer(false).dom;\n      insertCaretContainerNode(editor, newCaretContainer, caretContainer !== null ? caretContainer : formatNode);\n      var cleanedFormatNode = cleanFormatNode(editor, newCaretContainer, formatNode, name, vars, similar);\n      var caretTextNode = insertFormatNodesIntoCaretContainer(parents.concat(cleanedFormatNode.toArray()), newCaretContainer);\n      removeCaretContainerNode(editor, caretContainer, false);\n      selection.setCursorLocation(caretTextNode, 1);\n\n      if (dom.isEmpty(formatNode)) {\n        dom.remove(formatNode);\n      }\n    }\n  };\n\n  var disableCaretContainer = function (editor, keyCode) {\n    var selection = editor.selection,\n        body = editor.getBody();\n    removeCaretContainer(editor, null, false);\n\n    if ((keyCode === 8 || keyCode === 46) && selection.isCollapsed() && selection.getStart().innerHTML === ZWSP$1) {\n      removeCaretContainer(editor, getParentCaretContainer(body, selection.getStart()));\n    }\n\n    if (keyCode === 37 || keyCode === 39) {\n      removeCaretContainer(editor, getParentCaretContainer(body, selection.getStart()));\n    }\n  };\n\n  var setup$3 = function (editor) {\n    editor.on('mouseup keydown', function (e) {\n      disableCaretContainer(editor, e.keyCode);\n    });\n  };\n\n  var replaceWithCaretFormat = function (targetNode, formatNodes) {\n    var caretContainer = createCaretContainer(false);\n    var innerMost = insertFormatNodesIntoCaretContainer(formatNodes, caretContainer.dom);\n    before(SugarElement.fromDom(targetNode), caretContainer);\n    remove(SugarElement.fromDom(targetNode));\n    return CaretPosition$1(innerMost, 0);\n  };\n\n  var isFormatElement = function (editor, element) {\n    var inlineElements = editor.schema.getTextInlineElements();\n    return inlineElements.hasOwnProperty(name(element)) && !isCaretNode(element.dom) && !isBogus(element.dom);\n  };\n\n  var isEmptyCaretFormatElement = function (element) {\n    return isCaretNode(element.dom) && isCaretContainerEmpty(element.dom);\n  };\n\n  var postProcessHooks = {};\n  var filter$4 = filter$2;\n  var each$8 = each$2;\n\n  var addPostProcessHook = function (name, hook) {\n    var hooks = postProcessHooks[name];\n\n    if (!hooks) {\n      postProcessHooks[name] = [];\n    }\n\n    postProcessHooks[name].push(hook);\n  };\n\n  var postProcess = function (name, editor) {\n    each$8(postProcessHooks[name], function (hook) {\n      hook(editor);\n    });\n  };\n\n  addPostProcessHook('pre', function (editor) {\n    var rng = editor.selection.getRng();\n    var blocks;\n\n    var hasPreSibling = function (pre) {\n      return isPre(pre.previousSibling) && indexOf$1(blocks, pre.previousSibling) !== -1;\n    };\n\n    var joinPre = function (pre1, pre2) {\n      DomQuery(pre2).remove();\n      DomQuery(pre1).append('<br><br>').append(pre2.childNodes);\n    };\n\n    var isPre = matchNodeNames(['pre']);\n\n    if (!rng.collapsed) {\n      blocks = editor.selection.getSelectedBlocks();\n      each$8(filter$4(filter$4(blocks, isPre), hasPreSibling), function (pre) {\n        joinPre(pre.previousSibling, pre);\n      });\n    }\n  });\n  var each$9 = Tools.each;\n\n  var isElementNode = function (node) {\n    return isElement$1(node) && !isBookmarkNode$1(node) && !isCaretNode(node) && !isBogus(node);\n  };\n\n  var findElementSibling = function (node, siblingName) {\n    var sibling;\n\n    for (sibling = node; sibling; sibling = sibling[siblingName]) {\n      if (isText$1(sibling) && sibling.nodeValue.length !== 0) {\n        return node;\n      }\n\n      if (isElement$1(sibling) && !isBookmarkNode$1(sibling)) {\n        return sibling;\n      }\n    }\n\n    return node;\n  };\n\n  var mergeSiblingsNodes = function (dom, prev, next) {\n    var sibling, tmpSibling;\n    var elementUtils = new ElementUtils(dom);\n\n    if (prev && next) {\n      prev = findElementSibling(prev, 'previousSibling');\n      next = findElementSibling(next, 'nextSibling');\n\n      if (elementUtils.compare(prev, next)) {\n        for (sibling = prev.nextSibling; sibling && sibling !== next;) {\n          tmpSibling = sibling;\n          sibling = sibling.nextSibling;\n          prev.appendChild(tmpSibling);\n        }\n\n        dom.remove(next);\n        Tools.each(Tools.grep(next.childNodes), function (node) {\n          prev.appendChild(node);\n        });\n        return prev;\n      }\n    }\n\n    return next;\n  };\n\n  var mergeSiblings = function (dom, format, vars, node) {\n    if (node && format.merge_siblings !== false) {\n      var newNode = mergeSiblingsNodes(dom, getNonWhiteSpaceSibling(node), node);\n      mergeSiblingsNodes(dom, newNode, getNonWhiteSpaceSibling(newNode, true));\n    }\n  };\n\n  var clearChildStyles = function (dom, format, node) {\n    if (format.clear_child_styles) {\n      var selector = format.links ? '*:not(a)' : '*';\n      each$9(dom.select(selector, node), function (node) {\n        if (isElementNode(node)) {\n          each$9(format.styles, function (value, name) {\n            dom.setStyle(node, name, '');\n          });\n        }\n      });\n    }\n  };\n\n  var processChildElements = function (node, filter, process) {\n    each$9(node.childNodes, function (node) {\n      if (isElementNode(node)) {\n        if (filter(node)) {\n          process(node);\n        }\n\n        if (node.hasChildNodes()) {\n          processChildElements(node, filter, process);\n        }\n      }\n    });\n  };\n\n  var unwrapEmptySpan = function (dom, node) {\n    if (node.nodeName === 'SPAN' && dom.getAttribs(node).length === 0) {\n      dom.remove(node, true);\n    }\n  };\n\n  var hasStyle = function (dom, name) {\n    return function (node) {\n      return !!(node && getStyle(dom, node, name));\n    };\n  };\n\n  var applyStyle = function (dom, name, value) {\n    return function (node) {\n      dom.setStyle(node, name, value);\n\n      if (node.getAttribute('style') === '') {\n        node.removeAttribute('style');\n      }\n\n      unwrapEmptySpan(dom, node);\n    };\n  };\n\n  var removeResult = Adt.generate([{\n    keep: []\n  }, {\n    rename: ['name']\n  }, {\n    removed: []\n  }]);\n  var MCE_ATTR_RE = /^(src|href|style)$/;\n  var each$a = Tools.each;\n  var isEq$3 = isEq;\n\n  var isTableCellOrRow = function (node) {\n    return /^(TR|TH|TD)$/.test(node.nodeName);\n  };\n\n  var isChildOfInlineParent = function (dom, node, parent) {\n    return dom.isChildOf(node, parent) && node !== parent && !dom.isBlock(parent);\n  };\n\n  var getContainer = function (ed, rng, start) {\n    var container, offset;\n    container = rng[start ? 'startContainer' : 'endContainer'];\n    offset = rng[start ? 'startOffset' : 'endOffset'];\n\n    if (isElement$1(container)) {\n      var lastIdx = container.childNodes.length - 1;\n\n      if (!start && offset) {\n        offset--;\n      }\n\n      container = container.childNodes[offset > lastIdx ? lastIdx : offset];\n    }\n\n    if (isText$1(container) && start && offset >= container.nodeValue.length) {\n      container = new DomTreeWalker(container, ed.getBody()).next() || container;\n    }\n\n    if (isText$1(container) && !start && offset === 0) {\n      container = new DomTreeWalker(container, ed.getBody()).prev() || container;\n    }\n\n    return container;\n  };\n\n  var normalizeTableSelection = function (node, start) {\n    var prop = start ? 'firstChild' : 'lastChild';\n\n    if (isTableCellOrRow(node) && node[prop]) {\n      var childNode = node[prop];\n\n      if (node.nodeName === 'TR') {\n        return childNode[prop] || childNode;\n      } else {\n        return childNode;\n      }\n    }\n\n    return node;\n  };\n\n  var wrap$2 = function (dom, node, name, attrs) {\n    var wrapper = dom.create(name, attrs);\n    node.parentNode.insertBefore(wrapper, node);\n    wrapper.appendChild(node);\n    return wrapper;\n  };\n\n  var wrapWithSiblings = function (dom, node, next, name, attrs) {\n    var start = SugarElement.fromDom(node);\n    var wrapper = SugarElement.fromDom(dom.create(name, attrs));\n    var siblings = next ? nextSiblings(start) : prevSiblings(start);\n    append$1(wrapper, siblings);\n\n    if (next) {\n      before(start, wrapper);\n      prepend(wrapper, start);\n    } else {\n      after(start, wrapper);\n      append(wrapper, start);\n    }\n\n    return wrapper.dom;\n  };\n\n  var matchName$1 = function (dom, node, format) {\n    if (isEq$3(node, format.inline)) {\n      return true;\n    }\n\n    if (isEq$3(node, format.block)) {\n      return true;\n    }\n\n    if (format.selector) {\n      return isElement$1(node) && dom.is(node, format.selector);\n    }\n  };\n\n  var isColorFormatAndAnchor = function (node, format) {\n    return format.links && node.nodeName === 'A';\n  };\n\n  var find$3 = function (dom, node, next, inc) {\n    node = getNonWhiteSpaceSibling(node, next, inc);\n    return !node || node.nodeName === 'BR' || dom.isBlock(node);\n  };\n\n  var removeNode$1 = function (ed, node, format) {\n    var parentNode = node.parentNode;\n    var rootBlockElm;\n    var dom = ed.dom,\n        forcedRootBlock = getForcedRootBlock(ed);\n\n    if (format.block) {\n      if (!forcedRootBlock) {\n        if (dom.isBlock(node) && !dom.isBlock(parentNode)) {\n          if (!find$3(dom, node, false) && !find$3(dom, node.firstChild, true, true)) {\n            node.insertBefore(dom.create('br'), node.firstChild);\n          }\n\n          if (!find$3(dom, node, true) && !find$3(dom, node.lastChild, false, true)) {\n            node.appendChild(dom.create('br'));\n          }\n        }\n      } else {\n        if (parentNode === dom.getRoot()) {\n          if (!format.list_block || !isEq$3(node, format.list_block)) {\n            each(from$1(node.childNodes), function (node) {\n              if (isValid(ed, forcedRootBlock, node.nodeName.toLowerCase())) {\n                if (!rootBlockElm) {\n                  rootBlockElm = wrap$2(dom, node, forcedRootBlock);\n                  dom.setAttribs(rootBlockElm, ed.settings.forced_root_block_attrs);\n                } else {\n                  rootBlockElm.appendChild(node);\n                }\n              } else {\n                rootBlockElm = 0;\n              }\n            });\n          }\n        }\n      }\n    }\n\n    if (format.selector && format.inline && !isEq$3(format.inline, node)) {\n      return;\n    }\n\n    dom.remove(node, true);\n  };\n\n  var removeFormatInternal = function (ed, format, vars, node, compareNode) {\n    var stylesModified;\n    var dom = ed.dom;\n\n    if (!matchName$1(dom, node, format) && !isColorFormatAndAnchor(node, format)) {\n      return removeResult.keep();\n    }\n\n    var elm = node;\n\n    if (format.inline && format.remove === 'all' && isArray(format.preserve_attributes)) {\n      var attrsToPreserve = filter(dom.getAttribs(elm), function (attr) {\n        return contains(format.preserve_attributes, attr.name.toLowerCase());\n      });\n      dom.removeAllAttribs(elm);\n      each(attrsToPreserve, function (attr) {\n        return dom.setAttrib(elm, attr.name, attr.value);\n      });\n\n      if (attrsToPreserve.length > 0) {\n        return removeResult.rename('span');\n      }\n    }\n\n    if (format.remove !== 'all') {\n      each$a(format.styles, function (value, name) {\n        value = normalizeStyleValue(dom, replaceVars(value, vars), name + '');\n\n        if (isNumber(name)) {\n          name = value;\n          compareNode = null;\n        }\n\n        if (format.remove_similar || !compareNode || isEq$3(getStyle(dom, compareNode, name), value)) {\n          dom.setStyle(elm, name, '');\n        }\n\n        stylesModified = true;\n      });\n\n      if (stylesModified && dom.getAttrib(elm, 'style') === '') {\n        elm.removeAttribute('style');\n        elm.removeAttribute('data-mce-style');\n      }\n\n      each$a(format.attributes, function (value, name) {\n        var valueOut;\n        value = replaceVars(value, vars);\n\n        if (isNumber(name)) {\n          name = value;\n          compareNode = null;\n        }\n\n        if (format.remove_similar || !compareNode || isEq$3(dom.getAttrib(compareNode, name), value)) {\n          if (name === 'class') {\n            value = dom.getAttrib(elm, name);\n\n            if (value) {\n              valueOut = '';\n              each(value.split(/\\s+/), function (cls) {\n                if (/mce\\-\\w+/.test(cls)) {\n                  valueOut += (valueOut ? ' ' : '') + cls;\n                }\n              });\n\n              if (valueOut) {\n                dom.setAttrib(elm, name, valueOut);\n                return;\n              }\n            }\n          }\n\n          if (name === 'class') {\n            elm.removeAttribute('className');\n          }\n\n          if (MCE_ATTR_RE.test(name)) {\n            elm.removeAttribute('data-mce-' + name);\n          }\n\n          elm.removeAttribute(name);\n        }\n      });\n      each$a(format.classes, function (value) {\n        value = replaceVars(value, vars);\n\n        if (!compareNode || dom.hasClass(compareNode, value)) {\n          dom.removeClass(elm, value);\n        }\n      });\n      var attrs = dom.getAttribs(elm);\n\n      for (var i = 0; i < attrs.length; i++) {\n        var attrName = attrs[i].nodeName;\n\n        if (attrName.indexOf('_') !== 0 && attrName.indexOf('data-') !== 0) {\n          return removeResult.keep();\n        }\n      }\n    }\n\n    if (format.remove !== 'none') {\n      removeNode$1(ed, elm, format);\n      return removeResult.removed();\n    }\n\n    return removeResult.keep();\n  };\n\n  var removeFormat = function (ed, format, vars, node, compareNode) {\n    return removeFormatInternal(ed, format, vars, node, compareNode).fold(never, function (newName) {\n      ed.dom.rename(node, newName);\n      return true;\n    }, always);\n  };\n\n  var findFormatRoot = function (editor, container, name, vars, similar) {\n    var formatRoot;\n    each(getParents$1(editor.dom, container.parentNode).reverse(), function (parent) {\n      if (!formatRoot && parent.id !== '_start' && parent.id !== '_end') {\n        var format = matchNode(editor, parent, name, vars, similar);\n\n        if (format && format.split !== false) {\n          formatRoot = parent;\n        }\n      }\n    });\n    return formatRoot;\n  };\n\n  var removeFormatFromClone = function (editor, format, vars, clone) {\n    return removeFormatInternal(editor, format, vars, clone, clone).fold(constant(clone), function (newName) {\n      var fragment = editor.dom.createFragment();\n      fragment.appendChild(clone);\n      return editor.dom.rename(clone, newName);\n    }, constant(null));\n  };\n\n  var wrapAndSplit = function (editor, formatList, formatRoot, container, target, split, format, vars) {\n    var clone, lastClone, firstClone;\n    var dom = editor.dom;\n\n    if (formatRoot) {\n      var formatRootParent = formatRoot.parentNode;\n\n      for (var parent_1 = container.parentNode; parent_1 && parent_1 !== formatRootParent; parent_1 = parent_1.parentNode) {\n        clone = dom.clone(parent_1, false);\n\n        for (var i = 0; i < formatList.length; i++) {\n          clone = removeFormatFromClone(editor, formatList[i], vars, clone);\n\n          if (clone === null) {\n            break;\n          }\n        }\n\n        if (clone) {\n          if (lastClone) {\n            clone.appendChild(lastClone);\n          }\n\n          if (!firstClone) {\n            firstClone = clone;\n          }\n\n          lastClone = clone;\n        }\n      }\n\n      if (split && (!format.mixed || !dom.isBlock(formatRoot))) {\n        container = dom.split(formatRoot, container);\n      }\n\n      if (lastClone) {\n        target.parentNode.insertBefore(lastClone, target);\n        firstClone.appendChild(target);\n\n        if (format.inline) {\n          mergeSiblings(dom, format, vars, lastClone);\n        }\n      }\n    }\n\n    return container;\n  };\n\n  var remove$6 = function (ed, name, vars, node, similar) {\n    var formatList = ed.formatter.get(name);\n    var format = formatList[0];\n    var contentEditable = true;\n    var dom = ed.dom;\n    var selection = ed.selection;\n\n    var splitToFormatRoot = function (container) {\n      var formatRoot = findFormatRoot(ed, container, name, vars, similar);\n      return wrapAndSplit(ed, formatList, formatRoot, container, container, true, format, vars);\n    };\n\n    var isRemoveBookmarkNode = function (node) {\n      return isBookmarkNode$1(node) && isElement$1(node) && (node.id === '_start' || node.id === '_end');\n    };\n\n    var process = function (node) {\n      var lastContentEditable, hasContentEditableState;\n\n      if (isElement$1(node) && dom.getContentEditable(node)) {\n        lastContentEditable = contentEditable;\n        contentEditable = dom.getContentEditable(node) === 'true';\n        hasContentEditableState = true;\n      }\n\n      var children = from$1(node.childNodes);\n\n      if (contentEditable && !hasContentEditableState) {\n        for (var i = 0; i < formatList.length; i++) {\n          if (removeFormat(ed, formatList[i], vars, node, node)) {\n            break;\n          }\n        }\n      }\n\n      if (format.deep) {\n        if (children.length) {\n          for (var i = 0; i < children.length; i++) {\n            process(children[i]);\n          }\n\n          if (hasContentEditableState) {\n            contentEditable = lastContentEditable;\n          }\n        }\n      }\n    };\n\n    var unwrap = function (start) {\n      var node = dom.get(start ? '_start' : '_end');\n      var out = node[start ? 'firstChild' : 'lastChild'];\n\n      if (isRemoveBookmarkNode(out)) {\n        out = out[start ? 'firstChild' : 'lastChild'];\n      }\n\n      if (isText$1(out) && out.data.length === 0) {\n        out = start ? node.previousSibling || node.nextSibling : node.nextSibling || node.previousSibling;\n      }\n\n      dom.remove(node, true);\n      return out;\n    };\n\n    var removeRngStyle = function (rng) {\n      var startContainer, endContainer;\n      var expandedRng = expandRng(ed, rng, formatList, true);\n\n      if (format.split) {\n        expandedRng = split$1(expandedRng);\n        startContainer = getContainer(ed, expandedRng, true);\n        endContainer = getContainer(ed, expandedRng);\n\n        if (startContainer !== endContainer) {\n          startContainer = normalizeTableSelection(startContainer, true);\n          endContainer = normalizeTableSelection(endContainer, false);\n\n          if (isChildOfInlineParent(dom, startContainer, endContainer)) {\n            var marker = Optional.from(startContainer.firstChild).getOr(startContainer);\n            splitToFormatRoot(wrapWithSiblings(dom, marker, true, 'span', {\n              'id': '_start',\n              'data-mce-type': 'bookmark'\n            }));\n            unwrap(true);\n            return;\n          }\n\n          if (isChildOfInlineParent(dom, endContainer, startContainer)) {\n            var marker = Optional.from(endContainer.lastChild).getOr(endContainer);\n            splitToFormatRoot(wrapWithSiblings(dom, marker, false, 'span', {\n              'id': '_end',\n              'data-mce-type': 'bookmark'\n            }));\n            unwrap(false);\n            return;\n          }\n\n          startContainer = wrap$2(dom, startContainer, 'span', {\n            'id': '_start',\n            'data-mce-type': 'bookmark'\n          });\n          endContainer = wrap$2(dom, endContainer, 'span', {\n            'id': '_end',\n            'data-mce-type': 'bookmark'\n          });\n          var newRng = dom.createRng();\n          newRng.setStartAfter(startContainer);\n          newRng.setEndBefore(endContainer);\n          walk$1(dom, newRng, function (nodes) {\n            each(nodes, function (n) {\n              if (!isBookmarkNode$1(n) && !isBookmarkNode$1(n.parentNode)) {\n                splitToFormatRoot(n);\n              }\n            });\n          });\n          splitToFormatRoot(startContainer);\n          splitToFormatRoot(endContainer);\n          startContainer = unwrap(true);\n          endContainer = unwrap();\n        } else {\n          startContainer = endContainer = splitToFormatRoot(startContainer);\n        }\n\n        expandedRng.startContainer = startContainer.parentNode ? startContainer.parentNode : startContainer;\n        expandedRng.startOffset = dom.nodeIndex(startContainer);\n        expandedRng.endContainer = endContainer.parentNode ? endContainer.parentNode : endContainer;\n        expandedRng.endOffset = dom.nodeIndex(endContainer) + 1;\n      }\n\n      walk$1(dom, expandedRng, function (nodes) {\n        each(nodes, function (node) {\n          process(node);\n          var textDecorations = ['underline', 'line-through', 'overline'];\n          each(textDecorations, function (decoration) {\n            if (isElement$1(node) && ed.dom.getStyle(node, 'text-decoration') === decoration && node.parentNode && getTextDecoration(dom, node.parentNode) === decoration) {\n              removeFormat(ed, {\n                deep: false,\n                exact: true,\n                inline: 'span',\n                styles: {\n                  textDecoration: decoration\n                }\n              }, null, node);\n            }\n          });\n        });\n      });\n    };\n\n    if (node) {\n      if (isNode(node)) {\n        var rng = dom.createRng();\n        rng.setStartBefore(node);\n        rng.setEndAfter(node);\n        removeRngStyle(rng);\n      } else {\n        removeRngStyle(node);\n      }\n\n      return;\n    }\n\n    if (dom.getContentEditable(selection.getNode()) === 'false') {\n      node = selection.getNode();\n\n      for (var i = 0; i < formatList.length; i++) {\n        if (formatList[i].ceFalseOverride) {\n          if (removeFormat(ed, formatList[i], vars, node, node)) {\n            break;\n          }\n        }\n      }\n\n      return;\n    }\n\n    if (!selection.isCollapsed() || !format.inline || getCellsFromEditor(ed).length) {\n      preserve(selection, true, function () {\n        runOnRanges(ed, removeRngStyle);\n      });\n\n      if (format.inline && match(ed, name, vars, selection.getStart())) {\n        moveStart(dom, selection, selection.getRng());\n      }\n\n      ed.nodeChanged();\n    } else {\n      removeCaretFormat(ed, name, vars, similar);\n    }\n  };\n\n  var each$b = Tools.each;\n\n  var mergeTextDecorationsAndColor = function (dom, format, vars, node) {\n    var processTextDecorationsAndColor = function (n) {\n      if (n.nodeType === 1 && n.parentNode && n.parentNode.nodeType === 1) {\n        var textDecoration = getTextDecoration(dom, n.parentNode);\n\n        if (dom.getStyle(n, 'color') && textDecoration) {\n          dom.setStyle(n, 'text-decoration', textDecoration);\n        } else if (dom.getStyle(n, 'text-decoration') === textDecoration) {\n          dom.setStyle(n, 'text-decoration', null);\n        }\n      }\n    };\n\n    if (format.styles && (format.styles.color || format.styles.textDecoration)) {\n      Tools.walk(node, processTextDecorationsAndColor, 'childNodes');\n      processTextDecorationsAndColor(node);\n    }\n  };\n\n  var mergeBackgroundColorAndFontSize = function (dom, format, vars, node) {\n    if (format.styles && format.styles.backgroundColor) {\n      processChildElements(node, hasStyle(dom, 'fontSize'), applyStyle(dom, 'backgroundColor', replaceVars(format.styles.backgroundColor, vars)));\n    }\n  };\n\n  var mergeSubSup = function (dom, format, vars, node) {\n    if (format.inline === 'sub' || format.inline === 'sup') {\n      processChildElements(node, hasStyle(dom, 'fontSize'), applyStyle(dom, 'fontSize', ''));\n      dom.remove(dom.select(format.inline === 'sup' ? 'sub' : 'sup', node), true);\n    }\n  };\n\n  var mergeWithChildren = function (editor, formatList, vars, node) {\n    each$b(formatList, function (format) {\n      each$b(editor.dom.select(format.inline, node), function (child) {\n        if (!isElementNode(child)) {\n          return;\n        }\n\n        removeFormat(editor, format, vars, child, format.exact ? child : null);\n      });\n      clearChildStyles(editor.dom, format, node);\n    });\n  };\n\n  var mergeWithParents = function (editor, format, name, vars, node) {\n    if (matchNode(editor, node.parentNode, name, vars)) {\n      if (removeFormat(editor, format, vars, node)) {\n        return;\n      }\n    }\n\n    if (format.merge_with_parents) {\n      editor.dom.getParent(node.parentNode, function (parent) {\n        if (matchNode(editor, parent, name, vars)) {\n          removeFormat(editor, format, vars, node);\n          return true;\n        }\n      });\n    }\n  };\n\n  var each$c = Tools.each;\n\n  var isElementNode$1 = function (node) {\n    return node && node.nodeType === 1 && !isBookmarkNode$1(node) && !isCaretNode(node) && !isBogus(node);\n  };\n\n  var applyFormat = function (ed, name, vars, node) {\n    var formatList = ed.formatter.get(name);\n    var format = formatList[0];\n    var rng;\n    var isCollapsed = !node && ed.selection.isCollapsed();\n    var dom = ed.dom,\n        selection = ed.selection;\n\n    var setElementFormat = function (elm, fmt) {\n      fmt = fmt || format;\n\n      if (elm) {\n        if (fmt.onformat) {\n          fmt.onformat(elm, fmt, vars, node);\n        }\n\n        each$c(fmt.styles, function (value, name) {\n          dom.setStyle(elm, name, replaceVars(value, vars));\n        });\n\n        if (fmt.styles) {\n          var styleVal = dom.getAttrib(elm, 'style');\n\n          if (styleVal) {\n            dom.setAttrib(elm, 'data-mce-style', styleVal);\n          }\n        }\n\n        each$c(fmt.attributes, function (value, name) {\n          dom.setAttrib(elm, name, replaceVars(value, vars));\n        });\n        each$c(fmt.classes, function (value) {\n          value = replaceVars(value, vars);\n\n          if (!dom.hasClass(elm, value)) {\n            dom.addClass(elm, value);\n          }\n        });\n      }\n    };\n\n    var applyNodeStyle = function (formatList, node) {\n      var found = false;\n\n      if (!format.selector) {\n        return false;\n      }\n\n      each$c(formatList, function (format) {\n        if ('collapsed' in format && format.collapsed !== isCollapsed) {\n          return;\n        }\n\n        if (dom.is(node, format.selector) && !isCaretNode(node)) {\n          setElementFormat(node, format);\n          found = true;\n          return false;\n        }\n      });\n      return found;\n    };\n\n    var applyRngStyle = function (dom, rng, bookmark, nodeSpecific) {\n      var newWrappers = [];\n      var contentEditable = true;\n      var wrapName = format.inline || format.block;\n      var wrapElm = dom.create(wrapName);\n      setElementFormat(wrapElm);\n      walk$1(dom, rng, function (nodes) {\n        var currentWrapElm;\n\n        var process = function (node) {\n          var hasContentEditableState = false;\n          var lastContentEditable = contentEditable;\n          var nodeName = node.nodeName.toLowerCase();\n          var parentName = node.parentNode.nodeName.toLowerCase();\n\n          if (isElement$1(node) && dom.getContentEditable(node)) {\n            lastContentEditable = contentEditable;\n            contentEditable = dom.getContentEditable(node) === 'true';\n            hasContentEditableState = true;\n          }\n\n          if (isEq(nodeName, 'br')) {\n            currentWrapElm = 0;\n\n            if (format.block) {\n              dom.remove(node);\n            }\n\n            return;\n          }\n\n          if (format.wrapper && matchNode(ed, node, name, vars)) {\n            currentWrapElm = 0;\n            return;\n          }\n\n          if (contentEditable && !hasContentEditableState && format.block && !format.wrapper && isTextBlock$1(ed, nodeName) && isValid(ed, parentName, wrapName)) {\n            var elm = dom.rename(node, wrapName);\n            setElementFormat(elm);\n            newWrappers.push(elm);\n            currentWrapElm = 0;\n            return;\n          }\n\n          if (format.selector) {\n            var found = applyNodeStyle(formatList, node);\n\n            if (!format.inline || found) {\n              currentWrapElm = 0;\n              return;\n            }\n          }\n\n          if (contentEditable && !hasContentEditableState && isValid(ed, wrapName, nodeName) && isValid(ed, parentName, wrapName) && !(!nodeSpecific && node.nodeType === 3 && node.nodeValue.length === 1 && node.nodeValue.charCodeAt(0) === 65279) && !isCaretNode(node) && (!format.inline || !dom.isBlock(node))) {\n            if (!currentWrapElm) {\n              currentWrapElm = dom.clone(wrapElm, false);\n              node.parentNode.insertBefore(currentWrapElm, node);\n              newWrappers.push(currentWrapElm);\n            }\n\n            currentWrapElm.appendChild(node);\n          } else {\n            currentWrapElm = 0;\n            each$c(Tools.grep(node.childNodes), process);\n\n            if (hasContentEditableState) {\n              contentEditable = lastContentEditable;\n            }\n\n            currentWrapElm = 0;\n          }\n        };\n\n        each$c(nodes, process);\n      });\n\n      if (format.links === true) {\n        each$c(newWrappers, function (node) {\n          var process = function (node) {\n            if (node.nodeName === 'A') {\n              setElementFormat(node, format);\n            }\n\n            each$c(Tools.grep(node.childNodes), process);\n          };\n\n          process(node);\n        });\n      }\n\n      each$c(newWrappers, function (node) {\n        var getChildCount = function (node) {\n          var count = 0;\n          each$c(node.childNodes, function (node) {\n            if (!isEmptyTextNode(node) && !isBookmarkNode$1(node)) {\n              count++;\n            }\n          });\n          return count;\n        };\n\n        var getChildElementNode = function (root) {\n          var child = false;\n          each$c(root.childNodes, function (node) {\n            if (isElementNode$1(node)) {\n              child = node;\n              return false;\n            }\n          });\n          return child;\n        };\n\n        var mergeStyles = function (node) {\n          var clone;\n          var child = getChildElementNode(node);\n\n          if (child && !isBookmarkNode$1(child) && matchName(dom, child, format)) {\n            clone = dom.clone(child, false);\n            setElementFormat(clone);\n            dom.replace(clone, node, true);\n            dom.remove(child, true);\n          }\n\n          return clone || node;\n        };\n\n        var childCount = getChildCount(node);\n\n        if ((newWrappers.length > 1 || !dom.isBlock(node)) && childCount === 0) {\n          dom.remove(node, true);\n          return;\n        }\n\n        if (format.inline || format.wrapper) {\n          if (!format.exact && childCount === 1) {\n            node = mergeStyles(node);\n          }\n\n          mergeWithChildren(ed, formatList, vars, node);\n          mergeWithParents(ed, format, name, vars, node);\n          mergeBackgroundColorAndFontSize(dom, format, vars, node);\n          mergeTextDecorationsAndColor(dom, format, vars, node);\n          mergeSubSup(dom, format, vars, node);\n          mergeSiblings(dom, format, vars, node);\n        }\n      });\n    };\n\n    if (dom.getContentEditable(selection.getNode()) === 'false') {\n      node = selection.getNode();\n\n      for (var i = 0, l = formatList.length; i < l; i++) {\n        if (formatList[i].ceFalseOverride && dom.is(node, formatList[i].selector)) {\n          setElementFormat(node, formatList[i]);\n          return;\n        }\n      }\n\n      return;\n    }\n\n    if (format) {\n      if (node) {\n        if (isNode(node)) {\n          if (!applyNodeStyle(formatList, node)) {\n            rng = dom.createRng();\n            rng.setStartBefore(node);\n            rng.setEndAfter(node);\n            applyRngStyle(dom, expandRng(ed, rng, formatList), null, true);\n          }\n        } else {\n          applyRngStyle(dom, node, null, true);\n        }\n      } else {\n        if (!isCollapsed || !format.inline || getCellsFromEditor(ed).length) {\n          var curSelNode = selection.getNode();\n\n          if (!ed.settings.forced_root_block && formatList[0].defaultBlock && !dom.getParent(curSelNode, dom.isBlock)) {\n            applyFormat(ed, formatList[0].defaultBlock);\n          }\n\n          selection.setRng(normalize$2(selection.getRng()));\n          preserve(selection, true, function (bookmark) {\n            runOnRanges(ed, function (selectionRng, fake) {\n              var expandedRng = fake ? selectionRng : expandRng(ed, selectionRng, formatList);\n              applyRngStyle(dom, expandedRng);\n            });\n          });\n          moveStart(dom, selection, selection.getRng());\n          ed.nodeChanged();\n        } else {\n          applyCaretFormat(ed, name, vars);\n        }\n      }\n\n      postProcess(name, ed);\n    }\n  };\n\n  var toggle = function (editor, name, vars, node) {\n    var fmt = editor.formatter.get(name);\n\n    if (match(editor, name, vars, node) && (!('toggle' in fmt[0]) || fmt[0].toggle)) {\n      remove$6(editor, name, vars, node);\n    } else {\n      applyFormat(editor, name, vars, node);\n    }\n  };\n\n  var fromElements = function (elements, scope) {\n    var doc = scope || document;\n    var fragment = doc.createDocumentFragment();\n    each(elements, function (element) {\n      fragment.appendChild(element.dom);\n    });\n    return SugarElement.fromDom(fragment);\n  };\n\n  var tableModel = function (element, width, rows) {\n    return {\n      element: element,\n      width: width,\n      rows: rows\n    };\n  };\n\n  var tableRow = function (element, cells) {\n    return {\n      element: element,\n      cells: cells\n    };\n  };\n\n  var cellPosition = function (x, y) {\n    return {\n      x: x,\n      y: y\n    };\n  };\n\n  var getSpan = function (td, key) {\n    var value = parseInt(get$3(td, key), 10);\n    return isNaN(value) ? 1 : value;\n  };\n\n  var fillout = function (table, x, y, tr, td) {\n    var rowspan = getSpan(td, 'rowspan');\n    var colspan = getSpan(td, 'colspan');\n    var rows = table.rows;\n\n    for (var y2 = y; y2 < y + rowspan; y2++) {\n      if (!rows[y2]) {\n        rows[y2] = tableRow(deep(tr), []);\n      }\n\n      for (var x2 = x; x2 < x + colspan; x2++) {\n        var cells = rows[y2].cells;\n        cells[x2] = y2 === y && x2 === x ? td : shallow(td);\n      }\n    }\n  };\n\n  var cellExists = function (table, x, y) {\n    var rows = table.rows;\n    var cells = rows[y] ? rows[y].cells : [];\n    return !!cells[x];\n  };\n\n  var skipCellsX = function (table, x, y) {\n    while (cellExists(table, x, y)) {\n      x++;\n    }\n\n    return x;\n  };\n\n  var getWidth = function (rows) {\n    return foldl(rows, function (acc, row) {\n      return row.cells.length > acc ? row.cells.length : acc;\n    }, 0);\n  };\n\n  var findElementPos = function (table, element) {\n    var rows = table.rows;\n\n    for (var y = 0; y < rows.length; y++) {\n      var cells = rows[y].cells;\n\n      for (var x = 0; x < cells.length; x++) {\n        if (eq$2(cells[x], element)) {\n          return Optional.some(cellPosition(x, y));\n        }\n      }\n    }\n\n    return Optional.none();\n  };\n\n  var extractRows = function (table, sx, sy, ex, ey) {\n    var newRows = [];\n    var rows = table.rows;\n\n    for (var y = sy; y <= ey; y++) {\n      var cells = rows[y].cells;\n      var slice = sx < ex ? cells.slice(sx, ex + 1) : cells.slice(ex, sx + 1);\n      newRows.push(tableRow(rows[y].element, slice));\n    }\n\n    return newRows;\n  };\n\n  var subTable = function (table, startPos, endPos) {\n    var sx = startPos.x,\n        sy = startPos.y;\n    var ex = endPos.x,\n        ey = endPos.y;\n    var newRows = sy < ey ? extractRows(table, sx, sy, ex, ey) : extractRows(table, sx, ey, ex, sy);\n    return tableModel(table.element, getWidth(newRows), newRows);\n  };\n\n  var createDomTable = function (table, rows) {\n    var tableElement = shallow(table.element);\n    var tableBody = SugarElement.fromTag('tbody');\n    append$1(tableBody, rows);\n    append(tableElement, tableBody);\n    return tableElement;\n  };\n\n  var modelRowsToDomRows = function (table) {\n    return map(table.rows, function (row) {\n      var cells = map(row.cells, function (cell) {\n        var td = deep(cell);\n        remove$1(td, 'colspan');\n        remove$1(td, 'rowspan');\n        return td;\n      });\n      var tr = shallow(row.element);\n      append$1(tr, cells);\n      return tr;\n    });\n  };\n\n  var fromDom$1 = function (tableElm) {\n    var table = tableModel(shallow(tableElm), 0, []);\n    each(descendants$1(tableElm, 'tr'), function (tr, y) {\n      each(descendants$1(tr, 'td,th'), function (td, x) {\n        fillout(table, skipCellsX(table, x, y), y, tr, td);\n      });\n    });\n    return tableModel(table.element, getWidth(table.rows), table.rows);\n  };\n\n  var toDom = function (table) {\n    return createDomTable(table, modelRowsToDomRows(table));\n  };\n\n  var subsection = function (table, startElement, endElement) {\n    return findElementPos(table, startElement).bind(function (startPos) {\n      return findElementPos(table, endElement).map(function (endPos) {\n        return subTable(table, startPos, endPos);\n      });\n    });\n  };\n\n  var findParentListContainer = function (parents) {\n    return find(parents, function (elm) {\n      return name(elm) === 'ul' || name(elm) === 'ol';\n    });\n  };\n\n  var getFullySelectedListWrappers = function (parents, rng) {\n    return find(parents, function (elm) {\n      return name(elm) === 'li' && hasAllContentsSelected(elm, rng);\n    }).fold(constant([]), function (_li) {\n      return findParentListContainer(parents).map(function (listCont) {\n        var listElm = SugarElement.fromTag(name(listCont));\n        var listStyles = filter$1(getAllRaw(listCont), function (_style, name) {\n          return startsWith(name, 'list-style');\n        });\n        setAll$1(listElm, listStyles);\n        return [SugarElement.fromTag('li'), listElm];\n      }).getOr([]);\n    });\n  };\n\n  var wrap$3 = function (innerElm, elms) {\n    var wrapped = foldl(elms, function (acc, elm) {\n      append(elm, acc);\n      return elm;\n    }, innerElm);\n    return elms.length > 0 ? fromElements([wrapped]) : wrapped;\n  };\n\n  var directListWrappers = function (commonAnchorContainer) {\n    if (isListItem(commonAnchorContainer)) {\n      return parent(commonAnchorContainer).filter(isList).fold(constant([]), function (listElm) {\n        return [commonAnchorContainer, listElm];\n      });\n    } else {\n      return isList(commonAnchorContainer) ? [commonAnchorContainer] : [];\n    }\n  };\n\n  var getWrapElements = function (rootNode, rng) {\n    var commonAnchorContainer = SugarElement.fromDom(rng.commonAncestorContainer);\n    var parents = parentsAndSelf(commonAnchorContainer, rootNode);\n    var wrapElements = filter(parents, function (elm) {\n      return isInline(elm) || isHeading(elm);\n    });\n    var listWrappers = getFullySelectedListWrappers(parents, rng);\n    var allWrappers = wrapElements.concat(listWrappers.length ? listWrappers : directListWrappers(commonAnchorContainer));\n    return map(allWrappers, shallow);\n  };\n\n  var emptyFragment = function () {\n    return fromElements([]);\n  };\n\n  var getFragmentFromRange = function (rootNode, rng) {\n    return wrap$3(SugarElement.fromDom(rng.cloneContents()), getWrapElements(rootNode, rng));\n  };\n\n  var getParentTable = function (rootElm, cell) {\n    return ancestor$1(cell, 'table', curry(eq$2, rootElm));\n  };\n\n  var getTableFragment = function (rootNode, selectedTableCells) {\n    return getParentTable(rootNode, selectedTableCells[0]).bind(function (tableElm) {\n      var firstCell = selectedTableCells[0];\n      var lastCell = selectedTableCells[selectedTableCells.length - 1];\n      var fullTableModel = fromDom$1(tableElm);\n      return subsection(fullTableModel, firstCell, lastCell).map(function (sectionedTableModel) {\n        return fromElements([toDom(sectionedTableModel)]);\n      });\n    }).getOrThunk(emptyFragment);\n  };\n\n  var getSelectionFragment = function (rootNode, ranges) {\n    return ranges.length > 0 && ranges[0].collapsed ? emptyFragment() : getFragmentFromRange(rootNode, ranges[0]);\n  };\n\n  var read$1 = function (rootNode, ranges) {\n    var selectedCells = getCellsFromElementOrRanges(ranges, rootNode);\n    return selectedCells.length > 0 ? getTableFragment(rootNode, selectedCells) : getSelectionFragment(rootNode, ranges);\n  };\n\n  var trimLeadingCollapsibleText = function (text) {\n    return text.replace(/^[ \\f\\n\\r\\t\\v]+/, '');\n  };\n\n  var isCollapsibleWhitespace = function (text, index) {\n    return index >= 0 && index < text.length && isWhiteSpace$1(text.charAt(index));\n  };\n\n  var getInnerText = function (bin) {\n    var text = trim$2(bin.innerText);\n    return Env.browser.isIE() ? trimLeadingCollapsibleText(text) : text;\n  };\n\n  var getTextContent = function (editor) {\n    return Optional.from(editor.selection.getRng()).map(function (rng) {\n      var bin = editor.dom.add(editor.getBody(), 'div', {\n        'data-mce-bogus': 'all',\n        'style': 'overflow: hidden; opacity: 0;'\n      }, rng.cloneContents());\n      var text = getInnerText(bin);\n      var nonRenderedText = trim$2(bin.textContent);\n      editor.dom.remove(bin);\n\n      if (isCollapsibleWhitespace(nonRenderedText, 0) || isCollapsibleWhitespace(nonRenderedText, nonRenderedText.length - 1)) {\n        var parentBlock = editor.dom.getParent(rng.commonAncestorContainer, editor.dom.isBlock);\n        var parentBlockText = getInnerText(parentBlock);\n        var textIndex = parentBlockText.indexOf(text);\n\n        if (textIndex !== -1) {\n          var hasProceedingSpace = isCollapsibleWhitespace(parentBlockText, textIndex - 1);\n          var hasTrailingSpace = isCollapsibleWhitespace(parentBlockText, textIndex + text.length);\n          return (hasProceedingSpace ? ' ' : '') + text + (hasTrailingSpace ? ' ' : '');\n        } else {\n          return text;\n        }\n      } else {\n        return text;\n      }\n    }).getOr('');\n  };\n\n  var getSerializedContent = function (editor, args) {\n    var rng = editor.selection.getRng(),\n        tmpElm = editor.dom.create('body');\n    var sel = editor.selection.getSel();\n    var ranges = processRanges(editor, getRanges(sel));\n    var fragment = args.contextual ? read$1(SugarElement.fromDom(editor.getBody()), ranges).dom : rng.cloneContents();\n\n    if (fragment) {\n      tmpElm.appendChild(fragment);\n    }\n\n    return editor.selection.serializer.serialize(tmpElm, args);\n  };\n\n  var getSelectedContentInternal = function (editor, format, args) {\n    if (args === void 0) {\n      args = {};\n    }\n\n    args.get = true;\n    args.format = format;\n    args.selection = true;\n    args = editor.fire('BeforeGetContent', args);\n\n    if (args.isDefaultPrevented()) {\n      editor.fire('GetContent', args);\n      return args.content;\n    }\n\n    if (args.format === 'text') {\n      return getTextContent(editor);\n    } else {\n      args.getInner = true;\n      var content = getSerializedContent(editor, args);\n\n      if (args.format === 'tree') {\n        return content;\n      } else {\n        args.content = editor.selection.isCollapsed() ? '' : content;\n        editor.fire('GetContent', args);\n        return args.content;\n      }\n    }\n  };\n\n  var KEEP = 0,\n      INSERT = 1,\n      DELETE = 2;\n\n  var diff = function (left, right) {\n    var size = left.length + right.length + 2;\n    var vDown = new Array(size);\n    var vUp = new Array(size);\n\n    var snake = function (start, end, diag) {\n      return {\n        start: start,\n        end: end,\n        diag: diag\n      };\n    };\n\n    var buildScript = function (start1, end1, start2, end2, script) {\n      var middle = getMiddleSnake(start1, end1, start2, end2);\n\n      if (middle === null || middle.start === end1 && middle.diag === end1 - end2 || middle.end === start1 && middle.diag === start1 - start2) {\n        var i = start1;\n        var j = start2;\n\n        while (i < end1 || j < end2) {\n          if (i < end1 && j < end2 && left[i] === right[j]) {\n            script.push([KEEP, left[i]]);\n            ++i;\n            ++j;\n          } else {\n            if (end1 - start1 > end2 - start2) {\n              script.push([DELETE, left[i]]);\n              ++i;\n            } else {\n              script.push([INSERT, right[j]]);\n              ++j;\n            }\n          }\n        }\n      } else {\n        buildScript(start1, middle.start, start2, middle.start - middle.diag, script);\n\n        for (var i2 = middle.start; i2 < middle.end; ++i2) {\n          script.push([KEEP, left[i2]]);\n        }\n\n        buildScript(middle.end, end1, middle.end - middle.diag, end2, script);\n      }\n    };\n\n    var buildSnake = function (start, diag, end1, end2) {\n      var end = start;\n\n      while (end - diag < end2 && end < end1 && left[end] === right[end - diag]) {\n        ++end;\n      }\n\n      return snake(start, end, diag);\n    };\n\n    var getMiddleSnake = function (start1, end1, start2, end2) {\n      var m = end1 - start1;\n      var n = end2 - start2;\n\n      if (m === 0 || n === 0) {\n        return null;\n      }\n\n      var delta = m - n;\n      var sum = n + m;\n      var offset = (sum % 2 === 0 ? sum : sum + 1) / 2;\n      vDown[1 + offset] = start1;\n      vUp[1 + offset] = end1 + 1;\n      var d, k, i, x, y;\n\n      for (d = 0; d <= offset; ++d) {\n        for (k = -d; k <= d; k += 2) {\n          i = k + offset;\n\n          if (k === -d || k !== d && vDown[i - 1] < vDown[i + 1]) {\n            vDown[i] = vDown[i + 1];\n          } else {\n            vDown[i] = vDown[i - 1] + 1;\n          }\n\n          x = vDown[i];\n          y = x - start1 + start2 - k;\n\n          while (x < end1 && y < end2 && left[x] === right[y]) {\n            vDown[i] = ++x;\n            ++y;\n          }\n\n          if (delta % 2 !== 0 && delta - d <= k && k <= delta + d) {\n            if (vUp[i - delta] <= vDown[i]) {\n              return buildSnake(vUp[i - delta], k + start1 - start2, end1, end2);\n            }\n          }\n        }\n\n        for (k = delta - d; k <= delta + d; k += 2) {\n          i = k + offset - delta;\n\n          if (k === delta - d || k !== delta + d && vUp[i + 1] <= vUp[i - 1]) {\n            vUp[i] = vUp[i + 1] - 1;\n          } else {\n            vUp[i] = vUp[i - 1];\n          }\n\n          x = vUp[i] - 1;\n          y = x - start1 + start2 - k;\n\n          while (x >= start1 && y >= start2 && left[x] === right[y]) {\n            vUp[i] = x--;\n            y--;\n          }\n\n          if (delta % 2 === 0 && -d <= k && k <= d) {\n            if (vUp[i] <= vDown[i + delta]) {\n              return buildSnake(vUp[i], k + start1 - start2, end1, end2);\n            }\n          }\n        }\n      }\n    };\n\n    var script = [];\n    buildScript(0, left.length, 0, right.length, script);\n    return script;\n  };\n\n  var getOuterHtml = function (elm) {\n    if (isElement$1(elm)) {\n      return elm.outerHTML;\n    } else if (isText$1(elm)) {\n      return Entities.encodeRaw(elm.data, false);\n    } else if (isComment$1(elm)) {\n      return '<!--' + elm.data + '-->';\n    }\n\n    return '';\n  };\n\n  var createFragment$1 = function (html) {\n    var node;\n    var container = document.createElement('div');\n    var frag = document.createDocumentFragment();\n\n    if (html) {\n      container.innerHTML = html;\n    }\n\n    while (node = container.firstChild) {\n      frag.appendChild(node);\n    }\n\n    return frag;\n  };\n\n  var insertAt = function (elm, html, index) {\n    var fragment = createFragment$1(html);\n\n    if (elm.hasChildNodes() && index < elm.childNodes.length) {\n      var target = elm.childNodes[index];\n      target.parentNode.insertBefore(fragment, target);\n    } else {\n      elm.appendChild(fragment);\n    }\n  };\n\n  var removeAt = function (elm, index) {\n    if (elm.hasChildNodes() && index < elm.childNodes.length) {\n      var target = elm.childNodes[index];\n      target.parentNode.removeChild(target);\n    }\n  };\n\n  var applyDiff = function (diff, elm) {\n    var index = 0;\n    each(diff, function (action) {\n      if (action[0] === KEEP) {\n        index++;\n      } else if (action[0] === INSERT) {\n        insertAt(elm, action[1], index);\n        index++;\n      } else if (action[0] === DELETE) {\n        removeAt(elm, index);\n      }\n    });\n  };\n\n  var read$2 = function (elm) {\n    return filter(map(from$1(elm.childNodes), getOuterHtml), function (item) {\n      return item.length > 0;\n    });\n  };\n\n  var write = function (fragments, elm) {\n    var currentFragments = map(from$1(elm.childNodes), getOuterHtml);\n    applyDiff(diff(currentFragments, fragments), elm);\n    return elm;\n  };\n\n  var undoLevelDocument = Cell(Optional.none());\n\n  var lazyTempDocument = function () {\n    return undoLevelDocument.get().getOrThunk(function () {\n      var doc = document.implementation.createHTMLDocument('undo');\n      undoLevelDocument.set(Optional.some(doc));\n      return doc;\n    });\n  };\n\n  var hasIframes = function (html) {\n    return html.indexOf('</iframe>') !== -1;\n  };\n\n  var createFragmentedLevel = function (fragments) {\n    return {\n      type: 'fragmented',\n      fragments: fragments,\n      content: '',\n      bookmark: null,\n      beforeBookmark: null\n    };\n  };\n\n  var createCompleteLevel = function (content) {\n    return {\n      type: 'complete',\n      fragments: null,\n      content: content,\n      bookmark: null,\n      beforeBookmark: null\n    };\n  };\n\n  var createFromEditor = function (editor) {\n    var fragments = read$2(editor.getBody());\n    var trimmedFragments = bind(fragments, function (html) {\n      var trimmed = trimInternal(editor.serializer, html);\n      return trimmed.length > 0 ? [trimmed] : [];\n    });\n    var content = trimmedFragments.join('');\n    return hasIframes(content) ? createFragmentedLevel(trimmedFragments) : createCompleteLevel(content);\n  };\n\n  var applyToEditor = function (editor, level, before) {\n    if (level.type === 'fragmented') {\n      write(level.fragments, editor.getBody());\n    } else {\n      editor.setContent(level.content, {\n        format: 'raw'\n      });\n    }\n\n    editor.selection.moveToBookmark(before ? level.beforeBookmark : level.bookmark);\n  };\n\n  var getLevelContent = function (level) {\n    return level.type === 'fragmented' ? level.fragments.join('') : level.content;\n  };\n\n  var getCleanLevelContent = function (level) {\n    var elm = SugarElement.fromTag('body', lazyTempDocument());\n    set$1(elm, getLevelContent(level));\n    each(descendants$1(elm, '*[data-mce-bogus]'), unwrap);\n    return get$6(elm);\n  };\n\n  var hasEqualContent = function (level1, level2) {\n    return getLevelContent(level1) === getLevelContent(level2);\n  };\n\n  var hasEqualCleanedContent = function (level1, level2) {\n    return getCleanLevelContent(level1) === getCleanLevelContent(level2);\n  };\n\n  var isEq$4 = function (level1, level2) {\n    if (!level1 || !level2) {\n      return false;\n    } else if (hasEqualContent(level1, level2)) {\n      return true;\n    } else {\n      return hasEqualCleanedContent(level1, level2);\n    }\n  };\n\n  var isUnlocked = function (locks) {\n    return locks.get() === 0;\n  };\n\n  var setTyping = function (undoManager, typing, locks) {\n    if (isUnlocked(locks)) {\n      undoManager.typing = typing;\n    }\n  };\n\n  var endTyping = function (undoManager, locks) {\n    if (undoManager.typing) {\n      setTyping(undoManager, false, locks);\n      undoManager.add();\n    }\n  };\n\n  var endTypingLevelIgnoreLocks = function (undoManager) {\n    if (undoManager.typing) {\n      undoManager.typing = false;\n      undoManager.add();\n    }\n  };\n\n  var beforeChange = function (editor, locks, beforeBookmark) {\n    if (isUnlocked(locks)) {\n      beforeBookmark.set(Optional.some(getUndoBookmark(editor.selection)));\n    }\n  };\n\n  var addUndoLevel = function (editor, undoManager, index, locks, beforeBookmark, level, event) {\n    var currentLevel = createFromEditor(editor);\n    level = level || {};\n    level = Tools.extend(level, currentLevel);\n\n    if (isUnlocked(locks) === false || editor.removed) {\n      return null;\n    }\n\n    var lastLevel = undoManager.data[index.get()];\n\n    if (editor.fire('BeforeAddUndo', {\n      level: level,\n      lastLevel: lastLevel,\n      originalEvent: event\n    }).isDefaultPrevented()) {\n      return null;\n    }\n\n    if (lastLevel && isEq$4(lastLevel, level)) {\n      return null;\n    }\n\n    if (undoManager.data[index.get()]) {\n      beforeBookmark.get().each(function (bm) {\n        undoManager.data[index.get()].beforeBookmark = bm;\n      });\n    }\n\n    var customUndoRedoLevels = getCustomUndoRedoLevels(editor);\n\n    if (customUndoRedoLevels) {\n      if (undoManager.data.length > customUndoRedoLevels) {\n        for (var i = 0; i < undoManager.data.length - 1; i++) {\n          undoManager.data[i] = undoManager.data[i + 1];\n        }\n\n        undoManager.data.length--;\n        index.set(undoManager.data.length);\n      }\n    }\n\n    level.bookmark = getUndoBookmark(editor.selection);\n\n    if (index.get() < undoManager.data.length - 1) {\n      undoManager.data.length = index.get() + 1;\n    }\n\n    undoManager.data.push(level);\n    index.set(undoManager.data.length - 1);\n    var args = {\n      level: level,\n      lastLevel: lastLevel,\n      originalEvent: event\n    };\n\n    if (index.get() > 0) {\n      editor.setDirty(true);\n      editor.fire('AddUndo', args);\n      editor.fire('change', args);\n    } else {\n      editor.fire('AddUndo', args);\n    }\n\n    return level;\n  };\n\n  var clear = function (editor, undoManager, index) {\n    undoManager.data = [];\n    index.set(0);\n    undoManager.typing = false;\n    editor.fire('ClearUndos');\n  };\n\n  var extra = function (editor, undoManager, index, callback1, callback2) {\n    if (undoManager.transact(callback1)) {\n      var bookmark = undoManager.data[index.get()].bookmark;\n      var lastLevel = undoManager.data[index.get() - 1];\n      applyToEditor(editor, lastLevel, true);\n\n      if (undoManager.transact(callback2)) {\n        undoManager.data[index.get() - 1].beforeBookmark = bookmark;\n      }\n    }\n  };\n\n  var redo = function (editor, index, data) {\n    var level;\n\n    if (index.get() < data.length - 1) {\n      index.set(index.get() + 1);\n      level = data[index.get()];\n      applyToEditor(editor, level, false);\n      editor.setDirty(true);\n      editor.fire('Redo', {\n        level: level\n      });\n    }\n\n    return level;\n  };\n\n  var undo = function (editor, undoManager, locks, index) {\n    var level;\n\n    if (undoManager.typing) {\n      undoManager.add();\n      undoManager.typing = false;\n      setTyping(undoManager, false, locks);\n    }\n\n    if (index.get() > 0) {\n      index.set(index.get() - 1);\n      level = undoManager.data[index.get()];\n      applyToEditor(editor, level, true);\n      editor.setDirty(true);\n      editor.fire('Undo', {\n        level: level\n      });\n    }\n\n    return level;\n  };\n\n  var reset = function (undoManager) {\n    undoManager.clear();\n    undoManager.add();\n  };\n\n  var hasUndo = function (editor, undoManager, index) {\n    return index.get() > 0 || undoManager.typing && undoManager.data[0] && !isEq$4(createFromEditor(editor), undoManager.data[0]);\n  };\n\n  var hasRedo = function (undoManager, index) {\n    return index.get() < undoManager.data.length - 1 && !undoManager.typing;\n  };\n\n  var transact = function (undoManager, locks, callback) {\n    endTyping(undoManager, locks);\n    undoManager.beforeChange();\n    undoManager.ignore(callback);\n    return undoManager.add();\n  };\n\n  var ignore = function (locks, callback) {\n    try {\n      locks.set(locks.get() + 1);\n      callback();\n    } finally {\n      locks.set(locks.get() - 1);\n    }\n  };\n\n  var isTreeNode$1 = function (content) {\n    return content instanceof AstNode;\n  };\n\n  var runSerializerFiltersOnFragment = function (editor, fragment) {\n    filter$3(editor.serializer.getNodeFilters(), editor.serializer.getAttributeFilters(), fragment);\n  };\n\n  var getInsertContext = function (editor) {\n    return Optional.from(editor.selection.getStart(true)).map(function (elm) {\n      return elm.nodeName.toLowerCase();\n    });\n  };\n\n  var createDummyUndoLevel = function () {\n    return {\n      type: 'complete',\n      fragments: [],\n      content: '',\n      bookmark: null,\n      beforeBookmark: null\n    };\n  };\n\n  var makePlainAdaptor = function (editor) {\n    return {\n      undoManager: {\n        beforeChange: function (locks, beforeBookmark) {\n          return beforeChange(editor, locks, beforeBookmark);\n        },\n        addUndoLevel: function (undoManager, index, locks, beforeBookmark, level, event) {\n          return addUndoLevel(editor, undoManager, index, locks, beforeBookmark, level, event);\n        },\n        undo: function (undoManager, locks, index) {\n          return undo(editor, undoManager, locks, index);\n        },\n        redo: function (index, data) {\n          return redo(editor, index, data);\n        },\n        clear: function (undoManager, index) {\n          return clear(editor, undoManager, index);\n        },\n        reset: function (undoManager) {\n          return reset(undoManager);\n        },\n        hasUndo: function (undoManager, index) {\n          return hasUndo(editor, undoManager, index);\n        },\n        hasRedo: function (undoManager, index) {\n          return hasRedo(undoManager, index);\n        },\n        transact: function (undoManager, locks, callback) {\n          return transact(undoManager, locks, callback);\n        },\n        ignore: function (locks, callback) {\n          return ignore(locks, callback);\n        },\n        extra: function (undoManager, index, callback1, callback2) {\n          return extra(editor, undoManager, index, callback1, callback2);\n        }\n      },\n      formatter: {\n        apply: function (name, vars, node) {\n          return applyFormat(editor, name, vars, node);\n        },\n        remove: function (name, vars, node, similar) {\n          return remove$6(editor, name, vars, node, similar);\n        },\n        toggle: function (name, vars, node) {\n          return toggle(editor, name, vars, node);\n        }\n      },\n      editor: {\n        getContent: function (args, format) {\n          return getContentInternal(editor, args, format);\n        },\n        setContent: function (content, args) {\n          return setContentInternal(editor, content, args);\n        },\n        insertContent: function (value, details) {\n          return insertHtmlAtCaret(editor, value, details);\n        }\n      },\n      selection: {\n        getContent: function (format, args) {\n          return getSelectedContentInternal(editor, format, args);\n        }\n      },\n      raw: {\n        getModel: function () {\n          return Optional.none();\n        }\n      }\n    };\n  };\n\n  var makeRtcAdaptor = function (tinymceEditor, rtcEditor) {\n    var defaultVars = function (vars) {\n      return isObject(vars) ? vars : {};\n    };\n\n    var unsupported = die('Unimplemented feature for rtc');\n    var ignore = noop;\n    return {\n      undoManager: {\n        beforeChange: ignore,\n        addUndoLevel: unsupported,\n        undo: function () {\n          rtcEditor.undo();\n          return createDummyUndoLevel();\n        },\n        redo: function () {\n          rtcEditor.redo();\n          return createDummyUndoLevel();\n        },\n        clear: unsupported,\n        reset: unsupported,\n        hasUndo: function () {\n          return rtcEditor.hasUndo();\n        },\n        hasRedo: function () {\n          return rtcEditor.hasRedo();\n        },\n        transact: function (_undoManager, _locks, fn) {\n          rtcEditor.transact(fn);\n          return createDummyUndoLevel();\n        },\n        ignore: unsupported,\n        extra: unsupported\n      },\n      formatter: {\n        apply: function (name, vars, _node) {\n          return rtcEditor.applyFormat(name, defaultVars(vars));\n        },\n        remove: function (name, vars, _node, _similar) {\n          return rtcEditor.removeFormat(name, defaultVars(vars));\n        },\n        toggle: function (name, vars, _node) {\n          return rtcEditor.toggleFormat(name, defaultVars(vars));\n        }\n      },\n      editor: {\n        getContent: function (args, format) {\n          if (format === 'html' || format === 'tree') {\n            var fragment = rtcEditor.getContent();\n            var serializer = HtmlSerializer({\n              inner: true\n            });\n            runSerializerFiltersOnFragment(tinymceEditor, fragment);\n            return format === 'tree' ? fragment : serializer.serialize(fragment);\n          } else {\n            return makePlainAdaptor(tinymceEditor).editor.getContent(args, format);\n          }\n        },\n        setContent: function (content, _args) {\n          var fragment = isTreeNode$1(content) ? content : tinymceEditor.parser.parse(content, {\n            isRootContent: true,\n            insert: true\n          });\n          rtcEditor.setContent(fragment);\n          return content;\n        },\n        insertContent: function (value, _details) {\n          var contextArgs = getInsertContext(tinymceEditor).fold(function () {\n            return {};\n          }, function (context) {\n            return {\n              context: context\n            };\n          });\n          var fragment = isTreeNode$1(value) ? value : tinymceEditor.parser.parse(value, __assign(__assign({}, contextArgs), {\n            insert: true\n          }));\n          rtcEditor.insertContent(fragment);\n        }\n      },\n      selection: {\n        getContent: function (format, args) {\n          if (format === 'html' || format === 'tree') {\n            var fragment = rtcEditor.getSelectedContent();\n            var serializer = HtmlSerializer({});\n            runSerializerFiltersOnFragment(tinymceEditor, fragment);\n            return format === 'tree' ? fragment : serializer.serialize(fragment);\n          } else {\n            return makePlainAdaptor(tinymceEditor).selection.getContent(format, args);\n          }\n        }\n      },\n      raw: {\n        getModel: function () {\n          return Optional.some(rtcEditor.getRawModel());\n        }\n      }\n    };\n  };\n\n  var isRtc = function (editor) {\n    return has(editor.plugins, 'rtc');\n  };\n\n  var setup$4 = function (editor) {\n    var editorCast = editor;\n    return get(editor.plugins, 'rtc').fold(function () {\n      editorCast.rtcInstance = makePlainAdaptor(editor);\n      return Optional.none();\n    }, function (rtc) {\n      return Optional.some(rtc.setup().then(function (rtcEditor) {\n        editorCast.rtcInstance = makeRtcAdaptor(editor, rtcEditor);\n        return rtcEditor.isRemote;\n      }));\n    });\n  };\n\n  var getRtcInstanceWithFallback = function (editor) {\n    return editor.rtcInstance ? editor.rtcInstance : makePlainAdaptor(editor);\n  };\n\n  var getRtcInstanceWithError = function (editor) {\n    var rtcInstance = editor.rtcInstance;\n\n    if (!rtcInstance) {\n      throw new Error('Failed to get RTC instance not yet initialized.');\n    } else {\n      return rtcInstance;\n    }\n  };\n\n  var beforeChange$1 = function (editor, locks, beforeBookmark) {\n    getRtcInstanceWithError(editor).undoManager.beforeChange(locks, beforeBookmark);\n  };\n\n  var addUndoLevel$1 = function (editor, undoManager, index, locks, beforeBookmark, level, event) {\n    return getRtcInstanceWithError(editor).undoManager.addUndoLevel(undoManager, index, locks, beforeBookmark, level, event);\n  };\n\n  var undo$1 = function (editor, undoManager, locks, index) {\n    return getRtcInstanceWithError(editor).undoManager.undo(undoManager, locks, index);\n  };\n\n  var redo$1 = function (editor, index, data) {\n    return getRtcInstanceWithError(editor).undoManager.redo(index, data);\n  };\n\n  var clear$1 = function (editor, undoManager, index) {\n    getRtcInstanceWithError(editor).undoManager.clear(undoManager, index);\n  };\n\n  var reset$1 = function (editor, undoManager) {\n    getRtcInstanceWithError(editor).undoManager.reset(undoManager);\n  };\n\n  var hasUndo$1 = function (editor, undoManager, index) {\n    return getRtcInstanceWithError(editor).undoManager.hasUndo(undoManager, index);\n  };\n\n  var hasRedo$1 = function (editor, undoManager, index) {\n    return getRtcInstanceWithError(editor).undoManager.hasRedo(undoManager, index);\n  };\n\n  var transact$1 = function (editor, undoManager, locks, callback) {\n    return getRtcInstanceWithError(editor).undoManager.transact(undoManager, locks, callback);\n  };\n\n  var ignore$1 = function (editor, locks, callback) {\n    getRtcInstanceWithError(editor).undoManager.ignore(locks, callback);\n  };\n\n  var extra$1 = function (editor, undoManager, index, callback1, callback2) {\n    getRtcInstanceWithError(editor).undoManager.extra(undoManager, index, callback1, callback2);\n  };\n\n  var applyFormat$1 = function (editor, name, vars, node) {\n    getRtcInstanceWithError(editor).formatter.apply(name, vars, node);\n  };\n\n  var removeFormat$1 = function (editor, name, vars, node, similar) {\n    getRtcInstanceWithError(editor).formatter.remove(name, vars, node, similar);\n  };\n\n  var toggleFormat = function (editor, name, vars, node) {\n    getRtcInstanceWithError(editor).formatter.toggle(name, vars, node);\n  };\n\n  var getContent = function (editor, args, format) {\n    return getRtcInstanceWithFallback(editor).editor.getContent(args, format);\n  };\n\n  var setContent = function (editor, content, args) {\n    return getRtcInstanceWithFallback(editor).editor.setContent(content, args);\n  };\n\n  var insertContent = function (editor, value, details) {\n    return getRtcInstanceWithFallback(editor).editor.insertContent(value, details);\n  };\n\n  var getSelectedContent = function (editor, format, args) {\n    return getRtcInstanceWithError(editor).selection.getContent(format, args);\n  };\n\n  var getContent$1 = function (editor, args) {\n    if (args === void 0) {\n      args = {};\n    }\n\n    var format = args.format ? args.format : 'html';\n    return getSelectedContent(editor, format, args);\n  };\n\n  var removeEmpty = function (text) {\n    if (text.dom.length === 0) {\n      remove(text);\n      return Optional.none();\n    } else {\n      return Optional.some(text);\n    }\n  };\n\n  var walkPastBookmark = function (node, start) {\n    return node.filter(function (elm) {\n      return BookmarkManager$1.isBookmarkNode(elm.dom);\n    }).bind(start ? nextSibling : prevSibling);\n  };\n\n  var merge = function (outer, inner, rng, start) {\n    var outerElm = outer.dom;\n    var innerElm = inner.dom;\n    var oldLength = start ? outerElm.length : innerElm.length;\n\n    if (start) {\n      mergeTextNodes(outerElm, innerElm, false, !start);\n      rng.setStart(innerElm, oldLength);\n    } else {\n      mergeTextNodes(innerElm, outerElm, false, !start);\n      rng.setEnd(innerElm, oldLength);\n    }\n  };\n\n  var normalizeTextIfRequired = function (inner, start) {\n    parent(inner).each(function (root) {\n      var text = inner.dom;\n\n      if (start && needsToBeNbspLeft(root, CaretPosition$1(text, 0))) {\n        normalizeWhitespaceAfter(text, 0);\n      } else if (!start && needsToBeNbspRight(root, CaretPosition$1(text, text.length))) {\n        normalizeWhitespaceBefore(text, text.length);\n      }\n    });\n  };\n\n  var mergeAndNormalizeText = function (outerNode, innerNode, rng, start) {\n    outerNode.bind(function (outer) {\n      var normalizer = start ? normalizeWhitespaceBefore : normalizeWhitespaceAfter;\n      normalizer(outer.dom, start ? outer.dom.length : 0);\n      return innerNode.filter(isText).map(function (inner) {\n        return merge(outer, inner, rng, start);\n      });\n    }).orThunk(function () {\n      var innerTextNode = walkPastBookmark(innerNode, start).or(innerNode).filter(isText);\n      return innerTextNode.map(function (inner) {\n        return normalizeTextIfRequired(inner, start);\n      });\n    });\n  };\n\n  var rngSetContent = function (rng, fragment) {\n    var firstChild = Optional.from(fragment.firstChild).map(SugarElement.fromDom);\n    var lastChild = Optional.from(fragment.lastChild).map(SugarElement.fromDom);\n    rng.deleteContents();\n    rng.insertNode(fragment);\n    var prevText = firstChild.bind(prevSibling).filter(isText).bind(removeEmpty);\n    var nextText = lastChild.bind(nextSibling).filter(isText).bind(removeEmpty);\n    mergeAndNormalizeText(prevText, firstChild, rng, true);\n    mergeAndNormalizeText(nextText, lastChild, rng, false);\n    rng.collapse(false);\n  };\n\n  var setupArgs = function (args, content) {\n    return __assign(__assign({\n      format: 'html'\n    }, args), {\n      set: true,\n      selection: true,\n      content: content\n    });\n  };\n\n  var cleanContent = function (editor, args) {\n    if (args.format !== 'raw') {\n      var rng = editor.selection.getRng();\n      var contextBlock = editor.dom.getParent(rng.commonAncestorContainer, editor.dom.isBlock);\n      var contextArgs = contextBlock ? {\n        context: contextBlock.nodeName.toLowerCase()\n      } : {};\n      var node = editor.parser.parse(args.content, __assign(__assign({\n        isRootContent: true,\n        forced_root_block: false\n      }, contextArgs), args));\n      return HtmlSerializer({\n        validate: editor.validate\n      }, editor.schema).serialize(node);\n    } else {\n      return args.content;\n    }\n  };\n\n  var setContent$1 = function (editor, content, args) {\n    if (args === void 0) {\n      args = {};\n    }\n\n    var contentArgs = setupArgs(args, content);\n\n    if (!contentArgs.no_events) {\n      contentArgs = editor.fire('BeforeSetContent', contentArgs);\n\n      if (contentArgs.isDefaultPrevented()) {\n        editor.fire('SetContent', contentArgs);\n        return;\n      }\n    }\n\n    args.content = cleanContent(editor, contentArgs);\n    var rng = editor.selection.getRng();\n    rngSetContent(rng, rng.createContextualFragment(args.content));\n    editor.selection.setRng(rng);\n    scrollRangeIntoView(editor, rng);\n\n    if (!contentArgs.no_events) {\n      editor.fire('SetContent', contentArgs);\n    }\n  };\n\n  var deleteFromCallbackMap = function (callbackMap, selector, callback) {\n    if (callbackMap && callbackMap.hasOwnProperty(selector)) {\n      var newCallbacks = filter(callbackMap[selector], function (cb) {\n        return cb !== callback;\n      });\n\n      if (newCallbacks.length === 0) {\n        delete callbackMap[selector];\n      } else {\n        callbackMap[selector] = newCallbacks;\n      }\n    }\n  };\n\n  function SelectorChanged(dom, editor) {\n    var selectorChangedData;\n    var currentSelectors;\n    return {\n      selectorChangedWithUnbind: function (selector, callback) {\n        if (!selectorChangedData) {\n          selectorChangedData = {};\n          currentSelectors = {};\n          editor.on('NodeChange', function (e) {\n            var node = e.element,\n                parents = dom.getParents(node, null, dom.getRoot()),\n                matchedSelectors = {};\n            Tools.each(selectorChangedData, function (callbacks, selector) {\n              Tools.each(parents, function (node) {\n                if (dom.is(node, selector)) {\n                  if (!currentSelectors[selector]) {\n                    Tools.each(callbacks, function (callback) {\n                      callback(true, {\n                        node: node,\n                        selector: selector,\n                        parents: parents\n                      });\n                    });\n                    currentSelectors[selector] = callbacks;\n                  }\n\n                  matchedSelectors[selector] = callbacks;\n                  return false;\n                }\n              });\n            });\n            Tools.each(currentSelectors, function (callbacks, selector) {\n              if (!matchedSelectors[selector]) {\n                delete currentSelectors[selector];\n                Tools.each(callbacks, function (callback) {\n                  callback(false, {\n                    node: node,\n                    selector: selector,\n                    parents: parents\n                  });\n                });\n              }\n            });\n          });\n        }\n\n        if (!selectorChangedData[selector]) {\n          selectorChangedData[selector] = [];\n        }\n\n        selectorChangedData[selector].push(callback);\n        return {\n          unbind: function () {\n            deleteFromCallbackMap(selectorChangedData, selector, callback);\n            deleteFromCallbackMap(currentSelectors, selector, callback);\n          }\n        };\n      }\n    };\n  }\n\n  var isNativeIeSelection = function (rng) {\n    return !!rng.select;\n  };\n\n  var isAttachedToDom = function (node) {\n    return !!(node && node.ownerDocument) && contains$2(SugarElement.fromDom(node.ownerDocument), SugarElement.fromDom(node));\n  };\n\n  var isValidRange = function (rng) {\n    if (!rng) {\n      return false;\n    } else if (isNativeIeSelection(rng)) {\n      return true;\n    } else {\n      return isAttachedToDom(rng.startContainer) && isAttachedToDom(rng.endContainer);\n    }\n  };\n\n  var EditorSelection = function (dom, win, serializer, editor) {\n    var selectedRange;\n    var explicitRange;\n    var selectorChangedWithUnbind = SelectorChanged(dom, editor).selectorChangedWithUnbind;\n\n    var setCursorLocation = function (node, offset) {\n      var rng = dom.createRng();\n\n      if (!node) {\n        moveEndPoint$1(dom, rng, editor.getBody(), true);\n        setRng(rng);\n      } else {\n        rng.setStart(node, offset);\n        rng.setEnd(node, offset);\n        setRng(rng);\n        collapse(false);\n      }\n    };\n\n    var getContent = function (args) {\n      return getContent$1(editor, args);\n    };\n\n    var setContent = function (content, args) {\n      return setContent$1(editor, content, args);\n    };\n\n    var getStart = function (real) {\n      return getStart$2(editor.getBody(), getRng$1(), real);\n    };\n\n    var getEnd$1 = function (real) {\n      return getEnd(editor.getBody(), getRng$1(), real);\n    };\n\n    var getBookmark = function (type, normalized) {\n      return bookmarkManager.getBookmark(type, normalized);\n    };\n\n    var moveToBookmark = function (bookmark) {\n      return bookmarkManager.moveToBookmark(bookmark);\n    };\n\n    var select = function (node, content) {\n      select$1(dom, node, content).each(setRng);\n      return node;\n    };\n\n    var isCollapsed = function () {\n      var rng = getRng$1(),\n          sel = getSel();\n\n      if (!rng || rng.item) {\n        return false;\n      }\n\n      if (rng.compareEndPoints) {\n        return rng.compareEndPoints('StartToEnd', rng) === 0;\n      }\n\n      return !sel || rng.collapsed;\n    };\n\n    var collapse = function (toStart) {\n      var rng = getRng$1();\n      rng.collapse(!!toStart);\n      setRng(rng);\n    };\n\n    var getSel = function () {\n      return win.getSelection ? win.getSelection() : win.document.selection;\n    };\n\n    var getRng$1 = function () {\n      var selection, rng, elm;\n\n      var tryCompareBoundaryPoints = function (how, sourceRange, destinationRange) {\n        try {\n          return sourceRange.compareBoundaryPoints(how, destinationRange);\n        } catch (ex) {\n          return -1;\n        }\n      };\n\n      if (!win) {\n        return null;\n      }\n\n      var doc = win.document;\n\n      if (typeof doc === 'undefined' || doc === null) {\n        return null;\n      }\n\n      if (editor.bookmark !== undefined && hasFocus$1(editor) === false) {\n        var bookmark = getRng(editor);\n\n        if (bookmark.isSome()) {\n          return bookmark.map(function (r) {\n            return processRanges(editor, [r])[0];\n          }).getOr(doc.createRange());\n        }\n      }\n\n      try {\n        if ((selection = getSel()) && !isRestrictedNode(selection.anchorNode)) {\n          if (selection.rangeCount > 0) {\n            rng = selection.getRangeAt(0);\n          } else {\n            rng = selection.createRange ? selection.createRange() : doc.createRange();\n          }\n\n          rng = processRanges(editor, [rng])[0];\n        }\n      } catch (ex) {}\n\n      if (!rng) {\n        rng = doc.createRange ? doc.createRange() : doc.body.createTextRange();\n      }\n\n      if (rng.setStart && rng.startContainer.nodeType === 9 && rng.collapsed) {\n        elm = dom.getRoot();\n        rng.setStart(elm, 0);\n        rng.setEnd(elm, 0);\n      }\n\n      if (selectedRange && explicitRange) {\n        if (tryCompareBoundaryPoints(rng.START_TO_START, rng, selectedRange) === 0 && tryCompareBoundaryPoints(rng.END_TO_END, rng, selectedRange) === 0) {\n          rng = explicitRange;\n        } else {\n          selectedRange = null;\n          explicitRange = null;\n        }\n      }\n\n      return rng;\n    };\n\n    var setRng = function (rng, forward) {\n      var node;\n\n      if (!isValidRange(rng)) {\n        return;\n      }\n\n      var ieRange = isNativeIeSelection(rng) ? rng : null;\n\n      if (ieRange) {\n        explicitRange = null;\n\n        try {\n          ieRange.select();\n        } catch (ex) {}\n\n        return;\n      }\n\n      var sel = getSel();\n      var evt = editor.fire('SetSelectionRange', {\n        range: rng,\n        forward: forward\n      });\n      rng = evt.range;\n\n      if (sel) {\n        explicitRange = rng;\n\n        try {\n          sel.removeAllRanges();\n          sel.addRange(rng);\n        } catch (ex) {}\n\n        if (forward === false && sel.extend) {\n          sel.collapse(rng.endContainer, rng.endOffset);\n          sel.extend(rng.startContainer, rng.startOffset);\n        }\n\n        selectedRange = sel.rangeCount > 0 ? sel.getRangeAt(0) : null;\n      }\n\n      if (!rng.collapsed && rng.startContainer === rng.endContainer && sel.setBaseAndExtent && !Env.ie) {\n        if (rng.endOffset - rng.startOffset < 2) {\n          if (rng.startContainer.hasChildNodes()) {\n            node = rng.startContainer.childNodes[rng.startOffset];\n\n            if (node && node.tagName === 'IMG') {\n              sel.setBaseAndExtent(rng.startContainer, rng.startOffset, rng.endContainer, rng.endOffset);\n\n              if (sel.anchorNode !== rng.startContainer || sel.focusNode !== rng.endContainer) {\n                sel.setBaseAndExtent(node, 0, node, 1);\n              }\n            }\n          }\n        }\n      }\n\n      editor.fire('AfterSetSelectionRange', {\n        range: rng,\n        forward: forward\n      });\n    };\n\n    var setNode = function (elm) {\n      setContent(dom.getOuterHTML(elm));\n      return elm;\n    };\n\n    var getNode = function () {\n      return getNode$1(editor.getBody(), getRng$1());\n    };\n\n    var getSelectedBlocks$1 = function (startElm, endElm) {\n      return getSelectedBlocks(dom, getRng$1(), startElm, endElm);\n    };\n\n    var isForward = function () {\n      var sel = getSel();\n      var anchorNode = sel === null || sel === void 0 ? void 0 : sel.anchorNode;\n      var focusNode = sel === null || sel === void 0 ? void 0 : sel.focusNode;\n\n      if (!sel || !anchorNode || !focusNode || isRestrictedNode(anchorNode) || isRestrictedNode(focusNode)) {\n        return true;\n      }\n\n      var anchorRange = dom.createRng();\n      anchorRange.setStart(anchorNode, sel.anchorOffset);\n      anchorRange.collapse(true);\n      var focusRange = dom.createRng();\n      focusRange.setStart(focusNode, sel.focusOffset);\n      focusRange.collapse(true);\n      return anchorRange.compareBoundaryPoints(anchorRange.START_TO_START, focusRange) <= 0;\n    };\n\n    var normalize$1 = function () {\n      var rng = getRng$1();\n      var sel = getSel();\n\n      if (!hasMultipleRanges(sel) && hasAnyRanges(editor)) {\n        var normRng = normalize(dom, rng);\n        normRng.each(function (normRng) {\n          setRng(normRng, isForward());\n        });\n        return normRng.getOr(rng);\n      }\n\n      return rng;\n    };\n\n    var selectorChanged = function (selector, callback) {\n      selectorChangedWithUnbind(selector, callback);\n      return exports;\n    };\n\n    var getScrollContainer = function () {\n      var scrollContainer;\n      var node = dom.getRoot();\n\n      while (node && node.nodeName !== 'BODY') {\n        if (node.scrollHeight > node.clientHeight) {\n          scrollContainer = node;\n          break;\n        }\n\n        node = node.parentNode;\n      }\n\n      return scrollContainer;\n    };\n\n    var scrollIntoView = function (elm, alignToTop) {\n      return scrollElementIntoView(editor, elm, alignToTop);\n    };\n\n    var placeCaretAt = function (clientX, clientY) {\n      return setRng(fromPoint$1(clientX, clientY, editor.getDoc()));\n    };\n\n    var getBoundingClientRect = function () {\n      var rng = getRng$1();\n      return rng.collapsed ? CaretPosition$1.fromRangeStart(rng).getClientRects()[0] : rng.getBoundingClientRect();\n    };\n\n    var destroy = function () {\n      win = selectedRange = explicitRange = null;\n      controlSelection.destroy();\n    };\n\n    var exports = {\n      bookmarkManager: null,\n      controlSelection: null,\n      dom: dom,\n      win: win,\n      serializer: serializer,\n      editor: editor,\n      collapse: collapse,\n      setCursorLocation: setCursorLocation,\n      getContent: getContent,\n      setContent: setContent,\n      getBookmark: getBookmark,\n      moveToBookmark: moveToBookmark,\n      select: select,\n      isCollapsed: isCollapsed,\n      isForward: isForward,\n      setNode: setNode,\n      getNode: getNode,\n      getSel: getSel,\n      setRng: setRng,\n      getRng: getRng$1,\n      getStart: getStart,\n      getEnd: getEnd$1,\n      getSelectedBlocks: getSelectedBlocks$1,\n      normalize: normalize$1,\n      selectorChanged: selectorChanged,\n      selectorChangedWithUnbind: selectorChangedWithUnbind,\n      getScrollContainer: getScrollContainer,\n      scrollIntoView: scrollIntoView,\n      placeCaretAt: placeCaretAt,\n      getBoundingClientRect: getBoundingClientRect,\n      destroy: destroy\n    };\n    var bookmarkManager = BookmarkManager$1(exports);\n    var controlSelection = ControlSelection(exports, editor);\n    exports.bookmarkManager = bookmarkManager;\n    exports.controlSelection = controlSelection;\n    return exports;\n  };\n\n  var removeAttrs = function (node, names) {\n    each(names, function (name) {\n      node.attr(name, null);\n    });\n  };\n\n  var addFontToSpansFilter = function (domParser, styles, fontSizes) {\n    domParser.addNodeFilter('font', function (nodes) {\n      each(nodes, function (node) {\n        var props = styles.parse(node.attr('style'));\n        var color = node.attr('color');\n        var face = node.attr('face');\n        var size = node.attr('size');\n\n        if (color) {\n          props.color = color;\n        }\n\n        if (face) {\n          props['font-family'] = face;\n        }\n\n        if (size) {\n          props['font-size'] = fontSizes[parseInt(node.attr('size'), 10) - 1];\n        }\n\n        node.name = 'span';\n        node.attr('style', styles.serialize(props));\n        removeAttrs(node, ['color', 'face', 'size']);\n      });\n    });\n  };\n\n  var addStrikeToSpanFilter = function (domParser, styles) {\n    domParser.addNodeFilter('strike', function (nodes) {\n      each(nodes, function (node) {\n        var props = styles.parse(node.attr('style'));\n        props['text-decoration'] = 'line-through';\n        node.name = 'span';\n        node.attr('style', styles.serialize(props));\n      });\n    });\n  };\n\n  var addFilters = function (domParser, settings) {\n    var styles = Styles();\n\n    if (settings.convert_fonts_to_spans) {\n      addFontToSpansFilter(domParser, styles, Tools.explode(settings.font_size_legacy_values));\n    }\n\n    addStrikeToSpanFilter(domParser, styles);\n  };\n\n  var register$1 = function (domParser, settings) {\n    if (settings.inline_styles) {\n      addFilters(domParser, settings);\n    }\n  };\n\n  var blobUriToBlob = function (url) {\n    return new promiseObj(function (resolve, reject) {\n      var rejectWithError = function () {\n        reject('Cannot convert ' + url + ' to Blob. Resource might not exist or is inaccessible.');\n      };\n\n      try {\n        var xhr = new XMLHttpRequest();\n        xhr.open('GET', url, true);\n        xhr.responseType = 'blob';\n\n        xhr.onload = function () {\n          if (this.status === 200) {\n            resolve(this.response);\n          } else {\n            rejectWithError();\n          }\n        };\n\n        xhr.onerror = rejectWithError;\n        xhr.send();\n      } catch (ex) {\n        rejectWithError();\n      }\n    });\n  };\n\n  var parseDataUri$1 = function (uri) {\n    var type;\n    var uriParts = decodeURIComponent(uri).split(',');\n    var matches = /data:([^;]+)/.exec(uriParts[0]);\n\n    if (matches) {\n      type = matches[1];\n    }\n\n    return {\n      type: type,\n      data: uriParts[1]\n    };\n  };\n\n  var buildBlob = function (type, data) {\n    var str;\n\n    try {\n      str = atob(data);\n    } catch (e) {\n      return Optional.none();\n    }\n\n    var arr = new Uint8Array(str.length);\n\n    for (var i = 0; i < arr.length; i++) {\n      arr[i] = str.charCodeAt(i);\n    }\n\n    return Optional.some(new Blob([arr], {\n      type: type\n    }));\n  };\n\n  var dataUriToBlob = function (uri) {\n    return new promiseObj(function (resolve) {\n      var _a = parseDataUri$1(uri),\n          type = _a.type,\n          data = _a.data;\n\n      buildBlob(type, data).fold(function () {\n        return resolve(new Blob([]));\n      }, resolve);\n    });\n  };\n\n  var uriToBlob = function (url) {\n    if (url.indexOf('blob:') === 0) {\n      return blobUriToBlob(url);\n    }\n\n    if (url.indexOf('data:') === 0) {\n      return dataUriToBlob(url);\n    }\n\n    return null;\n  };\n\n  var blobToDataUri = function (blob) {\n    return new promiseObj(function (resolve) {\n      var reader = new FileReader();\n\n      reader.onloadend = function () {\n        resolve(reader.result);\n      };\n\n      reader.readAsDataURL(blob);\n    });\n  };\n\n  var count = 0;\n\n  var uniqueId = function (prefix) {\n    return (prefix || 'blobid') + count++;\n  };\n\n  var imageToBlobInfo = function (blobCache, img, resolve, reject) {\n    var base64, blobInfo;\n\n    if (img.src.indexOf('blob:') === 0) {\n      blobInfo = blobCache.getByUri(img.src);\n\n      if (blobInfo) {\n        resolve({\n          image: img,\n          blobInfo: blobInfo\n        });\n      } else {\n        uriToBlob(img.src).then(function (blob) {\n          blobToDataUri(blob).then(function (dataUri) {\n            base64 = parseDataUri$1(dataUri).data;\n            blobInfo = blobCache.create(uniqueId(), blob, base64);\n            blobCache.add(blobInfo);\n            resolve({\n              image: img,\n              blobInfo: blobInfo\n            });\n          });\n        }, function (err) {\n          reject(err);\n        });\n      }\n\n      return;\n    }\n\n    var _a = parseDataUri$1(img.src),\n        data = _a.data,\n        type = _a.type;\n\n    base64 = data;\n    blobInfo = blobCache.getByData(base64, type);\n\n    if (blobInfo) {\n      resolve({\n        image: img,\n        blobInfo: blobInfo\n      });\n    } else {\n      uriToBlob(img.src).then(function (blob) {\n        blobInfo = blobCache.create(uniqueId(), blob, base64);\n        blobCache.add(blobInfo);\n        resolve({\n          image: img,\n          blobInfo: blobInfo\n        });\n      }, function (err) {\n        reject(err);\n      });\n    }\n  };\n\n  var getAllImages = function (elm) {\n    return elm ? from$1(elm.getElementsByTagName('img')) : [];\n  };\n\n  function ImageScanner(uploadStatus, blobCache) {\n    var cachedPromises = {};\n\n    var findAll = function (elm, predicate) {\n      if (!predicate) {\n        predicate = always;\n      }\n\n      var images = filter(getAllImages(elm), function (img) {\n        var src = img.src;\n\n        if (!Env.fileApi) {\n          return false;\n        }\n\n        if (img.hasAttribute('data-mce-bogus')) {\n          return false;\n        }\n\n        if (img.hasAttribute('data-mce-placeholder')) {\n          return false;\n        }\n\n        if (!src || src === Env.transparentSrc) {\n          return false;\n        }\n\n        if (src.indexOf('blob:') === 0) {\n          return !uploadStatus.isUploaded(src) && predicate(img);\n        }\n\n        if (src.indexOf('data:') === 0) {\n          return predicate(img);\n        }\n\n        return false;\n      });\n      var promises = map(images, function (img) {\n        if (cachedPromises[img.src] !== undefined) {\n          return new promiseObj(function (resolve) {\n            cachedPromises[img.src].then(function (imageInfo) {\n              if (typeof imageInfo === 'string') {\n                return imageInfo;\n              }\n\n              resolve({\n                image: img,\n                blobInfo: imageInfo.blobInfo\n              });\n            });\n          });\n        }\n\n        var newPromise = new promiseObj(function (resolve, reject) {\n          imageToBlobInfo(blobCache, img, resolve, reject);\n        }).then(function (result) {\n          delete cachedPromises[result.image.src];\n          return result;\n        }).catch(function (error) {\n          delete cachedPromises[img.src];\n          return error;\n        });\n        cachedPromises[img.src] = newPromise;\n        return newPromise;\n      });\n      return promiseObj.all(promises);\n    };\n\n    return {\n      findAll: findAll\n    };\n  }\n\n  var paddEmptyNode = function (settings, args, blockElements, node) {\n    var brPreferred = settings.padd_empty_with_br || args.insert;\n\n    if (brPreferred && blockElements[node.name]) {\n      node.empty().append(new AstNode('br', 1)).shortEnded = true;\n    } else {\n      node.empty().append(new AstNode('#text', 3)).value = nbsp;\n    }\n  };\n\n  var isPaddedWithNbsp = function (node) {\n    return hasOnlyChild(node, '#text') && node.firstChild.value === nbsp;\n  };\n\n  var hasOnlyChild = function (node, name) {\n    return node && node.firstChild && node.firstChild === node.lastChild && node.firstChild.name === name;\n  };\n\n  var isPadded = function (schema, node) {\n    var rule = schema.getElementRule(node.name);\n    return rule && rule.paddEmpty;\n  };\n\n  var isEmpty$2 = function (schema, nonEmptyElements, whitespaceElements, node) {\n    return node.isEmpty(nonEmptyElements, whitespaceElements, function (node) {\n      return isPadded(schema, node);\n    });\n  };\n\n  var isLineBreakNode = function (node, blockElements) {\n    return node && (blockElements[node.name] || node.name === 'br');\n  };\n\n  var isBogusImage = function (img) {\n    return img.attr('data-mce-bogus');\n  };\n\n  var isInternalImageSource = function (img) {\n    return img.attr('src') === Env.transparentSrc || img.attr('data-mce-placeholder');\n  };\n\n  var isValidDataImg = function (img, settings) {\n    if (settings.images_dataimg_filter) {\n      var imgElem_1 = new Image();\n      imgElem_1.src = img.attr('src');\n      each$1(img.attributes.map, function (value, key) {\n        imgElem_1.setAttribute(key, value);\n      });\n      return settings.images_dataimg_filter(imgElem_1);\n    } else {\n      return true;\n    }\n  };\n\n  var registerBase64ImageFilter = function (parser, settings) {\n    var blobCache = settings.blob_cache;\n\n    var processImage = function (img) {\n      var inputSrc = img.attr('src');\n\n      if (isInternalImageSource(img) || isBogusImage(img)) {\n        return;\n      }\n\n      parseDataUri(inputSrc).filter(function () {\n        return isValidDataImg(img, settings);\n      }).bind(function (_a) {\n        var type = _a.type,\n            data = _a.data;\n        return Optional.from(blobCache.getByData(data, type)).orThunk(function () {\n          return buildBlob(type, data).map(function (blob) {\n            var blobInfo = blobCache.create(uniqueId(), blob, data);\n            blobCache.add(blobInfo);\n            return blobInfo;\n          });\n        });\n      }).each(function (blobInfo) {\n        img.attr('src', blobInfo.blobUri());\n      });\n    };\n\n    if (blobCache) {\n      parser.addAttributeFilter('src', function (nodes) {\n        return each(nodes, processImage);\n      });\n    }\n  };\n\n  var register$2 = function (parser, settings) {\n    var schema = parser.schema;\n\n    if (settings.remove_trailing_brs) {\n      parser.addNodeFilter('br', function (nodes, _, args) {\n        var i;\n        var l = nodes.length;\n        var node;\n        var blockElements = Tools.extend({}, schema.getBlockElements());\n        var nonEmptyElements = schema.getNonEmptyElements();\n        var parent, lastParent, prev, prevName;\n        var whiteSpaceElements = schema.getWhiteSpaceElements();\n        var elementRule, textNode;\n        blockElements.body = 1;\n\n        for (i = 0; i < l; i++) {\n          node = nodes[i];\n          parent = node.parent;\n\n          if (blockElements[node.parent.name] && node === parent.lastChild) {\n            prev = node.prev;\n\n            while (prev) {\n              prevName = prev.name;\n\n              if (prevName !== 'span' || prev.attr('data-mce-type') !== 'bookmark') {\n                if (prevName === 'br') {\n                  node = null;\n                }\n\n                break;\n              }\n\n              prev = prev.prev;\n            }\n\n            if (node) {\n              node.remove();\n\n              if (isEmpty$2(schema, nonEmptyElements, whiteSpaceElements, parent)) {\n                elementRule = schema.getElementRule(parent.name);\n\n                if (elementRule) {\n                  if (elementRule.removeEmpty) {\n                    parent.remove();\n                  } else if (elementRule.paddEmpty) {\n                    paddEmptyNode(settings, args, blockElements, parent);\n                  }\n                }\n              }\n            }\n          } else {\n            lastParent = node;\n\n            while (parent && parent.firstChild === lastParent && parent.lastChild === lastParent) {\n              lastParent = parent;\n\n              if (blockElements[parent.name]) {\n                break;\n              }\n\n              parent = parent.parent;\n            }\n\n            if (lastParent === parent && settings.padd_empty_with_br !== true) {\n              textNode = new AstNode('#text', 3);\n              textNode.value = nbsp;\n              node.replace(textNode);\n            }\n          }\n        }\n      });\n    }\n\n    parser.addAttributeFilter('href', function (nodes) {\n      var i = nodes.length;\n\n      var appendRel = function (rel) {\n        var parts = rel.split(' ').filter(function (p) {\n          return p.length > 0;\n        });\n        return parts.concat(['noopener']).sort().join(' ');\n      };\n\n      var addNoOpener = function (rel) {\n        var newRel = rel ? Tools.trim(rel) : '';\n\n        if (!/\\b(noopener)\\b/g.test(newRel)) {\n          return appendRel(newRel);\n        } else {\n          return newRel;\n        }\n      };\n\n      if (!settings.allow_unsafe_link_target) {\n        while (i--) {\n          var node = nodes[i];\n\n          if (node.name === 'a' && node.attr('target') === '_blank') {\n            node.attr('rel', addNoOpener(node.attr('rel')));\n          }\n        }\n      }\n    });\n\n    if (!settings.allow_html_in_named_anchor) {\n      parser.addAttributeFilter('id,name', function (nodes) {\n        var i = nodes.length,\n            sibling,\n            prevSibling,\n            parent,\n            node;\n\n        while (i--) {\n          node = nodes[i];\n\n          if (node.name === 'a' && node.firstChild && !node.attr('href')) {\n            parent = node.parent;\n            sibling = node.lastChild;\n\n            do {\n              prevSibling = sibling.prev;\n              parent.insert(sibling, node);\n              sibling = prevSibling;\n            } while (sibling);\n          }\n        }\n      });\n    }\n\n    if (settings.fix_list_elements) {\n      parser.addNodeFilter('ul,ol', function (nodes) {\n        var i = nodes.length,\n            node,\n            parentNode;\n\n        while (i--) {\n          node = nodes[i];\n          parentNode = node.parent;\n\n          if (parentNode.name === 'ul' || parentNode.name === 'ol') {\n            if (node.prev && node.prev.name === 'li') {\n              node.prev.append(node);\n            } else {\n              var li = new AstNode('li', 1);\n              li.attr('style', 'list-style-type: none');\n              node.wrap(li);\n            }\n          }\n        }\n      });\n    }\n\n    if (settings.validate && schema.getValidClasses()) {\n      parser.addAttributeFilter('class', function (nodes) {\n        var i = nodes.length,\n            node,\n            classList,\n            ci,\n            className,\n            classValue;\n        var validClasses = schema.getValidClasses();\n        var validClassesMap, valid;\n\n        while (i--) {\n          node = nodes[i];\n          classList = node.attr('class').split(' ');\n          classValue = '';\n\n          for (ci = 0; ci < classList.length; ci++) {\n            className = classList[ci];\n            valid = false;\n            validClassesMap = validClasses['*'];\n\n            if (validClassesMap && validClassesMap[className]) {\n              valid = true;\n            }\n\n            validClassesMap = validClasses[node.name];\n\n            if (!valid && validClassesMap && validClassesMap[className]) {\n              valid = true;\n            }\n\n            if (valid) {\n              if (classValue) {\n                classValue += ' ';\n              }\n\n              classValue += className;\n            }\n          }\n\n          if (!classValue.length) {\n            classValue = null;\n          }\n\n          node.attr('class', classValue);\n        }\n      });\n    }\n\n    registerBase64ImageFilter(parser, settings);\n  };\n\n  var makeMap$4 = Tools.makeMap,\n      each$d = Tools.each,\n      explode$2 = Tools.explode,\n      extend$2 = Tools.extend;\n\n  var DomParser = function (settings, schema) {\n    if (schema === void 0) {\n      schema = Schema();\n    }\n\n    var nodeFilters = {};\n    var attributeFilters = [];\n    var matchedNodes = {};\n    var matchedAttributes = {};\n    settings = settings || {};\n    settings.validate = 'validate' in settings ? settings.validate : true;\n    settings.root_name = settings.root_name || 'body';\n\n    var fixInvalidChildren = function (nodes) {\n      var ni, node, parent, parents, newParent, currentNode, tempNode, childNode, i;\n      var sibling, nextNode;\n      var nonSplitableElements = makeMap$4('tr,td,th,tbody,thead,tfoot,table');\n      var nonEmptyElements = schema.getNonEmptyElements();\n      var whitespaceElements = schema.getWhiteSpaceElements();\n      var textBlockElements = schema.getTextBlockElements();\n      var specialElements = schema.getSpecialElements();\n\n      for (ni = 0; ni < nodes.length; ni++) {\n        node = nodes[ni];\n\n        if (!node.parent || node.fixed) {\n          continue;\n        }\n\n        if (textBlockElements[node.name] && node.parent.name === 'li') {\n          sibling = node.next;\n\n          while (sibling) {\n            if (textBlockElements[sibling.name]) {\n              sibling.name = 'li';\n              sibling.fixed = true;\n              node.parent.insert(sibling, node.parent);\n            } else {\n              break;\n            }\n\n            sibling = sibling.next;\n          }\n\n          node.unwrap(node);\n          continue;\n        }\n\n        parents = [node];\n\n        for (parent = node.parent; parent && !schema.isValidChild(parent.name, node.name) && !nonSplitableElements[parent.name]; parent = parent.parent) {\n          parents.push(parent);\n        }\n\n        if (parent && parents.length > 1) {\n          parents.reverse();\n          newParent = currentNode = filterNode(parents[0].clone());\n\n          for (i = 0; i < parents.length - 1; i++) {\n            if (schema.isValidChild(currentNode.name, parents[i].name)) {\n              tempNode = filterNode(parents[i].clone());\n              currentNode.append(tempNode);\n            } else {\n              tempNode = currentNode;\n            }\n\n            for (childNode = parents[i].firstChild; childNode && childNode !== parents[i + 1];) {\n              nextNode = childNode.next;\n              tempNode.append(childNode);\n              childNode = nextNode;\n            }\n\n            currentNode = tempNode;\n          }\n\n          if (!isEmpty$2(schema, nonEmptyElements, whitespaceElements, newParent)) {\n            parent.insert(newParent, parents[0], true);\n            parent.insert(node, newParent);\n          } else {\n            parent.insert(node, parents[0], true);\n          }\n\n          parent = parents[0];\n\n          if (isEmpty$2(schema, nonEmptyElements, whitespaceElements, parent) || hasOnlyChild(parent, 'br')) {\n            parent.empty().remove();\n          }\n        } else if (node.parent) {\n          if (node.name === 'li') {\n            sibling = node.prev;\n\n            if (sibling && (sibling.name === 'ul' || sibling.name === 'ol')) {\n              sibling.append(node);\n              continue;\n            }\n\n            sibling = node.next;\n\n            if (sibling && (sibling.name === 'ul' || sibling.name === 'ol')) {\n              sibling.insert(node, sibling.firstChild, true);\n              continue;\n            }\n\n            node.wrap(filterNode(new AstNode('ul', 1)));\n            continue;\n          }\n\n          if (schema.isValidChild(node.parent.name, 'div') && schema.isValidChild('div', node.name)) {\n            node.wrap(filterNode(new AstNode('div', 1)));\n          } else {\n            if (specialElements[node.name]) {\n              node.empty().remove();\n            } else {\n              node.unwrap();\n            }\n          }\n        }\n      }\n    };\n\n    var filterNode = function (node) {\n      var i, name, list;\n      name = node.name;\n\n      if (name in nodeFilters) {\n        list = matchedNodes[name];\n\n        if (list) {\n          list.push(node);\n        } else {\n          matchedNodes[name] = [node];\n        }\n      }\n\n      i = attributeFilters.length;\n\n      while (i--) {\n        name = attributeFilters[i].name;\n\n        if (name in node.attributes.map) {\n          list = matchedAttributes[name];\n\n          if (list) {\n            list.push(node);\n          } else {\n            matchedAttributes[name] = [node];\n          }\n        }\n      }\n\n      return node;\n    };\n\n    var addNodeFilter = function (name, callback) {\n      each$d(explode$2(name), function (name) {\n        var list = nodeFilters[name];\n\n        if (!list) {\n          nodeFilters[name] = list = [];\n        }\n\n        list.push(callback);\n      });\n    };\n\n    var getNodeFilters = function () {\n      var out = [];\n\n      for (var name_1 in nodeFilters) {\n        if (nodeFilters.hasOwnProperty(name_1)) {\n          out.push({\n            name: name_1,\n            callbacks: nodeFilters[name_1]\n          });\n        }\n      }\n\n      return out;\n    };\n\n    var addAttributeFilter = function (name, callback) {\n      each$d(explode$2(name), function (name) {\n        var i;\n\n        for (i = 0; i < attributeFilters.length; i++) {\n          if (attributeFilters[i].name === name) {\n            attributeFilters[i].callbacks.push(callback);\n            return;\n          }\n        }\n\n        attributeFilters.push({\n          name: name,\n          callbacks: [callback]\n        });\n      });\n    };\n\n    var getAttributeFilters = function () {\n      return [].concat(attributeFilters);\n    };\n\n    var parse = function (html, args) {\n      var nodes, i, l, fi, fl, list, name;\n      var invalidChildren = [];\n      var isInWhiteSpacePreservedElement;\n      var node;\n\n      var getRootBlockName = function (name) {\n        if (name === false) {\n          return '';\n        } else if (name === true) {\n          return 'p';\n        } else {\n          return name;\n        }\n      };\n\n      args = args || {};\n      matchedNodes = {};\n      matchedAttributes = {};\n      var blockElements = extend$2(makeMap$4('script,style,head,html,body,title,meta,param'), schema.getBlockElements());\n      var nonEmptyElements = schema.getNonEmptyElements();\n      var children = schema.children;\n      var validate = settings.validate;\n      var forcedRootBlockName = 'forced_root_block' in args ? args.forced_root_block : settings.forced_root_block;\n      var rootBlockName = getRootBlockName(forcedRootBlockName);\n      var whiteSpaceElements = schema.getWhiteSpaceElements();\n      var startWhiteSpaceRegExp = /^[ \\t\\r\\n]+/;\n      var endWhiteSpaceRegExp = /[ \\t\\r\\n]+$/;\n      var allWhiteSpaceRegExp = /[ \\t\\r\\n]+/g;\n      var isAllWhiteSpaceRegExp = /^[ \\t\\r\\n]+$/;\n      isInWhiteSpacePreservedElement = whiteSpaceElements.hasOwnProperty(args.context) || whiteSpaceElements.hasOwnProperty(settings.root_name);\n\n      var addRootBlocks = function () {\n        var node = rootNode.firstChild,\n            next,\n            rootBlockNode;\n\n        var trim = function (rootBlockNode) {\n          if (rootBlockNode) {\n            node = rootBlockNode.firstChild;\n\n            if (node && node.type === 3) {\n              node.value = node.value.replace(startWhiteSpaceRegExp, '');\n            }\n\n            node = rootBlockNode.lastChild;\n\n            if (node && node.type === 3) {\n              node.value = node.value.replace(endWhiteSpaceRegExp, '');\n            }\n          }\n        };\n\n        if (!schema.isValidChild(rootNode.name, rootBlockName.toLowerCase())) {\n          return;\n        }\n\n        while (node) {\n          next = node.next;\n\n          if (node.type === 3 || node.type === 1 && node.name !== 'p' && !blockElements[node.name] && !node.attr('data-mce-type')) {\n            if (!rootBlockNode) {\n              rootBlockNode = createNode(rootBlockName, 1);\n              rootBlockNode.attr(settings.forced_root_block_attrs);\n              rootNode.insert(rootBlockNode, node);\n              rootBlockNode.append(node);\n            } else {\n              rootBlockNode.append(node);\n            }\n          } else {\n            trim(rootBlockNode);\n            rootBlockNode = null;\n          }\n\n          node = next;\n        }\n\n        trim(rootBlockNode);\n      };\n\n      var createNode = function (name, type) {\n        var node = new AstNode(name, type);\n        var list;\n\n        if (name in nodeFilters) {\n          list = matchedNodes[name];\n\n          if (list) {\n            list.push(node);\n          } else {\n            matchedNodes[name] = [node];\n          }\n        }\n\n        return node;\n      };\n\n      var removeWhitespaceBefore = function (node) {\n        var textNode, textNodeNext, textVal, sibling;\n        var blockElements = schema.getBlockElements();\n\n        for (textNode = node.prev; textNode && textNode.type === 3;) {\n          textVal = textNode.value.replace(endWhiteSpaceRegExp, '');\n\n          if (textVal.length > 0) {\n            textNode.value = textVal;\n            return;\n          }\n\n          textNodeNext = textNode.next;\n\n          if (textNodeNext) {\n            if (textNodeNext.type === 3 && textNodeNext.value.length) {\n              textNode = textNode.prev;\n              continue;\n            }\n\n            if (!blockElements[textNodeNext.name] && textNodeNext.name !== 'script' && textNodeNext.name !== 'style') {\n              textNode = textNode.prev;\n              continue;\n            }\n          }\n\n          sibling = textNode.prev;\n          textNode.remove();\n          textNode = sibling;\n        }\n      };\n\n      var cloneAndExcludeBlocks = function (input) {\n        var name;\n        var output = {};\n\n        for (name in input) {\n          if (name !== 'li' && name !== 'p') {\n            output[name] = input[name];\n          }\n        }\n\n        return output;\n      };\n\n      var parser = SaxParser$1({\n        validate: validate,\n        allow_html_data_urls: settings.allow_html_data_urls,\n        allow_script_urls: settings.allow_script_urls,\n        allow_conditional_comments: settings.allow_conditional_comments,\n        preserve_cdata: settings.preserve_cdata,\n        self_closing_elements: cloneAndExcludeBlocks(schema.getSelfClosingElements()),\n        cdata: function (text) {\n          node.append(createNode('#cdata', 4)).value = text;\n        },\n        text: function (text, raw) {\n          var textNode;\n\n          if (!isInWhiteSpacePreservedElement) {\n            text = text.replace(allWhiteSpaceRegExp, ' ');\n\n            if (isLineBreakNode(node.lastChild, blockElements)) {\n              text = text.replace(startWhiteSpaceRegExp, '');\n            }\n          }\n\n          if (text.length !== 0) {\n            textNode = createNode('#text', 3);\n            textNode.raw = !!raw;\n            node.append(textNode).value = text;\n          }\n        },\n        comment: function (text) {\n          node.append(createNode('#comment', 8)).value = text;\n        },\n        pi: function (name, text) {\n          node.append(createNode(name, 7)).value = text;\n          removeWhitespaceBefore(node);\n        },\n        doctype: function (text) {\n          var newNode = node.append(createNode('#doctype', 10));\n          newNode.value = text;\n          removeWhitespaceBefore(node);\n        },\n        start: function (name, attrs, empty) {\n          var newNode, attrFiltersLen, attrName, parent;\n          var elementRule = validate ? schema.getElementRule(name) : {};\n\n          if (elementRule) {\n            newNode = createNode(elementRule.outputName || name, 1);\n            newNode.attributes = attrs;\n            newNode.shortEnded = empty;\n            node.append(newNode);\n            parent = children[node.name];\n\n            if (parent && children[newNode.name] && !parent[newNode.name]) {\n              invalidChildren.push(newNode);\n            }\n\n            attrFiltersLen = attributeFilters.length;\n\n            while (attrFiltersLen--) {\n              attrName = attributeFilters[attrFiltersLen].name;\n\n              if (attrName in attrs.map) {\n                list = matchedAttributes[attrName];\n\n                if (list) {\n                  list.push(newNode);\n                } else {\n                  matchedAttributes[attrName] = [newNode];\n                }\n              }\n            }\n\n            if (blockElements[name]) {\n              removeWhitespaceBefore(newNode);\n            }\n\n            if (!empty) {\n              node = newNode;\n            }\n\n            if (!isInWhiteSpacePreservedElement && whiteSpaceElements[name]) {\n              isInWhiteSpacePreservedElement = true;\n            }\n          }\n        },\n        end: function (name) {\n          var textNode, text, sibling, tempNode;\n          var elementRule = validate ? schema.getElementRule(name) : {};\n\n          if (elementRule) {\n            if (blockElements[name]) {\n              if (!isInWhiteSpacePreservedElement) {\n                textNode = node.firstChild;\n\n                if (textNode && textNode.type === 3) {\n                  text = textNode.value.replace(startWhiteSpaceRegExp, '');\n\n                  if (text.length > 0) {\n                    textNode.value = text;\n                    textNode = textNode.next;\n                  } else {\n                    sibling = textNode.next;\n                    textNode.remove();\n                    textNode = sibling;\n\n                    while (textNode && textNode.type === 3) {\n                      text = textNode.value;\n                      sibling = textNode.next;\n\n                      if (text.length === 0 || isAllWhiteSpaceRegExp.test(text)) {\n                        textNode.remove();\n                        textNode = sibling;\n                      }\n\n                      textNode = sibling;\n                    }\n                  }\n                }\n\n                textNode = node.lastChild;\n\n                if (textNode && textNode.type === 3) {\n                  text = textNode.value.replace(endWhiteSpaceRegExp, '');\n\n                  if (text.length > 0) {\n                    textNode.value = text;\n                    textNode = textNode.prev;\n                  } else {\n                    sibling = textNode.prev;\n                    textNode.remove();\n                    textNode = sibling;\n\n                    while (textNode && textNode.type === 3) {\n                      text = textNode.value;\n                      sibling = textNode.prev;\n\n                      if (text.length === 0 || isAllWhiteSpaceRegExp.test(text)) {\n                        textNode.remove();\n                        textNode = sibling;\n                      }\n\n                      textNode = sibling;\n                    }\n                  }\n                }\n              }\n            }\n\n            if (isInWhiteSpacePreservedElement && whiteSpaceElements[name]) {\n              isInWhiteSpacePreservedElement = false;\n            }\n\n            if (elementRule.removeEmpty && isEmpty$2(schema, nonEmptyElements, whiteSpaceElements, node)) {\n              tempNode = node.parent;\n\n              if (blockElements[node.name]) {\n                node.empty().remove();\n              } else {\n                node.unwrap();\n              }\n\n              node = tempNode;\n              return;\n            }\n\n            if (elementRule.paddEmpty && (isPaddedWithNbsp(node) || isEmpty$2(schema, nonEmptyElements, whiteSpaceElements, node))) {\n              paddEmptyNode(settings, args, blockElements, node);\n            }\n\n            node = node.parent;\n          }\n        }\n      }, schema);\n      var rootNode = node = new AstNode(args.context || settings.root_name, 11);\n      parser.parse(html, args.format);\n\n      if (validate && invalidChildren.length) {\n        if (!args.context) {\n          fixInvalidChildren(invalidChildren);\n        } else {\n          args.invalid = true;\n        }\n      }\n\n      if (rootBlockName && (rootNode.name === 'body' || args.isRootContent)) {\n        addRootBlocks();\n      }\n\n      if (!args.invalid) {\n        for (name in matchedNodes) {\n          if (!matchedNodes.hasOwnProperty(name)) {\n            continue;\n          }\n\n          list = nodeFilters[name];\n          nodes = matchedNodes[name];\n          fi = nodes.length;\n\n          while (fi--) {\n            if (!nodes[fi].parent) {\n              nodes.splice(fi, 1);\n            }\n          }\n\n          for (i = 0, l = list.length; i < l; i++) {\n            list[i](nodes, name, args);\n          }\n        }\n\n        for (i = 0, l = attributeFilters.length; i < l; i++) {\n          list = attributeFilters[i];\n\n          if (list.name in matchedAttributes) {\n            nodes = matchedAttributes[list.name];\n            fi = nodes.length;\n\n            while (fi--) {\n              if (!nodes[fi].parent) {\n                nodes.splice(fi, 1);\n              }\n            }\n\n            for (fi = 0, fl = list.callbacks.length; fi < fl; fi++) {\n              list.callbacks[fi](nodes, list.name, args);\n            }\n          }\n        }\n      }\n\n      return rootNode;\n    };\n\n    var exports = {\n      schema: schema,\n      addAttributeFilter: addAttributeFilter,\n      getAttributeFilters: getAttributeFilters,\n      addNodeFilter: addNodeFilter,\n      getNodeFilters: getNodeFilters,\n      filterNode: filterNode,\n      parse: parse\n    };\n    register$2(exports, settings);\n    register$1(exports, settings);\n    return exports;\n  };\n\n  var register$3 = function (htmlParser, settings, dom) {\n    htmlParser.addAttributeFilter('data-mce-tabindex', function (nodes, name) {\n      var i = nodes.length,\n          node;\n\n      while (i--) {\n        node = nodes[i];\n        node.attr('tabindex', node.attr('data-mce-tabindex'));\n        node.attr(name, null);\n      }\n    });\n    htmlParser.addAttributeFilter('src,href,style', function (nodes, name) {\n      var i = nodes.length,\n          node,\n          value;\n      var internalName = 'data-mce-' + name;\n      var urlConverter = settings.url_converter;\n      var urlConverterScope = settings.url_converter_scope;\n\n      while (i--) {\n        node = nodes[i];\n        value = node.attr(internalName);\n\n        if (value !== undefined) {\n          node.attr(name, value.length > 0 ? value : null);\n          node.attr(internalName, null);\n        } else {\n          value = node.attr(name);\n\n          if (name === 'style') {\n            value = dom.serializeStyle(dom.parseStyle(value), node.name);\n          } else if (urlConverter) {\n            value = urlConverter.call(urlConverterScope, value, name, node.name);\n          }\n\n          node.attr(name, value.length > 0 ? value : null);\n        }\n      }\n    });\n    htmlParser.addAttributeFilter('class', function (nodes) {\n      var i = nodes.length,\n          node,\n          value;\n\n      while (i--) {\n        node = nodes[i];\n        value = node.attr('class');\n\n        if (value) {\n          value = node.attr('class').replace(/(?:^|\\s)mce-item-\\w+(?!\\S)/g, '');\n          node.attr('class', value.length > 0 ? value : null);\n        }\n      }\n    });\n    htmlParser.addAttributeFilter('data-mce-type', function (nodes, name, args) {\n      var i = nodes.length,\n          node;\n\n      while (i--) {\n        node = nodes[i];\n\n        if (node.attr('data-mce-type') === 'bookmark' && !args.cleanup) {\n          var hasChildren = Optional.from(node.firstChild).exists(function (firstChild) {\n            return !isZwsp$1(firstChild.value);\n          });\n\n          if (hasChildren) {\n            node.unwrap();\n          } else {\n            node.remove();\n          }\n        }\n      }\n    });\n    htmlParser.addNodeFilter('noscript', function (nodes) {\n      var i = nodes.length,\n          node;\n\n      while (i--) {\n        node = nodes[i].firstChild;\n\n        if (node) {\n          node.value = Entities.decode(node.value);\n        }\n      }\n    });\n    htmlParser.addNodeFilter('script,style', function (nodes, name) {\n      var i = nodes.length,\n          node,\n          value,\n          type;\n\n      var trim = function (value) {\n        return value.replace(/(<!--\\[CDATA\\[|\\]\\]-->)/g, '\\n').replace(/^[\\r\\n]*|[\\r\\n]*$/g, '').replace(/^\\s*((<!--)?(\\s*\\/\\/)?\\s*<!\\[CDATA\\[|(<!--\\s*)?\\/\\*\\s*<!\\[CDATA\\[\\s*\\*\\/|(\\/\\/)?\\s*<!--|\\/\\*\\s*<!--\\s*\\*\\/)\\s*[\\r\\n]*/gi, '').replace(/\\s*(\\/\\*\\s*\\]\\]>\\s*\\*\\/(-->)?|\\s*\\/\\/\\s*\\]\\]>(-->)?|\\/\\/\\s*(-->)?|\\]\\]>|\\/\\*\\s*-->\\s*\\*\\/|\\s*-->\\s*)\\s*$/g, '');\n      };\n\n      while (i--) {\n        node = nodes[i];\n        value = node.firstChild ? node.firstChild.value : '';\n\n        if (name === 'script') {\n          type = node.attr('type');\n\n          if (type) {\n            node.attr('type', type === 'mce-no/type' ? null : type.replace(/^mce\\-/, ''));\n          }\n\n          if (settings.element_format === 'xhtml' && value.length > 0) {\n            node.firstChild.value = '// <![CDATA[\\n' + trim(value) + '\\n// ]]>';\n          }\n        } else {\n          if (settings.element_format === 'xhtml' && value.length > 0) {\n            node.firstChild.value = '<!--\\n' + trim(value) + '\\n-->';\n          }\n        }\n      }\n    });\n    htmlParser.addNodeFilter('#comment', function (nodes) {\n      var i = nodes.length,\n          node;\n\n      while (i--) {\n        node = nodes[i];\n\n        if (settings.preserve_cdata && node.value.indexOf('[CDATA[') === 0) {\n          node.name = '#cdata';\n          node.type = 4;\n          node.value = dom.decode(node.value.replace(/^\\[CDATA\\[|\\]\\]$/g, ''));\n        } else if (node.value.indexOf('mce:protected ') === 0) {\n          node.name = '#text';\n          node.type = 3;\n          node.raw = true;\n          node.value = unescape(node.value).substr(14);\n        }\n      }\n    });\n    htmlParser.addNodeFilter('xml:namespace,input', function (nodes, name) {\n      var i = nodes.length,\n          node;\n\n      while (i--) {\n        node = nodes[i];\n\n        if (node.type === 7) {\n          node.remove();\n        } else if (node.type === 1) {\n          if (name === 'input' && !node.attr('type')) {\n            node.attr('type', 'text');\n          }\n        }\n      }\n    });\n    htmlParser.addAttributeFilter('data-mce-type', function (nodes) {\n      each(nodes, function (node) {\n        if (node.attr('data-mce-type') === 'format-caret') {\n          if (node.isEmpty(htmlParser.schema.getNonEmptyElements())) {\n            node.remove();\n          } else {\n            node.unwrap();\n          }\n        }\n      });\n    });\n    htmlParser.addAttributeFilter('data-mce-src,data-mce-href,data-mce-style,' + 'data-mce-selected,data-mce-expando,' + 'data-mce-type,data-mce-resize,data-mce-placeholder', function (nodes, name) {\n      var i = nodes.length;\n\n      while (i--) {\n        nodes[i].attr(name, null);\n      }\n    });\n  };\n\n  var trimTrailingBr = function (rootNode) {\n    var isBr = function (node) {\n      return node && node.name === 'br';\n    };\n\n    var brNode1 = rootNode.lastChild;\n\n    if (isBr(brNode1)) {\n      var brNode2 = brNode1.prev;\n\n      if (isBr(brNode2)) {\n        brNode1.remove();\n        brNode2.remove();\n      }\n    }\n  };\n\n  var preProcess = function (editor, node, args) {\n    var doc, oldDoc;\n    var dom = editor.dom;\n    node = node.cloneNode(true);\n    var impl = document.implementation;\n\n    if (impl.createHTMLDocument) {\n      doc = impl.createHTMLDocument('');\n      Tools.each(node.nodeName === 'BODY' ? node.childNodes : [node], function (node) {\n        doc.body.appendChild(doc.importNode(node, true));\n      });\n\n      if (node.nodeName !== 'BODY') {\n        node = doc.body.firstChild;\n      } else {\n        node = doc.body;\n      }\n\n      oldDoc = dom.doc;\n      dom.doc = doc;\n    }\n\n    firePreProcess(editor, __assign(__assign({}, args), {\n      node: node\n    }));\n\n    if (oldDoc) {\n      dom.doc = oldDoc;\n    }\n\n    return node;\n  };\n\n  var shouldFireEvent = function (editor, args) {\n    return editor && editor.hasEventListeners('PreProcess') && !args.no_events;\n  };\n\n  var process = function (editor, node, args) {\n    return shouldFireEvent(editor, args) ? preProcess(editor, node, args) : node;\n  };\n\n  var addTempAttr = function (htmlParser, tempAttrs, name) {\n    if (Tools.inArray(tempAttrs, name) === -1) {\n      htmlParser.addAttributeFilter(name, function (nodes, name) {\n        var i = nodes.length;\n\n        while (i--) {\n          nodes[i].attr(name, null);\n        }\n      });\n      tempAttrs.push(name);\n    }\n  };\n\n  var postProcess$1 = function (editor, args, content) {\n    if (!args.no_events && editor) {\n      var outArgs = firePostProcess(editor, __assign(__assign({}, args), {\n        content: content\n      }));\n      return outArgs.content;\n    } else {\n      return content;\n    }\n  };\n\n  var getHtmlFromNode = function (dom, node, args) {\n    var html = trim$2(args.getInner ? node.innerHTML : dom.getOuterHTML(node));\n    return args.selection || isWsPreserveElement(SugarElement.fromDom(node)) ? html : Tools.trim(html);\n  };\n\n  var parseHtml = function (htmlParser, html, args) {\n    var parserArgs = args.selection ? __assign({\n      forced_root_block: false\n    }, args) : args;\n    var rootNode = htmlParser.parse(html, parserArgs);\n    trimTrailingBr(rootNode);\n    return rootNode;\n  };\n\n  var serializeNode = function (settings, schema, node) {\n    var htmlSerializer = HtmlSerializer(settings, schema);\n    return htmlSerializer.serialize(node);\n  };\n\n  var toHtml = function (editor, settings, schema, rootNode, args) {\n    var content = serializeNode(settings, schema, rootNode);\n    return postProcess$1(editor, args, content);\n  };\n\n  var DomSerializerImpl = function (settings, editor) {\n    var tempAttrs = ['data-mce-selected'];\n    var dom = editor && editor.dom ? editor.dom : DOMUtils$1.DOM;\n    var schema = editor && editor.schema ? editor.schema : Schema(settings);\n    settings.entity_encoding = settings.entity_encoding || 'named';\n    settings.remove_trailing_brs = 'remove_trailing_brs' in settings ? settings.remove_trailing_brs : true;\n    var htmlParser = DomParser(settings, schema);\n    register$3(htmlParser, settings, dom);\n\n    var serialize = function (node, parserArgs) {\n      if (parserArgs === void 0) {\n        parserArgs = {};\n      }\n\n      var args = __assign({\n        format: 'html'\n      }, parserArgs);\n\n      var targetNode = process(editor, node, args);\n      var html = getHtmlFromNode(dom, targetNode, args);\n      var rootNode = parseHtml(htmlParser, html, args);\n      return args.format === 'tree' ? rootNode : toHtml(editor, settings, schema, rootNode, args);\n    };\n\n    return {\n      schema: schema,\n      addNodeFilter: htmlParser.addNodeFilter,\n      addAttributeFilter: htmlParser.addAttributeFilter,\n      serialize: serialize,\n      addRules: function (rules) {\n        schema.addValidElements(rules);\n      },\n      setRules: function (rules) {\n        schema.setValidElements(rules);\n      },\n      addTempAttr: curry(addTempAttr, htmlParser, tempAttrs),\n      getTempAttrs: function () {\n        return tempAttrs;\n      },\n      getNodeFilters: htmlParser.getNodeFilters,\n      getAttributeFilters: htmlParser.getAttributeFilters\n    };\n  };\n\n  var DomSerializer = function (settings, editor) {\n    var domSerializer = DomSerializerImpl(settings, editor);\n    return {\n      schema: domSerializer.schema,\n      addNodeFilter: domSerializer.addNodeFilter,\n      addAttributeFilter: domSerializer.addAttributeFilter,\n      serialize: domSerializer.serialize,\n      addRules: domSerializer.addRules,\n      setRules: domSerializer.setRules,\n      addTempAttr: domSerializer.addTempAttr,\n      getTempAttrs: domSerializer.getTempAttrs,\n      getNodeFilters: domSerializer.getNodeFilters,\n      getAttributeFilters: domSerializer.getAttributeFilters\n    };\n  };\n\n  var defaultFormat$1 = 'html';\n\n  var getContent$2 = function (editor, args) {\n    if (args === void 0) {\n      args = {};\n    }\n\n    var format = args.format ? args.format : defaultFormat$1;\n    return getContent(editor, args, format);\n  };\n\n  var setContent$2 = function (editor, content, args) {\n    if (args === void 0) {\n      args = {};\n    }\n\n    return setContent(editor, content, args);\n  };\n\n  var DOM$3 = DOMUtils$1.DOM;\n\n  var restoreOriginalStyles = function (editor) {\n    DOM$3.setStyle(editor.id, 'display', editor.orgDisplay);\n  };\n\n  var safeDestroy = function (x) {\n    return Optional.from(x).each(function (x) {\n      return x.destroy();\n    });\n  };\n\n  var clearDomReferences = function (editor) {\n    editor.contentAreaContainer = editor.formElement = editor.container = editor.editorContainer = null;\n    editor.bodyElement = editor.contentDocument = editor.contentWindow = null;\n    editor.iframeElement = editor.targetElm = null;\n\n    if (editor.selection) {\n      editor.selection = editor.selection.win = editor.selection.dom = editor.selection.dom.doc = null;\n    }\n  };\n\n  var restoreForm = function (editor) {\n    var form = editor.formElement;\n\n    if (form) {\n      if (form._mceOldSubmit) {\n        form.submit = form._mceOldSubmit;\n        form._mceOldSubmit = null;\n      }\n\n      DOM$3.unbind(form, 'submit reset', editor.formEventDelegate);\n    }\n  };\n\n  var remove$7 = function (editor) {\n    if (!editor.removed) {\n      var _selectionOverrides = editor._selectionOverrides,\n          editorUpload = editor.editorUpload;\n      var body = editor.getBody();\n      var element = editor.getElement();\n\n      if (body) {\n        editor.save({\n          is_removing: true\n        });\n      }\n\n      editor.removed = true;\n      editor.unbindAllNativeEvents();\n\n      if (editor.hasHiddenInput && element) {\n        DOM$3.remove(element.nextSibling);\n      }\n\n      fireRemove(editor);\n      editor.editorManager.remove(editor);\n\n      if (!editor.inline && body) {\n        restoreOriginalStyles(editor);\n      }\n\n      fireDetach(editor);\n      DOM$3.remove(editor.getContainer());\n      safeDestroy(_selectionOverrides);\n      safeDestroy(editorUpload);\n      editor.destroy();\n    }\n  };\n\n  var destroy = function (editor, automatic) {\n    var selection = editor.selection,\n        dom = editor.dom;\n\n    if (editor.destroyed) {\n      return;\n    }\n\n    if (!automatic && !editor.removed) {\n      editor.remove();\n      return;\n    }\n\n    if (!automatic) {\n      editor.editorManager.off('beforeunload', editor._beforeUnload);\n\n      if (editor.theme && editor.theme.destroy) {\n        editor.theme.destroy();\n      }\n\n      safeDestroy(selection);\n      safeDestroy(dom);\n    }\n\n    restoreForm(editor);\n    clearDomReferences(editor);\n    editor.destroyed = true;\n  };\n\n  var hasOwnProperty$2 = Object.prototype.hasOwnProperty;\n\n  var deep$1 = function (old, nu) {\n    var bothObjects = isObject(old) && isObject(nu);\n    return bothObjects ? deepMerge(old, nu) : nu;\n  };\n\n  var baseMerge = function (merger) {\n    return function () {\n      var objects = new Array(arguments.length);\n\n      for (var i = 0; i < objects.length; i++) {\n        objects[i] = arguments[i];\n      }\n\n      if (objects.length === 0) {\n        throw new Error('Can\\'t merge zero objects');\n      }\n\n      var ret = {};\n\n      for (var j = 0; j < objects.length; j++) {\n        var curObject = objects[j];\n\n        for (var key in curObject) {\n          if (hasOwnProperty$2.call(curObject, key)) {\n            ret[key] = merger(ret[key], curObject[key]);\n          }\n        }\n      }\n\n      return ret;\n    };\n  };\n\n  var deepMerge = baseMerge(deep$1);\n\n  var sectionResult = function (sections, settings) {\n    return {\n      sections: constant(sections),\n      settings: constant(settings)\n    };\n  };\n\n  var deviceDetection = detect$3().deviceType;\n  var isTouch = deviceDetection.isTouch();\n  var isPhone = deviceDetection.isPhone();\n  var isTablet = deviceDetection.isTablet();\n  var legacyMobilePlugins = ['lists', 'autolink', 'autosave'];\n  var defaultTouchSettings = {\n    table_grid: false,\n    object_resizing: false,\n    resize: false\n  };\n\n  var normalizePlugins = function (plugins) {\n    var pluginNames = isArray(plugins) ? plugins.join(' ') : plugins;\n    var trimmedPlugins = map(isString(pluginNames) ? pluginNames.split(' ') : [], trim);\n    return filter(trimmedPlugins, function (item) {\n      return item.length > 0;\n    });\n  };\n\n  var filterLegacyMobilePlugins = function (plugins) {\n    return filter(plugins, curry(contains, legacyMobilePlugins));\n  };\n\n  var extractSections = function (keys, settings) {\n    var result = bifilter(settings, function (value, key) {\n      return contains(keys, key);\n    });\n    return sectionResult(result.t, result.f);\n  };\n\n  var getSection = function (sectionResult, name, defaults) {\n    if (defaults === void 0) {\n      defaults = {};\n    }\n\n    var sections = sectionResult.sections();\n    var sectionSettings = sections.hasOwnProperty(name) ? sections[name] : {};\n    return Tools.extend({}, defaults, sectionSettings);\n  };\n\n  var hasSection = function (sectionResult, name) {\n    return sectionResult.sections().hasOwnProperty(name);\n  };\n\n  var isSectionTheme = function (sectionResult, name, theme) {\n    var section = sectionResult.sections();\n    return hasSection(sectionResult, name) && section[name].theme === theme;\n  };\n\n  var getSectionConfig = function (sectionResult, name) {\n    return hasSection(sectionResult, name) ? sectionResult.sections()[name] : {};\n  };\n\n  var getToolbarMode = function (settings, defaultVal) {\n    return get(settings, 'toolbar_mode').orThunk(function () {\n      return get(settings, 'toolbar_drawer').map(function (val) {\n        return val === false ? 'wrap' : val;\n      });\n    }).getOr(defaultVal);\n  };\n\n  var getDefaultSettings = function (settings, id, documentBaseUrl, isTouch, editor) {\n    var baseDefaults = {\n      id: id,\n      theme: 'silver',\n      toolbar_mode: getToolbarMode(settings, 'floating'),\n      plugins: '',\n      document_base_url: documentBaseUrl,\n      add_form_submit_trigger: true,\n      submit_patch: true,\n      add_unload_trigger: true,\n      convert_urls: true,\n      relative_urls: true,\n      remove_script_host: true,\n      object_resizing: true,\n      doctype: '<!DOCTYPE html>',\n      visual: true,\n      font_size_legacy_values: 'xx-small,small,medium,large,x-large,xx-large,300%',\n      forced_root_block: 'p',\n      hidden_input: true,\n      inline_styles: true,\n      convert_fonts_to_spans: true,\n      indent: true,\n      indent_before: 'p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,' + 'tfoot,tbody,tr,section,summary,article,hgroup,aside,figure,figcaption,option,optgroup,datalist',\n      indent_after: 'p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,' + 'tfoot,tbody,tr,section,summary,article,hgroup,aside,figure,figcaption,option,optgroup,datalist',\n      entity_encoding: 'named',\n      url_converter: editor.convertURL,\n      url_converter_scope: editor\n    };\n    return __assign(__assign({}, baseDefaults), isTouch ? defaultTouchSettings : {});\n  };\n\n  var getDefaultMobileSettings = function (mobileSettings, isPhone) {\n    var defaultMobileSettings = {\n      resize: false,\n      toolbar_mode: getToolbarMode(mobileSettings, 'scrolling'),\n      toolbar_sticky: false\n    };\n    var defaultPhoneSettings = {\n      menubar: false\n    };\n    return __assign(__assign(__assign({}, defaultTouchSettings), defaultMobileSettings), isPhone ? defaultPhoneSettings : {});\n  };\n\n  var getExternalPlugins$1 = function (overrideSettings, settings) {\n    var userDefinedExternalPlugins = settings.external_plugins ? settings.external_plugins : {};\n\n    if (overrideSettings && overrideSettings.external_plugins) {\n      return Tools.extend({}, overrideSettings.external_plugins, userDefinedExternalPlugins);\n    } else {\n      return userDefinedExternalPlugins;\n    }\n  };\n\n  var combinePlugins = function (forcedPlugins, plugins) {\n    return [].concat(normalizePlugins(forcedPlugins)).concat(normalizePlugins(plugins));\n  };\n\n  var processPlugins = function (isMobileDevice, sectionResult, defaultOverrideSettings, settings) {\n    var forcedPlugins = normalizePlugins(defaultOverrideSettings.forced_plugins);\n    var desktopPlugins = normalizePlugins(settings.plugins);\n    var mobileConfig = getSectionConfig(sectionResult, 'mobile');\n    var mobilePlugins = mobileConfig.plugins ? normalizePlugins(mobileConfig.plugins) : desktopPlugins;\n    var platformPlugins = isMobileDevice && isSectionTheme(sectionResult, 'mobile', 'mobile') ? filterLegacyMobilePlugins(mobilePlugins) : isMobileDevice && hasSection(sectionResult, 'mobile') ? mobilePlugins : desktopPlugins;\n    var combinedPlugins = combinePlugins(forcedPlugins, platformPlugins);\n    return Tools.extend(settings, {\n      plugins: combinedPlugins.join(' ')\n    });\n  };\n\n  var isOnMobile = function (isMobileDevice, sectionResult) {\n    return isMobileDevice && hasSection(sectionResult, 'mobile');\n  };\n\n  var combineSettings = function (isMobileDevice, isPhone, defaultSettings, defaultOverrideSettings, settings) {\n    var defaultDeviceSettings = isMobileDevice ? {\n      mobile: getDefaultMobileSettings(settings.mobile || {}, isPhone)\n    } : {};\n    var sectionResult = extractSections(['mobile'], deepMerge(defaultDeviceSettings, settings));\n    var extendedSettings = Tools.extend(defaultSettings, defaultOverrideSettings, sectionResult.settings(), isOnMobile(isMobileDevice, sectionResult) ? getSection(sectionResult, 'mobile') : {}, {\n      validate: true,\n      external_plugins: getExternalPlugins$1(defaultOverrideSettings, sectionResult.settings())\n    });\n    return processPlugins(isMobileDevice, sectionResult, defaultOverrideSettings, extendedSettings);\n  };\n\n  var getEditorSettings = function (editor, id, documentBaseUrl, defaultOverrideSettings, settings) {\n    var defaultSettings = getDefaultSettings(settings, id, documentBaseUrl, isTouch, editor);\n    return combineSettings(isPhone || isTablet, isPhone, defaultSettings, defaultOverrideSettings, settings);\n  };\n\n  var getFiltered = function (predicate, editor, name) {\n    return Optional.from(editor.settings[name]).filter(predicate);\n  };\n\n  var getParamObject = function (value) {\n    var output = {};\n\n    if (typeof value === 'string') {\n      each(value.indexOf('=') > 0 ? value.split(/[;,](?![^=;,]*(?:[;,]|$))/) : value.split(','), function (val) {\n        var arr = val.split('=');\n\n        if (arr.length > 1) {\n          output[Tools.trim(arr[0])] = Tools.trim(arr[1]);\n        } else {\n          output[Tools.trim(arr[0])] = Tools.trim(arr[0]);\n        }\n      });\n    } else {\n      output = value;\n    }\n\n    return output;\n  };\n\n  var isArrayOf = function (p) {\n    return function (a) {\n      return isArray(a) && forall(a, p);\n    };\n  };\n\n  var getParam = function (editor, name, defaultVal, type) {\n    var value = name in editor.settings ? editor.settings[name] : defaultVal;\n\n    if (type === 'hash') {\n      return getParamObject(value);\n    } else if (type === 'string') {\n      return getFiltered(isString, editor, name).getOr(defaultVal);\n    } else if (type === 'number') {\n      return getFiltered(isNumber, editor, name).getOr(defaultVal);\n    } else if (type === 'boolean') {\n      return getFiltered(isBoolean, editor, name).getOr(defaultVal);\n    } else if (type === 'object') {\n      return getFiltered(isObject, editor, name).getOr(defaultVal);\n    } else if (type === 'array') {\n      return getFiltered(isArray, editor, name).getOr(defaultVal);\n    } else if (type === 'string[]') {\n      return getFiltered(isArrayOf(isString), editor, name).getOr(defaultVal);\n    } else if (type === 'function') {\n      return getFiltered(isFunction, editor, name).getOr(defaultVal);\n    } else {\n      return value;\n    }\n  };\n\n  var CreateIconManager = function () {\n    var lookup = {};\n\n    var add = function (id, iconPack) {\n      lookup[id] = iconPack;\n    };\n\n    var get = function (id) {\n      if (lookup[id]) {\n        return lookup[id];\n      }\n\n      return {\n        icons: {}\n      };\n    };\n\n    var has$1 = function (id) {\n      return has(lookup, id);\n    };\n\n    return {\n      add: add,\n      get: get,\n      has: has$1\n    };\n  };\n\n  var IconManager = CreateIconManager();\n\n  var getProp = function (propName, elm) {\n    var rawElm = elm.dom;\n    return rawElm[propName];\n  };\n\n  var getComputedSizeProp = function (propName, elm) {\n    return parseInt(get$4(elm, propName), 10);\n  };\n\n  var getClientWidth = curry(getProp, 'clientWidth');\n  var getClientHeight = curry(getProp, 'clientHeight');\n  var getMarginTop = curry(getComputedSizeProp, 'margin-top');\n  var getMarginLeft = curry(getComputedSizeProp, 'margin-left');\n\n  var getBoundingClientRect$1 = function (elm) {\n    return elm.dom.getBoundingClientRect();\n  };\n\n  var isInsideElementContentArea = function (bodyElm, clientX, clientY) {\n    var clientWidth = getClientWidth(bodyElm);\n    var clientHeight = getClientHeight(bodyElm);\n    return clientX >= 0 && clientY >= 0 && clientX <= clientWidth && clientY <= clientHeight;\n  };\n\n  var transpose = function (inline, elm, clientX, clientY) {\n    var clientRect = getBoundingClientRect$1(elm);\n    var deltaX = inline ? clientRect.left + elm.dom.clientLeft + getMarginLeft(elm) : 0;\n    var deltaY = inline ? clientRect.top + elm.dom.clientTop + getMarginTop(elm) : 0;\n    var x = clientX - deltaX;\n    var y = clientY - deltaY;\n    return {\n      x: x,\n      y: y\n    };\n  };\n\n  var isXYInContentArea = function (editor, clientX, clientY) {\n    var bodyElm = SugarElement.fromDom(editor.getBody());\n    var targetElm = editor.inline ? bodyElm : documentElement(bodyElm);\n    var transposedPoint = transpose(editor.inline, targetElm, clientX, clientY);\n    return isInsideElementContentArea(targetElm, transposedPoint.x, transposedPoint.y);\n  };\n\n  var fromDomSafe = function (node) {\n    return Optional.from(node).map(SugarElement.fromDom);\n  };\n\n  var isEditorAttachedToDom = function (editor) {\n    var rawContainer = editor.inline ? editor.getBody() : editor.getContentAreaContainer();\n    return fromDomSafe(rawContainer).map(inBody).getOr(false);\n  };\n\n  function NotificationManagerImpl() {\n    var unimplemented = function () {\n      throw new Error('Theme did not provide a NotificationManager implementation.');\n    };\n\n    return {\n      open: unimplemented,\n      close: unimplemented,\n      reposition: unimplemented,\n      getArgs: unimplemented\n    };\n  }\n\n  function NotificationManager(editor) {\n    var notifications = [];\n\n    var getImplementation = function () {\n      var theme = editor.theme;\n      return theme && theme.getNotificationManagerImpl ? theme.getNotificationManagerImpl() : NotificationManagerImpl();\n    };\n\n    var getTopNotification = function () {\n      return Optional.from(notifications[0]);\n    };\n\n    var isEqual = function (a, b) {\n      return a.type === b.type && a.text === b.text && !a.progressBar && !a.timeout && !b.progressBar && !b.timeout;\n    };\n\n    var reposition = function () {\n      if (notifications.length > 0) {\n        getImplementation().reposition(notifications);\n      }\n    };\n\n    var addNotification = function (notification) {\n      notifications.push(notification);\n    };\n\n    var closeNotification = function (notification) {\n      findIndex(notifications, function (otherNotification) {\n        return otherNotification === notification;\n      }).each(function (index) {\n        notifications.splice(index, 1);\n      });\n    };\n\n    var open = function (spec) {\n      if (editor.removed || !isEditorAttachedToDom(editor)) {\n        return;\n      }\n\n      return find(notifications, function (notification) {\n        return isEqual(getImplementation().getArgs(notification), spec);\n      }).getOrThunk(function () {\n        editor.editorManager.setActive(editor);\n        var notification = getImplementation().open(spec, function () {\n          closeNotification(notification);\n          reposition();\n          getTopNotification().fold(function () {\n            return editor.focus();\n          }, function (top) {\n            return focus(SugarElement.fromDom(top.getEl()));\n          });\n        });\n        addNotification(notification);\n        reposition();\n        return notification;\n      });\n    };\n\n    var close = function () {\n      getTopNotification().each(function (notification) {\n        getImplementation().close(notification);\n        closeNotification(notification);\n        reposition();\n      });\n    };\n\n    var getNotifications = function () {\n      return notifications;\n    };\n\n    var registerEvents = function (editor) {\n      editor.on('SkinLoaded', function () {\n        var serviceMessage = getServiceMessage(editor);\n\n        if (serviceMessage) {\n          open({\n            text: serviceMessage,\n            type: 'warning',\n            timeout: 0\n          });\n        }\n      });\n      editor.on('ResizeEditor ResizeWindow NodeChange', function () {\n        Delay.requestAnimationFrame(reposition);\n      });\n      editor.on('remove', function () {\n        each(notifications.slice(), function (notification) {\n          getImplementation().close(notification);\n        });\n      });\n    };\n\n    registerEvents(editor);\n    return {\n      open: open,\n      close: close,\n      getNotifications: getNotifications\n    };\n  }\n\n  var PluginManager = AddOnManager$1.PluginManager;\n  var ThemeManager = AddOnManager$1.ThemeManager;\n\n  function WindowManagerImpl() {\n    var unimplemented = function () {\n      throw new Error('Theme did not provide a WindowManager implementation.');\n    };\n\n    return {\n      open: unimplemented,\n      openUrl: unimplemented,\n      alert: unimplemented,\n      confirm: unimplemented,\n      close: unimplemented,\n      getParams: unimplemented,\n      setParams: unimplemented\n    };\n  }\n\n  var WindowManager = function (editor) {\n    var dialogs = [];\n\n    var getImplementation = function () {\n      var theme = editor.theme;\n      return theme && theme.getWindowManagerImpl ? theme.getWindowManagerImpl() : WindowManagerImpl();\n    };\n\n    var funcBind = function (scope, f) {\n      return function () {\n        return f ? f.apply(scope, arguments) : undefined;\n      };\n    };\n\n    var fireOpenEvent = function (dialog) {\n      editor.fire('OpenWindow', {\n        dialog: dialog\n      });\n    };\n\n    var fireCloseEvent = function (dialog) {\n      editor.fire('CloseWindow', {\n        dialog: dialog\n      });\n    };\n\n    var addDialog = function (dialog) {\n      dialogs.push(dialog);\n      fireOpenEvent(dialog);\n    };\n\n    var closeDialog = function (dialog) {\n      fireCloseEvent(dialog);\n      dialogs = filter(dialogs, function (otherDialog) {\n        return otherDialog !== dialog;\n      });\n\n      if (dialogs.length === 0) {\n        editor.focus();\n      }\n    };\n\n    var getTopDialog = function () {\n      return Optional.from(dialogs[dialogs.length - 1]);\n    };\n\n    var storeSelectionAndOpenDialog = function (openDialog) {\n      editor.editorManager.setActive(editor);\n      store(editor);\n      var dialog = openDialog();\n      addDialog(dialog);\n      return dialog;\n    };\n\n    var open = function (args, params) {\n      return storeSelectionAndOpenDialog(function () {\n        return getImplementation().open(args, params, closeDialog);\n      });\n    };\n\n    var openUrl = function (args) {\n      return storeSelectionAndOpenDialog(function () {\n        return getImplementation().openUrl(args, closeDialog);\n      });\n    };\n\n    var alert = function (message, callback, scope) {\n      getImplementation().alert(message, funcBind(scope ? scope : this, callback));\n    };\n\n    var confirm = function (message, callback, scope) {\n      getImplementation().confirm(message, funcBind(scope ? scope : this, callback));\n    };\n\n    var close = function () {\n      getTopDialog().each(function (dialog) {\n        getImplementation().close(dialog);\n        closeDialog(dialog);\n      });\n    };\n\n    editor.on('remove', function () {\n      each(dialogs, function (dialog) {\n        getImplementation().close(dialog);\n      });\n    });\n    return {\n      open: open,\n      openUrl: openUrl,\n      alert: alert,\n      confirm: confirm,\n      close: close\n    };\n  };\n\n  var displayNotification = function (editor, message) {\n    editor.notificationManager.open({\n      type: 'error',\n      text: message\n    });\n  };\n\n  var displayError = function (editor, message) {\n    if (editor._skinLoaded) {\n      displayNotification(editor, message);\n    } else {\n      editor.on('SkinLoaded', function () {\n        displayNotification(editor, message);\n      });\n    }\n  };\n\n  var uploadError = function (editor, message) {\n    displayError(editor, I18n.translate(['Failed to upload image: {0}', message]));\n  };\n\n  var logError = function (editor, errorType, msg) {\n    fireError(editor, errorType, {\n      message: msg\n    });\n    console.error(msg);\n  };\n\n  var createLoadError = function (type, url, name) {\n    return name ? 'Failed to load ' + type + ': ' + name + ' from url ' + url : 'Failed to load ' + type + ' url: ' + url;\n  };\n\n  var pluginLoadError = function (editor, url, name) {\n    logError(editor, 'PluginLoadError', createLoadError('plugin', url, name));\n  };\n\n  var iconsLoadError = function (editor, url, name) {\n    logError(editor, 'IconsLoadError', createLoadError('icons', url, name));\n  };\n\n  var languageLoadError = function (editor, url, name) {\n    logError(editor, 'LanguageLoadError', createLoadError('language', url, name));\n  };\n\n  var pluginInitError = function (editor, name, err) {\n    var message = I18n.translate(['Failed to initialize plugin: {0}', name]);\n    initError(message, err);\n    displayError(editor, message);\n  };\n\n  var initError = function (message) {\n    var x = [];\n\n    for (var _i = 1; _i < arguments.length; _i++) {\n      x[_i - 1] = arguments[_i];\n    }\n\n    var console = window.console;\n\n    if (console) {\n      if (console.error) {\n        console.error.apply(console, __spreadArrays([message], x));\n      } else {\n        console.log.apply(console, __spreadArrays([message], x));\n      }\n    }\n  };\n\n  var isContentCssSkinName = function (url) {\n    return /^[a-z0-9\\-]+$/i.test(url);\n  };\n\n  var getContentCssUrls = function (editor) {\n    var contentCss = getContentCss(editor);\n    var skinUrl = editor.editorManager.baseURL + '/skins/content';\n    var suffix = editor.editorManager.suffix;\n    var contentCssFile = 'content' + suffix + '.css';\n    var inline = editor.inline === true;\n    return map(contentCss, function (url) {\n      if (isContentCssSkinName(url) && !inline) {\n        return skinUrl + '/' + url + '/' + contentCssFile;\n      } else {\n        return editor.documentBaseURI.toAbsolute(url);\n      }\n    });\n  };\n\n  var appendContentCssFromSettings = function (editor) {\n    editor.contentCSS = editor.contentCSS.concat(getContentCssUrls(editor));\n  };\n\n  function Uploader(uploadStatus, settings) {\n    var pendingPromises = {};\n\n    var pathJoin = function (path1, path2) {\n      if (path1) {\n        return path1.replace(/\\/$/, '') + '/' + path2.replace(/^\\//, '');\n      }\n\n      return path2;\n    };\n\n    var defaultHandler = function (blobInfo, success, failure, progress) {\n      var xhr = new XMLHttpRequest();\n      xhr.open('POST', settings.url);\n      xhr.withCredentials = settings.credentials;\n\n      xhr.upload.onprogress = function (e) {\n        progress(e.loaded / e.total * 100);\n      };\n\n      xhr.onerror = function () {\n        failure('Image upload failed due to a XHR Transport error. Code: ' + xhr.status);\n      };\n\n      xhr.onload = function () {\n        if (xhr.status < 200 || xhr.status >= 300) {\n          failure('HTTP Error: ' + xhr.status);\n          return;\n        }\n\n        var json = JSON.parse(xhr.responseText);\n\n        if (!json || typeof json.location !== 'string') {\n          failure('Invalid JSON: ' + xhr.responseText);\n          return;\n        }\n\n        success(pathJoin(settings.basePath, json.location));\n      };\n\n      var formData = new FormData();\n      formData.append('file', blobInfo.blob(), blobInfo.filename());\n      xhr.send(formData);\n    };\n\n    var noUpload = function () {\n      return new promiseObj(function (resolve) {\n        resolve([]);\n      });\n    };\n\n    var handlerSuccess = function (blobInfo, url) {\n      return {\n        url: url,\n        blobInfo: blobInfo,\n        status: true\n      };\n    };\n\n    var handlerFailure = function (blobInfo, message, options) {\n      return {\n        url: '',\n        blobInfo: blobInfo,\n        status: false,\n        error: {\n          message: message,\n          options: options\n        }\n      };\n    };\n\n    var resolvePending = function (blobUri, result) {\n      Tools.each(pendingPromises[blobUri], function (resolve) {\n        resolve(result);\n      });\n      delete pendingPromises[blobUri];\n    };\n\n    var uploadBlobInfo = function (blobInfo, handler, openNotification) {\n      uploadStatus.markPending(blobInfo.blobUri());\n      return new promiseObj(function (resolve) {\n        var notification, progress;\n\n        var noop = function () {};\n\n        try {\n          var closeNotification_1 = function () {\n            if (notification) {\n              notification.close();\n              progress = noop;\n            }\n          };\n\n          var success = function (url) {\n            closeNotification_1();\n            uploadStatus.markUploaded(blobInfo.blobUri(), url);\n            resolvePending(blobInfo.blobUri(), handlerSuccess(blobInfo, url));\n            resolve(handlerSuccess(blobInfo, url));\n          };\n\n          var failure = function (error, options) {\n            var failureOptions = options ? options : {};\n            closeNotification_1();\n            uploadStatus.removeFailed(blobInfo.blobUri());\n            resolvePending(blobInfo.blobUri(), handlerFailure(blobInfo, error, failureOptions));\n            resolve(handlerFailure(blobInfo, error, failureOptions));\n          };\n\n          progress = function (percent) {\n            if (percent < 0 || percent > 100) {\n              return;\n            }\n\n            if (!notification) {\n              notification = openNotification();\n            }\n\n            notification.progressBar.value(percent);\n          };\n\n          handler(blobInfo, success, failure, progress);\n        } catch (ex) {\n          resolve(handlerFailure(blobInfo, ex.message, {}));\n        }\n      });\n    };\n\n    var isDefaultHandler = function (handler) {\n      return handler === defaultHandler;\n    };\n\n    var pendingUploadBlobInfo = function (blobInfo) {\n      var blobUri = blobInfo.blobUri();\n      return new promiseObj(function (resolve) {\n        pendingPromises[blobUri] = pendingPromises[blobUri] || [];\n        pendingPromises[blobUri].push(resolve);\n      });\n    };\n\n    var uploadBlobs = function (blobInfos, openNotification) {\n      blobInfos = Tools.grep(blobInfos, function (blobInfo) {\n        return !uploadStatus.isUploaded(blobInfo.blobUri());\n      });\n      return promiseObj.all(Tools.map(blobInfos, function (blobInfo) {\n        return uploadStatus.isPending(blobInfo.blobUri()) ? pendingUploadBlobInfo(blobInfo) : uploadBlobInfo(blobInfo, settings.handler, openNotification);\n      }));\n    };\n\n    var upload = function (blobInfos, openNotification) {\n      return !settings.url && isDefaultHandler(settings.handler) ? noUpload() : uploadBlobs(blobInfos, openNotification);\n    };\n\n    if (isFunction(settings.handler) === false) {\n      settings.handler = defaultHandler;\n    }\n\n    return {\n      upload: upload\n    };\n  }\n\n  function UploadStatus() {\n    var PENDING = 1,\n        UPLOADED = 2;\n    var blobUriStatuses = {};\n\n    var createStatus = function (status, resultUri) {\n      return {\n        status: status,\n        resultUri: resultUri\n      };\n    };\n\n    var hasBlobUri = function (blobUri) {\n      return blobUri in blobUriStatuses;\n    };\n\n    var getResultUri = function (blobUri) {\n      var result = blobUriStatuses[blobUri];\n      return result ? result.resultUri : null;\n    };\n\n    var isPending = function (blobUri) {\n      return hasBlobUri(blobUri) ? blobUriStatuses[blobUri].status === PENDING : false;\n    };\n\n    var isUploaded = function (blobUri) {\n      return hasBlobUri(blobUri) ? blobUriStatuses[blobUri].status === UPLOADED : false;\n    };\n\n    var markPending = function (blobUri) {\n      blobUriStatuses[blobUri] = createStatus(PENDING, null);\n    };\n\n    var markUploaded = function (blobUri, resultUri) {\n      blobUriStatuses[blobUri] = createStatus(UPLOADED, resultUri);\n    };\n\n    var removeFailed = function (blobUri) {\n      delete blobUriStatuses[blobUri];\n    };\n\n    var destroy = function () {\n      blobUriStatuses = {};\n    };\n\n    return {\n      hasBlobUri: hasBlobUri,\n      getResultUri: getResultUri,\n      isPending: isPending,\n      isUploaded: isUploaded,\n      markPending: markPending,\n      markUploaded: markUploaded,\n      removeFailed: removeFailed,\n      destroy: destroy\n    };\n  }\n\n  var count$1 = 0;\n\n  var seed = function () {\n    var rnd = function () {\n      return Math.round(Math.random() * 4294967295).toString(36);\n    };\n\n    var now = new Date().getTime();\n    return 's' + now.toString(36) + rnd() + rnd() + rnd();\n  };\n\n  var uuid = function (prefix) {\n    return prefix + count$1++ + seed();\n  };\n\n  var BlobCache = function () {\n    var cache = [];\n\n    var mimeToExt = function (mime) {\n      var mimes = {\n        'image/jpeg': 'jpg',\n        'image/jpg': 'jpg',\n        'image/gif': 'gif',\n        'image/png': 'png'\n      };\n      return mimes[mime.toLowerCase()] || 'dat';\n    };\n\n    var create = function (o, blob, base64, filename) {\n      if (isString(o)) {\n        var id = o;\n        return toBlobInfo({\n          id: id,\n          name: filename,\n          blob: blob,\n          base64: base64\n        });\n      } else if (isObject(o)) {\n        return toBlobInfo(o);\n      } else {\n        throw new Error('Unknown input type');\n      }\n    };\n\n    var toBlobInfo = function (o) {\n      if (!o.blob || !o.base64) {\n        throw new Error('blob and base64 representations of the image are required for BlobInfo to be created');\n      }\n\n      var id = o.id || uuid('blobid');\n      var name = o.name || id;\n      return {\n        id: constant(id),\n        name: constant(name),\n        filename: constant(name + '.' + mimeToExt(o.blob.type)),\n        blob: constant(o.blob),\n        base64: constant(o.base64),\n        blobUri: constant(o.blobUri || URL.createObjectURL(o.blob)),\n        uri: constant(o.uri)\n      };\n    };\n\n    var add = function (blobInfo) {\n      if (!get(blobInfo.id())) {\n        cache.push(blobInfo);\n      }\n    };\n\n    var findFirst = function (predicate) {\n      return find(cache, predicate).getOrUndefined();\n    };\n\n    var get = function (id) {\n      return findFirst(function (cachedBlobInfo) {\n        return cachedBlobInfo.id() === id;\n      });\n    };\n\n    var getByUri = function (blobUri) {\n      return findFirst(function (blobInfo) {\n        return blobInfo.blobUri() === blobUri;\n      });\n    };\n\n    var getByData = function (base64, type) {\n      return findFirst(function (blobInfo) {\n        return blobInfo.base64() === base64 && blobInfo.blob().type === type;\n      });\n    };\n\n    var removeByUri = function (blobUri) {\n      cache = filter(cache, function (blobInfo) {\n        if (blobInfo.blobUri() === blobUri) {\n          URL.revokeObjectURL(blobInfo.blobUri());\n          return false;\n        }\n\n        return true;\n      });\n    };\n\n    var destroy = function () {\n      each(cache, function (cachedBlobInfo) {\n        URL.revokeObjectURL(cachedBlobInfo.blobUri());\n      });\n      cache = [];\n    };\n\n    return {\n      create: create,\n      add: add,\n      get: get,\n      getByUri: getByUri,\n      getByData: getByData,\n      findFirst: findFirst,\n      removeByUri: removeByUri,\n      destroy: destroy\n    };\n  };\n\n  var EditorUpload = function (editor) {\n    var blobCache = BlobCache();\n    var uploader, imageScanner;\n    var uploadStatus = UploadStatus();\n    var urlFilters = [];\n\n    var aliveGuard = function (callback) {\n      return function (result) {\n        if (editor.selection) {\n          return callback(result);\n        }\n\n        return [];\n      };\n    };\n\n    var cacheInvalidator = function (url) {\n      return url + (url.indexOf('?') === -1 ? '?' : '&') + new Date().getTime();\n    };\n\n    var replaceString = function (content, search, replace) {\n      var index = 0;\n\n      do {\n        index = content.indexOf(search, index);\n\n        if (index !== -1) {\n          content = content.substring(0, index) + replace + content.substr(index + search.length);\n          index += replace.length - search.length + 1;\n        }\n      } while (index !== -1);\n\n      return content;\n    };\n\n    var replaceImageUrl = function (content, targetUrl, replacementUrl) {\n      var replacementString = 'src=\"' + replacementUrl + '\"' + (replacementUrl === Env.transparentSrc ? ' data-mce-placeholder=\"1\"' : '');\n      content = replaceString(content, 'src=\"' + targetUrl + '\"', replacementString);\n      content = replaceString(content, 'data-mce-src=\"' + targetUrl + '\"', 'data-mce-src=\"' + replacementUrl + '\"');\n      return content;\n    };\n\n    var replaceUrlInUndoStack = function (targetUrl, replacementUrl) {\n      each(editor.undoManager.data, function (level) {\n        if (level.type === 'fragmented') {\n          level.fragments = map(level.fragments, function (fragment) {\n            return replaceImageUrl(fragment, targetUrl, replacementUrl);\n          });\n        } else {\n          level.content = replaceImageUrl(level.content, targetUrl, replacementUrl);\n        }\n      });\n    };\n\n    var openNotification = function () {\n      return editor.notificationManager.open({\n        text: editor.translate('Image uploading...'),\n        type: 'info',\n        timeout: -1,\n        progressBar: true\n      });\n    };\n\n    var replaceImageUriInView = function (image, resultUri) {\n      var src = editor.convertURL(resultUri, 'src');\n      replaceUrlInUndoStack(image.src, resultUri);\n      editor.$(image).attr({\n        'src': shouldReuseFileName(editor) ? cacheInvalidator(resultUri) : resultUri,\n        'data-mce-src': src\n      });\n    };\n\n    var uploadImages = function (callback) {\n      if (!uploader) {\n        uploader = Uploader(uploadStatus, {\n          url: getImageUploadUrl(editor),\n          basePath: getImageUploadBasePath(editor),\n          credentials: getImagesUploadCredentials(editor),\n          handler: getImagesUploadHandler(editor)\n        });\n      }\n\n      return scanForImages().then(aliveGuard(function (imageInfos) {\n        var blobInfos = map(imageInfos, function (imageInfo) {\n          return imageInfo.blobInfo;\n        });\n        return uploader.upload(blobInfos, openNotification).then(aliveGuard(function (result) {\n          var imagesToRemove = [];\n          var filteredResult = map(result, function (uploadInfo, index) {\n            var blobInfo = imageInfos[index].blobInfo;\n            var image = imageInfos[index].image;\n\n            if (uploadInfo.status && shouldReplaceBlobUris(editor)) {\n              blobCache.removeByUri(image.src);\n              replaceImageUriInView(image, uploadInfo.url);\n            } else if (uploadInfo.error) {\n              if (uploadInfo.error.options.remove) {\n                replaceUrlInUndoStack(image.getAttribute('src'), Env.transparentSrc);\n                imagesToRemove.push(image);\n              }\n\n              uploadError(editor, uploadInfo.error.message);\n            }\n\n            return {\n              element: image,\n              status: uploadInfo.status,\n              uploadUri: uploadInfo.url,\n              blobInfo: blobInfo\n            };\n          });\n\n          if (imagesToRemove.length > 0) {\n            if (isRtc(editor)) {\n              console.error('Removing images on failed uploads is currently unsupported for RTC');\n            } else {\n              editor.undoManager.transact(function () {\n                each(imagesToRemove, function (element) {\n                  editor.dom.remove(element);\n                  blobCache.removeByUri(element.src);\n                });\n              });\n            }\n          }\n\n          if (callback) {\n            callback(filteredResult);\n          }\n\n          return filteredResult;\n        }));\n      }));\n    };\n\n    var uploadImagesAuto = function (callback) {\n      if (isAutomaticUploadsEnabled(editor)) {\n        return uploadImages(callback);\n      }\n    };\n\n    var isValidDataUriImage = function (imgElm) {\n      if (forall(urlFilters, function (filter) {\n        return filter(imgElm);\n      }) === false) {\n        return false;\n      }\n\n      if (imgElm.getAttribute('src').indexOf('data:') === 0) {\n        var dataImgFilter = getImagesDataImgFilter(editor);\n        return dataImgFilter(imgElm);\n      }\n\n      return true;\n    };\n\n    var addFilter = function (filter) {\n      urlFilters.push(filter);\n    };\n\n    var scanForImages = function () {\n      if (!imageScanner) {\n        imageScanner = ImageScanner(uploadStatus, blobCache);\n      }\n\n      return imageScanner.findAll(editor.getBody(), isValidDataUriImage).then(aliveGuard(function (result) {\n        result = filter(result, function (resultItem) {\n          if (typeof resultItem === 'string') {\n            displayError(editor, resultItem);\n            return false;\n          }\n\n          return true;\n        });\n        each(result, function (resultItem) {\n          replaceUrlInUndoStack(resultItem.image.src, resultItem.blobInfo.blobUri());\n          resultItem.image.src = resultItem.blobInfo.blobUri();\n          resultItem.image.removeAttribute('data-mce-src');\n        });\n        return result;\n      }));\n    };\n\n    var destroy = function () {\n      blobCache.destroy();\n      uploadStatus.destroy();\n      imageScanner = uploader = null;\n    };\n\n    var replaceBlobUris = function (content) {\n      return content.replace(/src=\"(blob:[^\"]+)\"/g, function (match, blobUri) {\n        var resultUri = uploadStatus.getResultUri(blobUri);\n\n        if (resultUri) {\n          return 'src=\"' + resultUri + '\"';\n        }\n\n        var blobInfo = blobCache.getByUri(blobUri);\n\n        if (!blobInfo) {\n          blobInfo = foldl(editor.editorManager.get(), function (result, editor) {\n            return result || editor.editorUpload && editor.editorUpload.blobCache.getByUri(blobUri);\n          }, null);\n        }\n\n        if (blobInfo) {\n          var blob = blobInfo.blob();\n          return 'src=\"data:' + blob.type + ';base64,' + blobInfo.base64() + '\"';\n        }\n\n        return match;\n      });\n    };\n\n    editor.on('SetContent', function () {\n      if (isAutomaticUploadsEnabled(editor)) {\n        uploadImagesAuto();\n      } else {\n        scanForImages();\n      }\n    });\n    editor.on('RawSaveContent', function (e) {\n      e.content = replaceBlobUris(e.content);\n    });\n    editor.on('GetContent', function (e) {\n      if (e.source_view || e.format === 'raw') {\n        return;\n      }\n\n      e.content = replaceBlobUris(e.content);\n    });\n    editor.on('PostRender', function () {\n      editor.parser.addNodeFilter('img', function (images) {\n        each(images, function (img) {\n          var src = img.attr('src');\n\n          if (blobCache.getByUri(src)) {\n            return;\n          }\n\n          var resultUri = uploadStatus.getResultUri(src);\n\n          if (resultUri) {\n            img.attr('src', resultUri);\n          }\n        });\n      });\n    });\n    return {\n      blobCache: blobCache,\n      addFilter: addFilter,\n      uploadImages: uploadImages,\n      uploadImagesAuto: uploadImagesAuto,\n      scanForImages: scanForImages,\n      destroy: destroy\n    };\n  };\n\n  var setup$5 = function (registeredFormatListeners, editor) {\n    var currentFormats = Cell({});\n    registeredFormatListeners.set({});\n    editor.on('NodeChange', function (e) {\n      updateAndFireChangeCallbacks(editor, e.element, currentFormats, registeredFormatListeners.get());\n    });\n  };\n\n  var updateAndFireChangeCallbacks = function (editor, elm, currentFormats, formatChangeData) {\n    var formatsList = keys(currentFormats.get());\n    var newFormats = {};\n    var matchedFormats = {};\n    var parents = filter(getParents$1(editor.dom, elm), function (node) {\n      return node.nodeType === 1 && !node.getAttribute('data-mce-bogus');\n    });\n    each$1(formatChangeData, function (data, format) {\n      Tools.each(parents, function (node) {\n        if (editor.formatter.matchNode(node, format, {}, data.similar)) {\n          if (formatsList.indexOf(format) === -1) {\n            each(data.callbacks, function (callback) {\n              callback(true, {\n                node: node,\n                format: format,\n                parents: parents\n              });\n            });\n            newFormats[format] = data.callbacks;\n          }\n\n          matchedFormats[format] = data.callbacks;\n          return false;\n        }\n\n        if (matchesUnInheritedFormatSelector(editor, node, format)) {\n          return false;\n        }\n      });\n    });\n    var remainingFormats = filterRemainingFormats(currentFormats.get(), matchedFormats, elm, parents);\n    currentFormats.set(__assign(__assign({}, newFormats), remainingFormats));\n  };\n\n  var filterRemainingFormats = function (currentFormats, matchedFormats, elm, parents) {\n    return bifilter(currentFormats, function (callbacks, format) {\n      if (!has(matchedFormats, format)) {\n        each(callbacks, function (callback) {\n          callback(false, {\n            node: elm,\n            format: format,\n            parents: parents\n          });\n        });\n        return false;\n      } else {\n        return true;\n      }\n    }).t;\n  };\n\n  var addListeners = function (registeredFormatListeners, formats, callback, similar) {\n    var formatChangeItems = registeredFormatListeners.get();\n    each(formats.split(','), function (format) {\n      if (!formatChangeItems[format]) {\n        formatChangeItems[format] = {\n          similar: similar,\n          callbacks: []\n        };\n      }\n\n      formatChangeItems[format].callbacks.push(callback);\n    });\n    registeredFormatListeners.set(formatChangeItems);\n  };\n\n  var removeListeners = function (registeredFormatListeners, formats, callback) {\n    var formatChangeItems = registeredFormatListeners.get();\n    each(formats.split(','), function (format) {\n      formatChangeItems[format].callbacks = filter(formatChangeItems[format].callbacks, function (c) {\n        return c !== callback;\n      });\n\n      if (formatChangeItems[format].callbacks.length === 0) {\n        delete formatChangeItems[format];\n      }\n    });\n    registeredFormatListeners.set(formatChangeItems);\n  };\n\n  var formatChanged = function (editor, registeredFormatListeners, formats, callback, similar) {\n    if (registeredFormatListeners.get() === null) {\n      setup$5(registeredFormatListeners, editor);\n    }\n\n    addListeners(registeredFormatListeners, formats, callback, similar);\n    return {\n      unbind: function () {\n        return removeListeners(registeredFormatListeners, formats, callback);\n      }\n    };\n  };\n\n  var get$9 = function (dom) {\n    var formats = {\n      valigntop: [{\n        selector: 'td,th',\n        styles: {\n          verticalAlign: 'top'\n        }\n      }],\n      valignmiddle: [{\n        selector: 'td,th',\n        styles: {\n          verticalAlign: 'middle'\n        }\n      }],\n      valignbottom: [{\n        selector: 'td,th',\n        styles: {\n          verticalAlign: 'bottom'\n        }\n      }],\n      alignleft: [{\n        selector: 'figure.image',\n        collapsed: false,\n        classes: 'align-left',\n        ceFalseOverride: true,\n        preview: 'font-family font-size'\n      }, {\n        selector: 'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',\n        styles: {\n          textAlign: 'left'\n        },\n        inherit: false,\n        preview: false,\n        defaultBlock: 'div'\n      }, {\n        selector: 'img,table',\n        collapsed: false,\n        styles: {\n          float: 'left'\n        },\n        preview: 'font-family font-size'\n      }],\n      aligncenter: [{\n        selector: 'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',\n        styles: {\n          textAlign: 'center'\n        },\n        inherit: false,\n        preview: 'font-family font-size',\n        defaultBlock: 'div'\n      }, {\n        selector: 'figure.image',\n        collapsed: false,\n        classes: 'align-center',\n        ceFalseOverride: true,\n        preview: 'font-family font-size'\n      }, {\n        selector: 'img',\n        collapsed: false,\n        styles: {\n          display: 'block',\n          marginLeft: 'auto',\n          marginRight: 'auto'\n        },\n        preview: false\n      }, {\n        selector: 'table',\n        collapsed: false,\n        styles: {\n          marginLeft: 'auto',\n          marginRight: 'auto'\n        },\n        preview: 'font-family font-size'\n      }],\n      alignright: [{\n        selector: 'figure.image',\n        collapsed: false,\n        classes: 'align-right',\n        ceFalseOverride: true,\n        preview: 'font-family font-size'\n      }, {\n        selector: 'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',\n        styles: {\n          textAlign: 'right'\n        },\n        inherit: false,\n        preview: 'font-family font-size',\n        defaultBlock: 'div'\n      }, {\n        selector: 'img,table',\n        collapsed: false,\n        styles: {\n          float: 'right'\n        },\n        preview: 'font-family font-size'\n      }],\n      alignjustify: [{\n        selector: 'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',\n        styles: {\n          textAlign: 'justify'\n        },\n        inherit: false,\n        defaultBlock: 'div',\n        preview: 'font-family font-size'\n      }],\n      bold: [{\n        inline: 'strong',\n        remove: 'all',\n        preserve_attributes: ['class', 'style']\n      }, {\n        inline: 'span',\n        styles: {\n          fontWeight: 'bold'\n        }\n      }, {\n        inline: 'b',\n        remove: 'all',\n        preserve_attributes: ['class', 'style']\n      }],\n      italic: [{\n        inline: 'em',\n        remove: 'all',\n        preserve_attributes: ['class', 'style']\n      }, {\n        inline: 'span',\n        styles: {\n          fontStyle: 'italic'\n        }\n      }, {\n        inline: 'i',\n        remove: 'all',\n        preserve_attributes: ['class', 'style']\n      }],\n      underline: [{\n        inline: 'span',\n        styles: {\n          textDecoration: 'underline'\n        },\n        exact: true\n      }, {\n        inline: 'u',\n        remove: 'all',\n        preserve_attributes: ['class', 'style']\n      }],\n      strikethrough: [{\n        inline: 'span',\n        styles: {\n          textDecoration: 'line-through'\n        },\n        exact: true\n      }, {\n        inline: 'strike',\n        remove: 'all',\n        preserve_attributes: ['class', 'style']\n      }],\n      forecolor: {\n        inline: 'span',\n        styles: {\n          color: '%value'\n        },\n        links: true,\n        remove_similar: true,\n        clear_child_styles: true\n      },\n      hilitecolor: {\n        inline: 'span',\n        styles: {\n          backgroundColor: '%value'\n        },\n        links: true,\n        remove_similar: true,\n        clear_child_styles: true\n      },\n      fontname: {\n        inline: 'span',\n        toggle: false,\n        styles: {\n          fontFamily: '%value'\n        },\n        clear_child_styles: true\n      },\n      fontsize: {\n        inline: 'span',\n        toggle: false,\n        styles: {\n          fontSize: '%value'\n        },\n        clear_child_styles: true\n      },\n      lineheight: {\n        selector: 'h1,h2,h3,h4,h5,h6,p,li,td,th,div',\n        defaultBlock: 'p',\n        styles: {\n          lineHeight: '%value'\n        }\n      },\n      fontsize_class: {\n        inline: 'span',\n        attributes: {\n          class: '%value'\n        }\n      },\n      blockquote: {\n        block: 'blockquote',\n        wrapper: true,\n        remove: 'all'\n      },\n      subscript: {\n        inline: 'sub'\n      },\n      superscript: {\n        inline: 'sup'\n      },\n      code: {\n        inline: 'code'\n      },\n      link: {\n        inline: 'a',\n        selector: 'a',\n        remove: 'all',\n        split: true,\n        deep: true,\n        onmatch: function (node, _fmt, _itemName) {\n          return isElement$1(node) && node.hasAttribute('href');\n        },\n        onformat: function (elm, _fmt, vars) {\n          Tools.each(vars, function (value, key) {\n            dom.setAttrib(elm, key, value);\n          });\n        }\n      },\n      removeformat: [{\n        selector: 'b,strong,em,i,font,u,strike,sub,sup,dfn,code,samp,kbd,var,cite,mark,q,del,ins',\n        remove: 'all',\n        split: true,\n        expand: false,\n        block_expand: true,\n        deep: true\n      }, {\n        selector: 'span',\n        attributes: ['style', 'class'],\n        remove: 'empty',\n        split: true,\n        expand: false,\n        deep: true\n      }, {\n        selector: '*',\n        attributes: ['style', 'class'],\n        split: false,\n        expand: false,\n        deep: true\n      }]\n    };\n    Tools.each('p h1 h2 h3 h4 h5 h6 div address pre div dt dd samp'.split(/\\s/), function (name) {\n      formats[name] = {\n        block: name,\n        remove: 'all'\n      };\n    });\n    return formats;\n  };\n\n  function FormatRegistry(editor) {\n    var formats = {};\n\n    var get = function (name) {\n      return name ? formats[name] : formats;\n    };\n\n    var has$1 = function (name) {\n      return has(formats, name);\n    };\n\n    var register = function (name, format) {\n      if (name) {\n        if (typeof name !== 'string') {\n          Tools.each(name, function (format, name) {\n            register(name, format);\n          });\n        } else {\n          if (!isArray(format)) {\n            format = [format];\n          }\n\n          Tools.each(format, function (format) {\n            if (typeof format.deep === 'undefined') {\n              format.deep = !format.selector;\n            }\n\n            if (typeof format.split === 'undefined') {\n              format.split = !format.selector || format.inline;\n            }\n\n            if (typeof format.remove === 'undefined' && format.selector && !format.inline) {\n              format.remove = 'none';\n            }\n\n            if (format.selector && format.inline) {\n              format.mixed = true;\n              format.block_expand = true;\n            }\n\n            if (typeof format.classes === 'string') {\n              format.classes = format.classes.split(/\\s+/);\n            }\n          });\n          formats[name] = format;\n        }\n      }\n    };\n\n    var unregister = function (name) {\n      if (name && formats[name]) {\n        delete formats[name];\n      }\n\n      return formats;\n    };\n\n    register(get$9(editor.dom));\n    register(getFormats(editor));\n    return {\n      get: get,\n      has: has$1,\n      register: register,\n      unregister: unregister\n    };\n  }\n\n  var each$e = Tools.each;\n  var dom = DOMUtils$1.DOM;\n\n  var parsedSelectorToHtml = function (ancestry, editor) {\n    var elm, item, fragment;\n    var schema = editor && editor.schema || Schema({});\n\n    var decorate = function (elm, item) {\n      if (item.classes.length) {\n        dom.addClass(elm, item.classes.join(' '));\n      }\n\n      dom.setAttribs(elm, item.attrs);\n    };\n\n    var createElement = function (sItem) {\n      item = typeof sItem === 'string' ? {\n        name: sItem,\n        classes: [],\n        attrs: {}\n      } : sItem;\n      var elm = dom.create(item.name);\n      decorate(elm, item);\n      return elm;\n    };\n\n    var getRequiredParent = function (elm, candidate) {\n      var name = typeof elm !== 'string' ? elm.nodeName.toLowerCase() : elm;\n      var elmRule = schema.getElementRule(name);\n      var parentsRequired = elmRule && elmRule.parentsRequired;\n\n      if (parentsRequired && parentsRequired.length) {\n        return candidate && Tools.inArray(parentsRequired, candidate) !== -1 ? candidate : parentsRequired[0];\n      } else {\n        return false;\n      }\n    };\n\n    var wrapInHtml = function (elm, ancestry, siblings) {\n      var parent, parentCandidate;\n      var ancestor = ancestry.length > 0 && ancestry[0];\n      var ancestorName = ancestor && ancestor.name;\n      var parentRequired = getRequiredParent(elm, ancestorName);\n\n      if (parentRequired) {\n        if (ancestorName === parentRequired) {\n          parentCandidate = ancestry[0];\n          ancestry = ancestry.slice(1);\n        } else {\n          parentCandidate = parentRequired;\n        }\n      } else if (ancestor) {\n        parentCandidate = ancestry[0];\n        ancestry = ancestry.slice(1);\n      } else if (!siblings) {\n        return elm;\n      }\n\n      if (parentCandidate) {\n        parent = createElement(parentCandidate);\n        parent.appendChild(elm);\n      }\n\n      if (siblings) {\n        if (!parent) {\n          parent = dom.create('div');\n          parent.appendChild(elm);\n        }\n\n        Tools.each(siblings, function (sibling) {\n          var siblingElm = createElement(sibling);\n          parent.insertBefore(siblingElm, elm);\n        });\n      }\n\n      return wrapInHtml(parent, ancestry, parentCandidate && parentCandidate.siblings);\n    };\n\n    if (ancestry && ancestry.length) {\n      item = ancestry[0];\n      elm = createElement(item);\n      fragment = dom.create('div');\n      fragment.appendChild(wrapInHtml(elm, ancestry.slice(1), item.siblings));\n      return fragment;\n    } else {\n      return '';\n    }\n  };\n\n  var parseSelectorItem = function (item) {\n    var tagName;\n    var obj = {\n      classes: [],\n      attrs: {}\n    };\n    item = obj.selector = Tools.trim(item);\n\n    if (item !== '*') {\n      tagName = item.replace(/(?:([#\\.]|::?)([\\w\\-]+)|(\\[)([^\\]]+)\\]?)/g, function ($0, $1, $2, $3, $4) {\n        switch ($1) {\n          case '#':\n            obj.attrs.id = $2;\n            break;\n\n          case '.':\n            obj.classes.push($2);\n            break;\n\n          case ':':\n            if (Tools.inArray('checked disabled enabled read-only required'.split(' '), $2) !== -1) {\n              obj.attrs[$2] = $2;\n            }\n\n            break;\n        }\n\n        if ($3 === '[') {\n          var m = $4.match(/([\\w\\-]+)(?:\\=\\\"([^\\\"]+))?/);\n\n          if (m) {\n            obj.attrs[m[1]] = m[2];\n          }\n        }\n\n        return '';\n      });\n    }\n\n    obj.name = tagName || 'div';\n    return obj;\n  };\n\n  var parseSelector = function (selector) {\n    if (!selector || typeof selector !== 'string') {\n      return [];\n    }\n\n    selector = selector.split(/\\s*,\\s*/)[0];\n    selector = selector.replace(/\\s*(~\\+|~|\\+|>)\\s*/g, '$1');\n    return Tools.map(selector.split(/(?:>|\\s+(?![^\\[\\]]+\\]))/), function (item) {\n      var siblings = Tools.map(item.split(/(?:~\\+|~|\\+)/), parseSelectorItem);\n      var obj = siblings.pop();\n\n      if (siblings.length) {\n        obj.siblings = siblings;\n      }\n\n      return obj;\n    }).reverse();\n  };\n\n  var getCssText = function (editor, format) {\n    var name, previewFrag;\n    var previewCss = '',\n        parentFontSize;\n    var previewStyles = getPreviewStyles(editor);\n\n    if (previewStyles === '') {\n      return '';\n    }\n\n    var removeVars = function (val) {\n      return val.replace(/%(\\w+)/g, '');\n    };\n\n    if (typeof format === 'string') {\n      format = editor.formatter.get(format);\n\n      if (!format) {\n        return;\n      }\n\n      format = format[0];\n    }\n\n    if ('preview' in format) {\n      var previewOpt = get(format, 'preview');\n\n      if (previewOpt.is(false)) {\n        return '';\n      } else {\n        previewStyles = previewOpt.getOr(previewStyles);\n      }\n    }\n\n    name = format.block || format.inline || 'span';\n    var items = parseSelector(format.selector);\n\n    if (items.length) {\n      if (!items[0].name) {\n        items[0].name = name;\n      }\n\n      name = format.selector;\n      previewFrag = parsedSelectorToHtml(items, editor);\n    } else {\n      previewFrag = parsedSelectorToHtml([name], editor);\n    }\n\n    var previewElm = dom.select(name, previewFrag)[0] || previewFrag.firstChild;\n    each$e(format.styles, function (value, name) {\n      var newValue = removeVars(value);\n\n      if (newValue) {\n        dom.setStyle(previewElm, name, newValue);\n      }\n    });\n    each$e(format.attributes, function (value, name) {\n      var newValue = removeVars(value);\n\n      if (newValue) {\n        dom.setAttrib(previewElm, name, newValue);\n      }\n    });\n    each$e(format.classes, function (value) {\n      var newValue = removeVars(value);\n\n      if (!dom.hasClass(previewElm, newValue)) {\n        dom.addClass(previewElm, newValue);\n      }\n    });\n    editor.fire('PreviewFormats');\n    dom.setStyles(previewFrag, {\n      position: 'absolute',\n      left: -65535\n    });\n    editor.getBody().appendChild(previewFrag);\n    parentFontSize = dom.getStyle(editor.getBody(), 'fontSize', true);\n    parentFontSize = /px$/.test(parentFontSize) ? parseInt(parentFontSize, 10) : 0;\n    each$e(previewStyles.split(' '), function (name) {\n      var value = dom.getStyle(previewElm, name, true);\n\n      if (name === 'background-color' && /transparent|rgba\\s*\\([^)]+,\\s*0\\)/.test(value)) {\n        value = dom.getStyle(editor.getBody(), name, true);\n\n        if (dom.toHex(value).toLowerCase() === '#ffffff') {\n          return;\n        }\n      }\n\n      if (name === 'color') {\n        if (dom.toHex(value).toLowerCase() === '#000000') {\n          return;\n        }\n      }\n\n      if (name === 'font-size') {\n        if (/em|%$/.test(value)) {\n          if (parentFontSize === 0) {\n            return;\n          }\n\n          var numValue = parseFloat(value) / (/%$/.test(value) ? 100 : 1);\n          value = numValue * parentFontSize + 'px';\n        }\n      }\n\n      if (name === 'border' && value) {\n        previewCss += 'padding:0 2px;';\n      }\n\n      previewCss += name + ':' + value + ';';\n    });\n    editor.fire('AfterPreviewFormats');\n    dom.remove(previewFrag);\n    return previewCss;\n  };\n\n  var setup$6 = function (editor) {\n    editor.addShortcut('meta+b', '', 'Bold');\n    editor.addShortcut('meta+i', '', 'Italic');\n    editor.addShortcut('meta+u', '', 'Underline');\n\n    for (var i = 1; i <= 6; i++) {\n      editor.addShortcut('access+' + i, '', ['FormatBlock', false, 'h' + i]);\n    }\n\n    editor.addShortcut('access+7', '', ['FormatBlock', false, 'p']);\n    editor.addShortcut('access+8', '', ['FormatBlock', false, 'div']);\n    editor.addShortcut('access+9', '', ['FormatBlock', false, 'address']);\n  };\n\n  var Formatter = function (editor) {\n    var formats = FormatRegistry(editor);\n    var formatChangeState = Cell(null);\n    setup$6(editor);\n    setup$3(editor);\n    return {\n      get: formats.get,\n      has: formats.has,\n      register: formats.register,\n      unregister: formats.unregister,\n      apply: function (name, vars, node) {\n        applyFormat$1(editor, name, vars, node);\n      },\n      remove: function (name, vars, node, similar) {\n        removeFormat$1(editor, name, vars, node, similar);\n      },\n      toggle: function (name, vars, node) {\n        toggleFormat(editor, name, vars, node);\n      },\n      match: curry(match, editor),\n      matchAll: curry(matchAll, editor),\n      matchNode: curry(matchNode, editor),\n      canApply: curry(canApply, editor),\n      formatChanged: curry(formatChanged, editor, formatChangeState),\n      getCssText: curry(getCssText, editor)\n    };\n  };\n\n  var registerEvents$1 = function (editor, undoManager, locks) {\n    var isFirstTypedCharacter = Cell(false);\n\n    var addNonTypingUndoLevel = function (e) {\n      setTyping(undoManager, false, locks);\n      undoManager.add({}, e);\n    };\n\n    editor.on('init', function () {\n      undoManager.add();\n    });\n    editor.on('BeforeExecCommand', function (e) {\n      var cmd = e.command.toLowerCase();\n\n      if (cmd !== 'undo' && cmd !== 'redo' && cmd !== 'mcerepaint') {\n        endTyping(undoManager, locks);\n        undoManager.beforeChange();\n      }\n    });\n    editor.on('ExecCommand', function (e) {\n      var cmd = e.command.toLowerCase();\n\n      if (cmd !== 'undo' && cmd !== 'redo' && cmd !== 'mcerepaint') {\n        addNonTypingUndoLevel(e);\n      }\n    });\n    editor.on('ObjectResizeStart cut', function () {\n      undoManager.beforeChange();\n    });\n    editor.on('SaveContent ObjectResized blur', addNonTypingUndoLevel);\n    editor.on('dragend', addNonTypingUndoLevel);\n    editor.on('keyup', function (e) {\n      var keyCode = e.keyCode;\n\n      if (e.isDefaultPrevented()) {\n        return;\n      }\n\n      if (keyCode >= 33 && keyCode <= 36 || keyCode >= 37 && keyCode <= 40 || keyCode === 45 || e.ctrlKey) {\n        addNonTypingUndoLevel();\n        editor.nodeChanged();\n      }\n\n      if (keyCode === 46 || keyCode === 8) {\n        editor.nodeChanged();\n      }\n\n      if (isFirstTypedCharacter.get() && undoManager.typing && isEq$4(createFromEditor(editor), undoManager.data[0]) === false) {\n        if (editor.isDirty() === false) {\n          editor.setDirty(true);\n          editor.fire('change', {\n            level: undoManager.data[0],\n            lastLevel: null\n          });\n        }\n\n        editor.fire('TypingUndo');\n        isFirstTypedCharacter.set(false);\n        editor.nodeChanged();\n      }\n    });\n    editor.on('keydown', function (e) {\n      var keyCode = e.keyCode;\n\n      if (e.isDefaultPrevented()) {\n        return;\n      }\n\n      if (keyCode >= 33 && keyCode <= 36 || keyCode >= 37 && keyCode <= 40 || keyCode === 45) {\n        if (undoManager.typing) {\n          addNonTypingUndoLevel(e);\n        }\n\n        return;\n      }\n\n      var modKey = e.ctrlKey && !e.altKey || e.metaKey;\n\n      if ((keyCode < 16 || keyCode > 20) && keyCode !== 224 && keyCode !== 91 && !undoManager.typing && !modKey) {\n        undoManager.beforeChange();\n        setTyping(undoManager, true, locks);\n        undoManager.add({}, e);\n        isFirstTypedCharacter.set(true);\n      }\n    });\n    editor.on('mousedown', function (e) {\n      if (undoManager.typing) {\n        addNonTypingUndoLevel(e);\n      }\n    });\n\n    var isInsertReplacementText = function (event) {\n      return event.inputType === 'insertReplacementText';\n    };\n\n    var isInsertTextDataNull = function (event) {\n      return event.inputType === 'insertText' && event.data === null;\n    };\n\n    var isInsertFromPasteOrDrop = function (event) {\n      return event.inputType === 'insertFromPaste' || event.inputType === 'insertFromDrop';\n    };\n\n    editor.on('input', function (e) {\n      if (e.inputType && (isInsertReplacementText(e) || isInsertTextDataNull(e) || isInsertFromPasteOrDrop(e))) {\n        addNonTypingUndoLevel(e);\n      }\n    });\n    editor.on('AddUndo Undo Redo ClearUndos', function (e) {\n      if (!e.isDefaultPrevented()) {\n        editor.nodeChanged();\n      }\n    });\n  };\n\n  var addKeyboardShortcuts = function (editor) {\n    editor.addShortcut('meta+z', '', 'Undo');\n    editor.addShortcut('meta+y,meta+shift+z', '', 'Redo');\n  };\n\n  var UndoManager = function (editor) {\n    var beforeBookmark = Cell(Optional.none());\n    var locks = Cell(0);\n    var index = Cell(0);\n    var undoManager = {\n      data: [],\n      typing: false,\n      beforeChange: function () {\n        beforeChange$1(editor, locks, beforeBookmark);\n      },\n      add: function (level, event) {\n        return addUndoLevel$1(editor, undoManager, index, locks, beforeBookmark, level, event);\n      },\n      undo: function () {\n        return undo$1(editor, undoManager, locks, index);\n      },\n      redo: function () {\n        return redo$1(editor, index, undoManager.data);\n      },\n      clear: function () {\n        clear$1(editor, undoManager, index);\n      },\n      reset: function () {\n        reset$1(editor, undoManager);\n      },\n      hasUndo: function () {\n        return hasUndo$1(editor, undoManager, index);\n      },\n      hasRedo: function () {\n        return hasRedo$1(editor, undoManager, index);\n      },\n      transact: function (callback) {\n        return transact$1(editor, undoManager, locks, callback);\n      },\n      ignore: function (callback) {\n        ignore$1(editor, locks, callback);\n      },\n      extra: function (callback1, callback2) {\n        extra$1(editor, undoManager, index, callback1, callback2);\n      }\n    };\n\n    if (!isRtc(editor)) {\n      registerEvents$1(editor, undoManager, locks);\n    }\n\n    addKeyboardShortcuts(editor);\n    return undoManager;\n  };\n\n  var nonTypingKeycodes = [9, 27, VK.HOME, VK.END, 19, 20, 44, 144, 145, 33, 34, 45, 16, 17, 18, 91, 92, 93, VK.DOWN, VK.UP, VK.LEFT, VK.RIGHT].concat(Env.browser.isFirefox() ? [224] : []);\n  var placeholderAttr = 'data-mce-placeholder';\n\n  var isKeyboardEvent = function (e) {\n    return e.type === 'keydown' || e.type === 'keyup';\n  };\n\n  var isDeleteEvent = function (e) {\n    var keyCode = e.keyCode;\n    return keyCode === VK.BACKSPACE || keyCode === VK.DELETE;\n  };\n\n  var isNonTypingKeyboardEvent = function (e) {\n    if (isKeyboardEvent(e)) {\n      var keyCode = e.keyCode;\n      return !isDeleteEvent(e) && (VK.metaKeyPressed(e) || e.altKey || keyCode >= 112 && keyCode <= 123 || contains(nonTypingKeycodes, keyCode));\n    } else {\n      return false;\n    }\n  };\n\n  var isTypingKeyboardEvent = function (e) {\n    return isKeyboardEvent(e) && !(isDeleteEvent(e) || e.type === 'keyup' && e.keyCode === 229);\n  };\n\n  var isVisuallyEmpty = function (dom, rootElm, forcedRootBlock) {\n    if (isEmpty(SugarElement.fromDom(rootElm), false)) {\n      var isForcedRootBlockFalse = forcedRootBlock === '';\n      var firstElement = rootElm.firstElementChild;\n\n      if (!firstElement) {\n        return true;\n      } else if (dom.getStyle(rootElm.firstElementChild, 'padding-left') || dom.getStyle(rootElm.firstElementChild, 'padding-right')) {\n        return false;\n      } else {\n        return isForcedRootBlockFalse ? !dom.isBlock(firstElement) : forcedRootBlock === firstElement.nodeName.toLowerCase();\n      }\n    } else {\n      return false;\n    }\n  };\n\n  var setup$7 = function (editor) {\n    var dom = editor.dom;\n    var rootBlock = getForcedRootBlock(editor);\n    var placeholder = getPlaceholder(editor);\n\n    var updatePlaceholder = function (e, initial) {\n      if (isNonTypingKeyboardEvent(e)) {\n        return;\n      }\n\n      var body = editor.getBody();\n      var showPlaceholder = isTypingKeyboardEvent(e) ? false : isVisuallyEmpty(dom, body, rootBlock);\n      var isPlaceholderShown = dom.getAttrib(body, placeholderAttr) !== '';\n\n      if (isPlaceholderShown !== showPlaceholder || initial) {\n        dom.setAttrib(body, placeholderAttr, showPlaceholder ? placeholder : null);\n        dom.setAttrib(body, 'aria-placeholder', showPlaceholder ? placeholder : null);\n        firePlaceholderToggle(editor, showPlaceholder);\n        editor.on(showPlaceholder ? 'keydown' : 'keyup', updatePlaceholder);\n        editor.off(showPlaceholder ? 'keyup' : 'keydown', updatePlaceholder);\n      }\n    };\n\n    if (placeholder) {\n      editor.on('init', function (e) {\n        updatePlaceholder(e, true);\n        editor.on('change SetContent ExecCommand', updatePlaceholder);\n        editor.on('paste', function (e) {\n          return Delay.setEditorTimeout(editor, function () {\n            return updatePlaceholder(e);\n          });\n        });\n      });\n    }\n  };\n\n  var strongRtl = /[\\u0591-\\u07FF\\uFB1D-\\uFDFF\\uFE70-\\uFEFC]/;\n\n  var hasStrongRtl = function (text) {\n    return strongRtl.test(text);\n  };\n\n  var isInlineTarget = function (editor, elm) {\n    return is$1(SugarElement.fromDom(elm), getInlineBoundarySelector(editor));\n  };\n\n  var isRtl$1 = function (element) {\n    return DOMUtils$1.DOM.getStyle(element, 'direction', true) === 'rtl' || hasStrongRtl(element.textContent);\n  };\n\n  var findInlineParents = function (isInlineTarget, rootNode, pos) {\n    return filter(DOMUtils$1.DOM.getParents(pos.container(), '*', rootNode), isInlineTarget);\n  };\n\n  var findRootInline = function (isInlineTarget, rootNode, pos) {\n    var parents = findInlineParents(isInlineTarget, rootNode, pos);\n    return Optional.from(parents[parents.length - 1]);\n  };\n\n  var hasSameParentBlock = function (rootNode, node1, node2) {\n    var block1 = getParentBlock(node1, rootNode);\n    var block2 = getParentBlock(node2, rootNode);\n    return block1 && block1 === block2;\n  };\n\n  var isAtZwsp = function (pos) {\n    return isBeforeInline(pos) || isAfterInline(pos);\n  };\n\n  var normalizePosition = function (forward, pos) {\n    if (!pos) {\n      return pos;\n    }\n\n    var container = pos.container(),\n        offset = pos.offset();\n\n    if (forward) {\n      if (isCaretContainerInline(container)) {\n        if (isText$1(container.nextSibling)) {\n          return CaretPosition$1(container.nextSibling, 0);\n        } else {\n          return CaretPosition$1.after(container);\n        }\n      } else {\n        return isBeforeInline(pos) ? CaretPosition$1(container, offset + 1) : pos;\n      }\n    } else {\n      if (isCaretContainerInline(container)) {\n        if (isText$1(container.previousSibling)) {\n          return CaretPosition$1(container.previousSibling, container.previousSibling.data.length);\n        } else {\n          return CaretPosition$1.before(container);\n        }\n      } else {\n        return isAfterInline(pos) ? CaretPosition$1(container, offset - 1) : pos;\n      }\n    }\n  };\n\n  var normalizeForwards = curry(normalizePosition, true);\n  var normalizeBackwards = curry(normalizePosition, false);\n\n  var isBeforeRoot = function (rootNode) {\n    return function (elm) {\n      return eq$2(rootNode, SugarElement.fromDom(elm.dom.parentNode));\n    };\n  };\n\n  var getParentBlock$1 = function (rootNode, elm) {\n    return contains$2(rootNode, elm) ? closest(elm, function (element) {\n      return isTextBlock(element) || isListItem(element);\n    }, isBeforeRoot(rootNode)) : Optional.none();\n  };\n\n  var placeCaretInEmptyBody = function (editor) {\n    var body = editor.getBody();\n    var node = body.firstChild && editor.dom.isBlock(body.firstChild) ? body.firstChild : body;\n    editor.selection.setCursorLocation(node, 0);\n  };\n\n  var paddEmptyBody = function (editor) {\n    if (editor.dom.isEmpty(editor.getBody())) {\n      editor.setContent('');\n      placeCaretInEmptyBody(editor);\n    }\n  };\n\n  var willDeleteLastPositionInElement = function (forward, fromPos, elm) {\n    return lift2(firstPositionIn(elm), lastPositionIn(elm), function (firstPos, lastPos) {\n      var normalizedFirstPos = normalizePosition(true, firstPos);\n      var normalizedLastPos = normalizePosition(false, lastPos);\n      var normalizedFromPos = normalizePosition(false, fromPos);\n\n      if (forward) {\n        return nextPosition(elm, normalizedFromPos).exists(function (nextPos) {\n          return nextPos.isEqual(normalizedLastPos) && fromPos.isEqual(normalizedFirstPos);\n        });\n      } else {\n        return prevPosition(elm, normalizedFromPos).exists(function (prevPos) {\n          return prevPos.isEqual(normalizedFirstPos) && fromPos.isEqual(normalizedLastPos);\n        });\n      }\n    }).getOr(true);\n  };\n\n  var blockPosition = function (block, position) {\n    return {\n      block: block,\n      position: position\n    };\n  };\n\n  var blockBoundary = function (from, to) {\n    return {\n      from: from,\n      to: to\n    };\n  };\n\n  var getBlockPosition = function (rootNode, pos) {\n    var rootElm = SugarElement.fromDom(rootNode);\n    var containerElm = SugarElement.fromDom(pos.container());\n    return getParentBlock$1(rootElm, containerElm).map(function (block) {\n      return blockPosition(block, pos);\n    });\n  };\n\n  var isDifferentBlocks = function (blockBoundary) {\n    return eq$2(blockBoundary.from.block, blockBoundary.to.block) === false;\n  };\n\n  var hasSameParent = function (blockBoundary) {\n    return parent(blockBoundary.from.block).bind(function (parent1) {\n      return parent(blockBoundary.to.block).filter(function (parent2) {\n        return eq$2(parent1, parent2);\n      });\n    }).isSome();\n  };\n\n  var isEditable = function (blockBoundary) {\n    return isContentEditableFalse(blockBoundary.from.block.dom) === false && isContentEditableFalse(blockBoundary.to.block.dom) === false;\n  };\n\n  var skipLastBr = function (rootNode, forward, blockPosition) {\n    if (isBr(blockPosition.position.getNode()) && isEmpty(blockPosition.block) === false) {\n      return positionIn(false, blockPosition.block.dom).bind(function (lastPositionInBlock) {\n        if (lastPositionInBlock.isEqual(blockPosition.position)) {\n          return fromPosition(forward, rootNode, lastPositionInBlock).bind(function (to) {\n            return getBlockPosition(rootNode, to);\n          });\n        } else {\n          return Optional.some(blockPosition);\n        }\n      }).getOr(blockPosition);\n    } else {\n      return blockPosition;\n    }\n  };\n\n  var readFromRange = function (rootNode, forward, rng) {\n    var fromBlockPos = getBlockPosition(rootNode, CaretPosition$1.fromRangeStart(rng));\n    var toBlockPos = fromBlockPos.bind(function (blockPos) {\n      return fromPosition(forward, rootNode, blockPos.position).bind(function (to) {\n        return getBlockPosition(rootNode, to).map(function (blockPos) {\n          return skipLastBr(rootNode, forward, blockPos);\n        });\n      });\n    });\n    return lift2(fromBlockPos, toBlockPos, blockBoundary).filter(function (blockBoundary) {\n      return isDifferentBlocks(blockBoundary) && hasSameParent(blockBoundary) && isEditable(blockBoundary);\n    });\n  };\n\n  var read$3 = function (rootNode, forward, rng) {\n    return rng.collapsed ? readFromRange(rootNode, forward, rng) : Optional.none();\n  };\n\n  var getChildrenUntilBlockBoundary = function (block) {\n    var children$1 = children(block);\n    return findIndex(children$1, isBlock).fold(function () {\n      return children$1;\n    }, function (index) {\n      return children$1.slice(0, index);\n    });\n  };\n\n  var extractChildren = function (block) {\n    var children = getChildrenUntilBlockBoundary(block);\n    each(children, remove);\n    return children;\n  };\n\n  var removeEmptyRoot = function (rootNode, block) {\n    var parents = parentsAndSelf(block, rootNode);\n    return find(parents.reverse(), function (element) {\n      return isEmpty(element);\n    }).each(remove);\n  };\n\n  var isEmptyBefore = function (el) {\n    return filter(prevSiblings(el), function (el) {\n      return !isEmpty(el);\n    }).length === 0;\n  };\n\n  var nestedBlockMerge = function (rootNode, fromBlock, toBlock, insertionPoint) {\n    if (isEmpty(toBlock)) {\n      fillWithPaddingBr(toBlock);\n      return firstPositionIn(toBlock.dom);\n    }\n\n    if (isEmptyBefore(insertionPoint) && isEmpty(fromBlock)) {\n      before(insertionPoint, SugarElement.fromTag('br'));\n    }\n\n    var position = prevPosition(toBlock.dom, CaretPosition$1.before(insertionPoint.dom));\n    each(extractChildren(fromBlock), function (child) {\n      before(insertionPoint, child);\n    });\n    removeEmptyRoot(rootNode, fromBlock);\n    return position;\n  };\n\n  var sidelongBlockMerge = function (rootNode, fromBlock, toBlock) {\n    if (isEmpty(toBlock)) {\n      remove(toBlock);\n\n      if (isEmpty(fromBlock)) {\n        fillWithPaddingBr(fromBlock);\n      }\n\n      return firstPositionIn(fromBlock.dom);\n    }\n\n    var position = lastPositionIn(toBlock.dom);\n    each(extractChildren(fromBlock), function (child) {\n      append(toBlock, child);\n    });\n    removeEmptyRoot(rootNode, fromBlock);\n    return position;\n  };\n\n  var findInsertionPoint = function (toBlock, block) {\n    var parentsAndSelf$1 = parentsAndSelf(block, toBlock);\n    return Optional.from(parentsAndSelf$1[parentsAndSelf$1.length - 1]);\n  };\n\n  var getInsertionPoint = function (fromBlock, toBlock) {\n    return contains$2(toBlock, fromBlock) ? findInsertionPoint(toBlock, fromBlock) : Optional.none();\n  };\n\n  var trimBr = function (first, block) {\n    positionIn(first, block.dom).map(function (position) {\n      return position.getNode();\n    }).map(SugarElement.fromDom).filter(isBr$1).each(remove);\n  };\n\n  var mergeBlockInto = function (rootNode, fromBlock, toBlock) {\n    trimBr(true, fromBlock);\n    trimBr(false, toBlock);\n    return getInsertionPoint(fromBlock, toBlock).fold(curry(sidelongBlockMerge, rootNode, fromBlock, toBlock), curry(nestedBlockMerge, rootNode, fromBlock, toBlock));\n  };\n\n  var mergeBlocks = function (rootNode, forward, block1, block2) {\n    return forward ? mergeBlockInto(rootNode, block2, block1) : mergeBlockInto(rootNode, block1, block2);\n  };\n\n  var backspaceDelete$1 = function (editor, forward) {\n    var rootNode = SugarElement.fromDom(editor.getBody());\n    var position = read$3(rootNode.dom, forward, editor.selection.getRng()).bind(function (blockBoundary) {\n      return mergeBlocks(rootNode, forward, blockBoundary.from.block, blockBoundary.to.block);\n    });\n    position.each(function (pos) {\n      editor.selection.setRng(pos.toRange());\n    });\n    return position.isSome();\n  };\n\n  var deleteRangeMergeBlocks = function (rootNode, selection) {\n    var rng = selection.getRng();\n    return lift2(getParentBlock$1(rootNode, SugarElement.fromDom(rng.startContainer)), getParentBlock$1(rootNode, SugarElement.fromDom(rng.endContainer)), function (block1, block2) {\n      if (eq$2(block1, block2) === false) {\n        rng.deleteContents();\n        mergeBlocks(rootNode, true, block1, block2).each(function (pos) {\n          selection.setRng(pos.toRange());\n        });\n        return true;\n      } else {\n        return false;\n      }\n    }).getOr(false);\n  };\n\n  var isRawNodeInTable = function (root, rawNode) {\n    var node = SugarElement.fromDom(rawNode);\n    var isRoot = curry(eq$2, root);\n    return ancestor(node, isTableCell$1, isRoot).isSome();\n  };\n\n  var isSelectionInTable = function (root, rng) {\n    return isRawNodeInTable(root, rng.startContainer) || isRawNodeInTable(root, rng.endContainer);\n  };\n\n  var isEverythingSelected = function (root, rng) {\n    var noPrevious = prevPosition(root.dom, CaretPosition$1.fromRangeStart(rng)).isNone();\n    var noNext = nextPosition(root.dom, CaretPosition$1.fromRangeEnd(rng)).isNone();\n    return !isSelectionInTable(root, rng) && noPrevious && noNext;\n  };\n\n  var emptyEditor = function (editor) {\n    editor.setContent('');\n    editor.selection.setCursorLocation();\n    return true;\n  };\n\n  var deleteRange$1 = function (editor) {\n    var rootNode = SugarElement.fromDom(editor.getBody());\n    var rng = editor.selection.getRng();\n    return isEverythingSelected(rootNode, rng) ? emptyEditor(editor) : deleteRangeMergeBlocks(rootNode, editor.selection);\n  };\n\n  var backspaceDelete$2 = function (editor, _forward) {\n    return editor.selection.isCollapsed() ? false : deleteRange$1(editor);\n  };\n\n  var isContentEditableTrue$2 = isContentEditableTrue;\n  var isContentEditableFalse$7 = isContentEditableFalse;\n\n  var showCaret = function (direction, editor, node, before, scrollIntoView) {\n    return Optional.from(editor._selectionOverrides.showCaret(direction, node, before, scrollIntoView));\n  };\n\n  var getNodeRange = function (node) {\n    var rng = node.ownerDocument.createRange();\n    rng.selectNode(node);\n    return rng;\n  };\n\n  var selectNode = function (editor, node) {\n    var e = editor.fire('BeforeObjectSelected', {\n      target: node\n    });\n\n    if (e.isDefaultPrevented()) {\n      return Optional.none();\n    }\n\n    return Optional.some(getNodeRange(node));\n  };\n\n  var renderCaretAtRange = function (editor, range, scrollIntoView) {\n    var normalizedRange = normalizeRange(1, editor.getBody(), range);\n    var caretPosition = CaretPosition$1.fromRangeStart(normalizedRange);\n    var caretPositionNode = caretPosition.getNode();\n\n    if (isInlineFakeCaretTarget(caretPositionNode)) {\n      return showCaret(1, editor, caretPositionNode, !caretPosition.isAtEnd(), false);\n    }\n\n    var caretPositionBeforeNode = caretPosition.getNode(true);\n\n    if (isInlineFakeCaretTarget(caretPositionBeforeNode)) {\n      return showCaret(1, editor, caretPositionBeforeNode, false, false);\n    }\n\n    var ceRoot = editor.dom.getParent(caretPosition.getNode(), function (node) {\n      return isContentEditableFalse$7(node) || isContentEditableTrue$2(node);\n    });\n\n    if (isInlineFakeCaretTarget(ceRoot)) {\n      return showCaret(1, editor, ceRoot, false, scrollIntoView);\n    }\n\n    return Optional.none();\n  };\n\n  var renderRangeCaret = function (editor, range, scrollIntoView) {\n    return range.collapsed ? renderCaretAtRange(editor, range, scrollIntoView).getOr(range) : range;\n  };\n\n  var isBeforeBoundary = function (pos) {\n    return isBeforeContentEditableFalse(pos) || isBeforeMedia(pos);\n  };\n\n  var isAfterBoundary = function (pos) {\n    return isAfterContentEditableFalse(pos) || isAfterMedia(pos);\n  };\n\n  var trimEmptyTextNode$1 = function (dom, node) {\n    if (isText$1(node) && node.data.length === 0) {\n      dom.remove(node);\n    }\n  };\n\n  var deleteContentAndShowCaret = function (editor, range, node, direction, forward, peekCaretPosition) {\n    showCaret(direction, editor, peekCaretPosition.getNode(!forward), forward, true).each(function (caretRange) {\n      if (range.collapsed) {\n        var deleteRange = range.cloneRange();\n\n        if (forward) {\n          deleteRange.setEnd(caretRange.startContainer, caretRange.startOffset);\n        } else {\n          deleteRange.setStart(caretRange.endContainer, caretRange.endOffset);\n        }\n\n        deleteRange.deleteContents();\n      } else {\n        range.deleteContents();\n      }\n\n      editor.selection.setRng(caretRange);\n    });\n    trimEmptyTextNode$1(editor.dom, node);\n    return true;\n  };\n\n  var deleteBoundaryText = function (editor, forward) {\n    var range = editor.selection.getRng();\n\n    if (!isText$1(range.commonAncestorContainer)) {\n      return false;\n    }\n\n    var direction = forward ? HDirection.Forwards : HDirection.Backwards;\n    var caretWalker = CaretWalker(editor.getBody());\n    var getNextPosFn = curry(getVisualCaretPosition, forward ? caretWalker.next : caretWalker.prev);\n    var isBeforeFn = forward ? isBeforeBoundary : isAfterBoundary;\n    var caretPosition = getNormalizedRangeEndPoint(direction, editor.getBody(), range);\n    var nextCaretPosition = normalizePosition(forward, getNextPosFn(caretPosition));\n\n    if (!nextCaretPosition || !isMoveInsideSameBlock(caretPosition, nextCaretPosition)) {\n      return false;\n    } else if (isBeforeFn(nextCaretPosition)) {\n      return deleteContentAndShowCaret(editor, range, caretPosition.getNode(), direction, forward, nextCaretPosition);\n    }\n\n    var peekCaretPosition = getNextPosFn(nextCaretPosition);\n\n    if (peekCaretPosition && isBeforeFn(peekCaretPosition)) {\n      if (isMoveInsideSameBlock(nextCaretPosition, peekCaretPosition)) {\n        return deleteContentAndShowCaret(editor, range, caretPosition.getNode(), direction, forward, peekCaretPosition);\n      }\n    }\n\n    return false;\n  };\n\n  var backspaceDelete$3 = function (editor, forward) {\n    return deleteBoundaryText(editor, forward);\n  };\n\n  var isCompoundElement = function (node) {\n    return isTableCell$1(SugarElement.fromDom(node)) || isListItem(SugarElement.fromDom(node));\n  };\n\n  var DeleteAction = Adt.generate([{\n    remove: ['element']\n  }, {\n    moveToElement: ['element']\n  }, {\n    moveToPosition: ['position']\n  }]);\n\n  var isAtContentEditableBlockCaret = function (forward, from) {\n    var elm = from.getNode(forward === false);\n    var caretLocation = forward ? 'after' : 'before';\n    return isElement$1(elm) && elm.getAttribute('data-mce-caret') === caretLocation;\n  };\n\n  var isDeleteFromCefDifferentBlocks = function (root, forward, from, to) {\n    var inSameBlock = function (elm) {\n      return isInline(SugarElement.fromDom(elm)) && !isInSameBlock(from, to, root);\n    };\n\n    return getRelativeCefElm(!forward, from).fold(function () {\n      return getRelativeCefElm(forward, to).fold(never, inSameBlock);\n    }, inSameBlock);\n  };\n\n  var deleteEmptyBlockOrMoveToCef = function (root, forward, from, to) {\n    var toCefElm = to.getNode(forward === false);\n    return getParentBlock$1(SugarElement.fromDom(root), SugarElement.fromDom(from.getNode())).map(function (blockElm) {\n      return isEmpty(blockElm) ? DeleteAction.remove(blockElm.dom) : DeleteAction.moveToElement(toCefElm);\n    }).orThunk(function () {\n      return Optional.some(DeleteAction.moveToElement(toCefElm));\n    });\n  };\n\n  var findCefPosition = function (root, forward, from) {\n    return fromPosition(forward, root, from).bind(function (to) {\n      if (isCompoundElement(to.getNode())) {\n        return Optional.none();\n      } else if (isDeleteFromCefDifferentBlocks(root, forward, from, to)) {\n        return Optional.none();\n      } else if (forward && isContentEditableFalse(to.getNode())) {\n        return deleteEmptyBlockOrMoveToCef(root, forward, from, to);\n      } else if (forward === false && isContentEditableFalse(to.getNode(true))) {\n        return deleteEmptyBlockOrMoveToCef(root, forward, from, to);\n      } else if (forward && isAfterContentEditableFalse(from)) {\n        return Optional.some(DeleteAction.moveToPosition(to));\n      } else if (forward === false && isBeforeContentEditableFalse(from)) {\n        return Optional.some(DeleteAction.moveToPosition(to));\n      } else {\n        return Optional.none();\n      }\n    });\n  };\n\n  var getContentEditableBlockAction = function (forward, elm) {\n    if (forward && isContentEditableFalse(elm.nextSibling)) {\n      return Optional.some(DeleteAction.moveToElement(elm.nextSibling));\n    } else if (forward === false && isContentEditableFalse(elm.previousSibling)) {\n      return Optional.some(DeleteAction.moveToElement(elm.previousSibling));\n    } else {\n      return Optional.none();\n    }\n  };\n\n  var skipMoveToActionFromInlineCefToContent = function (root, from, deleteAction) {\n    return deleteAction.fold(function (elm) {\n      return Optional.some(DeleteAction.remove(elm));\n    }, function (elm) {\n      return Optional.some(DeleteAction.moveToElement(elm));\n    }, function (to) {\n      if (isInSameBlock(from, to, root)) {\n        return Optional.none();\n      } else {\n        return Optional.some(DeleteAction.moveToPosition(to));\n      }\n    });\n  };\n\n  var getContentEditableAction = function (root, forward, from) {\n    if (isAtContentEditableBlockCaret(forward, from)) {\n      return getContentEditableBlockAction(forward, from.getNode(forward === false)).fold(function () {\n        return findCefPosition(root, forward, from);\n      }, Optional.some);\n    } else {\n      return findCefPosition(root, forward, from).bind(function (deleteAction) {\n        return skipMoveToActionFromInlineCefToContent(root, from, deleteAction);\n      });\n    }\n  };\n\n  var read$4 = function (root, forward, rng) {\n    var normalizedRange = normalizeRange(forward ? 1 : -1, root, rng);\n    var from = CaretPosition$1.fromRangeStart(normalizedRange);\n    var rootElement = SugarElement.fromDom(root);\n\n    if (forward === false && isAfterContentEditableFalse(from)) {\n      return Optional.some(DeleteAction.remove(from.getNode(true)));\n    } else if (forward && isBeforeContentEditableFalse(from)) {\n      return Optional.some(DeleteAction.remove(from.getNode()));\n    } else if (forward === false && isBeforeContentEditableFalse(from) && isAfterBr(rootElement, from)) {\n      return findPreviousBr(rootElement, from).map(function (br) {\n        return DeleteAction.remove(br.getNode());\n      });\n    } else if (forward && isAfterContentEditableFalse(from) && isBeforeBr(rootElement, from)) {\n      return findNextBr(rootElement, from).map(function (br) {\n        return DeleteAction.remove(br.getNode());\n      });\n    } else {\n      return getContentEditableAction(root, forward, from);\n    }\n  };\n\n  var deleteElement$1 = function (editor, forward) {\n    return function (element) {\n      editor._selectionOverrides.hideFakeCaret();\n\n      deleteElement(editor, forward, SugarElement.fromDom(element));\n      return true;\n    };\n  };\n\n  var moveToElement = function (editor, forward) {\n    return function (element) {\n      var pos = forward ? CaretPosition$1.before(element) : CaretPosition$1.after(element);\n      editor.selection.setRng(pos.toRange());\n      return true;\n    };\n  };\n\n  var moveToPosition = function (editor) {\n    return function (pos) {\n      editor.selection.setRng(pos.toRange());\n      return true;\n    };\n  };\n\n  var getAncestorCe = function (editor, node) {\n    return Optional.from(getContentEditableRoot(editor.getBody(), node));\n  };\n\n  var backspaceDeleteCaret = function (editor, forward) {\n    var selectedNode = editor.selection.getNode();\n    return getAncestorCe(editor, selectedNode).filter(isContentEditableFalse).fold(function () {\n      return read$4(editor.getBody(), forward, editor.selection.getRng()).exists(function (deleteAction) {\n        return deleteAction.fold(deleteElement$1(editor, forward), moveToElement(editor, forward), moveToPosition(editor));\n      });\n    }, always);\n  };\n\n  var deleteOffscreenSelection = function (rootElement) {\n    each(descendants$1(rootElement, '.mce-offscreen-selection'), remove);\n  };\n\n  var backspaceDeleteRange = function (editor, forward) {\n    var selectedNode = editor.selection.getNode();\n\n    if (isContentEditableFalse(selectedNode)) {\n      var hasCefAncestor = getAncestorCe(editor, selectedNode.parentNode).filter(isContentEditableFalse);\n      return hasCefAncestor.fold(function () {\n        deleteOffscreenSelection(SugarElement.fromDom(editor.getBody()));\n        deleteElement(editor, forward, SugarElement.fromDom(editor.selection.getNode()));\n        paddEmptyBody(editor);\n        return true;\n      }, function () {\n        return true;\n      });\n    }\n\n    return false;\n  };\n\n  var paddEmptyElement = function (editor) {\n    var dom = editor.dom,\n        selection = editor.selection;\n    var ceRoot = getContentEditableRoot(editor.getBody(), selection.getNode());\n\n    if (isContentEditableTrue(ceRoot) && dom.isBlock(ceRoot) && dom.isEmpty(ceRoot)) {\n      var br = dom.create('br', {\n        'data-mce-bogus': '1'\n      });\n      dom.setHTML(ceRoot, '');\n      ceRoot.appendChild(br);\n      selection.setRng(CaretPosition$1.before(br).toRange());\n    }\n\n    return true;\n  };\n\n  var backspaceDelete$4 = function (editor, forward) {\n    if (editor.selection.isCollapsed()) {\n      return backspaceDeleteCaret(editor, forward);\n    } else {\n      return backspaceDeleteRange(editor, forward);\n    }\n  };\n\n  var deleteCaret$1 = function (editor, forward) {\n    var fromPos = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n    return fromPosition(forward, editor.getBody(), fromPos).filter(function (pos) {\n      return forward ? isBeforeImageBlock(pos) : isAfterImageBlock(pos);\n    }).bind(function (pos) {\n      return Optional.from(getChildNodeAtRelativeOffset(forward ? 0 : -1, pos));\n    }).exists(function (elm) {\n      editor.selection.select(elm);\n      return true;\n    });\n  };\n\n  var backspaceDelete$5 = function (editor, forward) {\n    return editor.selection.isCollapsed() ? deleteCaret$1(editor, forward) : false;\n  };\n\n  var isText$8 = isText$1;\n\n  var startsWithCaretContainer$1 = function (node) {\n    return isText$8(node) && node.data[0] === ZWSP;\n  };\n\n  var endsWithCaretContainer$1 = function (node) {\n    return isText$8(node) && node.data[node.data.length - 1] === ZWSP;\n  };\n\n  var createZwsp = function (node) {\n    return node.ownerDocument.createTextNode(ZWSP);\n  };\n\n  var insertBefore$1 = function (node) {\n    if (isText$8(node.previousSibling)) {\n      if (endsWithCaretContainer$1(node.previousSibling)) {\n        return node.previousSibling;\n      } else {\n        node.previousSibling.appendData(ZWSP);\n        return node.previousSibling;\n      }\n    } else if (isText$8(node)) {\n      if (startsWithCaretContainer$1(node)) {\n        return node;\n      } else {\n        node.insertData(0, ZWSP);\n        return node;\n      }\n    } else {\n      var newNode = createZwsp(node);\n      node.parentNode.insertBefore(newNode, node);\n      return newNode;\n    }\n  };\n\n  var insertAfter$1 = function (node) {\n    if (isText$8(node.nextSibling)) {\n      if (startsWithCaretContainer$1(node.nextSibling)) {\n        return node.nextSibling;\n      } else {\n        node.nextSibling.insertData(0, ZWSP);\n        return node.nextSibling;\n      }\n    } else if (isText$8(node)) {\n      if (endsWithCaretContainer$1(node)) {\n        return node;\n      } else {\n        node.appendData(ZWSP);\n        return node;\n      }\n    } else {\n      var newNode = createZwsp(node);\n\n      if (node.nextSibling) {\n        node.parentNode.insertBefore(newNode, node.nextSibling);\n      } else {\n        node.parentNode.appendChild(newNode);\n      }\n\n      return newNode;\n    }\n  };\n\n  var insertInline$1 = function (before, node) {\n    return before ? insertBefore$1(node) : insertAfter$1(node);\n  };\n\n  var insertInlineBefore = curry(insertInline$1, true);\n  var insertInlineAfter = curry(insertInline$1, false);\n\n  var insertInlinePos = function (pos, before) {\n    if (isText$1(pos.container())) {\n      return insertInline$1(before, pos.container());\n    } else {\n      return insertInline$1(before, pos.getNode());\n    }\n  };\n\n  var isPosCaretContainer = function (pos, caret) {\n    var caretNode = caret.get();\n    return caretNode && pos.container() === caretNode && isCaretContainerInline(caretNode);\n  };\n\n  var renderCaret = function (caret, location) {\n    return location.fold(function (element) {\n      remove$5(caret.get());\n      var text = insertInlineBefore(element);\n      caret.set(text);\n      return Optional.some(CaretPosition$1(text, text.length - 1));\n    }, function (element) {\n      return firstPositionIn(element).map(function (pos) {\n        if (!isPosCaretContainer(pos, caret)) {\n          remove$5(caret.get());\n          var text = insertInlinePos(pos, true);\n          caret.set(text);\n          return CaretPosition$1(text, 1);\n        } else {\n          return CaretPosition$1(caret.get(), 1);\n        }\n      });\n    }, function (element) {\n      return lastPositionIn(element).map(function (pos) {\n        if (!isPosCaretContainer(pos, caret)) {\n          remove$5(caret.get());\n          var text = insertInlinePos(pos, false);\n          caret.set(text);\n          return CaretPosition$1(text, text.length - 1);\n        } else {\n          return CaretPosition$1(caret.get(), caret.get().length - 1);\n        }\n      });\n    }, function (element) {\n      remove$5(caret.get());\n      var text = insertInlineAfter(element);\n      caret.set(text);\n      return Optional.some(CaretPosition$1(text, 1));\n    });\n  };\n\n  var evaluateUntil = function (fns, args) {\n    for (var i = 0; i < fns.length; i++) {\n      var result = fns[i].apply(null, args);\n\n      if (result.isSome()) {\n        return result;\n      }\n    }\n\n    return Optional.none();\n  };\n\n  var Location = Adt.generate([{\n    before: ['element']\n  }, {\n    start: ['element']\n  }, {\n    end: ['element']\n  }, {\n    after: ['element']\n  }]);\n\n  var rescope = function (rootNode, node) {\n    var parentBlock = getParentBlock(node, rootNode);\n    return parentBlock ? parentBlock : rootNode;\n  };\n\n  var before$4 = function (isInlineTarget, rootNode, pos) {\n    var nPos = normalizeForwards(pos);\n    var scope = rescope(rootNode, nPos.container());\n    return findRootInline(isInlineTarget, scope, nPos).fold(function () {\n      return nextPosition(scope, nPos).bind(curry(findRootInline, isInlineTarget, scope)).map(function (inline) {\n        return Location.before(inline);\n      });\n    }, Optional.none);\n  };\n\n  var isNotInsideFormatCaretContainer = function (rootNode, elm) {\n    return getParentCaretContainer(rootNode, elm) === null;\n  };\n\n  var findInsideRootInline = function (isInlineTarget, rootNode, pos) {\n    return findRootInline(isInlineTarget, rootNode, pos).filter(curry(isNotInsideFormatCaretContainer, rootNode));\n  };\n\n  var start = function (isInlineTarget, rootNode, pos) {\n    var nPos = normalizeBackwards(pos);\n    return findInsideRootInline(isInlineTarget, rootNode, nPos).bind(function (inline) {\n      var prevPos = prevPosition(inline, nPos);\n      return prevPos.isNone() ? Optional.some(Location.start(inline)) : Optional.none();\n    });\n  };\n\n  var end = function (isInlineTarget, rootNode, pos) {\n    var nPos = normalizeForwards(pos);\n    return findInsideRootInline(isInlineTarget, rootNode, nPos).bind(function (inline) {\n      var nextPos = nextPosition(inline, nPos);\n      return nextPos.isNone() ? Optional.some(Location.end(inline)) : Optional.none();\n    });\n  };\n\n  var after$3 = function (isInlineTarget, rootNode, pos) {\n    var nPos = normalizeBackwards(pos);\n    var scope = rescope(rootNode, nPos.container());\n    return findRootInline(isInlineTarget, scope, nPos).fold(function () {\n      return prevPosition(scope, nPos).bind(curry(findRootInline, isInlineTarget, scope)).map(function (inline) {\n        return Location.after(inline);\n      });\n    }, Optional.none);\n  };\n\n  var isValidLocation = function (location) {\n    return isRtl$1(getElement(location)) === false;\n  };\n\n  var readLocation = function (isInlineTarget, rootNode, pos) {\n    var location = evaluateUntil([before$4, start, end, after$3], [isInlineTarget, rootNode, pos]);\n    return location.filter(isValidLocation);\n  };\n\n  var getElement = function (location) {\n    return location.fold(identity, identity, identity, identity);\n  };\n\n  var getName = function (location) {\n    return location.fold(constant('before'), constant('start'), constant('end'), constant('after'));\n  };\n\n  var outside = function (location) {\n    return location.fold(Location.before, Location.before, Location.after, Location.after);\n  };\n\n  var inside = function (location) {\n    return location.fold(Location.start, Location.start, Location.end, Location.end);\n  };\n\n  var isEq$5 = function (location1, location2) {\n    return getName(location1) === getName(location2) && getElement(location1) === getElement(location2);\n  };\n\n  var betweenInlines = function (forward, isInlineTarget, rootNode, from, to, location) {\n    return lift2(findRootInline(isInlineTarget, rootNode, from), findRootInline(isInlineTarget, rootNode, to), function (fromInline, toInline) {\n      if (fromInline !== toInline && hasSameParentBlock(rootNode, fromInline, toInline)) {\n        return Location.after(forward ? fromInline : toInline);\n      } else {\n        return location;\n      }\n    }).getOr(location);\n  };\n\n  var skipNoMovement = function (fromLocation, toLocation) {\n    return fromLocation.fold(always, function (fromLocation) {\n      return !isEq$5(fromLocation, toLocation);\n    });\n  };\n\n  var findLocationTraverse = function (forward, isInlineTarget, rootNode, fromLocation, pos) {\n    var from = normalizePosition(forward, pos);\n    var to = fromPosition(forward, rootNode, from).map(curry(normalizePosition, forward));\n    var location = to.fold(function () {\n      return fromLocation.map(outside);\n    }, function (to) {\n      return readLocation(isInlineTarget, rootNode, to).map(curry(betweenInlines, forward, isInlineTarget, rootNode, from, to)).filter(curry(skipNoMovement, fromLocation));\n    });\n    return location.filter(isValidLocation);\n  };\n\n  var findLocationSimple = function (forward, location) {\n    if (forward) {\n      return location.fold(compose(Optional.some, Location.start), Optional.none, compose(Optional.some, Location.after), Optional.none);\n    } else {\n      return location.fold(Optional.none, compose(Optional.some, Location.before), Optional.none, compose(Optional.some, Location.end));\n    }\n  };\n\n  var findLocation = function (forward, isInlineTarget, rootNode, pos) {\n    var from = normalizePosition(forward, pos);\n    var fromLocation = readLocation(isInlineTarget, rootNode, from);\n    return readLocation(isInlineTarget, rootNode, from).bind(curry(findLocationSimple, forward)).orThunk(function () {\n      return findLocationTraverse(forward, isInlineTarget, rootNode, fromLocation, pos);\n    });\n  };\n\n  var prevLocation = curry(findLocation, false);\n  var nextLocation = curry(findLocation, true);\n\n  var hasSelectionModifyApi = function (editor) {\n    return isFunction(editor.selection.getSel().modify);\n  };\n\n  var moveRel = function (forward, selection, pos) {\n    var delta = forward ? 1 : -1;\n    selection.setRng(CaretPosition$1(pos.container(), pos.offset() + delta).toRange());\n    selection.getSel().modify('move', forward ? 'forward' : 'backward', 'word');\n    return true;\n  };\n\n  var moveByWord = function (forward, editor) {\n    var rng = editor.selection.getRng();\n    var pos = forward ? CaretPosition$1.fromRangeEnd(rng) : CaretPosition$1.fromRangeStart(rng);\n\n    if (!hasSelectionModifyApi(editor)) {\n      return false;\n    } else if (forward && isBeforeInline(pos)) {\n      return moveRel(true, editor.selection, pos);\n    } else if (!forward && isAfterInline(pos)) {\n      return moveRel(false, editor.selection, pos);\n    } else {\n      return false;\n    }\n  };\n\n  var setCaretPosition = function (editor, pos) {\n    var rng = editor.dom.createRng();\n    rng.setStart(pos.container(), pos.offset());\n    rng.setEnd(pos.container(), pos.offset());\n    editor.selection.setRng(rng);\n  };\n\n  var setSelected = function (state, elm) {\n    if (state) {\n      elm.setAttribute('data-mce-selected', 'inline-boundary');\n    } else {\n      elm.removeAttribute('data-mce-selected');\n    }\n  };\n\n  var renderCaretLocation = function (editor, caret, location) {\n    return renderCaret(caret, location).map(function (pos) {\n      setCaretPosition(editor, pos);\n      return location;\n    });\n  };\n\n  var findLocation$1 = function (editor, caret, forward) {\n    var rootNode = editor.getBody();\n    var from = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n    var isInlineTarget$1 = curry(isInlineTarget, editor);\n    var location = findLocation(forward, isInlineTarget$1, rootNode, from);\n    return location.bind(function (location) {\n      return renderCaretLocation(editor, caret, location);\n    });\n  };\n\n  var toggleInlines = function (isInlineTarget, dom, elms) {\n    var inlineBoundaries = map(descendants$1(SugarElement.fromDom(dom.getRoot()), '*[data-mce-selected=\"inline-boundary\"]'), function (e) {\n      return e.dom;\n    });\n    var selectedInlines = filter(inlineBoundaries, isInlineTarget);\n    var targetInlines = filter(elms, isInlineTarget);\n    each(difference(selectedInlines, targetInlines), curry(setSelected, false));\n    each(difference(targetInlines, selectedInlines), curry(setSelected, true));\n  };\n\n  var safeRemoveCaretContainer = function (editor, caret) {\n    if (editor.selection.isCollapsed() && editor.composing !== true && caret.get()) {\n      var pos = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n\n      if (CaretPosition$1.isTextPosition(pos) && isAtZwsp(pos) === false) {\n        setCaretPosition(editor, removeAndReposition(caret.get(), pos));\n        caret.set(null);\n      }\n    }\n  };\n\n  var renderInsideInlineCaret = function (isInlineTarget, editor, caret, elms) {\n    if (editor.selection.isCollapsed()) {\n      var inlines = filter(elms, isInlineTarget);\n      each(inlines, function (_inline) {\n        var pos = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n        readLocation(isInlineTarget, editor.getBody(), pos).bind(function (location) {\n          return renderCaretLocation(editor, caret, location);\n        });\n      });\n    }\n  };\n\n  var move = function (editor, caret, forward) {\n    return isInlineBoundariesEnabled(editor) ? findLocation$1(editor, caret, forward).isSome() : false;\n  };\n\n  var moveWord = function (forward, editor, _caret) {\n    return isInlineBoundariesEnabled(editor) ? moveByWord(forward, editor) : false;\n  };\n\n  var setupSelectedState = function (editor) {\n    var caret = Cell(null);\n    var isInlineTarget$1 = curry(isInlineTarget, editor);\n    editor.on('NodeChange', function (e) {\n      if (isInlineBoundariesEnabled(editor) && !(Env.browser.isIE() && e.initial)) {\n        toggleInlines(isInlineTarget$1, editor.dom, e.parents);\n        safeRemoveCaretContainer(editor, caret);\n        renderInsideInlineCaret(isInlineTarget$1, editor, caret, e.parents);\n      }\n    });\n    return caret;\n  };\n\n  var moveNextWord = curry(moveWord, true);\n  var movePrevWord = curry(moveWord, false);\n\n  var rangeFromPositions = function (from, to) {\n    var range = document.createRange();\n    range.setStart(from.container(), from.offset());\n    range.setEnd(to.container(), to.offset());\n    return range;\n  };\n\n  var hasOnlyTwoOrLessPositionsLeft = function (elm) {\n    return lift2(firstPositionIn(elm), lastPositionIn(elm), function (firstPos, lastPos) {\n      var normalizedFirstPos = normalizePosition(true, firstPos);\n      var normalizedLastPos = normalizePosition(false, lastPos);\n      return nextPosition(elm, normalizedFirstPos).forall(function (pos) {\n        return pos.isEqual(normalizedLastPos);\n      });\n    }).getOr(true);\n  };\n\n  var setCaretLocation = function (editor, caret) {\n    return function (location) {\n      return renderCaret(caret, location).exists(function (pos) {\n        setCaretPosition(editor, pos);\n        return true;\n      });\n    };\n  };\n\n  var deleteFromTo = function (editor, caret, from, to) {\n    var rootNode = editor.getBody();\n    var isInlineTarget$1 = curry(isInlineTarget, editor);\n    editor.undoManager.ignore(function () {\n      editor.selection.setRng(rangeFromPositions(from, to));\n      editor.execCommand('Delete');\n      readLocation(isInlineTarget$1, rootNode, CaretPosition$1.fromRangeStart(editor.selection.getRng())).map(inside).map(setCaretLocation(editor, caret));\n    });\n    editor.nodeChanged();\n  };\n\n  var rescope$1 = function (rootNode, node) {\n    var parentBlock = getParentBlock(node, rootNode);\n    return parentBlock ? parentBlock : rootNode;\n  };\n\n  var backspaceDeleteCollapsed = function (editor, caret, forward, from) {\n    var rootNode = rescope$1(editor.getBody(), from.container());\n    var isInlineTarget$1 = curry(isInlineTarget, editor);\n    var fromLocation = readLocation(isInlineTarget$1, rootNode, from);\n    return fromLocation.bind(function (location) {\n      if (forward) {\n        return location.fold(constant(Optional.some(inside(location))), Optional.none, constant(Optional.some(outside(location))), Optional.none);\n      } else {\n        return location.fold(Optional.none, constant(Optional.some(outside(location))), Optional.none, constant(Optional.some(inside(location))));\n      }\n    }).map(setCaretLocation(editor, caret)).getOrThunk(function () {\n      var toPosition = navigate(forward, rootNode, from);\n      var toLocation = toPosition.bind(function (pos) {\n        return readLocation(isInlineTarget$1, rootNode, pos);\n      });\n      return lift2(fromLocation, toLocation, function () {\n        return findRootInline(isInlineTarget$1, rootNode, from).exists(function (elm) {\n          if (hasOnlyTwoOrLessPositionsLeft(elm)) {\n            deleteElement(editor, forward, SugarElement.fromDom(elm));\n            return true;\n          } else {\n            return false;\n          }\n        });\n      }).orThunk(function () {\n        return toLocation.bind(function (_) {\n          return toPosition.map(function (to) {\n            if (forward) {\n              deleteFromTo(editor, caret, from, to);\n            } else {\n              deleteFromTo(editor, caret, to, from);\n            }\n\n            return true;\n          });\n        });\n      }).getOr(false);\n    });\n  };\n\n  var backspaceDelete$6 = function (editor, caret, forward) {\n    if (editor.selection.isCollapsed() && isInlineBoundariesEnabled(editor)) {\n      var from = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n      return backspaceDeleteCollapsed(editor, caret, forward, from);\n    }\n\n    return false;\n  };\n\n  var getParentInlines = function (rootElm, startElm) {\n    var parents = parentsAndSelf(startElm, rootElm);\n    return findIndex(parents, isBlock).fold(constant(parents), function (index) {\n      return parents.slice(0, index);\n    });\n  };\n\n  var hasOnlyOneChild$1 = function (elm) {\n    return children(elm).length === 1;\n  };\n\n  var deleteLastPosition = function (forward, editor, target, parentInlines) {\n    var isFormatElement$1 = curry(isFormatElement, editor);\n    var formatNodes = map(filter(parentInlines, isFormatElement$1), function (elm) {\n      return elm.dom;\n    });\n\n    if (formatNodes.length === 0) {\n      deleteElement(editor, forward, target);\n    } else {\n      var pos = replaceWithCaretFormat(target.dom, formatNodes);\n      editor.selection.setRng(pos.toRange());\n    }\n  };\n\n  var deleteCaret$2 = function (editor, forward) {\n    var rootElm = SugarElement.fromDom(editor.getBody());\n    var startElm = SugarElement.fromDom(editor.selection.getStart());\n    var parentInlines = filter(getParentInlines(rootElm, startElm), hasOnlyOneChild$1);\n    return last(parentInlines).exists(function (target) {\n      var fromPos = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n\n      if (willDeleteLastPositionInElement(forward, fromPos, target.dom) && !isEmptyCaretFormatElement(target)) {\n        deleteLastPosition(forward, editor, target, parentInlines);\n        return true;\n      } else {\n        return false;\n      }\n    });\n  };\n\n  var backspaceDelete$7 = function (editor, forward) {\n    return editor.selection.isCollapsed() ? deleteCaret$2(editor, forward) : false;\n  };\n\n  var deleteElement$2 = function (editor, forward, element) {\n    editor._selectionOverrides.hideFakeCaret();\n\n    deleteElement(editor, forward, SugarElement.fromDom(element));\n    return true;\n  };\n\n  var deleteCaret$3 = function (editor, forward) {\n    var isNearMedia = forward ? isBeforeMedia : isAfterMedia;\n    var direction = forward ? HDirection.Forwards : HDirection.Backwards;\n    var fromPos = getNormalizedRangeEndPoint(direction, editor.getBody(), editor.selection.getRng());\n\n    if (isNearMedia(fromPos)) {\n      return deleteElement$2(editor, forward, fromPos.getNode(!forward));\n    } else {\n      return Optional.from(normalizePosition(forward, fromPos)).filter(function (pos) {\n        return isNearMedia(pos) && isMoveInsideSameBlock(fromPos, pos);\n      }).exists(function (pos) {\n        return deleteElement$2(editor, forward, pos.getNode(!forward));\n      });\n    }\n  };\n\n  var deleteRange$2 = function (editor, forward) {\n    var selectedNode = editor.selection.getNode();\n    return isMedia(selectedNode) ? deleteElement$2(editor, forward, selectedNode) : false;\n  };\n\n  var backspaceDelete$8 = function (editor, forward) {\n    return editor.selection.isCollapsed() ? deleteCaret$3(editor, forward) : deleteRange$2(editor, forward);\n  };\n\n  var isEditable$1 = function (target) {\n    return closest(target, function (elm) {\n      return isContentEditableTrue(elm.dom) || isContentEditableFalse(elm.dom);\n    }).exists(function (elm) {\n      return isContentEditableTrue(elm.dom);\n    });\n  };\n\n  var parseIndentValue = function (value) {\n    var number = parseInt(value, 10);\n    return isNaN(number) ? 0 : number;\n  };\n\n  var getIndentStyleName = function (useMargin, element) {\n    var indentStyleName = useMargin || isTable$1(element) ? 'margin' : 'padding';\n    var suffix = get$4(element, 'direction') === 'rtl' ? '-right' : '-left';\n    return indentStyleName + suffix;\n  };\n\n  var indentElement = function (dom, command, useMargin, value, unit, element) {\n    var indentStyleName = getIndentStyleName(useMargin, SugarElement.fromDom(element));\n\n    if (command === 'outdent') {\n      var styleValue = Math.max(0, parseIndentValue(element.style[indentStyleName]) - value);\n      dom.setStyle(element, indentStyleName, styleValue ? styleValue + unit : '');\n    } else {\n      var styleValue = parseIndentValue(element.style[indentStyleName]) + value + unit;\n      dom.setStyle(element, indentStyleName, styleValue);\n    }\n  };\n\n  var validateBlocks = function (editor, blocks) {\n    return forall(blocks, function (block) {\n      var indentStyleName = getIndentStyleName(shouldIndentUseMargin(editor), block);\n      var intentValue = getRaw(block, indentStyleName).map(parseIndentValue).getOr(0);\n      var contentEditable = editor.dom.getContentEditable(block.dom);\n      return contentEditable !== 'false' && intentValue > 0;\n    });\n  };\n\n  var canOutdent = function (editor) {\n    var blocks = getBlocksToIndent(editor);\n    return !editor.mode.isReadOnly() && (blocks.length > 1 || validateBlocks(editor, blocks));\n  };\n\n  var isListComponent = function (el) {\n    return isList(el) || isListItem(el);\n  };\n\n  var parentIsListComponent = function (el) {\n    return parent(el).map(isListComponent).getOr(false);\n  };\n\n  var getBlocksToIndent = function (editor) {\n    return filter(map(editor.selection.getSelectedBlocks(), SugarElement.fromDom), function (el) {\n      return !isListComponent(el) && !parentIsListComponent(el) && isEditable$1(el);\n    });\n  };\n\n  var handle = function (editor, command) {\n    var dom = editor.dom,\n        selection = editor.selection,\n        formatter = editor.formatter;\n    var indentation = getIndentation(editor);\n    var indentUnit = /[a-z%]+$/i.exec(indentation)[0];\n    var indentValue = parseInt(indentation, 10);\n    var useMargin = shouldIndentUseMargin(editor);\n    var forcedRootBlock = getForcedRootBlock(editor);\n\n    if (!editor.queryCommandState('InsertUnorderedList') && !editor.queryCommandState('InsertOrderedList')) {\n      if (forcedRootBlock === '' && !dom.getParent(selection.getNode(), dom.isBlock)) {\n        formatter.apply('div');\n      }\n    }\n\n    each(getBlocksToIndent(editor), function (block) {\n      indentElement(dom, command, useMargin, indentValue, indentUnit, block.dom);\n    });\n  };\n\n  var backspaceDelete$9 = function (editor, _forward) {\n    if (editor.selection.isCollapsed() && canOutdent(editor)) {\n      var dom = editor.dom;\n      var rng = editor.selection.getRng();\n      var pos = CaretPosition$1.fromRangeStart(rng);\n      var block = dom.getParent(rng.startContainer, dom.isBlock);\n\n      if (block !== null && isAtStartOfBlock(SugarElement.fromDom(block), pos)) {\n        handle(editor, 'outdent');\n        return true;\n      }\n    }\n\n    return false;\n  };\n\n  var nativeCommand = function (editor, command) {\n    editor.getDoc().execCommand(command, false, null);\n  };\n\n  var deleteCommand = function (editor, caret) {\n    if (backspaceDelete$9(editor)) {\n      return;\n    } else if (backspaceDelete$4(editor, false)) {\n      return;\n    } else if (backspaceDelete$3(editor, false)) {\n      return;\n    } else if (backspaceDelete$6(editor, caret, false)) {\n      return;\n    } else if (backspaceDelete$1(editor, false)) {\n      return;\n    } else if (backspaceDelete(editor)) {\n      return;\n    } else if (backspaceDelete$5(editor, false)) {\n      return;\n    } else if (backspaceDelete$8(editor, false)) {\n      return;\n    } else if (backspaceDelete$2(editor)) {\n      return;\n    } else if (backspaceDelete$7(editor, false)) {\n      return;\n    } else {\n      nativeCommand(editor, 'Delete');\n      paddEmptyBody(editor);\n    }\n  };\n\n  var forwardDeleteCommand = function (editor, caret) {\n    if (backspaceDelete$4(editor, true)) {\n      return;\n    } else if (backspaceDelete$3(editor, true)) {\n      return;\n    } else if (backspaceDelete$6(editor, caret, true)) {\n      return;\n    } else if (backspaceDelete$1(editor, true)) {\n      return;\n    } else if (backspaceDelete(editor)) {\n      return;\n    } else if (backspaceDelete$5(editor, true)) {\n      return;\n    } else if (backspaceDelete$8(editor, true)) {\n      return;\n    } else if (backspaceDelete$2(editor)) {\n      return;\n    } else if (backspaceDelete$7(editor, true)) {\n      return;\n    } else {\n      nativeCommand(editor, 'ForwardDelete');\n    }\n  };\n\n  var setup$8 = function (editor, caret) {\n    editor.addCommand('delete', function () {\n      deleteCommand(editor, caret);\n    });\n    editor.addCommand('forwardDelete', function () {\n      forwardDeleteCommand(editor, caret);\n    });\n  };\n\n  var SIGNIFICANT_MOVE = 5;\n  var LONGPRESS_DELAY = 400;\n\n  var getTouch = function (event) {\n    if (event.touches === undefined || event.touches.length !== 1) {\n      return Optional.none();\n    }\n\n    return Optional.some(event.touches[0]);\n  };\n\n  var isFarEnough = function (touch, data) {\n    var distX = Math.abs(touch.clientX - data.x);\n    var distY = Math.abs(touch.clientY - data.y);\n    return distX > SIGNIFICANT_MOVE || distY > SIGNIFICANT_MOVE;\n  };\n\n  var setup$9 = function (editor) {\n    var startData = Cell(Optional.none());\n    var longpressFired = Cell(false);\n    var debounceLongpress = last$2(function (e) {\n      editor.fire('longpress', __assign(__assign({}, e), {\n        type: 'longpress'\n      }));\n      longpressFired.set(true);\n    }, LONGPRESS_DELAY);\n    editor.on('touchstart', function (e) {\n      getTouch(e).each(function (touch) {\n        debounceLongpress.cancel();\n        var data = {\n          x: touch.clientX,\n          y: touch.clientY,\n          target: e.target\n        };\n        debounceLongpress.throttle(e);\n        longpressFired.set(false);\n        startData.set(Optional.some(data));\n      });\n    }, true);\n    editor.on('touchmove', function (e) {\n      debounceLongpress.cancel();\n      getTouch(e).each(function (touch) {\n        startData.get().each(function (data) {\n          if (isFarEnough(touch, data)) {\n            startData.set(Optional.none());\n            longpressFired.set(false);\n            editor.fire('longpresscancel');\n          }\n        });\n      });\n    }, true);\n    editor.on('touchend touchcancel', function (e) {\n      debounceLongpress.cancel();\n\n      if (e.type === 'touchcancel') {\n        return;\n      }\n\n      startData.get().filter(function (data) {\n        return data.target.isEqualNode(e.target);\n      }).each(function () {\n        if (longpressFired.get()) {\n          e.preventDefault();\n        } else {\n          editor.fire('tap', __assign(__assign({}, e), {\n            type: 'tap'\n          }));\n        }\n      });\n    }, true);\n  };\n\n  var isBlockElement = function (blockElements, node) {\n    return blockElements.hasOwnProperty(node.nodeName);\n  };\n\n  var isValidTarget = function (blockElements, node) {\n    if (isText$1(node)) {\n      return true;\n    } else if (isElement$1(node)) {\n      return !isBlockElement(blockElements, node) && !isBookmarkNode$1(node);\n    } else {\n      return false;\n    }\n  };\n\n  var hasBlockParent = function (blockElements, root, node) {\n    return exists(parents$1(SugarElement.fromDom(node), SugarElement.fromDom(root)), function (elm) {\n      return isBlockElement(blockElements, elm.dom);\n    });\n  };\n\n  var shouldRemoveTextNode = function (blockElements, node) {\n    if (isText$1(node)) {\n      if (node.nodeValue.length === 0) {\n        return true;\n      } else if (/^\\s+$/.test(node.nodeValue) && (!node.nextSibling || isBlockElement(blockElements, node.nextSibling))) {\n        return true;\n      }\n    }\n\n    return false;\n  };\n\n  var addRootBlocks = function (editor) {\n    var dom = editor.dom,\n        selection = editor.selection;\n    var schema = editor.schema,\n        blockElements = schema.getBlockElements();\n    var node = selection.getStart();\n    var rootNode = editor.getBody();\n    var rootBlockNode, tempNode, wrapped;\n    var forcedRootBlock = getForcedRootBlock(editor);\n\n    if (!node || !isElement$1(node) || !forcedRootBlock) {\n      return;\n    }\n\n    var rootNodeName = rootNode.nodeName.toLowerCase();\n\n    if (!schema.isValidChild(rootNodeName, forcedRootBlock.toLowerCase()) || hasBlockParent(blockElements, rootNode, node)) {\n      return;\n    }\n\n    var rng = selection.getRng();\n    var startContainer = rng.startContainer;\n    var startOffset = rng.startOffset;\n    var endContainer = rng.endContainer;\n    var endOffset = rng.endOffset;\n    var restoreSelection = hasFocus$1(editor);\n    node = rootNode.firstChild;\n\n    while (node) {\n      if (isValidTarget(blockElements, node)) {\n        if (shouldRemoveTextNode(blockElements, node)) {\n          tempNode = node;\n          node = node.nextSibling;\n          dom.remove(tempNode);\n          continue;\n        }\n\n        if (!rootBlockNode) {\n          rootBlockNode = dom.create(forcedRootBlock, getForcedRootBlockAttrs(editor));\n          node.parentNode.insertBefore(rootBlockNode, node);\n          wrapped = true;\n        }\n\n        tempNode = node;\n        node = node.nextSibling;\n        rootBlockNode.appendChild(tempNode);\n      } else {\n        rootBlockNode = null;\n        node = node.nextSibling;\n      }\n    }\n\n    if (wrapped && restoreSelection) {\n      rng.setStart(startContainer, startOffset);\n      rng.setEnd(endContainer, endOffset);\n      selection.setRng(rng);\n      editor.nodeChanged();\n    }\n  };\n\n  var setup$a = function (editor) {\n    if (getForcedRootBlock(editor)) {\n      editor.on('NodeChange', curry(addRootBlocks, editor));\n    }\n  };\n\n  var findBlockCaretContainer = function (editor) {\n    return descendant(SugarElement.fromDom(editor.getBody()), '*[data-mce-caret]').fold(constant(null), function (elm) {\n      return elm.dom;\n    });\n  };\n\n  var removeIeControlRect = function (editor) {\n    editor.selection.setRng(editor.selection.getRng());\n  };\n\n  var showBlockCaretContainer = function (editor, blockCaretContainer) {\n    if (blockCaretContainer.hasAttribute('data-mce-caret')) {\n      showCaretContainerBlock(blockCaretContainer);\n      removeIeControlRect(editor);\n      editor.selection.scrollIntoView(blockCaretContainer);\n    }\n  };\n\n  var handleBlockContainer = function (editor, e) {\n    var blockCaretContainer = findBlockCaretContainer(editor);\n\n    if (!blockCaretContainer) {\n      return;\n    }\n\n    if (e.type === 'compositionstart') {\n      e.preventDefault();\n      e.stopPropagation();\n      showBlockCaretContainer(editor, blockCaretContainer);\n      return;\n    }\n\n    if (hasContent(blockCaretContainer)) {\n      showBlockCaretContainer(editor, blockCaretContainer);\n      editor.undoManager.add();\n    }\n  };\n\n  var setup$b = function (editor) {\n    editor.on('keyup compositionstart', curry(handleBlockContainer, editor));\n  };\n\n  var BreakType;\n\n  (function (BreakType) {\n    BreakType[BreakType['Br'] = 0] = 'Br';\n    BreakType[BreakType['Block'] = 1] = 'Block';\n    BreakType[BreakType['Wrap'] = 2] = 'Wrap';\n    BreakType[BreakType['Eol'] = 3] = 'Eol';\n  })(BreakType || (BreakType = {}));\n\n  var flip = function (direction, positions) {\n    return direction === HDirection.Backwards ? reverse(positions) : positions;\n  };\n\n  var walk$3 = function (direction, caretWalker, pos) {\n    return direction === HDirection.Forwards ? caretWalker.next(pos) : caretWalker.prev(pos);\n  };\n\n  var getBreakType = function (scope, direction, currentPos, nextPos) {\n    if (isBr(nextPos.getNode(direction === HDirection.Forwards))) {\n      return BreakType.Br;\n    } else if (isInSameBlock(currentPos, nextPos) === false) {\n      return BreakType.Block;\n    } else {\n      return BreakType.Wrap;\n    }\n  };\n\n  var getPositionsUntil = function (predicate, direction, scope, start) {\n    var caretWalker = CaretWalker(scope);\n    var currentPos = start,\n        nextPos;\n    var positions = [];\n\n    while (currentPos) {\n      nextPos = walk$3(direction, caretWalker, currentPos);\n\n      if (!nextPos) {\n        break;\n      }\n\n      if (isBr(nextPos.getNode(false))) {\n        if (direction === HDirection.Forwards) {\n          return {\n            positions: flip(direction, positions).concat([nextPos]),\n            breakType: BreakType.Br,\n            breakAt: Optional.some(nextPos)\n          };\n        } else {\n          return {\n            positions: flip(direction, positions),\n            breakType: BreakType.Br,\n            breakAt: Optional.some(nextPos)\n          };\n        }\n      }\n\n      if (!nextPos.isVisible()) {\n        currentPos = nextPos;\n        continue;\n      }\n\n      if (predicate(currentPos, nextPos)) {\n        var breakType = getBreakType(scope, direction, currentPos, nextPos);\n        return {\n          positions: flip(direction, positions),\n          breakType: breakType,\n          breakAt: Optional.some(nextPos)\n        };\n      }\n\n      positions.push(nextPos);\n      currentPos = nextPos;\n    }\n\n    return {\n      positions: flip(direction, positions),\n      breakType: BreakType.Eol,\n      breakAt: Optional.none()\n    };\n  };\n\n  var getAdjacentLinePositions = function (direction, getPositionsUntilBreak, scope, start) {\n    return getPositionsUntilBreak(scope, start).breakAt.map(function (pos) {\n      var positions = getPositionsUntilBreak(scope, pos).positions;\n      return direction === HDirection.Backwards ? positions.concat(pos) : [pos].concat(positions);\n    }).getOr([]);\n  };\n\n  var findClosestHorizontalPositionFromPoint = function (positions, x) {\n    return foldl(positions, function (acc, newPos) {\n      return acc.fold(function () {\n        return Optional.some(newPos);\n      }, function (lastPos) {\n        return lift2(head(lastPos.getClientRects()), head(newPos.getClientRects()), function (lastRect, newRect) {\n          var lastDist = Math.abs(x - lastRect.left);\n          var newDist = Math.abs(x - newRect.left);\n          return newDist <= lastDist ? newPos : lastPos;\n        }).or(acc);\n      });\n    }, Optional.none());\n  };\n\n  var findClosestHorizontalPosition = function (positions, pos) {\n    return head(pos.getClientRects()).bind(function (targetRect) {\n      return findClosestHorizontalPositionFromPoint(positions, targetRect.left);\n    });\n  };\n\n  var getPositionsUntilPreviousLine = curry(getPositionsUntil, CaretPosition.isAbove, -1);\n  var getPositionsUntilNextLine = curry(getPositionsUntil, CaretPosition.isBelow, 1);\n\n  var isAtFirstLine = function (scope, pos) {\n    return getPositionsUntilPreviousLine(scope, pos).breakAt.isNone();\n  };\n\n  var isAtLastLine = function (scope, pos) {\n    return getPositionsUntilNextLine(scope, pos).breakAt.isNone();\n  };\n\n  var getPositionsAbove = curry(getAdjacentLinePositions, -1, getPositionsUntilPreviousLine);\n  var getPositionsBelow = curry(getAdjacentLinePositions, 1, getPositionsUntilNextLine);\n\n  var getFirstLinePositions = function (scope) {\n    return firstPositionIn(scope).map(function (pos) {\n      return [pos].concat(getPositionsUntilNextLine(scope, pos).positions);\n    }).getOr([]);\n  };\n\n  var getLastLinePositions = function (scope) {\n    return lastPositionIn(scope).map(function (pos) {\n      return getPositionsUntilPreviousLine(scope, pos).positions.concat(pos);\n    }).getOr([]);\n  };\n\n  var getNodeClientRects = function (node) {\n    var toArrayWithNode = function (clientRects) {\n      return map(clientRects, function (clientRect) {\n        clientRect = clone$2(clientRect);\n        clientRect.node = node;\n        return clientRect;\n      });\n    };\n\n    if (isElement$1(node)) {\n      return toArrayWithNode(node.getClientRects());\n    }\n\n    if (isText$1(node)) {\n      var rng = node.ownerDocument.createRange();\n      rng.setStart(node, 0);\n      rng.setEnd(node, node.data.length);\n      return toArrayWithNode(rng.getClientRects());\n    }\n  };\n\n  var getClientRects = function (nodes) {\n    return bind(nodes, getNodeClientRects);\n  };\n\n  var VDirection;\n\n  (function (VDirection) {\n    VDirection[VDirection['Up'] = -1] = 'Up';\n    VDirection[VDirection['Down'] = 1] = 'Down';\n  })(VDirection || (VDirection = {}));\n\n  var findUntil$1 = function (direction, root, predicateFn, node) {\n    while (node = findNode(node, direction, isEditableCaretCandidate, root)) {\n      if (predicateFn(node)) {\n        return;\n      }\n    }\n  };\n\n  var walkUntil = function (direction, isAboveFn, isBeflowFn, root, predicateFn, caretPosition) {\n    var line = 0;\n    var result = [];\n\n    var add = function (node) {\n      var i, clientRect, clientRects;\n      clientRects = getClientRects([node]);\n\n      if (direction === -1) {\n        clientRects = clientRects.reverse();\n      }\n\n      for (i = 0; i < clientRects.length; i++) {\n        clientRect = clientRects[i];\n\n        if (isBeflowFn(clientRect, targetClientRect)) {\n          continue;\n        }\n\n        if (result.length > 0 && isAboveFn(clientRect, last$1(result))) {\n          line++;\n        }\n\n        clientRect.line = line;\n\n        if (predicateFn(clientRect)) {\n          return true;\n        }\n\n        result.push(clientRect);\n      }\n    };\n\n    var targetClientRect = last$1(caretPosition.getClientRects());\n\n    if (!targetClientRect) {\n      return result;\n    }\n\n    var node = caretPosition.getNode();\n    add(node);\n    findUntil$1(direction, root, add, node);\n    return result;\n  };\n\n  var aboveLineNumber = function (lineNumber, clientRect) {\n    return clientRect.line > lineNumber;\n  };\n\n  var isLineNumber = function (lineNumber, clientRect) {\n    return clientRect.line === lineNumber;\n  };\n\n  var upUntil = curry(walkUntil, VDirection.Up, isAbove, isBelow);\n  var downUntil = curry(walkUntil, VDirection.Down, isBelow, isAbove);\n\n  var positionsUntil = function (direction, root, predicateFn, node) {\n    var caretWalker = CaretWalker(root);\n    var walkFn, isBelowFn, isAboveFn, caretPosition;\n    var result = [];\n    var line = 0,\n        clientRect;\n\n    var getClientRect = function (caretPosition) {\n      if (direction === 1) {\n        return last$1(caretPosition.getClientRects());\n      }\n\n      return last$1(caretPosition.getClientRects());\n    };\n\n    if (direction === 1) {\n      walkFn = caretWalker.next;\n      isBelowFn = isBelow;\n      isAboveFn = isAbove;\n      caretPosition = CaretPosition$1.after(node);\n    } else {\n      walkFn = caretWalker.prev;\n      isBelowFn = isAbove;\n      isAboveFn = isBelow;\n      caretPosition = CaretPosition$1.before(node);\n    }\n\n    var targetClientRect = getClientRect(caretPosition);\n\n    do {\n      if (!caretPosition.isVisible()) {\n        continue;\n      }\n\n      clientRect = getClientRect(caretPosition);\n\n      if (isAboveFn(clientRect, targetClientRect)) {\n        continue;\n      }\n\n      if (result.length > 0 && isBelowFn(clientRect, last$1(result))) {\n        line++;\n      }\n\n      clientRect = clone$2(clientRect);\n      clientRect.position = caretPosition;\n      clientRect.line = line;\n\n      if (predicateFn(clientRect)) {\n        return result;\n      }\n\n      result.push(clientRect);\n    } while (caretPosition = walkFn(caretPosition));\n\n    return result;\n  };\n\n  var isAboveLine = function (lineNumber) {\n    return function (clientRect) {\n      return aboveLineNumber(lineNumber, clientRect);\n    };\n  };\n\n  var isLine = function (lineNumber) {\n    return function (clientRect) {\n      return isLineNumber(lineNumber, clientRect);\n    };\n  };\n\n  var isContentEditableFalse$8 = isContentEditableFalse;\n  var findNode$1 = findNode;\n\n  var distanceToRectLeft = function (clientRect, clientX) {\n    return Math.abs(clientRect.left - clientX);\n  };\n\n  var distanceToRectRight = function (clientRect, clientX) {\n    return Math.abs(clientRect.right - clientX);\n  };\n\n  var isInsideX = function (clientX, clientRect) {\n    return clientX >= clientRect.left && clientX <= clientRect.right;\n  };\n\n  var isInsideY = function (clientY, clientRect) {\n    return clientY >= clientRect.top && clientY <= clientRect.bottom;\n  };\n\n  var findClosestClientRect = function (clientRects, clientX) {\n    return reduce(clientRects, function (oldClientRect, clientRect) {\n      var oldDistance = Math.min(distanceToRectLeft(oldClientRect, clientX), distanceToRectRight(oldClientRect, clientX));\n      var newDistance = Math.min(distanceToRectLeft(clientRect, clientX), distanceToRectRight(clientRect, clientX));\n\n      if (isInsideX(clientX, clientRect)) {\n        return clientRect;\n      }\n\n      if (isInsideX(clientX, oldClientRect)) {\n        return oldClientRect;\n      }\n\n      if (newDistance === oldDistance && isContentEditableFalse$8(clientRect.node)) {\n        return clientRect;\n      }\n\n      if (newDistance < oldDistance) {\n        return clientRect;\n      }\n\n      return oldClientRect;\n    });\n  };\n\n  var walkUntil$1 = function (direction, root, predicateFn, startNode, includeChildren) {\n    var node = findNode$1(startNode, direction, isEditableCaretCandidate, root, !includeChildren);\n\n    do {\n      if (!node || predicateFn(node)) {\n        return;\n      }\n    } while (node = findNode$1(node, direction, isEditableCaretCandidate, root));\n  };\n\n  var findLineNodeRects = function (root, targetNodeRect, includeChildren) {\n    if (includeChildren === void 0) {\n      includeChildren = true;\n    }\n\n    var clientRects = [];\n\n    var collect = function (checkPosFn, node) {\n      var lineRects = filter(getClientRects([node]), function (clientRect) {\n        return !checkPosFn(clientRect, targetNodeRect);\n      });\n      clientRects = clientRects.concat(lineRects);\n      return lineRects.length === 0;\n    };\n\n    clientRects.push(targetNodeRect);\n    walkUntil$1(VDirection.Up, root, curry(collect, isAbove), targetNodeRect.node, includeChildren);\n    walkUntil$1(VDirection.Down, root, curry(collect, isBelow), targetNodeRect.node, includeChildren);\n    return clientRects;\n  };\n\n  var getFakeCaretTargets = function (root) {\n    return filter(from$1(root.getElementsByTagName('*')), isFakeCaretTarget);\n  };\n\n  var caretInfo = function (clientRect, clientX) {\n    return {\n      node: clientRect.node,\n      before: distanceToRectLeft(clientRect, clientX) < distanceToRectRight(clientRect, clientX)\n    };\n  };\n\n  var closestFakeCaret = function (root, clientX, clientY) {\n    var fakeTargetNodeRects = getClientRects(getFakeCaretTargets(root));\n    var targetNodeRects = filter(fakeTargetNodeRects, curry(isInsideY, clientY));\n    var closestNodeRect = findClosestClientRect(targetNodeRects, clientX);\n\n    if (closestNodeRect) {\n      var includeChildren = !isTable(closestNodeRect.node) && !isMedia(closestNodeRect.node);\n      closestNodeRect = findClosestClientRect(findLineNodeRects(root, closestNodeRect, includeChildren), clientX);\n\n      if (closestNodeRect && isFakeCaretTarget(closestNodeRect.node)) {\n        return caretInfo(closestNodeRect, clientX);\n      }\n    }\n\n    return null;\n  };\n\n  var moveToRange = function (editor, rng) {\n    editor.selection.setRng(rng);\n    scrollRangeIntoView(editor, editor.selection.getRng());\n  };\n\n  var renderRangeCaretOpt = function (editor, range, scrollIntoView) {\n    return Optional.some(renderRangeCaret(editor, range, scrollIntoView));\n  };\n\n  var moveHorizontally = function (editor, direction, range, isBefore, isAfter, isElement) {\n    var forwards = direction === HDirection.Forwards;\n    var caretWalker = CaretWalker(editor.getBody());\n    var getNextPosFn = curry(getVisualCaretPosition, forwards ? caretWalker.next : caretWalker.prev);\n    var isBeforeFn = forwards ? isBefore : isAfter;\n\n    if (!range.collapsed) {\n      var node = getSelectedNode(range);\n\n      if (isElement(node)) {\n        return showCaret(direction, editor, node, direction === HDirection.Backwards, false);\n      }\n    }\n\n    var caretPosition = getNormalizedRangeEndPoint(direction, editor.getBody(), range);\n\n    if (isBeforeFn(caretPosition)) {\n      return selectNode(editor, caretPosition.getNode(!forwards));\n    }\n\n    var nextCaretPosition = normalizePosition(forwards, getNextPosFn(caretPosition));\n    var rangeIsInContainerBlock = isRangeInCaretContainerBlock(range);\n\n    if (!nextCaretPosition) {\n      return rangeIsInContainerBlock ? Optional.some(range) : Optional.none();\n    }\n\n    if (isBeforeFn(nextCaretPosition)) {\n      return showCaret(direction, editor, nextCaretPosition.getNode(!forwards), forwards, false);\n    }\n\n    var peekCaretPosition = getNextPosFn(nextCaretPosition);\n\n    if (peekCaretPosition && isBeforeFn(peekCaretPosition)) {\n      if (isMoveInsideSameBlock(nextCaretPosition, peekCaretPosition)) {\n        return showCaret(direction, editor, peekCaretPosition.getNode(!forwards), forwards, false);\n      }\n    }\n\n    if (rangeIsInContainerBlock) {\n      return renderRangeCaretOpt(editor, nextCaretPosition.toRange(), false);\n    }\n\n    return Optional.none();\n  };\n\n  var moveVertically = function (editor, direction, range, isBefore, isAfter, isElement) {\n    var caretPosition = getNormalizedRangeEndPoint(direction, editor.getBody(), range);\n    var caretClientRect = last$1(caretPosition.getClientRects());\n    var forwards = direction === VDirection.Down;\n\n    if (!caretClientRect) {\n      return Optional.none();\n    }\n\n    var walkerFn = forwards ? downUntil : upUntil;\n    var linePositions = walkerFn(editor.getBody(), isAboveLine(1), caretPosition);\n    var nextLinePositions = filter(linePositions, isLine(1));\n    var clientX = caretClientRect.left;\n    var nextLineRect = findClosestClientRect(nextLinePositions, clientX);\n\n    if (nextLineRect && isElement(nextLineRect.node)) {\n      var dist1 = Math.abs(clientX - nextLineRect.left);\n      var dist2 = Math.abs(clientX - nextLineRect.right);\n      return showCaret(direction, editor, nextLineRect.node, dist1 < dist2, false);\n    }\n\n    var currentNode;\n\n    if (isBefore(caretPosition)) {\n      currentNode = caretPosition.getNode();\n    } else if (isAfter(caretPosition)) {\n      currentNode = caretPosition.getNode(true);\n    } else {\n      currentNode = getSelectedNode(range);\n    }\n\n    if (currentNode) {\n      var caretPositions = positionsUntil(direction, editor.getBody(), isAboveLine(1), currentNode);\n      var closestNextLineRect = findClosestClientRect(filter(caretPositions, isLine(1)), clientX);\n\n      if (closestNextLineRect) {\n        return renderRangeCaretOpt(editor, closestNextLineRect.position.toRange(), false);\n      }\n\n      closestNextLineRect = last$1(filter(caretPositions, isLine(0)));\n\n      if (closestNextLineRect) {\n        return renderRangeCaretOpt(editor, closestNextLineRect.position.toRange(), false);\n      }\n    }\n\n    if (nextLinePositions.length === 0) {\n      return getLineEndPoint(editor, forwards).filter(forwards ? isAfter : isBefore).map(function (pos) {\n        return renderRangeCaret(editor, pos.toRange(), false);\n      });\n    }\n\n    return Optional.none();\n  };\n\n  var getLineEndPoint = function (editor, forward) {\n    var rng = editor.selection.getRng();\n    var body = editor.getBody();\n\n    if (forward) {\n      var from = CaretPosition$1.fromRangeEnd(rng);\n      var result = getPositionsUntilNextLine(body, from);\n      return last(result.positions);\n    } else {\n      var from = CaretPosition$1.fromRangeStart(rng);\n      var result = getPositionsUntilPreviousLine(body, from);\n      return head(result.positions);\n    }\n  };\n\n  var moveToLineEndPoint = function (editor, forward, isElementPosition) {\n    return getLineEndPoint(editor, forward).filter(isElementPosition).exists(function (pos) {\n      editor.selection.setRng(pos.toRange());\n      return true;\n    });\n  };\n\n  var isContentEditableFalse$9 = isContentEditableFalse;\n\n  var moveToCeFalseHorizontally = function (direction, editor, range) {\n    return moveHorizontally(editor, direction, range, isBeforeContentEditableFalse, isAfterContentEditableFalse, isContentEditableFalse$9);\n  };\n\n  var moveToCeFalseVertically = function (direction, editor, range) {\n    var isBefore = function (caretPosition) {\n      return isBeforeContentEditableFalse(caretPosition) || isBeforeTable(caretPosition);\n    };\n\n    var isAfter = function (caretPosition) {\n      return isAfterContentEditableFalse(caretPosition) || isAfterTable(caretPosition);\n    };\n\n    return moveVertically(editor, direction, range, isBefore, isAfter, isContentEditableFalse$9);\n  };\n\n  var createTextBlock = function (editor) {\n    var textBlock = editor.dom.create(getForcedRootBlock(editor));\n\n    if (!Env.ie || Env.ie >= 11) {\n      textBlock.innerHTML = '<br data-mce-bogus=\"1\">';\n    }\n\n    return textBlock;\n  };\n\n  var exitPreBlock = function (editor, direction, range) {\n    var caretWalker = CaretWalker(editor.getBody());\n    var getVisualCaretPosition$1 = curry(getVisualCaretPosition, direction === 1 ? caretWalker.next : caretWalker.prev);\n\n    if (range.collapsed && hasForcedRootBlock(editor)) {\n      var pre = editor.dom.getParent(range.startContainer, 'PRE');\n\n      if (!pre) {\n        return;\n      }\n\n      var caretPos = getVisualCaretPosition$1(CaretPosition$1.fromRangeStart(range));\n\n      if (!caretPos) {\n        var newBlock = createTextBlock(editor);\n\n        if (direction === 1) {\n          editor.$(pre).after(newBlock);\n        } else {\n          editor.$(pre).before(newBlock);\n        }\n\n        editor.selection.select(newBlock, true);\n        editor.selection.collapse();\n      }\n    }\n  };\n\n  var getHorizontalRange = function (editor, forward) {\n    var direction = forward ? HDirection.Forwards : HDirection.Backwards;\n    var range = editor.selection.getRng();\n    return moveToCeFalseHorizontally(direction, editor, range).orThunk(function () {\n      exitPreBlock(editor, direction, range);\n      return Optional.none();\n    });\n  };\n\n  var getVerticalRange = function (editor, down) {\n    var direction = down ? 1 : -1;\n    var range = editor.selection.getRng();\n    return moveToCeFalseVertically(direction, editor, range).orThunk(function () {\n      exitPreBlock(editor, direction, range);\n      return Optional.none();\n    });\n  };\n\n  var moveH = function (editor, forward) {\n    return getHorizontalRange(editor, forward).exists(function (newRange) {\n      moveToRange(editor, newRange);\n      return true;\n    });\n  };\n\n  var moveV = function (editor, down) {\n    return getVerticalRange(editor, down).exists(function (newRange) {\n      moveToRange(editor, newRange);\n      return true;\n    });\n  };\n\n  var moveToLineEndPoint$1 = function (editor, forward) {\n    var isCefPosition = forward ? isAfterContentEditableFalse : isBeforeContentEditableFalse;\n    return moveToLineEndPoint(editor, forward, isCefPosition);\n  };\n\n  var isTarget = function (node) {\n    return contains(['figcaption'], name(node));\n  };\n\n  var rangeBefore = function (target) {\n    var rng = document.createRange();\n    rng.setStartBefore(target.dom);\n    rng.setEndBefore(target.dom);\n    return rng;\n  };\n\n  var insertElement = function (root, elm, forward) {\n    if (forward) {\n      append(root, elm);\n    } else {\n      prepend(root, elm);\n    }\n  };\n\n  var insertBr = function (root, forward) {\n    var br = SugarElement.fromTag('br');\n    insertElement(root, br, forward);\n    return rangeBefore(br);\n  };\n\n  var insertBlock$1 = function (root, forward, blockName, attrs) {\n    var block = SugarElement.fromTag(blockName);\n    var br = SugarElement.fromTag('br');\n    setAll(block, attrs);\n    append(block, br);\n    insertElement(root, block, forward);\n    return rangeBefore(br);\n  };\n\n  var insertEmptyLine = function (root, rootBlockName, attrs, forward) {\n    if (rootBlockName === '') {\n      return insertBr(root, forward);\n    } else {\n      return insertBlock$1(root, forward, rootBlockName, attrs);\n    }\n  };\n\n  var getClosestTargetBlock = function (pos, root) {\n    var isRoot = curry(eq$2, root);\n    return closest(SugarElement.fromDom(pos.container()), isBlock, isRoot).filter(isTarget);\n  };\n\n  var isAtFirstOrLastLine = function (root, forward, pos) {\n    return forward ? isAtLastLine(root.dom, pos) : isAtFirstLine(root.dom, pos);\n  };\n\n  var moveCaretToNewEmptyLine = function (editor, forward) {\n    var root = SugarElement.fromDom(editor.getBody());\n    var pos = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n    var rootBlock = getForcedRootBlock(editor);\n    var rootBlockAttrs = getForcedRootBlockAttrs(editor);\n    return getClosestTargetBlock(pos, root).exists(function () {\n      if (isAtFirstOrLastLine(root, forward, pos)) {\n        var rng = insertEmptyLine(root, rootBlock, rootBlockAttrs, forward);\n        editor.selection.setRng(rng);\n        return true;\n      } else {\n        return false;\n      }\n    });\n  };\n\n  var moveV$1 = function (editor, forward) {\n    if (editor.selection.isCollapsed()) {\n      return moveCaretToNewEmptyLine(editor, forward);\n    } else {\n      return false;\n    }\n  };\n\n  var defaultPatterns = function (patterns) {\n    return map(patterns, function (pattern) {\n      return __assign({\n        shiftKey: false,\n        altKey: false,\n        ctrlKey: false,\n        metaKey: false,\n        keyCode: 0,\n        action: noop\n      }, pattern);\n    });\n  };\n\n  var matchesEvent = function (pattern, evt) {\n    return evt.keyCode === pattern.keyCode && evt.shiftKey === pattern.shiftKey && evt.altKey === pattern.altKey && evt.ctrlKey === pattern.ctrlKey && evt.metaKey === pattern.metaKey;\n  };\n\n  var match$1 = function (patterns, evt) {\n    return bind(defaultPatterns(patterns), function (pattern) {\n      return matchesEvent(pattern, evt) ? [pattern] : [];\n    });\n  };\n\n  var action = function (f) {\n    var x = [];\n\n    for (var _i = 1; _i < arguments.length; _i++) {\n      x[_i - 1] = arguments[_i];\n    }\n\n    return function () {\n      return f.apply(null, x);\n    };\n  };\n\n  var execute = function (patterns, evt) {\n    return find(match$1(patterns, evt), function (pattern) {\n      return pattern.action();\n    });\n  };\n\n  var moveH$1 = function (editor, forward) {\n    var direction = forward ? HDirection.Forwards : HDirection.Backwards;\n    var range = editor.selection.getRng();\n    return moveHorizontally(editor, direction, range, isBeforeMedia, isAfterMedia, isMedia).exists(function (newRange) {\n      moveToRange(editor, newRange);\n      return true;\n    });\n  };\n\n  var moveV$2 = function (editor, down) {\n    var direction = down ? 1 : -1;\n    var range = editor.selection.getRng();\n    return moveVertically(editor, direction, range, isBeforeMedia, isAfterMedia, isMedia).exists(function (newRange) {\n      moveToRange(editor, newRange);\n      return true;\n    });\n  };\n\n  var moveToLineEndPoint$2 = function (editor, forward) {\n    var isNearMedia = forward ? isAfterMedia : isBeforeMedia;\n    return moveToLineEndPoint(editor, forward, isNearMedia);\n  };\n\n  var deflate = function (rect, delta) {\n    return {\n      left: rect.left - delta,\n      top: rect.top - delta,\n      right: rect.right + delta * 2,\n      bottom: rect.bottom + delta * 2,\n      width: rect.width + delta,\n      height: rect.height + delta\n    };\n  };\n\n  var getCorners = function (getYAxisValue, tds) {\n    return bind(tds, function (td) {\n      var rect = deflate(clone$2(td.getBoundingClientRect()), -1);\n      return [{\n        x: rect.left,\n        y: getYAxisValue(rect),\n        cell: td\n      }, {\n        x: rect.right,\n        y: getYAxisValue(rect),\n        cell: td\n      }];\n    });\n  };\n\n  var findClosestCorner = function (corners, x, y) {\n    return foldl(corners, function (acc, newCorner) {\n      return acc.fold(function () {\n        return Optional.some(newCorner);\n      }, function (oldCorner) {\n        var oldDist = Math.sqrt(Math.abs(oldCorner.x - x) + Math.abs(oldCorner.y - y));\n        var newDist = Math.sqrt(Math.abs(newCorner.x - x) + Math.abs(newCorner.y - y));\n        return Optional.some(newDist < oldDist ? newCorner : oldCorner);\n      });\n    }, Optional.none());\n  };\n\n  var getClosestCell$1 = function (getYAxisValue, isTargetCorner, table, x, y) {\n    var cells = descendants$1(SugarElement.fromDom(table), 'td,th,caption').map(function (e) {\n      return e.dom;\n    });\n    var corners = filter(getCorners(getYAxisValue, cells), function (corner) {\n      return isTargetCorner(corner, y);\n    });\n    return findClosestCorner(corners, x, y).map(function (corner) {\n      return corner.cell;\n    });\n  };\n\n  var getBottomValue = function (rect) {\n    return rect.bottom;\n  };\n\n  var getTopValue = function (rect) {\n    return rect.top;\n  };\n\n  var isAbove$1 = function (corner, y) {\n    return corner.y < y;\n  };\n\n  var isBelow$1 = function (corner, y) {\n    return corner.y > y;\n  };\n\n  var getClosestCellAbove = curry(getClosestCell$1, getBottomValue, isAbove$1);\n  var getClosestCellBelow = curry(getClosestCell$1, getTopValue, isBelow$1);\n\n  var findClosestPositionInAboveCell = function (table, pos) {\n    return head(pos.getClientRects()).bind(function (rect) {\n      return getClosestCellAbove(table, rect.left, rect.top);\n    }).bind(function (cell) {\n      return findClosestHorizontalPosition(getLastLinePositions(cell), pos);\n    });\n  };\n\n  var findClosestPositionInBelowCell = function (table, pos) {\n    return last(pos.getClientRects()).bind(function (rect) {\n      return getClosestCellBelow(table, rect.left, rect.top);\n    }).bind(function (cell) {\n      return findClosestHorizontalPosition(getFirstLinePositions(cell), pos);\n    });\n  };\n\n  var hasNextBreak = function (getPositionsUntil, scope, lineInfo) {\n    return lineInfo.breakAt.exists(function (breakPos) {\n      return getPositionsUntil(scope, breakPos).breakAt.isSome();\n    });\n  };\n\n  var startsWithWrapBreak = function (lineInfo) {\n    return lineInfo.breakType === BreakType.Wrap && lineInfo.positions.length === 0;\n  };\n\n  var startsWithBrBreak = function (lineInfo) {\n    return lineInfo.breakType === BreakType.Br && lineInfo.positions.length === 1;\n  };\n\n  var isAtTableCellLine = function (getPositionsUntil, scope, pos) {\n    var lineInfo = getPositionsUntil(scope, pos);\n\n    if (startsWithWrapBreak(lineInfo) || !isBr(pos.getNode()) && startsWithBrBreak(lineInfo)) {\n      return !hasNextBreak(getPositionsUntil, scope, lineInfo);\n    } else {\n      return lineInfo.breakAt.isNone();\n    }\n  };\n\n  var isAtFirstTableCellLine = curry(isAtTableCellLine, getPositionsUntilPreviousLine);\n  var isAtLastTableCellLine = curry(isAtTableCellLine, getPositionsUntilNextLine);\n\n  var isCaretAtStartOrEndOfTable = function (forward, rng, table) {\n    var caretPos = CaretPosition$1.fromRangeStart(rng);\n    return positionIn(!forward, table).exists(function (pos) {\n      return pos.isEqual(caretPos);\n    });\n  };\n\n  var navigateHorizontally = function (editor, forward, table, _td) {\n    var rng = editor.selection.getRng();\n    var direction = forward ? 1 : -1;\n\n    if (isFakeCaretTableBrowser() && isCaretAtStartOrEndOfTable(forward, rng, table)) {\n      showCaret(direction, editor, table, !forward, false).each(function (newRng) {\n        moveToRange(editor, newRng);\n      });\n      return true;\n    }\n\n    return false;\n  };\n\n  var getClosestAbovePosition = function (root, table, start) {\n    return findClosestPositionInAboveCell(table, start).orThunk(function () {\n      return head(start.getClientRects()).bind(function (rect) {\n        return findClosestHorizontalPositionFromPoint(getPositionsAbove(root, CaretPosition$1.before(table)), rect.left);\n      });\n    }).getOr(CaretPosition$1.before(table));\n  };\n\n  var getClosestBelowPosition = function (root, table, start) {\n    return findClosestPositionInBelowCell(table, start).orThunk(function () {\n      return head(start.getClientRects()).bind(function (rect) {\n        return findClosestHorizontalPositionFromPoint(getPositionsBelow(root, CaretPosition$1.after(table)), rect.left);\n      });\n    }).getOr(CaretPosition$1.after(table));\n  };\n\n  var getTable = function (previous, pos) {\n    var node = pos.getNode(previous);\n    return isElement$1(node) && node.nodeName === 'TABLE' ? Optional.some(node) : Optional.none();\n  };\n\n  var renderBlock = function (down, editor, table, pos) {\n    var forcedRootBlock = getForcedRootBlock(editor);\n\n    if (forcedRootBlock) {\n      editor.undoManager.transact(function () {\n        var element = SugarElement.fromTag(forcedRootBlock);\n        setAll(element, getForcedRootBlockAttrs(editor));\n        append(element, SugarElement.fromTag('br'));\n\n        if (down) {\n          after(SugarElement.fromDom(table), element);\n        } else {\n          before(SugarElement.fromDom(table), element);\n        }\n\n        var rng = editor.dom.createRng();\n        rng.setStart(element.dom, 0);\n        rng.setEnd(element.dom, 0);\n        moveToRange(editor, rng);\n      });\n    } else {\n      moveToRange(editor, pos.toRange());\n    }\n  };\n\n  var moveCaret = function (editor, down, pos) {\n    var table = down ? getTable(true, pos) : getTable(false, pos);\n    var last = down === false;\n    table.fold(function () {\n      return moveToRange(editor, pos.toRange());\n    }, function (table) {\n      return positionIn(last, editor.getBody()).filter(function (lastPos) {\n        return lastPos.isEqual(pos);\n      }).fold(function () {\n        return moveToRange(editor, pos.toRange());\n      }, function (_) {\n        return renderBlock(down, editor, table, pos);\n      });\n    });\n  };\n\n  var navigateVertically = function (editor, down, table, td) {\n    var rng = editor.selection.getRng();\n    var pos = CaretPosition$1.fromRangeStart(rng);\n    var root = editor.getBody();\n\n    if (!down && isAtFirstTableCellLine(td, pos)) {\n      var newPos = getClosestAbovePosition(root, table, pos);\n      moveCaret(editor, down, newPos);\n      return true;\n    } else if (down && isAtLastTableCellLine(td, pos)) {\n      var newPos = getClosestBelowPosition(root, table, pos);\n      moveCaret(editor, down, newPos);\n      return true;\n    } else {\n      return false;\n    }\n  };\n\n  var move$1 = function (editor, forward, mover) {\n    return Optional.from(editor.dom.getParent(editor.selection.getNode(), 'td,th')).bind(function (td) {\n      return Optional.from(editor.dom.getParent(td, 'table')).map(function (table) {\n        return mover(editor, forward, table, td);\n      });\n    }).getOr(false);\n  };\n\n  var moveH$2 = function (editor, forward) {\n    return move$1(editor, forward, navigateHorizontally);\n  };\n\n  var moveV$3 = function (editor, forward) {\n    return move$1(editor, forward, navigateVertically);\n  };\n\n  var executeKeydownOverride = function (editor, caret, evt) {\n    var os = detect$3().os;\n    execute([{\n      keyCode: VK.RIGHT,\n      action: action(moveH, editor, true)\n    }, {\n      keyCode: VK.LEFT,\n      action: action(moveH, editor, false)\n    }, {\n      keyCode: VK.UP,\n      action: action(moveV, editor, false)\n    }, {\n      keyCode: VK.DOWN,\n      action: action(moveV, editor, true)\n    }, {\n      keyCode: VK.RIGHT,\n      action: action(moveH$2, editor, true)\n    }, {\n      keyCode: VK.LEFT,\n      action: action(moveH$2, editor, false)\n    }, {\n      keyCode: VK.UP,\n      action: action(moveV$3, editor, false)\n    }, {\n      keyCode: VK.DOWN,\n      action: action(moveV$3, editor, true)\n    }, {\n      keyCode: VK.RIGHT,\n      action: action(moveH$1, editor, true)\n    }, {\n      keyCode: VK.LEFT,\n      action: action(moveH$1, editor, false)\n    }, {\n      keyCode: VK.UP,\n      action: action(moveV$2, editor, false)\n    }, {\n      keyCode: VK.DOWN,\n      action: action(moveV$2, editor, true)\n    }, {\n      keyCode: VK.RIGHT,\n      action: action(move, editor, caret, true)\n    }, {\n      keyCode: VK.LEFT,\n      action: action(move, editor, caret, false)\n    }, {\n      keyCode: VK.RIGHT,\n      ctrlKey: !os.isOSX(),\n      altKey: os.isOSX(),\n      action: action(moveNextWord, editor, caret)\n    }, {\n      keyCode: VK.LEFT,\n      ctrlKey: !os.isOSX(),\n      altKey: os.isOSX(),\n      action: action(movePrevWord, editor, caret)\n    }, {\n      keyCode: VK.UP,\n      action: action(moveV$1, editor, false)\n    }, {\n      keyCode: VK.DOWN,\n      action: action(moveV$1, editor, true)\n    }], evt).each(function (_) {\n      evt.preventDefault();\n    });\n  };\n\n  var setup$c = function (editor, caret) {\n    editor.on('keydown', function (evt) {\n      if (evt.isDefaultPrevented() === false) {\n        executeKeydownOverride(editor, caret, evt);\n      }\n    });\n  };\n\n  var executeKeydownOverride$1 = function (editor, caret, evt) {\n    execute([{\n      keyCode: VK.BACKSPACE,\n      action: action(backspaceDelete$9, editor, false)\n    }, {\n      keyCode: VK.BACKSPACE,\n      action: action(backspaceDelete$4, editor, false)\n    }, {\n      keyCode: VK.DELETE,\n      action: action(backspaceDelete$4, editor, true)\n    }, {\n      keyCode: VK.BACKSPACE,\n      action: action(backspaceDelete$3, editor, false)\n    }, {\n      keyCode: VK.DELETE,\n      action: action(backspaceDelete$3, editor, true)\n    }, {\n      keyCode: VK.BACKSPACE,\n      action: action(backspaceDelete$6, editor, caret, false)\n    }, {\n      keyCode: VK.DELETE,\n      action: action(backspaceDelete$6, editor, caret, true)\n    }, {\n      keyCode: VK.BACKSPACE,\n      action: action(backspaceDelete, editor, false)\n    }, {\n      keyCode: VK.DELETE,\n      action: action(backspaceDelete, editor, true)\n    }, {\n      keyCode: VK.BACKSPACE,\n      action: action(backspaceDelete$5, editor, false)\n    }, {\n      keyCode: VK.DELETE,\n      action: action(backspaceDelete$5, editor, true)\n    }, {\n      keyCode: VK.BACKSPACE,\n      action: action(backspaceDelete$8, editor, false)\n    }, {\n      keyCode: VK.DELETE,\n      action: action(backspaceDelete$8, editor, true)\n    }, {\n      keyCode: VK.BACKSPACE,\n      action: action(backspaceDelete$2, editor, false)\n    }, {\n      keyCode: VK.DELETE,\n      action: action(backspaceDelete$2, editor, true)\n    }, {\n      keyCode: VK.BACKSPACE,\n      action: action(backspaceDelete$1, editor, false)\n    }, {\n      keyCode: VK.DELETE,\n      action: action(backspaceDelete$1, editor, true)\n    }, {\n      keyCode: VK.BACKSPACE,\n      action: action(backspaceDelete$7, editor, false)\n    }, {\n      keyCode: VK.DELETE,\n      action: action(backspaceDelete$7, editor, true)\n    }], evt).each(function (_) {\n      evt.preventDefault();\n    });\n  };\n\n  var executeKeyupOverride = function (editor, evt) {\n    execute([{\n      keyCode: VK.BACKSPACE,\n      action: action(paddEmptyElement, editor)\n    }, {\n      keyCode: VK.DELETE,\n      action: action(paddEmptyElement, editor)\n    }], evt);\n  };\n\n  var setup$d = function (editor, caret) {\n    editor.on('keydown', function (evt) {\n      if (evt.isDefaultPrevented() === false) {\n        executeKeydownOverride$1(editor, caret, evt);\n      }\n    });\n    editor.on('keyup', function (evt) {\n      if (evt.isDefaultPrevented() === false) {\n        executeKeyupOverride(editor, evt);\n      }\n    });\n  };\n\n  var firstNonWhiteSpaceNodeSibling = function (node) {\n    while (node) {\n      if (node.nodeType === 1 || node.nodeType === 3 && node.data && /[\\r\\n\\s]/.test(node.data)) {\n        return node;\n      }\n\n      node = node.nextSibling;\n    }\n  };\n\n  var moveToCaretPosition = function (editor, root) {\n    var node,\n        lastNode = root;\n    var dom = editor.dom;\n    var moveCaretBeforeOnEnterElementsMap = editor.schema.getMoveCaretBeforeOnEnterElements();\n\n    if (!root) {\n      return;\n    }\n\n    if (/^(LI|DT|DD)$/.test(root.nodeName)) {\n      var firstChild = firstNonWhiteSpaceNodeSibling(root.firstChild);\n\n      if (firstChild && /^(UL|OL|DL)$/.test(firstChild.nodeName)) {\n        root.insertBefore(dom.doc.createTextNode(nbsp), root.firstChild);\n      }\n    }\n\n    var rng = dom.createRng();\n    root.normalize();\n\n    if (root.hasChildNodes()) {\n      var walker = new DomTreeWalker(root, root);\n\n      while (node = walker.current()) {\n        if (isText$1(node)) {\n          rng.setStart(node, 0);\n          rng.setEnd(node, 0);\n          break;\n        }\n\n        if (moveCaretBeforeOnEnterElementsMap[node.nodeName.toLowerCase()]) {\n          rng.setStartBefore(node);\n          rng.setEndBefore(node);\n          break;\n        }\n\n        lastNode = node;\n        node = walker.next();\n      }\n\n      if (!node) {\n        rng.setStart(lastNode, 0);\n        rng.setEnd(lastNode, 0);\n      }\n    } else {\n      if (isBr(root)) {\n        if (root.nextSibling && dom.isBlock(root.nextSibling)) {\n          rng.setStartBefore(root);\n          rng.setEndBefore(root);\n        } else {\n          rng.setStartAfter(root);\n          rng.setEndAfter(root);\n        }\n      } else {\n        rng.setStart(root, 0);\n        rng.setEnd(root, 0);\n      }\n    }\n\n    editor.selection.setRng(rng);\n    scrollRangeIntoView(editor, rng);\n  };\n\n  var getEditableRoot = function (dom, node) {\n    var root = dom.getRoot();\n    var parent, editableRoot;\n    parent = node;\n\n    while (parent !== root && dom.getContentEditable(parent) !== 'false') {\n      if (dom.getContentEditable(parent) === 'true') {\n        editableRoot = parent;\n      }\n\n      parent = parent.parentNode;\n    }\n\n    return parent !== root ? editableRoot : root;\n  };\n\n  var getParentBlock$2 = function (editor) {\n    return Optional.from(editor.dom.getParent(editor.selection.getStart(true), editor.dom.isBlock));\n  };\n\n  var getParentBlockName = function (editor) {\n    return getParentBlock$2(editor).fold(constant(''), function (parentBlock) {\n      return parentBlock.nodeName.toUpperCase();\n    });\n  };\n\n  var isListItemParentBlock = function (editor) {\n    return getParentBlock$2(editor).filter(function (elm) {\n      return isListItem(SugarElement.fromDom(elm));\n    }).isSome();\n  };\n\n  var hasFirstChild = function (elm, name) {\n    return elm.firstChild && elm.firstChild.nodeName === name;\n  };\n\n  var hasParent$1 = function (elm, parentName) {\n    return elm && elm.parentNode && elm.parentNode.nodeName === parentName;\n  };\n\n  var isListBlock = function (elm) {\n    return elm && /^(OL|UL|LI)$/.test(elm.nodeName);\n  };\n\n  var isNestedList = function (elm) {\n    return isListBlock(elm) && isListBlock(elm.parentNode);\n  };\n\n  var getContainerBlock = function (containerBlock) {\n    var containerBlockParent = containerBlock.parentNode;\n\n    if (/^(LI|DT|DD)$/.test(containerBlockParent.nodeName)) {\n      return containerBlockParent;\n    }\n\n    return containerBlock;\n  };\n\n  var isFirstOrLastLi = function (containerBlock, parentBlock, first) {\n    var node = containerBlock[first ? 'firstChild' : 'lastChild'];\n\n    while (node) {\n      if (isElement$1(node)) {\n        break;\n      }\n\n      node = node[first ? 'nextSibling' : 'previousSibling'];\n    }\n\n    return node === parentBlock;\n  };\n\n  var insert = function (editor, createNewBlock, containerBlock, parentBlock, newBlockName) {\n    var dom = editor.dom;\n    var rng = editor.selection.getRng();\n\n    if (containerBlock === editor.getBody()) {\n      return;\n    }\n\n    if (isNestedList(containerBlock)) {\n      newBlockName = 'LI';\n    }\n\n    var newBlock = newBlockName ? createNewBlock(newBlockName) : dom.create('BR');\n\n    if (isFirstOrLastLi(containerBlock, parentBlock, true) && isFirstOrLastLi(containerBlock, parentBlock, false)) {\n      if (hasParent$1(containerBlock, 'LI')) {\n        dom.insertAfter(newBlock, getContainerBlock(containerBlock));\n      } else {\n        dom.replace(newBlock, containerBlock);\n      }\n    } else if (isFirstOrLastLi(containerBlock, parentBlock, true)) {\n      if (hasParent$1(containerBlock, 'LI')) {\n        dom.insertAfter(newBlock, getContainerBlock(containerBlock));\n        newBlock.appendChild(dom.doc.createTextNode(' '));\n        newBlock.appendChild(containerBlock);\n      } else {\n        containerBlock.parentNode.insertBefore(newBlock, containerBlock);\n      }\n    } else if (isFirstOrLastLi(containerBlock, parentBlock, false)) {\n      dom.insertAfter(newBlock, getContainerBlock(containerBlock));\n    } else {\n      containerBlock = getContainerBlock(containerBlock);\n      var tmpRng = rng.cloneRange();\n      tmpRng.setStartAfter(parentBlock);\n      tmpRng.setEndAfter(containerBlock);\n      var fragment = tmpRng.extractContents();\n\n      if (newBlockName === 'LI' && hasFirstChild(fragment, 'LI')) {\n        newBlock = fragment.firstChild;\n        dom.insertAfter(fragment, containerBlock);\n      } else {\n        dom.insertAfter(fragment, containerBlock);\n        dom.insertAfter(newBlock, containerBlock);\n      }\n    }\n\n    dom.remove(parentBlock);\n    moveToCaretPosition(editor, newBlock);\n  };\n\n  var trimZwsp = function (fragment) {\n    each(descendants(SugarElement.fromDom(fragment), isText), function (text) {\n      var rawNode = text.dom;\n      rawNode.nodeValue = trim$2(rawNode.nodeValue);\n    });\n  };\n\n  var isEmptyAnchor = function (dom, elm) {\n    return elm && elm.nodeName === 'A' && dom.isEmpty(elm);\n  };\n\n  var isTableCell$5 = function (node) {\n    return node && /^(TD|TH|CAPTION)$/.test(node.nodeName);\n  };\n\n  var emptyBlock = function (elm) {\n    elm.innerHTML = '<br data-mce-bogus=\"1\">';\n  };\n\n  var containerAndSiblingName = function (container, nodeName) {\n    return container.nodeName === nodeName || container.previousSibling && container.previousSibling.nodeName === nodeName;\n  };\n\n  var canSplitBlock = function (dom, node) {\n    return node && dom.isBlock(node) && !/^(TD|TH|CAPTION|FORM)$/.test(node.nodeName) && !/^(fixed|absolute)/i.test(node.style.position) && dom.getContentEditable(node) !== 'true';\n  };\n\n  var trimInlineElementsOnLeftSideOfBlock = function (dom, nonEmptyElementsMap, block) {\n    var node = block;\n    var firstChilds = [];\n    var i;\n\n    if (!node) {\n      return;\n    }\n\n    while (node = node.firstChild) {\n      if (dom.isBlock(node)) {\n        return;\n      }\n\n      if (isElement$1(node) && !nonEmptyElementsMap[node.nodeName.toLowerCase()]) {\n        firstChilds.push(node);\n      }\n    }\n\n    i = firstChilds.length;\n\n    while (i--) {\n      node = firstChilds[i];\n\n      if (!node.hasChildNodes() || node.firstChild === node.lastChild && node.firstChild.nodeValue === '') {\n        dom.remove(node);\n      } else {\n        if (isEmptyAnchor(dom, node)) {\n          dom.remove(node);\n        }\n      }\n    }\n  };\n\n  var normalizeZwspOffset = function (start, container, offset) {\n    if (isText$1(container) === false) {\n      return offset;\n    } else if (start) {\n      return offset === 1 && container.data.charAt(offset - 1) === ZWSP ? 0 : offset;\n    } else {\n      return offset === container.data.length - 1 && container.data.charAt(offset) === ZWSP ? container.data.length : offset;\n    }\n  };\n\n  var includeZwspInRange = function (rng) {\n    var newRng = rng.cloneRange();\n    newRng.setStart(rng.startContainer, normalizeZwspOffset(true, rng.startContainer, rng.startOffset));\n    newRng.setEnd(rng.endContainer, normalizeZwspOffset(false, rng.endContainer, rng.endOffset));\n    return newRng;\n  };\n\n  var trimLeadingLineBreaks = function (node) {\n    do {\n      if (isText$1(node)) {\n        node.nodeValue = node.nodeValue.replace(/^[\\r\\n]+/, '');\n      }\n\n      node = node.firstChild;\n    } while (node);\n  };\n\n  var getEditableRoot$1 = function (dom, node) {\n    var root = dom.getRoot();\n    var parent, editableRoot;\n    parent = node;\n\n    while (parent !== root && dom.getContentEditable(parent) !== 'false') {\n      if (dom.getContentEditable(parent) === 'true') {\n        editableRoot = parent;\n      }\n\n      parent = parent.parentNode;\n    }\n\n    return parent !== root ? editableRoot : root;\n  };\n\n  var applyAttributes = function (editor, node, forcedRootBlockAttrs) {\n    var dom = editor.dom;\n    Optional.from(forcedRootBlockAttrs.style).map(dom.parseStyle).each(function (attrStyles) {\n      var currentStyles = getAllRaw(SugarElement.fromDom(node));\n\n      var newStyles = __assign(__assign({}, currentStyles), attrStyles);\n\n      dom.setStyles(node, newStyles);\n    });\n    var attrClassesOpt = Optional.from(forcedRootBlockAttrs.class).map(function (attrClasses) {\n      return attrClasses.split(/\\s+/);\n    });\n    var currentClassesOpt = Optional.from(node.className).map(function (currentClasses) {\n      return filter(currentClasses.split(/\\s+/), function (clazz) {\n        return clazz !== '';\n      });\n    });\n    lift2(attrClassesOpt, currentClassesOpt, function (attrClasses, currentClasses) {\n      var filteredClasses = filter(currentClasses, function (clazz) {\n        return !contains(attrClasses, clazz);\n      });\n\n      var newClasses = __spreadArrays(attrClasses, filteredClasses);\n\n      dom.setAttrib(node, 'class', newClasses.join(' '));\n    });\n    var appliedAttrs = ['style', 'class'];\n    var remainingAttrs = filter$1(forcedRootBlockAttrs, function (_, attrs) {\n      return !contains(appliedAttrs, attrs);\n    });\n    dom.setAttribs(node, remainingAttrs);\n  };\n\n  var setForcedBlockAttrs = function (editor, node) {\n    var forcedRootBlockName = getForcedRootBlock(editor);\n\n    if (forcedRootBlockName && forcedRootBlockName.toLowerCase() === node.tagName.toLowerCase()) {\n      var forcedRootBlockAttrs = getForcedRootBlockAttrs(editor);\n      applyAttributes(editor, node, forcedRootBlockAttrs);\n    }\n  };\n\n  var wrapSelfAndSiblingsInDefaultBlock = function (editor, newBlockName, rng, container, offset) {\n    var newBlock, parentBlock, startNode, node, next, rootBlockName;\n    var blockName = newBlockName || 'P';\n    var dom = editor.dom,\n        editableRoot = getEditableRoot$1(dom, container);\n    parentBlock = dom.getParent(container, dom.isBlock);\n\n    if (!parentBlock || !canSplitBlock(dom, parentBlock)) {\n      parentBlock = parentBlock || editableRoot;\n\n      if (parentBlock === editor.getBody() || isTableCell$5(parentBlock)) {\n        rootBlockName = parentBlock.nodeName.toLowerCase();\n      } else {\n        rootBlockName = parentBlock.parentNode.nodeName.toLowerCase();\n      }\n\n      if (!parentBlock.hasChildNodes()) {\n        newBlock = dom.create(blockName);\n        setForcedBlockAttrs(editor, newBlock);\n        parentBlock.appendChild(newBlock);\n        rng.setStart(newBlock, 0);\n        rng.setEnd(newBlock, 0);\n        return newBlock;\n      }\n\n      node = container;\n\n      while (node.parentNode !== parentBlock) {\n        node = node.parentNode;\n      }\n\n      while (node && !dom.isBlock(node)) {\n        startNode = node;\n        node = node.previousSibling;\n      }\n\n      if (startNode && editor.schema.isValidChild(rootBlockName, blockName.toLowerCase())) {\n        newBlock = dom.create(blockName);\n        setForcedBlockAttrs(editor, newBlock);\n        startNode.parentNode.insertBefore(newBlock, startNode);\n        node = startNode;\n\n        while (node && !dom.isBlock(node)) {\n          next = node.nextSibling;\n          newBlock.appendChild(node);\n          node = next;\n        }\n\n        rng.setStart(container, offset);\n        rng.setEnd(container, offset);\n      }\n    }\n\n    return container;\n  };\n\n  var addBrToBlockIfNeeded = function (dom, block) {\n    block.normalize();\n    var lastChild = block.lastChild;\n\n    if (!lastChild || /^(left|right)$/gi.test(dom.getStyle(lastChild, 'float', true))) {\n      dom.add(block, 'br');\n    }\n  };\n\n  var insert$1 = function (editor, evt) {\n    var tmpRng, container, offset, parentBlock;\n    var newBlock, fragment, containerBlock, parentBlockName, newBlockName, isAfterLastNodeInContainer;\n    var dom = editor.dom;\n    var schema = editor.schema,\n        nonEmptyElementsMap = schema.getNonEmptyElements();\n    var rng = editor.selection.getRng();\n\n    var createNewBlock = function (name) {\n      var node = container,\n          block,\n          clonedNode,\n          caretNode;\n      var textInlineElements = schema.getTextInlineElements();\n\n      if (name || parentBlockName === 'TABLE' || parentBlockName === 'HR') {\n        block = dom.create(name || newBlockName);\n      } else {\n        block = parentBlock.cloneNode(false);\n      }\n\n      caretNode = block;\n\n      if (shouldKeepStyles(editor) === false) {\n        dom.setAttrib(block, 'style', null);\n        dom.setAttrib(block, 'class', null);\n      } else {\n        do {\n          if (textInlineElements[node.nodeName]) {\n            if (isCaretNode(node) || isBookmarkNode$1(node)) {\n              continue;\n            }\n\n            clonedNode = node.cloneNode(false);\n            dom.setAttrib(clonedNode, 'id', '');\n\n            if (block.hasChildNodes()) {\n              clonedNode.appendChild(block.firstChild);\n              block.appendChild(clonedNode);\n            } else {\n              caretNode = clonedNode;\n              block.appendChild(clonedNode);\n            }\n          }\n        } while ((node = node.parentNode) && node !== editableRoot);\n      }\n\n      setForcedBlockAttrs(editor, block);\n      emptyBlock(caretNode);\n      return block;\n    };\n\n    var isCaretAtStartOrEndOfBlock = function (start) {\n      var node, name;\n      var normalizedOffset = normalizeZwspOffset(start, container, offset);\n\n      if (isText$1(container) && (start ? normalizedOffset > 0 : normalizedOffset < container.nodeValue.length)) {\n        return false;\n      }\n\n      if (container.parentNode === parentBlock && isAfterLastNodeInContainer && !start) {\n        return true;\n      }\n\n      if (start && isElement$1(container) && container === parentBlock.firstChild) {\n        return true;\n      }\n\n      if (containerAndSiblingName(container, 'TABLE') || containerAndSiblingName(container, 'HR')) {\n        return isAfterLastNodeInContainer && !start || !isAfterLastNodeInContainer && start;\n      }\n\n      var walker = new DomTreeWalker(container, parentBlock);\n\n      if (isText$1(container)) {\n        if (start && normalizedOffset === 0) {\n          walker.prev();\n        } else if (!start && normalizedOffset === container.nodeValue.length) {\n          walker.next();\n        }\n      }\n\n      while (node = walker.current()) {\n        if (isElement$1(node)) {\n          if (!node.getAttribute('data-mce-bogus')) {\n            name = node.nodeName.toLowerCase();\n\n            if (nonEmptyElementsMap[name] && name !== 'br') {\n              return false;\n            }\n          }\n        } else if (isText$1(node) && !isWhitespaceText(node.nodeValue)) {\n          return false;\n        }\n\n        if (start) {\n          walker.prev();\n        } else {\n          walker.next();\n        }\n      }\n\n      return true;\n    };\n\n    var insertNewBlockAfter = function () {\n      if (/^(H[1-6]|PRE|FIGURE)$/.test(parentBlockName) && containerBlockName !== 'HGROUP') {\n        newBlock = createNewBlock(newBlockName);\n      } else {\n        newBlock = createNewBlock();\n      }\n\n      if (shouldEndContainerOnEmptyBlock(editor) && canSplitBlock(dom, containerBlock) && dom.isEmpty(parentBlock)) {\n        newBlock = dom.split(containerBlock, parentBlock);\n      } else {\n        dom.insertAfter(newBlock, parentBlock);\n      }\n\n      moveToCaretPosition(editor, newBlock);\n    };\n\n    normalize(dom, rng).each(function (normRng) {\n      rng.setStart(normRng.startContainer, normRng.startOffset);\n      rng.setEnd(normRng.endContainer, normRng.endOffset);\n    });\n    container = rng.startContainer;\n    offset = rng.startOffset;\n    newBlockName = getForcedRootBlock(editor);\n    var shiftKey = !!(evt && evt.shiftKey);\n    var ctrlKey = !!(evt && evt.ctrlKey);\n\n    if (isElement$1(container) && container.hasChildNodes()) {\n      isAfterLastNodeInContainer = offset > container.childNodes.length - 1;\n      container = container.childNodes[Math.min(offset, container.childNodes.length - 1)] || container;\n\n      if (isAfterLastNodeInContainer && isText$1(container)) {\n        offset = container.nodeValue.length;\n      } else {\n        offset = 0;\n      }\n    }\n\n    var editableRoot = getEditableRoot$1(dom, container);\n\n    if (!editableRoot) {\n      return;\n    }\n\n    if (newBlockName && !shiftKey || !newBlockName && shiftKey) {\n      container = wrapSelfAndSiblingsInDefaultBlock(editor, newBlockName, rng, container, offset);\n    }\n\n    parentBlock = dom.getParent(container, dom.isBlock);\n    containerBlock = parentBlock ? dom.getParent(parentBlock.parentNode, dom.isBlock) : null;\n    parentBlockName = parentBlock ? parentBlock.nodeName.toUpperCase() : '';\n    var containerBlockName = containerBlock ? containerBlock.nodeName.toUpperCase() : '';\n\n    if (containerBlockName === 'LI' && !ctrlKey) {\n      parentBlock = containerBlock;\n      containerBlock = containerBlock.parentNode;\n      parentBlockName = containerBlockName;\n    }\n\n    if (/^(LI|DT|DD)$/.test(parentBlockName)) {\n      if (dom.isEmpty(parentBlock)) {\n        insert(editor, createNewBlock, containerBlock, parentBlock, newBlockName);\n        return;\n      }\n    }\n\n    if (newBlockName && parentBlock === editor.getBody()) {\n      return;\n    }\n\n    newBlockName = newBlockName || 'P';\n\n    if (isCaretContainerBlock(parentBlock)) {\n      newBlock = showCaretContainerBlock(parentBlock);\n\n      if (dom.isEmpty(parentBlock)) {\n        emptyBlock(parentBlock);\n      }\n\n      setForcedBlockAttrs(editor, newBlock);\n      moveToCaretPosition(editor, newBlock);\n    } else if (isCaretAtStartOrEndOfBlock()) {\n      insertNewBlockAfter();\n    } else if (isCaretAtStartOrEndOfBlock(true)) {\n      newBlock = parentBlock.parentNode.insertBefore(createNewBlock(), parentBlock);\n      moveToCaretPosition(editor, containerAndSiblingName(parentBlock, 'HR') ? newBlock : parentBlock);\n    } else {\n      tmpRng = includeZwspInRange(rng).cloneRange();\n      tmpRng.setEndAfter(parentBlock);\n      fragment = tmpRng.extractContents();\n      trimZwsp(fragment);\n      trimLeadingLineBreaks(fragment);\n      newBlock = fragment.firstChild;\n      dom.insertAfter(fragment, parentBlock);\n      trimInlineElementsOnLeftSideOfBlock(dom, nonEmptyElementsMap, newBlock);\n      addBrToBlockIfNeeded(dom, parentBlock);\n\n      if (dom.isEmpty(parentBlock)) {\n        emptyBlock(parentBlock);\n      }\n\n      newBlock.normalize();\n\n      if (dom.isEmpty(newBlock)) {\n        dom.remove(newBlock);\n        insertNewBlockAfter();\n      } else {\n        setForcedBlockAttrs(editor, newBlock);\n        moveToCaretPosition(editor, newBlock);\n      }\n    }\n\n    dom.setAttrib(newBlock, 'id', '');\n    editor.fire('NewBlock', {\n      newBlock: newBlock\n    });\n  };\n\n  var hasRightSideContent = function (schema, container, parentBlock) {\n    var walker = new DomTreeWalker(container, parentBlock);\n    var node;\n    var nonEmptyElementsMap = schema.getNonEmptyElements();\n\n    while (node = walker.next()) {\n      if (nonEmptyElementsMap[node.nodeName.toLowerCase()] || node.length > 0) {\n        return true;\n      }\n    }\n  };\n\n  var scrollToBr = function (dom, selection, brElm) {\n    var marker = dom.create('span', {}, '&nbsp;');\n    brElm.parentNode.insertBefore(marker, brElm);\n    selection.scrollIntoView(marker);\n    dom.remove(marker);\n  };\n\n  var moveSelectionToBr = function (dom, selection, brElm, extraBr) {\n    var rng = dom.createRng();\n\n    if (!extraBr) {\n      rng.setStartAfter(brElm);\n      rng.setEndAfter(brElm);\n    } else {\n      rng.setStartBefore(brElm);\n      rng.setEndBefore(brElm);\n    }\n\n    selection.setRng(rng);\n  };\n\n  var insertBrAtCaret = function (editor, evt) {\n    var selection = editor.selection;\n    var dom = editor.dom;\n    var rng = selection.getRng();\n    var brElm;\n    var extraBr;\n    normalize(dom, rng).each(function (normRng) {\n      rng.setStart(normRng.startContainer, normRng.startOffset);\n      rng.setEnd(normRng.endContainer, normRng.endOffset);\n    });\n    var offset = rng.startOffset;\n    var container = rng.startContainer;\n\n    if (container.nodeType === 1 && container.hasChildNodes()) {\n      var isAfterLastNodeInContainer = offset > container.childNodes.length - 1;\n      container = container.childNodes[Math.min(offset, container.childNodes.length - 1)] || container;\n\n      if (isAfterLastNodeInContainer && container.nodeType === 3) {\n        offset = container.nodeValue.length;\n      } else {\n        offset = 0;\n      }\n    }\n\n    var parentBlock = dom.getParent(container, dom.isBlock);\n    var containerBlock = parentBlock ? dom.getParent(parentBlock.parentNode, dom.isBlock) : null;\n    var containerBlockName = containerBlock ? containerBlock.nodeName.toUpperCase() : '';\n    var isControlKey = !!(evt && evt.ctrlKey);\n\n    if (containerBlockName === 'LI' && !isControlKey) {\n      parentBlock = containerBlock;\n    }\n\n    if (container && container.nodeType === 3 && offset >= container.nodeValue.length) {\n      if (!hasRightSideContent(editor.schema, container, parentBlock)) {\n        brElm = dom.create('br');\n        rng.insertNode(brElm);\n        rng.setStartAfter(brElm);\n        rng.setEndAfter(brElm);\n        extraBr = true;\n      }\n    }\n\n    brElm = dom.create('br');\n    rangeInsertNode(dom, rng, brElm);\n    scrollToBr(dom, selection, brElm);\n    moveSelectionToBr(dom, selection, brElm, extraBr);\n    editor.undoManager.add();\n  };\n\n  var insertBrBefore = function (editor, inline) {\n    var br = SugarElement.fromTag('br');\n    before(SugarElement.fromDom(inline), br);\n    editor.undoManager.add();\n  };\n\n  var insertBrAfter = function (editor, inline) {\n    if (!hasBrAfter(editor.getBody(), inline)) {\n      after(SugarElement.fromDom(inline), SugarElement.fromTag('br'));\n    }\n\n    var br = SugarElement.fromTag('br');\n    after(SugarElement.fromDom(inline), br);\n    scrollToBr(editor.dom, editor.selection, br.dom);\n    moveSelectionToBr(editor.dom, editor.selection, br.dom, false);\n    editor.undoManager.add();\n  };\n\n  var isBeforeBr$1 = function (pos) {\n    return isBr(pos.getNode());\n  };\n\n  var hasBrAfter = function (rootNode, startNode) {\n    if (isBeforeBr$1(CaretPosition$1.after(startNode))) {\n      return true;\n    } else {\n      return nextPosition(rootNode, CaretPosition$1.after(startNode)).map(function (pos) {\n        return isBr(pos.getNode());\n      }).getOr(false);\n    }\n  };\n\n  var isAnchorLink = function (elm) {\n    return elm && elm.nodeName === 'A' && 'href' in elm;\n  };\n\n  var isInsideAnchor = function (location) {\n    return location.fold(never, isAnchorLink, isAnchorLink, never);\n  };\n\n  var readInlineAnchorLocation = function (editor) {\n    var isInlineTarget$1 = curry(isInlineTarget, editor);\n    var position = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n    return readLocation(isInlineTarget$1, editor.getBody(), position).filter(isInsideAnchor);\n  };\n\n  var insertBrOutsideAnchor = function (editor, location) {\n    location.fold(noop, curry(insertBrBefore, editor), curry(insertBrAfter, editor), noop);\n  };\n\n  var insert$2 = function (editor, evt) {\n    var anchorLocation = readInlineAnchorLocation(editor);\n\n    if (anchorLocation.isSome()) {\n      anchorLocation.each(curry(insertBrOutsideAnchor, editor));\n    } else {\n      insertBrAtCaret(editor, evt);\n    }\n  };\n\n  var matchesSelector = function (editor, selector) {\n    return getParentBlock$2(editor).filter(function (parentBlock) {\n      return selector.length > 0 && is$1(SugarElement.fromDom(parentBlock), selector);\n    }).isSome();\n  };\n\n  var shouldInsertBr = function (editor) {\n    return matchesSelector(editor, getBrNewLineSelector(editor));\n  };\n\n  var shouldBlockNewLine = function (editor) {\n    return matchesSelector(editor, getNoNewLineSelector(editor));\n  };\n\n  var newLineAction = Adt.generate([{\n    br: []\n  }, {\n    block: []\n  }, {\n    none: []\n  }]);\n\n  var shouldBlockNewLine$1 = function (editor, _shiftKey) {\n    return shouldBlockNewLine(editor);\n  };\n\n  var isBrMode = function (requiredState) {\n    return function (editor, _shiftKey) {\n      var brMode = getForcedRootBlock(editor) === '';\n      return brMode === requiredState;\n    };\n  };\n\n  var inListBlock = function (requiredState) {\n    return function (editor, _shiftKey) {\n      return isListItemParentBlock(editor) === requiredState;\n    };\n  };\n\n  var inBlock = function (blockName, requiredState) {\n    return function (editor, _shiftKey) {\n      var state = getParentBlockName(editor) === blockName.toUpperCase();\n      return state === requiredState;\n    };\n  };\n\n  var inPreBlock = function (requiredState) {\n    return inBlock('pre', requiredState);\n  };\n\n  var inSummaryBlock = function () {\n    return inBlock('summary', true);\n  };\n\n  var shouldPutBrInPre$1 = function (requiredState) {\n    return function (editor, _shiftKey) {\n      return shouldPutBrInPre(editor) === requiredState;\n    };\n  };\n\n  var inBrContext = function (editor, _shiftKey) {\n    return shouldInsertBr(editor);\n  };\n\n  var hasShiftKey = function (_editor, shiftKey) {\n    return shiftKey;\n  };\n\n  var canInsertIntoEditableRoot = function (editor) {\n    var forcedRootBlock = getForcedRootBlock(editor);\n    var rootEditable = getEditableRoot(editor.dom, editor.selection.getStart());\n    return rootEditable && editor.schema.isValidChild(rootEditable.nodeName, forcedRootBlock ? forcedRootBlock : 'P');\n  };\n\n  var match$2 = function (predicates, action) {\n    return function (editor, shiftKey) {\n      var isMatch = foldl(predicates, function (res, p) {\n        return res && p(editor, shiftKey);\n      }, true);\n      return isMatch ? Optional.some(action) : Optional.none();\n    };\n  };\n\n  var getAction$1 = function (editor, evt) {\n    return evaluateUntil([match$2([shouldBlockNewLine$1], newLineAction.none()), match$2([inSummaryBlock()], newLineAction.br()), match$2([inPreBlock(true), shouldPutBrInPre$1(false), hasShiftKey], newLineAction.br()), match$2([inPreBlock(true), shouldPutBrInPre$1(false)], newLineAction.block()), match$2([inPreBlock(true), shouldPutBrInPre$1(true), hasShiftKey], newLineAction.block()), match$2([inPreBlock(true), shouldPutBrInPre$1(true)], newLineAction.br()), match$2([inListBlock(true), hasShiftKey], newLineAction.br()), match$2([inListBlock(true)], newLineAction.block()), match$2([isBrMode(true), hasShiftKey, canInsertIntoEditableRoot], newLineAction.block()), match$2([isBrMode(true)], newLineAction.br()), match$2([inBrContext], newLineAction.br()), match$2([isBrMode(false), hasShiftKey], newLineAction.br()), match$2([canInsertIntoEditableRoot], newLineAction.block())], [editor, !!(evt && evt.shiftKey)]).getOr(newLineAction.none());\n  };\n\n  var insert$3 = function (editor, evt) {\n    getAction$1(editor, evt).fold(function () {\n      insert$2(editor, evt);\n    }, function () {\n      insert$1(editor, evt);\n    }, noop);\n  };\n\n  var handleEnterKeyEvent = function (editor, event) {\n    if (event.isDefaultPrevented()) {\n      return;\n    }\n\n    event.preventDefault();\n    endTypingLevelIgnoreLocks(editor.undoManager);\n    editor.undoManager.transact(function () {\n      if (editor.selection.isCollapsed() === false) {\n        editor.execCommand('Delete');\n      }\n\n      insert$3(editor, event);\n    });\n  };\n\n  var setup$e = function (editor) {\n    editor.on('keydown', function (event) {\n      if (event.keyCode === VK.ENTER) {\n        handleEnterKeyEvent(editor, event);\n      }\n    });\n  };\n\n  var executeKeydownOverride$2 = function (editor, evt) {\n    execute([{\n      keyCode: VK.END,\n      action: action(moveToLineEndPoint$1, editor, true)\n    }, {\n      keyCode: VK.HOME,\n      action: action(moveToLineEndPoint$1, editor, false)\n    }, {\n      keyCode: VK.END,\n      action: action(moveToLineEndPoint$2, editor, true)\n    }, {\n      keyCode: VK.HOME,\n      action: action(moveToLineEndPoint$2, editor, false)\n    }], evt).each(function (_) {\n      evt.preventDefault();\n    });\n  };\n\n  var setup$f = function (editor) {\n    editor.on('keydown', function (evt) {\n      if (evt.isDefaultPrevented() === false) {\n        executeKeydownOverride$2(editor, evt);\n      }\n    });\n  };\n\n  var browser$4 = detect$3().browser;\n\n  var setupIeInput = function (editor) {\n    var keypressThrotter = first(function () {\n      if (!editor.composing) {\n        normalizeNbspsInEditor(editor);\n      }\n    }, 0);\n\n    if (browser$4.isIE()) {\n      editor.on('keypress', function (_e) {\n        keypressThrotter.throttle();\n      });\n      editor.on('remove', function (_e) {\n        keypressThrotter.cancel();\n      });\n    }\n  };\n\n  var setup$g = function (editor) {\n    setupIeInput(editor);\n    editor.on('input', function (e) {\n      if (e.isComposing === false) {\n        normalizeNbspsInEditor(editor);\n      }\n    });\n  };\n\n  var insertTextAtPosition = function (text, pos) {\n    var container = pos.container();\n    var offset = pos.offset();\n\n    if (isText$1(container)) {\n      container.insertData(offset, text);\n      return Optional.some(CaretPosition(container, offset + text.length));\n    } else {\n      return getElementFromPosition(pos).map(function (elm) {\n        var textNode = SugarElement.fromText(text);\n\n        if (pos.isAtEnd()) {\n          after(elm, textNode);\n        } else {\n          before(elm, textNode);\n        }\n\n        return CaretPosition(textNode.dom, text.length);\n      });\n    }\n  };\n\n  var insertNbspAtPosition = curry(insertTextAtPosition, nbsp);\n  var insertSpaceAtPosition = curry(insertTextAtPosition, ' ');\n\n  var locationToCaretPosition = function (root) {\n    return function (location) {\n      return location.fold(function (element) {\n        return prevPosition(root.dom, CaretPosition$1.before(element));\n      }, function (element) {\n        return firstPositionIn(element);\n      }, function (element) {\n        return lastPositionIn(element);\n      }, function (element) {\n        return nextPosition(root.dom, CaretPosition$1.after(element));\n      });\n    };\n  };\n\n  var insertInlineBoundarySpaceOrNbsp = function (root, pos) {\n    return function (checkPos) {\n      return needsToHaveNbsp(root, checkPos) ? insertNbspAtPosition(pos) : insertSpaceAtPosition(pos);\n    };\n  };\n\n  var setSelection$1 = function (editor) {\n    return function (pos) {\n      editor.selection.setRng(pos.toRange());\n      editor.nodeChanged();\n      return true;\n    };\n  };\n\n  var insertSpaceOrNbspAtSelection = function (editor) {\n    var pos = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n    var root = SugarElement.fromDom(editor.getBody());\n\n    if (editor.selection.isCollapsed()) {\n      var isInlineTarget$1 = curry(isInlineTarget, editor);\n      var caretPosition = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n      return readLocation(isInlineTarget$1, editor.getBody(), caretPosition).bind(locationToCaretPosition(root)).bind(insertInlineBoundarySpaceOrNbsp(root, pos)).exists(setSelection$1(editor));\n    } else {\n      return false;\n    }\n  };\n\n  var executeKeydownOverride$3 = function (editor, evt) {\n    execute([{\n      keyCode: VK.SPACEBAR,\n      action: action(insertSpaceOrNbspAtSelection, editor)\n    }], evt).each(function (_) {\n      evt.preventDefault();\n    });\n  };\n\n  var setup$h = function (editor) {\n    editor.on('keydown', function (evt) {\n      if (evt.isDefaultPrevented() === false) {\n        executeKeydownOverride$3(editor, evt);\n      }\n    });\n  };\n\n  var registerKeyboardOverrides = function (editor) {\n    var caret = setupSelectedState(editor);\n    setup$b(editor);\n    setup$c(editor, caret);\n    setup$d(editor, caret);\n    setup$e(editor);\n    setup$h(editor);\n    setup$g(editor);\n    setup$f(editor);\n    return caret;\n  };\n\n  var setup$i = function (editor) {\n    if (!isRtc(editor)) {\n      return registerKeyboardOverrides(editor);\n    } else {\n      return Cell(null);\n    }\n  };\n\n  var NodeChange = function () {\n    function NodeChange(editor) {\n      this.lastPath = [];\n      this.editor = editor;\n      var lastRng;\n      var self = this;\n\n      if (!('onselectionchange' in editor.getDoc())) {\n        editor.on('NodeChange click mouseup keyup focus', function (e) {\n          var nativeRng = editor.selection.getRng();\n          var fakeRng = {\n            startContainer: nativeRng.startContainer,\n            startOffset: nativeRng.startOffset,\n            endContainer: nativeRng.endContainer,\n            endOffset: nativeRng.endOffset\n          };\n\n          if (e.type === 'nodechange' || !isEq$1(fakeRng, lastRng)) {\n            editor.fire('SelectionChange');\n          }\n\n          lastRng = fakeRng;\n        });\n      }\n\n      editor.on('contextmenu', function () {\n        editor.fire('SelectionChange');\n      });\n      editor.on('SelectionChange', function () {\n        var startElm = editor.selection.getStart(true);\n\n        if (!startElm || !Env.range && editor.selection.isCollapsed()) {\n          return;\n        }\n\n        if (hasAnyRanges(editor) && !self.isSameElementPath(startElm) && editor.dom.isChildOf(startElm, editor.getBody())) {\n          editor.nodeChanged({\n            selectionChange: true\n          });\n        }\n      });\n      editor.on('mouseup', function (e) {\n        if (!e.isDefaultPrevented() && hasAnyRanges(editor)) {\n          if (editor.selection.getNode().nodeName === 'IMG') {\n            Delay.setEditorTimeout(editor, function () {\n              editor.nodeChanged();\n            });\n          } else {\n            editor.nodeChanged();\n          }\n        }\n      });\n    }\n\n    NodeChange.prototype.nodeChanged = function (args) {\n      var selection = this.editor.selection;\n      var node, parents, root;\n\n      if (this.editor.initialized && selection && !shouldDisableNodeChange(this.editor) && !this.editor.mode.isReadOnly()) {\n        root = this.editor.getBody();\n        node = selection.getStart(true) || root;\n\n        if (node.ownerDocument !== this.editor.getDoc() || !this.editor.dom.isChildOf(node, root)) {\n          node = root;\n        }\n\n        parents = [];\n        this.editor.dom.getParent(node, function (node) {\n          if (node === root) {\n            return true;\n          }\n\n          parents.push(node);\n        });\n        args = args || {};\n        args.element = node;\n        args.parents = parents;\n        this.editor.fire('NodeChange', args);\n      }\n    };\n\n    NodeChange.prototype.isSameElementPath = function (startElm) {\n      var i;\n      var currentPath = this.editor.$(startElm).parentsUntil(this.editor.getBody()).add(startElm);\n\n      if (currentPath.length === this.lastPath.length) {\n        for (i = currentPath.length; i >= 0; i--) {\n          if (currentPath[i] !== this.lastPath[i]) {\n            break;\n          }\n        }\n\n        if (i === -1) {\n          this.lastPath = currentPath;\n          return true;\n        }\n      }\n\n      this.lastPath = currentPath;\n      return false;\n    };\n\n    return NodeChange;\n  }();\n\n  var preventSummaryToggle = function (editor) {\n    editor.on('click', function (e) {\n      if (editor.dom.getParent(e.target, 'details')) {\n        e.preventDefault();\n      }\n    });\n  };\n\n  var filterDetails = function (editor) {\n    editor.parser.addNodeFilter('details', function (elms) {\n      each(elms, function (details) {\n        details.attr('data-mce-open', details.attr('open'));\n        details.attr('open', 'open');\n      });\n    });\n    editor.serializer.addNodeFilter('details', function (elms) {\n      each(elms, function (details) {\n        var open = details.attr('data-mce-open');\n        details.attr('open', isString(open) ? open : null);\n        details.attr('data-mce-open', null);\n      });\n    });\n  };\n\n  var setup$j = function (editor) {\n    preventSummaryToggle(editor);\n    filterDetails(editor);\n  };\n\n  var isTextBlockNode = function (node) {\n    return isElement$1(node) && isTextBlock(SugarElement.fromDom(node));\n  };\n\n  var normalizeSelection$1 = function (editor) {\n    var rng = editor.selection.getRng();\n    var startPos = CaretPosition.fromRangeStart(rng);\n    var endPos = CaretPosition.fromRangeEnd(rng);\n\n    if (CaretPosition.isElementPosition(startPos)) {\n      var container = startPos.container();\n\n      if (isTextBlockNode(container)) {\n        firstPositionIn(container).each(function (pos) {\n          return rng.setStart(pos.container(), pos.offset());\n        });\n      }\n    }\n\n    if (CaretPosition.isElementPosition(endPos)) {\n      var container = startPos.container();\n\n      if (isTextBlockNode(container)) {\n        lastPositionIn(container).each(function (pos) {\n          return rng.setEnd(pos.container(), pos.offset());\n        });\n      }\n    }\n\n    editor.selection.setRng(normalize$2(rng));\n  };\n\n  var setup$k = function (editor) {\n    editor.on('click', function (e) {\n      if (e.detail >= 3) {\n        normalizeSelection$1(editor);\n      }\n    });\n  };\n\n  var value$1 = function () {\n    var subject = Cell(Optional.none());\n\n    var clear = function () {\n      return subject.set(Optional.none());\n    };\n\n    var set = function (s) {\n      return subject.set(Optional.some(s));\n    };\n\n    var isSet = function () {\n      return subject.get().isSome();\n    };\n\n    var on = function (f) {\n      return subject.get().each(f);\n    };\n\n    return {\n      clear: clear,\n      set: set,\n      isSet: isSet,\n      on: on\n    };\n  };\n\n  var getAbsolutePosition = function (elm) {\n    var clientRect = elm.getBoundingClientRect();\n    var doc = elm.ownerDocument;\n    var docElem = doc.documentElement;\n    var win = doc.defaultView;\n    return {\n      top: clientRect.top + win.pageYOffset - docElem.clientTop,\n      left: clientRect.left + win.pageXOffset - docElem.clientLeft\n    };\n  };\n\n  var getBodyPosition = function (editor) {\n    return editor.inline ? getAbsolutePosition(editor.getBody()) : {\n      left: 0,\n      top: 0\n    };\n  };\n\n  var getScrollPosition = function (editor) {\n    var body = editor.getBody();\n    return editor.inline ? {\n      left: body.scrollLeft,\n      top: body.scrollTop\n    } : {\n      left: 0,\n      top: 0\n    };\n  };\n\n  var getBodyScroll = function (editor) {\n    var body = editor.getBody(),\n        docElm = editor.getDoc().documentElement;\n    var inlineScroll = {\n      left: body.scrollLeft,\n      top: body.scrollTop\n    };\n    var iframeScroll = {\n      left: body.scrollLeft || docElm.scrollLeft,\n      top: body.scrollTop || docElm.scrollTop\n    };\n    return editor.inline ? inlineScroll : iframeScroll;\n  };\n\n  var getMousePosition = function (editor, event) {\n    if (event.target.ownerDocument !== editor.getDoc()) {\n      var iframePosition = getAbsolutePosition(editor.getContentAreaContainer());\n      var scrollPosition = getBodyScroll(editor);\n      return {\n        left: event.pageX - iframePosition.left + scrollPosition.left,\n        top: event.pageY - iframePosition.top + scrollPosition.top\n      };\n    }\n\n    return {\n      left: event.pageX,\n      top: event.pageY\n    };\n  };\n\n  var calculatePosition = function (bodyPosition, scrollPosition, mousePosition) {\n    return {\n      pageX: mousePosition.left - bodyPosition.left + scrollPosition.left,\n      pageY: mousePosition.top - bodyPosition.top + scrollPosition.top\n    };\n  };\n\n  var calc = function (editor, event) {\n    return calculatePosition(getBodyPosition(editor), getScrollPosition(editor), getMousePosition(editor, event));\n  };\n\n  var isContentEditableFalse$a = isContentEditableFalse,\n      isContentEditableTrue$3 = isContentEditableTrue;\n\n  var isDraggable = function (rootElm, elm) {\n    return isContentEditableFalse$a(elm) && elm !== rootElm;\n  };\n\n  var isValidDropTarget = function (editor, targetElement, dragElement) {\n    if (targetElement === dragElement || editor.dom.isChildOf(targetElement, dragElement)) {\n      return false;\n    }\n\n    return !isContentEditableFalse$a(targetElement);\n  };\n\n  var cloneElement = function (elm) {\n    var cloneElm = elm.cloneNode(true);\n    cloneElm.removeAttribute('data-mce-selected');\n    return cloneElm;\n  };\n\n  var createGhost = function (editor, elm, width, height) {\n    var dom = editor.dom;\n    var clonedElm = elm.cloneNode(true);\n    dom.setStyles(clonedElm, {\n      width: width,\n      height: height\n    });\n    dom.setAttrib(clonedElm, 'data-mce-selected', null);\n    var ghostElm = dom.create('div', {\n      'class': 'mce-drag-container',\n      'data-mce-bogus': 'all',\n      'unselectable': 'on',\n      'contenteditable': 'false'\n    });\n    dom.setStyles(ghostElm, {\n      position: 'absolute',\n      opacity: 0.5,\n      overflow: 'hidden',\n      border: 0,\n      padding: 0,\n      margin: 0,\n      width: width,\n      height: height\n    });\n    dom.setStyles(clonedElm, {\n      margin: 0,\n      boxSizing: 'border-box'\n    });\n    ghostElm.appendChild(clonedElm);\n    return ghostElm;\n  };\n\n  var appendGhostToBody = function (ghostElm, bodyElm) {\n    if (ghostElm.parentNode !== bodyElm) {\n      bodyElm.appendChild(ghostElm);\n    }\n  };\n\n  var moveGhost = function (ghostElm, position, width, height, maxX, maxY) {\n    var overflowX = 0,\n        overflowY = 0;\n    ghostElm.style.left = position.pageX + 'px';\n    ghostElm.style.top = position.pageY + 'px';\n\n    if (position.pageX + width > maxX) {\n      overflowX = position.pageX + width - maxX;\n    }\n\n    if (position.pageY + height > maxY) {\n      overflowY = position.pageY + height - maxY;\n    }\n\n    ghostElm.style.width = width - overflowX + 'px';\n    ghostElm.style.height = height - overflowY + 'px';\n  };\n\n  var removeElement = function (elm) {\n    if (elm && elm.parentNode) {\n      elm.parentNode.removeChild(elm);\n    }\n  };\n\n  var isLeftMouseButtonPressed = function (e) {\n    return e.button === 0;\n  };\n\n  var applyRelPos = function (state, position) {\n    return {\n      pageX: position.pageX - state.relX,\n      pageY: position.pageY + 5\n    };\n  };\n\n  var start$1 = function (state, editor) {\n    return function (e) {\n      if (isLeftMouseButtonPressed(e)) {\n        var ceElm = find(editor.dom.getParents(e.target), or(isContentEditableFalse$a, isContentEditableTrue$3)).getOr(null);\n\n        if (isDraggable(editor.getBody(), ceElm)) {\n          var elmPos = editor.dom.getPos(ceElm);\n          var bodyElm = editor.getBody();\n          var docElm = editor.getDoc().documentElement;\n          state.set({\n            element: ceElm,\n            dragging: false,\n            screenX: e.screenX,\n            screenY: e.screenY,\n            maxX: (editor.inline ? bodyElm.scrollWidth : docElm.offsetWidth) - 2,\n            maxY: (editor.inline ? bodyElm.scrollHeight : docElm.offsetHeight) - 2,\n            relX: e.pageX - elmPos.x,\n            relY: e.pageY - elmPos.y,\n            width: ceElm.offsetWidth,\n            height: ceElm.offsetHeight,\n            ghost: createGhost(editor, ceElm, ceElm.offsetWidth, ceElm.offsetHeight)\n          });\n        }\n      }\n    };\n  };\n\n  var move$2 = function (state, editor) {\n    var throttledPlaceCaretAt = Delay.throttle(function (clientX, clientY) {\n      editor._selectionOverrides.hideFakeCaret();\n\n      editor.selection.placeCaretAt(clientX, clientY);\n    }, 0);\n    return function (e) {\n      return state.on(function (state) {\n        var movement = Math.max(Math.abs(e.screenX - state.screenX), Math.abs(e.screenY - state.screenY));\n\n        if (!state.dragging && movement > 10) {\n          var args = editor.fire('dragstart', {\n            target: state.element\n          });\n\n          if (args.isDefaultPrevented()) {\n            return;\n          }\n\n          state.dragging = true;\n          editor.focus();\n        }\n\n        if (state.dragging) {\n          var targetPos = applyRelPos(state, calc(editor, e));\n          appendGhostToBody(state.ghost, editor.getBody());\n          moveGhost(state.ghost, targetPos, state.width, state.height, state.maxX, state.maxY);\n          throttledPlaceCaretAt(e.clientX, e.clientY);\n        }\n      });\n    };\n  };\n\n  var getRawTarget = function (selection) {\n    var rng = selection.getSel().getRangeAt(0);\n    var startContainer = rng.startContainer;\n    return startContainer.nodeType === 3 ? startContainer.parentNode : startContainer;\n  };\n\n  var drop = function (state, editor) {\n    return function (e) {\n      state.on(function (state) {\n        if (state.dragging) {\n          if (isValidDropTarget(editor, getRawTarget(editor.selection), state.element)) {\n            var targetClone_1 = cloneElement(state.element);\n            var args = editor.fire('drop', {\n              clientX: e.clientX,\n              clientY: e.clientY\n            });\n\n            if (!args.isDefaultPrevented()) {\n              editor.undoManager.transact(function () {\n                removeElement(state.element);\n                editor.insertContent(editor.dom.getOuterHTML(targetClone_1));\n\n                editor._selectionOverrides.hideFakeCaret();\n              });\n            }\n          }\n        }\n      });\n      removeDragState(state);\n    };\n  };\n\n  var stop = function (state, editor) {\n    return function () {\n      state.on(function (state) {\n        if (state.dragging) {\n          editor.fire('dragend');\n        }\n      });\n      removeDragState(state);\n    };\n  };\n\n  var removeDragState = function (state) {\n    state.on(function (state) {\n      removeElement(state.ghost);\n    });\n    state.clear();\n  };\n\n  var bindFakeDragEvents = function (editor) {\n    var state = value$1();\n    var pageDom = DOMUtils$1.DOM;\n    var rootDocument = document;\n    var dragStartHandler = start$1(state, editor);\n    var dragHandler = move$2(state, editor);\n    var dropHandler = drop(state, editor);\n    var dragEndHandler = stop(state, editor);\n    editor.on('mousedown', dragStartHandler);\n    editor.on('mousemove', dragHandler);\n    editor.on('mouseup', dropHandler);\n    pageDom.bind(rootDocument, 'mousemove', dragHandler);\n    pageDom.bind(rootDocument, 'mouseup', dragEndHandler);\n    editor.on('remove', function () {\n      pageDom.unbind(rootDocument, 'mousemove', dragHandler);\n      pageDom.unbind(rootDocument, 'mouseup', dragEndHandler);\n    });\n  };\n\n  var blockIeDrop = function (editor) {\n    editor.on('drop', function (e) {\n      var realTarget = typeof e.clientX !== 'undefined' ? editor.getDoc().elementFromPoint(e.clientX, e.clientY) : null;\n\n      if (isContentEditableFalse$a(realTarget) || editor.dom.getContentEditableParent(realTarget) === 'false') {\n        e.preventDefault();\n      }\n    });\n  };\n\n  var blockUnsupportedFileDrop = function (editor) {\n    var preventFileDrop = function (e) {\n      if (!e.defaultPrevented) {\n        var dataTransfer = e.dataTransfer;\n\n        if (dataTransfer && (contains(dataTransfer.types, 'Files') || dataTransfer.files.length > 0)) {\n          e.preventDefault();\n\n          if (e.type === 'drop') {\n            displayError(editor, 'Dropped file type is not supported');\n          }\n        }\n      }\n    };\n\n    var preventFileDropIfUIElement = function (e) {\n      if (isUIElement(editor, e.target)) {\n        preventFileDrop(e);\n      }\n    };\n\n    var setup = function () {\n      var pageDom = DOMUtils$1.DOM;\n      var dom = editor.dom;\n      var doc = document;\n      var editorRoot = editor.inline ? editor.getBody() : editor.getDoc();\n      var eventNames = ['drop', 'dragover'];\n      each(eventNames, function (name) {\n        pageDom.bind(doc, name, preventFileDropIfUIElement);\n        dom.bind(editorRoot, name, preventFileDrop);\n      });\n      editor.on('remove', function () {\n        each(eventNames, function (name) {\n          pageDom.unbind(doc, name, preventFileDropIfUIElement);\n          dom.unbind(editorRoot, name, preventFileDrop);\n        });\n      });\n    };\n\n    editor.on('init', function () {\n      Delay.setEditorTimeout(editor, setup, 0);\n    });\n  };\n\n  var init = function (editor) {\n    bindFakeDragEvents(editor);\n    blockIeDrop(editor);\n\n    if (shouldBlockUnsupportedDrop(editor)) {\n      blockUnsupportedFileDrop(editor);\n    }\n  };\n\n  var setup$l = function (editor) {\n    var renderFocusCaret = first(function () {\n      if (!editor.removed && editor.getBody().contains(document.activeElement)) {\n        var rng = editor.selection.getRng();\n\n        if (rng.collapsed) {\n          var caretRange = renderRangeCaret(editor, rng, false);\n          editor.selection.setRng(caretRange);\n        }\n      }\n    }, 0);\n    editor.on('focus', function () {\n      renderFocusCaret.throttle();\n    });\n    editor.on('blur', function () {\n      renderFocusCaret.cancel();\n    });\n  };\n\n  var setup$m = function (editor) {\n    editor.on('init', function () {\n      editor.on('focusin', function (e) {\n        var target = e.target;\n\n        if (isMedia(target)) {\n          var ceRoot = getContentEditableRoot(editor.getBody(), target);\n          var node = isContentEditableFalse(ceRoot) ? ceRoot : target;\n\n          if (editor.selection.getNode() !== node) {\n            selectNode(editor, node).each(function (rng) {\n              return editor.selection.setRng(rng);\n            });\n          }\n        }\n      });\n    });\n  };\n\n  var isContentEditableTrue$4 = isContentEditableTrue;\n  var isContentEditableFalse$b = isContentEditableFalse;\n\n  var getContentEditableRoot$1 = function (editor, node) {\n    return getContentEditableRoot(editor.getBody(), node);\n  };\n\n  var SelectionOverrides = function (editor) {\n    var selection = editor.selection,\n        dom = editor.dom;\n    var isBlock = dom.isBlock;\n    var rootNode = editor.getBody();\n    var fakeCaret = FakeCaret(editor, rootNode, isBlock, function () {\n      return hasFocus$1(editor);\n    });\n    var realSelectionId = 'sel-' + dom.uniqueId();\n    var elementSelectionAttr = 'data-mce-selected';\n    var selectedElement;\n\n    var isFakeSelectionElement = function (node) {\n      return dom.hasClass(node, 'mce-offscreen-selection');\n    };\n\n    var isFakeSelectionTargetElement = function (node) {\n      return isContentEditableFalse$b(node) || isMedia(node);\n    };\n\n    var isNearFakeSelectionElement = function (pos) {\n      return isBeforeContentEditableFalse(pos) || isAfterContentEditableFalse(pos) || isBeforeMedia(pos) || isAfterMedia(pos);\n    };\n\n    var getRealSelectionElement = function () {\n      var container = dom.get(realSelectionId);\n      return container ? container.getElementsByTagName('*')[0] : container;\n    };\n\n    var setRange = function (range) {\n      if (range) {\n        selection.setRng(range);\n      }\n    };\n\n    var getRange = selection.getRng;\n\n    var showCaret = function (direction, node, before, scrollIntoView) {\n      if (scrollIntoView === void 0) {\n        scrollIntoView = true;\n      }\n\n      var e = editor.fire('ShowCaret', {\n        target: node,\n        direction: direction,\n        before: before\n      });\n\n      if (e.isDefaultPrevented()) {\n        return null;\n      }\n\n      if (scrollIntoView) {\n        selection.scrollIntoView(node, direction === -1);\n      }\n\n      return fakeCaret.show(before, node);\n    };\n\n    var showBlockCaretContainer = function (blockCaretContainer) {\n      if (blockCaretContainer.hasAttribute('data-mce-caret')) {\n        showCaretContainerBlock(blockCaretContainer);\n        setRange(getRange());\n        selection.scrollIntoView(blockCaretContainer);\n      }\n    };\n\n    var registerEvents = function () {\n      editor.on('mouseup', function (e) {\n        var range = getRange();\n\n        if (range.collapsed && isXYInContentArea(editor, e.clientX, e.clientY)) {\n          renderCaretAtRange(editor, range, false).each(setRange);\n        }\n      });\n      editor.on('click', function (e) {\n        var contentEditableRoot = getContentEditableRoot$1(editor, e.target);\n\n        if (contentEditableRoot) {\n          if (isContentEditableFalse$b(contentEditableRoot)) {\n            e.preventDefault();\n            editor.focus();\n          }\n\n          if (isContentEditableTrue$4(contentEditableRoot)) {\n            if (dom.isChildOf(contentEditableRoot, selection.getNode())) {\n              removeElementSelection();\n            }\n          }\n        }\n      });\n      editor.on('blur NewBlock', removeElementSelection);\n      editor.on('ResizeWindow FullscreenStateChanged', fakeCaret.reposition);\n\n      var hasNormalCaretPosition = function (elm) {\n        var caretWalker = CaretWalker(elm);\n\n        if (!elm.firstChild) {\n          return false;\n        }\n\n        var startPos = CaretPosition$1.before(elm.firstChild);\n        var newPos = caretWalker.next(startPos);\n        return newPos && !isNearFakeSelectionElement(newPos);\n      };\n\n      var isInSameBlock = function (node1, node2) {\n        var block1 = dom.getParent(node1, isBlock);\n        var block2 = dom.getParent(node2, isBlock);\n        return block1 === block2;\n      };\n\n      var hasBetterMouseTarget = function (targetNode, caretNode) {\n        var targetBlock = dom.getParent(targetNode, isBlock);\n        var caretBlock = dom.getParent(caretNode, isBlock);\n\n        if (targetBlock && targetNode !== caretBlock && dom.isChildOf(targetBlock, caretBlock) && isContentEditableFalse$b(getContentEditableRoot$1(editor, targetBlock)) === false) {\n          return true;\n        }\n\n        return targetBlock && !isInSameBlock(targetBlock, caretBlock) && hasNormalCaretPosition(targetBlock);\n      };\n\n      editor.on('tap', function (e) {\n        var targetElm = e.target;\n        var contentEditableRoot = getContentEditableRoot$1(editor, targetElm);\n\n        if (isContentEditableFalse$b(contentEditableRoot)) {\n          e.preventDefault();\n          selectNode(editor, contentEditableRoot).each(setElementSelection);\n        } else if (isFakeSelectionTargetElement(targetElm)) {\n          selectNode(editor, targetElm).each(setElementSelection);\n        }\n      }, true);\n      editor.on('mousedown', function (e) {\n        var targetElm = e.target;\n\n        if (targetElm !== rootNode && targetElm.nodeName !== 'HTML' && !dom.isChildOf(targetElm, rootNode)) {\n          return;\n        }\n\n        if (isXYInContentArea(editor, e.clientX, e.clientY) === false) {\n          return;\n        }\n\n        var contentEditableRoot = getContentEditableRoot$1(editor, targetElm);\n\n        if (contentEditableRoot) {\n          if (isContentEditableFalse$b(contentEditableRoot)) {\n            e.preventDefault();\n            selectNode(editor, contentEditableRoot).each(setElementSelection);\n          } else {\n            removeElementSelection();\n\n            if (!(isContentEditableTrue$4(contentEditableRoot) && e.shiftKey) && !isXYWithinRange(e.clientX, e.clientY, selection.getRng())) {\n              hideFakeCaret();\n              selection.placeCaretAt(e.clientX, e.clientY);\n            }\n          }\n        } else if (isFakeSelectionTargetElement(targetElm)) {\n          selectNode(editor, targetElm).each(setElementSelection);\n        } else if (isFakeCaretTarget(targetElm) === false) {\n          removeElementSelection();\n          hideFakeCaret();\n          var fakeCaretInfo = closestFakeCaret(rootNode, e.clientX, e.clientY);\n\n          if (fakeCaretInfo) {\n            if (!hasBetterMouseTarget(targetElm, fakeCaretInfo.node)) {\n              e.preventDefault();\n              var range = showCaret(1, fakeCaretInfo.node, fakeCaretInfo.before, false);\n              editor.getBody().focus();\n              setRange(range);\n            }\n          }\n        }\n      });\n      editor.on('keypress', function (e) {\n        if (VK.modifierPressed(e)) {\n          return;\n        }\n\n        if (isContentEditableFalse$b(selection.getNode())) {\n          e.preventDefault();\n        }\n      });\n      editor.on('GetSelectionRange', function (e) {\n        var rng = e.range;\n\n        if (selectedElement) {\n          if (!selectedElement.parentNode) {\n            selectedElement = null;\n            return;\n          }\n\n          rng = rng.cloneRange();\n          rng.selectNode(selectedElement);\n          e.range = rng;\n        }\n      });\n      editor.on('SetSelectionRange', function (e) {\n        e.range = normalizeShortEndedElementSelection(e.range);\n        var rng = setElementSelection(e.range, e.forward);\n\n        if (rng) {\n          e.range = rng;\n        }\n      });\n\n      var isPasteBin = function (node) {\n        return node.id === 'mcepastebin';\n      };\n\n      editor.on('AfterSetSelectionRange', function (e) {\n        var rng = e.range;\n        var parentNode = rng.startContainer.parentNode;\n\n        if (!isRangeInCaretContainer(rng) && !isPasteBin(parentNode)) {\n          hideFakeCaret();\n        }\n\n        if (!isFakeSelectionElement(parentNode)) {\n          removeElementSelection();\n        }\n      });\n      editor.on('copy', function (e) {\n        var clipboardData = e.clipboardData;\n\n        if (!e.isDefaultPrevented() && e.clipboardData && !Env.ie) {\n          var realSelectionElement = getRealSelectionElement();\n\n          if (realSelectionElement) {\n            e.preventDefault();\n            clipboardData.clearData();\n            clipboardData.setData('text/html', realSelectionElement.outerHTML);\n            clipboardData.setData('text/plain', realSelectionElement.outerText || realSelectionElement.innerText);\n          }\n        }\n      });\n      init(editor);\n      setup$l(editor);\n      setup$m(editor);\n    };\n\n    var isWithinCaretContainer = function (node) {\n      return isCaretContainer(node) || startsWithCaretContainer(node) || endsWithCaretContainer(node);\n    };\n\n    var isRangeInCaretContainer = function (rng) {\n      return isWithinCaretContainer(rng.startContainer) || isWithinCaretContainer(rng.endContainer);\n    };\n\n    var normalizeShortEndedElementSelection = function (rng) {\n      var shortEndedElements = editor.schema.getShortEndedElements();\n      var newRng = dom.createRng();\n      var startContainer = rng.startContainer;\n      var startOffset = rng.startOffset;\n      var endContainer = rng.endContainer;\n      var endOffset = rng.endOffset;\n\n      if (has(shortEndedElements, startContainer.nodeName.toLowerCase())) {\n        if (startOffset === 0) {\n          newRng.setStartBefore(startContainer);\n        } else {\n          newRng.setStartAfter(startContainer);\n        }\n      } else {\n        newRng.setStart(startContainer, startOffset);\n      }\n\n      if (has(shortEndedElements, endContainer.nodeName.toLowerCase())) {\n        if (endOffset === 0) {\n          newRng.setEndBefore(endContainer);\n        } else {\n          newRng.setEndAfter(endContainer);\n        }\n      } else {\n        newRng.setEnd(endContainer, endOffset);\n      }\n\n      return newRng;\n    };\n\n    var setupOffscreenSelection = function (node, targetClone, origTargetClone) {\n      var $ = editor.$;\n      var $realSelectionContainer = descendant(SugarElement.fromDom(editor.getBody()), '#' + realSelectionId).fold(function () {\n        return $([]);\n      }, function (elm) {\n        return $([elm.dom]);\n      });\n\n      if ($realSelectionContainer.length === 0) {\n        $realSelectionContainer = $('<div data-mce-bogus=\"all\" class=\"mce-offscreen-selection\"></div>').attr('id', realSelectionId);\n        $realSelectionContainer.appendTo(editor.getBody());\n      }\n\n      var newRange = dom.createRng();\n\n      if (targetClone === origTargetClone && Env.ie) {\n        $realSelectionContainer.empty().append('<p style=\"font-size: 0\" data-mce-bogus=\"all\">\\xA0</p>').append(targetClone);\n        newRange.setStartAfter($realSelectionContainer[0].firstChild.firstChild);\n        newRange.setEndAfter(targetClone);\n      } else {\n        $realSelectionContainer.empty().append(nbsp).append(targetClone).append(nbsp);\n        newRange.setStart($realSelectionContainer[0].firstChild, 1);\n        newRange.setEnd($realSelectionContainer[0].lastChild, 0);\n      }\n\n      $realSelectionContainer.css({\n        top: dom.getPos(node, editor.getBody()).y\n      });\n      $realSelectionContainer[0].focus();\n      var sel = selection.getSel();\n      sel.removeAllRanges();\n      sel.addRange(newRange);\n      return newRange;\n    };\n\n    var selectElement = function (elm) {\n      var targetClone = elm.cloneNode(true);\n      var e = editor.fire('ObjectSelected', {\n        target: elm,\n        targetClone: targetClone\n      });\n\n      if (e.isDefaultPrevented()) {\n        return null;\n      }\n\n      var range = setupOffscreenSelection(elm, e.targetClone, targetClone);\n      var nodeElm = SugarElement.fromDom(elm);\n      each(descendants$1(SugarElement.fromDom(editor.getBody()), '*[data-mce-selected]'), function (elm) {\n        if (!eq$2(nodeElm, elm)) {\n          remove$1(elm, elementSelectionAttr);\n        }\n      });\n\n      if (!dom.getAttrib(elm, elementSelectionAttr)) {\n        elm.setAttribute(elementSelectionAttr, '1');\n      }\n\n      selectedElement = elm;\n      hideFakeCaret();\n      return range;\n    };\n\n    var setElementSelection = function (range, forward) {\n      if (!range) {\n        return null;\n      }\n\n      if (range.collapsed) {\n        if (!isRangeInCaretContainer(range)) {\n          var dir = forward ? 1 : -1;\n          var caretPosition = getNormalizedRangeEndPoint(dir, rootNode, range);\n          var beforeNode = caretPosition.getNode(!forward);\n\n          if (isFakeCaretTarget(beforeNode)) {\n            return showCaret(dir, beforeNode, forward ? !caretPosition.isAtEnd() : false, false);\n          }\n\n          var afterNode = caretPosition.getNode(forward);\n\n          if (isFakeCaretTarget(afterNode)) {\n            return showCaret(dir, afterNode, forward ? false : !caretPosition.isAtEnd(), false);\n          }\n        }\n\n        return null;\n      }\n\n      var startContainer = range.startContainer;\n      var startOffset = range.startOffset;\n      var endOffset = range.endOffset;\n\n      if (startContainer.nodeType === 3 && startOffset === 0 && isContentEditableFalse$b(startContainer.parentNode)) {\n        startContainer = startContainer.parentNode;\n        startOffset = dom.nodeIndex(startContainer);\n        startContainer = startContainer.parentNode;\n      }\n\n      if (startContainer.nodeType !== 1) {\n        return null;\n      }\n\n      if (endOffset === startOffset + 1 && startContainer === range.endContainer) {\n        var node = startContainer.childNodes[startOffset];\n\n        if (isFakeSelectionTargetElement(node)) {\n          return selectElement(node);\n        }\n      }\n\n      return null;\n    };\n\n    var removeElementSelection = function () {\n      if (selectedElement) {\n        selectedElement.removeAttribute(elementSelectionAttr);\n      }\n\n      descendant(SugarElement.fromDom(editor.getBody()), '#' + realSelectionId).each(remove);\n      selectedElement = null;\n    };\n\n    var destroy = function () {\n      fakeCaret.destroy();\n      selectedElement = null;\n    };\n\n    var hideFakeCaret = function () {\n      fakeCaret.hide();\n    };\n\n    if (Env.ceFalse) {\n      registerEvents();\n    }\n\n    return {\n      showCaret: showCaret,\n      showBlockCaretContainer: showBlockCaretContainer,\n      hideFakeCaret: hideFakeCaret,\n      destroy: destroy\n    };\n  };\n\n  var Quirks = function (editor) {\n    var each = Tools.each;\n    var BACKSPACE = VK.BACKSPACE,\n        DELETE = VK.DELETE,\n        dom = editor.dom,\n        selection = editor.selection,\n        parser = editor.parser;\n    var isGecko = Env.gecko,\n        isIE = Env.ie,\n        isWebKit = Env.webkit;\n    var mceInternalUrlPrefix = 'data:text/mce-internal,';\n    var mceInternalDataType = isIE ? 'Text' : 'URL';\n\n    var setEditorCommandState = function (cmd, state) {\n      try {\n        editor.getDoc().execCommand(cmd, false, state);\n      } catch (ex) {}\n    };\n\n    var isDefaultPrevented = function (e) {\n      return e.isDefaultPrevented();\n    };\n\n    var setMceInternalContent = function (e) {\n      var selectionHtml, internalContent;\n\n      if (e.dataTransfer) {\n        if (editor.selection.isCollapsed() && e.target.tagName === 'IMG') {\n          selection.select(e.target);\n        }\n\n        selectionHtml = editor.selection.getContent();\n\n        if (selectionHtml.length > 0) {\n          internalContent = mceInternalUrlPrefix + escape(editor.id) + ',' + escape(selectionHtml);\n          e.dataTransfer.setData(mceInternalDataType, internalContent);\n        }\n      }\n    };\n\n    var getMceInternalContent = function (e) {\n      var internalContent;\n\n      if (e.dataTransfer) {\n        internalContent = e.dataTransfer.getData(mceInternalDataType);\n\n        if (internalContent && internalContent.indexOf(mceInternalUrlPrefix) >= 0) {\n          internalContent = internalContent.substr(mceInternalUrlPrefix.length).split(',');\n          return {\n            id: unescape(internalContent[0]),\n            html: unescape(internalContent[1])\n          };\n        }\n      }\n\n      return null;\n    };\n\n    var insertClipboardContents = function (content, internal) {\n      if (editor.queryCommandSupported('mceInsertClipboardContent')) {\n        editor.execCommand('mceInsertClipboardContent', false, {\n          content: content,\n          internal: internal\n        });\n      } else {\n        editor.execCommand('mceInsertContent', false, content);\n      }\n    };\n\n    var emptyEditorWhenDeleting = function () {\n      var serializeRng = function (rng) {\n        var body = dom.create('body');\n        var contents = rng.cloneContents();\n        body.appendChild(contents);\n        return selection.serializer.serialize(body, {\n          format: 'html'\n        });\n      };\n\n      var allContentsSelected = function (rng) {\n        var selection = serializeRng(rng);\n        var allRng = dom.createRng();\n        allRng.selectNode(editor.getBody());\n        var allSelection = serializeRng(allRng);\n        return selection === allSelection;\n      };\n\n      editor.on('keydown', function (e) {\n        var keyCode = e.keyCode;\n        var isCollapsed, body;\n\n        if (!isDefaultPrevented(e) && (keyCode === DELETE || keyCode === BACKSPACE)) {\n          isCollapsed = editor.selection.isCollapsed();\n          body = editor.getBody();\n\n          if (isCollapsed && !dom.isEmpty(body)) {\n            return;\n          }\n\n          if (!isCollapsed && !allContentsSelected(editor.selection.getRng())) {\n            return;\n          }\n\n          e.preventDefault();\n          editor.setContent('');\n\n          if (body.firstChild && dom.isBlock(body.firstChild)) {\n            editor.selection.setCursorLocation(body.firstChild, 0);\n          } else {\n            editor.selection.setCursorLocation(body, 0);\n          }\n\n          editor.nodeChanged();\n        }\n      });\n    };\n\n    var selectAll = function () {\n      editor.shortcuts.add('meta+a', null, 'SelectAll');\n    };\n\n    var inputMethodFocus = function () {\n      if (!editor.inline) {\n        dom.bind(editor.getDoc(), 'mousedown mouseup', function (e) {\n          var rng;\n\n          if (e.target === editor.getDoc().documentElement) {\n            rng = selection.getRng();\n            editor.getBody().focus();\n\n            if (e.type === 'mousedown') {\n              if (isCaretContainer(rng.startContainer)) {\n                return;\n              }\n\n              selection.placeCaretAt(e.clientX, e.clientY);\n            } else {\n              selection.setRng(rng);\n            }\n          }\n        });\n      }\n    };\n\n    var removeHrOnBackspace = function () {\n      editor.on('keydown', function (e) {\n        if (!isDefaultPrevented(e) && e.keyCode === BACKSPACE) {\n          if (!editor.getBody().getElementsByTagName('hr').length) {\n            return;\n          }\n\n          if (selection.isCollapsed() && selection.getRng().startOffset === 0) {\n            var node = selection.getNode();\n            var previousSibling = node.previousSibling;\n\n            if (node.nodeName === 'HR') {\n              dom.remove(node);\n              e.preventDefault();\n              return;\n            }\n\n            if (previousSibling && previousSibling.nodeName && previousSibling.nodeName.toLowerCase() === 'hr') {\n              dom.remove(previousSibling);\n              e.preventDefault();\n            }\n          }\n        }\n      });\n    };\n\n    var focusBody = function () {\n      if (!Range.prototype.getClientRects) {\n        editor.on('mousedown', function (e) {\n          if (!isDefaultPrevented(e) && e.target.nodeName === 'HTML') {\n            var body_1 = editor.getBody();\n            body_1.blur();\n            Delay.setEditorTimeout(editor, function () {\n              body_1.focus();\n            });\n          }\n        });\n      }\n    };\n\n    var selectControlElements = function () {\n      editor.on('click', function (e) {\n        var target = e.target;\n\n        if (/^(IMG|HR)$/.test(target.nodeName) && dom.getContentEditableParent(target) !== 'false') {\n          e.preventDefault();\n          editor.selection.select(target);\n          editor.nodeChanged();\n        }\n\n        if (target.nodeName === 'A' && dom.hasClass(target, 'mce-item-anchor')) {\n          e.preventDefault();\n          selection.select(target);\n        }\n      });\n    };\n\n    var removeStylesWhenDeletingAcrossBlockElements = function () {\n      var getAttributeApplyFunction = function () {\n        var template = dom.getAttribs(selection.getStart().cloneNode(false));\n        return function () {\n          var target = selection.getStart();\n\n          if (target !== editor.getBody()) {\n            dom.setAttrib(target, 'style', null);\n            each(template, function (attr) {\n              target.setAttributeNode(attr.cloneNode(true));\n            });\n          }\n        };\n      };\n\n      var isSelectionAcrossElements = function () {\n        return !selection.isCollapsed() && dom.getParent(selection.getStart(), dom.isBlock) !== dom.getParent(selection.getEnd(), dom.isBlock);\n      };\n\n      editor.on('keypress', function (e) {\n        var applyAttributes;\n\n        if (!isDefaultPrevented(e) && (e.keyCode === 8 || e.keyCode === 46) && isSelectionAcrossElements()) {\n          applyAttributes = getAttributeApplyFunction();\n          editor.getDoc().execCommand('delete', false, null);\n          applyAttributes();\n          e.preventDefault();\n          return false;\n        }\n      });\n      dom.bind(editor.getDoc(), 'cut', function (e) {\n        var applyAttributes;\n\n        if (!isDefaultPrevented(e) && isSelectionAcrossElements()) {\n          applyAttributes = getAttributeApplyFunction();\n          Delay.setEditorTimeout(editor, function () {\n            applyAttributes();\n          });\n        }\n      });\n    };\n\n    var disableBackspaceIntoATable = function () {\n      editor.on('keydown', function (e) {\n        if (!isDefaultPrevented(e) && e.keyCode === BACKSPACE) {\n          if (selection.isCollapsed() && selection.getRng().startOffset === 0) {\n            var previousSibling = selection.getNode().previousSibling;\n\n            if (previousSibling && previousSibling.nodeName && previousSibling.nodeName.toLowerCase() === 'table') {\n              e.preventDefault();\n              return false;\n            }\n          }\n        }\n      });\n    };\n\n    var removeBlockQuoteOnBackSpace = function () {\n      editor.on('keydown', function (e) {\n        var rng, parent;\n\n        if (isDefaultPrevented(e) || e.keyCode !== VK.BACKSPACE) {\n          return;\n        }\n\n        rng = selection.getRng();\n        var container = rng.startContainer;\n        var offset = rng.startOffset;\n        var root = dom.getRoot();\n        parent = container;\n\n        if (!rng.collapsed || offset !== 0) {\n          return;\n        }\n\n        while (parent && parent.parentNode && parent.parentNode.firstChild === parent && parent.parentNode !== root) {\n          parent = parent.parentNode;\n        }\n\n        if (parent.tagName === 'BLOCKQUOTE') {\n          editor.formatter.toggle('blockquote', null, parent);\n          rng = dom.createRng();\n          rng.setStart(container, 0);\n          rng.setEnd(container, 0);\n          selection.setRng(rng);\n        }\n      });\n    };\n\n    var setGeckoEditingOptions = function () {\n      var setOpts = function () {\n        setEditorCommandState('StyleWithCSS', false);\n        setEditorCommandState('enableInlineTableEditing', false);\n\n        if (!getObjectResizing(editor)) {\n          setEditorCommandState('enableObjectResizing', false);\n        }\n      };\n\n      if (!isReadOnly(editor)) {\n        editor.on('BeforeExecCommand mousedown', setOpts);\n      }\n    };\n\n    var addBrAfterLastLinks = function () {\n      var fixLinks = function () {\n        each(dom.select('a'), function (node) {\n          var parentNode = node.parentNode;\n          var root = dom.getRoot();\n\n          if (parentNode.lastChild === node) {\n            while (parentNode && !dom.isBlock(parentNode)) {\n              if (parentNode.parentNode.lastChild !== parentNode || parentNode === root) {\n                return;\n              }\n\n              parentNode = parentNode.parentNode;\n            }\n\n            dom.add(parentNode, 'br', {\n              'data-mce-bogus': 1\n            });\n          }\n        });\n      };\n\n      editor.on('SetContent ExecCommand', function (e) {\n        if (e.type === 'setcontent' || e.command === 'mceInsertLink') {\n          fixLinks();\n        }\n      });\n    };\n\n    var setDefaultBlockType = function () {\n      if (getForcedRootBlock(editor)) {\n        editor.on('init', function () {\n          setEditorCommandState('DefaultParagraphSeparator', getForcedRootBlock(editor));\n        });\n      }\n    };\n\n    var normalizeSelection = function () {\n      editor.on('keyup focusin mouseup', function (e) {\n        if (!VK.modifierPressed(e)) {\n          selection.normalize();\n        }\n      }, true);\n    };\n\n    var showBrokenImageIcon = function () {\n      editor.contentStyles.push('img:-moz-broken {' + '-moz-force-broken-image-icon:1;' + 'min-width:24px;' + 'min-height:24px' + '}');\n    };\n\n    var restoreFocusOnKeyDown = function () {\n      if (!editor.inline) {\n        editor.on('keydown', function () {\n          if (document.activeElement === document.body) {\n            editor.getWin().focus();\n          }\n        });\n      }\n    };\n\n    var bodyHeight = function () {\n      if (!editor.inline) {\n        editor.contentStyles.push('body {min-height: 150px}');\n        editor.on('click', function (e) {\n          var rng;\n\n          if (e.target.nodeName === 'HTML') {\n            if (Env.ie > 11) {\n              editor.getBody().focus();\n              return;\n            }\n\n            rng = editor.selection.getRng();\n            editor.getBody().focus();\n            editor.selection.setRng(rng);\n            editor.selection.normalize();\n            editor.nodeChanged();\n          }\n        });\n      }\n    };\n\n    var blockCmdArrowNavigation = function () {\n      if (Env.mac) {\n        editor.on('keydown', function (e) {\n          if (VK.metaKeyPressed(e) && !e.shiftKey && (e.keyCode === 37 || e.keyCode === 39)) {\n            e.preventDefault();\n            var selection_1 = editor.selection.getSel();\n            selection_1.modify('move', e.keyCode === 37 ? 'backward' : 'forward', 'lineboundary');\n          }\n        });\n      }\n    };\n\n    var disableAutoUrlDetect = function () {\n      setEditorCommandState('AutoUrlDetect', false);\n    };\n\n    var tapLinksAndImages = function () {\n      editor.on('click', function (e) {\n        var elm = e.target;\n\n        do {\n          if (elm.tagName === 'A') {\n            e.preventDefault();\n            return;\n          }\n        } while (elm = elm.parentNode);\n      });\n      editor.contentStyles.push('.mce-content-body {-webkit-touch-callout: none}');\n    };\n\n    var blockFormSubmitInsideEditor = function () {\n      editor.on('init', function () {\n        editor.dom.bind(editor.getBody(), 'submit', function (e) {\n          e.preventDefault();\n        });\n      });\n    };\n\n    var removeAppleInterchangeBrs = function () {\n      parser.addNodeFilter('br', function (nodes) {\n        var i = nodes.length;\n\n        while (i--) {\n          if (nodes[i].attr('class') === 'Apple-interchange-newline') {\n            nodes[i].remove();\n          }\n        }\n      });\n    };\n\n    var ieInternalDragAndDrop = function () {\n      editor.on('dragstart', function (e) {\n        setMceInternalContent(e);\n      });\n      editor.on('drop', function (e) {\n        if (!isDefaultPrevented(e)) {\n          var internalContent = getMceInternalContent(e);\n\n          if (internalContent && internalContent.id !== editor.id) {\n            e.preventDefault();\n            var rng = fromPoint$1(e.x, e.y, editor.getDoc());\n            selection.setRng(rng);\n            insertClipboardContents(internalContent.html, true);\n          }\n        }\n      });\n    };\n\n    var refreshContentEditable = function () {};\n\n    var isHidden = function () {\n      if (!isGecko || editor.removed) {\n        return false;\n      }\n\n      var sel = editor.selection.getSel();\n      return !sel || !sel.rangeCount || sel.rangeCount === 0;\n    };\n\n    removeBlockQuoteOnBackSpace();\n    emptyEditorWhenDeleting();\n\n    if (!Env.windowsPhone) {\n      normalizeSelection();\n    }\n\n    if (isWebKit) {\n      inputMethodFocus();\n      selectControlElements();\n      setDefaultBlockType();\n      blockFormSubmitInsideEditor();\n      disableBackspaceIntoATable();\n      removeAppleInterchangeBrs();\n\n      if (Env.iOS) {\n        restoreFocusOnKeyDown();\n        bodyHeight();\n        tapLinksAndImages();\n      } else {\n        selectAll();\n      }\n    }\n\n    if (Env.ie >= 11) {\n      bodyHeight();\n      disableBackspaceIntoATable();\n    }\n\n    if (Env.ie) {\n      selectAll();\n      disableAutoUrlDetect();\n      ieInternalDragAndDrop();\n    }\n\n    if (isGecko) {\n      removeHrOnBackspace();\n      focusBody();\n      removeStylesWhenDeletingAcrossBlockElements();\n      setGeckoEditingOptions();\n      addBrAfterLastLinks();\n      showBrokenImageIcon();\n      blockCmdArrowNavigation();\n      disableBackspaceIntoATable();\n    }\n\n    return {\n      refreshContentEditable: refreshContentEditable,\n      isHidden: isHidden\n    };\n  };\n\n  var DOM$4 = DOMUtils$1.DOM;\n\n  var appendStyle = function (editor, text) {\n    var body = SugarElement.fromDom(editor.getBody());\n    var container = getStyleContainer(getRootNode(body));\n    var style = SugarElement.fromTag('style');\n    set(style, 'type', 'text/css');\n    append(style, SugarElement.fromText(text));\n    append(container, style);\n    editor.on('remove', function () {\n      remove(style);\n    });\n  };\n\n  var getRootName = function (editor) {\n    return editor.inline ? editor.getElement().nodeName.toLowerCase() : undefined;\n  };\n\n  var removeUndefined = function (obj) {\n    return filter$1(obj, function (v) {\n      return isUndefined(v) === false;\n    });\n  };\n\n  var mkParserSettings = function (editor) {\n    var settings = editor.settings;\n    var blobCache = editor.editorUpload.blobCache;\n    return removeUndefined({\n      allow_conditional_comments: settings.allow_conditional_comments,\n      allow_html_data_urls: settings.allow_html_data_urls,\n      allow_html_in_named_anchor: settings.allow_html_in_named_anchor,\n      allow_script_urls: settings.allow_script_urls,\n      allow_unsafe_link_target: settings.allow_unsafe_link_target,\n      convert_fonts_to_spans: settings.convert_fonts_to_spans,\n      fix_list_elements: settings.fix_list_elements,\n      font_size_legacy_values: settings.font_size_legacy_values,\n      forced_root_block: settings.forced_root_block,\n      forced_root_block_attrs: settings.forced_root_block_attrs,\n      padd_empty_with_br: settings.padd_empty_with_br,\n      preserve_cdata: settings.preserve_cdata,\n      remove_trailing_brs: settings.remove_trailing_brs,\n      inline_styles: settings.inline_styles,\n      root_name: getRootName(editor),\n      validate: true,\n      blob_cache: blobCache,\n      images_dataimg_filter: settings.images_dataimg_filter\n    });\n  };\n\n  var mkSerializerSettings = function (editor) {\n    var settings = editor.settings;\n    return __assign(__assign({}, mkParserSettings(editor)), removeUndefined({\n      url_converter: settings.url_converter,\n      url_converter_scope: settings.url_converter_scope,\n      element_format: settings.element_format,\n      entities: settings.entities,\n      entity_encoding: settings.entity_encoding,\n      indent: settings.indent,\n      indent_after: settings.indent_after,\n      indent_before: settings.indent_before,\n      block_elements: settings.block_elements,\n      boolean_attributes: settings.boolean_attributes,\n      custom_elements: settings.custom_elements,\n      extended_valid_elements: settings.extended_valid_elements,\n      invalid_elements: settings.invalid_elements,\n      invalid_styles: settings.invalid_styles,\n      move_caret_before_on_enter_elements: settings.move_caret_before_on_enter_elements,\n      non_empty_elements: settings.non_empty_elements,\n      schema: settings.schema,\n      self_closing_elements: settings.self_closing_elements,\n      short_ended_elements: settings.short_ended_elements,\n      special: settings.special,\n      text_block_elements: settings.text_block_elements,\n      text_inline_elements: settings.text_inline_elements,\n      valid_children: settings.valid_children,\n      valid_classes: settings.valid_classes,\n      valid_elements: settings.valid_elements,\n      valid_styles: settings.valid_styles,\n      verify_html: settings.verify_html,\n      whitespace_elements: settings.whitespace_elements\n    }));\n  };\n\n  var createParser = function (editor) {\n    var parser = DomParser(mkParserSettings(editor), editor.schema);\n    parser.addAttributeFilter('src,href,style,tabindex', function (nodes, name) {\n      var i = nodes.length,\n          node,\n          value;\n      var dom = editor.dom;\n      var internalName = 'data-mce-' + name;\n\n      while (i--) {\n        node = nodes[i];\n        value = node.attr(name);\n\n        if (value && !node.attr(internalName)) {\n          if (value.indexOf('data:') === 0 || value.indexOf('blob:') === 0) {\n            continue;\n          }\n\n          if (name === 'style') {\n            value = dom.serializeStyle(dom.parseStyle(value), node.name);\n\n            if (!value.length) {\n              value = null;\n            }\n\n            node.attr(internalName, value);\n            node.attr(name, value);\n          } else if (name === 'tabindex') {\n            node.attr(internalName, value);\n            node.attr(name, null);\n          } else {\n            node.attr(internalName, editor.convertURL(value, name, node.name));\n          }\n        }\n      }\n    });\n    parser.addNodeFilter('script', function (nodes) {\n      var i = nodes.length;\n\n      while (i--) {\n        var node = nodes[i];\n        var type = node.attr('type') || 'no/type';\n\n        if (type.indexOf('mce-') !== 0) {\n          node.attr('type', 'mce-' + type);\n        }\n      }\n    });\n\n    if (editor.settings.preserve_cdata) {\n      parser.addNodeFilter('#cdata', function (nodes) {\n        var i = nodes.length;\n\n        while (i--) {\n          var node = nodes[i];\n          node.type = 8;\n          node.name = '#comment';\n          node.value = '[CDATA[' + editor.dom.encode(node.value) + ']]';\n        }\n      });\n    }\n\n    parser.addNodeFilter('p,h1,h2,h3,h4,h5,h6,div', function (nodes) {\n      var i = nodes.length;\n      var nonEmptyElements = editor.schema.getNonEmptyElements();\n\n      while (i--) {\n        var node = nodes[i];\n\n        if (node.isEmpty(nonEmptyElements) && node.getAll('br').length === 0) {\n          node.append(new AstNode('br', 1)).shortEnded = true;\n        }\n      }\n    });\n    return parser;\n  };\n\n  var autoFocus = function (editor) {\n    if (editor.settings.auto_focus) {\n      Delay.setEditorTimeout(editor, function () {\n        var focusEditor;\n\n        if (editor.settings.auto_focus === true) {\n          focusEditor = editor;\n        } else {\n          focusEditor = editor.editorManager.get(editor.settings.auto_focus);\n        }\n\n        if (!focusEditor.destroyed) {\n          focusEditor.focus();\n        }\n      }, 100);\n    }\n  };\n\n  var moveSelectionToFirstCaretPosition = function (editor) {\n    var root = editor.dom.getRoot();\n\n    if (!editor.inline && (!hasAnyRanges(editor) || editor.selection.getStart(true) === root)) {\n      firstPositionIn(root).each(function (pos) {\n        var node = pos.getNode();\n        var caretPos = isTable(node) ? firstPositionIn(node).getOr(pos) : pos;\n\n        if (Env.browser.isIE()) {\n          storeNative(editor, caretPos.toRange());\n        } else {\n          editor.selection.setRng(caretPos.toRange());\n        }\n      });\n    }\n  };\n\n  var initEditor = function (editor) {\n    editor.bindPendingEventDelegates();\n    editor.initialized = true;\n    fireInit(editor);\n    editor.focus(true);\n    moveSelectionToFirstCaretPosition(editor);\n    editor.nodeChanged({\n      initial: true\n    });\n    editor.execCallback('init_instance_callback', editor);\n    autoFocus(editor);\n  };\n\n  var getStyleSheetLoader = function (editor) {\n    return editor.inline ? editor.ui.styleSheetLoader : editor.dom.styleSheetLoader;\n  };\n\n  var loadContentCss = function (editor, css) {\n    var styleSheetLoader = getStyleSheetLoader(editor);\n\n    var loaded = function () {\n      editor.on('remove', function () {\n        return styleSheetLoader.unloadAll(css);\n      });\n      initEditor(editor);\n    };\n\n    styleSheetLoader.loadAll(css, loaded, loaded);\n  };\n\n  var preInit = function (editor, rtcMode) {\n    var settings = editor.settings,\n        doc = editor.getDoc(),\n        body = editor.getBody();\n\n    if (!settings.browser_spellcheck && !settings.gecko_spellcheck) {\n      doc.body.spellcheck = false;\n      DOM$4.setAttrib(body, 'spellcheck', 'false');\n    }\n\n    editor.quirks = Quirks(editor);\n    firePostRender(editor);\n    var directionality = getDirectionality(editor);\n\n    if (directionality !== undefined) {\n      body.dir = directionality;\n    }\n\n    if (settings.protect) {\n      editor.on('BeforeSetContent', function (e) {\n        Tools.each(settings.protect, function (pattern) {\n          e.content = e.content.replace(pattern, function (str) {\n            return '<!--mce:protected ' + escape(str) + '-->';\n          });\n        });\n      });\n    }\n\n    editor.on('SetContent', function () {\n      editor.addVisual(editor.getBody());\n    });\n\n    if (rtcMode === false) {\n      editor.load({\n        initial: true,\n        format: 'html'\n      });\n    }\n\n    editor.startContent = editor.getContent({\n      format: 'raw'\n    });\n    editor.on('compositionstart compositionend', function (e) {\n      editor.composing = e.type === 'compositionstart';\n    });\n\n    if (editor.contentStyles.length > 0) {\n      var contentCssText_1 = '';\n      Tools.each(editor.contentStyles, function (style) {\n        contentCssText_1 += style + '\\r\\n';\n      });\n      editor.dom.addStyle(contentCssText_1);\n    }\n\n    loadContentCss(editor, editor.contentCSS);\n\n    if (settings.content_style) {\n      appendStyle(editor, settings.content_style);\n    }\n  };\n\n  var initContentBody = function (editor, skipWrite) {\n    var settings = editor.settings;\n    var targetElm = editor.getElement();\n    var doc = editor.getDoc();\n\n    if (!settings.inline) {\n      editor.getElement().style.visibility = editor.orgVisibility;\n    }\n\n    if (!skipWrite && !editor.inline) {\n      doc.open();\n      doc.write(editor.iframeHTML);\n      doc.close();\n    }\n\n    if (editor.inline) {\n      DOM$4.addClass(targetElm, 'mce-content-body');\n      editor.contentDocument = doc = document;\n      editor.contentWindow = window;\n      editor.bodyElement = targetElm;\n      editor.contentAreaContainer = targetElm;\n    }\n\n    var body = editor.getBody();\n    body.disabled = true;\n    editor.readonly = !!settings.readonly;\n\n    if (!editor.readonly) {\n      if (editor.inline && DOM$4.getStyle(body, 'position', true) === 'static') {\n        body.style.position = 'relative';\n      }\n\n      body.contentEditable = editor.getParam('content_editable_state', true);\n    }\n\n    body.disabled = false;\n    editor.editorUpload = EditorUpload(editor);\n    editor.schema = Schema(settings);\n    editor.dom = DOMUtils$1(doc, {\n      keep_values: true,\n      url_converter: editor.convertURL,\n      url_converter_scope: editor,\n      hex_colors: settings.force_hex_style_colors,\n      update_styles: true,\n      root_element: editor.inline ? editor.getBody() : null,\n      collect: function () {\n        return editor.inline;\n      },\n      schema: editor.schema,\n      contentCssCors: shouldUseContentCssCors(editor),\n      referrerPolicy: getReferrerPolicy(editor),\n      onSetAttrib: function (e) {\n        editor.fire('SetAttrib', e);\n      }\n    });\n    editor.parser = createParser(editor);\n    editor.serializer = DomSerializer(mkSerializerSettings(editor), editor);\n    editor.selection = EditorSelection(editor.dom, editor.getWin(), editor.serializer, editor);\n    editor.annotator = Annotator(editor);\n    editor.formatter = Formatter(editor);\n    editor.undoManager = UndoManager(editor);\n    editor._nodeChangeDispatcher = new NodeChange(editor);\n    editor._selectionOverrides = SelectionOverrides(editor);\n    setup$9(editor);\n    setup$j(editor);\n\n    if (!isRtc(editor)) {\n      setup$k(editor);\n    }\n\n    var caret = setup$i(editor);\n    setup$8(editor, caret);\n    setup$a(editor);\n    setup$7(editor);\n    firePreInit(editor);\n    setup$4(editor).fold(function () {\n      preInit(editor, false);\n    }, function (loadingRtc) {\n      editor.setProgressState(true);\n      loadingRtc.then(function (rtcMode) {\n        editor.setProgressState(false);\n        preInit(editor, rtcMode);\n      });\n    });\n  };\n\n  var DOM$5 = DOMUtils$1.DOM;\n\n  var relaxDomain = function (editor, ifr) {\n    if (document.domain !== window.location.hostname && Env.browser.isIE()) {\n      var bodyUuid = uuid('mce');\n\n      editor[bodyUuid] = function () {\n        initContentBody(editor);\n      };\n\n      var domainRelaxUrl = 'javascript:(function(){' + 'document.open();document.domain=\"' + document.domain + '\";' + 'var ed = window.parent.tinymce.get(\"' + editor.id + '\");document.write(ed.iframeHTML);' + 'document.close();ed.' + bodyUuid + '(true);})()';\n      DOM$5.setAttrib(ifr, 'src', domainRelaxUrl);\n      return true;\n    }\n\n    return false;\n  };\n\n  var createIframeElement = function (id, title, height, customAttrs) {\n    var iframe = SugarElement.fromTag('iframe');\n    setAll(iframe, customAttrs);\n    setAll(iframe, {\n      id: id + '_ifr',\n      frameBorder: '0',\n      allowTransparency: 'true',\n      title: title\n    });\n    add$3(iframe, 'tox-edit-area__iframe');\n    return iframe;\n  };\n\n  var getIframeHtml = function (editor) {\n    var iframeHTML = getDocType(editor) + '<html><head>';\n\n    if (getDocumentBaseUrl(editor) !== editor.documentBaseUrl) {\n      iframeHTML += '<base href=\"' + editor.documentBaseURI.getURI() + '\" />';\n    }\n\n    iframeHTML += '<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />';\n    var bodyId = getBodyId(editor);\n    var bodyClass = getBodyClass(editor);\n\n    if (getContentSecurityPolicy(editor)) {\n      iframeHTML += '<meta http-equiv=\"Content-Security-Policy\" content=\"' + getContentSecurityPolicy(editor) + '\" />';\n    }\n\n    iframeHTML += '</head><body id=\"' + bodyId + '\" class=\"mce-content-body ' + bodyClass + '\" data-id=\"' + editor.id + '\"><br></body></html>';\n    return iframeHTML;\n  };\n\n  var createIframe = function (editor, o) {\n    var title = editor.editorManager.translate('Rich Text Area. Press ALT-0 for help.');\n    var ifr = createIframeElement(editor.id, title, o.height, getIframeAttrs(editor)).dom;\n\n    ifr.onload = function () {\n      ifr.onload = null;\n      editor.fire('load');\n    };\n\n    var isDomainRelaxed = relaxDomain(editor, ifr);\n    editor.contentAreaContainer = o.iframeContainer;\n    editor.iframeElement = ifr;\n    editor.iframeHTML = getIframeHtml(editor);\n    DOM$5.add(o.iframeContainer, ifr);\n    return isDomainRelaxed;\n  };\n\n  var init$1 = function (editor, boxInfo) {\n    var isDomainRelaxed = createIframe(editor, boxInfo);\n\n    if (boxInfo.editorContainer) {\n      DOM$5.get(boxInfo.editorContainer).style.display = editor.orgDisplay;\n      editor.hidden = DOM$5.isHidden(boxInfo.editorContainer);\n    }\n\n    editor.getElement().style.display = 'none';\n    DOM$5.setAttrib(editor.id, 'aria-hidden', 'true');\n\n    if (!isDomainRelaxed) {\n      initContentBody(editor);\n    }\n  };\n\n  var DOM$6 = DOMUtils$1.DOM;\n\n  var initPlugin = function (editor, initializedPlugins, plugin) {\n    var Plugin = PluginManager.get(plugin);\n    var pluginUrl = PluginManager.urls[plugin] || editor.documentBaseUrl.replace(/\\/$/, '');\n    plugin = Tools.trim(plugin);\n\n    if (Plugin && Tools.inArray(initializedPlugins, plugin) === -1) {\n      Tools.each(PluginManager.dependencies(plugin), function (dep) {\n        initPlugin(editor, initializedPlugins, dep);\n      });\n\n      if (editor.plugins[plugin]) {\n        return;\n      }\n\n      try {\n        var pluginInstance = new Plugin(editor, pluginUrl, editor.$);\n        editor.plugins[plugin] = pluginInstance;\n\n        if (pluginInstance.init) {\n          pluginInstance.init(editor, pluginUrl);\n          initializedPlugins.push(plugin);\n        }\n      } catch (e) {\n        pluginInitError(editor, plugin, e);\n      }\n    }\n  };\n\n  var trimLegacyPrefix = function (name) {\n    return name.replace(/^\\-/, '');\n  };\n\n  var initPlugins = function (editor) {\n    var initializedPlugins = [];\n    Tools.each(getPlugins(editor).split(/[ ,]/), function (name) {\n      initPlugin(editor, initializedPlugins, trimLegacyPrefix(name));\n    });\n  };\n\n  var initIcons = function (editor) {\n    var iconPackName = Tools.trim(getIconPackName(editor));\n    var currentIcons = editor.ui.registry.getAll().icons;\n\n    var loadIcons = __assign(__assign({}, IconManager.get('default').icons), IconManager.get(iconPackName).icons);\n\n    each$1(loadIcons, function (svgData, icon) {\n      if (!has(currentIcons, icon)) {\n        editor.ui.registry.addIcon(icon, svgData);\n      }\n    });\n  };\n\n  var initTheme = function (editor) {\n    var theme = getTheme(editor);\n\n    if (isString(theme)) {\n      editor.settings.theme = trimLegacyPrefix(theme);\n      var Theme = ThemeManager.get(theme);\n      editor.theme = new Theme(editor, ThemeManager.urls[theme]);\n\n      if (editor.theme.init) {\n        editor.theme.init(editor, ThemeManager.urls[theme] || editor.documentBaseUrl.replace(/\\/$/, ''), editor.$);\n      }\n    } else {\n      editor.theme = {};\n    }\n  };\n\n  var renderFromLoadedTheme = function (editor) {\n    return editor.theme.renderUI();\n  };\n\n  var renderFromThemeFunc = function (editor) {\n    var elm = editor.getElement();\n    var theme = getTheme(editor);\n    var info = theme(editor, elm);\n\n    if (info.editorContainer.nodeType) {\n      info.editorContainer.id = info.editorContainer.id || editor.id + '_parent';\n    }\n\n    if (info.iframeContainer && info.iframeContainer.nodeType) {\n      info.iframeContainer.id = info.iframeContainer.id || editor.id + '_iframecontainer';\n    }\n\n    info.height = info.iframeHeight ? info.iframeHeight : elm.offsetHeight;\n    return info;\n  };\n\n  var createThemeFalseResult = function (element) {\n    return {\n      editorContainer: element,\n      iframeContainer: element,\n      api: {}\n    };\n  };\n\n  var renderThemeFalseIframe = function (targetElement) {\n    var iframeContainer = DOM$6.create('div');\n    DOM$6.insertAfter(iframeContainer, targetElement);\n    return createThemeFalseResult(iframeContainer);\n  };\n\n  var renderThemeFalse = function (editor) {\n    var targetElement = editor.getElement();\n    return editor.inline ? createThemeFalseResult(null) : renderThemeFalseIframe(targetElement);\n  };\n\n  var renderThemeUi = function (editor) {\n    var elm = editor.getElement();\n    editor.orgDisplay = elm.style.display;\n\n    if (isString(getTheme(editor))) {\n      return renderFromLoadedTheme(editor);\n    } else if (isFunction(getTheme(editor))) {\n      return renderFromThemeFunc(editor);\n    } else {\n      return renderThemeFalse(editor);\n    }\n  };\n\n  var init$2 = function (editor) {\n    editor.fire('ScriptsLoaded');\n    initIcons(editor);\n    initTheme(editor);\n    initPlugins(editor);\n    var renderInfo = renderThemeUi(editor);\n    editor.ui = __assign(__assign({}, editor.ui), renderInfo.api);\n    var boxInfo = {\n      editorContainer: renderInfo.editorContainer,\n      iframeContainer: renderInfo.iframeContainer\n    };\n    editor.editorContainer = boxInfo.editorContainer ? boxInfo.editorContainer : null;\n    appendContentCssFromSettings(editor);\n\n    if (editor.inline) {\n      return initContentBody(editor);\n    } else {\n      return init$1(editor, boxInfo);\n    }\n  };\n\n  var DOM$7 = DOMUtils$1.DOM;\n\n  var hasSkipLoadPrefix = function (name) {\n    return name.charAt(0) === '-';\n  };\n\n  var loadLanguage = function (scriptLoader, editor) {\n    var languageCode = getLanguageCode(editor);\n    var languageUrl = getLanguageUrl(editor);\n\n    if (I18n.hasCode(languageCode) === false && languageCode !== 'en') {\n      var url_1 = languageUrl !== '' ? languageUrl : editor.editorManager.baseURL + '/langs/' + languageCode + '.js';\n      scriptLoader.add(url_1, noop, undefined, function () {\n        languageLoadError(editor, url_1, languageCode);\n      });\n    }\n  };\n\n  var loadTheme = function (scriptLoader, editor, suffix, callback) {\n    var theme = getTheme(editor);\n\n    if (isString(theme)) {\n      if (!hasSkipLoadPrefix(theme) && !ThemeManager.urls.hasOwnProperty(theme)) {\n        var themeUrl = getThemeUrl(editor);\n\n        if (themeUrl) {\n          ThemeManager.load(theme, editor.documentBaseURI.toAbsolute(themeUrl));\n        } else {\n          ThemeManager.load(theme, 'themes/' + theme + '/theme' + suffix + '.js');\n        }\n      }\n\n      scriptLoader.loadQueue(function () {\n        ThemeManager.waitFor(theme, callback);\n      });\n    } else {\n      callback();\n    }\n  };\n\n  var getIconsUrlMetaFromUrl = function (editor) {\n    return Optional.from(getIconsUrl(editor)).filter(function (url) {\n      return url.length > 0;\n    }).map(function (url) {\n      return {\n        url: url,\n        name: Optional.none()\n      };\n    });\n  };\n\n  var getIconsUrlMetaFromName = function (editor, name, suffix) {\n    return Optional.from(name).filter(function (name) {\n      return name.length > 0 && !IconManager.has(name);\n    }).map(function (name) {\n      return {\n        url: editor.editorManager.baseURL + '/icons/' + name + '/icons' + suffix + '.js',\n        name: Optional.some(name)\n      };\n    });\n  };\n\n  var loadIcons = function (scriptLoader, editor, suffix) {\n    var defaultIconsUrl = getIconsUrlMetaFromName(editor, 'default', suffix);\n    var customIconsUrl = getIconsUrlMetaFromUrl(editor).orThunk(function () {\n      return getIconsUrlMetaFromName(editor, getIconPackName(editor), '');\n    });\n    each(cat([defaultIconsUrl, customIconsUrl]), function (urlMeta) {\n      scriptLoader.add(urlMeta.url, noop, undefined, function () {\n        iconsLoadError(editor, urlMeta.url, urlMeta.name.getOrUndefined());\n      });\n    });\n  };\n\n  var loadPlugins = function (editor, suffix) {\n    Tools.each(getExternalPlugins(editor), function (url, name) {\n      PluginManager.load(name, url, noop, undefined, function () {\n        pluginLoadError(editor, url, name);\n      });\n      editor.settings.plugins += ' ' + name;\n    });\n    Tools.each(getPlugins(editor).split(/[ ,]/), function (plugin) {\n      plugin = Tools.trim(plugin);\n\n      if (plugin && !PluginManager.urls[plugin]) {\n        if (hasSkipLoadPrefix(plugin)) {\n          plugin = plugin.substr(1, plugin.length);\n          var dependencies = PluginManager.dependencies(plugin);\n          Tools.each(dependencies, function (depPlugin) {\n            var defaultSettings = {\n              prefix: 'plugins/',\n              resource: depPlugin,\n              suffix: '/plugin' + suffix + '.js'\n            };\n            var dep = PluginManager.createUrl(defaultSettings, depPlugin);\n            PluginManager.load(dep.resource, dep, noop, undefined, function () {\n              pluginLoadError(editor, dep.prefix + dep.resource + dep.suffix, dep.resource);\n            });\n          });\n        } else {\n          var url_2 = {\n            prefix: 'plugins/',\n            resource: plugin,\n            suffix: '/plugin' + suffix + '.js'\n          };\n          PluginManager.load(plugin, url_2, noop, undefined, function () {\n            pluginLoadError(editor, url_2.prefix + url_2.resource + url_2.suffix, plugin);\n          });\n        }\n      }\n    });\n  };\n\n  var loadScripts = function (editor, suffix) {\n    var scriptLoader = ScriptLoader.ScriptLoader;\n    loadTheme(scriptLoader, editor, suffix, function () {\n      loadLanguage(scriptLoader, editor);\n      loadIcons(scriptLoader, editor, suffix);\n      loadPlugins(editor, suffix);\n      scriptLoader.loadQueue(function () {\n        if (!editor.removed) {\n          init$2(editor);\n        }\n      }, editor, function () {\n        if (!editor.removed) {\n          init$2(editor);\n        }\n      });\n    });\n  };\n\n  var getStyleSheetLoader$1 = function (element, editor) {\n    return instance.forElement(element, {\n      contentCssCors: hasContentCssCors(editor),\n      referrerPolicy: getReferrerPolicy(editor)\n    });\n  };\n\n  var render = function (editor) {\n    var id = editor.id;\n    I18n.setCode(getLanguageCode(editor));\n\n    var readyHandler = function () {\n      DOM$7.unbind(window, 'ready', readyHandler);\n      editor.render();\n    };\n\n    if (!EventUtils.Event.domLoaded) {\n      DOM$7.bind(window, 'ready', readyHandler);\n      return;\n    }\n\n    if (!editor.getElement()) {\n      return;\n    }\n\n    if (!Env.contentEditable) {\n      return;\n    }\n\n    var element = SugarElement.fromDom(editor.getElement());\n    var snapshot = clone(element);\n    editor.on('remove', function () {\n      eachr(element.dom.attributes, function (attr) {\n        return remove$1(element, attr.name);\n      });\n      setAll(element, snapshot);\n    });\n    editor.ui.styleSheetLoader = getStyleSheetLoader$1(element, editor);\n\n    if (!isInline$1(editor)) {\n      editor.orgVisibility = editor.getElement().style.visibility;\n      editor.getElement().style.visibility = 'hidden';\n    } else {\n      editor.inline = true;\n    }\n\n    var form = editor.getElement().form || DOM$7.getParent(id, 'form');\n\n    if (form) {\n      editor.formElement = form;\n\n      if (hasHiddenInput(editor) && !isTextareaOrInput(editor.getElement())) {\n        DOM$7.insertAfter(DOM$7.create('input', {\n          type: 'hidden',\n          name: id\n        }), id);\n        editor.hasHiddenInput = true;\n      }\n\n      editor.formEventDelegate = function (e) {\n        editor.fire(e.type, e);\n      };\n\n      DOM$7.bind(form, 'submit reset', editor.formEventDelegate);\n      editor.on('reset', function () {\n        editor.resetContent();\n      });\n\n      if (shouldPatchSubmit(editor) && !form.submit.nodeType && !form.submit.length && !form._mceOldSubmit) {\n        form._mceOldSubmit = form.submit;\n\n        form.submit = function () {\n          editor.editorManager.triggerSave();\n          editor.setDirty(false);\n          return form._mceOldSubmit(form);\n        };\n      }\n    }\n\n    editor.windowManager = WindowManager(editor);\n    editor.notificationManager = NotificationManager(editor);\n\n    if (isEncodingXml(editor)) {\n      editor.on('GetContent', function (e) {\n        if (e.save) {\n          e.content = DOM$7.encode(e.content);\n        }\n      });\n    }\n\n    if (shouldAddFormSubmitTrigger(editor)) {\n      editor.on('submit', function () {\n        if (editor.initialized) {\n          editor.save();\n        }\n      });\n    }\n\n    if (shouldAddUnloadTrigger(editor)) {\n      editor._beforeUnload = function () {\n        if (editor.initialized && !editor.destroyed && !editor.isHidden()) {\n          editor.save({\n            format: 'raw',\n            no_events: true,\n            set_dirty: false\n          });\n        }\n      };\n\n      editor.editorManager.on('BeforeUnload', editor._beforeUnload);\n    }\n\n    editor.editorManager.add(editor);\n    loadScripts(editor, editor.suffix);\n  };\n\n  var ensureIsRoot = function (isRoot) {\n    return isFunction(isRoot) ? isRoot : never;\n  };\n\n  var ancestor$3 = function (scope, transform, isRoot) {\n    var element = scope.dom;\n    var stop = ensureIsRoot(isRoot);\n\n    while (element.parentNode) {\n      element = element.parentNode;\n      var el = SugarElement.fromDom(element);\n      var transformed = transform(el);\n\n      if (transformed.isSome()) {\n        return transformed;\n      } else if (stop(el)) {\n        break;\n      }\n    }\n\n    return Optional.none();\n  };\n\n  var closest$2 = function (scope, transform, isRoot) {\n    var current = transform(scope);\n    var stop = ensureIsRoot(isRoot);\n    return current.orThunk(function () {\n      return stop(scope) ? Optional.none() : ancestor$3(scope, transform, stop);\n    });\n  };\n\n  var legacyPropNames = {\n    'font-size': 'size',\n    'font-family': 'face'\n  };\n\n  var getSpecifiedFontProp = function (propName, rootElm, elm) {\n    var getProperty = function (elm) {\n      return getRaw(elm, propName).orThunk(function () {\n        if (name(elm) === 'font') {\n          return get(legacyPropNames, propName).bind(function (legacyPropName) {\n            return getOpt(elm, legacyPropName);\n          });\n        } else {\n          return Optional.none();\n        }\n      });\n    };\n\n    var isRoot = function (elm) {\n      return eq$2(SugarElement.fromDom(rootElm), elm);\n    };\n\n    return closest$2(SugarElement.fromDom(elm), function (elm) {\n      return getProperty(elm);\n    }, isRoot);\n  };\n\n  var normalizeFontFamily = function (fontFamily) {\n    return fontFamily.replace(/[\\'\\\"\\\\]/g, '').replace(/,\\s+/g, ',');\n  };\n\n  var getComputedFontProp = function (propName, elm) {\n    return Optional.from(DOMUtils$1.DOM.getStyle(elm, propName, true));\n  };\n\n  var getFontProp = function (propName) {\n    return function (rootElm, elm) {\n      return Optional.from(elm).map(SugarElement.fromDom).filter(isElement).bind(function (element) {\n        return getSpecifiedFontProp(propName, rootElm, element.dom).or(getComputedFontProp(propName, element.dom));\n      }).getOr('');\n    };\n  };\n\n  var getFontSize = getFontProp('font-size');\n  var getFontFamily = compose(normalizeFontFamily, getFontProp('font-family'));\n\n  var findFirstCaretElement = function (editor) {\n    return firstPositionIn(editor.getBody()).map(function (caret) {\n      var container = caret.container();\n      return isText$1(container) ? container.parentNode : container;\n    });\n  };\n\n  var getCaretElement = function (editor) {\n    return Optional.from(editor.selection.getRng()).bind(function (rng) {\n      var root = editor.getBody();\n      var atStartOfNode = rng.startContainer === root && rng.startOffset === 0;\n      return atStartOfNode ? Optional.none() : Optional.from(editor.selection.getStart(true));\n    });\n  };\n\n  var mapRange = function (editor, mapper) {\n    return getCaretElement(editor).orThunk(curry(findFirstCaretElement, editor)).map(SugarElement.fromDom).filter(isElement).map(mapper);\n  };\n\n  var fromFontSizeNumber = function (editor, value) {\n    if (/^[0-9.]+$/.test(value)) {\n      var fontSizeNumber = parseInt(value, 10);\n\n      if (fontSizeNumber >= 1 && fontSizeNumber <= 7) {\n        var fontSizes = getFontStyleValues(editor);\n        var fontClasses = getFontSizeClasses(editor);\n\n        if (fontClasses) {\n          return fontClasses[fontSizeNumber - 1] || value;\n        } else {\n          return fontSizes[fontSizeNumber - 1] || value;\n        }\n      } else {\n        return value;\n      }\n    } else {\n      return value;\n    }\n  };\n\n  var normalizeFontNames = function (font) {\n    var fonts = font.split(/\\s*,\\s*/);\n    return map(fonts, function (font) {\n      if (font.indexOf(' ') !== -1 && !(startsWith(font, '\"') || startsWith(font, '\\''))) {\n        return '\\'' + font + '\\'';\n      } else {\n        return font;\n      }\n    }).join(',');\n  };\n\n  var fontNameAction = function (editor, value) {\n    var font = fromFontSizeNumber(editor, value);\n    editor.formatter.toggle('fontname', {\n      value: normalizeFontNames(font)\n    });\n    editor.nodeChanged();\n  };\n\n  var fontNameQuery = function (editor) {\n    return mapRange(editor, function (elm) {\n      return getFontFamily(editor.getBody(), elm.dom);\n    }).getOr('');\n  };\n\n  var fontSizeAction = function (editor, value) {\n    editor.formatter.toggle('fontsize', {\n      value: fromFontSizeNumber(editor, value)\n    });\n    editor.nodeChanged();\n  };\n\n  var fontSizeQuery = function (editor) {\n    return mapRange(editor, function (elm) {\n      return getFontSize(editor.getBody(), elm.dom);\n    }).getOr('');\n  };\n\n  var lineHeightQuery = function (editor) {\n    return mapRange(editor, function (elm) {\n      var root = SugarElement.fromDom(editor.getBody());\n      var specifiedStyle = closest$2(elm, function (elm) {\n        return getRaw(elm, 'line-height');\n      }, curry(eq$2, root));\n\n      var computedStyle = function () {\n        var lineHeight = parseFloat(get$4(elm, 'line-height'));\n        var fontSize = parseFloat(get$4(elm, 'font-size'));\n        return String(lineHeight / fontSize);\n      };\n\n      return specifiedStyle.getOrThunk(computedStyle);\n    }).getOr('');\n  };\n\n  var lineHeightAction = function (editor, lineHeight) {\n    editor.undoManager.transact(function () {\n      editor.formatter.toggle('lineheight', {\n        value: String(lineHeight)\n      });\n      editor.nodeChanged();\n    });\n  };\n\n  var processValue = function (value) {\n    var details;\n\n    if (typeof value !== 'string') {\n      details = Tools.extend({\n        paste: value.paste,\n        data: {\n          paste: value.paste\n        }\n      }, value);\n      return {\n        content: value.content,\n        details: details\n      };\n    }\n\n    return {\n      content: value,\n      details: {}\n    };\n  };\n\n  var insertAtCaret$1 = function (editor, value) {\n    var result = processValue(value);\n    insertContent(editor, result.content, result.details);\n  };\n\n  var each$f = Tools.each;\n  var map$3 = Tools.map,\n      inArray$2 = Tools.inArray;\n\n  var EditorCommands = function () {\n    function EditorCommands(editor) {\n      this.commands = {\n        state: {},\n        exec: {},\n        value: {}\n      };\n      this.editor = editor;\n      this.setupCommands(editor);\n    }\n\n    EditorCommands.prototype.execCommand = function (command, ui, value, args) {\n      var func,\n          state = false;\n      var self = this;\n\n      if (self.editor.removed) {\n        return;\n      }\n\n      if (!/^(mceAddUndoLevel|mceEndUndoLevel|mceBeginUndoLevel|mceRepaint)$/.test(command) && (!args || !args.skip_focus)) {\n        self.editor.focus();\n      } else {\n        restore(self.editor);\n      }\n\n      args = self.editor.fire('BeforeExecCommand', {\n        command: command,\n        ui: ui,\n        value: value\n      });\n\n      if (args.isDefaultPrevented()) {\n        return false;\n      }\n\n      var customCommand = command.toLowerCase();\n\n      if (func = self.commands.exec[customCommand]) {\n        func(customCommand, ui, value);\n        self.editor.fire('ExecCommand', {\n          command: command,\n          ui: ui,\n          value: value\n        });\n        return true;\n      }\n\n      each$f(this.editor.plugins, function (p) {\n        if (p.execCommand && p.execCommand(command, ui, value)) {\n          self.editor.fire('ExecCommand', {\n            command: command,\n            ui: ui,\n            value: value\n          });\n          state = true;\n          return false;\n        }\n      });\n\n      if (state) {\n        return state;\n      }\n\n      if (self.editor.theme && self.editor.theme.execCommand && self.editor.theme.execCommand(command, ui, value)) {\n        self.editor.fire('ExecCommand', {\n          command: command,\n          ui: ui,\n          value: value\n        });\n        return true;\n      }\n\n      try {\n        state = self.editor.getDoc().execCommand(command, ui, value);\n      } catch (ex) {}\n\n      if (state) {\n        self.editor.fire('ExecCommand', {\n          command: command,\n          ui: ui,\n          value: value\n        });\n        return true;\n      }\n\n      return false;\n    };\n\n    EditorCommands.prototype.queryCommandState = function (command) {\n      var func;\n\n      if (this.editor.quirks.isHidden() || this.editor.removed) {\n        return;\n      }\n\n      command = command.toLowerCase();\n\n      if (func = this.commands.state[command]) {\n        return func(command);\n      }\n\n      try {\n        return this.editor.getDoc().queryCommandState(command);\n      } catch (ex) {}\n\n      return false;\n    };\n\n    EditorCommands.prototype.queryCommandValue = function (command) {\n      var func;\n\n      if (this.editor.quirks.isHidden() || this.editor.removed) {\n        return;\n      }\n\n      command = command.toLowerCase();\n\n      if (func = this.commands.value[command]) {\n        return func(command);\n      }\n\n      try {\n        return this.editor.getDoc().queryCommandValue(command);\n      } catch (ex) {}\n    };\n\n    EditorCommands.prototype.addCommands = function (commandList, type) {\n      if (type === void 0) {\n        type = 'exec';\n      }\n\n      var self = this;\n      each$f(commandList, function (callback, command) {\n        each$f(command.toLowerCase().split(','), function (command) {\n          self.commands[type][command] = callback;\n        });\n      });\n    };\n\n    EditorCommands.prototype.addCommand = function (command, callback, scope) {\n      var _this = this;\n\n      command = command.toLowerCase();\n\n      this.commands.exec[command] = function (command, ui, value, args) {\n        return callback.call(scope || _this.editor, ui, value, args);\n      };\n    };\n\n    EditorCommands.prototype.queryCommandSupported = function (command) {\n      command = command.toLowerCase();\n\n      if (this.commands.exec[command]) {\n        return true;\n      }\n\n      try {\n        return this.editor.getDoc().queryCommandSupported(command);\n      } catch (ex) {}\n\n      return false;\n    };\n\n    EditorCommands.prototype.addQueryStateHandler = function (command, callback, scope) {\n      var _this = this;\n\n      command = command.toLowerCase();\n\n      this.commands.state[command] = function () {\n        return callback.call(scope || _this.editor);\n      };\n    };\n\n    EditorCommands.prototype.addQueryValueHandler = function (command, callback, scope) {\n      var _this = this;\n\n      command = command.toLowerCase();\n\n      this.commands.value[command] = function () {\n        return callback.call(scope || _this.editor);\n      };\n    };\n\n    EditorCommands.prototype.hasCustomCommand = function (command) {\n      command = command.toLowerCase();\n      return !!this.commands.exec[command];\n    };\n\n    EditorCommands.prototype.execNativeCommand = function (command, ui, value) {\n      if (ui === undefined) {\n        ui = false;\n      }\n\n      if (value === undefined) {\n        value = null;\n      }\n\n      return this.editor.getDoc().execCommand(command, ui, value);\n    };\n\n    EditorCommands.prototype.isFormatMatch = function (name) {\n      return this.editor.formatter.match(name);\n    };\n\n    EditorCommands.prototype.toggleFormat = function (name, value) {\n      this.editor.formatter.toggle(name, value ? {\n        value: value\n      } : undefined);\n      this.editor.nodeChanged();\n    };\n\n    EditorCommands.prototype.storeSelection = function (type) {\n      this.selectionBookmark = this.editor.selection.getBookmark(type);\n    };\n\n    EditorCommands.prototype.restoreSelection = function () {\n      this.editor.selection.moveToBookmark(this.selectionBookmark);\n    };\n\n    EditorCommands.prototype.setupCommands = function (editor) {\n      var self = this;\n      this.addCommands({\n        'mceResetDesignMode,mceBeginUndoLevel': function () {},\n        'mceEndUndoLevel,mceAddUndoLevel': function () {\n          editor.undoManager.add();\n        },\n        'Cut,Copy,Paste': function (command) {\n          var doc = editor.getDoc();\n          var failed;\n\n          try {\n            self.execNativeCommand(command);\n          } catch (ex) {\n            failed = true;\n          }\n\n          if (command === 'paste' && !doc.queryCommandEnabled(command)) {\n            failed = true;\n          }\n\n          if (failed || !doc.queryCommandSupported(command)) {\n            var msg = editor.translate('Your browser doesn\\'t support direct access to the clipboard. ' + 'Please use the Ctrl+X/C/V keyboard shortcuts instead.');\n\n            if (Env.mac) {\n              msg = msg.replace(/Ctrl\\+/g, '\\u2318+');\n            }\n\n            editor.notificationManager.open({\n              text: msg,\n              type: 'error'\n            });\n          }\n        },\n        'unlink': function () {\n          if (editor.selection.isCollapsed()) {\n            var elm = editor.dom.getParent(editor.selection.getStart(), 'a');\n\n            if (elm) {\n              editor.dom.remove(elm, true);\n            }\n\n            return;\n          }\n\n          editor.formatter.remove('link');\n        },\n        'JustifyLeft,JustifyCenter,JustifyRight,JustifyFull,JustifyNone': function (command) {\n          var align = command.substring(7);\n\n          if (align === 'full') {\n            align = 'justify';\n          }\n\n          each$f('left,center,right,justify'.split(','), function (name) {\n            if (align !== name) {\n              editor.formatter.remove('align' + name);\n            }\n          });\n\n          if (align !== 'none') {\n            self.toggleFormat('align' + align);\n          }\n        },\n        'InsertUnorderedList,InsertOrderedList': function (command) {\n          var listParent;\n          self.execNativeCommand(command);\n          var listElm = editor.dom.getParent(editor.selection.getNode(), 'ol,ul');\n\n          if (listElm) {\n            listParent = listElm.parentNode;\n\n            if (/^(H[1-6]|P|ADDRESS|PRE)$/.test(listParent.nodeName)) {\n              self.storeSelection();\n              editor.dom.split(listParent, listElm);\n              self.restoreSelection();\n            }\n          }\n        },\n        'Bold,Italic,Underline,Strikethrough,Superscript,Subscript': function (command) {\n          self.toggleFormat(command);\n        },\n        'ForeColor,HiliteColor': function (command, ui, value) {\n          self.toggleFormat(command, value);\n        },\n        'FontName': function (command, ui, value) {\n          fontNameAction(editor, value);\n        },\n        'FontSize': function (command, ui, value) {\n          fontSizeAction(editor, value);\n        },\n        'LineHeight': function (command, ui, value) {\n          lineHeightAction(editor, value);\n        },\n        'RemoveFormat': function (command) {\n          editor.formatter.remove(command);\n        },\n        'mceBlockQuote': function () {\n          self.toggleFormat('blockquote');\n        },\n        'FormatBlock': function (command, ui, value) {\n          return self.toggleFormat(value || 'p');\n        },\n        'mceCleanup': function () {\n          var bookmark = editor.selection.getBookmark();\n          editor.setContent(editor.getContent());\n          editor.selection.moveToBookmark(bookmark);\n        },\n        'mceRemoveNode': function (command, ui, value) {\n          var node = value || editor.selection.getNode();\n\n          if (node !== editor.getBody()) {\n            self.storeSelection();\n            editor.dom.remove(node, true);\n            self.restoreSelection();\n          }\n        },\n        'mceSelectNodeDepth': function (command, ui, value) {\n          var counter = 0;\n          editor.dom.getParent(editor.selection.getNode(), function (node) {\n            if (node.nodeType === 1 && counter++ === value) {\n              editor.selection.select(node);\n              return false;\n            }\n          }, editor.getBody());\n        },\n        'mceSelectNode': function (command, ui, value) {\n          editor.selection.select(value);\n        },\n        'mceInsertContent': function (command, ui, value) {\n          insertAtCaret$1(editor, value);\n        },\n        'mceInsertRawHTML': function (command, ui, value) {\n          editor.selection.setContent('tiny_mce_marker');\n          var content = editor.getContent();\n          editor.setContent(content.replace(/tiny_mce_marker/g, function () {\n            return value;\n          }));\n        },\n        'mceInsertNewLine': function (command, ui, value) {\n          insert$3(editor, value);\n        },\n        'mceToggleFormat': function (command, ui, value) {\n          self.toggleFormat(value);\n        },\n        'mceSetContent': function (command, ui, value) {\n          editor.setContent(value);\n        },\n        'Indent,Outdent': function (command) {\n          handle(editor, command);\n        },\n        'mceRepaint': function () {},\n        'InsertHorizontalRule': function () {\n          editor.execCommand('mceInsertContent', false, '<hr />');\n        },\n        'mceToggleVisualAid': function () {\n          editor.hasVisual = !editor.hasVisual;\n          editor.addVisual();\n        },\n        'mceReplaceContent': function (command, ui, value) {\n          editor.execCommand('mceInsertContent', false, value.replace(/\\{\\$selection\\}/g, editor.selection.getContent({\n            format: 'text'\n          })));\n        },\n        'mceInsertLink': function (command, ui, value) {\n          if (typeof value === 'string') {\n            value = {\n              href: value\n            };\n          }\n\n          var anchor = editor.dom.getParent(editor.selection.getNode(), 'a');\n          value.href = value.href.replace(/ /g, '%20');\n\n          if (!anchor || !value.href) {\n            editor.formatter.remove('link');\n          }\n\n          if (value.href) {\n            editor.formatter.apply('link', value, anchor);\n          }\n        },\n        'selectAll': function () {\n          var editingHost = editor.dom.getParent(editor.selection.getStart(), isContentEditableTrue);\n\n          if (editingHost) {\n            var rng = editor.dom.createRng();\n            rng.selectNodeContents(editingHost);\n            editor.selection.setRng(rng);\n          }\n        },\n        'mceNewDocument': function () {\n          editor.setContent('');\n        },\n        'InsertLineBreak': function (command, ui, value) {\n          insert$2(editor, value);\n          return true;\n        }\n      });\n\n      var alignStates = function (name) {\n        return function () {\n          var selection = editor.selection;\n          var nodes = selection.isCollapsed() ? [editor.dom.getParent(selection.getNode(), editor.dom.isBlock)] : selection.getSelectedBlocks();\n          var matches = map$3(nodes, function (node) {\n            return !!editor.formatter.matchNode(node, name);\n          });\n          return inArray$2(matches, true) !== -1;\n        };\n      };\n\n      self.addCommands({\n        'JustifyLeft': alignStates('alignleft'),\n        'JustifyCenter': alignStates('aligncenter'),\n        'JustifyRight': alignStates('alignright'),\n        'JustifyFull': alignStates('alignjustify'),\n        'Bold,Italic,Underline,Strikethrough,Superscript,Subscript': function (command) {\n          return self.isFormatMatch(command);\n        },\n        'mceBlockQuote': function () {\n          return self.isFormatMatch('blockquote');\n        },\n        'Outdent': function () {\n          return canOutdent(editor);\n        },\n        'InsertUnorderedList,InsertOrderedList': function (command) {\n          var list = editor.dom.getParent(editor.selection.getNode(), 'ul,ol');\n          return list && (command === 'insertunorderedlist' && list.tagName === 'UL' || command === 'insertorderedlist' && list.tagName === 'OL');\n        }\n      }, 'state');\n      self.addCommands({\n        Undo: function () {\n          editor.undoManager.undo();\n        },\n        Redo: function () {\n          editor.undoManager.redo();\n        }\n      });\n      self.addQueryValueHandler('FontName', function () {\n        return fontNameQuery(editor);\n      }, this);\n      self.addQueryValueHandler('FontSize', function () {\n        return fontSizeQuery(editor);\n      }, this);\n      self.addQueryValueHandler('LineHeight', function () {\n        return lineHeightQuery(editor);\n      }, this);\n    };\n\n    return EditorCommands;\n  }();\n\n  var internalContentEditableAttr = 'data-mce-contenteditable';\n\n  var toggleClass = function (elm, cls, state) {\n    if (has$2(elm, cls) && state === false) {\n      remove$4(elm, cls);\n    } else if (state) {\n      add$3(elm, cls);\n    }\n  };\n\n  var setEditorCommandState = function (editor, cmd, state) {\n    try {\n      editor.getDoc().execCommand(cmd, false, String(state));\n    } catch (ex) {}\n  };\n\n  var setContentEditable = function (elm, state) {\n    elm.dom.contentEditable = state ? 'true' : 'false';\n  };\n\n  var switchOffContentEditableTrue = function (elm) {\n    each(descendants$1(elm, '*[contenteditable=\"true\"]'), function (elm) {\n      set(elm, internalContentEditableAttr, 'true');\n      setContentEditable(elm, false);\n    });\n  };\n\n  var switchOnContentEditableTrue = function (elm) {\n    each(descendants$1(elm, '*[' + internalContentEditableAttr + '=\"true\"]'), function (elm) {\n      remove$1(elm, internalContentEditableAttr);\n      setContentEditable(elm, true);\n    });\n  };\n\n  var removeFakeSelection = function (editor) {\n    Optional.from(editor.selection.getNode()).each(function (elm) {\n      elm.removeAttribute('data-mce-selected');\n    });\n  };\n\n  var restoreFakeSelection = function (editor) {\n    editor.selection.setRng(editor.selection.getRng());\n  };\n\n  var toggleReadOnly = function (editor, state) {\n    var body = SugarElement.fromDom(editor.getBody());\n    toggleClass(body, 'mce-content-readonly', state);\n\n    if (state) {\n      editor.selection.controlSelection.hideResizeRect();\n\n      editor._selectionOverrides.hideFakeCaret();\n\n      removeFakeSelection(editor);\n      editor.readonly = true;\n      setContentEditable(body, false);\n      switchOffContentEditableTrue(body);\n    } else {\n      editor.readonly = false;\n      setContentEditable(body, true);\n      switchOnContentEditableTrue(body);\n      setEditorCommandState(editor, 'StyleWithCSS', false);\n      setEditorCommandState(editor, 'enableInlineTableEditing', false);\n      setEditorCommandState(editor, 'enableObjectResizing', false);\n\n      if (hasEditorOrUiFocus(editor)) {\n        editor.focus();\n      }\n\n      restoreFakeSelection(editor);\n      editor.nodeChanged();\n    }\n  };\n\n  var isReadOnly$1 = function (editor) {\n    return editor.readonly;\n  };\n\n  var registerFilters = function (editor) {\n    editor.parser.addAttributeFilter('contenteditable', function (nodes) {\n      if (isReadOnly$1(editor)) {\n        each(nodes, function (node) {\n          node.attr(internalContentEditableAttr, node.attr('contenteditable'));\n          node.attr('contenteditable', 'false');\n        });\n      }\n    });\n    editor.serializer.addAttributeFilter(internalContentEditableAttr, function (nodes) {\n      if (isReadOnly$1(editor)) {\n        each(nodes, function (node) {\n          node.attr('contenteditable', node.attr(internalContentEditableAttr));\n        });\n      }\n    });\n    editor.serializer.addTempAttr(internalContentEditableAttr);\n  };\n\n  var registerReadOnlyContentFilters = function (editor) {\n    if (editor.serializer) {\n      registerFilters(editor);\n    } else {\n      editor.on('PreInit', function () {\n        registerFilters(editor);\n      });\n    }\n  };\n\n  var isClickEvent = function (e) {\n    return e.type === 'click';\n  };\n\n  var isInAnchor = function (editor, target) {\n    return editor.dom.getParent(target, 'a') !== null;\n  };\n\n  var preventReadOnlyEvents = function (editor, e) {\n    var target = e.target;\n\n    if (isClickEvent(e) && !VK.metaKeyPressed(e) && isInAnchor(editor, target)) {\n      e.preventDefault();\n    }\n  };\n\n  var registerReadOnlySelectionBlockers = function (editor) {\n    editor.on('ShowCaret', function (e) {\n      if (isReadOnly$1(editor)) {\n        e.preventDefault();\n      }\n    });\n    editor.on('ObjectSelected', function (e) {\n      if (isReadOnly$1(editor)) {\n        e.preventDefault();\n      }\n    });\n  };\n\n  var nativeEvents = Tools.makeMap('focus blur focusin focusout click dblclick mousedown mouseup mousemove mouseover beforepaste paste cut copy selectionchange ' + 'mouseout mouseenter mouseleave wheel keydown keypress keyup input beforeinput contextmenu dragstart dragend dragover ' + 'draggesture dragdrop drop drag submit ' + 'compositionstart compositionend compositionupdate touchstart touchmove touchend touchcancel', ' ');\n\n  var EventDispatcher = function () {\n    function EventDispatcher(settings) {\n      this.bindings = {};\n      this.settings = settings || {};\n      this.scope = this.settings.scope || this;\n      this.toggleEvent = this.settings.toggleEvent || never;\n    }\n\n    EventDispatcher.isNative = function (name) {\n      return !!nativeEvents[name.toLowerCase()];\n    };\n\n    EventDispatcher.prototype.fire = function (nameIn, argsIn) {\n      var name = nameIn.toLowerCase();\n      var args = argsIn || {};\n      args.type = name;\n\n      if (!args.target) {\n        args.target = this.scope;\n      }\n\n      if (!args.preventDefault) {\n        args.preventDefault = function () {\n          args.isDefaultPrevented = always;\n        };\n\n        args.stopPropagation = function () {\n          args.isPropagationStopped = always;\n        };\n\n        args.stopImmediatePropagation = function () {\n          args.isImmediatePropagationStopped = always;\n        };\n\n        args.isDefaultPrevented = never;\n        args.isPropagationStopped = never;\n        args.isImmediatePropagationStopped = never;\n      }\n\n      if (this.settings.beforeFire) {\n        this.settings.beforeFire(args);\n      }\n\n      var handlers = this.bindings[name];\n\n      if (handlers) {\n        for (var i = 0, l = handlers.length; i < l; i++) {\n          var callback = handlers[i];\n\n          if (callback.once) {\n            this.off(name, callback.func);\n          }\n\n          if (args.isImmediatePropagationStopped()) {\n            args.stopPropagation();\n            return args;\n          }\n\n          if (callback.func.call(this.scope, args) === false) {\n            args.preventDefault();\n            return args;\n          }\n        }\n      }\n\n      return args;\n    };\n\n    EventDispatcher.prototype.on = function (name, callback, prepend, extra) {\n      if (callback === false) {\n        callback = never;\n      }\n\n      if (callback) {\n        var wrappedCallback = {\n          func: callback\n        };\n\n        if (extra) {\n          Tools.extend(wrappedCallback, extra);\n        }\n\n        var names = name.toLowerCase().split(' ');\n        var i = names.length;\n\n        while (i--) {\n          var currentName = names[i];\n          var handlers = this.bindings[currentName];\n\n          if (!handlers) {\n            handlers = this.bindings[currentName] = [];\n            this.toggleEvent(currentName, true);\n          }\n\n          if (prepend) {\n            handlers.unshift(wrappedCallback);\n          } else {\n            handlers.push(wrappedCallback);\n          }\n        }\n      }\n\n      return this;\n    };\n\n    EventDispatcher.prototype.off = function (name, callback) {\n      var _this = this;\n\n      if (name) {\n        var names = name.toLowerCase().split(' ');\n        var i = names.length;\n\n        while (i--) {\n          var currentName = names[i];\n          var handlers = this.bindings[currentName];\n\n          if (!currentName) {\n            each$1(this.bindings, function (_value, bindingName) {\n              _this.toggleEvent(bindingName, false);\n\n              delete _this.bindings[bindingName];\n            });\n            return this;\n          }\n\n          if (handlers) {\n            if (!callback) {\n              handlers.length = 0;\n            } else {\n              var hi = handlers.length;\n\n              while (hi--) {\n                if (handlers[hi].func === callback) {\n                  handlers = handlers.slice(0, hi).concat(handlers.slice(hi + 1));\n                  this.bindings[currentName] = handlers;\n                }\n              }\n            }\n\n            if (!handlers.length) {\n              this.toggleEvent(name, false);\n              delete this.bindings[currentName];\n            }\n          }\n        }\n      } else {\n        each$1(this.bindings, function (_value, name) {\n          _this.toggleEvent(name, false);\n        });\n        this.bindings = {};\n      }\n\n      return this;\n    };\n\n    EventDispatcher.prototype.once = function (name, callback, prepend) {\n      return this.on(name, callback, prepend, {\n        once: true\n      });\n    };\n\n    EventDispatcher.prototype.has = function (name) {\n      name = name.toLowerCase();\n      return !(!this.bindings[name] || this.bindings[name].length === 0);\n    };\n\n    return EventDispatcher;\n  }();\n\n  var getEventDispatcher = function (obj) {\n    if (!obj._eventDispatcher) {\n      obj._eventDispatcher = new EventDispatcher({\n        scope: obj,\n        toggleEvent: function (name, state) {\n          if (EventDispatcher.isNative(name) && obj.toggleNativeEvent) {\n            obj.toggleNativeEvent(name, state);\n          }\n        }\n      });\n    }\n\n    return obj._eventDispatcher;\n  };\n\n  var Observable = {\n    fire: function (name, args, bubble) {\n      var self = this;\n\n      if (self.removed && name !== 'remove' && name !== 'detach') {\n        return args;\n      }\n\n      var dispatcherArgs = getEventDispatcher(self).fire(name, args);\n\n      if (bubble !== false && self.parent) {\n        var parent_1 = self.parent();\n\n        while (parent_1 && !dispatcherArgs.isPropagationStopped()) {\n          parent_1.fire(name, dispatcherArgs, false);\n          parent_1 = parent_1.parent();\n        }\n      }\n\n      return dispatcherArgs;\n    },\n    on: function (name, callback, prepend) {\n      return getEventDispatcher(this).on(name, callback, prepend);\n    },\n    off: function (name, callback) {\n      return getEventDispatcher(this).off(name, callback);\n    },\n    once: function (name, callback) {\n      return getEventDispatcher(this).once(name, callback);\n    },\n    hasEventListeners: function (name) {\n      return getEventDispatcher(this).has(name);\n    }\n  };\n  var DOM$8 = DOMUtils$1.DOM;\n  var customEventRootDelegates;\n\n  var getEventTarget = function (editor, eventName) {\n    if (eventName === 'selectionchange') {\n      return editor.getDoc();\n    }\n\n    if (!editor.inline && /^mouse|touch|click|contextmenu|drop|dragover|dragend/.test(eventName)) {\n      return editor.getDoc().documentElement;\n    }\n\n    var eventRoot = getEventRoot(editor);\n\n    if (eventRoot) {\n      if (!editor.eventRoot) {\n        editor.eventRoot = DOM$8.select(eventRoot)[0];\n      }\n\n      return editor.eventRoot;\n    }\n\n    return editor.getBody();\n  };\n\n  var isListening = function (editor) {\n    return !editor.hidden && !isReadOnly$1(editor);\n  };\n\n  var fireEvent = function (editor, eventName, e) {\n    if (isListening(editor)) {\n      editor.fire(eventName, e);\n    } else if (isReadOnly$1(editor)) {\n      preventReadOnlyEvents(editor, e);\n    }\n  };\n\n  var bindEventDelegate = function (editor, eventName) {\n    var delegate;\n\n    if (!editor.delegates) {\n      editor.delegates = {};\n    }\n\n    if (editor.delegates[eventName] || editor.removed) {\n      return;\n    }\n\n    var eventRootElm = getEventTarget(editor, eventName);\n\n    if (getEventRoot(editor)) {\n      if (!customEventRootDelegates) {\n        customEventRootDelegates = {};\n        editor.editorManager.on('removeEditor', function () {\n          if (!editor.editorManager.activeEditor) {\n            if (customEventRootDelegates) {\n              each$1(customEventRootDelegates, function (_value, name) {\n                editor.dom.unbind(getEventTarget(editor, name));\n              });\n              customEventRootDelegates = null;\n            }\n          }\n        });\n      }\n\n      if (customEventRootDelegates[eventName]) {\n        return;\n      }\n\n      delegate = function (e) {\n        var target = e.target;\n        var editors = editor.editorManager.get();\n        var i = editors.length;\n\n        while (i--) {\n          var body = editors[i].getBody();\n\n          if (body === target || DOM$8.isChildOf(target, body)) {\n            fireEvent(editors[i], eventName, e);\n          }\n        }\n      };\n\n      customEventRootDelegates[eventName] = delegate;\n      DOM$8.bind(eventRootElm, eventName, delegate);\n    } else {\n      delegate = function (e) {\n        fireEvent(editor, eventName, e);\n      };\n\n      DOM$8.bind(eventRootElm, eventName, delegate);\n      editor.delegates[eventName] = delegate;\n    }\n  };\n\n  var EditorObservable = __assign(__assign({}, Observable), {\n    bindPendingEventDelegates: function () {\n      var self = this;\n      Tools.each(self._pendingNativeEvents, function (name) {\n        bindEventDelegate(self, name);\n      });\n    },\n    toggleNativeEvent: function (name, state) {\n      var self = this;\n\n      if (name === 'focus' || name === 'blur') {\n        return;\n      }\n\n      if (state) {\n        if (self.initialized) {\n          bindEventDelegate(self, name);\n        } else {\n          if (!self._pendingNativeEvents) {\n            self._pendingNativeEvents = [name];\n          } else {\n            self._pendingNativeEvents.push(name);\n          }\n        }\n      } else if (self.initialized) {\n        self.dom.unbind(getEventTarget(self, name), name, self.delegates[name]);\n        delete self.delegates[name];\n      }\n    },\n    unbindAllNativeEvents: function () {\n      var self = this;\n      var body = self.getBody();\n      var dom = self.dom;\n\n      if (self.delegates) {\n        each$1(self.delegates, function (value, name) {\n          self.dom.unbind(getEventTarget(self, name), name, value);\n        });\n        delete self.delegates;\n      }\n\n      if (!self.inline && body && dom) {\n        body.onload = null;\n        dom.unbind(self.getWin());\n        dom.unbind(self.getDoc());\n      }\n\n      if (dom) {\n        dom.unbind(body);\n        dom.unbind(self.getContainer());\n      }\n    }\n  });\n\n  var defaultModes = ['design', 'readonly'];\n\n  var switchToMode = function (editor, activeMode, availableModes, mode) {\n    var oldMode = availableModes[activeMode.get()];\n    var newMode = availableModes[mode];\n\n    try {\n      newMode.activate();\n    } catch (e) {\n      console.error('problem while activating editor mode ' + mode + ':', e);\n      return;\n    }\n\n    oldMode.deactivate();\n\n    if (oldMode.editorReadOnly !== newMode.editorReadOnly) {\n      toggleReadOnly(editor, newMode.editorReadOnly);\n    }\n\n    activeMode.set(mode);\n    fireSwitchMode(editor, mode);\n  };\n\n  var setMode = function (editor, availableModes, activeMode, mode) {\n    if (mode === activeMode.get()) {\n      return;\n    } else if (!has(availableModes, mode)) {\n      throw new Error('Editor mode \\'' + mode + '\\' is invalid');\n    }\n\n    if (editor.initialized) {\n      switchToMode(editor, activeMode, availableModes, mode);\n    } else {\n      editor.on('init', function () {\n        return switchToMode(editor, activeMode, availableModes, mode);\n      });\n    }\n  };\n\n  var registerMode = function (availableModes, mode, api) {\n    var _a;\n\n    if (contains(defaultModes, mode)) {\n      throw new Error('Cannot override default mode ' + mode);\n    }\n\n    return __assign(__assign({}, availableModes), (_a = {}, _a[mode] = __assign(__assign({}, api), {\n      deactivate: function () {\n        try {\n          api.deactivate();\n        } catch (e) {\n          console.error('problem while deactivating editor mode ' + mode + ':', e);\n        }\n      }\n    }), _a));\n  };\n\n  var create$5 = function (editor) {\n    var activeMode = Cell('design');\n    var availableModes = Cell({\n      design: {\n        activate: noop,\n        deactivate: noop,\n        editorReadOnly: false\n      },\n      readonly: {\n        activate: noop,\n        deactivate: noop,\n        editorReadOnly: true\n      }\n    });\n    registerReadOnlyContentFilters(editor);\n    registerReadOnlySelectionBlockers(editor);\n    return {\n      isReadOnly: function () {\n        return isReadOnly$1(editor);\n      },\n      set: function (mode) {\n        return setMode(editor, availableModes.get(), activeMode, mode);\n      },\n      get: function () {\n        return activeMode.get();\n      },\n      register: function (mode, api) {\n        availableModes.set(registerMode(availableModes.get(), mode, api));\n      }\n    };\n  };\n\n  var each$g = Tools.each,\n      explode$3 = Tools.explode;\n  var keyCodeLookup = {\n    f1: 112,\n    f2: 113,\n    f3: 114,\n    f4: 115,\n    f5: 116,\n    f6: 117,\n    f7: 118,\n    f8: 119,\n    f9: 120,\n    f10: 121,\n    f11: 122,\n    f12: 123\n  };\n  var modifierNames = Tools.makeMap('alt,ctrl,shift,meta,access');\n\n  var Shortcuts = function () {\n    function Shortcuts(editor) {\n      this.shortcuts = {};\n      this.pendingPatterns = [];\n      this.editor = editor;\n      var self = this;\n      editor.on('keyup keypress keydown', function (e) {\n        if ((self.hasModifier(e) || self.isFunctionKey(e)) && !e.isDefaultPrevented()) {\n          each$g(self.shortcuts, function (shortcut) {\n            if (self.matchShortcut(e, shortcut)) {\n              self.pendingPatterns = shortcut.subpatterns.slice(0);\n\n              if (e.type === 'keydown') {\n                self.executeShortcutAction(shortcut);\n              }\n\n              return true;\n            }\n          });\n\n          if (self.matchShortcut(e, self.pendingPatterns[0])) {\n            if (self.pendingPatterns.length === 1) {\n              if (e.type === 'keydown') {\n                self.executeShortcutAction(self.pendingPatterns[0]);\n              }\n            }\n\n            self.pendingPatterns.shift();\n          }\n        }\n      });\n    }\n\n    Shortcuts.prototype.add = function (pattern, desc, cmdFunc, scope) {\n      var self = this;\n      var func = self.normalizeCommandFunc(cmdFunc);\n      each$g(explode$3(Tools.trim(pattern)), function (pattern) {\n        var shortcut = self.createShortcut(pattern, desc, func, scope);\n        self.shortcuts[shortcut.id] = shortcut;\n      });\n      return true;\n    };\n\n    Shortcuts.prototype.remove = function (pattern) {\n      var shortcut = this.createShortcut(pattern);\n\n      if (this.shortcuts[shortcut.id]) {\n        delete this.shortcuts[shortcut.id];\n        return true;\n      }\n\n      return false;\n    };\n\n    Shortcuts.prototype.normalizeCommandFunc = function (cmdFunc) {\n      var self = this;\n      var cmd = cmdFunc;\n\n      if (typeof cmd === 'string') {\n        return function () {\n          self.editor.execCommand(cmd, false, null);\n        };\n      } else if (Tools.isArray(cmd)) {\n        return function () {\n          self.editor.execCommand(cmd[0], cmd[1], cmd[2]);\n        };\n      } else {\n        return cmd;\n      }\n    };\n\n    Shortcuts.prototype.parseShortcut = function (pattern) {\n      var key;\n      var shortcut = {};\n      each$g(explode$3(pattern.toLowerCase(), '+'), function (value) {\n        if (value in modifierNames) {\n          shortcut[value] = true;\n        } else {\n          if (/^[0-9]{2,}$/.test(value)) {\n            shortcut.keyCode = parseInt(value, 10);\n          } else {\n            shortcut.charCode = value.charCodeAt(0);\n            shortcut.keyCode = keyCodeLookup[value] || value.toUpperCase().charCodeAt(0);\n          }\n        }\n      });\n      var id = [shortcut.keyCode];\n\n      for (key in modifierNames) {\n        if (shortcut[key]) {\n          id.push(key);\n        } else {\n          shortcut[key] = false;\n        }\n      }\n\n      shortcut.id = id.join(',');\n\n      if (shortcut.access) {\n        shortcut.alt = true;\n\n        if (Env.mac) {\n          shortcut.ctrl = true;\n        } else {\n          shortcut.shift = true;\n        }\n      }\n\n      if (shortcut.meta) {\n        if (Env.mac) {\n          shortcut.meta = true;\n        } else {\n          shortcut.ctrl = true;\n          shortcut.meta = false;\n        }\n      }\n\n      return shortcut;\n    };\n\n    Shortcuts.prototype.createShortcut = function (pattern, desc, cmdFunc, scope) {\n      var shortcuts = Tools.map(explode$3(pattern, '>'), this.parseShortcut);\n      shortcuts[shortcuts.length - 1] = Tools.extend(shortcuts[shortcuts.length - 1], {\n        func: cmdFunc,\n        scope: scope || this.editor\n      });\n      return Tools.extend(shortcuts[0], {\n        desc: this.editor.translate(desc),\n        subpatterns: shortcuts.slice(1)\n      });\n    };\n\n    Shortcuts.prototype.hasModifier = function (e) {\n      return e.altKey || e.ctrlKey || e.metaKey;\n    };\n\n    Shortcuts.prototype.isFunctionKey = function (e) {\n      return e.type === 'keydown' && e.keyCode >= 112 && e.keyCode <= 123;\n    };\n\n    Shortcuts.prototype.matchShortcut = function (e, shortcut) {\n      if (!shortcut) {\n        return false;\n      }\n\n      if (shortcut.ctrl !== e.ctrlKey || shortcut.meta !== e.metaKey) {\n        return false;\n      }\n\n      if (shortcut.alt !== e.altKey || shortcut.shift !== e.shiftKey) {\n        return false;\n      }\n\n      if (e.keyCode === shortcut.keyCode || e.charCode && e.charCode === shortcut.charCode) {\n        e.preventDefault();\n        return true;\n      }\n\n      return false;\n    };\n\n    Shortcuts.prototype.executeShortcutAction = function (shortcut) {\n      return shortcut.func ? shortcut.func.call(shortcut.scope) : null;\n    };\n\n    return Shortcuts;\n  }();\n\n  var create$6 = function () {\n    var buttons = {};\n    var menuItems = {};\n    var popups = {};\n    var icons = {};\n    var contextMenus = {};\n    var contextToolbars = {};\n    var sidebars = {};\n\n    var add = function (collection, type) {\n      return function (name, spec) {\n        return collection[name.toLowerCase()] = __assign(__assign({}, spec), {\n          type: type\n        });\n      };\n    };\n\n    var addIcon = function (name, svgData) {\n      return icons[name.toLowerCase()] = svgData;\n    };\n\n    return {\n      addButton: add(buttons, 'button'),\n      addGroupToolbarButton: add(buttons, 'grouptoolbarbutton'),\n      addToggleButton: add(buttons, 'togglebutton'),\n      addMenuButton: add(buttons, 'menubutton'),\n      addSplitButton: add(buttons, 'splitbutton'),\n      addMenuItem: add(menuItems, 'menuitem'),\n      addNestedMenuItem: add(menuItems, 'nestedmenuitem'),\n      addToggleMenuItem: add(menuItems, 'togglemenuitem'),\n      addAutocompleter: add(popups, 'autocompleter'),\n      addContextMenu: add(contextMenus, 'contextmenu'),\n      addContextToolbar: add(contextToolbars, 'contexttoolbar'),\n      addContextForm: add(contextToolbars, 'contextform'),\n      addSidebar: add(sidebars, 'sidebar'),\n      addIcon: addIcon,\n      getAll: function () {\n        return {\n          buttons: buttons,\n          menuItems: menuItems,\n          icons: icons,\n          popups: popups,\n          contextMenus: contextMenus,\n          contextToolbars: contextToolbars,\n          sidebars: sidebars\n        };\n      }\n    };\n  };\n\n  var registry = function () {\n    var bridge = create$6();\n    return {\n      addAutocompleter: bridge.addAutocompleter,\n      addButton: bridge.addButton,\n      addContextForm: bridge.addContextForm,\n      addContextMenu: bridge.addContextMenu,\n      addContextToolbar: bridge.addContextToolbar,\n      addIcon: bridge.addIcon,\n      addMenuButton: bridge.addMenuButton,\n      addMenuItem: bridge.addMenuItem,\n      addNestedMenuItem: bridge.addNestedMenuItem,\n      addSidebar: bridge.addSidebar,\n      addSplitButton: bridge.addSplitButton,\n      addToggleButton: bridge.addToggleButton,\n      addGroupToolbarButton: bridge.addGroupToolbarButton,\n      addToggleMenuItem: bridge.addToggleMenuItem,\n      getAll: bridge.getAll\n    };\n  };\n\n  var each$h = Tools.each,\n      trim$4 = Tools.trim;\n  var queryParts = 'source protocol authority userInfo user password host port relative path directory file query anchor'.split(' ');\n  var DEFAULT_PORTS = {\n    ftp: 21,\n    http: 80,\n    https: 443,\n    mailto: 25\n  };\n\n  var URI = function () {\n    function URI(url, settings) {\n      url = trim$4(url);\n      this.settings = settings || {};\n      var baseUri = this.settings.base_uri;\n      var self = this;\n\n      if (/^([\\w\\-]+):([^\\/]{2})/i.test(url) || /^\\s*#/.test(url)) {\n        self.source = url;\n        return;\n      }\n\n      var isProtocolRelative = url.indexOf('//') === 0;\n\n      if (url.indexOf('/') === 0 && !isProtocolRelative) {\n        url = (baseUri ? baseUri.protocol || 'http' : 'http') + '://mce_host' + url;\n      }\n\n      if (!/^[\\w\\-]*:?\\/\\//.test(url)) {\n        var baseUrl = this.settings.base_uri ? this.settings.base_uri.path : new URI(document.location.href).directory;\n\n        if (this.settings.base_uri && this.settings.base_uri.protocol == '') {\n          url = '//mce_host' + self.toAbsPath(baseUrl, url);\n        } else {\n          var match = /([^#?]*)([#?]?.*)/.exec(url);\n          url = (baseUri && baseUri.protocol || 'http') + '://mce_host' + self.toAbsPath(baseUrl, match[1]) + match[2];\n        }\n      }\n\n      url = url.replace(/@@/g, '(mce_at)');\n      var urlMatch = /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@\\/]*):?([^:@\\/]*))?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/.exec(url);\n      each$h(queryParts, function (v, i) {\n        var part = urlMatch[i];\n\n        if (part) {\n          part = part.replace(/\\(mce_at\\)/g, '@@');\n        }\n\n        self[v] = part;\n      });\n\n      if (baseUri) {\n        if (!self.protocol) {\n          self.protocol = baseUri.protocol;\n        }\n\n        if (!self.userInfo) {\n          self.userInfo = baseUri.userInfo;\n        }\n\n        if (!self.port && self.host === 'mce_host') {\n          self.port = baseUri.port;\n        }\n\n        if (!self.host || self.host === 'mce_host') {\n          self.host = baseUri.host;\n        }\n\n        self.source = '';\n      }\n\n      if (isProtocolRelative) {\n        self.protocol = '';\n      }\n    }\n\n    URI.parseDataUri = function (uri) {\n      var type;\n      var uriComponents = decodeURIComponent(uri).split(',');\n      var matches = /data:([^;]+)/.exec(uriComponents[0]);\n\n      if (matches) {\n        type = matches[1];\n      }\n\n      return {\n        type: type,\n        data: uriComponents[1]\n      };\n    };\n\n    URI.getDocumentBaseUrl = function (loc) {\n      var baseUrl;\n\n      if (loc.protocol.indexOf('http') !== 0 && loc.protocol !== 'file:') {\n        baseUrl = loc.href;\n      } else {\n        baseUrl = loc.protocol + '//' + loc.host + loc.pathname;\n      }\n\n      if (/^[^:]+:\\/\\/\\/?[^\\/]+\\//.test(baseUrl)) {\n        baseUrl = baseUrl.replace(/[\\?#].*$/, '').replace(/[\\/\\\\][^\\/]+$/, '');\n\n        if (!/[\\/\\\\]$/.test(baseUrl)) {\n          baseUrl += '/';\n        }\n      }\n\n      return baseUrl;\n    };\n\n    URI.prototype.setPath = function (path) {\n      var pathMatch = /^(.*?)\\/?(\\w+)?$/.exec(path);\n      this.path = pathMatch[0];\n      this.directory = pathMatch[1];\n      this.file = pathMatch[2];\n      this.source = '';\n      this.getURI();\n    };\n\n    URI.prototype.toRelative = function (uri) {\n      var output;\n\n      if (uri === './') {\n        return uri;\n      }\n\n      var relativeUri = new URI(uri, {\n        base_uri: this\n      });\n\n      if (relativeUri.host !== 'mce_host' && this.host !== relativeUri.host && relativeUri.host || this.port !== relativeUri.port || this.protocol !== relativeUri.protocol && relativeUri.protocol !== '') {\n        return relativeUri.getURI();\n      }\n\n      var tu = this.getURI(),\n          uu = relativeUri.getURI();\n\n      if (tu === uu || tu.charAt(tu.length - 1) === '/' && tu.substr(0, tu.length - 1) === uu) {\n        return tu;\n      }\n\n      output = this.toRelPath(this.path, relativeUri.path);\n\n      if (relativeUri.query) {\n        output += '?' + relativeUri.query;\n      }\n\n      if (relativeUri.anchor) {\n        output += '#' + relativeUri.anchor;\n      }\n\n      return output;\n    };\n\n    URI.prototype.toAbsolute = function (uri, noHost) {\n      var absoluteUri = new URI(uri, {\n        base_uri: this\n      });\n      return absoluteUri.getURI(noHost && this.isSameOrigin(absoluteUri));\n    };\n\n    URI.prototype.isSameOrigin = function (uri) {\n      if (this.host == uri.host && this.protocol == uri.protocol) {\n        if (this.port == uri.port) {\n          return true;\n        }\n\n        var defaultPort = DEFAULT_PORTS[this.protocol];\n\n        if (defaultPort && (this.port || defaultPort) == (uri.port || defaultPort)) {\n          return true;\n        }\n      }\n\n      return false;\n    };\n\n    URI.prototype.toRelPath = function (base, path) {\n      var breakPoint = 0,\n          out = '',\n          i,\n          l;\n      var normalizedBase = base.substring(0, base.lastIndexOf('/')).split('/');\n      var items = path.split('/');\n\n      if (normalizedBase.length >= items.length) {\n        for (i = 0, l = normalizedBase.length; i < l; i++) {\n          if (i >= items.length || normalizedBase[i] !== items[i]) {\n            breakPoint = i + 1;\n            break;\n          }\n        }\n      }\n\n      if (normalizedBase.length < items.length) {\n        for (i = 0, l = items.length; i < l; i++) {\n          if (i >= normalizedBase.length || normalizedBase[i] !== items[i]) {\n            breakPoint = i + 1;\n            break;\n          }\n        }\n      }\n\n      if (breakPoint === 1) {\n        return path;\n      }\n\n      for (i = 0, l = normalizedBase.length - (breakPoint - 1); i < l; i++) {\n        out += '../';\n      }\n\n      for (i = breakPoint - 1, l = items.length; i < l; i++) {\n        if (i !== breakPoint - 1) {\n          out += '/' + items[i];\n        } else {\n          out += items[i];\n        }\n      }\n\n      return out;\n    };\n\n    URI.prototype.toAbsPath = function (base, path) {\n      var i,\n          nb = 0,\n          o = [],\n          outPath;\n      var tr = /\\/$/.test(path) ? '/' : '';\n      var normalizedBase = base.split('/');\n      var normalizedPath = path.split('/');\n      each$h(normalizedBase, function (k) {\n        if (k) {\n          o.push(k);\n        }\n      });\n      normalizedBase = o;\n\n      for (i = normalizedPath.length - 1, o = []; i >= 0; i--) {\n        if (normalizedPath[i].length === 0 || normalizedPath[i] === '.') {\n          continue;\n        }\n\n        if (normalizedPath[i] === '..') {\n          nb++;\n          continue;\n        }\n\n        if (nb > 0) {\n          nb--;\n          continue;\n        }\n\n        o.push(normalizedPath[i]);\n      }\n\n      i = normalizedBase.length - nb;\n\n      if (i <= 0) {\n        outPath = reverse(o).join('/');\n      } else {\n        outPath = normalizedBase.slice(0, i).join('/') + '/' + reverse(o).join('/');\n      }\n\n      if (outPath.indexOf('/') !== 0) {\n        outPath = '/' + outPath;\n      }\n\n      if (tr && outPath.lastIndexOf('/') !== outPath.length - 1) {\n        outPath += tr;\n      }\n\n      return outPath;\n    };\n\n    URI.prototype.getURI = function (noProtoHost) {\n      if (noProtoHost === void 0) {\n        noProtoHost = false;\n      }\n\n      var s;\n\n      if (!this.source || noProtoHost) {\n        s = '';\n\n        if (!noProtoHost) {\n          if (this.protocol) {\n            s += this.protocol + '://';\n          } else {\n            s += '//';\n          }\n\n          if (this.userInfo) {\n            s += this.userInfo + '@';\n          }\n\n          if (this.host) {\n            s += this.host;\n          }\n\n          if (this.port) {\n            s += ':' + this.port;\n          }\n        }\n\n        if (this.path) {\n          s += this.path;\n        }\n\n        if (this.query) {\n          s += '?' + this.query;\n        }\n\n        if (this.anchor) {\n          s += '#' + this.anchor;\n        }\n\n        this.source = s;\n      }\n\n      return this.source;\n    };\n\n    return URI;\n  }();\n\n  var DOM$9 = DOMUtils$1.DOM;\n  var extend$3 = Tools.extend,\n      each$i = Tools.each;\n  var resolve$3 = Tools.resolve;\n  var ie$1 = Env.ie;\n\n  var Editor = function () {\n    function Editor(id, settings, editorManager) {\n      var _this = this;\n\n      this.plugins = {};\n      this.contentCSS = [];\n      this.contentStyles = [];\n      this.loadedCSS = {};\n      this.isNotDirty = false;\n      this.editorManager = editorManager;\n      this.documentBaseUrl = editorManager.documentBaseURL;\n      extend$3(this, EditorObservable);\n      this.settings = getEditorSettings(this, id, this.documentBaseUrl, editorManager.defaultSettings, settings);\n\n      if (this.settings.suffix) {\n        editorManager.suffix = this.settings.suffix;\n      }\n\n      this.suffix = editorManager.suffix;\n\n      if (this.settings.base_url) {\n        editorManager._setBaseUrl(this.settings.base_url);\n      }\n\n      this.baseUri = editorManager.baseURI;\n\n      if (this.settings.referrer_policy) {\n        ScriptLoader.ScriptLoader._setReferrerPolicy(this.settings.referrer_policy);\n\n        DOMUtils$1.DOM.styleSheetLoader._setReferrerPolicy(this.settings.referrer_policy);\n      }\n\n      AddOnManager$1.languageLoad = this.settings.language_load;\n      AddOnManager$1.baseURL = editorManager.baseURL;\n      this.id = id;\n      this.setDirty(false);\n      this.documentBaseURI = new URI(this.settings.document_base_url, {\n        base_uri: this.baseUri\n      });\n      this.baseURI = this.baseUri;\n      this.inline = !!this.settings.inline;\n      this.shortcuts = new Shortcuts(this);\n      this.editorCommands = new EditorCommands(this);\n\n      if (this.settings.cache_suffix) {\n        Env.cacheSuffix = this.settings.cache_suffix.replace(/^[\\?\\&]+/, '');\n      }\n\n      this.ui = {\n        registry: registry(),\n        styleSheetLoader: undefined,\n        show: noop,\n        hide: noop\n      };\n      var self = this;\n      var modeInstance = create$5(self);\n      this.mode = modeInstance;\n      this.setMode = modeInstance.set;\n      editorManager.fire('SetupEditor', {\n        editor: this\n      });\n      this.execCallback('setup', this);\n      this.$ = DomQuery.overrideDefaults(function () {\n        return {\n          context: _this.inline ? _this.getBody() : _this.getDoc(),\n          element: _this.getBody()\n        };\n      });\n    }\n\n    Editor.prototype.render = function () {\n      render(this);\n    };\n\n    Editor.prototype.focus = function (skipFocus) {\n      focus$1(this, skipFocus);\n    };\n\n    Editor.prototype.hasFocus = function () {\n      return hasFocus$1(this);\n    };\n\n    Editor.prototype.execCallback = function (name) {\n      var x = [];\n\n      for (var _i = 1; _i < arguments.length; _i++) {\n        x[_i - 1] = arguments[_i];\n      }\n\n      var self = this;\n      var callback = self.settings[name],\n          scope;\n\n      if (!callback) {\n        return;\n      }\n\n      if (self.callbackLookup && (scope = self.callbackLookup[name])) {\n        callback = scope.func;\n        scope = scope.scope;\n      }\n\n      if (typeof callback === 'string') {\n        scope = callback.replace(/\\.\\w+$/, '');\n        scope = scope ? resolve$3(scope) : 0;\n        callback = resolve$3(callback);\n        self.callbackLookup = self.callbackLookup || {};\n        self.callbackLookup[name] = {\n          func: callback,\n          scope: scope\n        };\n      }\n\n      return callback.apply(scope || self, x);\n    };\n\n    Editor.prototype.translate = function (text) {\n      return I18n.translate(text);\n    };\n\n    Editor.prototype.getParam = function (name, defaultVal, type) {\n      return getParam(this, name, defaultVal, type);\n    };\n\n    Editor.prototype.hasPlugin = function (name, loaded) {\n      var hasPlugin = contains(getPlugins(this).split(/[ ,]/), name);\n\n      if (hasPlugin) {\n        return loaded ? PluginManager.get(name) !== undefined : true;\n      } else {\n        return false;\n      }\n    };\n\n    Editor.prototype.nodeChanged = function (args) {\n      this._nodeChangeDispatcher.nodeChanged(args);\n    };\n\n    Editor.prototype.addCommand = function (name, callback, scope) {\n      this.editorCommands.addCommand(name, callback, scope);\n    };\n\n    Editor.prototype.addQueryStateHandler = function (name, callback, scope) {\n      this.editorCommands.addQueryStateHandler(name, callback, scope);\n    };\n\n    Editor.prototype.addQueryValueHandler = function (name, callback, scope) {\n      this.editorCommands.addQueryValueHandler(name, callback, scope);\n    };\n\n    Editor.prototype.addShortcut = function (pattern, desc, cmdFunc, scope) {\n      this.shortcuts.add(pattern, desc, cmdFunc, scope);\n    };\n\n    Editor.prototype.execCommand = function (cmd, ui, value, args) {\n      return this.editorCommands.execCommand(cmd, ui, value, args);\n    };\n\n    Editor.prototype.queryCommandState = function (cmd) {\n      return this.editorCommands.queryCommandState(cmd);\n    };\n\n    Editor.prototype.queryCommandValue = function (cmd) {\n      return this.editorCommands.queryCommandValue(cmd);\n    };\n\n    Editor.prototype.queryCommandSupported = function (cmd) {\n      return this.editorCommands.queryCommandSupported(cmd);\n    };\n\n    Editor.prototype.show = function () {\n      var self = this;\n\n      if (self.hidden) {\n        self.hidden = false;\n\n        if (self.inline) {\n          self.getBody().contentEditable = 'true';\n        } else {\n          DOM$9.show(self.getContainer());\n          DOM$9.hide(self.id);\n        }\n\n        self.load();\n        self.fire('show');\n      }\n    };\n\n    Editor.prototype.hide = function () {\n      var self = this,\n          doc = self.getDoc();\n\n      if (!self.hidden) {\n        if (ie$1 && doc && !self.inline) {\n          doc.execCommand('SelectAll');\n        }\n\n        self.save();\n\n        if (self.inline) {\n          self.getBody().contentEditable = 'false';\n\n          if (self === self.editorManager.focusedEditor) {\n            self.editorManager.focusedEditor = null;\n          }\n        } else {\n          DOM$9.hide(self.getContainer());\n          DOM$9.setStyle(self.id, 'display', self.orgDisplay);\n        }\n\n        self.hidden = true;\n        self.fire('hide');\n      }\n    };\n\n    Editor.prototype.isHidden = function () {\n      return !!this.hidden;\n    };\n\n    Editor.prototype.setProgressState = function (state, time) {\n      this.fire('ProgressState', {\n        state: state,\n        time: time\n      });\n    };\n\n    Editor.prototype.load = function (args) {\n      var self = this;\n      var elm = self.getElement(),\n          html;\n\n      if (self.removed) {\n        return '';\n      }\n\n      if (elm) {\n        args = args || {};\n        args.load = true;\n        var value = isTextareaOrInput(elm) ? elm.value : elm.innerHTML;\n        html = self.setContent(value, args);\n        args.element = elm;\n\n        if (!args.no_events) {\n          self.fire('LoadContent', args);\n        }\n\n        args.element = elm = null;\n        return html;\n      }\n    };\n\n    Editor.prototype.save = function (args) {\n      var self = this;\n      var elm = self.getElement(),\n          html,\n          form;\n\n      if (!elm || !self.initialized || self.removed) {\n        return;\n      }\n\n      args = args || {};\n      args.save = true;\n      args.element = elm;\n      html = args.content = self.getContent(args);\n\n      if (!args.no_events) {\n        self.fire('SaveContent', args);\n      }\n\n      if (args.format === 'raw') {\n        self.fire('RawSaveContent', args);\n      }\n\n      html = args.content;\n\n      if (!isTextareaOrInput(elm)) {\n        if (args.is_removing || !self.inline) {\n          elm.innerHTML = html;\n        }\n\n        if (form = DOM$9.getParent(self.id, 'form')) {\n          each$i(form.elements, function (elm) {\n            if (elm.name === self.id) {\n              elm.value = html;\n              return false;\n            }\n          });\n        }\n      } else {\n        elm.value = html;\n      }\n\n      args.element = elm = null;\n\n      if (args.set_dirty !== false) {\n        self.setDirty(false);\n      }\n\n      return html;\n    };\n\n    Editor.prototype.setContent = function (content, args) {\n      return setContent$2(this, content, args);\n    };\n\n    Editor.prototype.getContent = function (args) {\n      return getContent$2(this, args);\n    };\n\n    Editor.prototype.insertContent = function (content, args) {\n      if (args) {\n        content = extend$3({\n          content: content\n        }, args);\n      }\n\n      this.execCommand('mceInsertContent', false, content);\n    };\n\n    Editor.prototype.resetContent = function (initialContent) {\n      if (initialContent === undefined) {\n        setContent$2(this, this.startContent, {\n          format: 'raw'\n        });\n      } else {\n        setContent$2(this, initialContent);\n      }\n\n      this.undoManager.reset();\n      this.setDirty(false);\n      this.nodeChanged();\n    };\n\n    Editor.prototype.isDirty = function () {\n      return !this.isNotDirty;\n    };\n\n    Editor.prototype.setDirty = function (state) {\n      var oldState = !this.isNotDirty;\n      this.isNotDirty = !state;\n\n      if (state && state !== oldState) {\n        this.fire('dirty');\n      }\n    };\n\n    Editor.prototype.getContainer = function () {\n      var self = this;\n\n      if (!self.container) {\n        self.container = DOM$9.get(self.editorContainer || self.id + '_parent');\n      }\n\n      return self.container;\n    };\n\n    Editor.prototype.getContentAreaContainer = function () {\n      return this.contentAreaContainer;\n    };\n\n    Editor.prototype.getElement = function () {\n      if (!this.targetElm) {\n        this.targetElm = DOM$9.get(this.id);\n      }\n\n      return this.targetElm;\n    };\n\n    Editor.prototype.getWin = function () {\n      var self = this;\n      var elm;\n\n      if (!self.contentWindow) {\n        elm = self.iframeElement;\n\n        if (elm) {\n          self.contentWindow = elm.contentWindow;\n        }\n      }\n\n      return self.contentWindow;\n    };\n\n    Editor.prototype.getDoc = function () {\n      var self = this;\n      var win;\n\n      if (!self.contentDocument) {\n        win = self.getWin();\n\n        if (win) {\n          self.contentDocument = win.document;\n        }\n      }\n\n      return self.contentDocument;\n    };\n\n    Editor.prototype.getBody = function () {\n      var doc = this.getDoc();\n      return this.bodyElement || (doc ? doc.body : null);\n    };\n\n    Editor.prototype.convertURL = function (url, name, elm) {\n      var self = this,\n          settings = self.settings;\n\n      if (settings.urlconverter_callback) {\n        return self.execCallback('urlconverter_callback', url, elm, true, name);\n      }\n\n      if (!settings.convert_urls || elm && elm.nodeName === 'LINK' || url.indexOf('file:') === 0 || url.length === 0) {\n        return url;\n      }\n\n      if (settings.relative_urls) {\n        return self.documentBaseURI.toRelative(url);\n      }\n\n      url = self.documentBaseURI.toAbsolute(url, settings.remove_script_host);\n      return url;\n    };\n\n    Editor.prototype.addVisual = function (elm) {\n      var self = this;\n      var settings = self.settings;\n      var dom = self.dom;\n      var cls;\n      elm = elm || self.getBody();\n\n      if (self.hasVisual === undefined) {\n        self.hasVisual = settings.visual;\n      }\n\n      each$i(dom.select('table,a', elm), function (elm) {\n        var value;\n\n        switch (elm.nodeName) {\n          case 'TABLE':\n            cls = settings.visual_table_class || 'mce-item-table';\n            value = dom.getAttrib(elm, 'border');\n\n            if ((!value || value === '0') && self.hasVisual) {\n              dom.addClass(elm, cls);\n            } else {\n              dom.removeClass(elm, cls);\n            }\n\n            return;\n\n          case 'A':\n            if (!dom.getAttrib(elm, 'href')) {\n              value = dom.getAttrib(elm, 'name') || elm.id;\n              cls = settings.visual_anchor_class || 'mce-item-anchor';\n\n              if (value && self.hasVisual) {\n                dom.addClass(elm, cls);\n              } else {\n                dom.removeClass(elm, cls);\n              }\n            }\n\n            return;\n        }\n      });\n      self.fire('VisualAid', {\n        element: elm,\n        hasVisual: self.hasVisual\n      });\n    };\n\n    Editor.prototype.remove = function () {\n      remove$7(this);\n    };\n\n    Editor.prototype.destroy = function (automatic) {\n      destroy(this, automatic);\n    };\n\n    Editor.prototype.uploadImages = function (callback) {\n      return this.editorUpload.uploadImages(callback);\n    };\n\n    Editor.prototype._scanForImages = function () {\n      return this.editorUpload.scanForImages();\n    };\n\n    Editor.prototype.addButton = function () {\n      throw new Error('editor.addButton has been removed in tinymce 5x, use editor.ui.registry.addButton or editor.ui.registry.addToggleButton or editor.ui.registry.addSplitButton instead');\n    };\n\n    Editor.prototype.addSidebar = function () {\n      throw new Error('editor.addSidebar has been removed in tinymce 5x, use editor.ui.registry.addSidebar instead');\n    };\n\n    Editor.prototype.addMenuItem = function () {\n      throw new Error('editor.addMenuItem has been removed in tinymce 5x, use editor.ui.registry.addMenuItem instead');\n    };\n\n    Editor.prototype.addContextToolbar = function () {\n      throw new Error('editor.addContextToolbar has been removed in tinymce 5x, use editor.ui.registry.addContextToolbar instead');\n    };\n\n    return Editor;\n  }();\n\n  var DOM$a = DOMUtils$1.DOM;\n  var explode$4 = Tools.explode,\n      each$j = Tools.each,\n      extend$4 = Tools.extend;\n  var instanceCounter = 0,\n      boundGlobalEvents = false;\n  var beforeUnloadDelegate;\n  var legacyEditors = [];\n  var editors = [];\n\n  var isValidLegacyKey = function (id) {\n    return id !== 'length';\n  };\n\n  var globalEventDelegate = function (e) {\n    var type = e.type;\n    each$j(EditorManager.get(), function (editor) {\n      switch (type) {\n        case 'scroll':\n          editor.fire('ScrollWindow', e);\n          break;\n\n        case 'resize':\n          editor.fire('ResizeWindow', e);\n          break;\n      }\n    });\n  };\n\n  var toggleGlobalEvents = function (state) {\n    if (state !== boundGlobalEvents) {\n      if (state) {\n        DomQuery(window).on('resize scroll', globalEventDelegate);\n      } else {\n        DomQuery(window).off('resize scroll', globalEventDelegate);\n      }\n\n      boundGlobalEvents = state;\n    }\n  };\n\n  var removeEditorFromList = function (targetEditor) {\n    var oldEditors = editors;\n    delete legacyEditors[targetEditor.id];\n\n    for (var i = 0; i < legacyEditors.length; i++) {\n      if (legacyEditors[i] === targetEditor) {\n        legacyEditors.splice(i, 1);\n        break;\n      }\n    }\n\n    editors = filter(editors, function (editor) {\n      return targetEditor !== editor;\n    });\n\n    if (EditorManager.activeEditor === targetEditor) {\n      EditorManager.activeEditor = editors.length > 0 ? editors[0] : null;\n    }\n\n    if (EditorManager.focusedEditor === targetEditor) {\n      EditorManager.focusedEditor = null;\n    }\n\n    return oldEditors.length !== editors.length;\n  };\n\n  var purgeDestroyedEditor = function (editor) {\n    if (editor && editor.initialized && !(editor.getContainer() || editor.getBody()).parentNode) {\n      removeEditorFromList(editor);\n      editor.unbindAllNativeEvents();\n      editor.destroy(true);\n      editor.removed = true;\n      editor = null;\n    }\n\n    return editor;\n  };\n\n  var isQuirksMode = document.compatMode !== 'CSS1Compat';\n\n  var EditorManager = __assign(__assign({}, Observable), {\n    baseURI: null,\n    baseURL: null,\n    defaultSettings: {},\n    documentBaseURL: null,\n    suffix: null,\n    $: DomQuery,\n    majorVersion: '5',\n    minorVersion: '5.1',\n    releaseDate: '2020-10-01',\n    editors: legacyEditors,\n    i18n: I18n,\n    activeEditor: null,\n    focusedEditor: null,\n    settings: {},\n    setup: function () {\n      var self = this;\n      var baseURL,\n          documentBaseURL,\n          suffix = '';\n      documentBaseURL = URI.getDocumentBaseUrl(document.location);\n\n      if (/^[^:]+:\\/\\/\\/?[^\\/]+\\//.test(documentBaseURL)) {\n        documentBaseURL = documentBaseURL.replace(/[\\?#].*$/, '').replace(/[\\/\\\\][^\\/]+$/, '');\n\n        if (!/[\\/\\\\]$/.test(documentBaseURL)) {\n          documentBaseURL += '/';\n        }\n      }\n\n      var preInit = window.tinymce || window.tinyMCEPreInit;\n\n      if (preInit) {\n        baseURL = preInit.base || preInit.baseURL;\n        suffix = preInit.suffix;\n      } else {\n        var scripts = document.getElementsByTagName('script');\n\n        for (var i = 0; i < scripts.length; i++) {\n          var src = scripts[i].src || '';\n\n          if (src === '') {\n            continue;\n          }\n\n          var srcScript = src.substring(src.lastIndexOf('/'));\n\n          if (/tinymce(\\.full|\\.jquery|)(\\.min|\\.dev|)\\.js/.test(src)) {\n            if (srcScript.indexOf('.min') !== -1) {\n              suffix = '.min';\n            }\n\n            baseURL = src.substring(0, src.lastIndexOf('/'));\n            break;\n          }\n        }\n\n        if (!baseURL && document.currentScript) {\n          var src = document.currentScript.src;\n\n          if (src.indexOf('.min') !== -1) {\n            suffix = '.min';\n          }\n\n          baseURL = src.substring(0, src.lastIndexOf('/'));\n        }\n      }\n\n      self.baseURL = new URI(documentBaseURL).toAbsolute(baseURL);\n      self.documentBaseURL = documentBaseURL;\n      self.baseURI = new URI(self.baseURL);\n      self.suffix = suffix;\n      setup$2(self);\n    },\n    overrideDefaults: function (defaultSettings) {\n      var baseUrl = defaultSettings.base_url;\n\n      if (baseUrl) {\n        this._setBaseUrl(baseUrl);\n      }\n\n      var suffix = defaultSettings.suffix;\n\n      if (defaultSettings.suffix) {\n        this.suffix = suffix;\n      }\n\n      this.defaultSettings = defaultSettings;\n      var pluginBaseUrls = defaultSettings.plugin_base_urls;\n\n      if (pluginBaseUrls !== undefined) {\n        each$1(pluginBaseUrls, function (pluginBaseUrl, pluginName) {\n          AddOnManager$1.PluginManager.urls[pluginName] = pluginBaseUrl;\n        });\n      }\n    },\n    init: function (settings) {\n      var self = this;\n      var result;\n      var invalidInlineTargets = Tools.makeMap('area base basefont br col frame hr img input isindex link meta param embed source wbr track ' + 'colgroup option table tbody tfoot thead tr th td script noscript style textarea video audio iframe object menu', ' ');\n\n      var isInvalidInlineTarget = function (settings, elm) {\n        return settings.inline && elm.tagName.toLowerCase() in invalidInlineTargets;\n      };\n\n      var createId = function (elm) {\n        var id = elm.id;\n\n        if (!id) {\n          id = get(elm, 'name').filter(function (name) {\n            return !DOM$a.get(name);\n          }).getOrThunk(DOM$a.uniqueId);\n          elm.setAttribute('id', id);\n        }\n\n        return id;\n      };\n\n      var execCallback = function (name) {\n        var callback = settings[name];\n\n        if (!callback) {\n          return;\n        }\n\n        return callback.apply(self, Array.prototype.slice.call(arguments, 2));\n      };\n\n      var hasClass = function (elm, className) {\n        return className.constructor === RegExp ? className.test(elm.className) : DOM$a.hasClass(elm, className);\n      };\n\n      var findTargets = function (settings) {\n        var targets = [];\n\n        if (Env.browser.isIE() && Env.browser.version.major < 11) {\n          initError('TinyMCE does not support the browser you are using. For a list of supported' + ' browsers please see: https://www.tinymce.com/docs/get-started/system-requirements/');\n          return [];\n        } else if (isQuirksMode) {\n          initError('Failed to initialize the editor as the document is not in standards mode. ' + 'TinyMCE requires standards mode.');\n          return [];\n        }\n\n        if (settings.types) {\n          each$j(settings.types, function (type) {\n            targets = targets.concat(DOM$a.select(type.selector));\n          });\n          return targets;\n        } else if (settings.selector) {\n          return DOM$a.select(settings.selector);\n        } else if (settings.target) {\n          return [settings.target];\n        }\n\n        switch (settings.mode) {\n          case 'exact':\n            var l = settings.elements || '';\n\n            if (l.length > 0) {\n              each$j(explode$4(l), function (id) {\n                var elm = DOM$a.get(id);\n\n                if (elm) {\n                  targets.push(elm);\n                } else {\n                  each$j(document.forms, function (f) {\n                    each$j(f.elements, function (e) {\n                      if (e.name === id) {\n                        id = 'mce_editor_' + instanceCounter++;\n                        DOM$a.setAttrib(e, 'id', id);\n                        targets.push(e);\n                      }\n                    });\n                  });\n                }\n              });\n            }\n\n            break;\n\n          case 'textareas':\n          case 'specific_textareas':\n            each$j(DOM$a.select('textarea'), function (elm) {\n              if (settings.editor_deselector && hasClass(elm, settings.editor_deselector)) {\n                return;\n              }\n\n              if (!settings.editor_selector || hasClass(elm, settings.editor_selector)) {\n                targets.push(elm);\n              }\n            });\n            break;\n        }\n\n        return targets;\n      };\n\n      var provideResults = function (editors) {\n        result = editors;\n      };\n\n      var initEditors = function () {\n        var initCount = 0;\n        var editors = [];\n        var targets;\n\n        var createEditor = function (id, settings, targetElm) {\n          var editor = new Editor(id, settings, self);\n          editors.push(editor);\n          editor.on('init', function () {\n            if (++initCount === targets.length) {\n              provideResults(editors);\n            }\n          });\n          editor.targetElm = editor.targetElm || targetElm;\n          editor.render();\n        };\n\n        DOM$a.unbind(window, 'ready', initEditors);\n        execCallback('onpageload');\n        targets = DomQuery.unique(findTargets(settings));\n\n        if (settings.types) {\n          each$j(settings.types, function (type) {\n            Tools.each(targets, function (elm) {\n              if (DOM$a.is(elm, type.selector)) {\n                createEditor(createId(elm), extend$4({}, settings, type), elm);\n                return false;\n              }\n\n              return true;\n            });\n          });\n          return;\n        }\n\n        Tools.each(targets, function (elm) {\n          purgeDestroyedEditor(self.get(elm.id));\n        });\n        targets = Tools.grep(targets, function (elm) {\n          return !self.get(elm.id);\n        });\n\n        if (targets.length === 0) {\n          provideResults([]);\n        } else {\n          each$j(targets, function (elm) {\n            if (isInvalidInlineTarget(settings, elm)) {\n              initError('Could not initialize inline editor on invalid inline target element', elm);\n            } else {\n              createEditor(createId(elm), settings, elm);\n            }\n          });\n        }\n      };\n\n      self.settings = settings;\n      DOM$a.bind(window, 'ready', initEditors);\n      return new promiseObj(function (resolve) {\n        if (result) {\n          resolve(result);\n        } else {\n          provideResults = function (editors) {\n            resolve(editors);\n          };\n        }\n      });\n    },\n    get: function (id) {\n      if (arguments.length === 0) {\n        return editors.slice(0);\n      } else if (isString(id)) {\n        return find(editors, function (editor) {\n          return editor.id === id;\n        }).getOr(null);\n      } else if (isNumber(id)) {\n        return editors[id] ? editors[id] : null;\n      } else {\n        return null;\n      }\n    },\n    add: function (editor) {\n      var self = this;\n      var existingEditor = legacyEditors[editor.id];\n\n      if (existingEditor === editor) {\n        return editor;\n      }\n\n      if (self.get(editor.id) === null) {\n        if (isValidLegacyKey(editor.id)) {\n          legacyEditors[editor.id] = editor;\n        }\n\n        legacyEditors.push(editor);\n        editors.push(editor);\n      }\n\n      toggleGlobalEvents(true);\n      self.activeEditor = editor;\n      self.fire('AddEditor', {\n        editor: editor\n      });\n\n      if (!beforeUnloadDelegate) {\n        beforeUnloadDelegate = function (e) {\n          var event = self.fire('BeforeUnload');\n\n          if (event.returnValue) {\n            e.preventDefault();\n            e.returnValue = event.returnValue;\n            return event.returnValue;\n          }\n        };\n\n        window.addEventListener('beforeunload', beforeUnloadDelegate);\n      }\n\n      return editor;\n    },\n    createEditor: function (id, settings) {\n      return this.add(new Editor(id, settings, this));\n    },\n    remove: function (selector) {\n      var self = this;\n      var i, editor;\n\n      if (!selector) {\n        for (i = editors.length - 1; i >= 0; i--) {\n          self.remove(editors[i]);\n        }\n\n        return;\n      }\n\n      if (isString(selector)) {\n        each$j(DOM$a.select(selector), function (elm) {\n          editor = self.get(elm.id);\n\n          if (editor) {\n            self.remove(editor);\n          }\n        });\n        return;\n      }\n\n      editor = selector;\n\n      if (isNull(self.get(editor.id))) {\n        return null;\n      }\n\n      if (removeEditorFromList(editor)) {\n        self.fire('RemoveEditor', {\n          editor: editor\n        });\n      }\n\n      if (editors.length === 0) {\n        window.removeEventListener('beforeunload', beforeUnloadDelegate);\n      }\n\n      editor.remove();\n      toggleGlobalEvents(editors.length > 0);\n      return editor;\n    },\n    execCommand: function (cmd, ui, value) {\n      var self = this,\n          editor = self.get(value);\n\n      switch (cmd) {\n        case 'mceAddEditor':\n          if (!self.get(value)) {\n            new Editor(value, self.settings, self).render();\n          }\n\n          return true;\n\n        case 'mceRemoveEditor':\n          if (editor) {\n            editor.remove();\n          }\n\n          return true;\n\n        case 'mceToggleEditor':\n          if (!editor) {\n            self.execCommand('mceAddEditor', 0, value);\n            return true;\n          }\n\n          if (editor.isHidden()) {\n            editor.show();\n          } else {\n            editor.hide();\n          }\n\n          return true;\n      }\n\n      if (self.activeEditor) {\n        return self.activeEditor.execCommand(cmd, ui, value);\n      }\n\n      return false;\n    },\n    triggerSave: function () {\n      each$j(editors, function (editor) {\n        editor.save();\n      });\n    },\n    addI18n: function (code, items) {\n      I18n.add(code, items);\n    },\n    translate: function (text) {\n      return I18n.translate(text);\n    },\n    setActive: function (editor) {\n      var activeEditor = this.activeEditor;\n\n      if (this.activeEditor !== editor) {\n        if (activeEditor) {\n          activeEditor.fire('deactivate', {\n            relatedTarget: editor\n          });\n        }\n\n        editor.fire('activate', {\n          relatedTarget: activeEditor\n        });\n      }\n\n      this.activeEditor = editor;\n    },\n    _setBaseUrl: function (baseUrl) {\n      this.baseURL = new URI(this.documentBaseURL).toAbsolute(baseUrl.replace(/\\/+$/, ''));\n      this.baseURI = new URI(this.baseURL);\n    }\n  });\n\n  EditorManager.setup();\n  var min = Math.min,\n      max = Math.max,\n      round$1 = Math.round;\n\n  var relativePosition = function (rect, targetRect, rel) {\n    var x = targetRect.x;\n    var y = targetRect.y;\n    var w = rect.w;\n    var h = rect.h;\n    var targetW = targetRect.w;\n    var targetH = targetRect.h;\n    var relChars = (rel || '').split('');\n\n    if (relChars[0] === 'b') {\n      y += targetH;\n    }\n\n    if (relChars[1] === 'r') {\n      x += targetW;\n    }\n\n    if (relChars[0] === 'c') {\n      y += round$1(targetH / 2);\n    }\n\n    if (relChars[1] === 'c') {\n      x += round$1(targetW / 2);\n    }\n\n    if (relChars[3] === 'b') {\n      y -= h;\n    }\n\n    if (relChars[4] === 'r') {\n      x -= w;\n    }\n\n    if (relChars[3] === 'c') {\n      y -= round$1(h / 2);\n    }\n\n    if (relChars[4] === 'c') {\n      x -= round$1(w / 2);\n    }\n\n    return create$7(x, y, w, h);\n  };\n\n  var findBestRelativePosition = function (rect, targetRect, constrainRect, rels) {\n    var pos, i;\n\n    for (i = 0; i < rels.length; i++) {\n      pos = relativePosition(rect, targetRect, rels[i]);\n\n      if (pos.x >= constrainRect.x && pos.x + pos.w <= constrainRect.w + constrainRect.x && pos.y >= constrainRect.y && pos.y + pos.h <= constrainRect.h + constrainRect.y) {\n        return rels[i];\n      }\n    }\n\n    return null;\n  };\n\n  var inflate = function (rect, w, h) {\n    return create$7(rect.x - w, rect.y - h, rect.w + w * 2, rect.h + h * 2);\n  };\n\n  var intersect = function (rect, cropRect) {\n    var x1 = max(rect.x, cropRect.x);\n    var y1 = max(rect.y, cropRect.y);\n    var x2 = min(rect.x + rect.w, cropRect.x + cropRect.w);\n    var y2 = min(rect.y + rect.h, cropRect.y + cropRect.h);\n\n    if (x2 - x1 < 0 || y2 - y1 < 0) {\n      return null;\n    }\n\n    return create$7(x1, y1, x2 - x1, y2 - y1);\n  };\n\n  var clamp$1 = function (rect, clampRect, fixedSize) {\n    var x1 = rect.x;\n    var y1 = rect.y;\n    var x2 = rect.x + rect.w;\n    var y2 = rect.y + rect.h;\n    var cx2 = clampRect.x + clampRect.w;\n    var cy2 = clampRect.y + clampRect.h;\n    var underflowX1 = max(0, clampRect.x - x1);\n    var underflowY1 = max(0, clampRect.y - y1);\n    var overflowX2 = max(0, x2 - cx2);\n    var overflowY2 = max(0, y2 - cy2);\n    x1 += underflowX1;\n    y1 += underflowY1;\n\n    if (fixedSize) {\n      x2 += underflowX1;\n      y2 += underflowY1;\n      x1 -= overflowX2;\n      y1 -= overflowY2;\n    }\n\n    x2 -= overflowX2;\n    y2 -= overflowY2;\n    return create$7(x1, y1, x2 - x1, y2 - y1);\n  };\n\n  var create$7 = function (x, y, w, h) {\n    return {\n      x: x,\n      y: y,\n      w: w,\n      h: h\n    };\n  };\n\n  var fromClientRect = function (clientRect) {\n    return create$7(clientRect.left, clientRect.top, clientRect.width, clientRect.height);\n  };\n\n  var Rect = {\n    inflate: inflate,\n    relativePosition: relativePosition,\n    findBestRelativePosition: findBestRelativePosition,\n    intersect: intersect,\n    clamp: clamp$1,\n    create: create$7,\n    fromClientRect: fromClientRect\n  };\n\n  var awaiter = function (resolveCb, rejectCb, timeout) {\n    if (timeout === void 0) {\n      timeout = 1000;\n    }\n\n    var done = false;\n    var timer = null;\n\n    var complete = function (completer) {\n      return function () {\n        var args = [];\n\n        for (var _i = 0; _i < arguments.length; _i++) {\n          args[_i] = arguments[_i];\n        }\n\n        if (!done) {\n          done = true;\n\n          if (timer !== null) {\n            clearTimeout(timer);\n            timer = null;\n          }\n\n          completer.apply(null, args);\n        }\n      };\n    };\n\n    var resolve = complete(resolveCb);\n    var reject = complete(rejectCb);\n\n    var start = function () {\n      var args = [];\n\n      for (var _i = 0; _i < arguments.length; _i++) {\n        args[_i] = arguments[_i];\n      }\n\n      if (!done && timer === null) {\n        timer = setTimeout(function () {\n          return reject.apply(null, args);\n        }, timeout);\n      }\n    };\n\n    return {\n      start: start,\n      resolve: resolve,\n      reject: reject\n    };\n  };\n\n  var create$8 = function () {\n    var tasks = {};\n    var resultFns = {};\n\n    var load = function (id, url) {\n      var loadErrMsg = 'Script at URL \"' + url + '\" failed to load';\n      var runErrMsg = 'Script at URL \"' + url + '\" did not call `tinymce.Resource.add(\\'' + id + '\\', data)` within 1 second';\n\n      if (tasks[id] !== undefined) {\n        return tasks[id];\n      } else {\n        var task = new promiseObj(function (resolve, reject) {\n          var waiter = awaiter(resolve, reject);\n          resultFns[id] = waiter.resolve;\n          ScriptLoader.ScriptLoader.loadScript(url, function () {\n            return waiter.start(runErrMsg);\n          }, function () {\n            return waiter.reject(loadErrMsg);\n          });\n        });\n        tasks[id] = task;\n        return task;\n      }\n    };\n\n    var add = function (id, data) {\n      if (resultFns[id] !== undefined) {\n        resultFns[id](data);\n        delete resultFns[id];\n      }\n\n      tasks[id] = promiseObj.resolve(data);\n    };\n\n    return {\n      load: load,\n      add: add\n    };\n  };\n\n  var Resource = create$8();\n  var each$k = Tools.each,\n      extend$5 = Tools.extend;\n  var extendClass, initializing;\n\n  var Class = function () {};\n\n  Class.extend = extendClass = function (props) {\n    var self = this;\n    var _super = self.prototype;\n\n    var Class = function () {\n      var i, mixins, mixin;\n      var self = this;\n\n      if (!initializing) {\n        if (self.init) {\n          self.init.apply(self, arguments);\n        }\n\n        mixins = self.Mixins;\n\n        if (mixins) {\n          i = mixins.length;\n\n          while (i--) {\n            mixin = mixins[i];\n\n            if (mixin.init) {\n              mixin.init.apply(self, arguments);\n            }\n          }\n        }\n      }\n    };\n\n    var dummy = function () {\n      return this;\n    };\n\n    var createMethod = function (name, fn) {\n      return function () {\n        var self = this;\n        var tmp = self._super;\n        self._super = _super[name];\n        var ret = fn.apply(self, arguments);\n        self._super = tmp;\n        return ret;\n      };\n    };\n\n    initializing = true;\n    var prototype = new self();\n    initializing = false;\n\n    if (props.Mixins) {\n      each$k(props.Mixins, function (mixin) {\n        for (var name_1 in mixin) {\n          if (name_1 !== 'init') {\n            props[name_1] = mixin[name_1];\n          }\n        }\n      });\n\n      if (_super.Mixins) {\n        props.Mixins = _super.Mixins.concat(props.Mixins);\n      }\n    }\n\n    if (props.Methods) {\n      each$k(props.Methods.split(','), function (name) {\n        props[name] = dummy;\n      });\n    }\n\n    if (props.Properties) {\n      each$k(props.Properties.split(','), function (name) {\n        var fieldName = '_' + name;\n\n        props[name] = function (value) {\n          var self = this;\n\n          if (value !== undefined) {\n            self[fieldName] = value;\n            return self;\n          }\n\n          return self[fieldName];\n        };\n      });\n    }\n\n    if (props.Statics) {\n      each$k(props.Statics, function (func, name) {\n        Class[name] = func;\n      });\n    }\n\n    if (props.Defaults && _super.Defaults) {\n      props.Defaults = extend$5({}, _super.Defaults, props.Defaults);\n    }\n\n    each$1(props, function (member, name) {\n      if (typeof member === 'function' && _super[name]) {\n        prototype[name] = createMethod(name, member);\n      } else {\n        prototype[name] = member;\n      }\n    });\n    Class.prototype = prototype;\n    Class.constructor = Class;\n    Class.extend = extendClass;\n    return Class;\n  };\n\n  var min$1 = Math.min,\n      max$1 = Math.max,\n      round$2 = Math.round;\n\n  var Color = function (value) {\n    var self = {};\n    var r = 0,\n        g = 0,\n        b = 0;\n\n    var rgb2hsv = function (r, g, b) {\n      var h, s, v;\n      h = 0;\n      s = 0;\n      v = 0;\n      r = r / 255;\n      g = g / 255;\n      b = b / 255;\n      var minRGB = min$1(r, min$1(g, b));\n      var maxRGB = max$1(r, max$1(g, b));\n\n      if (minRGB === maxRGB) {\n        v = minRGB;\n        return {\n          h: 0,\n          s: 0,\n          v: v * 100\n        };\n      }\n\n      var d = r === minRGB ? g - b : b === minRGB ? r - g : b - r;\n      h = r === minRGB ? 3 : b === minRGB ? 1 : 5;\n      h = 60 * (h - d / (maxRGB - minRGB));\n      s = (maxRGB - minRGB) / maxRGB;\n      v = maxRGB;\n      return {\n        h: round$2(h),\n        s: round$2(s * 100),\n        v: round$2(v * 100)\n      };\n    };\n\n    var hsvToRgb = function (hue, saturation, brightness) {\n      hue = (parseInt(hue, 10) || 0) % 360;\n      saturation = parseInt(saturation, 10) / 100;\n      brightness = parseInt(brightness, 10) / 100;\n      saturation = max$1(0, min$1(saturation, 1));\n      brightness = max$1(0, min$1(brightness, 1));\n\n      if (saturation === 0) {\n        r = g = b = round$2(255 * brightness);\n        return;\n      }\n\n      var side = hue / 60;\n      var chroma = brightness * saturation;\n      var x = chroma * (1 - Math.abs(side % 2 - 1));\n      var match = brightness - chroma;\n\n      switch (Math.floor(side)) {\n        case 0:\n          r = chroma;\n          g = x;\n          b = 0;\n          break;\n\n        case 1:\n          r = x;\n          g = chroma;\n          b = 0;\n          break;\n\n        case 2:\n          r = 0;\n          g = chroma;\n          b = x;\n          break;\n\n        case 3:\n          r = 0;\n          g = x;\n          b = chroma;\n          break;\n\n        case 4:\n          r = x;\n          g = 0;\n          b = chroma;\n          break;\n\n        case 5:\n          r = chroma;\n          g = 0;\n          b = x;\n          break;\n\n        default:\n          r = g = b = 0;\n      }\n\n      r = round$2(255 * (r + match));\n      g = round$2(255 * (g + match));\n      b = round$2(255 * (b + match));\n    };\n\n    var toHex = function () {\n      var hex = function (val) {\n        val = parseInt(val, 10).toString(16);\n        return val.length > 1 ? val : '0' + val;\n      };\n\n      return '#' + hex(r) + hex(g) + hex(b);\n    };\n\n    var toRgb = function () {\n      return {\n        r: r,\n        g: g,\n        b: b\n      };\n    };\n\n    var toHsv = function () {\n      return rgb2hsv(r, g, b);\n    };\n\n    var parse = function (value) {\n      var matches;\n\n      if (typeof value === 'object') {\n        if ('r' in value) {\n          r = value.r;\n          g = value.g;\n          b = value.b;\n        } else if ('v' in value) {\n          hsvToRgb(value.h, value.s, value.v);\n        }\n      } else {\n        if (matches = /rgb\\s*\\(\\s*([0-9]+)\\s*,\\s*([0-9]+)\\s*,\\s*([0-9]+)[^\\)]*\\)/gi.exec(value)) {\n          r = parseInt(matches[1], 10);\n          g = parseInt(matches[2], 10);\n          b = parseInt(matches[3], 10);\n        } else if (matches = /#([0-F]{2})([0-F]{2})([0-F]{2})/gi.exec(value)) {\n          r = parseInt(matches[1], 16);\n          g = parseInt(matches[2], 16);\n          b = parseInt(matches[3], 16);\n        } else if (matches = /#([0-F])([0-F])([0-F])/gi.exec(value)) {\n          r = parseInt(matches[1] + matches[1], 16);\n          g = parseInt(matches[2] + matches[2], 16);\n          b = parseInt(matches[3] + matches[3], 16);\n        }\n      }\n\n      r = r < 0 ? 0 : r > 255 ? 255 : r;\n      g = g < 0 ? 0 : g > 255 ? 255 : g;\n      b = b < 0 ? 0 : b > 255 ? 255 : b;\n      return self;\n    };\n\n    if (value) {\n      parse(value);\n    }\n\n    self.toRgb = toRgb;\n    self.toHsv = toHsv;\n    self.toHex = toHex;\n    self.parse = parse;\n    return self;\n  };\n\n  var serialize = function (obj) {\n    var data = JSON.stringify(obj);\n\n    if (!isString(data)) {\n      return data;\n    }\n\n    return data.replace(/[\\u0080-\\uFFFF]/g, function (match) {\n      var hexCode = match.charCodeAt(0).toString(16);\n      return '\\\\u' + '0000'.substring(hexCode.length) + hexCode;\n    });\n  };\n\n  var JSONUtils = {\n    serialize: serialize,\n    parse: function (text) {\n      try {\n        return JSON.parse(text);\n      } catch (ex) {}\n    }\n  };\n  var JSONP = {\n    callbacks: {},\n    count: 0,\n    send: function (settings) {\n      var self = this,\n          dom = DOMUtils$1.DOM,\n          count = settings.count !== undefined ? settings.count : self.count;\n      var id = 'tinymce_jsonp_' + count;\n\n      self.callbacks[count] = function (json) {\n        dom.remove(id);\n        delete self.callbacks[count];\n        settings.callback(json);\n      };\n\n      dom.add(dom.doc.body, 'script', {\n        id: id,\n        src: settings.url,\n        type: 'text/javascript'\n      });\n      self.count++;\n    }\n  };\n\n  var XHR = __assign(__assign({}, Observable), {\n    send: function (settings) {\n      var xhr,\n          count = 0;\n\n      var ready = function () {\n        if (!settings.async || xhr.readyState === 4 || count++ > 10000) {\n          if (settings.success && count < 10000 && xhr.status === 200) {\n            settings.success.call(settings.success_scope, '' + xhr.responseText, xhr, settings);\n          } else if (settings.error) {\n            settings.error.call(settings.error_scope, count > 10000 ? 'TIMED_OUT' : 'GENERAL', xhr, settings);\n          }\n\n          xhr = null;\n        } else {\n          Delay.setTimeout(ready, 10);\n        }\n      };\n\n      settings.scope = settings.scope || this;\n      settings.success_scope = settings.success_scope || settings.scope;\n      settings.error_scope = settings.error_scope || settings.scope;\n      settings.async = settings.async !== false;\n      settings.data = settings.data || '';\n      XHR.fire('beforeInitialize', {\n        settings: settings\n      });\n      xhr = new XMLHttpRequest();\n\n      if (xhr.overrideMimeType) {\n        xhr.overrideMimeType(settings.content_type);\n      }\n\n      xhr.open(settings.type || (settings.data ? 'POST' : 'GET'), settings.url, settings.async);\n\n      if (settings.crossDomain) {\n        xhr.withCredentials = true;\n      }\n\n      if (settings.content_type) {\n        xhr.setRequestHeader('Content-Type', settings.content_type);\n      }\n\n      if (settings.requestheaders) {\n        Tools.each(settings.requestheaders, function (header) {\n          xhr.setRequestHeader(header.key, header.value);\n        });\n      }\n\n      xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\n      xhr = XHR.fire('beforeSend', {\n        xhr: xhr,\n        settings: settings\n      }).xhr;\n      xhr.send(settings.data);\n\n      if (!settings.async) {\n        return ready();\n      }\n\n      Delay.setTimeout(ready, 10);\n    }\n  });\n\n  var extend$6 = Tools.extend;\n\n  var JSONRequest = function () {\n    function JSONRequest(settings) {\n      this.settings = extend$6({}, settings);\n      this.count = 0;\n    }\n\n    JSONRequest.sendRPC = function (o) {\n      return new JSONRequest().send(o);\n    };\n\n    JSONRequest.prototype.send = function (args) {\n      var ecb = args.error,\n          scb = args.success;\n      var xhrArgs = extend$6(this.settings, args);\n\n      xhrArgs.success = function (c, x) {\n        c = JSONUtils.parse(c);\n\n        if (typeof c === 'undefined') {\n          c = {\n            error: 'JSON Parse error.'\n          };\n        }\n\n        if (c.error) {\n          ecb.call(xhrArgs.error_scope || xhrArgs.scope, c.error, x);\n        } else {\n          scb.call(xhrArgs.success_scope || xhrArgs.scope, c.result);\n        }\n      };\n\n      xhrArgs.error = function (ty, x) {\n        if (ecb) {\n          ecb.call(xhrArgs.error_scope || xhrArgs.scope, ty, x);\n        }\n      };\n\n      xhrArgs.data = JSONUtils.serialize({\n        id: args.id || 'c' + this.count++,\n        method: args.method,\n        params: args.params\n      });\n      xhrArgs.content_type = 'application/json';\n      XHR.send(xhrArgs);\n    };\n\n    return JSONRequest;\n  }();\n\n  var create$9 = function () {\n    return function () {\n      var data = {};\n      var keys = [];\n      var storage = {\n        getItem: function (key) {\n          var item = data[key];\n          return item ? item : null;\n        },\n        setItem: function (key, value) {\n          keys.push(key);\n          data[key] = String(value);\n        },\n        key: function (index) {\n          return keys[index];\n        },\n        removeItem: function (key) {\n          keys = keys.filter(function (k) {\n            return k === key;\n          });\n          delete data[key];\n        },\n        clear: function () {\n          keys = [];\n          data = {};\n        },\n        length: 0\n      };\n      Object.defineProperty(storage, 'length', {\n        get: function () {\n          return keys.length;\n        },\n        configurable: false,\n        enumerable: false\n      });\n      return storage;\n    }();\n  };\n\n  var localStorage;\n\n  try {\n    var test = '__storage_test__';\n    localStorage = window.localStorage;\n    localStorage.setItem(test, test);\n    localStorage.removeItem(test);\n  } catch (e) {\n    localStorage = create$9();\n  }\n\n  var LocalStorage = localStorage;\n  var publicApi = {\n    geom: {\n      Rect: Rect\n    },\n    util: {\n      Promise: promiseObj,\n      Delay: Delay,\n      Tools: Tools,\n      VK: VK,\n      URI: URI,\n      Class: Class,\n      EventDispatcher: EventDispatcher,\n      Observable: Observable,\n      I18n: I18n,\n      XHR: XHR,\n      JSON: JSONUtils,\n      JSONRequest: JSONRequest,\n      JSONP: JSONP,\n      LocalStorage: LocalStorage,\n      Color: Color\n    },\n    dom: {\n      EventUtils: EventUtils,\n      Sizzle: Sizzle,\n      DomQuery: DomQuery,\n      TreeWalker: DomTreeWalker,\n      TextSeeker: TextSeeker,\n      DOMUtils: DOMUtils$1,\n      ScriptLoader: ScriptLoader,\n      RangeUtils: RangeUtils$1,\n      Serializer: DomSerializer,\n      StyleSheetLoader: StyleSheetLoader,\n      ControlSelection: ControlSelection,\n      BookmarkManager: BookmarkManager$1,\n      Selection: EditorSelection,\n      Event: EventUtils.Event\n    },\n    html: {\n      Styles: Styles,\n      Entities: Entities,\n      Node: AstNode,\n      Schema: Schema,\n      SaxParser: SaxParser$1,\n      DomParser: DomParser,\n      Writer: Writer,\n      Serializer: HtmlSerializer\n    },\n    Env: Env,\n    AddOnManager: AddOnManager$1,\n    Annotator: Annotator,\n    Formatter: Formatter,\n    UndoManager: UndoManager,\n    EditorCommands: EditorCommands,\n    WindowManager: WindowManager,\n    NotificationManager: NotificationManager,\n    EditorObservable: EditorObservable,\n    Shortcuts: Shortcuts,\n    Editor: Editor,\n    FocusManager: FocusManager,\n    EditorManager: EditorManager,\n    DOM: DOMUtils$1.DOM,\n    ScriptLoader: ScriptLoader.ScriptLoader,\n    PluginManager: PluginManager,\n    ThemeManager: ThemeManager,\n    IconManager: IconManager,\n    Resource: Resource,\n    trim: Tools.trim,\n    isArray: Tools.isArray,\n    is: Tools.is,\n    toArray: Tools.toArray,\n    makeMap: Tools.makeMap,\n    each: Tools.each,\n    map: Tools.map,\n    grep: Tools.grep,\n    inArray: Tools.inArray,\n    extend: Tools.extend,\n    create: Tools.create,\n    walk: Tools.walk,\n    createNS: Tools.createNS,\n    resolve: Tools.resolve,\n    explode: Tools.explode,\n    _addCacheSuffix: Tools._addCacheSuffix,\n    isOpera: Env.opera,\n    isWebKit: Env.webkit,\n    isIE: Env.ie,\n    isGecko: Env.gecko,\n    isMac: Env.mac\n  };\n  var tinymce = Tools.extend(EditorManager, publicApi);\n\n  var exportToModuleLoaders = function (tinymce) {\n    if (typeof module === 'object') {\n      try {\n        module.exports = tinymce;\n      } catch (_) {}\n    }\n  };\n\n  var exportToWindowGlobal = function (tinymce) {\n    window.tinymce = tinymce;\n    window.tinyMCE = tinymce;\n  };\n\n  exportToWindowGlobal(tinymce);\n  exportToModuleLoaders(tinymce);\n})();","map":{"version":3,"sources":["/home/dani/Escritorio/Projects/blog-react/frontend-blog/node_modules/tinymce/tinymce.js"],"names":["typeOf","x","undefined","t","Array","prototype","isPrototypeOf","constructor","name","String","isEquatableType","indexOf","sort","xs","compareFn","clone","slice","call","contramap","eqa","f","eq","y","tripleEq","eqString","eqArray","length","len","i","eqSortedArray","eqRecord","kx","Object","keys","ky","q","eqAny","tx","ty","noop","compose","fa","fb","args","_i","arguments","apply","compose1","fbc","fab","a","constant","value","identity","curry","fn","initialArgs","restArgs","all","concat","not","die","msg","Error","never","always","none","NONE","o","isNone","thunk","id","n","me","fold","_s","is","isSome","getOr","getOrThunk","getOrDie","getOrNull","getOrUndefined","or","orThunk","map","each","bind","exists","forall","filter","equals","equals_","toArray","toString","some","constant_a","self","s","v","elementEq","b","from","Optional","typeOf$1","isType","type","isSimpleType","eq$1","isString","isObject","isArray","isNull","isBoolean","isUndefined","isNullable","isNonNullable","isFunction","isNumber","nativeSlice","nativeIndexOf","nativePush","push","rawIndexOf","ts","r","contains","pred","eachr","partition","pass","fail","arr","foldr","acc","foldl","findUntil","until","find","findIndex","flatten","reverse","difference","a1","a2","mapToObject","sort$1","comparator","copy","head","last","from$1","hasOwnProperty","each$1","obj","props","k","map$1","tupleMap","tuple","objAcc","internalFilter","onTrue","onFalse","bifilter","filter$1","mapToArray","values","get","key","has","equal","isArray$1","array","l","each$2","cb","map$2","callback","out","item","index","filter$2","indexOf$1","reduce","collection","iteratee","accumulator","thisArg","findIndex$1","predicate","last$1","__assign","assign","p","__rest","e","getOwnPropertySymbols","propertyIsEnumerable","__spreadArrays","il","j","jl","cached","called","DeviceType","os","browser","userAgent","mediaMatch","isiPad","isiOS","test","isiPhone","isMobile","isAndroid","isTouch","isTablet","isPhone","iOSwebview","isSafari","isDesktop","isWebView","firstMatch","regexes","find$1","agent","major","minor","group","Number","replace","nu","detect","versionRegexes","cleanedAgent","toLowerCase","unknown","Version","detect$1","candidates","candidate","search","detectBrowser","browsers","version","current","detectOs","oses","UaString","checkRange","str","substr","start","contains$1","startsWith","prefix","blank","trim","lTrim","rTrim","normalVersionRegex","checkContains","target","uastring","PlatformInfo","edge","chrome","ie","opera","firefox","safari","unknown$1","nu$1","info","isBrowser","isEdge","isChrome","isIE","isOpera","isFirefox","Browser","windows","ios","android","linux","osx","solaris","freebsd","chromeos","unknown$2","nu$2","isOS","isWindows","isOSX","isLinux","isSolaris","isFreeBSD","isChromeOS","OperatingSystem","detect$2","deviceType","PlatformDetection","query","window","matchMedia","matches","platform","navigator","detect$3","platform$1","webkit","fileApi","URL","createObjectURL","windowsPhone","Env","gecko","mac","iOS","contentEditable","transparentSrc","caretAfter","range","getSelection","documentMode","document","ceFalse","cacheSuffix","container","experimentalShadowDom","canHaveCSP","desktop","whiteSpaceRegExp","trim$1","makeMap","items","delim","split","hasOwnProperty$1","prop","create","root","sp","scn","c","de","exec","cn","match","ns","createNS","onCreate","extend","resolve","parent","static","exts","ext","name_1","walk","explode","d","_addCacheSuffix","url","Tools","grep","inArray","hasOwn","fromHtml","html","scope","doc","div","createElement","innerHTML","hasChildNodes","childNodes","console","error","fromDom","fromTag","tag","node","fromText","text","createTextNode","dom","fromPoint","docElm","elementFromPoint","SugarElement","toArray$1","recurse","cur","compareDocumentPosition","documentPositionContainedBy","Node","DOCUMENT_POSITION_CONTAINED_BY","COMMENT","DOCUMENT","DOCUMENT_FRAGMENT","ELEMENT","TEXT","is$1","element","selector","nodeType","elem","msMatchesSelector","webkitMatchesSelector","mozMatchesSelector","bypassSelector","childElementCount","base","querySelectorAll","one","querySelector","eq$2","e1","e2","regularContains","d1","d2","ieContains","contains$2","Global","Function","nodeName","isType$1","isComment","isElement","isText","isDocument","isDocumentFragment","owner","ownerDocument","documentOrOwner","dos","documentElement","defaultView","parentNode","parents","isRoot","stop","ret","rawParent","siblings","filterSelf","elements","children","prevSibling","previousSibling","nextSibling","prevSiblings","nextSiblings","child","cs","firstChild","lastChild","childNodesCount","getHead","isShadowRoot","supported","Element","attachShadow","getRootNode","isSupported","getStyleContainer","getShadowRoot","getShadowHost","host","getOriginalEventTarget","event","el","isOpenShadowHost","composed","composedPath","shadowRoot","before","marker","parent$1","insertBefore","after","sibling","append","prepend","firstChild$1","appendChild","wrap","wrapper","before$1","append$1","empty","textContent","rogue","remove","removeChild","unwrap","children$1","inBody","body","left","top","translate","SugarPosition","boxPosition","box","getBoundingClientRect","firstDefinedOrZero","absolute","win","offsetLeft","offsetTop","scrollTop","pageYOffset","scrollLeft","pageXOffset","clientTop","clientLeft","viewport","get$1","_DOC","to","scrollTo","intoView","alignToTop","scrollIntoViewIfNeeded","scrollIntoView","get$2","_win","bounds","width","height","right","bottom","getBounds","scroll","clientWidth","clientHeight","visualViewport","Math","max","pageLeft","pageTop","isNodeType","isRestrictedNode","getPrototypeOf","isElement$1","matchNodeNames","names","lowercasedNames","matchStyleValues","cssValue","computed","getComputedStyle","getPropertyValue","hasAttribute","attrName","hasAttributeValue","attrValue","getAttribute","isBogus","isBogusAll","isTable","tagName","hasContentEditableState","isTextareaOrInput","isText$1","isComment$1","isDocument$1","isDocumentFragment$1","isBr","isImg","isContentEditableTrue","isContentEditableFalse","isTableCell","isMedia","isSupported$1","style","rawSet","setAttribute","set","setAll","attrs","get$3","getOpt","has$1","remove$1","removeAttribute","attributes","attr","internalSet","property","setProperty","setAll$1","css","get$4","styles","getUnsafeProperty","getRaw","raw","getAllRaw","ruleName","reflow","offsetWidth","browser$1","firstElement","nodes","getTableCaptionDeltaY","elm","caption","bodyTop","captionTop","captionHeight","offsetHeight","hasChild","getPos","rootElm","offsetParent","pos","exports$1","module$1","exports","define","module","require","amd","g","global","EphoxContactWrapper","u","code","process","cachedSetTimeout","cachedClearTimeout","defaultSetTimout","defaultClearTimeout","setTimeout","clearTimeout","runTimeout","fun","runClearTimeout","queue","draining","currentQueue","queueIndex","cleanUpNextTick","drainQueue","timeout","run","nextTick","Item","title","env","argv","versions","on","addListener","once","off","removeListener","removeAllListeners","emit","prependListener","prependOnceListener","listeners","binding","cwd","chdir","dir","umask","setImmediate","setTimeoutFunc","Promise","TypeError","_state","_handled","_value","_deferreds","doResolve","handle","deferred","_immediateFn","onFulfilled","onRejected","reject","promise","newValue","then","finale","_unhandledRejectionFn","Handler","done","reason","ex","prom","remaining","res","val","race","err","warn","_setImmediateFn","_setUnhandledRejectionFn","clearImmediate","immediateIds","nextImmediateId","Timeout","setInterval","clearInterval","close","clearFn","_id","_clearFn","unref","ref","enroll","msecs","_idleTimeoutId","_idleTimeout","unenroll","_unrefActive","active","onTimeout","_onTimeout","onNextTick","promisePolyfill","boltExport","nu$3","baseFn","data","callbacks","nCallback","isReady","cbs","pure","LazyValue","errorReporter","make","aFutureB","toPromise","anonBind","futureB","toLazy","toCached","cache","nu$4","pure$1","Future","par","asyncValues","count","asyncValue","par$1","futures","_opt","_f","mapError","_","onValue","toOptional","isValue","isError","message","opt","onError","fromOption","Result","generate","cases","constructors","adt","acase","keys$1","argLength","branches","branchKeys","join","allReqd","reqKey","log","label","params","Adt","comparison","bothErrors","firstError","secondError","bothValues","unite","result","ClosestOrAncestor","ancestor","closest","ancestor$1","descendant","closest$1","asap","immediateFn","catch","promiseObj","requestAnimationFramePromise","requestAnimationFrame","requestAnimationFrameFunc","vendors","featurefill","wrappedSetTimeout","time","wrappedSetInterval","wrappedClearTimeout","wrappedClearInterval","debounce","timer","func","Delay","setEditorTimeout","editor","removed","setEditorInterval","throttle","StyleSheetLoader","documentOrShadowRoot","settings","idCount","loadedStates","edos","maxLoadTime","_setReferrerPolicy","referrerPolicy","addStyle","removeStyle","styleContainer","getOrCreateState","passed","failed","load","success","failure","link","urlWithSuffix","state","status","onload","onerror","wait","testCallback","waitCallback","Date","now","startTime","waitForWebKitLinkLoaded","styleSheets","styleSheet","ownerNode","linkElem","rel","contentCssCors","loadF","loadAll","urls","parts","unload","unloadAll","create$1","WeakMap","forElement","referenceElement","rootDom","sl","instance","DomTreeWalker","startNode","rootNode","next","prev","prev2","shallow","findSibling","findPreviousNode","startName","siblingName","blocks","tableCells","tableSections","textBlocks","headings","listItems","lists","wsElements","lazyLookup","lookup","isHeading","isBlock","isTable$1","isInline","isBr$1","isTextBlock","isList","isListItem","isTableSection","isTableCell$1","isWsPreserveElement","ancestor$2","zeroWidth","nbsp","isZwsp","char","removeZwsp","ZWSP","isZwsp$1","trim$2","isElement$2","isText$2","isCaretContainerBlock","isCaretContainerInline","isCaretContainer","hasContent","insertInline","textNode","startsWithCaretContainer","splitText","endsWithCaretContainer","isBeforeInline","charAt","offset","isAtStart","isAfterInline","isAtEnd","createBogusBr","br","insertBlock","blockName","blockNode","trimBogusBr","brs","getElementsByTagName","lastBr","showCaretContainerBlock","caretContainer","isRangeInCaretContainerBlock","startContainer","isContentEditableTrue$1","isContentEditableFalse$1","isBr$2","isText$3","isInvalidTextElement","isAtomicInline","isTable$2","isCaretContainer$1","isCaretCandidate","isNonUiContentEditableFalse","isUnselectable","isInEditable","isAtomicContentEditableFalse","isAtomic","isEditableCaretCandidate","whiteSpaceRegExp$1","isWhitespaceText","hasWhitespacePreserveParent","rootElement","isWhitespace","isNamedAnchor","isContent","isBookmark","isBogus$1","isBogusAll$1","isEmptyNode","targetNode","skipBogus","brCount","walker","isEmpty","isSpan","isInlineContent","surroundedByInlineContent","prevIsInline","nextIsInline","isBookmarkNode","isKeepTextNode","isKeepElement","isDocument$2","trimNode","currentChildren","makeMap$1","attrsCharsRegExp","textCharsRegExp","rawCharsRegExp","entityRegExp","asciiMap","baseEntities","reverseEntities","nativeDecode","innerText","buildEntitiesLookup","radix","chr","entity","fromCharCode","parseInt","namedEntities","encodeRaw","encodeAllRaw","encodeNumeric","charCodeAt","encodeNamed","entities","getEncodeFunc","entitiesMap","encodeNamedAndNumeric","encodeCustomNamed","nameMap","named","numeric","decode","Entities","mapCache","dummyObj","makeMap$2","each$3","extend$1","explode$1","compileSchema","schema","globalAttributes","blockContent","phrasingContent","flowContent","html4BlockContent","html4PhrasingContent","add","ni","attributesOrder","arrayToMap","addAttrs","schemaItem","table","script","compileElementMap","mode","toUpperCase","Schema","patternElements","customElementsMap","specialElements","createLookupTable","option","defaultValue","extendWith","schemaItems","verify_html","valid_elements","validStyles","valid_styles","invalidStyles","invalid_styles","validClasses","valid_classes","whiteSpaceElementsMap","selfClosingElementsMap","shortEndedElementsMap","boolAttrMap","nonEmptyOrMoveCaretBeforeOnEnter","nonEmptyElementsMap","moveCaretBeforeOnEnterElementsMap","textBlockElementsMap","blockElementsMap","textInlineElementsMap","special","RegExp","patternToRegExp","addValidElements","validElements","ei","ai","al","attrData","elementName","attrType","outputName","globalAttributesOrder","elementRuleRegExp","attrRuleRegExp","hasPatternsRegExp","validElementsArr","paddEmpty","removeEmpty","removeEmptyAttrs","attributesRequired","required","splice","attributesDefault","attributesForced","forcedValue","validValues","attributePatterns","pattern","setValidElements","addCustomElements","customElements","customElementRegExp","text_block_elements","block_elements","rule","inline","cloneName","customRule","elmName","addValidChildren","validChildren","childRuleRegExp","getElementRule","custom_elements","valid_children","extended_valid_elements","dd","dt","li","td","th","tr","tbody","thead","tfoot","legend","area","param","parentsRequired","invalid_elements","getValidStyles","getInvalidStyles","getValidClasses","getBoolAttrs","getBlockElements","getTextBlockElements","getTextInlineElements","getShortEndedElements","getSelfClosingElements","getNonEmptyElements","getMoveCaretBeforeOnEnterElements","getWhiteSpaceElements","getSpecialElements","isValidChild","isValid","attrPatterns","getCustomElements","toHex","hex","Styles","rgbRegExp","urlOrStrRegExp","styleRegExp","trimRightRegExp","encodingLookup","invisibleChar","encodingItems","color","parse","isEncoded","urlConverter","url_converter","urlConverterScope","url_converter_scope","compress","suffix","noJoin","canCompress","compress2","encode","keepSlashes","decodeSingleHexSequence","escSeq","decodeHexSequences","processUrl","url2","url3","str2","allow_script_urls","scriptUrl","allow_svg_data_urls","lastIndex","border","serialize","serializeStyles","styleList","i_1","styleMap","eventExpandoPrefix","mouseEventRe","deprecated","keyLocation","layerX","layerY","returnValue","webkitMovementX","webkitMovementY","keyIdentifier","mozPressure","hasIsDefaultPrevented","isDefaultPrevented","returnTrue","returnFalse","addEvent","capture","addEventListener","attachEvent","removeEvent","removeEventListener","detachEvent","isMouseEvent","fix","originalEvent","srcElement","pageX","clientX","eventDoc","pageY","clientY","preventDefault","stopPropagation","isPropagationStopped","cancelBubble","stopImmediatePropagation","isImmediatePropagationStopped","metaKey","bindOnReady","eventUtils","domLoaded","isDocReady","readyState","readyHandler","EventUtils","events","expando","hasMouseEnterLeave","hasFocusIn","callbackList","fakeName","nativeHandler","defaultNativeHandler","evt","executeHandlers","namesList","mouseEnterLeave","currentTarget","related","relatedTarget","unbind","ci","eventMap","fire","parentWindow","clean","destroy","cancel","Event","support","Expr","getText","isXML","tokenize","compile","select","outermostContext","sortInput","hasDuplicate","setDocument","document$1","docElem","documentIsHTML","rbuggyQSA","rbuggyMatches","contains$3","preferredDoc","dirruns","classCache","createCache","tokenCache","compilerCache","sortOrder","strundefined","MAX_NEGATIVE","pop","push_native","indexOf$2","booleans","whitespace","identifier","pseudos","rtrim","rcomma","rcombinators","rattributeQuotes","rpseudo","ridentifier","matchExpr","ID","CLASS","TAG","ATTR","PSEUDO","CHILD","bool","needsContext","rinputs","rheader","rnative","rquickExpr","rsibling","rescape","runescape","funescape","escaped","escapedWhitespace","high","els","Sizzle","context","results","seed","m","groups","old","nid","newContext","newSelector","getElementById","getElementsByClassName","qsa","toSelector","testContext","qsaError","cacheLength","shift","markFunction","siblingCheck","diff","sourceIndex","createInputPseudo","createButtonPseudo","createPositionalPseudo","argument","matchIndexes","hasCompare","getTop","getById","attrId","tmp","className","disconnectedMatch","adown","bup","compare","sortDetached","aup","ap","bp","unshift","expr","matchesSelector","attrHandle","getAttributeNode","specified","uniqueSort","duplicates","detectDuplicates","sortStable","nodeValue","selectors","createPseudo","relative","first","preFilter","excess","unquoted","nodeNameSelector","operator","check","what","simple","forward","ofType","xml","outerCache","nodeIndex","useCache","pseudo","setFilters","idx","matched","input","matcher","unmatched","lang","elemLang","hash","location","focus","activeElement","hasFocus","href","tabIndex","enabled","disabled","checked","selected","selectedIndex","header","button","even","odd","lt","gt","nth","filters","parseOnly","tokens","soFar","preFilters","addCombinator","combinator","checkNonElements","doneName","oldCache","newCache","elementMatcher","matchers","multipleContexts","contexts","condense","newUnmatched","mapped","setMatcher","postFilter","postFinder","postSelector","temp","preMap","postMap","preexisting","elems","matcherIn","matcherOut","matcherFromTokens","checkContext","leadingRelative","implicitRelative","matchContext","matchAnyContext","matcherFromGroupMatchers","elementMatchers","setMatchers","bySet","byElement","superMatcher","outermost","matchedCount","setMatched","contextBackup","dirrunsUnique","random","token","compiled","push$1","slice$1","rquickExpr$1","skipUniques","isDefined","isString$1","isWindow","createFragment","fragDoc","frag","createDocumentFragment","domManipulate","targetNodes","sourceItem","getElementDocument","DomQuery","makeArray","hasClass","wrap$1","lastParent","newWrapper","cloneNode","numericCssMap","booleanMap","propFix","for","class","readonly","cssFix","float","attrHooks","cssHooks","DomQueryConstructor","init","inArray$1","whiteSpaceRegExp$2","trim$3","each$4","unique","hook","removeAttr","camel","dashed","removeProperty","currentStyle","appendTo","prependTo","replaceWith","content","wrapAll","wrapInner","contents","addClass","toggleClass","removeClass","classState","existingClassName","trigger","show","hide","object","firstSibling","contentDocument","contentWindow","wrappedResult","parentsUntil","nextUntil","prevUntil","overrideDefaults","defaults","sub","each$5","grep$1","simpleSelectorRe","setupAttrHooks","getContext","keepValues","keep_values","keepUrlHook","$elm","src","updateInternalStyleAttr","rawValue","findNodeIndex","normalized","lastNodeType","DOMUtils","_this","addedStyles","files","counter","stdMode","boxModel","styleSheetLoader","boundEvents","ownEvents","$","getRoot","$$","getAttrib","defaultVal","getAttribs","setAttrib","originalValue","onSetAttrib","attrElm","deep","clone_1","root_element","getViewPort","argWin","vp","w","h","getPos$1","setStyle","update_styles","setStyles","stylesArg","getStyle","getSize","getRect","size","elms","getParents","collect","selectorVal","getParent","_findSib","getNext","getPrev","setAttribs","setHTML","canHaveHTML","parentElm","newElm","createHTML","outHtml","keepChildren","$node","removeAllAttribs","removeAttributeNode","parseStyle","cssText","serializeStyle","styleElm","DOM","loadCSS","cls","isHidden","uniqueId","getOuterHTML","outerHTML","setOuterHTML","insertAfter","reference","referenceNode","oldElm","replaceChild","rename","attrNode","findCommonAncestor","ps","pe","rgbVal","isNonEmptyElement","bogusVal","createRng","createRange","splitElm","replacementElm","beforeFragment","afterFragment","setStart","setEnd","extractContents","rv","output","getContentEditable","getContentEditableParent","isChildOf","dumpRng","startOffset","endContainer","endOffset","DOMUtils$1","each$6","grep$2","QUEUED","LOADING","LOADED","FAILED","ScriptLoader","states","scriptLoadedCallbacks","queueLoadedCallbacks","loading","loadScript","onreadystatechange","isDone","markDone","loadQueue","loadScripts","scripts","failures","execCallbacks","loadingScripts","notifyCallbacks","Cell","initial","isRaw","isTokenised","currentCode","getLanguageData","getData","setCode","newCode","getCode","langData","translation","getLangData","textstr","removeContext","values_1","substitued","$1","$2","isRtl","hasCode","I18n","AddOnManager","_listeners","runListeners","matchedListeners","listener","dependencies","requireLangPack","languages","languageLoad","waitFor","language","wrappedLanguages","addOn","addOnConstructor","createUrl","baseUrl","dep","resource","addComponents","pluginName","pluginUrl","loadDependencies","addOnUrl","deps","newUrl","urlString","baseURL","substring","lastIndexOf","PluginManager","ThemeManager","AddOnManager$1","rate","last$2","read","add$1","remove$2","supports","classList","get$5","add$2","clazz","remove$3","add$3","cleanClass","remove$4","has$2","descendants","descendants$1","annotation","dataAnnotation","dataAnnotationId","identify","annotationName","rng","selection","getRng","getBody","an","newStart","getAttr","uid","findMarkers","isAnnotation","findAll","markers","directory","nodesAlready","setup","_registry","changeCallbacks","initData","previous","withCallbacks","updateCallbacks","callbackMap","outputData","fireCallbacks","fireNoAnnotation","onNodeChange","annotations","_a","setup$1","registry","identifyParserNode","span","serializer","addNodeFilter","spans","persistent","create$2","register","generate$1","date","getTime","floor","add$4","classes","fromHtml$1","get$6","set$1","owner$1","docDom","fragment","contentElements","clone$1","original","isDeep","TextWalker","isBoundary","direction","TextSeeker","isBlockBoundary","newOffset","backwards","forwards","cat","lift2","oa","ob","lift3","oc","someIf","round","clone$2","rect","collapse","toStart","isEqual","rect1","rect2","isValidOverflow","overflowY","min","isAbove","halfHeight","isBelow","containsXY","getSelectedNode","getNode","extendingChars","isExtendingChar","ch","and","isElement$3","isCaretCandidate$1","isBlock$1","isFloated","isValidElementCaretCandidate","isNotPre","isText$4","isBr$3","resolveIndex","isWhiteSpace","isRange","isHiddenWhiteSpaceRange","getBrClientRect","brNode","nbsp$1","clientRect","getBoundingClientRectWebKitText","sc","ec","so","eo","newRng","cloneRange","setEndAfter","isZeroRect","clientRects","getClientRects","collapseAndInflateWidth","newClientRect","getCaretPositionClientRects","caretPosition","beforeNode","addUniqueAndValidRect","addCharacterOffset","CaretPosition","toRange","isVisible","fromRangeStart","fromRangeEnd","pos1","pos2","isTextPosition","isElementPosition","CaretPosition$1","trimEmptyTextNode","insertNode","insertFragment","rangeInsertNode","isText$5","isBogus$2","nodeIndex$1","normalizedParent","getChildNodes","normalizedTextOffset","equal$1","normalizedNodeIndex","numTextFragments","createPathItem","create$3","path","outputOffset","resolvePathItem","findTextPosition","targetOffset","dataLen","resolve$1","paths","isContentEditableFalse$2","getNormalizedTextOffset","trimmedOffset","getPoint","point","getLocation","bookmark","isCollapsed","end","findIndex$2","moveEndPoint","normalizeTableCellSelection","findAdjacentContentEditableFalseElm","getOffsetBookmark","getCaretBookmark","getRangeBookmark","createBookmarkSpan","filled","getPersistentBookmark","collapsed","rng2","endBookmarkNode","startBookmarkNode","moveToBookmark","keep","getBookmark","getUndoBookmark","DOM$1","defaultPreviewStyles","getBodySetting","getParam","bodyObj","getIframeAttrs","getDocType","getDocumentBaseUrl","getBodyId","getBodyClass","getContentSecurityPolicy","shouldPutBrInPre","getForcedRootBlock","block","getForcedRootBlockAttrs","getBrNewLineSelector","getNoNewLineSelector","shouldKeepStyles","shouldEndContainerOnEmptyBlock","getFontStyleValues","getFontSizeClasses","getImagesDataImgFilter","isAutomaticUploadsEnabled","shouldReuseFileName","shouldReplaceBlobUris","getIconPackName","getIconsUrl","getImageUploadUrl","getImageUploadBasePath","getImagesUploadCredentials","getImagesUploadHandler","shouldUseContentCssCors","getReferrerPolicy","getLanguageCode","getLanguageUrl","shouldIndentUseMargin","getIndentation","getContentCss","contentCss","getDirectionality","getInlineBoundarySelector","getObjectResizing","getResizeImgProportional","getPlaceholder","getElement","getEventRoot","getServiceMessage","getTheme","shouldValidate","isInlineBoundariesEnabled","getFormats","getPreviewStyles","getCustomUiSelector","getThemeUrl","isInline$1","hasHiddenInput","shouldPatchSubmit","isEncodingXml","shouldAddFormSubmitTrigger","shouldAddUnloadTrigger","hasForcedRootBlock","getCustomUndoRedoLevels","shouldDisableNodeChange","isReadOnly","hasContentCssCors","getPlugins","getExternalPlugins","shouldBlockUnsupportedDrop","isElement$4","isText$6","removeNode","trimCount","trimmedText","deleteZwspChars","deleteData","removeUnchanged","remove$5","removeTextAndReposition","removeElementAndReposition","newPosition","removeTextCaretContainer","removeElementCaretContainer","removeAndReposition","caretContainerNode","browser$2","isContentEditableFalse$3","isMedia$1","isTableCell$2","inlineFakeCaretSelector","getAbsoluteClientRect","scrollX","scrollY","margin","rootRect","trimInlineCaretContainers","fakeCaretTargetNodes","FakeCaret","lastVisualCaret","cursorInterval","rootBlock","caretBlock","caret","caretState","startBlink","isInlineFakeCaretTarget","reposition","getCss","isFakeCaretTableBrowser","isFakeCaretTarget","isContentEditableFalse$4","isMedia$2","isBlockLike","isCaretContainer$2","isCaretContainerBlock$1","isElement$5","isCaretCandidate$2","isForwards","isBackwards","skipCaretContainers","findNode","predicateFn","isCefOrCaretContainer","getParentBlock","isInSameBlock","caretPosition1","caretPosition2","getChildNodeAtRelativeOffset","relativeOffset","beforeAfter","setStartBefore","setEndBefore","setStartAfter","isNodesInSameBlock","node1","node2","lean","before$2","after$1","normalizeRange","leanLeft","leanRight","getRelativeCefElm","getNormalizedRangeEndPoint","normalizedRange","getElementFromPosition","getElementFromPrevPosition","getVisualCaretPosition","walkFn","isMoveInsideSameBlock","inSameBlock","HDirection","isContentEditableFalse$5","isText$7","isElement$6","isBr$4","isCaretCandidate$3","isAtomic$1","isEditableCaretCandidate$1","nodeAtIndex","getCaretCandidatePosition","moveForwardFromBr","nextNode","findCaretPosition","Forwards","startPos","innerNode","rootContentEditableFalseElm","CaretWalker","Backwards","walkToPositionIn","position","fromPosition","afterElement","isBeforeOrStart","isAfterOrEnd","isBeforeAfterSameElement","isAtBr","shouldSkipPosition","navigate","navigateIgnore","ignoreFilter","positionIn","nextPosition","prevPosition","firstPositionIn","lastPositionIn","CARET_ID","isCaretNode","getParentCaretContainer","isStringPathBookmark","isRangeBookmark","isIdBookmark","isIndexBookmark","isPathBookmark","addBogus","resolveCaretPositionBookmark","insertZwsp","isEmpty$1","tryFindRangePosition","padEmptyCaretContainer","setEndPoint","isValidTextNode","restoreEndPoint","appendData","resolvePaths","resolveId","endPos","spos","epos","resolveIndex$1","selectNode","resolve$2","getBookmark$1","setRng","isBookmarkNode$1","is$2","expected","actual","isNbsp","isWhiteSpace$1","isContent$1","isNode","isInlineBlock","moveStart","isWhiteSpaceNode","getNonWhiteSpaceSibling","inc","nextName","isTextBlock$1","ed","isEmptyTextNode","replaceVars","vars","isEq","str1","normalizeStyleValue","getTextDecoration","decoration","getParents$1","isVariableFormatName","formatName","hasVariableValues","format","isVariableValue","field","fieldValues","formatter","areSimilarFormats","otherFormatName","validKeys","filterObj","validKey","fmt1","filteredFmt1","fmt2","filteredFmt2","isBookmarkNode$2","getParents$2","isWhiteSpaceNode$1","isTextBlock$2","isBogusBr","findParentContentEditable","walkText","findSpace","findContent","findWordEndPoint","includeTrailingSpaces","lastTextNode","textSeeker","textOffset","spaceResult","findSelectorEndPoint","curFormat","findBlockEndPoint","scopeRoot","findParentContainer","block_expand","expandRng","includeTrailingSpace","startPoint","endPoint","expand","clampToExistingChildren","getEndChild","walk$1","exclude","collectSiblings","endNode","findEndPoint","walkBoundary","parent_1","siblings_1","getRanges","ranges","rangeCount","getRangeAt","getSelectedNodes","hasMultipleRanges","getCellsFromRanges","getCellsFromElement","getCellsFromElementOrRanges","selectedCells","getCellsFromEditor","getSel","getStartNode","getEndNode","getFirstChildren","getLastChildren","hasAllContentsSelected","moveEndPoint$1","hasAnyRanges","sel","runOnRanges","executor","fakeSelectionNodes","fakeNodeRng","preserve","fillBookmark","NodeValue","getOption","api","get$7","isZeroWidth","wrapName","applyWordGrab","makeAnnotation","eDoc","decorate","_b","master","_c","_d","_e","annotate","newWrappers","getDoc","finishWrapper","getOrOpenWrapper","processElements","processElement","ctx","processNodes","annotateWithBookmark","undoManager","transact","initialRng","hasFakeSelection","selectionRng","Annotator","changes","annotationChanged","getAll","BookmarkManager","BookmarkManager$1","getContentEditableRoot","isXYWithinRange","firePreProcess","firePostProcess","fireRemove","fireDetach","fireSwitchMode","fireObjectResizeStart","origin","fireObjectResized","firePreInit","firePostRender","fireInit","firePlaceholderToggle","fireError","errorType","VK","BACKSPACE","DELETE","DOWN","ENTER","LEFT","RIGHT","SPACEBAR","TAB","UP","END","HOME","modifierPressed","shiftKey","ctrlKey","altKey","metaKeyPressed","isContentEditableFalse$6","ControlSelection","selectedElm","selectedElmGhost","resizeHelper","selectedHandle","startX","startY","selectedElmX","selectedElmY","startW","startH","ratio","resizeStarted","editableDoc","rootDocument","abs","startScrollWidth","startScrollHeight","resizeHandles","nw","ne","se","sw","isImage","isEventOnImageOutsideRange","touch","touches","contextMenuSelectImage","getResizeTarget","isResizable","setGhostElmSize","ghostElm","resizeGhostElement","deltaX","deltaY","proportional","resizeHelperX","resizeHelperY","screenX","screenY","display","scrollWidth","scrollHeight","endGhostResize","wasResizeStarted","setSizeProp","showResizeRect","nodeChanged","targetElm","hideResizeRect","unbindResizeHandleEvents","targetWidth","targetHeight","handleElm","startDrag","unSelectabe","updateResizeRect","startElm","controlElm","isChildOrEqual","img","disableGeckoResize","getStart","getEnd","isWithinContentEditableFalse","execCommand","handleMSControlSelect_1","delayedSelect","throttledUpdateResizeRect","composing","hasCeProperty","findParent","findClosestIeRange","rects","createTextRange","moveToElementText","moveToPoint","moveOutOfContentEditableFalse","parentElement","fromPoint$1","pointDoc","caretPositionFromPoint","offsetNode","caretRangeFromPoint","isEq$1","rng1","findParent$1","hasParent","hasParentWithName","isTable$3","isTableCell$3","isCeFalseCaretContainer","hasBrBeforeAfter","isPrevNode","hasContentEditableFalseParent","findTextNodeRelative","isAfterNode","lastInlineElement","parentBlockContainer","normalizeEndPoint","directionLeft","normalize","normRng","split$1","RangeUtils","normalize$1","normalizedRng","compareRanges","getCaretRangeFromPoint","RangeUtils$1","Dimension","getOffset","parseFloat","getOuter","aggregate","properties","isNaN","cumulativeInclusions","absoluteMax","api$1","get$8","walkUp","navigation","frame","view","rest","pathTo","frameElement","Navigation","freeze","__proto__","find$2","frames","loc","excludeFromDescend","fireScrollIntoViewEvent","scrollEvent","fireAfterScrollIntoViewEvent","descend","markerInfo","cleanupFun","cleanup","createMarker","elementMarker","withMarker","preserveWith","applyWithMarker","withScrollEvents","withElement","startElement","endElement","scrollToMarker","viewHeight","intoWindowIfNeeded","viewportBottom","markerTop","markerBottom","largerThanViewport","align","intoWindow","innerHeight","intoFrame","frameViewHeight","op","viewportBounds","rangeIntoWindow","elementIntoWindow","rangeIntoFrame","elementIntoFrame","scrollElementIntoView","scroller","scrollRangeIntoView","getDocument","create$4","soffset","finish","foffset","SimRange","cata","subject","onBefore","onOn","onAfter","situ","before$3","after$2","Situ","adt$1","domRange","exact","exactFromRange","simRange","getStart$1","startSitu","_finishSitu","_soffset","_finish","_foffset","getWin","SimSelection","browser$3","clamp","normalizeRng","isOrContains","isRngInRoot","shouldStore","nativeRangeToSelectionRange","readRange","getBookmark$2","validate","bookmarkToNativeRng","store","newBookmark","storeNative","restore","isEditorUIElement","FocusManager","isManualNodeChange","selectionChange","registerPageMouseUp","throttledStore","mouseUpPage","registerFocusOut","registerMouseUp","registerEditorEvents","documentFocusInHandler","DOM$2","isEditorUIElement$1","isEditorContentAreaElement","isUIElement","customSelector","getActiveElement","registerEvents","editorManager","focusedEditor","setActive","blurredEditor","activeEditor","unregisterDocumentEvents","setup$2","getContentEditableHost","getCollapsedNode","getFocusInElement","normalizeSelection","caretPos","focusBody","hasElementFocus","hasIframeFocus","iframeElement","hasInlineFocus","rawBody","hasUiFocus","hasFocus$1","hasEditorOrUiFocus","focusEditor","quirks","refreshContentEditable","bookmarkRng","contentEditableHost","activateEditor","focus$1","skipFocus","getEndpointElement","real","getStart$2","skipEmptyTextNodes","orig","getNode$1","commonAncestorContainer","getSelectedBlocks","endElm","selectedBlocks","select$1","processRanges","typeLookup","walk$2","isEmptyTextNode$1","AstNode","insert","selfAttrs","cloneAttrs","selfAttr","shortEnded","refNode","makeMap$3","Writer","indent","indentBefore","indent_before","indentAfter","indent_after","entity_encoding","htmlOutput","element_format","cdata","comment","pi","doctype","reset","getContent","HtmlSerializer","writer","handlers","handler","sortedAttrs","elementRule","inner","extractBase64DataUris","dataImageUri","chunks","uris","uri","imageId","restoreDataUris","parseDataUri","decodeURIComponent","isValidPrefixAttrName","isInvalidUri","allow_html_data_urls","findEndTagIndex","startIndex","shortEndedElements","tokenRegExp","isConditionalComment","findCommentEndIndex","lcHtml","endIfIndex","endIndex","endCommentRegexp","checkBogusAttribute","regExp","attrString","SaxParser","fix_self_closing","parseInternal","base64Extract","endRegExp","stack","attrList","textData","isInternalElement","isShortEnded","isValidElement","attribsValue","validAttributesMap","validAttributePatterns","anyAttributesRequired","filteredUrlAttrs","scriptUriRegExp","parsingMode","processEndTag","valid","processText","processComment","allow_conditional_comments","processAttr","processMalformedComment","startTag","parseAttribute","val2","val3","attrRule","trimRegExp","fillAttrsMap","unescape","attrRegExp","selfClosing","self_closing_elements","removeInternalElements","remove_internals","fixSelfClosing","processHtml","matchText","bogusValue","isValidCdataSection","preserve_cdata","findEndTag","SaxParser$1","trimHtml","tempAttrs","trimContentRegExp","trimInternal","bogusAllRegExp","endTagIndex","matchLength","getTempAttrs","trimExternal","trimEmptyContents","emptyRegExp","getContentFromBody","getInner","no_events","getContentInternal","each$7","ElementUtils","attribs","compareObjects","obj1","obj2","isChar","delta","isBeforeSpace","isAfterSpace","isEmptyText","matchesElementPosition","isImageBlock","isCefNode","isBeforeImageBlock","isAfterImageBlock","isBeforeMedia","isAfterMedia","isBeforeTable","isAfterTable","isBeforeContentEditableFalse","isAfterContentEditableFalse","getLastChildren$1","rawNode","removeTrailingBr","allBrs","fillWithPaddingBr","trimBlockTrailingBr","lastChildPrevSibling","dropLast","parentsUntil$1","parents$1","parentsAndSelf","navigateIgnoreEmptyTextNodes","getClosestBlock","isAtBeforeAfterBlockBoundary","newPos","fromBlock","isAtBlockBoundary","isAtStartOfBlock","isAtEndOfBlock","isBeforeBlock","isAfterBlock","isBr$5","findBr","parentBlocks","isBeforeBr","isAfterBr","findPreviousBr","findNextBr","isInMiddleOfText","getClosestBlock$1","hasSpaceBefore","hasSpaceAfter","isPreValue","isInPre","isAtBeginningOfBody","isAtEndOfBody","isAtLineBoundary","needsToHaveNbsp","needsToBeNbspLeft","needsToBeNbspRight","needsToBeNbsp","isNbspAt","hasNbsp","normalizeNbspMiddle","chars","normalizeNbspAtStart","firstPos","normalizeNbspInMiddleOfTextNode","newText","normalizeNbspAtEnd","lastPos","normalizeNbsps","normalizeNbspsInEditor","normalizeContent","isStartOfContent","isEndOfContent","previousCharIsSpace","replaceData","normalizeWhitespaceAfter","whitespaceCount","normalizeWhitespaceBefore","mergeTextNodes","prevNode","normalizeWhitespace","mergeToPrev","whitespaceOffset","newNode","insertData","needsReposition","beforeOrStartOf","afterOrEndOf","getPreviousSiblingCaretPosition","getNextSiblingCaretPosition","findCaretPositionBackwardsFromElm","startPosition","findCaretPositionForwardsFromElm","findCaretPositionBackwards","findCaretPositionForward","findCaretPosition$1","findCaretPosOutsideElmAfterDelete","setSelection","eqRawNode","isBlock$2","paddEmptyBlock","deleteNormalized","afterDeletePosOpt","prevTextOpt","nextTextOpt","isInlineElement","deleteElement","moveCaret","afterDeletePos","parentBlock","normalizedAfterDeletePos","setContent","setCursorLocation","paddPos","tableCellRng","tableSelection","cells","deleteAction","removeTable","emptyCells","deleteCellSelection","isRootFromElement","getClosestCell","getClosestTable","cell","isExpandedCellRng","cellRng","getTableFromCellRng","startParentTable","endParentTable","isSingleCellTable","rows","getTableCells","getCellRng","startCell","endCell","getCellRangeFromStartTable","partialSelection","isWithinSameTable","getTableSelectionFromCellRng","getTableSelection","optCellRng","cRng","getCellIndex","getSelectedCells","isSingleCellTableContentSelected","getAction","getActionFromRange","freefallRtl","deleteCellContents","deleteContents","lastNode","lastBlock","additionalCleanupNodes","deleteTableElement","deleteCellRange","action","deleteCaptionRange","emptyElement","deleteTableRange","getParentCaption","deleteRange","getParentCell","deleteBetweenCells","fromCell","toCell","isDeleteOfLastCharPos","fromCaption","emptyCaretCaption","validateCaretCaption","toCaption","deleteCaretInsideCaption","deleteCaretCells","deleteCaretCaption","isNearTable","isBeforeOrAfterTable","fromPos","deleteCaret","backspaceDelete","createRange$1","normalizeBlockSelectionRange","newEndPos","normalize$2","hasOnlyOneChild","isPaddingNode","isPaddedEmptyBlock","blockElements","isEmptyFragmentElement","nonEmptyElements","isListFragment","cleanupDomFragment","domFragment","toDomFragment","listItems$1","isPadding","isListItemPadded","isEmptyOrPadded","trimListItems","getParentLi","isParentBlockLi","getSplit","beforeRng","afterRng","cloneContents","findFirstIn","caretWalker","newCaretPos","findLastOf","insertMiddle","insertAtCaret","liTarget","liElms","BEGINNING","isAt","trimOrPadLeftRight","isTableCell$4","isTableCellContentSelected","validInsertion","trimBrsFromTableCell","reduceInlineTextElements","merge","textInlineElements","root_1","elementUtils_1","testNode","markFragmentElements","unmarkFragmentElements","isPartOfFragment","canHaveChildren","moveSelectionToMarker","nextRng","getContentEditableFalseParent","parentEditableFalseElm","findNextCaretRng","deleteSelectedContent","insertHtmlAtCaret","details","parser","bookmarkHtml","paste","caretElement","parserArgs","_selectionOverrides","showBlockCaretContainer","invalid","addVisual","traverse","findMatchingNodes","nodeFilters","attributeFilters","nodeMatches","attrMatches","name_2","filter$3","defaultFormat","isTreeNode","moveSelection","setEditorHtml","setContentString","forcedRootBlockName","padd","isRootContent","setContentTree","getNodeFilters","getAttributeFilters","setContentInternal","isEq$2","matchesUnInheritedFormatSelector","formatList","inherit","matchParents","matchNode","matchName","matchItems","itemName","similar","onmatch","matchAll","matchedFormatNames","checkedMap","canApply","defaultBlock","matchAllOnNode","formatNames","matchSimilar","ZWSP$1","CARET_ID$1","importNode","getEmptyCaretContainers","isCaretContainerEmpty","findFirstTextNode","createCaretContainer","fill","trimZwspFromCaretContainer","removeCaretContainerNode","removeCaretContainer","insertCaretContainerNode","formatNode","appendNode","insertFormatNodesIntoCaretContainer","formatNodes","innerMostFormatNode","cleanFormatNode","validFormats","matchedFormats","uniqueFormats","fmtName","clonedFormatNode","applyCaretFormat","wordcharRegex","removeCaretFormat","hasContentAfter","expandedRng","newCaretContainer","cleanedFormatNode","caretTextNode","disableCaretContainer","keyCode","setup$3","replaceWithCaretFormat","innerMost","isFormatElement","inlineElements","isEmptyCaretFormatElement","postProcessHooks","filter$4","each$8","addPostProcessHook","hooks","postProcess","hasPreSibling","pre","isPre","joinPre","pre1","pre2","each$9","isElementNode","findElementSibling","mergeSiblingsNodes","tmpSibling","elementUtils","mergeSiblings","merge_siblings","clearChildStyles","clear_child_styles","links","processChildElements","unwrapEmptySpan","hasStyle","applyStyle","removeResult","MCE_ATTR_RE","each$a","isEq$3","isTableCellOrRow","isChildOfInlineParent","getContainer","lastIdx","normalizeTableSelection","childNode","wrap$2","wrapWithSiblings","matchName$1","isColorFormatAndAnchor","find$3","removeNode$1","rootBlockElm","forcedRootBlock","list_block","forced_root_block_attrs","removeFormatInternal","compareNode","stylesModified","preserve_attributes","attrsToPreserve","remove_similar","valueOut","removeFormat","newName","findFormatRoot","formatRoot","removeFormatFromClone","wrapAndSplit","lastClone","firstClone","formatRootParent","mixed","remove$6","splitToFormatRoot","isRemoveBookmarkNode","lastContentEditable","removeRngStyle","textDecorations","textDecoration","ceFalseOverride","each$b","mergeTextDecorationsAndColor","processTextDecorationsAndColor","mergeBackgroundColorAndFontSize","backgroundColor","mergeSubSup","mergeWithChildren","mergeWithParents","merge_with_parents","each$c","isElementNode$1","applyFormat","setElementFormat","fmt","onformat","styleVal","applyNodeStyle","found","applyRngStyle","nodeSpecific","wrapElm","currentWrapElm","parentName","getChildCount","getChildElementNode","mergeStyles","childCount","curSelNode","forced_root_block","fake","toggle","fromElements","tableModel","tableRow","cellPosition","getSpan","fillout","rowspan","colspan","y2","x2","cellExists","skipCellsX","getWidth","row","findElementPos","extractRows","sx","sy","ey","newRows","subTable","createDomTable","tableElement","tableBody","modelRowsToDomRows","fromDom$1","tableElm","toDom","subsection","findParentListContainer","getFullySelectedListWrappers","_li","listCont","listElm","listStyles","_style","wrap$3","innerElm","wrapped","directListWrappers","commonAnchorContainer","getWrapElements","wrapElements","listWrappers","allWrappers","emptyFragment","getFragmentFromRange","getParentTable","getTableFragment","selectedTableCells","firstCell","lastCell","fullTableModel","sectionedTableModel","getSelectionFragment","read$1","trimLeadingCollapsibleText","isCollapsibleWhitespace","getInnerText","bin","getTextContent","nonRenderedText","parentBlockText","textIndex","hasProceedingSpace","hasTrailingSpace","getSerializedContent","tmpElm","contextual","getSelectedContentInternal","KEEP","INSERT","vDown","vUp","snake","diag","buildScript","start1","end1","start2","end2","middle","getMiddleSnake","i2","buildSnake","sum","getOuterHtml","createFragment$1","insertAt","removeAt","applyDiff","read$2","write","fragments","currentFragments","undoLevelDocument","lazyTempDocument","implementation","createHTMLDocument","hasIframes","createFragmentedLevel","beforeBookmark","createCompleteLevel","createFromEditor","trimmedFragments","trimmed","applyToEditor","level","getLevelContent","getCleanLevelContent","hasEqualContent","level1","level2","hasEqualCleanedContent","isEq$4","isUnlocked","locks","setTyping","typing","endTyping","endTypingLevelIgnoreLocks","beforeChange","addUndoLevel","currentLevel","lastLevel","bm","customUndoRedoLevels","setDirty","clear","extra","callback1","callback2","redo","undo","hasUndo","hasRedo","ignore","isTreeNode$1","runSerializerFiltersOnFragment","getInsertContext","createDummyUndoLevel","makePlainAdaptor","insertContent","getModel","makeRtcAdaptor","tinymceEditor","rtcEditor","defaultVars","unsupported","_undoManager","_locks","_node","_similar","toggleFormat","_args","_details","contextArgs","getSelectedContent","getRawModel","isRtc","plugins","setup$4","editorCast","rtcInstance","rtc","isRemote","getRtcInstanceWithFallback","getRtcInstanceWithError","beforeChange$1","addUndoLevel$1","undo$1","redo$1","clear$1","reset$1","hasUndo$1","hasRedo$1","transact$1","ignore$1","extra$1","applyFormat$1","removeFormat$1","getContent$1","walkPastBookmark","outer","outerElm","oldLength","normalizeTextIfRequired","mergeAndNormalizeText","outerNode","normalizer","innerTextNode","rngSetContent","prevText","nextText","setupArgs","cleanContent","contextBlock","setContent$1","contentArgs","createContextualFragment","deleteFromCallbackMap","newCallbacks","SelectorChanged","selectorChangedData","currentSelectors","selectorChangedWithUnbind","matchedSelectors","isNativeIeSelection","isAttachedToDom","isValidRange","EditorSelection","selectedRange","explicitRange","getRng$1","getEnd$1","bookmarkManager","compareEndPoints","tryCompareBoundaryPoints","how","sourceRange","destinationRange","compareBoundaryPoints","anchorNode","START_TO_START","END_TO_END","ieRange","removeAllRanges","addRange","setBaseAndExtent","focusNode","setNode","getSelectedBlocks$1","isForward","anchorRange","anchorOffset","focusRange","focusOffset","selectorChanged","getScrollContainer","scrollContainer","placeCaretAt","controlSelection","removeAttrs","addFontToSpansFilter","domParser","fontSizes","face","addStrikeToSpanFilter","addFilters","convert_fonts_to_spans","font_size_legacy_values","register$1","inline_styles","blobUriToBlob","rejectWithError","xhr","XMLHttpRequest","open","responseType","response","send","parseDataUri$1","uriParts","buildBlob","atob","Uint8Array","Blob","dataUriToBlob","uriToBlob","blobToDataUri","blob","reader","FileReader","onloadend","readAsDataURL","imageToBlobInfo","blobCache","base64","blobInfo","getByUri","image","dataUri","getByData","getAllImages","ImageScanner","uploadStatus","cachedPromises","images","isUploaded","promises","imageInfo","newPromise","paddEmptyNode","brPreferred","padd_empty_with_br","isPaddedWithNbsp","hasOnlyChild","isPadded","isEmpty$2","whitespaceElements","isLineBreakNode","isBogusImage","isInternalImageSource","isValidDataImg","images_dataimg_filter","imgElem_1","Image","registerBase64ImageFilter","blob_cache","processImage","inputSrc","blobUri","addAttributeFilter","register$2","remove_trailing_brs","prevName","whiteSpaceElements","appendRel","addNoOpener","newRel","allow_unsafe_link_target","allow_html_in_named_anchor","fix_list_elements","classValue","validClassesMap","makeMap$4","each$d","explode$2","extend$2","DomParser","matchedNodes","matchedAttributes","root_name","fixInvalidChildren","newParent","currentNode","tempNode","nonSplitableElements","textBlockElements","fixed","filterNode","list","fi","fl","invalidChildren","isInWhiteSpacePreservedElement","getRootBlockName","rootBlockName","startWhiteSpaceRegExp","endWhiteSpaceRegExp","allWhiteSpaceRegExp","isAllWhiteSpaceRegExp","addRootBlocks","rootBlockNode","createNode","removeWhitespaceBefore","textNodeNext","textVal","cloneAndExcludeBlocks","attrFiltersLen","register$3","htmlParser","internalName","hasChildren","trimTrailingBr","brNode1","brNode2","preProcess","oldDoc","impl","shouldFireEvent","hasEventListeners","addTempAttr","postProcess$1","outArgs","getHtmlFromNode","parseHtml","serializeNode","htmlSerializer","toHtml","DomSerializerImpl","addRules","rules","setRules","DomSerializer","domSerializer","defaultFormat$1","getContent$2","setContent$2","DOM$3","restoreOriginalStyles","orgDisplay","safeDestroy","clearDomReferences","contentAreaContainer","formElement","editorContainer","bodyElement","restoreForm","form","_mceOldSubmit","submit","formEventDelegate","remove$7","editorUpload","save","is_removing","unbindAllNativeEvents","automatic","destroyed","_beforeUnload","theme","hasOwnProperty$2","deep$1","bothObjects","deepMerge","baseMerge","merger","objects","curObject","sectionResult","sections","deviceDetection","legacyMobilePlugins","defaultTouchSettings","table_grid","object_resizing","resize","normalizePlugins","pluginNames","trimmedPlugins","filterLegacyMobilePlugins","extractSections","getSection","sectionSettings","hasSection","isSectionTheme","section","getSectionConfig","getToolbarMode","getDefaultSettings","documentBaseUrl","baseDefaults","toolbar_mode","document_base_url","add_form_submit_trigger","submit_patch","add_unload_trigger","convert_urls","relative_urls","remove_script_host","visual","hidden_input","convertURL","getDefaultMobileSettings","mobileSettings","defaultMobileSettings","toolbar_sticky","defaultPhoneSettings","menubar","getExternalPlugins$1","overrideSettings","userDefinedExternalPlugins","external_plugins","combinePlugins","forcedPlugins","processPlugins","isMobileDevice","defaultOverrideSettings","forced_plugins","desktopPlugins","mobileConfig","mobilePlugins","platformPlugins","combinedPlugins","isOnMobile","combineSettings","defaultSettings","defaultDeviceSettings","mobile","extendedSettings","getEditorSettings","getFiltered","getParamObject","isArrayOf","CreateIconManager","iconPack","icons","IconManager","getProp","propName","rawElm","getComputedSizeProp","getClientWidth","getClientHeight","getMarginTop","getMarginLeft","getBoundingClientRect$1","isInsideElementContentArea","bodyElm","transpose","isXYInContentArea","transposedPoint","fromDomSafe","isEditorAttachedToDom","rawContainer","getContentAreaContainer","NotificationManagerImpl","unimplemented","getArgs","NotificationManager","notifications","getImplementation","getNotificationManagerImpl","getTopNotification","progressBar","addNotification","notification","closeNotification","otherNotification","spec","getEl","getNotifications","serviceMessage","WindowManagerImpl","openUrl","alert","confirm","getParams","setParams","WindowManager","dialogs","getWindowManagerImpl","funcBind","fireOpenEvent","dialog","fireCloseEvent","addDialog","closeDialog","otherDialog","getTopDialog","storeSelectionAndOpenDialog","openDialog","displayNotification","notificationManager","displayError","_skinLoaded","uploadError","logError","createLoadError","pluginLoadError","iconsLoadError","languageLoadError","pluginInitError","initError","isContentCssSkinName","getContentCssUrls","skinUrl","contentCssFile","documentBaseURI","toAbsolute","appendContentCssFromSettings","contentCSS","Uploader","pendingPromises","pathJoin","path1","path2","defaultHandler","progress","withCredentials","credentials","upload","onprogress","loaded","total","json","JSON","responseText","basePath","formData","FormData","filename","noUpload","handlerSuccess","handlerFailure","options","resolvePending","uploadBlobInfo","openNotification","markPending","closeNotification_1","markUploaded","failureOptions","removeFailed","percent","isDefaultHandler","pendingUploadBlobInfo","uploadBlobs","blobInfos","isPending","UploadStatus","PENDING","UPLOADED","blobUriStatuses","createStatus","resultUri","hasBlobUri","getResultUri","count$1","rnd","uuid","BlobCache","mimeToExt","mime","mimes","toBlobInfo","findFirst","cachedBlobInfo","removeByUri","revokeObjectURL","EditorUpload","uploader","imageScanner","urlFilters","aliveGuard","cacheInvalidator","replaceString","replaceImageUrl","targetUrl","replacementUrl","replacementString","replaceUrlInUndoStack","replaceImageUriInView","uploadImages","scanForImages","imageInfos","imagesToRemove","filteredResult","uploadInfo","uploadUri","uploadImagesAuto","isValidDataUriImage","imgElm","dataImgFilter","addFilter","resultItem","replaceBlobUris","source_view","setup$5","registeredFormatListeners","currentFormats","updateAndFireChangeCallbacks","formatChangeData","formatsList","newFormats","remainingFormats","filterRemainingFormats","addListeners","formats","formatChangeItems","removeListeners","formatChanged","get$9","valigntop","verticalAlign","valignmiddle","valignbottom","alignleft","preview","textAlign","aligncenter","marginLeft","marginRight","alignright","alignjustify","bold","fontWeight","italic","fontStyle","underline","strikethrough","forecolor","hilitecolor","fontname","fontFamily","fontsize","fontSize","lineheight","lineHeight","fontsize_class","blockquote","subscript","superscript","_fmt","_itemName","removeformat","FormatRegistry","unregister","each$e","parsedSelectorToHtml","ancestry","sItem","getRequiredParent","elmRule","wrapInHtml","parentCandidate","ancestorName","parentRequired","siblingElm","parseSelectorItem","$0","$3","$4","parseSelector","getCssText","previewFrag","previewCss","parentFontSize","previewStyles","removeVars","previewOpt","previewElm","numValue","setup$6","addShortcut","Formatter","formatChangeState","registerEvents$1","isFirstTypedCharacter","addNonTypingUndoLevel","cmd","command","isDirty","modKey","isInsertReplacementText","inputType","isInsertTextDataNull","isInsertFromPasteOrDrop","addKeyboardShortcuts","UndoManager","nonTypingKeycodes","placeholderAttr","isKeyboardEvent","isDeleteEvent","isNonTypingKeyboardEvent","isTypingKeyboardEvent","isVisuallyEmpty","isForcedRootBlockFalse","firstElementChild","setup$7","placeholder","updatePlaceholder","showPlaceholder","isPlaceholderShown","strongRtl","hasStrongRtl","isInlineTarget","isRtl$1","findInlineParents","findRootInline","hasSameParentBlock","block1","block2","isAtZwsp","normalizePosition","normalizeForwards","normalizeBackwards","isBeforeRoot","getParentBlock$1","placeCaretInEmptyBody","paddEmptyBody","willDeleteLastPositionInElement","normalizedFirstPos","normalizedLastPos","normalizedFromPos","nextPos","prevPos","blockPosition","blockBoundary","getBlockPosition","containerElm","isDifferentBlocks","hasSameParent","parent1","parent2","isEditable","skipLastBr","lastPositionInBlock","readFromRange","fromBlockPos","toBlockPos","blockPos","read$3","getChildrenUntilBlockBoundary","extractChildren","removeEmptyRoot","isEmptyBefore","nestedBlockMerge","toBlock","insertionPoint","sidelongBlockMerge","findInsertionPoint","parentsAndSelf$1","getInsertionPoint","trimBr","mergeBlockInto","mergeBlocks","backspaceDelete$1","deleteRangeMergeBlocks","isRawNodeInTable","isSelectionInTable","isEverythingSelected","noPrevious","noNext","emptyEditor","deleteRange$1","backspaceDelete$2","_forward","isContentEditableTrue$2","isContentEditableFalse$7","showCaret","getNodeRange","renderCaretAtRange","caretPositionNode","caretPositionBeforeNode","ceRoot","renderRangeCaret","isBeforeBoundary","isAfterBoundary","trimEmptyTextNode$1","deleteContentAndShowCaret","peekCaretPosition","caretRange","deleteBoundaryText","getNextPosFn","isBeforeFn","nextCaretPosition","backspaceDelete$3","isCompoundElement","DeleteAction","moveToElement","moveToPosition","isAtContentEditableBlockCaret","caretLocation","isDeleteFromCefDifferentBlocks","deleteEmptyBlockOrMoveToCef","toCefElm","blockElm","findCefPosition","getContentEditableBlockAction","skipMoveToActionFromInlineCefToContent","getContentEditableAction","read$4","deleteElement$1","hideFakeCaret","getAncestorCe","backspaceDeleteCaret","selectedNode","deleteOffscreenSelection","backspaceDeleteRange","hasCefAncestor","paddEmptyElement","backspaceDelete$4","deleteCaret$1","backspaceDelete$5","isText$8","startsWithCaretContainer$1","endsWithCaretContainer$1","createZwsp","insertBefore$1","insertAfter$1","insertInline$1","insertInlineBefore","insertInlineAfter","insertInlinePos","isPosCaretContainer","caretNode","renderCaret","evaluateUntil","fns","Location","rescope","before$4","nPos","isNotInsideFormatCaretContainer","findInsideRootInline","after$3","isValidLocation","readLocation","getName","outside","inside","isEq$5","location1","location2","betweenInlines","fromInline","toInline","skipNoMovement","fromLocation","toLocation","findLocationTraverse","findLocationSimple","findLocation","prevLocation","nextLocation","hasSelectionModifyApi","modify","moveRel","moveByWord","setCaretPosition","setSelected","renderCaretLocation","findLocation$1","isInlineTarget$1","toggleInlines","inlineBoundaries","selectedInlines","targetInlines","safeRemoveCaretContainer","renderInsideInlineCaret","inlines","_inline","move","moveWord","_caret","setupSelectedState","moveNextWord","movePrevWord","rangeFromPositions","hasOnlyTwoOrLessPositionsLeft","setCaretLocation","deleteFromTo","rescope$1","backspaceDeleteCollapsed","toPosition","backspaceDelete$6","getParentInlines","hasOnlyOneChild$1","deleteLastPosition","parentInlines","isFormatElement$1","deleteCaret$2","backspaceDelete$7","deleteElement$2","deleteCaret$3","isNearMedia","deleteRange$2","backspaceDelete$8","isEditable$1","parseIndentValue","number","getIndentStyleName","useMargin","indentStyleName","indentElement","unit","styleValue","validateBlocks","intentValue","canOutdent","getBlocksToIndent","isListComponent","parentIsListComponent","indentation","indentUnit","indentValue","queryCommandState","backspaceDelete$9","nativeCommand","deleteCommand","forwardDeleteCommand","setup$8","addCommand","SIGNIFICANT_MOVE","LONGPRESS_DELAY","getTouch","isFarEnough","distX","distY","setup$9","startData","longpressFired","debounceLongpress","isEqualNode","isBlockElement","isValidTarget","hasBlockParent","shouldRemoveTextNode","rootNodeName","restoreSelection","setup$a","findBlockCaretContainer","removeIeControlRect","blockCaretContainer","handleBlockContainer","setup$b","BreakType","flip","positions","walk$3","getBreakType","currentPos","Br","Block","Wrap","getPositionsUntil","breakType","breakAt","Eol","getAdjacentLinePositions","getPositionsUntilBreak","findClosestHorizontalPositionFromPoint","lastRect","newRect","lastDist","newDist","findClosestHorizontalPosition","targetRect","getPositionsUntilPreviousLine","getPositionsUntilNextLine","isAtFirstLine","isAtLastLine","getPositionsAbove","getPositionsBelow","getFirstLinePositions","getLastLinePositions","getNodeClientRects","toArrayWithNode","VDirection","findUntil$1","walkUntil","isAboveFn","isBeflowFn","line","targetClientRect","aboveLineNumber","lineNumber","isLineNumber","upUntil","Up","downUntil","Down","positionsUntil","isBelowFn","getClientRect","isAboveLine","isLine","isContentEditableFalse$8","findNode$1","distanceToRectLeft","distanceToRectRight","isInsideX","isInsideY","findClosestClientRect","oldClientRect","oldDistance","newDistance","walkUntil$1","includeChildren","findLineNodeRects","targetNodeRect","checkPosFn","lineRects","getFakeCaretTargets","caretInfo","closestFakeCaret","fakeTargetNodeRects","targetNodeRects","closestNodeRect","moveToRange","renderRangeCaretOpt","moveHorizontally","isBefore","isAfter","rangeIsInContainerBlock","moveVertically","caretClientRect","walkerFn","linePositions","nextLinePositions","nextLineRect","dist1","dist2","caretPositions","closestNextLineRect","getLineEndPoint","moveToLineEndPoint","isContentEditableFalse$9","moveToCeFalseHorizontally","moveToCeFalseVertically","createTextBlock","textBlock","exitPreBlock","getVisualCaretPosition$1","newBlock","getHorizontalRange","getVerticalRange","down","moveH","newRange","moveV","moveToLineEndPoint$1","isCefPosition","isTarget","rangeBefore","insertElement","insertBr","insertBlock$1","insertEmptyLine","getClosestTargetBlock","isAtFirstOrLastLine","moveCaretToNewEmptyLine","rootBlockAttrs","moveV$1","defaultPatterns","patterns","matchesEvent","match$1","execute","moveH$1","moveV$2","moveToLineEndPoint$2","deflate","getCorners","getYAxisValue","tds","findClosestCorner","corners","newCorner","oldCorner","oldDist","sqrt","getClosestCell$1","isTargetCorner","corner","getBottomValue","getTopValue","isAbove$1","isBelow$1","getClosestCellAbove","getClosestCellBelow","findClosestPositionInAboveCell","findClosestPositionInBelowCell","hasNextBreak","lineInfo","breakPos","startsWithWrapBreak","startsWithBrBreak","isAtTableCellLine","isAtFirstTableCellLine","isAtLastTableCellLine","isCaretAtStartOrEndOfTable","navigateHorizontally","_td","getClosestAbovePosition","getClosestBelowPosition","getTable","renderBlock","navigateVertically","move$1","mover","moveH$2","moveV$3","executeKeydownOverride","setup$c","executeKeydownOverride$1","executeKeyupOverride","setup$d","firstNonWhiteSpaceNodeSibling","moveToCaretPosition","getEditableRoot","editableRoot","getParentBlock$2","getParentBlockName","isListItemParentBlock","hasFirstChild","hasParent$1","isListBlock","isNestedList","getContainerBlock","containerBlock","containerBlockParent","isFirstOrLastLi","createNewBlock","newBlockName","tmpRng","trimZwsp","isEmptyAnchor","isTableCell$5","emptyBlock","containerAndSiblingName","canSplitBlock","trimInlineElementsOnLeftSideOfBlock","firstChilds","normalizeZwspOffset","includeZwspInRange","trimLeadingLineBreaks","getEditableRoot$1","applyAttributes","forcedRootBlockAttrs","attrStyles","currentStyles","newStyles","attrClassesOpt","attrClasses","currentClassesOpt","currentClasses","filteredClasses","newClasses","appliedAttrs","remainingAttrs","setForcedBlockAttrs","wrapSelfAndSiblingsInDefaultBlock","addBrToBlockIfNeeded","insert$1","parentBlockName","isAfterLastNodeInContainer","clonedNode","isCaretAtStartOrEndOfBlock","normalizedOffset","insertNewBlockAfter","containerBlockName","hasRightSideContent","scrollToBr","brElm","moveSelectionToBr","extraBr","insertBrAtCaret","isControlKey","insertBrBefore","insertBrAfter","hasBrAfter","isBeforeBr$1","isAnchorLink","isInsideAnchor","readInlineAnchorLocation","insertBrOutsideAnchor","insert$2","anchorLocation","shouldInsertBr","shouldBlockNewLine","newLineAction","shouldBlockNewLine$1","_shiftKey","isBrMode","requiredState","brMode","inListBlock","inBlock","inPreBlock","inSummaryBlock","shouldPutBrInPre$1","inBrContext","hasShiftKey","_editor","canInsertIntoEditableRoot","rootEditable","match$2","predicates","isMatch","getAction$1","insert$3","handleEnterKeyEvent","setup$e","executeKeydownOverride$2","setup$f","browser$4","setupIeInput","keypressThrotter","setup$g","isComposing","insertTextAtPosition","insertNbspAtPosition","insertSpaceAtPosition","locationToCaretPosition","insertInlineBoundarySpaceOrNbsp","checkPos","setSelection$1","insertSpaceOrNbspAtSelection","executeKeydownOverride$3","setup$h","registerKeyboardOverrides","setup$i","NodeChange","lastPath","lastRng","nativeRng","fakeRng","isSameElementPath","initialized","currentPath","preventSummaryToggle","filterDetails","setup$j","isTextBlockNode","normalizeSelection$1","setup$k","detail","value$1","isSet","getAbsolutePosition","getBodyPosition","getScrollPosition","getBodyScroll","inlineScroll","iframeScroll","getMousePosition","iframePosition","scrollPosition","calculatePosition","bodyPosition","mousePosition","calc","isContentEditableFalse$a","isContentEditableTrue$3","isDraggable","isValidDropTarget","targetElement","dragElement","cloneElement","cloneElm","createGhost","clonedElm","opacity","overflow","padding","boxSizing","appendGhostToBody","moveGhost","maxX","maxY","overflowX","removeElement","isLeftMouseButtonPressed","applyRelPos","relX","start$1","ceElm","elmPos","dragging","relY","ghost","move$2","throttledPlaceCaretAt","movement","targetPos","getRawTarget","drop","targetClone_1","removeDragState","bindFakeDragEvents","pageDom","dragStartHandler","dragHandler","dropHandler","dragEndHandler","blockIeDrop","realTarget","blockUnsupportedFileDrop","preventFileDrop","defaultPrevented","dataTransfer","types","preventFileDropIfUIElement","editorRoot","eventNames","setup$l","renderFocusCaret","setup$m","isContentEditableTrue$4","isContentEditableFalse$b","getContentEditableRoot$1","SelectionOverrides","fakeCaret","realSelectionId","elementSelectionAttr","selectedElement","isFakeSelectionElement","isFakeSelectionTargetElement","isNearFakeSelectionElement","getRealSelectionElement","setRange","getRange","contentEditableRoot","removeElementSelection","hasNormalCaretPosition","hasBetterMouseTarget","targetBlock","setElementSelection","fakeCaretInfo","normalizeShortEndedElementSelection","isPasteBin","isRangeInCaretContainer","clipboardData","realSelectionElement","clearData","setData","outerText","isWithinCaretContainer","setupOffscreenSelection","targetClone","origTargetClone","$realSelectionContainer","selectElement","nodeElm","afterNode","Quirks","isGecko","isWebKit","mceInternalUrlPrefix","mceInternalDataType","setEditorCommandState","setMceInternalContent","selectionHtml","internalContent","escape","getMceInternalContent","insertClipboardContents","internal","queryCommandSupported","emptyEditorWhenDeleting","serializeRng","allContentsSelected","allRng","allSelection","selectAll","shortcuts","inputMethodFocus","removeHrOnBackspace","Range","body_1","blur","selectControlElements","removeStylesWhenDeletingAcrossBlockElements","getAttributeApplyFunction","template","setAttributeNode","isSelectionAcrossElements","disableBackspaceIntoATable","removeBlockQuoteOnBackSpace","setGeckoEditingOptions","setOpts","addBrAfterLastLinks","fixLinks","setDefaultBlockType","showBrokenImageIcon","contentStyles","restoreFocusOnKeyDown","bodyHeight","blockCmdArrowNavigation","selection_1","disableAutoUrlDetect","tapLinksAndImages","blockFormSubmitInsideEditor","removeAppleInterchangeBrs","ieInternalDragAndDrop","DOM$4","appendStyle","getRootName","removeUndefined","mkParserSettings","mkSerializerSettings","boolean_attributes","move_caret_before_on_enter_elements","non_empty_elements","short_ended_elements","text_inline_elements","whitespace_elements","createParser","autoFocus","auto_focus","moveSelectionToFirstCaretPosition","initEditor","bindPendingEventDelegates","execCallback","getStyleSheetLoader","ui","loadContentCss","preInit","rtcMode","browser_spellcheck","gecko_spellcheck","spellcheck","directionality","protect","startContent","contentCssText_1","content_style","initContentBody","skipWrite","visibility","orgVisibility","iframeHTML","hex_colors","force_hex_style_colors","annotator","_nodeChangeDispatcher","loadingRtc","setProgressState","DOM$5","relaxDomain","ifr","domain","hostname","bodyUuid","domainRelaxUrl","createIframeElement","customAttrs","iframe","frameBorder","allowTransparency","getIframeHtml","getURI","bodyId","bodyClass","createIframe","isDomainRelaxed","iframeContainer","init$1","boxInfo","hidden","DOM$6","initPlugin","initializedPlugins","plugin","Plugin","pluginInstance","trimLegacyPrefix","initPlugins","initIcons","iconPackName","currentIcons","loadIcons","svgData","icon","addIcon","initTheme","Theme","renderFromLoadedTheme","renderUI","renderFromThemeFunc","iframeHeight","createThemeFalseResult","renderThemeFalseIframe","renderThemeFalse","renderThemeUi","init$2","renderInfo","DOM$7","hasSkipLoadPrefix","loadLanguage","scriptLoader","languageCode","languageUrl","url_1","loadTheme","themeUrl","getIconsUrlMetaFromUrl","getIconsUrlMetaFromName","defaultIconsUrl","customIconsUrl","urlMeta","loadPlugins","depPlugin","url_2","getStyleSheetLoader$1","render","snapshot","resetContent","triggerSave","windowManager","set_dirty","ensureIsRoot","ancestor$3","transform","transformed","closest$2","legacyPropNames","getSpecifiedFontProp","getProperty","legacyPropName","normalizeFontFamily","getComputedFontProp","getFontProp","getFontSize","getFontFamily","findFirstCaretElement","getCaretElement","atStartOfNode","mapRange","mapper","fromFontSizeNumber","fontSizeNumber","fontClasses","normalizeFontNames","font","fonts","fontNameAction","fontNameQuery","fontSizeAction","fontSizeQuery","lineHeightQuery","specifiedStyle","computedStyle","lineHeightAction","processValue","insertAtCaret$1","each$f","map$3","inArray$2","EditorCommands","commands","setupCommands","skip_focus","customCommand","queryCommandValue","addCommands","commandList","addQueryStateHandler","addQueryValueHandler","hasCustomCommand","execNativeCommand","isFormatMatch","storeSelection","selectionBookmark","queryCommandEnabled","listParent","hasVisual","anchor","editingHost","selectNodeContents","alignStates","Undo","Redo","internalContentEditableAttr","setContentEditable","switchOffContentEditableTrue","switchOnContentEditableTrue","removeFakeSelection","restoreFakeSelection","toggleReadOnly","isReadOnly$1","registerFilters","registerReadOnlyContentFilters","isClickEvent","isInAnchor","preventReadOnlyEvents","registerReadOnlySelectionBlockers","nativeEvents","EventDispatcher","bindings","toggleEvent","isNative","nameIn","argsIn","beforeFire","wrappedCallback","currentName","bindingName","hi","getEventDispatcher","_eventDispatcher","toggleNativeEvent","Observable","bubble","dispatcherArgs","DOM$8","customEventRootDelegates","getEventTarget","eventName","eventRoot","isListening","fireEvent","bindEventDelegate","delegate","delegates","eventRootElm","editors","EditorObservable","_pendingNativeEvents","defaultModes","switchToMode","activeMode","availableModes","oldMode","newMode","activate","deactivate","editorReadOnly","setMode","registerMode","create$5","design","each$g","explode$3","keyCodeLookup","f1","f2","f3","f4","f5","f6","f7","f8","f9","f10","f11","f12","modifierNames","Shortcuts","pendingPatterns","hasModifier","isFunctionKey","shortcut","matchShortcut","subpatterns","executeShortcutAction","desc","cmdFunc","normalizeCommandFunc","createShortcut","parseShortcut","charCode","access","alt","ctrl","meta","create$6","buttons","menuItems","popups","contextMenus","contextToolbars","sidebars","addButton","addGroupToolbarButton","addToggleButton","addMenuButton","addSplitButton","addMenuItem","addNestedMenuItem","addToggleMenuItem","addAutocompleter","addContextMenu","addContextToolbar","addContextForm","addSidebar","bridge","each$h","trim$4","queryParts","DEFAULT_PORTS","ftp","http","https","mailto","URI","baseUri","base_uri","source","isProtocolRelative","protocol","toAbsPath","urlMatch","part","userInfo","port","uriComponents","pathname","setPath","pathMatch","file","toRelative","relativeUri","tu","uu","toRelPath","noHost","absoluteUri","isSameOrigin","defaultPort","breakPoint","normalizedBase","nb","outPath","normalizedPath","noProtoHost","DOM$9","extend$3","each$i","resolve$3","ie$1","Editor","loadedCSS","isNotDirty","documentBaseURL","base_url","_setBaseUrl","baseURI","referrer_policy","language_load","editorCommands","cache_suffix","modeInstance","callbackLookup","hasPlugin","initialContent","oldState","urlconverter_callback","visual_table_class","visual_anchor_class","_scanForImages","DOM$a","explode$4","each$j","extend$4","instanceCounter","boundGlobalEvents","beforeUnloadDelegate","legacyEditors","isValidLegacyKey","globalEventDelegate","EditorManager","toggleGlobalEvents","removeEditorFromList","targetEditor","oldEditors","purgeDestroyedEditor","isQuirksMode","compatMode","majorVersion","minorVersion","releaseDate","i18n","tinymce","tinyMCEPreInit","srcScript","currentScript","pluginBaseUrls","plugin_base_urls","pluginBaseUrl","invalidInlineTargets","isInvalidInlineTarget","createId","findTargets","targets","forms","editor_deselector","editor_selector","provideResults","initEditors","initCount","createEditor","existingEditor","addI18n","round$1","relativePosition","targetW","targetH","relChars","create$7","findBestRelativePosition","constrainRect","rels","inflate","intersect","cropRect","x1","y1","clamp$1","clampRect","fixedSize","cx2","cy2","underflowX1","underflowY1","overflowX2","overflowY2","fromClientRect","Rect","awaiter","resolveCb","rejectCb","complete","completer","create$8","tasks","resultFns","loadErrMsg","runErrMsg","task","waiter","Resource","each$k","extend$5","extendClass","initializing","Class","_super","mixins","mixin","Mixins","dummy","createMethod","Methods","Properties","fieldName","Statics","Defaults","member","min$1","max$1","round$2","Color","rgb2hsv","minRGB","maxRGB","hsvToRgb","hue","saturation","brightness","side","chroma","toRgb","toHsv","stringify","hexCode","JSONUtils","JSONP","XHR","ready","async","success_scope","error_scope","overrideMimeType","content_type","crossDomain","setRequestHeader","requestheaders","extend$6","JSONRequest","sendRPC","ecb","scb","xhrArgs","method","create$9","storage","getItem","setItem","removeItem","defineProperty","configurable","enumerable","localStorage","LocalStorage","publicApi","geom","util","TreeWalker","Serializer","Selection","isMac","exportToModuleLoaders","exportToWindowGlobal","tinyMCE"],"mappings":"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","sourcesContent":["/**\n * Copyright (c) Tiny Technologies, Inc. All rights reserved.\n * Licensed under the LGPL or a commercial license.\n * For LGPL see License.txt in the project root for license information.\n * For commercial licenses see https://www.tiny.cloud/\n *\n * Version: 5.5.1 (2020-10-01)\n */\n(function () {\n    'use strict';\n\n    var typeOf = function (x) {\n      if (x === null) {\n        return 'null';\n      }\n      if (x === undefined) {\n        return 'undefined';\n      }\n      var t = typeof x;\n      if (t === 'object' && (Array.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'Array')) {\n        return 'array';\n      }\n      if (t === 'object' && (String.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'String')) {\n        return 'string';\n      }\n      return t;\n    };\n    var isEquatableType = function (x) {\n      return [\n        'undefined',\n        'boolean',\n        'number',\n        'string',\n        'function',\n        'xml',\n        'null'\n      ].indexOf(x) !== -1;\n    };\n\n    var sort = function (xs, compareFn) {\n      var clone = Array.prototype.slice.call(xs);\n      return clone.sort(compareFn);\n    };\n\n    var contramap = function (eqa, f) {\n      return eq(function (x, y) {\n        return eqa.eq(f(x), f(y));\n      });\n    };\n    var eq = function (f) {\n      return { eq: f };\n    };\n    var tripleEq = eq(function (x, y) {\n      return x === y;\n    });\n    var eqString = tripleEq;\n    var eqArray = function (eqa) {\n      return eq(function (x, y) {\n        if (x.length !== y.length) {\n          return false;\n        }\n        var len = x.length;\n        for (var i = 0; i < len; i++) {\n          if (!eqa.eq(x[i], y[i])) {\n            return false;\n          }\n        }\n        return true;\n      });\n    };\n    var eqSortedArray = function (eqa, compareFn) {\n      return contramap(eqArray(eqa), function (xs) {\n        return sort(xs, compareFn);\n      });\n    };\n    var eqRecord = function (eqa) {\n      return eq(function (x, y) {\n        var kx = Object.keys(x);\n        var ky = Object.keys(y);\n        if (!eqSortedArray(eqString).eq(kx, ky)) {\n          return false;\n        }\n        var len = kx.length;\n        for (var i = 0; i < len; i++) {\n          var q = kx[i];\n          if (!eqa.eq(x[q], y[q])) {\n            return false;\n          }\n        }\n        return true;\n      });\n    };\n    var eqAny = eq(function (x, y) {\n      if (x === y) {\n        return true;\n      }\n      var tx = typeOf(x);\n      var ty = typeOf(y);\n      if (tx !== ty) {\n        return false;\n      }\n      if (isEquatableType(tx)) {\n        return x === y;\n      } else if (tx === 'array') {\n        return eqArray(eqAny).eq(x, y);\n      } else if (tx === 'object') {\n        return eqRecord(eqAny).eq(x, y);\n      }\n      return false;\n    });\n\n    var noop = function () {\n    };\n    var compose = function (fa, fb) {\n      return function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n          args[_i] = arguments[_i];\n        }\n        return fa(fb.apply(null, args));\n      };\n    };\n    var compose1 = function (fbc, fab) {\n      return function (a) {\n        return fbc(fab(a));\n      };\n    };\n    var constant = function (value) {\n      return function () {\n        return value;\n      };\n    };\n    var identity = function (x) {\n      return x;\n    };\n    function curry(fn) {\n      var initialArgs = [];\n      for (var _i = 1; _i < arguments.length; _i++) {\n        initialArgs[_i - 1] = arguments[_i];\n      }\n      return function () {\n        var restArgs = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n          restArgs[_i] = arguments[_i];\n        }\n        var all = initialArgs.concat(restArgs);\n        return fn.apply(null, all);\n      };\n    }\n    var not = function (f) {\n      return function (t) {\n        return !f(t);\n      };\n    };\n    var die = function (msg) {\n      return function () {\n        throw new Error(msg);\n      };\n    };\n    var never = constant(false);\n    var always = constant(true);\n\n    var none = function () {\n      return NONE;\n    };\n    var NONE = function () {\n      var eq = function (o) {\n        return o.isNone();\n      };\n      var call = function (thunk) {\n        return thunk();\n      };\n      var id = function (n) {\n        return n;\n      };\n      var me = {\n        fold: function (n, _s) {\n          return n();\n        },\n        is: never,\n        isSome: never,\n        isNone: always,\n        getOr: id,\n        getOrThunk: call,\n        getOrDie: function (msg) {\n          throw new Error(msg || 'error: getOrDie called on none.');\n        },\n        getOrNull: constant(null),\n        getOrUndefined: constant(undefined),\n        or: id,\n        orThunk: call,\n        map: none,\n        each: noop,\n        bind: none,\n        exists: never,\n        forall: always,\n        filter: none,\n        equals: eq,\n        equals_: eq,\n        toArray: function () {\n          return [];\n        },\n        toString: constant('none()')\n      };\n      return me;\n    }();\n    var some = function (a) {\n      var constant_a = constant(a);\n      var self = function () {\n        return me;\n      };\n      var bind = function (f) {\n        return f(a);\n      };\n      var me = {\n        fold: function (n, s) {\n          return s(a);\n        },\n        is: function (v) {\n          return a === v;\n        },\n        isSome: always,\n        isNone: never,\n        getOr: constant_a,\n        getOrThunk: constant_a,\n        getOrDie: constant_a,\n        getOrNull: constant_a,\n        getOrUndefined: constant_a,\n        or: self,\n        orThunk: self,\n        map: function (f) {\n          return some(f(a));\n        },\n        each: function (f) {\n          f(a);\n        },\n        bind: bind,\n        exists: bind,\n        forall: bind,\n        filter: function (f) {\n          return f(a) ? me : NONE;\n        },\n        toArray: function () {\n          return [a];\n        },\n        toString: function () {\n          return 'some(' + a + ')';\n        },\n        equals: function (o) {\n          return o.is(a);\n        },\n        equals_: function (o, elementEq) {\n          return o.fold(never, function (b) {\n            return elementEq(a, b);\n          });\n        }\n      };\n      return me;\n    };\n    var from = function (value) {\n      return value === null || value === undefined ? NONE : some(value);\n    };\n    var Optional = {\n      some: some,\n      none: none,\n      from: from\n    };\n\n    var typeOf$1 = function (x) {\n      var t = typeof x;\n      if (x === null) {\n        return 'null';\n      } else if (t === 'object' && (Array.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'Array')) {\n        return 'array';\n      } else if (t === 'object' && (String.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'String')) {\n        return 'string';\n      } else {\n        return t;\n      }\n    };\n    var isType = function (type) {\n      return function (value) {\n        return typeOf$1(value) === type;\n      };\n    };\n    var isSimpleType = function (type) {\n      return function (value) {\n        return typeof value === type;\n      };\n    };\n    var eq$1 = function (t) {\n      return function (a) {\n        return t === a;\n      };\n    };\n    var isString = isType('string');\n    var isObject = isType('object');\n    var isArray = isType('array');\n    var isNull = eq$1(null);\n    var isBoolean = isSimpleType('boolean');\n    var isUndefined = eq$1(undefined);\n    var isNullable = function (a) {\n      return a === null || a === undefined;\n    };\n    var isNonNullable = function (a) {\n      return !isNullable(a);\n    };\n    var isFunction = isSimpleType('function');\n    var isNumber = isSimpleType('number');\n\n    var nativeSlice = Array.prototype.slice;\n    var nativeIndexOf = Array.prototype.indexOf;\n    var nativePush = Array.prototype.push;\n    var rawIndexOf = function (ts, t) {\n      return nativeIndexOf.call(ts, t);\n    };\n    var indexOf = function (xs, x) {\n      var r = rawIndexOf(xs, x);\n      return r === -1 ? Optional.none() : Optional.some(r);\n    };\n    var contains = function (xs, x) {\n      return rawIndexOf(xs, x) > -1;\n    };\n    var exists = function (xs, pred) {\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        if (pred(x, i)) {\n          return true;\n        }\n      }\n      return false;\n    };\n    var map = function (xs, f) {\n      var len = xs.length;\n      var r = new Array(len);\n      for (var i = 0; i < len; i++) {\n        var x = xs[i];\n        r[i] = f(x, i);\n      }\n      return r;\n    };\n    var each = function (xs, f) {\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        f(x, i);\n      }\n    };\n    var eachr = function (xs, f) {\n      for (var i = xs.length - 1; i >= 0; i--) {\n        var x = xs[i];\n        f(x, i);\n      }\n    };\n    var partition = function (xs, pred) {\n      var pass = [];\n      var fail = [];\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        var arr = pred(x, i) ? pass : fail;\n        arr.push(x);\n      }\n      return {\n        pass: pass,\n        fail: fail\n      };\n    };\n    var filter = function (xs, pred) {\n      var r = [];\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        if (pred(x, i)) {\n          r.push(x);\n        }\n      }\n      return r;\n    };\n    var foldr = function (xs, f, acc) {\n      eachr(xs, function (x) {\n        acc = f(acc, x);\n      });\n      return acc;\n    };\n    var foldl = function (xs, f, acc) {\n      each(xs, function (x) {\n        acc = f(acc, x);\n      });\n      return acc;\n    };\n    var findUntil = function (xs, pred, until) {\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        if (pred(x, i)) {\n          return Optional.some(x);\n        } else if (until(x, i)) {\n          break;\n        }\n      }\n      return Optional.none();\n    };\n    var find = function (xs, pred) {\n      return findUntil(xs, pred, never);\n    };\n    var findIndex = function (xs, pred) {\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        if (pred(x, i)) {\n          return Optional.some(i);\n        }\n      }\n      return Optional.none();\n    };\n    var flatten = function (xs) {\n      var r = [];\n      for (var i = 0, len = xs.length; i < len; ++i) {\n        if (!isArray(xs[i])) {\n          throw new Error('Arr.flatten item ' + i + ' was not an array, input: ' + xs);\n        }\n        nativePush.apply(r, xs[i]);\n      }\n      return r;\n    };\n    var bind = function (xs, f) {\n      return flatten(map(xs, f));\n    };\n    var forall = function (xs, pred) {\n      for (var i = 0, len = xs.length; i < len; ++i) {\n        var x = xs[i];\n        if (pred(x, i) !== true) {\n          return false;\n        }\n      }\n      return true;\n    };\n    var reverse = function (xs) {\n      var r = nativeSlice.call(xs, 0);\n      r.reverse();\n      return r;\n    };\n    var difference = function (a1, a2) {\n      return filter(a1, function (x) {\n        return !contains(a2, x);\n      });\n    };\n    var mapToObject = function (xs, f) {\n      var r = {};\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        r[String(x)] = f(x, i);\n      }\n      return r;\n    };\n    var sort$1 = function (xs, comparator) {\n      var copy = nativeSlice.call(xs, 0);\n      copy.sort(comparator);\n      return copy;\n    };\n    var head = function (xs) {\n      return xs.length === 0 ? Optional.none() : Optional.some(xs[0]);\n    };\n    var last = function (xs) {\n      return xs.length === 0 ? Optional.none() : Optional.some(xs[xs.length - 1]);\n    };\n    var from$1 = isFunction(Array.from) ? Array.from : function (x) {\n      return nativeSlice.call(x);\n    };\n\n    var keys = Object.keys;\n    var hasOwnProperty = Object.hasOwnProperty;\n    var each$1 = function (obj, f) {\n      var props = keys(obj);\n      for (var k = 0, len = props.length; k < len; k++) {\n        var i = props[k];\n        var x = obj[i];\n        f(x, i);\n      }\n    };\n    var map$1 = function (obj, f) {\n      return tupleMap(obj, function (x, i) {\n        return {\n          k: i,\n          v: f(x, i)\n        };\n      });\n    };\n    var tupleMap = function (obj, f) {\n      var r = {};\n      each$1(obj, function (x, i) {\n        var tuple = f(x, i);\n        r[tuple.k] = tuple.v;\n      });\n      return r;\n    };\n    var objAcc = function (r) {\n      return function (x, i) {\n        r[i] = x;\n      };\n    };\n    var internalFilter = function (obj, pred, onTrue, onFalse) {\n      var r = {};\n      each$1(obj, function (x, i) {\n        (pred(x, i) ? onTrue : onFalse)(x, i);\n      });\n      return r;\n    };\n    var bifilter = function (obj, pred) {\n      var t = {};\n      var f = {};\n      internalFilter(obj, pred, objAcc(t), objAcc(f));\n      return {\n        t: t,\n        f: f\n      };\n    };\n    var filter$1 = function (obj, pred) {\n      var t = {};\n      internalFilter(obj, pred, objAcc(t), noop);\n      return t;\n    };\n    var mapToArray = function (obj, f) {\n      var r = [];\n      each$1(obj, function (value, name) {\n        r.push(f(value, name));\n      });\n      return r;\n    };\n    var values = function (obj) {\n      return mapToArray(obj, function (v) {\n        return v;\n      });\n    };\n    var get = function (obj, key) {\n      return has(obj, key) ? Optional.from(obj[key]) : Optional.none();\n    };\n    var has = function (obj, key) {\n      return hasOwnProperty.call(obj, key);\n    };\n    var equal = function (a1, a2, eq) {\n      if (eq === void 0) {\n        eq = eqAny;\n      }\n      return eqRecord(eq).eq(a1, a2);\n    };\n\n    var isArray$1 = Array.isArray;\n    var toArray = function (obj) {\n      if (!isArray$1(obj)) {\n        var array = [];\n        for (var i = 0, l = obj.length; i < l; i++) {\n          array[i] = obj[i];\n        }\n        return array;\n      } else {\n        return obj;\n      }\n    };\n    var each$2 = function (o, cb, s) {\n      var n, l;\n      if (!o) {\n        return false;\n      }\n      s = s || o;\n      if (o.length !== undefined) {\n        for (n = 0, l = o.length; n < l; n++) {\n          if (cb.call(s, o[n], n, o) === false) {\n            return false;\n          }\n        }\n      } else {\n        for (n in o) {\n          if (o.hasOwnProperty(n)) {\n            if (cb.call(s, o[n], n, o) === false) {\n              return false;\n            }\n          }\n        }\n      }\n      return true;\n    };\n    var map$2 = function (array, callback) {\n      var out = [];\n      each$2(array, function (item, index) {\n        out.push(callback(item, index, array));\n      });\n      return out;\n    };\n    var filter$2 = function (a, f) {\n      var o = [];\n      each$2(a, function (v, index) {\n        if (!f || f(v, index, a)) {\n          o.push(v);\n        }\n      });\n      return o;\n    };\n    var indexOf$1 = function (a, v) {\n      if (a) {\n        for (var i = 0, l = a.length; i < l; i++) {\n          if (a[i] === v) {\n            return i;\n          }\n        }\n      }\n      return -1;\n    };\n    var reduce = function (collection, iteratee, accumulator, thisArg) {\n      var acc = isUndefined(accumulator) ? collection[0] : accumulator;\n      for (var i = 0; i < collection.length; i++) {\n        acc = iteratee.call(thisArg, acc, collection[i], i);\n      }\n      return acc;\n    };\n    var findIndex$1 = function (array, predicate, thisArg) {\n      var i, l;\n      for (i = 0, l = array.length; i < l; i++) {\n        if (predicate.call(thisArg, array[i], i, array)) {\n          return i;\n        }\n      }\n      return -1;\n    };\n    var last$1 = function (collection) {\n      return collection[collection.length - 1];\n    };\n\n    var __assign = function () {\n      __assign = Object.assign || function __assign(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n          s = arguments[i];\n          for (var p in s)\n            if (Object.prototype.hasOwnProperty.call(s, p))\n              t[p] = s[p];\n        }\n        return t;\n      };\n      return __assign.apply(this, arguments);\n    };\n    function __rest(s, e) {\n      var t = {};\n      for (var p in s)\n        if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n          t[p] = s[p];\n      if (s != null && typeof Object.getOwnPropertySymbols === 'function')\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n          if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n            t[p[i]] = s[p[i]];\n        }\n      return t;\n    }\n    function __spreadArrays() {\n      for (var s = 0, i = 0, il = arguments.length; i < il; i++)\n        s += arguments[i].length;\n      for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n          r[k] = a[j];\n      return r;\n    }\n\n    var cached = function (f) {\n      var called = false;\n      var r;\n      return function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n          args[_i] = arguments[_i];\n        }\n        if (!called) {\n          called = true;\n          r = f.apply(null, args);\n        }\n        return r;\n      };\n    };\n\n    var DeviceType = function (os, browser, userAgent, mediaMatch) {\n      var isiPad = os.isiOS() && /ipad/i.test(userAgent) === true;\n      var isiPhone = os.isiOS() && !isiPad;\n      var isMobile = os.isiOS() || os.isAndroid();\n      var isTouch = isMobile || mediaMatch('(pointer:coarse)');\n      var isTablet = isiPad || !isiPhone && isMobile && mediaMatch('(min-device-width:768px)');\n      var isPhone = isiPhone || isMobile && !isTablet;\n      var iOSwebview = browser.isSafari() && os.isiOS() && /safari/i.test(userAgent) === false;\n      var isDesktop = !isPhone && !isTablet && !iOSwebview;\n      return {\n        isiPad: constant(isiPad),\n        isiPhone: constant(isiPhone),\n        isTablet: constant(isTablet),\n        isPhone: constant(isPhone),\n        isTouch: constant(isTouch),\n        isAndroid: os.isAndroid,\n        isiOS: os.isiOS,\n        isWebView: constant(iOSwebview),\n        isDesktop: constant(isDesktop)\n      };\n    };\n\n    var firstMatch = function (regexes, s) {\n      for (var i = 0; i < regexes.length; i++) {\n        var x = regexes[i];\n        if (x.test(s)) {\n          return x;\n        }\n      }\n      return undefined;\n    };\n    var find$1 = function (regexes, agent) {\n      var r = firstMatch(regexes, agent);\n      if (!r) {\n        return {\n          major: 0,\n          minor: 0\n        };\n      }\n      var group = function (i) {\n        return Number(agent.replace(r, '$' + i));\n      };\n      return nu(group(1), group(2));\n    };\n    var detect = function (versionRegexes, agent) {\n      var cleanedAgent = String(agent).toLowerCase();\n      if (versionRegexes.length === 0) {\n        return unknown();\n      }\n      return find$1(versionRegexes, cleanedAgent);\n    };\n    var unknown = function () {\n      return nu(0, 0);\n    };\n    var nu = function (major, minor) {\n      return {\n        major: major,\n        minor: minor\n      };\n    };\n    var Version = {\n      nu: nu,\n      detect: detect,\n      unknown: unknown\n    };\n\n    var detect$1 = function (candidates, userAgent) {\n      var agent = String(userAgent).toLowerCase();\n      return find(candidates, function (candidate) {\n        return candidate.search(agent);\n      });\n    };\n    var detectBrowser = function (browsers, userAgent) {\n      return detect$1(browsers, userAgent).map(function (browser) {\n        var version = Version.detect(browser.versionRegexes, userAgent);\n        return {\n          current: browser.name,\n          version: version\n        };\n      });\n    };\n    var detectOs = function (oses, userAgent) {\n      return detect$1(oses, userAgent).map(function (os) {\n        var version = Version.detect(os.versionRegexes, userAgent);\n        return {\n          current: os.name,\n          version: version\n        };\n      });\n    };\n    var UaString = {\n      detectBrowser: detectBrowser,\n      detectOs: detectOs\n    };\n\n    var checkRange = function (str, substr, start) {\n      return substr === '' || str.length >= substr.length && str.substr(start, start + substr.length) === substr;\n    };\n    var contains$1 = function (str, substr) {\n      return str.indexOf(substr) !== -1;\n    };\n    var startsWith = function (str, prefix) {\n      return checkRange(str, prefix, 0);\n    };\n    var blank = function (r) {\n      return function (s) {\n        return s.replace(r, '');\n      };\n    };\n    var trim = blank(/^\\s+|\\s+$/g);\n    var lTrim = blank(/^\\s+/g);\n    var rTrim = blank(/\\s+$/g);\n\n    var normalVersionRegex = /.*?version\\/\\ ?([0-9]+)\\.([0-9]+).*/;\n    var checkContains = function (target) {\n      return function (uastring) {\n        return contains$1(uastring, target);\n      };\n    };\n    var browsers = [\n      {\n        name: 'Edge',\n        versionRegexes: [/.*?edge\\/ ?([0-9]+)\\.([0-9]+)$/],\n        search: function (uastring) {\n          return contains$1(uastring, 'edge/') && contains$1(uastring, 'chrome') && contains$1(uastring, 'safari') && contains$1(uastring, 'applewebkit');\n        }\n      },\n      {\n        name: 'Chrome',\n        versionRegexes: [\n          /.*?chrome\\/([0-9]+)\\.([0-9]+).*/,\n          normalVersionRegex\n        ],\n        search: function (uastring) {\n          return contains$1(uastring, 'chrome') && !contains$1(uastring, 'chromeframe');\n        }\n      },\n      {\n        name: 'IE',\n        versionRegexes: [\n          /.*?msie\\ ?([0-9]+)\\.([0-9]+).*/,\n          /.*?rv:([0-9]+)\\.([0-9]+).*/\n        ],\n        search: function (uastring) {\n          return contains$1(uastring, 'msie') || contains$1(uastring, 'trident');\n        }\n      },\n      {\n        name: 'Opera',\n        versionRegexes: [\n          normalVersionRegex,\n          /.*?opera\\/([0-9]+)\\.([0-9]+).*/\n        ],\n        search: checkContains('opera')\n      },\n      {\n        name: 'Firefox',\n        versionRegexes: [/.*?firefox\\/\\ ?([0-9]+)\\.([0-9]+).*/],\n        search: checkContains('firefox')\n      },\n      {\n        name: 'Safari',\n        versionRegexes: [\n          normalVersionRegex,\n          /.*?cpu os ([0-9]+)_([0-9]+).*/\n        ],\n        search: function (uastring) {\n          return (contains$1(uastring, 'safari') || contains$1(uastring, 'mobile/')) && contains$1(uastring, 'applewebkit');\n        }\n      }\n    ];\n    var oses = [\n      {\n        name: 'Windows',\n        search: checkContains('win'),\n        versionRegexes: [/.*?windows\\ nt\\ ?([0-9]+)\\.([0-9]+).*/]\n      },\n      {\n        name: 'iOS',\n        search: function (uastring) {\n          return contains$1(uastring, 'iphone') || contains$1(uastring, 'ipad');\n        },\n        versionRegexes: [\n          /.*?version\\/\\ ?([0-9]+)\\.([0-9]+).*/,\n          /.*cpu os ([0-9]+)_([0-9]+).*/,\n          /.*cpu iphone os ([0-9]+)_([0-9]+).*/\n        ]\n      },\n      {\n        name: 'Android',\n        search: checkContains('android'),\n        versionRegexes: [/.*?android\\ ?([0-9]+)\\.([0-9]+).*/]\n      },\n      {\n        name: 'OSX',\n        search: checkContains('mac os x'),\n        versionRegexes: [/.*?mac\\ os\\ x\\ ?([0-9]+)_([0-9]+).*/]\n      },\n      {\n        name: 'Linux',\n        search: checkContains('linux'),\n        versionRegexes: []\n      },\n      {\n        name: 'Solaris',\n        search: checkContains('sunos'),\n        versionRegexes: []\n      },\n      {\n        name: 'FreeBSD',\n        search: checkContains('freebsd'),\n        versionRegexes: []\n      },\n      {\n        name: 'ChromeOS',\n        search: checkContains('cros'),\n        versionRegexes: [/.*?chrome\\/([0-9]+)\\.([0-9]+).*/]\n      }\n    ];\n    var PlatformInfo = {\n      browsers: constant(browsers),\n      oses: constant(oses)\n    };\n\n    var edge = 'Edge';\n    var chrome = 'Chrome';\n    var ie = 'IE';\n    var opera = 'Opera';\n    var firefox = 'Firefox';\n    var safari = 'Safari';\n    var unknown$1 = function () {\n      return nu$1({\n        current: undefined,\n        version: Version.unknown()\n      });\n    };\n    var nu$1 = function (info) {\n      var current = info.current;\n      var version = info.version;\n      var isBrowser = function (name) {\n        return function () {\n          return current === name;\n        };\n      };\n      return {\n        current: current,\n        version: version,\n        isEdge: isBrowser(edge),\n        isChrome: isBrowser(chrome),\n        isIE: isBrowser(ie),\n        isOpera: isBrowser(opera),\n        isFirefox: isBrowser(firefox),\n        isSafari: isBrowser(safari)\n      };\n    };\n    var Browser = {\n      unknown: unknown$1,\n      nu: nu$1,\n      edge: constant(edge),\n      chrome: constant(chrome),\n      ie: constant(ie),\n      opera: constant(opera),\n      firefox: constant(firefox),\n      safari: constant(safari)\n    };\n\n    var windows = 'Windows';\n    var ios = 'iOS';\n    var android = 'Android';\n    var linux = 'Linux';\n    var osx = 'OSX';\n    var solaris = 'Solaris';\n    var freebsd = 'FreeBSD';\n    var chromeos = 'ChromeOS';\n    var unknown$2 = function () {\n      return nu$2({\n        current: undefined,\n        version: Version.unknown()\n      });\n    };\n    var nu$2 = function (info) {\n      var current = info.current;\n      var version = info.version;\n      var isOS = function (name) {\n        return function () {\n          return current === name;\n        };\n      };\n      return {\n        current: current,\n        version: version,\n        isWindows: isOS(windows),\n        isiOS: isOS(ios),\n        isAndroid: isOS(android),\n        isOSX: isOS(osx),\n        isLinux: isOS(linux),\n        isSolaris: isOS(solaris),\n        isFreeBSD: isOS(freebsd),\n        isChromeOS: isOS(chromeos)\n      };\n    };\n    var OperatingSystem = {\n      unknown: unknown$2,\n      nu: nu$2,\n      windows: constant(windows),\n      ios: constant(ios),\n      android: constant(android),\n      linux: constant(linux),\n      osx: constant(osx),\n      solaris: constant(solaris),\n      freebsd: constant(freebsd),\n      chromeos: constant(chromeos)\n    };\n\n    var detect$2 = function (userAgent, mediaMatch) {\n      var browsers = PlatformInfo.browsers();\n      var oses = PlatformInfo.oses();\n      var browser = UaString.detectBrowser(browsers, userAgent).fold(Browser.unknown, Browser.nu);\n      var os = UaString.detectOs(oses, userAgent).fold(OperatingSystem.unknown, OperatingSystem.nu);\n      var deviceType = DeviceType(os, browser, userAgent, mediaMatch);\n      return {\n        browser: browser,\n        os: os,\n        deviceType: deviceType\n      };\n    };\n    var PlatformDetection = { detect: detect$2 };\n\n    var mediaMatch = function (query) {\n      return window.matchMedia(query).matches;\n    };\n    var platform = cached(function () {\n      return PlatformDetection.detect(navigator.userAgent, mediaMatch);\n    });\n    var detect$3 = function () {\n      return platform();\n    };\n\n    var userAgent = navigator.userAgent;\n    var platform$1 = detect$3();\n    var browser = platform$1.browser;\n    var os = platform$1.os;\n    var deviceType = platform$1.deviceType;\n    var webkit = /WebKit/.test(userAgent) && !browser.isEdge();\n    var fileApi = 'FormData' in window && 'FileReader' in window && 'URL' in window && !!URL.createObjectURL;\n    var windowsPhone = userAgent.indexOf('Windows Phone') !== -1;\n    var Env = {\n      opera: browser.isOpera(),\n      webkit: webkit,\n      ie: browser.isIE() || browser.isEdge() ? browser.version.major : false,\n      gecko: browser.isFirefox(),\n      mac: os.isOSX() || os.isiOS(),\n      iOS: deviceType.isiPad() || deviceType.isiPhone(),\n      android: os.isAndroid(),\n      contentEditable: true,\n      transparentSrc: 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7',\n      caretAfter: true,\n      range: window.getSelection && 'Range' in window,\n      documentMode: browser.isIE() ? document.documentMode || 7 : 10,\n      fileApi: fileApi,\n      ceFalse: true,\n      cacheSuffix: null,\n      container: null,\n      experimentalShadowDom: false,\n      canHaveCSP: !browser.isIE(),\n      desktop: deviceType.isDesktop(),\n      windowsPhone: windowsPhone,\n      browser: {\n        current: browser.current,\n        version: browser.version,\n        isChrome: browser.isChrome,\n        isEdge: browser.isEdge,\n        isFirefox: browser.isFirefox,\n        isIE: browser.isIE,\n        isOpera: browser.isOpera,\n        isSafari: browser.isSafari\n      },\n      os: {\n        current: os.current,\n        version: os.version,\n        isAndroid: os.isAndroid,\n        isChromeOS: os.isChromeOS,\n        isFreeBSD: os.isFreeBSD,\n        isiOS: os.isiOS,\n        isLinux: os.isLinux,\n        isOSX: os.isOSX,\n        isSolaris: os.isSolaris,\n        isWindows: os.isWindows\n      },\n      deviceType: {\n        isDesktop: deviceType.isDesktop,\n        isiPad: deviceType.isiPad,\n        isiPhone: deviceType.isiPhone,\n        isPhone: deviceType.isPhone,\n        isTablet: deviceType.isTablet,\n        isTouch: deviceType.isTouch,\n        isWebView: deviceType.isWebView\n      }\n    };\n\n    var whiteSpaceRegExp = /^\\s*|\\s*$/g;\n    var trim$1 = function (str) {\n      return str === null || str === undefined ? '' : ('' + str).replace(whiteSpaceRegExp, '');\n    };\n    var is = function (obj, type) {\n      if (!type) {\n        return obj !== undefined;\n      }\n      if (type === 'array' && isArray$1(obj)) {\n        return true;\n      }\n      return typeof obj === type;\n    };\n    var makeMap = function (items, delim, map) {\n      var i;\n      items = items || [];\n      delim = delim || ',';\n      if (typeof items === 'string') {\n        items = items.split(delim);\n      }\n      map = map || {};\n      i = items.length;\n      while (i--) {\n        map[items[i]] = {};\n      }\n      return map;\n    };\n    var hasOwnProperty$1 = function (obj, prop) {\n      return Object.prototype.hasOwnProperty.call(obj, prop);\n    };\n    var create = function (s, p, root) {\n      var self = this;\n      var sp, scn, c, de = 0;\n      s = /^((static) )?([\\w.]+)(:([\\w.]+))?/.exec(s);\n      var cn = s[3].match(/(^|\\.)(\\w+)$/i)[2];\n      var ns = self.createNS(s[3].replace(/\\.\\w+$/, ''), root);\n      if (ns[cn]) {\n        return;\n      }\n      if (s[2] === 'static') {\n        ns[cn] = p;\n        if (this.onCreate) {\n          this.onCreate(s[2], s[3], ns[cn]);\n        }\n        return;\n      }\n      if (!p[cn]) {\n        p[cn] = function () {\n        };\n        de = 1;\n      }\n      ns[cn] = p[cn];\n      self.extend(ns[cn].prototype, p);\n      if (s[5]) {\n        sp = self.resolve(s[5]).prototype;\n        scn = s[5].match(/\\.(\\w+)$/i)[1];\n        c = ns[cn];\n        if (de) {\n          ns[cn] = function () {\n            return sp[scn].apply(this, arguments);\n          };\n        } else {\n          ns[cn] = function () {\n            this.parent = sp[scn];\n            return c.apply(this, arguments);\n          };\n        }\n        ns[cn].prototype[cn] = ns[cn];\n        self.each(sp, function (f, n) {\n          ns[cn].prototype[n] = sp[n];\n        });\n        self.each(p, function (f, n) {\n          if (sp[n]) {\n            ns[cn].prototype[n] = function () {\n              this.parent = sp[n];\n              return f.apply(this, arguments);\n            };\n          } else {\n            if (n !== cn) {\n              ns[cn].prototype[n] = f;\n            }\n          }\n        });\n      }\n      self.each(p.static, function (f, n) {\n        ns[cn][n] = f;\n      });\n    };\n    var extend = function (obj) {\n      var exts = [];\n      for (var _i = 1; _i < arguments.length; _i++) {\n        exts[_i - 1] = arguments[_i];\n      }\n      for (var i = 0; i < exts.length; i++) {\n        var ext = exts[i];\n        for (var name_1 in ext) {\n          if (ext.hasOwnProperty(name_1)) {\n            var value = ext[name_1];\n            if (value !== undefined) {\n              obj[name_1] = value;\n            }\n          }\n        }\n      }\n      return obj;\n    };\n    var walk = function (o, f, n, s) {\n      s = s || this;\n      if (o) {\n        if (n) {\n          o = o[n];\n        }\n        each$2(o, function (o, i) {\n          if (f.call(s, o, i, n) === false) {\n            return false;\n          }\n          walk(o, f, n, s);\n        });\n      }\n    };\n    var createNS = function (n, o) {\n      var i, v;\n      o = o || window;\n      n = n.split('.');\n      for (i = 0; i < n.length; i++) {\n        v = n[i];\n        if (!o[v]) {\n          o[v] = {};\n        }\n        o = o[v];\n      }\n      return o;\n    };\n    var resolve = function (n, o) {\n      var i, l;\n      o = o || window;\n      n = n.split('.');\n      for (i = 0, l = n.length; i < l; i++) {\n        o = o[n[i]];\n        if (!o) {\n          break;\n        }\n      }\n      return o;\n    };\n    var explode = function (s, d) {\n      if (!s || is(s, 'array')) {\n        return s;\n      }\n      return map$2(s.split(d || ','), trim$1);\n    };\n    var _addCacheSuffix = function (url) {\n      var cacheSuffix = Env.cacheSuffix;\n      if (cacheSuffix) {\n        url += (url.indexOf('?') === -1 ? '?' : '&') + cacheSuffix;\n      }\n      return url;\n    };\n    var Tools = {\n      trim: trim$1,\n      isArray: isArray$1,\n      is: is,\n      toArray: toArray,\n      makeMap: makeMap,\n      each: each$2,\n      map: map$2,\n      grep: filter$2,\n      inArray: indexOf$1,\n      hasOwn: hasOwnProperty$1,\n      extend: extend,\n      create: create,\n      walk: walk,\n      createNS: createNS,\n      resolve: resolve,\n      explode: explode,\n      _addCacheSuffix: _addCacheSuffix\n    };\n\n    var fromHtml = function (html, scope) {\n      var doc = scope || document;\n      var div = doc.createElement('div');\n      div.innerHTML = html;\n      if (!div.hasChildNodes() || div.childNodes.length > 1) {\n        console.error('HTML does not have a single root node', html);\n        throw new Error('HTML must have a single root node');\n      }\n      return fromDom(div.childNodes[0]);\n    };\n    var fromTag = function (tag, scope) {\n      var doc = scope || document;\n      var node = doc.createElement(tag);\n      return fromDom(node);\n    };\n    var fromText = function (text, scope) {\n      var doc = scope || document;\n      var node = doc.createTextNode(text);\n      return fromDom(node);\n    };\n    var fromDom = function (node) {\n      if (node === null || node === undefined) {\n        throw new Error('Node cannot be null or undefined');\n      }\n      return { dom: node };\n    };\n    var fromPoint = function (docElm, x, y) {\n      return Optional.from(docElm.dom.elementFromPoint(x, y)).map(fromDom);\n    };\n    var SugarElement = {\n      fromHtml: fromHtml,\n      fromTag: fromTag,\n      fromText: fromText,\n      fromDom: fromDom,\n      fromPoint: fromPoint\n    };\n\n    var toArray$1 = function (target, f) {\n      var r = [];\n      var recurse = function (e) {\n        r.push(e);\n        return f(e);\n      };\n      var cur = f(target);\n      do {\n        cur = cur.bind(recurse);\n      } while (cur.isSome());\n      return r;\n    };\n\n    var compareDocumentPosition = function (a, b, match) {\n      return (a.compareDocumentPosition(b) & match) !== 0;\n    };\n    var documentPositionContainedBy = function (a, b) {\n      return compareDocumentPosition(a, b, Node.DOCUMENT_POSITION_CONTAINED_BY);\n    };\n\n    var COMMENT = 8;\n    var DOCUMENT = 9;\n    var DOCUMENT_FRAGMENT = 11;\n    var ELEMENT = 1;\n    var TEXT = 3;\n\n    var is$1 = function (element, selector) {\n      var dom = element.dom;\n      if (dom.nodeType !== ELEMENT) {\n        return false;\n      } else {\n        var elem = dom;\n        if (elem.matches !== undefined) {\n          return elem.matches(selector);\n        } else if (elem.msMatchesSelector !== undefined) {\n          return elem.msMatchesSelector(selector);\n        } else if (elem.webkitMatchesSelector !== undefined) {\n          return elem.webkitMatchesSelector(selector);\n        } else if (elem.mozMatchesSelector !== undefined) {\n          return elem.mozMatchesSelector(selector);\n        } else {\n          throw new Error('Browser lacks native selectors');\n        }\n      }\n    };\n    var bypassSelector = function (dom) {\n      return dom.nodeType !== ELEMENT && dom.nodeType !== DOCUMENT && dom.nodeType !== DOCUMENT_FRAGMENT || dom.childElementCount === 0;\n    };\n    var all = function (selector, scope) {\n      var base = scope === undefined ? document : scope.dom;\n      return bypassSelector(base) ? [] : map(base.querySelectorAll(selector), SugarElement.fromDom);\n    };\n    var one = function (selector, scope) {\n      var base = scope === undefined ? document : scope.dom;\n      return bypassSelector(base) ? Optional.none() : Optional.from(base.querySelector(selector)).map(SugarElement.fromDom);\n    };\n\n    var eq$2 = function (e1, e2) {\n      return e1.dom === e2.dom;\n    };\n    var regularContains = function (e1, e2) {\n      var d1 = e1.dom;\n      var d2 = e2.dom;\n      return d1 === d2 ? false : d1.contains(d2);\n    };\n    var ieContains = function (e1, e2) {\n      return documentPositionContainedBy(e1.dom, e2.dom);\n    };\n    var contains$2 = function (e1, e2) {\n      return detect$3().browser.isIE() ? ieContains(e1, e2) : regularContains(e1, e2);\n    };\n\n    var Global = typeof window !== 'undefined' ? window : Function('return this;')();\n\n    var name = function (element) {\n      var r = element.dom.nodeName;\n      return r.toLowerCase();\n    };\n    var type = function (element) {\n      return element.dom.nodeType;\n    };\n    var isType$1 = function (t) {\n      return function (element) {\n        return type(element) === t;\n      };\n    };\n    var isComment = function (element) {\n      return type(element) === COMMENT || name(element) === '#comment';\n    };\n    var isElement = isType$1(ELEMENT);\n    var isText = isType$1(TEXT);\n    var isDocument = isType$1(DOCUMENT);\n    var isDocumentFragment = isType$1(DOCUMENT_FRAGMENT);\n\n    var owner = function (element) {\n      return SugarElement.fromDom(element.dom.ownerDocument);\n    };\n    var documentOrOwner = function (dos) {\n      return isDocument(dos) ? dos : owner(dos);\n    };\n    var documentElement = function (element) {\n      return SugarElement.fromDom(documentOrOwner(element).dom.documentElement);\n    };\n    var defaultView = function (element) {\n      return SugarElement.fromDom(documentOrOwner(element).dom.defaultView);\n    };\n    var parent = function (element) {\n      return Optional.from(element.dom.parentNode).map(SugarElement.fromDom);\n    };\n    var parents = function (element, isRoot) {\n      var stop = isFunction(isRoot) ? isRoot : never;\n      var dom = element.dom;\n      var ret = [];\n      while (dom.parentNode !== null && dom.parentNode !== undefined) {\n        var rawParent = dom.parentNode;\n        var p = SugarElement.fromDom(rawParent);\n        ret.push(p);\n        if (stop(p) === true) {\n          break;\n        } else {\n          dom = rawParent;\n        }\n      }\n      return ret;\n    };\n    var siblings = function (element) {\n      var filterSelf = function (elements) {\n        return filter(elements, function (x) {\n          return !eq$2(element, x);\n        });\n      };\n      return parent(element).map(children).map(filterSelf).getOr([]);\n    };\n    var prevSibling = function (element) {\n      return Optional.from(element.dom.previousSibling).map(SugarElement.fromDom);\n    };\n    var nextSibling = function (element) {\n      return Optional.from(element.dom.nextSibling).map(SugarElement.fromDom);\n    };\n    var prevSiblings = function (element) {\n      return reverse(toArray$1(element, prevSibling));\n    };\n    var nextSiblings = function (element) {\n      return toArray$1(element, nextSibling);\n    };\n    var children = function (element) {\n      return map(element.dom.childNodes, SugarElement.fromDom);\n    };\n    var child = function (element, index) {\n      var cs = element.dom.childNodes;\n      return Optional.from(cs[index]).map(SugarElement.fromDom);\n    };\n    var firstChild = function (element) {\n      return child(element, 0);\n    };\n    var lastChild = function (element) {\n      return child(element, element.dom.childNodes.length - 1);\n    };\n    var childNodesCount = function (element) {\n      return element.dom.childNodes.length;\n    };\n\n    var getHead = function (doc) {\n      var b = doc.dom.head;\n      if (b === null || b === undefined) {\n        throw new Error('Head is not available yet');\n      }\n      return SugarElement.fromDom(b);\n    };\n\n    var isShadowRoot = function (dos) {\n      return isDocumentFragment(dos);\n    };\n    var supported = isFunction(Element.prototype.attachShadow) && isFunction(Node.prototype.getRootNode);\n    var isSupported = constant(supported);\n    var getRootNode = supported ? function (e) {\n      return SugarElement.fromDom(e.dom.getRootNode());\n    } : documentOrOwner;\n    var getStyleContainer = function (dos) {\n      return isShadowRoot(dos) ? dos : getHead(documentOrOwner(dos));\n    };\n    var getShadowRoot = function (e) {\n      var r = getRootNode(e);\n      return isShadowRoot(r) ? Optional.some(r) : Optional.none();\n    };\n    var getShadowHost = function (e) {\n      return SugarElement.fromDom(e.dom.host);\n    };\n    var getOriginalEventTarget = function (event) {\n      if (isSupported() && isNonNullable(event.target)) {\n        var el = SugarElement.fromDom(event.target);\n        if (isElement(el) && isOpenShadowHost(el)) {\n          if (event.composed && event.composedPath) {\n            var composedPath = event.composedPath();\n            if (composedPath) {\n              return head(composedPath);\n            }\n          }\n        }\n      }\n      return Optional.from(event.target);\n    };\n    var isOpenShadowHost = function (element) {\n      return isNonNullable(element.dom.shadowRoot);\n    };\n\n    var before = function (marker, element) {\n      var parent$1 = parent(marker);\n      parent$1.each(function (v) {\n        v.dom.insertBefore(element.dom, marker.dom);\n      });\n    };\n    var after = function (marker, element) {\n      var sibling = nextSibling(marker);\n      sibling.fold(function () {\n        var parent$1 = parent(marker);\n        parent$1.each(function (v) {\n          append(v, element);\n        });\n      }, function (v) {\n        before(v, element);\n      });\n    };\n    var prepend = function (parent, element) {\n      var firstChild$1 = firstChild(parent);\n      firstChild$1.fold(function () {\n        append(parent, element);\n      }, function (v) {\n        parent.dom.insertBefore(element.dom, v.dom);\n      });\n    };\n    var append = function (parent, element) {\n      parent.dom.appendChild(element.dom);\n    };\n    var wrap = function (element, wrapper) {\n      before(element, wrapper);\n      append(wrapper, element);\n    };\n\n    var before$1 = function (marker, elements) {\n      each(elements, function (x) {\n        before(marker, x);\n      });\n    };\n    var append$1 = function (parent, elements) {\n      each(elements, function (x) {\n        append(parent, x);\n      });\n    };\n\n    var empty = function (element) {\n      element.dom.textContent = '';\n      each(children(element), function (rogue) {\n        remove(rogue);\n      });\n    };\n    var remove = function (element) {\n      var dom = element.dom;\n      if (dom.parentNode !== null) {\n        dom.parentNode.removeChild(dom);\n      }\n    };\n    var unwrap = function (wrapper) {\n      var children$1 = children(wrapper);\n      if (children$1.length > 0) {\n        before$1(wrapper, children$1);\n      }\n      remove(wrapper);\n    };\n\n    var inBody = function (element) {\n      var dom = isText(element) ? element.dom.parentNode : element.dom;\n      if (dom === undefined || dom === null || dom.ownerDocument === null) {\n        return false;\n      }\n      var doc = dom.ownerDocument;\n      return getShadowRoot(SugarElement.fromDom(dom)).fold(function () {\n        return doc.body.contains(dom);\n      }, compose1(inBody, getShadowHost));\n    };\n\n    var r = function (left, top) {\n      var translate = function (x, y) {\n        return r(left + x, top + y);\n      };\n      return {\n        left: left,\n        top: top,\n        translate: translate\n      };\n    };\n    var SugarPosition = r;\n\n    var boxPosition = function (dom) {\n      var box = dom.getBoundingClientRect();\n      return SugarPosition(box.left, box.top);\n    };\n    var firstDefinedOrZero = function (a, b) {\n      if (a !== undefined) {\n        return a;\n      } else {\n        return b !== undefined ? b : 0;\n      }\n    };\n    var absolute = function (element) {\n      var doc = element.dom.ownerDocument;\n      var body = doc.body;\n      var win = doc.defaultView;\n      var html = doc.documentElement;\n      if (body === element.dom) {\n        return SugarPosition(body.offsetLeft, body.offsetTop);\n      }\n      var scrollTop = firstDefinedOrZero(win === null || win === void 0 ? void 0 : win.pageYOffset, html.scrollTop);\n      var scrollLeft = firstDefinedOrZero(win === null || win === void 0 ? void 0 : win.pageXOffset, html.scrollLeft);\n      var clientTop = firstDefinedOrZero(html.clientTop, body.clientTop);\n      var clientLeft = firstDefinedOrZero(html.clientLeft, body.clientLeft);\n      return viewport(element).translate(scrollLeft - clientLeft, scrollTop - clientTop);\n    };\n    var viewport = function (element) {\n      var dom = element.dom;\n      var doc = dom.ownerDocument;\n      var body = doc.body;\n      if (body === dom) {\n        return SugarPosition(body.offsetLeft, body.offsetTop);\n      }\n      if (!inBody(element)) {\n        return SugarPosition(0, 0);\n      }\n      return boxPosition(dom);\n    };\n\n    var get$1 = function (_DOC) {\n      var doc = _DOC !== undefined ? _DOC.dom : document;\n      var x = doc.body.scrollLeft || doc.documentElement.scrollLeft;\n      var y = doc.body.scrollTop || doc.documentElement.scrollTop;\n      return SugarPosition(x, y);\n    };\n    var to = function (x, y, _DOC) {\n      var doc = _DOC !== undefined ? _DOC.dom : document;\n      var win = doc.defaultView;\n      if (win) {\n        win.scrollTo(x, y);\n      }\n    };\n    var intoView = function (element, alignToTop) {\n      var isSafari = detect$3().browser.isSafari();\n      if (isSafari && isFunction(element.dom.scrollIntoViewIfNeeded)) {\n        element.dom.scrollIntoViewIfNeeded(false);\n      } else {\n        element.dom.scrollIntoView(alignToTop);\n      }\n    };\n\n    var get$2 = function (_win) {\n      var win = _win === undefined ? window : _win;\n      return Optional.from(win['visualViewport']);\n    };\n    var bounds = function (x, y, width, height) {\n      return {\n        x: x,\n        y: y,\n        width: width,\n        height: height,\n        right: x + width,\n        bottom: y + height\n      };\n    };\n    var getBounds = function (_win) {\n      var win = _win === undefined ? window : _win;\n      var doc = win.document;\n      var scroll = get$1(SugarElement.fromDom(doc));\n      return get$2(win).fold(function () {\n        var html = win.document.documentElement;\n        var width = html.clientWidth;\n        var height = html.clientHeight;\n        return bounds(scroll.left, scroll.top, width, height);\n      }, function (visualViewport) {\n        return bounds(Math.max(visualViewport.pageLeft, scroll.left), Math.max(visualViewport.pageTop, scroll.top), visualViewport.width, visualViewport.height);\n      });\n    };\n\n    var isNodeType = function (type) {\n      return function (node) {\n        return !!node && node.nodeType === type;\n      };\n    };\n    var isRestrictedNode = function (node) {\n      return !!node && !Object.getPrototypeOf(node);\n    };\n    var isElement$1 = isNodeType(1);\n    var matchNodeNames = function (names) {\n      var lowercasedNames = names.map(function (s) {\n        return s.toLowerCase();\n      });\n      return function (node) {\n        if (node && node.nodeName) {\n          var nodeName = node.nodeName.toLowerCase();\n          return contains(lowercasedNames, nodeName);\n        }\n        return false;\n      };\n    };\n    var matchStyleValues = function (name, values) {\n      var items = values.toLowerCase().split(' ');\n      return function (node) {\n        var i, cssValue;\n        if (isElement$1(node)) {\n          for (i = 0; i < items.length; i++) {\n            var computed = node.ownerDocument.defaultView.getComputedStyle(node, null);\n            cssValue = computed ? computed.getPropertyValue(name) : null;\n            if (cssValue === items[i]) {\n              return true;\n            }\n          }\n        }\n        return false;\n      };\n    };\n    var hasAttribute = function (attrName) {\n      return function (node) {\n        return isElement$1(node) && node.hasAttribute(attrName);\n      };\n    };\n    var hasAttributeValue = function (attrName, attrValue) {\n      return function (node) {\n        return isElement$1(node) && node.getAttribute(attrName) === attrValue;\n      };\n    };\n    var isBogus = function (node) {\n      return isElement$1(node) && node.hasAttribute('data-mce-bogus');\n    };\n    var isBogusAll = function (node) {\n      return isElement$1(node) && node.getAttribute('data-mce-bogus') === 'all';\n    };\n    var isTable = function (node) {\n      return isElement$1(node) && node.tagName === 'TABLE';\n    };\n    var hasContentEditableState = function (value) {\n      return function (node) {\n        if (isElement$1(node)) {\n          if (node.contentEditable === value) {\n            return true;\n          }\n          if (node.getAttribute('data-mce-contenteditable') === value) {\n            return true;\n          }\n        }\n        return false;\n      };\n    };\n    var isTextareaOrInput = matchNodeNames([\n      'textarea',\n      'input'\n    ]);\n    var isText$1 = isNodeType(3);\n    var isComment$1 = isNodeType(8);\n    var isDocument$1 = isNodeType(9);\n    var isDocumentFragment$1 = isNodeType(11);\n    var isBr = matchNodeNames(['br']);\n    var isImg = matchNodeNames(['img']);\n    var isContentEditableTrue = hasContentEditableState('true');\n    var isContentEditableFalse = hasContentEditableState('false');\n    var isTableCell = matchNodeNames([\n      'td',\n      'th'\n    ]);\n    var isMedia = matchNodeNames([\n      'video',\n      'audio',\n      'object',\n      'embed'\n    ]);\n\n    var isSupported$1 = function (dom) {\n      return dom.style !== undefined && isFunction(dom.style.getPropertyValue);\n    };\n\n    var rawSet = function (dom, key, value) {\n      if (isString(value) || isBoolean(value) || isNumber(value)) {\n        dom.setAttribute(key, value + '');\n      } else {\n        console.error('Invalid call to Attribute.set. Key ', key, ':: Value ', value, ':: Element ', dom);\n        throw new Error('Attribute value was not simple');\n      }\n    };\n    var set = function (element, key, value) {\n      rawSet(element.dom, key, value);\n    };\n    var setAll = function (element, attrs) {\n      var dom = element.dom;\n      each$1(attrs, function (v, k) {\n        rawSet(dom, k, v);\n      });\n    };\n    var get$3 = function (element, key) {\n      var v = element.dom.getAttribute(key);\n      return v === null ? undefined : v;\n    };\n    var getOpt = function (element, key) {\n      return Optional.from(get$3(element, key));\n    };\n    var has$1 = function (element, key) {\n      var dom = element.dom;\n      return dom && dom.hasAttribute ? dom.hasAttribute(key) : false;\n    };\n    var remove$1 = function (element, key) {\n      element.dom.removeAttribute(key);\n    };\n    var clone = function (element) {\n      return foldl(element.dom.attributes, function (acc, attr) {\n        acc[attr.name] = attr.value;\n        return acc;\n      }, {});\n    };\n\n    var internalSet = function (dom, property, value) {\n      if (!isString(value)) {\n        console.error('Invalid call to CSS.set. Property ', property, ':: Value ', value, ':: Element ', dom);\n        throw new Error('CSS value must be a string: ' + value);\n      }\n      if (isSupported$1(dom)) {\n        dom.style.setProperty(property, value);\n      }\n    };\n    var setAll$1 = function (element, css) {\n      var dom = element.dom;\n      each$1(css, function (v, k) {\n        internalSet(dom, k, v);\n      });\n    };\n    var get$4 = function (element, property) {\n      var dom = element.dom;\n      var styles = window.getComputedStyle(dom);\n      var r = styles.getPropertyValue(property);\n      return r === '' && !inBody(element) ? getUnsafeProperty(dom, property) : r;\n    };\n    var getUnsafeProperty = function (dom, property) {\n      return isSupported$1(dom) ? dom.style.getPropertyValue(property) : '';\n    };\n    var getRaw = function (element, property) {\n      var dom = element.dom;\n      var raw = getUnsafeProperty(dom, property);\n      return Optional.from(raw).filter(function (r) {\n        return r.length > 0;\n      });\n    };\n    var getAllRaw = function (element) {\n      var css = {};\n      var dom = element.dom;\n      if (isSupported$1(dom)) {\n        for (var i = 0; i < dom.style.length; i++) {\n          var ruleName = dom.style.item(i);\n          css[ruleName] = dom.style[ruleName];\n        }\n      }\n      return css;\n    };\n    var reflow = function (e) {\n      return e.dom.offsetWidth;\n    };\n\n    var browser$1 = detect$3().browser;\n    var firstElement = function (nodes) {\n      return find(nodes, isElement);\n    };\n    var getTableCaptionDeltaY = function (elm) {\n      if (browser$1.isFirefox() && name(elm) === 'table') {\n        return firstElement(children(elm)).filter(function (elm) {\n          return name(elm) === 'caption';\n        }).bind(function (caption) {\n          return firstElement(nextSiblings(caption)).map(function (body) {\n            var bodyTop = body.dom.offsetTop;\n            var captionTop = caption.dom.offsetTop;\n            var captionHeight = caption.dom.offsetHeight;\n            return bodyTop <= captionTop ? -captionHeight : 0;\n          });\n        }).getOr(0);\n      } else {\n        return 0;\n      }\n    };\n    var hasChild = function (elm, child) {\n      return elm.children && contains(elm.children, child);\n    };\n    var getPos = function (body, elm, rootElm) {\n      var x = 0, y = 0, offsetParent;\n      var doc = body.ownerDocument;\n      var pos;\n      rootElm = rootElm ? rootElm : body;\n      if (elm) {\n        if (rootElm === body && elm.getBoundingClientRect && get$4(SugarElement.fromDom(body), 'position') === 'static') {\n          pos = elm.getBoundingClientRect();\n          x = pos.left + (doc.documentElement.scrollLeft || body.scrollLeft) - doc.documentElement.clientLeft;\n          y = pos.top + (doc.documentElement.scrollTop || body.scrollTop) - doc.documentElement.clientTop;\n          return {\n            x: x,\n            y: y\n          };\n        }\n        offsetParent = elm;\n        while (offsetParent && offsetParent !== rootElm && offsetParent.nodeType && !hasChild(offsetParent, rootElm)) {\n          x += offsetParent.offsetLeft || 0;\n          y += offsetParent.offsetTop || 0;\n          offsetParent = offsetParent.offsetParent;\n        }\n        offsetParent = elm.parentNode;\n        while (offsetParent && offsetParent !== rootElm && offsetParent.nodeType && !hasChild(offsetParent, rootElm)) {\n          x -= offsetParent.scrollLeft || 0;\n          y -= offsetParent.scrollTop || 0;\n          offsetParent = offsetParent.parentNode;\n        }\n        y += getTableCaptionDeltaY(SugarElement.fromDom(elm));\n      }\n      return {\n        x: x,\n        y: y\n      };\n    };\n\n    var exports$1 = {}, module$1 = { exports: exports$1 };\n    (function (define, exports, module, require) {\n      (function (f) {\n        if (typeof exports === 'object' && typeof module !== 'undefined') {\n          module.exports = f();\n        } else if (typeof define === 'function' && define.amd) {\n          define([], f);\n        } else {\n          var g;\n          if (typeof window !== 'undefined') {\n            g = window;\n          } else if (typeof global !== 'undefined') {\n            g = global;\n          } else if (typeof self !== 'undefined') {\n            g = self;\n          } else {\n            g = this;\n          }\n          g.EphoxContactWrapper = f();\n        }\n      }(function () {\n        return function () {\n          function r(e, n, t) {\n            function o(i, f) {\n              if (!n[i]) {\n                if (!e[i]) {\n                  var c = 'function' == typeof require && require;\n                  if (!f && c)\n                    return c(i, !0);\n                  if (u)\n                    return u(i, !0);\n                  var a = new Error('Cannot find module \\'' + i + '\\'');\n                  throw a.code = 'MODULE_NOT_FOUND', a;\n                }\n                var p = n[i] = { exports: {} };\n                e[i][0].call(p.exports, function (r) {\n                  var n = e[i][1][r];\n                  return o(n || r);\n                }, p, p.exports, r, e, n, t);\n              }\n              return n[i].exports;\n            }\n            for (var u = 'function' == typeof require && require, i = 0; i < t.length; i++)\n              o(t[i]);\n            return o;\n          }\n          return r;\n        }()({\n          1: [\n            function (require, module, exports) {\n              var process = module.exports = {};\n              var cachedSetTimeout;\n              var cachedClearTimeout;\n              function defaultSetTimout() {\n                throw new Error('setTimeout has not been defined');\n              }\n              function defaultClearTimeout() {\n                throw new Error('clearTimeout has not been defined');\n              }\n              (function () {\n                try {\n                  if (typeof setTimeout === 'function') {\n                    cachedSetTimeout = setTimeout;\n                  } else {\n                    cachedSetTimeout = defaultSetTimout;\n                  }\n                } catch (e) {\n                  cachedSetTimeout = defaultSetTimout;\n                }\n                try {\n                  if (typeof clearTimeout === 'function') {\n                    cachedClearTimeout = clearTimeout;\n                  } else {\n                    cachedClearTimeout = defaultClearTimeout;\n                  }\n                } catch (e) {\n                  cachedClearTimeout = defaultClearTimeout;\n                }\n              }());\n              function runTimeout(fun) {\n                if (cachedSetTimeout === setTimeout) {\n                  return setTimeout(fun, 0);\n                }\n                if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n                  cachedSetTimeout = setTimeout;\n                  return setTimeout(fun, 0);\n                }\n                try {\n                  return cachedSetTimeout(fun, 0);\n                } catch (e) {\n                  try {\n                    return cachedSetTimeout.call(null, fun, 0);\n                  } catch (e) {\n                    return cachedSetTimeout.call(this, fun, 0);\n                  }\n                }\n              }\n              function runClearTimeout(marker) {\n                if (cachedClearTimeout === clearTimeout) {\n                  return clearTimeout(marker);\n                }\n                if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n                  cachedClearTimeout = clearTimeout;\n                  return clearTimeout(marker);\n                }\n                try {\n                  return cachedClearTimeout(marker);\n                } catch (e) {\n                  try {\n                    return cachedClearTimeout.call(null, marker);\n                  } catch (e) {\n                    return cachedClearTimeout.call(this, marker);\n                  }\n                }\n              }\n              var queue = [];\n              var draining = false;\n              var currentQueue;\n              var queueIndex = -1;\n              function cleanUpNextTick() {\n                if (!draining || !currentQueue) {\n                  return;\n                }\n                draining = false;\n                if (currentQueue.length) {\n                  queue = currentQueue.concat(queue);\n                } else {\n                  queueIndex = -1;\n                }\n                if (queue.length) {\n                  drainQueue();\n                }\n              }\n              function drainQueue() {\n                if (draining) {\n                  return;\n                }\n                var timeout = runTimeout(cleanUpNextTick);\n                draining = true;\n                var len = queue.length;\n                while (len) {\n                  currentQueue = queue;\n                  queue = [];\n                  while (++queueIndex < len) {\n                    if (currentQueue) {\n                      currentQueue[queueIndex].run();\n                    }\n                  }\n                  queueIndex = -1;\n                  len = queue.length;\n                }\n                currentQueue = null;\n                draining = false;\n                runClearTimeout(timeout);\n              }\n              process.nextTick = function (fun) {\n                var args = new Array(arguments.length - 1);\n                if (arguments.length > 1) {\n                  for (var i = 1; i < arguments.length; i++) {\n                    args[i - 1] = arguments[i];\n                  }\n                }\n                queue.push(new Item(fun, args));\n                if (queue.length === 1 && !draining) {\n                  runTimeout(drainQueue);\n                }\n              };\n              function Item(fun, array) {\n                this.fun = fun;\n                this.array = array;\n              }\n              Item.prototype.run = function () {\n                this.fun.apply(null, this.array);\n              };\n              process.title = 'browser';\n              process.browser = true;\n              process.env = {};\n              process.argv = [];\n              process.version = '';\n              process.versions = {};\n              function noop() {\n              }\n              process.on = noop;\n              process.addListener = noop;\n              process.once = noop;\n              process.off = noop;\n              process.removeListener = noop;\n              process.removeAllListeners = noop;\n              process.emit = noop;\n              process.prependListener = noop;\n              process.prependOnceListener = noop;\n              process.listeners = function (name) {\n                return [];\n              };\n              process.binding = function (name) {\n                throw new Error('process.binding is not supported');\n              };\n              process.cwd = function () {\n                return '/';\n              };\n              process.chdir = function (dir) {\n                throw new Error('process.chdir is not supported');\n              };\n              process.umask = function () {\n                return 0;\n              };\n            },\n            {}\n          ],\n          2: [\n            function (require, module, exports) {\n              (function (setImmediate) {\n                (function (root) {\n                  var setTimeoutFunc = setTimeout;\n                  function noop() {\n                  }\n                  function bind(fn, thisArg) {\n                    return function () {\n                      fn.apply(thisArg, arguments);\n                    };\n                  }\n                  function Promise(fn) {\n                    if (typeof this !== 'object')\n                      throw new TypeError('Promises must be constructed via new');\n                    if (typeof fn !== 'function')\n                      throw new TypeError('not a function');\n                    this._state = 0;\n                    this._handled = false;\n                    this._value = undefined;\n                    this._deferreds = [];\n                    doResolve(fn, this);\n                  }\n                  function handle(self, deferred) {\n                    while (self._state === 3) {\n                      self = self._value;\n                    }\n                    if (self._state === 0) {\n                      self._deferreds.push(deferred);\n                      return;\n                    }\n                    self._handled = true;\n                    Promise._immediateFn(function () {\n                      var cb = self._state === 1 ? deferred.onFulfilled : deferred.onRejected;\n                      if (cb === null) {\n                        (self._state === 1 ? resolve : reject)(deferred.promise, self._value);\n                        return;\n                      }\n                      var ret;\n                      try {\n                        ret = cb(self._value);\n                      } catch (e) {\n                        reject(deferred.promise, e);\n                        return;\n                      }\n                      resolve(deferred.promise, ret);\n                    });\n                  }\n                  function resolve(self, newValue) {\n                    try {\n                      if (newValue === self)\n                        throw new TypeError('A promise cannot be resolved with itself.');\n                      if (newValue && (typeof newValue === 'object' || typeof newValue === 'function')) {\n                        var then = newValue.then;\n                        if (newValue instanceof Promise) {\n                          self._state = 3;\n                          self._value = newValue;\n                          finale(self);\n                          return;\n                        } else if (typeof then === 'function') {\n                          doResolve(bind(then, newValue), self);\n                          return;\n                        }\n                      }\n                      self._state = 1;\n                      self._value = newValue;\n                      finale(self);\n                    } catch (e) {\n                      reject(self, e);\n                    }\n                  }\n                  function reject(self, newValue) {\n                    self._state = 2;\n                    self._value = newValue;\n                    finale(self);\n                  }\n                  function finale(self) {\n                    if (self._state === 2 && self._deferreds.length === 0) {\n                      Promise._immediateFn(function () {\n                        if (!self._handled) {\n                          Promise._unhandledRejectionFn(self._value);\n                        }\n                      });\n                    }\n                    for (var i = 0, len = self._deferreds.length; i < len; i++) {\n                      handle(self, self._deferreds[i]);\n                    }\n                    self._deferreds = null;\n                  }\n                  function Handler(onFulfilled, onRejected, promise) {\n                    this.onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : null;\n                    this.onRejected = typeof onRejected === 'function' ? onRejected : null;\n                    this.promise = promise;\n                  }\n                  function doResolve(fn, self) {\n                    var done = false;\n                    try {\n                      fn(function (value) {\n                        if (done)\n                          return;\n                        done = true;\n                        resolve(self, value);\n                      }, function (reason) {\n                        if (done)\n                          return;\n                        done = true;\n                        reject(self, reason);\n                      });\n                    } catch (ex) {\n                      if (done)\n                        return;\n                      done = true;\n                      reject(self, ex);\n                    }\n                  }\n                  Promise.prototype['catch'] = function (onRejected) {\n                    return this.then(null, onRejected);\n                  };\n                  Promise.prototype.then = function (onFulfilled, onRejected) {\n                    var prom = new this.constructor(noop);\n                    handle(this, new Handler(onFulfilled, onRejected, prom));\n                    return prom;\n                  };\n                  Promise.all = function (arr) {\n                    var args = Array.prototype.slice.call(arr);\n                    return new Promise(function (resolve, reject) {\n                      if (args.length === 0)\n                        return resolve([]);\n                      var remaining = args.length;\n                      function res(i, val) {\n                        try {\n                          if (val && (typeof val === 'object' || typeof val === 'function')) {\n                            var then = val.then;\n                            if (typeof then === 'function') {\n                              then.call(val, function (val) {\n                                res(i, val);\n                              }, reject);\n                              return;\n                            }\n                          }\n                          args[i] = val;\n                          if (--remaining === 0) {\n                            resolve(args);\n                          }\n                        } catch (ex) {\n                          reject(ex);\n                        }\n                      }\n                      for (var i = 0; i < args.length; i++) {\n                        res(i, args[i]);\n                      }\n                    });\n                  };\n                  Promise.resolve = function (value) {\n                    if (value && typeof value === 'object' && value.constructor === Promise) {\n                      return value;\n                    }\n                    return new Promise(function (resolve) {\n                      resolve(value);\n                    });\n                  };\n                  Promise.reject = function (value) {\n                    return new Promise(function (resolve, reject) {\n                      reject(value);\n                    });\n                  };\n                  Promise.race = function (values) {\n                    return new Promise(function (resolve, reject) {\n                      for (var i = 0, len = values.length; i < len; i++) {\n                        values[i].then(resolve, reject);\n                      }\n                    });\n                  };\n                  Promise._immediateFn = typeof setImmediate === 'function' ? function (fn) {\n                    setImmediate(fn);\n                  } : function (fn) {\n                    setTimeoutFunc(fn, 0);\n                  };\n                  Promise._unhandledRejectionFn = function _unhandledRejectionFn(err) {\n                    if (typeof console !== 'undefined' && console) {\n                      console.warn('Possible Unhandled Promise Rejection:', err);\n                    }\n                  };\n                  Promise._setImmediateFn = function _setImmediateFn(fn) {\n                    Promise._immediateFn = fn;\n                  };\n                  Promise._setUnhandledRejectionFn = function _setUnhandledRejectionFn(fn) {\n                    Promise._unhandledRejectionFn = fn;\n                  };\n                  if (typeof module !== 'undefined' && module.exports) {\n                    module.exports = Promise;\n                  } else if (!root.Promise) {\n                    root.Promise = Promise;\n                  }\n                }(this));\n              }.call(this, require('timers').setImmediate));\n            },\n            { 'timers': 3 }\n          ],\n          3: [\n            function (require, module, exports) {\n              (function (setImmediate, clearImmediate) {\n                var nextTick = require('process/browser.js').nextTick;\n                var apply = Function.prototype.apply;\n                var slice = Array.prototype.slice;\n                var immediateIds = {};\n                var nextImmediateId = 0;\n                exports.setTimeout = function () {\n                  return new Timeout(apply.call(setTimeout, window, arguments), clearTimeout);\n                };\n                exports.setInterval = function () {\n                  return new Timeout(apply.call(setInterval, window, arguments), clearInterval);\n                };\n                exports.clearTimeout = exports.clearInterval = function (timeout) {\n                  timeout.close();\n                };\n                function Timeout(id, clearFn) {\n                  this._id = id;\n                  this._clearFn = clearFn;\n                }\n                Timeout.prototype.unref = Timeout.prototype.ref = function () {\n                };\n                Timeout.prototype.close = function () {\n                  this._clearFn.call(window, this._id);\n                };\n                exports.enroll = function (item, msecs) {\n                  clearTimeout(item._idleTimeoutId);\n                  item._idleTimeout = msecs;\n                };\n                exports.unenroll = function (item) {\n                  clearTimeout(item._idleTimeoutId);\n                  item._idleTimeout = -1;\n                };\n                exports._unrefActive = exports.active = function (item) {\n                  clearTimeout(item._idleTimeoutId);\n                  var msecs = item._idleTimeout;\n                  if (msecs >= 0) {\n                    item._idleTimeoutId = setTimeout(function onTimeout() {\n                      if (item._onTimeout)\n                        item._onTimeout();\n                    }, msecs);\n                  }\n                };\n                exports.setImmediate = typeof setImmediate === 'function' ? setImmediate : function (fn) {\n                  var id = nextImmediateId++;\n                  var args = arguments.length < 2 ? false : slice.call(arguments, 1);\n                  immediateIds[id] = true;\n                  nextTick(function onNextTick() {\n                    if (immediateIds[id]) {\n                      if (args) {\n                        fn.apply(null, args);\n                      } else {\n                        fn.call(null);\n                      }\n                      exports.clearImmediate(id);\n                    }\n                  });\n                  return id;\n                };\n                exports.clearImmediate = typeof clearImmediate === 'function' ? clearImmediate : function (id) {\n                  delete immediateIds[id];\n                };\n              }.call(this, require('timers').setImmediate, require('timers').clearImmediate));\n            },\n            {\n              'process/browser.js': 1,\n              'timers': 3\n            }\n          ],\n          4: [\n            function (require, module, exports) {\n              var promisePolyfill = require('promise-polyfill');\n              var Global = function () {\n                if (typeof window !== 'undefined') {\n                  return window;\n                } else {\n                  return Function('return this;')();\n                }\n              }();\n              module.exports = { boltExport: Global.Promise || promisePolyfill };\n            },\n            { 'promise-polyfill': 2 }\n          ]\n        }, {}, [4])(4);\n      }));\n    }(undefined, exports$1, module$1, undefined));\n    var Promise = module$1.exports.boltExport;\n\n    var nu$3 = function (baseFn) {\n      var data = Optional.none();\n      var callbacks = [];\n      var map = function (f) {\n        return nu$3(function (nCallback) {\n          get(function (data) {\n            nCallback(f(data));\n          });\n        });\n      };\n      var get = function (nCallback) {\n        if (isReady()) {\n          call(nCallback);\n        } else {\n          callbacks.push(nCallback);\n        }\n      };\n      var set = function (x) {\n        if (!isReady()) {\n          data = Optional.some(x);\n          run(callbacks);\n          callbacks = [];\n        }\n      };\n      var isReady = function () {\n        return data.isSome();\n      };\n      var run = function (cbs) {\n        each(cbs, call);\n      };\n      var call = function (cb) {\n        data.each(function (x) {\n          setTimeout(function () {\n            cb(x);\n          }, 0);\n        });\n      };\n      baseFn(set);\n      return {\n        get: get,\n        map: map,\n        isReady: isReady\n      };\n    };\n    var pure = function (a) {\n      return nu$3(function (callback) {\n        callback(a);\n      });\n    };\n    var LazyValue = {\n      nu: nu$3,\n      pure: pure\n    };\n\n    var errorReporter = function (err) {\n      setTimeout(function () {\n        throw err;\n      }, 0);\n    };\n    var make = function (run) {\n      var get = function (callback) {\n        run().then(callback, errorReporter);\n      };\n      var map = function (fab) {\n        return make(function () {\n          return run().then(fab);\n        });\n      };\n      var bind = function (aFutureB) {\n        return make(function () {\n          return run().then(function (v) {\n            return aFutureB(v).toPromise();\n          });\n        });\n      };\n      var anonBind = function (futureB) {\n        return make(function () {\n          return run().then(function () {\n            return futureB.toPromise();\n          });\n        });\n      };\n      var toLazy = function () {\n        return LazyValue.nu(get);\n      };\n      var toCached = function () {\n        var cache = null;\n        return make(function () {\n          if (cache === null) {\n            cache = run();\n          }\n          return cache;\n        });\n      };\n      var toPromise = run;\n      return {\n        map: map,\n        bind: bind,\n        anonBind: anonBind,\n        toLazy: toLazy,\n        toCached: toCached,\n        toPromise: toPromise,\n        get: get\n      };\n    };\n    var nu$4 = function (baseFn) {\n      return make(function () {\n        return new Promise(baseFn);\n      });\n    };\n    var pure$1 = function (a) {\n      return make(function () {\n        return Promise.resolve(a);\n      });\n    };\n    var Future = {\n      nu: nu$4,\n      pure: pure$1\n    };\n\n    var par = function (asyncValues, nu) {\n      return nu(function (callback) {\n        var r = [];\n        var count = 0;\n        var cb = function (i) {\n          return function (value) {\n            r[i] = value;\n            count++;\n            if (count >= asyncValues.length) {\n              callback(r);\n            }\n          };\n        };\n        if (asyncValues.length === 0) {\n          callback([]);\n        } else {\n          each(asyncValues, function (asyncValue, i) {\n            asyncValue.get(cb(i));\n          });\n        }\n      });\n    };\n\n    var par$1 = function (futures) {\n      return par(futures, Future.nu);\n    };\n\n    var value = function (o) {\n      var is = function (v) {\n        return o === v;\n      };\n      var or = function (_opt) {\n        return value(o);\n      };\n      var orThunk = function (_f) {\n        return value(o);\n      };\n      var map = function (f) {\n        return value(f(o));\n      };\n      var mapError = function (_f) {\n        return value(o);\n      };\n      var each = function (f) {\n        f(o);\n      };\n      var bind = function (f) {\n        return f(o);\n      };\n      var fold = function (_, onValue) {\n        return onValue(o);\n      };\n      var exists = function (f) {\n        return f(o);\n      };\n      var forall = function (f) {\n        return f(o);\n      };\n      var toOptional = function () {\n        return Optional.some(o);\n      };\n      return {\n        is: is,\n        isValue: always,\n        isError: never,\n        getOr: constant(o),\n        getOrThunk: constant(o),\n        getOrDie: constant(o),\n        or: or,\n        orThunk: orThunk,\n        fold: fold,\n        map: map,\n        mapError: mapError,\n        each: each,\n        bind: bind,\n        exists: exists,\n        forall: forall,\n        toOptional: toOptional\n      };\n    };\n    var error = function (message) {\n      var getOrThunk = function (f) {\n        return f();\n      };\n      var getOrDie = function () {\n        return die(String(message))();\n      };\n      var or = function (opt) {\n        return opt;\n      };\n      var orThunk = function (f) {\n        return f();\n      };\n      var map = function (_f) {\n        return error(message);\n      };\n      var mapError = function (f) {\n        return error(f(message));\n      };\n      var bind = function (_f) {\n        return error(message);\n      };\n      var fold = function (onError, _) {\n        return onError(message);\n      };\n      return {\n        is: never,\n        isValue: never,\n        isError: always,\n        getOr: identity,\n        getOrThunk: getOrThunk,\n        getOrDie: getOrDie,\n        or: or,\n        orThunk: orThunk,\n        fold: fold,\n        map: map,\n        mapError: mapError,\n        each: noop,\n        bind: bind,\n        exists: never,\n        forall: always,\n        toOptional: Optional.none\n      };\n    };\n    var fromOption = function (opt, err) {\n      return opt.fold(function () {\n        return error(err);\n      }, value);\n    };\n    var Result = {\n      value: value,\n      error: error,\n      fromOption: fromOption\n    };\n\n    var generate = function (cases) {\n      if (!isArray(cases)) {\n        throw new Error('cases must be an array');\n      }\n      if (cases.length === 0) {\n        throw new Error('there must be at least one case');\n      }\n      var constructors = [];\n      var adt = {};\n      each(cases, function (acase, count) {\n        var keys$1 = keys(acase);\n        if (keys$1.length !== 1) {\n          throw new Error('one and only one name per case');\n        }\n        var key = keys$1[0];\n        var value = acase[key];\n        if (adt[key] !== undefined) {\n          throw new Error('duplicate key detected:' + key);\n        } else if (key === 'cata') {\n          throw new Error('cannot have a case named cata (sorry)');\n        } else if (!isArray(value)) {\n          throw new Error('case arguments must be an array');\n        }\n        constructors.push(key);\n        adt[key] = function () {\n          var argLength = arguments.length;\n          if (argLength !== value.length) {\n            throw new Error('Wrong number of arguments to case ' + key + '. Expected ' + value.length + ' (' + value + '), got ' + argLength);\n          }\n          var args = new Array(argLength);\n          for (var i = 0; i < args.length; i++) {\n            args[i] = arguments[i];\n          }\n          var match = function (branches) {\n            var branchKeys = keys(branches);\n            if (constructors.length !== branchKeys.length) {\n              throw new Error('Wrong number of arguments to match. Expected: ' + constructors.join(',') + '\\nActual: ' + branchKeys.join(','));\n            }\n            var allReqd = forall(constructors, function (reqKey) {\n              return contains(branchKeys, reqKey);\n            });\n            if (!allReqd) {\n              throw new Error('Not all branches were specified when using match. Specified: ' + branchKeys.join(', ') + '\\nRequired: ' + constructors.join(', '));\n            }\n            return branches[key].apply(null, args);\n          };\n          return {\n            fold: function () {\n              if (arguments.length !== cases.length) {\n                throw new Error('Wrong number of arguments to fold. Expected ' + cases.length + ', got ' + arguments.length);\n              }\n              var target = arguments[count];\n              return target.apply(null, args);\n            },\n            match: match,\n            log: function (label) {\n              console.log(label, {\n                constructors: constructors,\n                constructor: key,\n                params: args\n              });\n            }\n          };\n        };\n      });\n      return adt;\n    };\n    var Adt = { generate: generate };\n\n    var comparison = Adt.generate([\n      {\n        bothErrors: [\n          'error1',\n          'error2'\n        ]\n      },\n      {\n        firstError: [\n          'error1',\n          'value2'\n        ]\n      },\n      {\n        secondError: [\n          'value1',\n          'error2'\n        ]\n      },\n      {\n        bothValues: [\n          'value1',\n          'value2'\n        ]\n      }\n    ]);\n    var unite = function (result) {\n      return result.fold(identity, identity);\n    };\n\n    function ClosestOrAncestor (is, ancestor, scope, a, isRoot) {\n      return is(scope, a) ? Optional.some(scope) : isFunction(isRoot) && isRoot(scope) ? Optional.none() : ancestor(scope, a, isRoot);\n    }\n\n    var ancestor = function (scope, predicate, isRoot) {\n      var element = scope.dom;\n      var stop = isFunction(isRoot) ? isRoot : never;\n      while (element.parentNode) {\n        element = element.parentNode;\n        var el = SugarElement.fromDom(element);\n        if (predicate(el)) {\n          return Optional.some(el);\n        } else if (stop(el)) {\n          break;\n        }\n      }\n      return Optional.none();\n    };\n    var closest = function (scope, predicate, isRoot) {\n      var is = function (s, test) {\n        return test(s);\n      };\n      return ClosestOrAncestor(is, ancestor, scope, predicate, isRoot);\n    };\n\n    var ancestor$1 = function (scope, selector, isRoot) {\n      return ancestor(scope, function (e) {\n        return is$1(e, selector);\n      }, isRoot);\n    };\n    var descendant = function (scope, selector) {\n      return one(selector, scope);\n    };\n    var closest$1 = function (scope, selector, isRoot) {\n      var is = function (element, selector) {\n        return is$1(element, selector);\n      };\n      return ClosestOrAncestor(is, ancestor$1, scope, selector, isRoot);\n    };\n\n    var promise = function () {\n      function bind(fn, thisArg) {\n        return function () {\n          fn.apply(thisArg, arguments);\n        };\n      }\n      var isArray = Array.isArray || function (value) {\n        return Object.prototype.toString.call(value) === '[object Array]';\n      };\n      var Promise = function (fn) {\n        if (typeof this !== 'object') {\n          throw new TypeError('Promises must be constructed via new');\n        }\n        if (typeof fn !== 'function') {\n          throw new TypeError('not a function');\n        }\n        this._state = null;\n        this._value = null;\n        this._deferreds = [];\n        doResolve(fn, bind(resolve, this), bind(reject, this));\n      };\n      var asap = Promise.immediateFn || typeof setImmediate === 'function' && setImmediate || function (fn) {\n        setTimeout(fn, 1);\n      };\n      function handle(deferred) {\n        var me = this;\n        if (this._state === null) {\n          this._deferreds.push(deferred);\n          return;\n        }\n        asap(function () {\n          var cb = me._state ? deferred.onFulfilled : deferred.onRejected;\n          if (cb === null) {\n            (me._state ? deferred.resolve : deferred.reject)(me._value);\n            return;\n          }\n          var ret;\n          try {\n            ret = cb(me._value);\n          } catch (e) {\n            deferred.reject(e);\n            return;\n          }\n          deferred.resolve(ret);\n        });\n      }\n      function resolve(newValue) {\n        try {\n          if (newValue === this) {\n            throw new TypeError('A promise cannot be resolved with itself.');\n          }\n          if (newValue && (typeof newValue === 'object' || typeof newValue === 'function')) {\n            var then = newValue.then;\n            if (typeof then === 'function') {\n              doResolve(bind(then, newValue), bind(resolve, this), bind(reject, this));\n              return;\n            }\n          }\n          this._state = true;\n          this._value = newValue;\n          finale.call(this);\n        } catch (e) {\n          reject.call(this, e);\n        }\n      }\n      function reject(newValue) {\n        this._state = false;\n        this._value = newValue;\n        finale.call(this);\n      }\n      function finale() {\n        for (var i = 0, len = this._deferreds.length; i < len; i++) {\n          handle.call(this, this._deferreds[i]);\n        }\n        this._deferreds = null;\n      }\n      function Handler(onFulfilled, onRejected, resolve, reject) {\n        this.onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : null;\n        this.onRejected = typeof onRejected === 'function' ? onRejected : null;\n        this.resolve = resolve;\n        this.reject = reject;\n      }\n      function doResolve(fn, onFulfilled, onRejected) {\n        var done = false;\n        try {\n          fn(function (value) {\n            if (done) {\n              return;\n            }\n            done = true;\n            onFulfilled(value);\n          }, function (reason) {\n            if (done) {\n              return;\n            }\n            done = true;\n            onRejected(reason);\n          });\n        } catch (ex) {\n          if (done) {\n            return;\n          }\n          done = true;\n          onRejected(ex);\n        }\n      }\n      Promise.prototype.catch = function (onRejected) {\n        return this.then(null, onRejected);\n      };\n      Promise.prototype.then = function (onFulfilled, onRejected) {\n        var me = this;\n        return new Promise(function (resolve, reject) {\n          handle.call(me, new Handler(onFulfilled, onRejected, resolve, reject));\n        });\n      };\n      Promise.all = function () {\n        var args = Array.prototype.slice.call(arguments.length === 1 && isArray(arguments[0]) ? arguments[0] : arguments);\n        return new Promise(function (resolve, reject) {\n          if (args.length === 0) {\n            return resolve([]);\n          }\n          var remaining = args.length;\n          function res(i, val) {\n            try {\n              if (val && (typeof val === 'object' || typeof val === 'function')) {\n                var then = val.then;\n                if (typeof then === 'function') {\n                  then.call(val, function (val) {\n                    res(i, val);\n                  }, reject);\n                  return;\n                }\n              }\n              args[i] = val;\n              if (--remaining === 0) {\n                resolve(args);\n              }\n            } catch (ex) {\n              reject(ex);\n            }\n          }\n          for (var i = 0; i < args.length; i++) {\n            res(i, args[i]);\n          }\n        });\n      };\n      Promise.resolve = function (value) {\n        if (value && typeof value === 'object' && value.constructor === Promise) {\n          return value;\n        }\n        return new Promise(function (resolve) {\n          resolve(value);\n        });\n      };\n      Promise.reject = function (value) {\n        return new Promise(function (resolve, reject) {\n          reject(value);\n        });\n      };\n      Promise.race = function (values) {\n        return new Promise(function (resolve, reject) {\n          for (var i = 0, len = values.length; i < len; i++) {\n            values[i].then(resolve, reject);\n          }\n        });\n      };\n      return Promise;\n    };\n    var promiseObj = window.Promise ? window.Promise : promise();\n\n    var requestAnimationFramePromise;\n    var requestAnimationFrame = function (callback, element) {\n      var i, requestAnimationFrameFunc = window.requestAnimationFrame;\n      var vendors = [\n        'ms',\n        'moz',\n        'webkit'\n      ];\n      var featurefill = function (callback) {\n        window.setTimeout(callback, 0);\n      };\n      for (i = 0; i < vendors.length && !requestAnimationFrameFunc; i++) {\n        requestAnimationFrameFunc = window[vendors[i] + 'RequestAnimationFrame'];\n      }\n      if (!requestAnimationFrameFunc) {\n        requestAnimationFrameFunc = featurefill;\n      }\n      requestAnimationFrameFunc(callback, element);\n    };\n    var wrappedSetTimeout = function (callback, time) {\n      if (typeof time !== 'number') {\n        time = 0;\n      }\n      return setTimeout(callback, time);\n    };\n    var wrappedSetInterval = function (callback, time) {\n      if (typeof time !== 'number') {\n        time = 1;\n      }\n      return setInterval(callback, time);\n    };\n    var wrappedClearTimeout = function (id) {\n      return clearTimeout(id);\n    };\n    var wrappedClearInterval = function (id) {\n      return clearInterval(id);\n    };\n    var debounce = function (callback, time) {\n      var timer;\n      var func = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n          args[_i] = arguments[_i];\n        }\n        clearTimeout(timer);\n        timer = wrappedSetTimeout(function () {\n          callback.apply(this, args);\n        }, time);\n      };\n      func.stop = function () {\n        clearTimeout(timer);\n      };\n      return func;\n    };\n    var Delay = {\n      requestAnimationFrame: function (callback, element) {\n        if (requestAnimationFramePromise) {\n          requestAnimationFramePromise.then(callback);\n          return;\n        }\n        requestAnimationFramePromise = new promiseObj(function (resolve) {\n          if (!element) {\n            element = document.body;\n          }\n          requestAnimationFrame(resolve, element);\n        }).then(callback);\n      },\n      setTimeout: wrappedSetTimeout,\n      setInterval: wrappedSetInterval,\n      setEditorTimeout: function (editor, callback, time) {\n        return wrappedSetTimeout(function () {\n          if (!editor.removed) {\n            callback();\n          }\n        }, time);\n      },\n      setEditorInterval: function (editor, callback, time) {\n        var timer = wrappedSetInterval(function () {\n          if (!editor.removed) {\n            callback();\n          } else {\n            clearInterval(timer);\n          }\n        }, time);\n        return timer;\n      },\n      debounce: debounce,\n      throttle: debounce,\n      clearInterval: wrappedClearInterval,\n      clearTimeout: wrappedClearTimeout\n    };\n\n    function StyleSheetLoader(documentOrShadowRoot, settings) {\n      if (settings === void 0) {\n        settings = {};\n      }\n      var idCount = 0;\n      var loadedStates = {};\n      var edos = SugarElement.fromDom(documentOrShadowRoot);\n      var doc = documentOrOwner(edos);\n      var maxLoadTime = settings.maxLoadTime || 5000;\n      var _setReferrerPolicy = function (referrerPolicy) {\n        settings.referrerPolicy = referrerPolicy;\n      };\n      var addStyle = function (element) {\n        append(getStyleContainer(edos), element);\n      };\n      var removeStyle = function (id) {\n        var styleContainer = getStyleContainer(edos);\n        descendant(styleContainer, '#' + id).each(remove);\n      };\n      var getOrCreateState = function (url) {\n        return get(loadedStates, url).getOrThunk(function () {\n          return {\n            id: 'mce-u' + idCount++,\n            passed: [],\n            failed: [],\n            count: 0\n          };\n        });\n      };\n      var load = function (url, success, failure) {\n        var link;\n        var urlWithSuffix = Tools._addCacheSuffix(url);\n        var state = getOrCreateState(urlWithSuffix);\n        loadedStates[urlWithSuffix] = state;\n        state.count++;\n        var resolve = function (callbacks, status) {\n          var i = callbacks.length;\n          while (i--) {\n            callbacks[i]();\n          }\n          state.status = status;\n          state.passed = [];\n          state.failed = [];\n          if (link) {\n            link.onload = null;\n            link.onerror = null;\n            link = null;\n          }\n        };\n        var passed = function () {\n          return resolve(state.passed, 2);\n        };\n        var failed = function () {\n          return resolve(state.failed, 3);\n        };\n        var wait = function (testCallback, waitCallback) {\n          if (!testCallback()) {\n            if (Date.now() - startTime < maxLoadTime) {\n              Delay.setTimeout(waitCallback);\n            } else {\n              failed();\n            }\n          }\n        };\n        var waitForWebKitLinkLoaded = function () {\n          wait(function () {\n            var styleSheets = documentOrShadowRoot.styleSheets;\n            var i = styleSheets.length;\n            while (i--) {\n              var styleSheet = styleSheets[i];\n              var owner = styleSheet.ownerNode;\n              if (owner && owner.id === link.id) {\n                passed();\n                return true;\n              }\n            }\n            return false;\n          }, waitForWebKitLinkLoaded);\n        };\n        if (success) {\n          state.passed.push(success);\n        }\n        if (failure) {\n          state.failed.push(failure);\n        }\n        if (state.status === 1) {\n          return;\n        }\n        if (state.status === 2) {\n          passed();\n          return;\n        }\n        if (state.status === 3) {\n          failed();\n          return;\n        }\n        state.status = 1;\n        var linkElem = SugarElement.fromTag('link', doc.dom);\n        setAll(linkElem, {\n          rel: 'stylesheet',\n          type: 'text/css',\n          id: state.id\n        });\n        var startTime = Date.now();\n        if (settings.contentCssCors) {\n          set(linkElem, 'crossOrigin', 'anonymous');\n        }\n        if (settings.referrerPolicy) {\n          set(linkElem, 'referrerpolicy', settings.referrerPolicy);\n        }\n        link = linkElem.dom;\n        link.onload = waitForWebKitLinkLoaded;\n        link.onerror = failed;\n        addStyle(linkElem);\n        set(linkElem, 'href', urlWithSuffix);\n      };\n      var loadF = function (url) {\n        return Future.nu(function (resolve) {\n          load(url, compose(resolve, constant(Result.value(url))), compose(resolve, constant(Result.error(url))));\n        });\n      };\n      var loadAll = function (urls, success, failure) {\n        par$1(map(urls, loadF)).get(function (result) {\n          var parts = partition(result, function (r) {\n            return r.isValue();\n          });\n          if (parts.fail.length > 0) {\n            failure(parts.fail.map(unite));\n          } else {\n            success(parts.pass.map(unite));\n          }\n        });\n      };\n      var unload = function (url) {\n        var urlWithSuffix = Tools._addCacheSuffix(url);\n        get(loadedStates, urlWithSuffix).each(function (state) {\n          var count = --state.count;\n          if (count === 0) {\n            delete loadedStates[urlWithSuffix];\n            removeStyle(state.id);\n          }\n        });\n      };\n      var unloadAll = function (urls) {\n        each(urls, function (url) {\n          unload(url);\n        });\n      };\n      return {\n        load: load,\n        loadAll: loadAll,\n        unload: unload,\n        unloadAll: unloadAll,\n        _setReferrerPolicy: _setReferrerPolicy\n      };\n    }\n\n    var create$1 = function () {\n      var map = new WeakMap();\n      var forElement = function (referenceElement, settings) {\n        var root = getRootNode(referenceElement);\n        var rootDom = root.dom;\n        return Optional.from(map.get(rootDom)).getOrThunk(function () {\n          var sl = StyleSheetLoader(rootDom, settings);\n          map.set(rootDom, sl);\n          return sl;\n        });\n      };\n      return { forElement: forElement };\n    };\n    var instance = create$1();\n\n    var DomTreeWalker = function () {\n      function DomTreeWalker(startNode, rootNode) {\n        this.node = startNode;\n        this.rootNode = rootNode;\n        this.current = this.current.bind(this);\n        this.next = this.next.bind(this);\n        this.prev = this.prev.bind(this);\n        this.prev2 = this.prev2.bind(this);\n      }\n      DomTreeWalker.prototype.current = function () {\n        return this.node;\n      };\n      DomTreeWalker.prototype.next = function (shallow) {\n        this.node = this.findSibling(this.node, 'firstChild', 'nextSibling', shallow);\n        return this.node;\n      };\n      DomTreeWalker.prototype.prev = function (shallow) {\n        this.node = this.findSibling(this.node, 'lastChild', 'previousSibling', shallow);\n        return this.node;\n      };\n      DomTreeWalker.prototype.prev2 = function (shallow) {\n        this.node = this.findPreviousNode(this.node, 'lastChild', 'previousSibling', shallow);\n        return this.node;\n      };\n      DomTreeWalker.prototype.findSibling = function (node, startName, siblingName, shallow) {\n        var sibling, parent;\n        if (node) {\n          if (!shallow && node[startName]) {\n            return node[startName];\n          }\n          if (node !== this.rootNode) {\n            sibling = node[siblingName];\n            if (sibling) {\n              return sibling;\n            }\n            for (parent = node.parentNode; parent && parent !== this.rootNode; parent = parent.parentNode) {\n              sibling = parent[siblingName];\n              if (sibling) {\n                return sibling;\n              }\n            }\n          }\n        }\n      };\n      DomTreeWalker.prototype.findPreviousNode = function (node, startName, siblingName, shallow) {\n        var sibling, parent, child;\n        if (node) {\n          sibling = node[siblingName];\n          if (this.rootNode && sibling === this.rootNode) {\n            return;\n          }\n          if (sibling) {\n            if (!shallow) {\n              for (child = sibling[startName]; child; child = child[startName]) {\n                if (!child[startName]) {\n                  return child;\n                }\n              }\n            }\n            return sibling;\n          }\n          parent = node.parentNode;\n          if (parent && parent !== this.rootNode) {\n            return parent;\n          }\n        }\n      };\n      return DomTreeWalker;\n    }();\n\n    var blocks = [\n      'article',\n      'aside',\n      'details',\n      'div',\n      'dt',\n      'figcaption',\n      'footer',\n      'form',\n      'fieldset',\n      'header',\n      'hgroup',\n      'html',\n      'main',\n      'nav',\n      'section',\n      'summary',\n      'body',\n      'p',\n      'dl',\n      'multicol',\n      'dd',\n      'figure',\n      'address',\n      'center',\n      'blockquote',\n      'h1',\n      'h2',\n      'h3',\n      'h4',\n      'h5',\n      'h6',\n      'listing',\n      'xmp',\n      'pre',\n      'plaintext',\n      'menu',\n      'dir',\n      'ul',\n      'ol',\n      'li',\n      'hr',\n      'table',\n      'tbody',\n      'thead',\n      'tfoot',\n      'th',\n      'tr',\n      'td',\n      'caption'\n    ];\n    var tableCells = [\n      'td',\n      'th'\n    ];\n    var tableSections = [\n      'thead',\n      'tbody',\n      'tfoot'\n    ];\n    var textBlocks = [\n      'h1',\n      'h2',\n      'h3',\n      'h4',\n      'h5',\n      'h6',\n      'p',\n      'div',\n      'address',\n      'pre',\n      'form',\n      'blockquote',\n      'center',\n      'dir',\n      'fieldset',\n      'header',\n      'footer',\n      'article',\n      'section',\n      'hgroup',\n      'aside',\n      'nav',\n      'figure'\n    ];\n    var headings = [\n      'h1',\n      'h2',\n      'h3',\n      'h4',\n      'h5',\n      'h6'\n    ];\n    var listItems = [\n      'li',\n      'dd',\n      'dt'\n    ];\n    var lists = [\n      'ul',\n      'ol',\n      'dl'\n    ];\n    var wsElements = [\n      'pre',\n      'script',\n      'textarea',\n      'style'\n    ];\n    var lazyLookup = function (items) {\n      var lookup;\n      return function (node) {\n        lookup = lookup ? lookup : mapToObject(items, always);\n        return lookup.hasOwnProperty(name(node));\n      };\n    };\n    var isHeading = lazyLookup(headings);\n    var isBlock = lazyLookup(blocks);\n    var isTable$1 = function (node) {\n      return name(node) === 'table';\n    };\n    var isInline = function (node) {\n      return isElement(node) && !isBlock(node);\n    };\n    var isBr$1 = function (node) {\n      return isElement(node) && name(node) === 'br';\n    };\n    var isTextBlock = lazyLookup(textBlocks);\n    var isList = lazyLookup(lists);\n    var isListItem = lazyLookup(listItems);\n    var isTableSection = lazyLookup(tableSections);\n    var isTableCell$1 = lazyLookup(tableCells);\n    var isWsPreserveElement = lazyLookup(wsElements);\n\n    var ancestor$2 = function (scope, selector, isRoot) {\n      return ancestor$1(scope, selector, isRoot).isSome();\n    };\n\n    var zeroWidth = '\\uFEFF';\n    var nbsp = '\\xA0';\n    var isZwsp = function (char) {\n      return char === zeroWidth;\n    };\n    var removeZwsp = function (s) {\n      return s.replace(/\\uFEFF/g, '');\n    };\n\n    var ZWSP = zeroWidth;\n    var isZwsp$1 = isZwsp;\n    var trim$2 = removeZwsp;\n\n    var isElement$2 = isElement$1;\n    var isText$2 = isText$1;\n    var isCaretContainerBlock = function (node) {\n      if (isText$2(node)) {\n        node = node.parentNode;\n      }\n      return isElement$2(node) && node.hasAttribute('data-mce-caret');\n    };\n    var isCaretContainerInline = function (node) {\n      return isText$2(node) && isZwsp$1(node.data);\n    };\n    var isCaretContainer = function (node) {\n      return isCaretContainerBlock(node) || isCaretContainerInline(node);\n    };\n    var hasContent = function (node) {\n      return node.firstChild !== node.lastChild || !isBr(node.firstChild);\n    };\n    var insertInline = function (node, before) {\n      var sibling;\n      var doc = node.ownerDocument;\n      var textNode = doc.createTextNode(ZWSP);\n      var parentNode = node.parentNode;\n      if (!before) {\n        sibling = node.nextSibling;\n        if (isText$2(sibling)) {\n          if (isCaretContainer(sibling)) {\n            return sibling;\n          }\n          if (startsWithCaretContainer(sibling)) {\n            sibling.splitText(1);\n            return sibling;\n          }\n        }\n        if (node.nextSibling) {\n          parentNode.insertBefore(textNode, node.nextSibling);\n        } else {\n          parentNode.appendChild(textNode);\n        }\n      } else {\n        sibling = node.previousSibling;\n        if (isText$2(sibling)) {\n          if (isCaretContainer(sibling)) {\n            return sibling;\n          }\n          if (endsWithCaretContainer(sibling)) {\n            return sibling.splitText(sibling.data.length - 1);\n          }\n        }\n        parentNode.insertBefore(textNode, node);\n      }\n      return textNode;\n    };\n    var isBeforeInline = function (pos) {\n      var container = pos.container();\n      if (!isText$1(container)) {\n        return false;\n      }\n      return container.data.charAt(pos.offset()) === ZWSP || pos.isAtStart() && isCaretContainerInline(container.previousSibling);\n    };\n    var isAfterInline = function (pos) {\n      var container = pos.container();\n      if (!isText$1(container)) {\n        return false;\n      }\n      return container.data.charAt(pos.offset() - 1) === ZWSP || pos.isAtEnd() && isCaretContainerInline(container.nextSibling);\n    };\n    var createBogusBr = function () {\n      var br = document.createElement('br');\n      br.setAttribute('data-mce-bogus', '1');\n      return br;\n    };\n    var insertBlock = function (blockName, node, before) {\n      var doc = node.ownerDocument;\n      var blockNode = doc.createElement(blockName);\n      blockNode.setAttribute('data-mce-caret', before ? 'before' : 'after');\n      blockNode.setAttribute('data-mce-bogus', 'all');\n      blockNode.appendChild(createBogusBr());\n      var parentNode = node.parentNode;\n      if (!before) {\n        if (node.nextSibling) {\n          parentNode.insertBefore(blockNode, node.nextSibling);\n        } else {\n          parentNode.appendChild(blockNode);\n        }\n      } else {\n        parentNode.insertBefore(blockNode, node);\n      }\n      return blockNode;\n    };\n    var startsWithCaretContainer = function (node) {\n      return isText$2(node) && node.data[0] === ZWSP;\n    };\n    var endsWithCaretContainer = function (node) {\n      return isText$2(node) && node.data[node.data.length - 1] === ZWSP;\n    };\n    var trimBogusBr = function (elm) {\n      var brs = elm.getElementsByTagName('br');\n      var lastBr = brs[brs.length - 1];\n      if (isBogus(lastBr)) {\n        lastBr.parentNode.removeChild(lastBr);\n      }\n    };\n    var showCaretContainerBlock = function (caretContainer) {\n      if (caretContainer && caretContainer.hasAttribute('data-mce-caret')) {\n        trimBogusBr(caretContainer);\n        caretContainer.removeAttribute('data-mce-caret');\n        caretContainer.removeAttribute('data-mce-bogus');\n        caretContainer.removeAttribute('style');\n        caretContainer.removeAttribute('_moz_abspos');\n        return caretContainer;\n      }\n      return null;\n    };\n    var isRangeInCaretContainerBlock = function (range) {\n      return isCaretContainerBlock(range.startContainer);\n    };\n\n    var isContentEditableTrue$1 = isContentEditableTrue;\n    var isContentEditableFalse$1 = isContentEditableFalse;\n    var isBr$2 = isBr;\n    var isText$3 = isText$1;\n    var isInvalidTextElement = matchNodeNames([\n      'script',\n      'style',\n      'textarea'\n    ]);\n    var isAtomicInline = matchNodeNames([\n      'img',\n      'input',\n      'textarea',\n      'hr',\n      'iframe',\n      'video',\n      'audio',\n      'object',\n      'embed'\n    ]);\n    var isTable$2 = matchNodeNames(['table']);\n    var isCaretContainer$1 = isCaretContainer;\n    var isCaretCandidate = function (node) {\n      if (isCaretContainer$1(node)) {\n        return false;\n      }\n      if (isText$3(node)) {\n        return !isInvalidTextElement(node.parentNode);\n      }\n      return isAtomicInline(node) || isBr$2(node) || isTable$2(node) || isNonUiContentEditableFalse(node);\n    };\n    var isUnselectable = function (node) {\n      return isElement$1(node) && node.getAttribute('unselectable') === 'true';\n    };\n    var isNonUiContentEditableFalse = function (node) {\n      return isUnselectable(node) === false && isContentEditableFalse$1(node);\n    };\n    var isInEditable = function (node, root) {\n      for (node = node.parentNode; node && node !== root; node = node.parentNode) {\n        if (isNonUiContentEditableFalse(node)) {\n          return false;\n        }\n        if (isContentEditableTrue$1(node)) {\n          return true;\n        }\n      }\n      return true;\n    };\n    var isAtomicContentEditableFalse = function (node) {\n      if (!isNonUiContentEditableFalse(node)) {\n        return false;\n      }\n      return foldl(from$1(node.getElementsByTagName('*')), function (result, elm) {\n        return result || isContentEditableTrue$1(elm);\n      }, false) !== true;\n    };\n    var isAtomic = function (node) {\n      return isAtomicInline(node) || isAtomicContentEditableFalse(node);\n    };\n    var isEditableCaretCandidate = function (node, root) {\n      return isCaretCandidate(node) && isInEditable(node, root);\n    };\n\n    var whiteSpaceRegExp$1 = /^[ \\t\\r\\n]*$/;\n    var isWhitespaceText = function (text) {\n      return whiteSpaceRegExp$1.test(text);\n    };\n\n    var hasWhitespacePreserveParent = function (node, rootNode) {\n      var rootElement = SugarElement.fromDom(rootNode);\n      var startNode = SugarElement.fromDom(node);\n      return ancestor$2(startNode, 'pre,code', curry(eq$2, rootElement));\n    };\n    var isWhitespace = function (node, rootNode) {\n      return isText$1(node) && isWhitespaceText(node.data) && hasWhitespacePreserveParent(node, rootNode) === false;\n    };\n    var isNamedAnchor = function (node) {\n      return isElement$1(node) && node.nodeName === 'A' && !node.hasAttribute('href') && (node.hasAttribute('name') || node.hasAttribute('id'));\n    };\n    var isContent = function (node, rootNode) {\n      return isCaretCandidate(node) && isWhitespace(node, rootNode) === false || isNamedAnchor(node) || isBookmark(node);\n    };\n    var isBookmark = hasAttribute('data-mce-bookmark');\n    var isBogus$1 = hasAttribute('data-mce-bogus');\n    var isBogusAll$1 = hasAttributeValue('data-mce-bogus', 'all');\n    var isEmptyNode = function (targetNode, skipBogus) {\n      var node, brCount = 0;\n      if (isContent(targetNode, targetNode)) {\n        return false;\n      } else {\n        node = targetNode.firstChild;\n        if (!node) {\n          return true;\n        }\n        var walker = new DomTreeWalker(node, targetNode);\n        do {\n          if (skipBogus) {\n            if (isBogusAll$1(node)) {\n              node = walker.next(true);\n              continue;\n            }\n            if (isBogus$1(node)) {\n              node = walker.next();\n              continue;\n            }\n          }\n          if (isBr(node)) {\n            brCount++;\n            node = walker.next();\n            continue;\n          }\n          if (isContent(node, targetNode)) {\n            return false;\n          }\n          node = walker.next();\n        } while (node);\n        return brCount <= 1;\n      }\n    };\n    var isEmpty = function (elm, skipBogus) {\n      if (skipBogus === void 0) {\n        skipBogus = true;\n      }\n      return isEmptyNode(elm.dom, skipBogus);\n    };\n\n    var isSpan = function (node) {\n      return node.nodeName.toLowerCase() === 'span';\n    };\n    var isInlineContent = function (node, root) {\n      return isNonNullable(node) && (isContent(node, root) || isInline(SugarElement.fromDom(node)));\n    };\n    var surroundedByInlineContent = function (node, root) {\n      var prev = new DomTreeWalker(node, root).prev(false);\n      var next = new DomTreeWalker(node, root).next(false);\n      var prevIsInline = isUndefined(prev) || isInlineContent(prev, root);\n      var nextIsInline = isUndefined(next) || isInlineContent(next, root);\n      return prevIsInline && nextIsInline;\n    };\n    var isBookmarkNode = function (node) {\n      return isSpan(node) && node.getAttribute('data-mce-type') === 'bookmark';\n    };\n    var isKeepTextNode = function (node, root) {\n      return isText$1(node) && node.data.length > 0 && surroundedByInlineContent(node, root);\n    };\n    var isKeepElement = function (node) {\n      return isElement$1(node) ? node.childNodes.length > 0 : false;\n    };\n    var isDocument$2 = function (node) {\n      return isDocumentFragment$1(node) || isDocument$1(node);\n    };\n    var trimNode = function (dom, node, root) {\n      var rootNode = root || node;\n      if (isElement$1(node) && isBookmarkNode(node)) {\n        return node;\n      }\n      var children = node.childNodes;\n      for (var i = children.length - 1; i >= 0; i--) {\n        trimNode(dom, children[i], rootNode);\n      }\n      if (isElement$1(node)) {\n        var currentChildren = node.childNodes;\n        if (currentChildren.length === 1 && isBookmarkNode(currentChildren[0])) {\n          node.parentNode.insertBefore(currentChildren[0], node);\n        }\n      }\n      if (!isDocument$2(node) && !isContent(node, rootNode) && !isKeepElement(node) && !isKeepTextNode(node, rootNode)) {\n        dom.remove(node);\n      }\n      return node;\n    };\n\n    var makeMap$1 = Tools.makeMap;\n    var attrsCharsRegExp = /[&<>\\\"\\u0060\\u007E-\\uD7FF\\uE000-\\uFFEF]|[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]/g;\n    var textCharsRegExp = /[<>&\\u007E-\\uD7FF\\uE000-\\uFFEF]|[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]/g;\n    var rawCharsRegExp = /[<>&\\\"\\']/g;\n    var entityRegExp = /&#([a-z0-9]+);?|&([a-z0-9]+);/gi;\n    var asciiMap = {\n      128: '\\u20AC',\n      130: '\\u201A',\n      131: '\\u0192',\n      132: '\\u201E',\n      133: '\\u2026',\n      134: '\\u2020',\n      135: '\\u2021',\n      136: '\\u02c6',\n      137: '\\u2030',\n      138: '\\u0160',\n      139: '\\u2039',\n      140: '\\u0152',\n      142: '\\u017d',\n      145: '\\u2018',\n      146: '\\u2019',\n      147: '\\u201C',\n      148: '\\u201D',\n      149: '\\u2022',\n      150: '\\u2013',\n      151: '\\u2014',\n      152: '\\u02DC',\n      153: '\\u2122',\n      154: '\\u0161',\n      155: '\\u203A',\n      156: '\\u0153',\n      158: '\\u017e',\n      159: '\\u0178'\n    };\n    var baseEntities = {\n      '\"': '&quot;',\n      '\\'': '&#39;',\n      '<': '&lt;',\n      '>': '&gt;',\n      '&': '&amp;',\n      '`': '&#96;'\n    };\n    var reverseEntities = {\n      '&lt;': '<',\n      '&gt;': '>',\n      '&amp;': '&',\n      '&quot;': '\"',\n      '&apos;': '\\''\n    };\n    var nativeDecode = function (text) {\n      var elm = SugarElement.fromTag('div').dom;\n      elm.innerHTML = text;\n      return elm.textContent || elm.innerText || text;\n    };\n    var buildEntitiesLookup = function (items, radix) {\n      var i, chr, entity;\n      var lookup = {};\n      if (items) {\n        items = items.split(',');\n        radix = radix || 10;\n        for (i = 0; i < items.length; i += 2) {\n          chr = String.fromCharCode(parseInt(items[i], radix));\n          if (!baseEntities[chr]) {\n            entity = '&' + items[i + 1] + ';';\n            lookup[chr] = entity;\n            lookup[entity] = chr;\n          }\n        }\n        return lookup;\n      }\n    };\n    var namedEntities = buildEntitiesLookup('50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,' + '5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,' + '5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,' + '5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,' + '68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,' + '6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,' + '6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,' + '75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,' + '7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,' + '7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,' + 'sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,' + 'st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,' + 't9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,' + 'tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,' + 'u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,' + '81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,' + '8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,' + '8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,' + '8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,' + '8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,' + 'nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,' + 'rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,' + 'Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,' + '80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,' + '811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro', 32);\n    var encodeRaw = function (text, attr) {\n      return text.replace(attr ? attrsCharsRegExp : textCharsRegExp, function (chr) {\n        return baseEntities[chr] || chr;\n      });\n    };\n    var encodeAllRaw = function (text) {\n      return ('' + text).replace(rawCharsRegExp, function (chr) {\n        return baseEntities[chr] || chr;\n      });\n    };\n    var encodeNumeric = function (text, attr) {\n      return text.replace(attr ? attrsCharsRegExp : textCharsRegExp, function (chr) {\n        if (chr.length > 1) {\n          return '&#' + ((chr.charCodeAt(0) - 55296) * 1024 + (chr.charCodeAt(1) - 56320) + 65536) + ';';\n        }\n        return baseEntities[chr] || '&#' + chr.charCodeAt(0) + ';';\n      });\n    };\n    var encodeNamed = function (text, attr, entities) {\n      entities = entities || namedEntities;\n      return text.replace(attr ? attrsCharsRegExp : textCharsRegExp, function (chr) {\n        return baseEntities[chr] || entities[chr] || chr;\n      });\n    };\n    var getEncodeFunc = function (name, entities) {\n      var entitiesMap = buildEntitiesLookup(entities) || namedEntities;\n      var encodeNamedAndNumeric = function (text, attr) {\n        return text.replace(attr ? attrsCharsRegExp : textCharsRegExp, function (chr) {\n          if (baseEntities[chr] !== undefined) {\n            return baseEntities[chr];\n          }\n          if (entitiesMap[chr] !== undefined) {\n            return entitiesMap[chr];\n          }\n          if (chr.length > 1) {\n            return '&#' + ((chr.charCodeAt(0) - 55296) * 1024 + (chr.charCodeAt(1) - 56320) + 65536) + ';';\n          }\n          return '&#' + chr.charCodeAt(0) + ';';\n        });\n      };\n      var encodeCustomNamed = function (text, attr) {\n        return encodeNamed(text, attr, entitiesMap);\n      };\n      var nameMap = makeMap$1(name.replace(/\\+/g, ','));\n      if (nameMap.named && nameMap.numeric) {\n        return encodeNamedAndNumeric;\n      }\n      if (nameMap.named) {\n        if (entities) {\n          return encodeCustomNamed;\n        }\n        return encodeNamed;\n      }\n      if (nameMap.numeric) {\n        return encodeNumeric;\n      }\n      return encodeRaw;\n    };\n    var decode = function (text) {\n      return text.replace(entityRegExp, function (all, numeric) {\n        if (numeric) {\n          if (numeric.charAt(0).toLowerCase() === 'x') {\n            numeric = parseInt(numeric.substr(1), 16);\n          } else {\n            numeric = parseInt(numeric, 10);\n          }\n          if (numeric > 65535) {\n            numeric -= 65536;\n            return String.fromCharCode(55296 + (numeric >> 10), 56320 + (numeric & 1023));\n          }\n          return asciiMap[numeric] || String.fromCharCode(numeric);\n        }\n        return reverseEntities[all] || namedEntities[all] || nativeDecode(all);\n      });\n    };\n    var Entities = {\n      encodeRaw: encodeRaw,\n      encodeAllRaw: encodeAllRaw,\n      encodeNumeric: encodeNumeric,\n      encodeNamed: encodeNamed,\n      getEncodeFunc: getEncodeFunc,\n      decode: decode\n    };\n\n    var mapCache = {}, dummyObj = {};\n    var makeMap$2 = Tools.makeMap, each$3 = Tools.each, extend$1 = Tools.extend, explode$1 = Tools.explode, inArray = Tools.inArray;\n    var split = function (items, delim) {\n      items = Tools.trim(items);\n      return items ? items.split(delim || ' ') : [];\n    };\n    var compileSchema = function (type) {\n      var schema = {};\n      var globalAttributes, blockContent;\n      var phrasingContent, flowContent, html4BlockContent, html4PhrasingContent;\n      var add = function (name, attributes, children) {\n        var ni, attributesOrder, element;\n        var arrayToMap = function (array, obj) {\n          var map = {};\n          var i, l;\n          for (i = 0, l = array.length; i < l; i++) {\n            map[array[i]] = obj || {};\n          }\n          return map;\n        };\n        children = children || [];\n        attributes = attributes || '';\n        if (typeof children === 'string') {\n          children = split(children);\n        }\n        var names = split(name);\n        ni = names.length;\n        while (ni--) {\n          attributesOrder = split([\n            globalAttributes,\n            attributes\n          ].join(' '));\n          element = {\n            attributes: arrayToMap(attributesOrder),\n            attributesOrder: attributesOrder,\n            children: arrayToMap(children, dummyObj)\n          };\n          schema[names[ni]] = element;\n        }\n      };\n      var addAttrs = function (name, attributes) {\n        var ni, schemaItem, i, l;\n        var names = split(name);\n        ni = names.length;\n        var attrs = split(attributes);\n        while (ni--) {\n          schemaItem = schema[names[ni]];\n          for (i = 0, l = attrs.length; i < l; i++) {\n            schemaItem.attributes[attrs[i]] = {};\n            schemaItem.attributesOrder.push(attrs[i]);\n          }\n        }\n      };\n      if (mapCache[type]) {\n        return mapCache[type];\n      }\n      globalAttributes = 'id accesskey class dir lang style tabindex title role';\n      blockContent = 'address blockquote div dl fieldset form h1 h2 h3 h4 h5 h6 hr menu ol p pre table ul';\n      phrasingContent = 'a abbr b bdo br button cite code del dfn em embed i iframe img input ins kbd ' + 'label map noscript object q s samp script select small span strong sub sup ' + 'textarea u var #text #comment';\n      if (type !== 'html4') {\n        globalAttributes += ' contenteditable contextmenu draggable dropzone ' + 'hidden spellcheck translate';\n        blockContent += ' article aside details dialog figure main header footer hgroup section nav';\n        phrasingContent += ' audio canvas command datalist mark meter output picture ' + 'progress time wbr video ruby bdi keygen';\n      }\n      if (type !== 'html5-strict') {\n        globalAttributes += ' xml:lang';\n        html4PhrasingContent = 'acronym applet basefont big font strike tt';\n        phrasingContent = [\n          phrasingContent,\n          html4PhrasingContent\n        ].join(' ');\n        each$3(split(html4PhrasingContent), function (name) {\n          add(name, '', phrasingContent);\n        });\n        html4BlockContent = 'center dir isindex noframes';\n        blockContent = [\n          blockContent,\n          html4BlockContent\n        ].join(' ');\n        flowContent = [\n          blockContent,\n          phrasingContent\n        ].join(' ');\n        each$3(split(html4BlockContent), function (name) {\n          add(name, '', flowContent);\n        });\n      }\n      flowContent = flowContent || [\n        blockContent,\n        phrasingContent\n      ].join(' ');\n      add('html', 'manifest', 'head body');\n      add('head', '', 'base command link meta noscript script style title');\n      add('title hr noscript br');\n      add('base', 'href target');\n      add('link', 'href rel media hreflang type sizes hreflang');\n      add('meta', 'name http-equiv content charset');\n      add('style', 'media type scoped');\n      add('script', 'src async defer type charset');\n      add('body', 'onafterprint onbeforeprint onbeforeunload onblur onerror onfocus ' + 'onhashchange onload onmessage onoffline ononline onpagehide onpageshow ' + 'onpopstate onresize onscroll onstorage onunload', flowContent);\n      add('address dt dd div caption', '', flowContent);\n      add('h1 h2 h3 h4 h5 h6 pre p abbr code var samp kbd sub sup i b u bdo span legend em strong small s cite dfn', '', phrasingContent);\n      add('blockquote', 'cite', flowContent);\n      add('ol', 'reversed start type', 'li');\n      add('ul', '', 'li');\n      add('li', 'value', flowContent);\n      add('dl', '', 'dt dd');\n      add('a', 'href target rel media hreflang type', phrasingContent);\n      add('q', 'cite', phrasingContent);\n      add('ins del', 'cite datetime', flowContent);\n      add('img', 'src sizes srcset alt usemap ismap width height');\n      add('iframe', 'src name width height', flowContent);\n      add('embed', 'src type width height');\n      add('object', 'data type typemustmatch name usemap form width height', [\n        flowContent,\n        'param'\n      ].join(' '));\n      add('param', 'name value');\n      add('map', 'name', [\n        flowContent,\n        'area'\n      ].join(' '));\n      add('area', 'alt coords shape href target rel media hreflang type');\n      add('table', 'border', 'caption colgroup thead tfoot tbody tr' + (type === 'html4' ? ' col' : ''));\n      add('colgroup', 'span', 'col');\n      add('col', 'span');\n      add('tbody thead tfoot', '', 'tr');\n      add('tr', '', 'td th');\n      add('td', 'colspan rowspan headers', flowContent);\n      add('th', 'colspan rowspan headers scope abbr', flowContent);\n      add('form', 'accept-charset action autocomplete enctype method name novalidate target', flowContent);\n      add('fieldset', 'disabled form name', [\n        flowContent,\n        'legend'\n      ].join(' '));\n      add('label', 'form for', phrasingContent);\n      add('input', 'accept alt autocomplete checked dirname disabled form formaction formenctype formmethod formnovalidate ' + 'formtarget height list max maxlength min multiple name pattern readonly required size src step type value width');\n      add('button', 'disabled form formaction formenctype formmethod formnovalidate formtarget name type value', type === 'html4' ? flowContent : phrasingContent);\n      add('select', 'disabled form multiple name required size', 'option optgroup');\n      add('optgroup', 'disabled label', 'option');\n      add('option', 'disabled label selected value');\n      add('textarea', 'cols dirname disabled form maxlength name readonly required rows wrap');\n      add('menu', 'type label', [\n        flowContent,\n        'li'\n      ].join(' '));\n      add('noscript', '', flowContent);\n      if (type !== 'html4') {\n        add('wbr');\n        add('ruby', '', [\n          phrasingContent,\n          'rt rp'\n        ].join(' '));\n        add('figcaption', '', flowContent);\n        add('mark rt rp summary bdi', '', phrasingContent);\n        add('canvas', 'width height', flowContent);\n        add('video', 'src crossorigin poster preload autoplay mediagroup loop ' + 'muted controls width height buffered', [\n          flowContent,\n          'track source'\n        ].join(' '));\n        add('audio', 'src crossorigin preload autoplay mediagroup loop muted controls ' + 'buffered volume', [\n          flowContent,\n          'track source'\n        ].join(' '));\n        add('picture', '', 'img source');\n        add('source', 'src srcset type media sizes');\n        add('track', 'kind src srclang label default');\n        add('datalist', '', [\n          phrasingContent,\n          'option'\n        ].join(' '));\n        add('article section nav aside main header footer', '', flowContent);\n        add('hgroup', '', 'h1 h2 h3 h4 h5 h6');\n        add('figure', '', [\n          flowContent,\n          'figcaption'\n        ].join(' '));\n        add('time', 'datetime', phrasingContent);\n        add('dialog', 'open', flowContent);\n        add('command', 'type label icon disabled checked radiogroup command');\n        add('output', 'for form name', phrasingContent);\n        add('progress', 'value max', phrasingContent);\n        add('meter', 'value min max low high optimum', phrasingContent);\n        add('details', 'open', [\n          flowContent,\n          'summary'\n        ].join(' '));\n        add('keygen', 'autofocus challenge disabled form keytype name');\n      }\n      if (type !== 'html5-strict') {\n        addAttrs('script', 'language xml:space');\n        addAttrs('style', 'xml:space');\n        addAttrs('object', 'declare classid code codebase codetype archive standby align border hspace vspace');\n        addAttrs('embed', 'align name hspace vspace');\n        addAttrs('param', 'valuetype type');\n        addAttrs('a', 'charset name rev shape coords');\n        addAttrs('br', 'clear');\n        addAttrs('applet', 'codebase archive code object alt name width height align hspace vspace');\n        addAttrs('img', 'name longdesc align border hspace vspace');\n        addAttrs('iframe', 'longdesc frameborder marginwidth marginheight scrolling align');\n        addAttrs('font basefont', 'size color face');\n        addAttrs('input', 'usemap align');\n        addAttrs('select');\n        addAttrs('textarea');\n        addAttrs('h1 h2 h3 h4 h5 h6 div p legend caption', 'align');\n        addAttrs('ul', 'type compact');\n        addAttrs('li', 'type');\n        addAttrs('ol dl menu dir', 'compact');\n        addAttrs('pre', 'width xml:space');\n        addAttrs('hr', 'align noshade size width');\n        addAttrs('isindex', 'prompt');\n        addAttrs('table', 'summary width frame rules cellspacing cellpadding align bgcolor');\n        addAttrs('col', 'width align char charoff valign');\n        addAttrs('colgroup', 'width align char charoff valign');\n        addAttrs('thead', 'align char charoff valign');\n        addAttrs('tr', 'align char charoff valign bgcolor');\n        addAttrs('th', 'axis align char charoff valign nowrap bgcolor width height');\n        addAttrs('form', 'accept');\n        addAttrs('td', 'abbr axis scope align char charoff valign nowrap bgcolor width height');\n        addAttrs('tfoot', 'align char charoff valign');\n        addAttrs('tbody', 'align char charoff valign');\n        addAttrs('area', 'nohref');\n        addAttrs('body', 'background bgcolor text link vlink alink');\n      }\n      if (type !== 'html4') {\n        addAttrs('input button select textarea', 'autofocus');\n        addAttrs('input textarea', 'placeholder');\n        addAttrs('a', 'download');\n        addAttrs('link script img', 'crossorigin');\n        addAttrs('img', 'loading');\n        addAttrs('iframe', 'sandbox seamless allowfullscreen loading');\n      }\n      each$3(split('a form meter progress dfn'), function (name) {\n        if (schema[name]) {\n          delete schema[name].children[name];\n        }\n      });\n      delete schema.caption.children.table;\n      delete schema.script;\n      mapCache[type] = schema;\n      return schema;\n    };\n    var compileElementMap = function (value, mode) {\n      var styles;\n      if (value) {\n        styles = {};\n        if (typeof value === 'string') {\n          value = { '*': value };\n        }\n        each$3(value, function (value, key) {\n          styles[key] = styles[key.toUpperCase()] = mode === 'map' ? makeMap$2(value, /[, ]/) : explode$1(value, /[, ]/);\n        });\n      }\n      return styles;\n    };\n    function Schema(settings) {\n      var elements = {};\n      var children = {};\n      var patternElements = [];\n      var customElementsMap = {}, specialElements = {};\n      var createLookupTable = function (option, defaultValue, extendWith) {\n        var value = settings[option];\n        if (!value) {\n          value = mapCache[option];\n          if (!value) {\n            value = makeMap$2(defaultValue, ' ', makeMap$2(defaultValue.toUpperCase(), ' '));\n            value = extend$1(value, extendWith);\n            mapCache[option] = value;\n          }\n        } else {\n          value = makeMap$2(value, /[, ]/, makeMap$2(value.toUpperCase(), /[, ]/));\n        }\n        return value;\n      };\n      settings = settings || {};\n      var schemaItems = compileSchema(settings.schema);\n      if (settings.verify_html === false) {\n        settings.valid_elements = '*[*]';\n      }\n      var validStyles = compileElementMap(settings.valid_styles);\n      var invalidStyles = compileElementMap(settings.invalid_styles, 'map');\n      var validClasses = compileElementMap(settings.valid_classes, 'map');\n      var whiteSpaceElementsMap = createLookupTable('whitespace_elements', 'pre script noscript style textarea video audio iframe object code');\n      var selfClosingElementsMap = createLookupTable('self_closing_elements', 'colgroup dd dt li option p td tfoot th thead tr');\n      var shortEndedElementsMap = createLookupTable('short_ended_elements', 'area base basefont br col frame hr img input isindex link ' + 'meta param embed source wbr track');\n      var boolAttrMap = createLookupTable('boolean_attributes', 'checked compact declare defer disabled ismap multiple nohref noresize ' + 'noshade nowrap readonly selected autoplay loop controls');\n      var nonEmptyOrMoveCaretBeforeOnEnter = 'td th iframe video audio object script code';\n      var nonEmptyElementsMap = createLookupTable('non_empty_elements', nonEmptyOrMoveCaretBeforeOnEnter + ' pre', shortEndedElementsMap);\n      var moveCaretBeforeOnEnterElementsMap = createLookupTable('move_caret_before_on_enter_elements', nonEmptyOrMoveCaretBeforeOnEnter + ' table', shortEndedElementsMap);\n      var textBlockElementsMap = createLookupTable('text_block_elements', 'h1 h2 h3 h4 h5 h6 p div address pre form ' + 'blockquote center dir fieldset header footer article section hgroup aside main nav figure');\n      var blockElementsMap = createLookupTable('block_elements', 'hr table tbody thead tfoot ' + 'th tr td li ol ul caption dl dt dd noscript menu isindex option ' + 'datalist select optgroup figcaption details summary', textBlockElementsMap);\n      var textInlineElementsMap = createLookupTable('text_inline_elements', 'span strong b em i font strike u var cite ' + 'dfn code mark q sup sub samp');\n      each$3((settings.special || 'script noscript iframe noframes noembed title style textarea xmp').split(' '), function (name) {\n        specialElements[name] = new RegExp('</' + name + '[^>]*>', 'gi');\n      });\n      var patternToRegExp = function (str) {\n        return new RegExp('^' + str.replace(/([?+*])/g, '.$1') + '$');\n      };\n      var addValidElements = function (validElements) {\n        var ei, el, ai, al, matches, element, attr, attrData, elementName, attrName, attrType, attributes, attributesOrder, prefix, outputName, globalAttributes, globalAttributesOrder, value;\n        var elementRuleRegExp = /^([#+\\-])?([^\\[!\\/]+)(?:\\/([^\\[!]+))?(?:(!?)\\[([^\\]]+)])?$/, attrRuleRegExp = /^([!\\-])?(\\w+[\\\\:]:\\w+|[^=:<]+)?(?:([=:<])(.*))?$/, hasPatternsRegExp = /[*?+]/;\n        if (validElements) {\n          var validElementsArr = split(validElements, ',');\n          if (elements['@']) {\n            globalAttributes = elements['@'].attributes;\n            globalAttributesOrder = elements['@'].attributesOrder;\n          }\n          for (ei = 0, el = validElementsArr.length; ei < el; ei++) {\n            matches = elementRuleRegExp.exec(validElementsArr[ei]);\n            if (matches) {\n              prefix = matches[1];\n              elementName = matches[2];\n              outputName = matches[3];\n              attrData = matches[5];\n              attributes = {};\n              attributesOrder = [];\n              element = {\n                attributes: attributes,\n                attributesOrder: attributesOrder\n              };\n              if (prefix === '#') {\n                element.paddEmpty = true;\n              }\n              if (prefix === '-') {\n                element.removeEmpty = true;\n              }\n              if (matches[4] === '!') {\n                element.removeEmptyAttrs = true;\n              }\n              if (globalAttributes) {\n                each$1(globalAttributes, function (value, key) {\n                  attributes[key] = value;\n                });\n                attributesOrder.push.apply(attributesOrder, globalAttributesOrder);\n              }\n              if (attrData) {\n                attrData = split(attrData, '|');\n                for (ai = 0, al = attrData.length; ai < al; ai++) {\n                  matches = attrRuleRegExp.exec(attrData[ai]);\n                  if (matches) {\n                    attr = {};\n                    attrType = matches[1];\n                    attrName = matches[2].replace(/[\\\\:]:/g, ':');\n                    prefix = matches[3];\n                    value = matches[4];\n                    if (attrType === '!') {\n                      element.attributesRequired = element.attributesRequired || [];\n                      element.attributesRequired.push(attrName);\n                      attr.required = true;\n                    }\n                    if (attrType === '-') {\n                      delete attributes[attrName];\n                      attributesOrder.splice(inArray(attributesOrder, attrName), 1);\n                      continue;\n                    }\n                    if (prefix) {\n                      if (prefix === '=') {\n                        element.attributesDefault = element.attributesDefault || [];\n                        element.attributesDefault.push({\n                          name: attrName,\n                          value: value\n                        });\n                        attr.defaultValue = value;\n                      }\n                      if (prefix === ':') {\n                        element.attributesForced = element.attributesForced || [];\n                        element.attributesForced.push({\n                          name: attrName,\n                          value: value\n                        });\n                        attr.forcedValue = value;\n                      }\n                      if (prefix === '<') {\n                        attr.validValues = makeMap$2(value, '?');\n                      }\n                    }\n                    if (hasPatternsRegExp.test(attrName)) {\n                      element.attributePatterns = element.attributePatterns || [];\n                      attr.pattern = patternToRegExp(attrName);\n                      element.attributePatterns.push(attr);\n                    } else {\n                      if (!attributes[attrName]) {\n                        attributesOrder.push(attrName);\n                      }\n                      attributes[attrName] = attr;\n                    }\n                  }\n                }\n              }\n              if (!globalAttributes && elementName === '@') {\n                globalAttributes = attributes;\n                globalAttributesOrder = attributesOrder;\n              }\n              if (outputName) {\n                element.outputName = elementName;\n                elements[outputName] = element;\n              }\n              if (hasPatternsRegExp.test(elementName)) {\n                element.pattern = patternToRegExp(elementName);\n                patternElements.push(element);\n              } else {\n                elements[elementName] = element;\n              }\n            }\n          }\n        }\n      };\n      var setValidElements = function (validElements) {\n        elements = {};\n        patternElements = [];\n        addValidElements(validElements);\n        each$3(schemaItems, function (element, name) {\n          children[name] = element.children;\n        });\n      };\n      var addCustomElements = function (customElements) {\n        var customElementRegExp = /^(~)?(.+)$/;\n        if (customElements) {\n          mapCache.text_block_elements = mapCache.block_elements = null;\n          each$3(split(customElements, ','), function (rule) {\n            var matches = customElementRegExp.exec(rule), inline = matches[1] === '~', cloneName = inline ? 'span' : 'div', name = matches[2];\n            children[name] = children[cloneName];\n            customElementsMap[name] = cloneName;\n            if (!inline) {\n              blockElementsMap[name.toUpperCase()] = {};\n              blockElementsMap[name] = {};\n            }\n            if (!elements[name]) {\n              var customRule = elements[cloneName];\n              customRule = extend$1({}, customRule);\n              delete customRule.removeEmptyAttrs;\n              delete customRule.removeEmpty;\n              elements[name] = customRule;\n            }\n            each$3(children, function (element, elmName) {\n              if (element[cloneName]) {\n                children[elmName] = element = extend$1({}, children[elmName]);\n                element[name] = element[cloneName];\n              }\n            });\n          });\n        }\n      };\n      var addValidChildren = function (validChildren) {\n        var childRuleRegExp = /^([+\\-]?)([A-Za-z0-9_\\-.\\u00b7\\u00c0-\\u00d6\\u00d8-\\u00f6\\u00f8-\\u037d\\u037f-\\u1fff\\u200c-\\u200d\\u203f-\\u2040\\u2070-\\u218f\\u2c00-\\u2fef\\u3001-\\ud7ff\\uf900-\\ufdcf\\ufdf0-\\ufffd]+)\\[([^\\]]+)]$/;\n        mapCache[settings.schema] = null;\n        if (validChildren) {\n          each$3(split(validChildren, ','), function (rule) {\n            var matches = childRuleRegExp.exec(rule);\n            var parent, prefix;\n            if (matches) {\n              prefix = matches[1];\n              if (prefix) {\n                parent = children[matches[2]];\n              } else {\n                parent = children[matches[2]] = { '#comment': {} };\n              }\n              parent = children[matches[2]];\n              each$3(split(matches[3], '|'), function (child) {\n                if (prefix === '-') {\n                  delete parent[child];\n                } else {\n                  parent[child] = {};\n                }\n              });\n            }\n          });\n        }\n      };\n      var getElementRule = function (name) {\n        var element = elements[name], i;\n        if (element) {\n          return element;\n        }\n        i = patternElements.length;\n        while (i--) {\n          element = patternElements[i];\n          if (element.pattern.test(name)) {\n            return element;\n          }\n        }\n      };\n      if (!settings.valid_elements) {\n        each$3(schemaItems, function (element, name) {\n          elements[name] = {\n            attributes: element.attributes,\n            attributesOrder: element.attributesOrder\n          };\n          children[name] = element.children;\n        });\n        if (settings.schema !== 'html5') {\n          each$3(split('strong/b em/i'), function (item) {\n            var items = split(item, '/');\n            elements[items[1]].outputName = items[0];\n          });\n        }\n        each$3(split('ol ul sub sup blockquote span font a table tbody tr strong em b i'), function (name) {\n          if (elements[name]) {\n            elements[name].removeEmpty = true;\n          }\n        });\n        each$3(split('p h1 h2 h3 h4 h5 h6 th td pre div address caption li'), function (name) {\n          elements[name].paddEmpty = true;\n        });\n        each$3(split('span'), function (name) {\n          elements[name].removeEmptyAttrs = true;\n        });\n      } else {\n        setValidElements(settings.valid_elements);\n      }\n      addCustomElements(settings.custom_elements);\n      addValidChildren(settings.valid_children);\n      addValidElements(settings.extended_valid_elements);\n      addValidChildren('+ol[ul|ol],+ul[ul|ol]');\n      each$3({\n        dd: 'dl',\n        dt: 'dl',\n        li: 'ul ol',\n        td: 'tr',\n        th: 'tr',\n        tr: 'tbody thead tfoot',\n        tbody: 'table',\n        thead: 'table',\n        tfoot: 'table',\n        legend: 'fieldset',\n        area: 'map',\n        param: 'video audio object'\n      }, function (parents, item) {\n        if (elements[item]) {\n          elements[item].parentsRequired = split(parents);\n        }\n      });\n      if (settings.invalid_elements) {\n        each$3(explode$1(settings.invalid_elements), function (item) {\n          if (elements[item]) {\n            delete elements[item];\n          }\n        });\n      }\n      if (!getElementRule('span')) {\n        addValidElements('span[!data-mce-type|*]');\n      }\n      var getValidStyles = function () {\n        return validStyles;\n      };\n      var getInvalidStyles = function () {\n        return invalidStyles;\n      };\n      var getValidClasses = function () {\n        return validClasses;\n      };\n      var getBoolAttrs = function () {\n        return boolAttrMap;\n      };\n      var getBlockElements = function () {\n        return blockElementsMap;\n      };\n      var getTextBlockElements = function () {\n        return textBlockElementsMap;\n      };\n      var getTextInlineElements = function () {\n        return textInlineElementsMap;\n      };\n      var getShortEndedElements = function () {\n        return shortEndedElementsMap;\n      };\n      var getSelfClosingElements = function () {\n        return selfClosingElementsMap;\n      };\n      var getNonEmptyElements = function () {\n        return nonEmptyElementsMap;\n      };\n      var getMoveCaretBeforeOnEnterElements = function () {\n        return moveCaretBeforeOnEnterElementsMap;\n      };\n      var getWhiteSpaceElements = function () {\n        return whiteSpaceElementsMap;\n      };\n      var getSpecialElements = function () {\n        return specialElements;\n      };\n      var isValidChild = function (name, child) {\n        var parent = children[name.toLowerCase()];\n        return !!(parent && parent[child.toLowerCase()]);\n      };\n      var isValid = function (name, attr) {\n        var attrPatterns, i;\n        var rule = getElementRule(name);\n        if (rule) {\n          if (attr) {\n            if (rule.attributes[attr]) {\n              return true;\n            }\n            attrPatterns = rule.attributePatterns;\n            if (attrPatterns) {\n              i = attrPatterns.length;\n              while (i--) {\n                if (attrPatterns[i].pattern.test(name)) {\n                  return true;\n                }\n              }\n            }\n          } else {\n            return true;\n          }\n        }\n        return false;\n      };\n      var getCustomElements = function () {\n        return customElementsMap;\n      };\n      return {\n        children: children,\n        elements: elements,\n        getValidStyles: getValidStyles,\n        getValidClasses: getValidClasses,\n        getBlockElements: getBlockElements,\n        getInvalidStyles: getInvalidStyles,\n        getShortEndedElements: getShortEndedElements,\n        getTextBlockElements: getTextBlockElements,\n        getTextInlineElements: getTextInlineElements,\n        getBoolAttrs: getBoolAttrs,\n        getElementRule: getElementRule,\n        getSelfClosingElements: getSelfClosingElements,\n        getNonEmptyElements: getNonEmptyElements,\n        getMoveCaretBeforeOnEnterElements: getMoveCaretBeforeOnEnterElements,\n        getWhiteSpaceElements: getWhiteSpaceElements,\n        getSpecialElements: getSpecialElements,\n        isValidChild: isValidChild,\n        isValid: isValid,\n        getCustomElements: getCustomElements,\n        addValidElements: addValidElements,\n        setValidElements: setValidElements,\n        addCustomElements: addCustomElements,\n        addValidChildren: addValidChildren\n      };\n    }\n\n    var toHex = function (match, r, g, b) {\n      var hex = function (val) {\n        val = parseInt(val, 10).toString(16);\n        return val.length > 1 ? val : '0' + val;\n      };\n      return '#' + hex(r) + hex(g) + hex(b);\n    };\n    var Styles = function (settings, schema) {\n      var rgbRegExp = /rgb\\s*\\(\\s*([0-9]+)\\s*,\\s*([0-9]+)\\s*,\\s*([0-9]+)\\s*\\)/gi;\n      var urlOrStrRegExp = /(?:url(?:(?:\\(\\s*\\\"([^\\\"]+)\\\"\\s*\\))|(?:\\(\\s*\\'([^\\']+)\\'\\s*\\))|(?:\\(\\s*([^)\\s]+)\\s*\\))))|(?:\\'([^\\']+)\\')|(?:\\\"([^\\\"]+)\\\")/gi;\n      var styleRegExp = /\\s*([^:]+):\\s*([^;]+);?/g;\n      var trimRightRegExp = /\\s+$/;\n      var i;\n      var encodingLookup = {};\n      var validStyles;\n      var invalidStyles;\n      var invisibleChar = zeroWidth;\n      settings = settings || {};\n      if (schema) {\n        validStyles = schema.getValidStyles();\n        invalidStyles = schema.getInvalidStyles();\n      }\n      var encodingItems = ('\\\\\" \\\\\\' \\\\; \\\\: ; : ' + invisibleChar).split(' ');\n      for (i = 0; i < encodingItems.length; i++) {\n        encodingLookup[encodingItems[i]] = invisibleChar + i;\n        encodingLookup[invisibleChar + i] = encodingItems[i];\n      }\n      return {\n        toHex: function (color) {\n          return color.replace(rgbRegExp, toHex);\n        },\n        parse: function (css) {\n          var styles = {};\n          var matches, name, value, isEncoded;\n          var urlConverter = settings.url_converter;\n          var urlConverterScope = settings.url_converter_scope || this;\n          var compress = function (prefix, suffix, noJoin) {\n            var top = styles[prefix + '-top' + suffix];\n            if (!top) {\n              return;\n            }\n            var right = styles[prefix + '-right' + suffix];\n            if (!right) {\n              return;\n            }\n            var bottom = styles[prefix + '-bottom' + suffix];\n            if (!bottom) {\n              return;\n            }\n            var left = styles[prefix + '-left' + suffix];\n            if (!left) {\n              return;\n            }\n            var box = [\n              top,\n              right,\n              bottom,\n              left\n            ];\n            i = box.length - 1;\n            while (i--) {\n              if (box[i] !== box[i + 1]) {\n                break;\n              }\n            }\n            if (i > -1 && noJoin) {\n              return;\n            }\n            styles[prefix + suffix] = i === -1 ? box[0] : box.join(' ');\n            delete styles[prefix + '-top' + suffix];\n            delete styles[prefix + '-right' + suffix];\n            delete styles[prefix + '-bottom' + suffix];\n            delete styles[prefix + '-left' + suffix];\n          };\n          var canCompress = function (key) {\n            var value = styles[key], i;\n            if (!value) {\n              return;\n            }\n            value = value.split(' ');\n            i = value.length;\n            while (i--) {\n              if (value[i] !== value[0]) {\n                return false;\n              }\n            }\n            styles[key] = value[0];\n            return true;\n          };\n          var compress2 = function (target, a, b, c) {\n            if (!canCompress(a)) {\n              return;\n            }\n            if (!canCompress(b)) {\n              return;\n            }\n            if (!canCompress(c)) {\n              return;\n            }\n            styles[target] = styles[a] + ' ' + styles[b] + ' ' + styles[c];\n            delete styles[a];\n            delete styles[b];\n            delete styles[c];\n          };\n          var encode = function (str) {\n            isEncoded = true;\n            return encodingLookup[str];\n          };\n          var decode = function (str, keepSlashes) {\n            if (isEncoded) {\n              str = str.replace(/\\uFEFF[0-9]/g, function (str) {\n                return encodingLookup[str];\n              });\n            }\n            if (!keepSlashes) {\n              str = str.replace(/\\\\([\\'\\\";:])/g, '$1');\n            }\n            return str;\n          };\n          var decodeSingleHexSequence = function (escSeq) {\n            return String.fromCharCode(parseInt(escSeq.slice(1), 16));\n          };\n          var decodeHexSequences = function (value) {\n            return value.replace(/\\\\[0-9a-f]+/gi, decodeSingleHexSequence);\n          };\n          var processUrl = function (match, url, url2, url3, str, str2) {\n            str = str || str2;\n            if (str) {\n              str = decode(str);\n              return '\\'' + str.replace(/\\'/g, '\\\\\\'') + '\\'';\n            }\n            url = decode(url || url2 || url3);\n            if (!settings.allow_script_urls) {\n              var scriptUrl = url.replace(/[\\s\\r\\n]+/g, '');\n              if (/(java|vb)script:/i.test(scriptUrl)) {\n                return '';\n              }\n              if (!settings.allow_svg_data_urls && /^data:image\\/svg/i.test(scriptUrl)) {\n                return '';\n              }\n            }\n            if (urlConverter) {\n              url = urlConverter.call(urlConverterScope, url, 'style');\n            }\n            return 'url(\\'' + url.replace(/\\'/g, '\\\\\\'') + '\\')';\n          };\n          if (css) {\n            css = css.replace(/[\\u0000-\\u001F]/g, '');\n            css = css.replace(/\\\\[\\\"\\';:\\uFEFF]/g, encode).replace(/\\\"[^\\\"]+\\\"|\\'[^\\']+\\'/g, function (str) {\n              return str.replace(/[;:]/g, encode);\n            });\n            while (matches = styleRegExp.exec(css)) {\n              styleRegExp.lastIndex = matches.index + matches[0].length;\n              name = matches[1].replace(trimRightRegExp, '').toLowerCase();\n              value = matches[2].replace(trimRightRegExp, '');\n              if (name && value) {\n                name = decodeHexSequences(name);\n                value = decodeHexSequences(value);\n                if (name.indexOf(invisibleChar) !== -1 || name.indexOf('\"') !== -1) {\n                  continue;\n                }\n                if (!settings.allow_script_urls && (name === 'behavior' || /expression\\s*\\(|\\/\\*|\\*\\//.test(value))) {\n                  continue;\n                }\n                if (name === 'font-weight' && value === '700') {\n                  value = 'bold';\n                } else if (name === 'color' || name === 'background-color') {\n                  value = value.toLowerCase();\n                }\n                value = value.replace(rgbRegExp, toHex);\n                value = value.replace(urlOrStrRegExp, processUrl);\n                styles[name] = isEncoded ? decode(value, true) : value;\n              }\n            }\n            compress('border', '', true);\n            compress('border', '-width');\n            compress('border', '-color');\n            compress('border', '-style');\n            compress('padding', '');\n            compress('margin', '');\n            compress2('border', 'border-width', 'border-style', 'border-color');\n            if (styles.border === 'medium none') {\n              delete styles.border;\n            }\n            if (styles['border-image'] === 'none') {\n              delete styles['border-image'];\n            }\n          }\n          return styles;\n        },\n        serialize: function (styles, elementName) {\n          var css = '';\n          var serializeStyles = function (name) {\n            var value;\n            var styleList = validStyles[name];\n            if (styleList) {\n              for (var i_1 = 0, l = styleList.length; i_1 < l; i_1++) {\n                name = styleList[i_1];\n                value = styles[name];\n                if (value) {\n                  css += (css.length > 0 ? ' ' : '') + name + ': ' + value + ';';\n                }\n              }\n            }\n          };\n          var isValid = function (name, elementName) {\n            var styleMap = invalidStyles['*'];\n            if (styleMap && styleMap[name]) {\n              return false;\n            }\n            styleMap = invalidStyles[elementName];\n            return !(styleMap && styleMap[name]);\n          };\n          if (elementName && validStyles) {\n            serializeStyles('*');\n            serializeStyles(elementName);\n          } else {\n            each$1(styles, function (value, name) {\n              if (value && (!invalidStyles || isValid(name, elementName))) {\n                css += (css.length > 0 ? ' ' : '') + name + ': ' + value + ';';\n              }\n            });\n          }\n          return css;\n        }\n      };\n    };\n\n    var eventExpandoPrefix = 'mce-data-';\n    var mouseEventRe = /^(?:mouse|contextmenu)|click/;\n    var deprecated = {\n      keyLocation: 1,\n      layerX: 1,\n      layerY: 1,\n      returnValue: 1,\n      webkitMovementX: 1,\n      webkitMovementY: 1,\n      keyIdentifier: 1,\n      mozPressure: 1\n    };\n    var hasIsDefaultPrevented = function (event) {\n      return event.isDefaultPrevented === returnTrue || event.isDefaultPrevented === returnFalse;\n    };\n    var returnFalse = function () {\n      return false;\n    };\n    var returnTrue = function () {\n      return true;\n    };\n    var addEvent = function (target, name, callback, capture) {\n      if (target.addEventListener) {\n        target.addEventListener(name, callback, capture || false);\n      } else if (target.attachEvent) {\n        target.attachEvent('on' + name, callback);\n      }\n    };\n    var removeEvent = function (target, name, callback, capture) {\n      if (target.removeEventListener) {\n        target.removeEventListener(name, callback, capture || false);\n      } else if (target.detachEvent) {\n        target.detachEvent('on' + name, callback);\n      }\n    };\n    var isMouseEvent = function (event) {\n      return mouseEventRe.test(event.type);\n    };\n    var fix = function (originalEvent, data) {\n      var name;\n      var event = data || {};\n      for (name in originalEvent) {\n        if (!deprecated[name]) {\n          event[name] = originalEvent[name];\n        }\n      }\n      if (!event.target) {\n        event.target = event.srcElement || document;\n      }\n      if (event.composedPath) {\n        event.composedPath = function () {\n          return originalEvent.composedPath();\n        };\n      }\n      if (originalEvent && isMouseEvent(originalEvent) && originalEvent.pageX === undefined && originalEvent.clientX !== undefined) {\n        var eventDoc = event.target.ownerDocument || document;\n        var doc = eventDoc.documentElement;\n        var body = eventDoc.body;\n        event.pageX = originalEvent.clientX + (doc && doc.scrollLeft || body && body.scrollLeft || 0) - (doc && doc.clientLeft || body && body.clientLeft || 0);\n        event.pageY = originalEvent.clientY + (doc && doc.scrollTop || body && body.scrollTop || 0) - (doc && doc.clientTop || body && body.clientTop || 0);\n      }\n      event.preventDefault = function () {\n        event.isDefaultPrevented = returnTrue;\n        if (originalEvent) {\n          if (originalEvent.preventDefault) {\n            originalEvent.preventDefault();\n          } else {\n            originalEvent.returnValue = false;\n          }\n        }\n      };\n      event.stopPropagation = function () {\n        event.isPropagationStopped = returnTrue;\n        if (originalEvent) {\n          if (originalEvent.stopPropagation) {\n            originalEvent.stopPropagation();\n          } else {\n            originalEvent.cancelBubble = true;\n          }\n        }\n      };\n      event.stopImmediatePropagation = function () {\n        event.isImmediatePropagationStopped = returnTrue;\n        event.stopPropagation();\n      };\n      if (hasIsDefaultPrevented(event) === false) {\n        event.isDefaultPrevented = returnFalse;\n        event.isPropagationStopped = returnFalse;\n        event.isImmediatePropagationStopped = returnFalse;\n      }\n      if (typeof event.metaKey === 'undefined') {\n        event.metaKey = false;\n      }\n      return event;\n    };\n    var bindOnReady = function (win, callback, eventUtils) {\n      var doc = win.document, event = { type: 'ready' };\n      if (eventUtils.domLoaded) {\n        callback(event);\n        return;\n      }\n      var isDocReady = function () {\n        return doc.readyState === 'complete' || doc.readyState === 'interactive' && doc.body;\n      };\n      var readyHandler = function () {\n        removeEvent(win, 'DOMContentLoaded', readyHandler);\n        removeEvent(win, 'load', readyHandler);\n        if (!eventUtils.domLoaded) {\n          eventUtils.domLoaded = true;\n          callback(event);\n        }\n      };\n      if (isDocReady()) {\n        readyHandler();\n      } else {\n        addEvent(win, 'DOMContentLoaded', readyHandler);\n      }\n      addEvent(win, 'load', readyHandler);\n    };\n    var EventUtils = function () {\n      function EventUtils() {\n        this.domLoaded = false;\n        this.events = {};\n        this.count = 1;\n        this.expando = eventExpandoPrefix + (+new Date()).toString(32);\n        this.hasMouseEnterLeave = 'onmouseenter' in document.documentElement;\n        this.hasFocusIn = 'onfocusin' in document.documentElement;\n        this.count = 1;\n      }\n      EventUtils.prototype.bind = function (target, names, callback, scope) {\n        var self = this;\n        var id, callbackList, i, name, fakeName, nativeHandler, capture;\n        var win = window;\n        var defaultNativeHandler = function (evt) {\n          self.executeHandlers(fix(evt || win.event), id);\n        };\n        if (!target || target.nodeType === 3 || target.nodeType === 8) {\n          return;\n        }\n        if (!target[self.expando]) {\n          id = self.count++;\n          target[self.expando] = id;\n          self.events[id] = {};\n        } else {\n          id = target[self.expando];\n        }\n        scope = scope || target;\n        var namesList = names.split(' ');\n        i = namesList.length;\n        while (i--) {\n          name = namesList[i];\n          nativeHandler = defaultNativeHandler;\n          fakeName = capture = false;\n          if (name === 'DOMContentLoaded') {\n            name = 'ready';\n          }\n          if (self.domLoaded && name === 'ready' && target.readyState === 'complete') {\n            callback.call(scope, fix({ type: name }));\n            continue;\n          }\n          if (!self.hasMouseEnterLeave) {\n            fakeName = self.mouseEnterLeave[name];\n            if (fakeName) {\n              nativeHandler = function (evt) {\n                var current = evt.currentTarget;\n                var related = evt.relatedTarget;\n                if (related && current.contains) {\n                  related = current.contains(related);\n                } else {\n                  while (related && related !== current) {\n                    related = related.parentNode;\n                  }\n                }\n                if (!related) {\n                  evt = fix(evt || win.event);\n                  evt.type = evt.type === 'mouseout' ? 'mouseleave' : 'mouseenter';\n                  evt.target = current;\n                  self.executeHandlers(evt, id);\n                }\n              };\n            }\n          }\n          if (!self.hasFocusIn && (name === 'focusin' || name === 'focusout')) {\n            capture = true;\n            fakeName = name === 'focusin' ? 'focus' : 'blur';\n            nativeHandler = function (evt) {\n              evt = fix(evt || win.event);\n              evt.type = evt.type === 'focus' ? 'focusin' : 'focusout';\n              self.executeHandlers(evt, id);\n            };\n          }\n          callbackList = self.events[id][name];\n          if (!callbackList) {\n            self.events[id][name] = callbackList = [{\n                func: callback,\n                scope: scope\n              }];\n            callbackList.fakeName = fakeName;\n            callbackList.capture = capture;\n            callbackList.nativeHandler = nativeHandler;\n            if (name === 'ready') {\n              bindOnReady(target, nativeHandler, self);\n            } else {\n              addEvent(target, fakeName || name, nativeHandler, capture);\n            }\n          } else {\n            if (name === 'ready' && self.domLoaded) {\n              callback(fix({ type: name }));\n            } else {\n              callbackList.push({\n                func: callback,\n                scope: scope\n              });\n            }\n          }\n        }\n        target = callbackList = null;\n        return callback;\n      };\n      EventUtils.prototype.unbind = function (target, names, callback) {\n        var callbackList, i, ci, name, eventMap;\n        if (!target || target.nodeType === 3 || target.nodeType === 8) {\n          return this;\n        }\n        var id = target[this.expando];\n        if (id) {\n          eventMap = this.events[id];\n          if (names) {\n            var namesList = names.split(' ');\n            i = namesList.length;\n            while (i--) {\n              name = namesList[i];\n              callbackList = eventMap[name];\n              if (callbackList) {\n                if (callback) {\n                  ci = callbackList.length;\n                  while (ci--) {\n                    if (callbackList[ci].func === callback) {\n                      var nativeHandler = callbackList.nativeHandler;\n                      var fakeName = callbackList.fakeName, capture = callbackList.capture;\n                      callbackList = callbackList.slice(0, ci).concat(callbackList.slice(ci + 1));\n                      callbackList.nativeHandler = nativeHandler;\n                      callbackList.fakeName = fakeName;\n                      callbackList.capture = capture;\n                      eventMap[name] = callbackList;\n                    }\n                  }\n                }\n                if (!callback || callbackList.length === 0) {\n                  delete eventMap[name];\n                  removeEvent(target, callbackList.fakeName || name, callbackList.nativeHandler, callbackList.capture);\n                }\n              }\n            }\n          } else {\n            each$1(eventMap, function (callbackList, name) {\n              removeEvent(target, callbackList.fakeName || name, callbackList.nativeHandler, callbackList.capture);\n            });\n            eventMap = {};\n          }\n          for (name in eventMap) {\n            if (has(eventMap, name)) {\n              return this;\n            }\n          }\n          delete this.events[id];\n          try {\n            delete target[this.expando];\n          } catch (ex) {\n            target[this.expando] = null;\n          }\n        }\n        return this;\n      };\n      EventUtils.prototype.fire = function (target, name, args) {\n        var id;\n        if (!target || target.nodeType === 3 || target.nodeType === 8) {\n          return this;\n        }\n        var event = fix(null, args);\n        event.type = name;\n        event.target = target;\n        do {\n          id = target[this.expando];\n          if (id) {\n            this.executeHandlers(event, id);\n          }\n          target = target.parentNode || target.ownerDocument || target.defaultView || target.parentWindow;\n        } while (target && !event.isPropagationStopped());\n        return this;\n      };\n      EventUtils.prototype.clean = function (target) {\n        var i, children;\n        if (!target || target.nodeType === 3 || target.nodeType === 8) {\n          return this;\n        }\n        if (target[this.expando]) {\n          this.unbind(target);\n        }\n        if (!target.getElementsByTagName) {\n          target = target.document;\n        }\n        if (target && target.getElementsByTagName) {\n          this.unbind(target);\n          children = target.getElementsByTagName('*');\n          i = children.length;\n          while (i--) {\n            target = children[i];\n            if (target[this.expando]) {\n              this.unbind(target);\n            }\n          }\n        }\n        return this;\n      };\n      EventUtils.prototype.destroy = function () {\n        this.events = {};\n      };\n      EventUtils.prototype.cancel = function (e) {\n        if (e) {\n          e.preventDefault();\n          e.stopImmediatePropagation();\n        }\n        return false;\n      };\n      EventUtils.prototype.executeHandlers = function (evt, id) {\n        var container = this.events[id];\n        var callbackList = container && container[evt.type];\n        if (callbackList) {\n          for (var i = 0, l = callbackList.length; i < l; i++) {\n            var callback = callbackList[i];\n            if (callback && callback.func.call(callback.scope, evt) === false) {\n              evt.preventDefault();\n            }\n            if (evt.isImmediatePropagationStopped()) {\n              return;\n            }\n          }\n        }\n      };\n      EventUtils.Event = new EventUtils();\n      return EventUtils;\n    }();\n\n    var support, Expr, getText, isXML, tokenize, compile, select, outermostContext, sortInput, hasDuplicate, setDocument, document$1, docElem, documentIsHTML, rbuggyQSA, rbuggyMatches, matches, contains$3, expando = 'sizzle' + -new Date(), preferredDoc = window.document, dirruns = 0, done = 0, classCache = createCache(), tokenCache = createCache(), compilerCache = createCache(), sortOrder = function (a, b) {\n        if (a === b) {\n          hasDuplicate = true;\n        }\n        return 0;\n      }, strundefined = typeof undefined, MAX_NEGATIVE = 1 << 31, hasOwn = {}.hasOwnProperty, arr = [], pop = arr.pop, push_native = arr.push, push = arr.push, slice = arr.slice, indexOf$2 = arr.indexOf || function (elem) {\n        var i = 0, len = this.length;\n        for (; i < len; i++) {\n          if (this[i] === elem) {\n            return i;\n          }\n        }\n        return -1;\n      }, booleans = 'checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped', whitespace = '[\\\\x20\\\\t\\\\r\\\\n\\\\f]', identifier = '(?:\\\\\\\\.|[\\\\w-]|[^\\\\x00-\\\\xa0])+', attributes = '\\\\[' + whitespace + '*(' + identifier + ')(?:' + whitespace + '*([*^$|!~]?=)' + whitespace + '*(?:\\'((?:\\\\\\\\.|[^\\\\\\\\\\'])*)\\'|\"((?:\\\\\\\\.|[^\\\\\\\\\"])*)\"|(' + identifier + '))|)' + whitespace + '*\\\\]', pseudos = ':(' + identifier + ')(?:\\\\((' + '(\\'((?:\\\\\\\\.|[^\\\\\\\\\\'])*)\\'|\"((?:\\\\\\\\.|[^\\\\\\\\\"])*)\")|' + '((?:\\\\\\\\.|[^\\\\\\\\()[\\\\]]|' + attributes + ')*)|' + '.*' + ')\\\\)|)', rtrim = new RegExp('^' + whitespace + '+|((?:^|[^\\\\\\\\])(?:\\\\\\\\.)*)' + whitespace + '+$', 'g'), rcomma = new RegExp('^' + whitespace + '*,' + whitespace + '*'), rcombinators = new RegExp('^' + whitespace + '*([>+~]|' + whitespace + ')' + whitespace + '*'), rattributeQuotes = new RegExp('=' + whitespace + '*([^\\\\]\\'\"]*?)' + whitespace + '*\\\\]', 'g'), rpseudo = new RegExp(pseudos), ridentifier = new RegExp('^' + identifier + '$'), matchExpr = {\n        ID: new RegExp('^#(' + identifier + ')'),\n        CLASS: new RegExp('^\\\\.(' + identifier + ')'),\n        TAG: new RegExp('^(' + identifier + '|[*])'),\n        ATTR: new RegExp('^' + attributes),\n        PSEUDO: new RegExp('^' + pseudos),\n        CHILD: new RegExp('^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\\\(' + whitespace + '*(even|odd|(([+-]|)(\\\\d*)n|)' + whitespace + '*(?:([+-]|)' + whitespace + '*(\\\\d+)|))' + whitespace + '*\\\\)|)', 'i'),\n        bool: new RegExp('^(?:' + booleans + ')$', 'i'),\n        needsContext: new RegExp('^' + whitespace + '*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\\\(' + whitespace + '*((?:-\\\\d)?\\\\d*)' + whitespace + '*\\\\)|)(?=[^-]|$)', 'i')\n      }, rinputs = /^(?:input|select|textarea|button)$/i, rheader = /^h\\d$/i, rnative = /^[^{]+\\{\\s*\\[native \\w/, rquickExpr = /^(?:#([\\w-]+)|(\\w+)|\\.([\\w-]+))$/, rsibling = /[+~]/, rescape = /'|\\\\/g, runescape = new RegExp('\\\\\\\\([\\\\da-f]{1,6}' + whitespace + '?|(' + whitespace + ')|.)', 'ig'), funescape = function (_, escaped, escapedWhitespace) {\n        var high = '0x' + escaped - 65536;\n        return high !== high || escapedWhitespace ? escaped : high < 0 ? String.fromCharCode(high + 65536) : String.fromCharCode(high >> 10 | 55296, high & 1023 | 56320);\n      };\n    try {\n      push.apply(arr = slice.call(preferredDoc.childNodes), preferredDoc.childNodes);\n      arr[preferredDoc.childNodes.length].nodeType;\n    } catch (e) {\n      push = {\n        apply: arr.length ? function (target, els) {\n          push_native.apply(target, slice.call(els));\n        } : function (target, els) {\n          var j = target.length, i = 0;\n          while (target[j++] = els[i++]) {\n          }\n          target.length = j - 1;\n        }\n      };\n    }\n    var Sizzle = function (selector, context, results, seed) {\n      var match, elem, m, nodeType, i, groups, old, nid, newContext, newSelector;\n      if ((context ? context.ownerDocument || context : preferredDoc) !== document$1) {\n        setDocument(context);\n      }\n      context = context || document$1;\n      results = results || [];\n      if (!selector || typeof selector !== 'string') {\n        return results;\n      }\n      if ((nodeType = context.nodeType) !== 1 && nodeType !== 9) {\n        return [];\n      }\n      if (documentIsHTML && !seed) {\n        if (match = rquickExpr.exec(selector)) {\n          if (m = match[1]) {\n            if (nodeType === 9) {\n              elem = context.getElementById(m);\n              if (elem && elem.parentNode) {\n                if (elem.id === m) {\n                  results.push(elem);\n                  return results;\n                }\n              } else {\n                return results;\n              }\n            } else {\n              if (context.ownerDocument && (elem = context.ownerDocument.getElementById(m)) && contains$3(context, elem) && elem.id === m) {\n                results.push(elem);\n                return results;\n              }\n            }\n          } else if (match[2]) {\n            push.apply(results, context.getElementsByTagName(selector));\n            return results;\n          } else if ((m = match[3]) && support.getElementsByClassName) {\n            push.apply(results, context.getElementsByClassName(m));\n            return results;\n          }\n        }\n        if (support.qsa && (!rbuggyQSA || !rbuggyQSA.test(selector))) {\n          nid = old = expando;\n          newContext = context;\n          newSelector = nodeType === 9 && selector;\n          if (nodeType === 1 && context.nodeName.toLowerCase() !== 'object') {\n            groups = tokenize(selector);\n            if (old = context.getAttribute('id')) {\n              nid = old.replace(rescape, '\\\\$&');\n            } else {\n              context.setAttribute('id', nid);\n            }\n            nid = '[id=\\'' + nid + '\\'] ';\n            i = groups.length;\n            while (i--) {\n              groups[i] = nid + toSelector(groups[i]);\n            }\n            newContext = rsibling.test(selector) && testContext(context.parentNode) || context;\n            newSelector = groups.join(',');\n          }\n          if (newSelector) {\n            try {\n              push.apply(results, newContext.querySelectorAll(newSelector));\n              return results;\n            } catch (qsaError) {\n            } finally {\n              if (!old) {\n                context.removeAttribute('id');\n              }\n            }\n          }\n        }\n      }\n      return select(selector.replace(rtrim, '$1'), context, results, seed);\n    };\n    function createCache() {\n      var keys = [];\n      function cache(key, value) {\n        if (keys.push(key + ' ') > Expr.cacheLength) {\n          delete cache[keys.shift()];\n        }\n        return cache[key + ' '] = value;\n      }\n      return cache;\n    }\n    function markFunction(fn) {\n      fn[expando] = true;\n      return fn;\n    }\n    function siblingCheck(a, b) {\n      var cur = b && a, diff = cur && a.nodeType === 1 && b.nodeType === 1 && (~b.sourceIndex || MAX_NEGATIVE) - (~a.sourceIndex || MAX_NEGATIVE);\n      if (diff) {\n        return diff;\n      }\n      if (cur) {\n        while (cur = cur.nextSibling) {\n          if (cur === b) {\n            return -1;\n          }\n        }\n      }\n      return a ? 1 : -1;\n    }\n    function createInputPseudo(type) {\n      return function (elem) {\n        var name = elem.nodeName.toLowerCase();\n        return name === 'input' && elem.type === type;\n      };\n    }\n    function createButtonPseudo(type) {\n      return function (elem) {\n        var name = elem.nodeName.toLowerCase();\n        return (name === 'input' || name === 'button') && elem.type === type;\n      };\n    }\n    function createPositionalPseudo(fn) {\n      return markFunction(function (argument) {\n        argument = +argument;\n        return markFunction(function (seed, matches) {\n          var j, matchIndexes = fn([], seed.length, argument), i = matchIndexes.length;\n          while (i--) {\n            if (seed[j = matchIndexes[i]]) {\n              seed[j] = !(matches[j] = seed[j]);\n            }\n          }\n        });\n      });\n    }\n    function testContext(context) {\n      return context && typeof context.getElementsByTagName !== strundefined && context;\n    }\n    support = Sizzle.support = {};\n    isXML = Sizzle.isXML = function (elem) {\n      var documentElement = elem && (elem.ownerDocument || elem).documentElement;\n      return documentElement ? documentElement.nodeName !== 'HTML' : false;\n    };\n    setDocument = Sizzle.setDocument = function (node) {\n      var hasCompare, doc = node ? node.ownerDocument || node : preferredDoc, parent = doc.defaultView;\n      function getTop(win) {\n        try {\n          return win.top;\n        } catch (ex) {\n        }\n        return null;\n      }\n      if (doc === document$1 || doc.nodeType !== 9 || !doc.documentElement) {\n        return document$1;\n      }\n      document$1 = doc;\n      docElem = doc.documentElement;\n      documentIsHTML = !isXML(doc);\n      if (parent && parent !== getTop(parent)) {\n        if (parent.addEventListener) {\n          parent.addEventListener('unload', function () {\n            setDocument();\n          }, false);\n        } else if (parent.attachEvent) {\n          parent.attachEvent('onunload', function () {\n            setDocument();\n          });\n        }\n      }\n      support.attributes = true;\n      support.getElementsByTagName = true;\n      support.getElementsByClassName = rnative.test(doc.getElementsByClassName);\n      support.getById = true;\n      Expr.find.ID = function (id, context) {\n        if (typeof context.getElementById !== strundefined && documentIsHTML) {\n          var m = context.getElementById(id);\n          return m && m.parentNode ? [m] : [];\n        }\n      };\n      Expr.filter.ID = function (id) {\n        var attrId = id.replace(runescape, funescape);\n        return function (elem) {\n          return elem.getAttribute('id') === attrId;\n        };\n      };\n      Expr.find.TAG = support.getElementsByTagName ? function (tag, context) {\n        if (typeof context.getElementsByTagName !== strundefined) {\n          return context.getElementsByTagName(tag);\n        }\n      } : function (tag, context) {\n        var elem, tmp = [], i = 0, results = context.getElementsByTagName(tag);\n        if (tag === '*') {\n          while (elem = results[i++]) {\n            if (elem.nodeType === 1) {\n              tmp.push(elem);\n            }\n          }\n          return tmp;\n        }\n        return results;\n      };\n      Expr.find.CLASS = support.getElementsByClassName && function (className, context) {\n        if (documentIsHTML) {\n          return context.getElementsByClassName(className);\n        }\n      };\n      rbuggyMatches = [];\n      rbuggyQSA = [];\n      support.disconnectedMatch = true;\n      rbuggyQSA = rbuggyQSA.length && new RegExp(rbuggyQSA.join('|'));\n      rbuggyMatches = rbuggyMatches.length && new RegExp(rbuggyMatches.join('|'));\n      hasCompare = rnative.test(docElem.compareDocumentPosition);\n      contains$3 = hasCompare || rnative.test(docElem.contains) ? function (a, b) {\n        var adown = a.nodeType === 9 ? a.documentElement : a, bup = b && b.parentNode;\n        return a === bup || !!(bup && bup.nodeType === 1 && (adown.contains ? adown.contains(bup) : a.compareDocumentPosition && a.compareDocumentPosition(bup) & 16));\n      } : function (a, b) {\n        if (b) {\n          while (b = b.parentNode) {\n            if (b === a) {\n              return true;\n            }\n          }\n        }\n        return false;\n      };\n      sortOrder = hasCompare ? function (a, b) {\n        if (a === b) {\n          hasDuplicate = true;\n          return 0;\n        }\n        var compare = !a.compareDocumentPosition - !b.compareDocumentPosition;\n        if (compare) {\n          return compare;\n        }\n        compare = (a.ownerDocument || a) === (b.ownerDocument || b) ? a.compareDocumentPosition(b) : 1;\n        if (compare & 1 || !support.sortDetached && b.compareDocumentPosition(a) === compare) {\n          if (a === doc || a.ownerDocument === preferredDoc && contains$3(preferredDoc, a)) {\n            return -1;\n          }\n          if (b === doc || b.ownerDocument === preferredDoc && contains$3(preferredDoc, b)) {\n            return 1;\n          }\n          return sortInput ? indexOf$2.call(sortInput, a) - indexOf$2.call(sortInput, b) : 0;\n        }\n        return compare & 4 ? -1 : 1;\n      } : function (a, b) {\n        if (a === b) {\n          hasDuplicate = true;\n          return 0;\n        }\n        var cur, i = 0, aup = a.parentNode, bup = b.parentNode, ap = [a], bp = [b];\n        if (!aup || !bup) {\n          return a === doc ? -1 : b === doc ? 1 : aup ? -1 : bup ? 1 : sortInput ? indexOf$2.call(sortInput, a) - indexOf$2.call(sortInput, b) : 0;\n        } else if (aup === bup) {\n          return siblingCheck(a, b);\n        }\n        cur = a;\n        while (cur = cur.parentNode) {\n          ap.unshift(cur);\n        }\n        cur = b;\n        while (cur = cur.parentNode) {\n          bp.unshift(cur);\n        }\n        while (ap[i] === bp[i]) {\n          i++;\n        }\n        return i ? siblingCheck(ap[i], bp[i]) : ap[i] === preferredDoc ? -1 : bp[i] === preferredDoc ? 1 : 0;\n      };\n      return doc;\n    };\n    Sizzle.matches = function (expr, elements) {\n      return Sizzle(expr, null, null, elements);\n    };\n    Sizzle.matchesSelector = function (elem, expr) {\n      if ((elem.ownerDocument || elem) !== document$1) {\n        setDocument(elem);\n      }\n      expr = expr.replace(rattributeQuotes, '=\\'$1\\']');\n      if (support.matchesSelector && documentIsHTML && (!rbuggyMatches || !rbuggyMatches.test(expr)) && (!rbuggyQSA || !rbuggyQSA.test(expr))) {\n        try {\n          var ret = matches.call(elem, expr);\n          if (ret || support.disconnectedMatch || elem.document && elem.document.nodeType !== 11) {\n            return ret;\n          }\n        } catch (e) {\n        }\n      }\n      return Sizzle(expr, document$1, null, [elem]).length > 0;\n    };\n    Sizzle.contains = function (context, elem) {\n      if ((context.ownerDocument || context) !== document$1) {\n        setDocument(context);\n      }\n      return contains$3(context, elem);\n    };\n    Sizzle.attr = function (elem, name) {\n      if ((elem.ownerDocument || elem) !== document$1) {\n        setDocument(elem);\n      }\n      var fn = Expr.attrHandle[name.toLowerCase()], val = fn && hasOwn.call(Expr.attrHandle, name.toLowerCase()) ? fn(elem, name, !documentIsHTML) : undefined;\n      return val !== undefined ? val : support.attributes || !documentIsHTML ? elem.getAttribute(name) : (val = elem.getAttributeNode(name)) && val.specified ? val.value : null;\n    };\n    Sizzle.error = function (msg) {\n      throw new Error('Syntax error, unrecognized expression: ' + msg);\n    };\n    Sizzle.uniqueSort = function (results) {\n      var elem, duplicates = [], j = 0, i = 0;\n      hasDuplicate = !support.detectDuplicates;\n      sortInput = !support.sortStable && results.slice(0);\n      results.sort(sortOrder);\n      if (hasDuplicate) {\n        while (elem = results[i++]) {\n          if (elem === results[i]) {\n            j = duplicates.push(i);\n          }\n        }\n        while (j--) {\n          results.splice(duplicates[j], 1);\n        }\n      }\n      sortInput = null;\n      return results;\n    };\n    getText = Sizzle.getText = function (elem) {\n      var node, ret = '', i = 0, nodeType = elem.nodeType;\n      if (!nodeType) {\n        while (node = elem[i++]) {\n          ret += getText(node);\n        }\n      } else if (nodeType === 1 || nodeType === 9 || nodeType === 11) {\n        if (typeof elem.textContent === 'string') {\n          return elem.textContent;\n        } else {\n          for (elem = elem.firstChild; elem; elem = elem.nextSibling) {\n            ret += getText(elem);\n          }\n        }\n      } else if (nodeType === 3 || nodeType === 4) {\n        return elem.nodeValue;\n      }\n      return ret;\n    };\n    Expr = Sizzle.selectors = {\n      cacheLength: 50,\n      createPseudo: markFunction,\n      match: matchExpr,\n      attrHandle: {},\n      find: {},\n      relative: {\n        '>': {\n          dir: 'parentNode',\n          first: true\n        },\n        ' ': { dir: 'parentNode' },\n        '+': {\n          dir: 'previousSibling',\n          first: true\n        },\n        '~': { dir: 'previousSibling' }\n      },\n      preFilter: {\n        ATTR: function (match) {\n          match[1] = match[1].replace(runescape, funescape);\n          match[3] = (match[3] || match[4] || match[5] || '').replace(runescape, funescape);\n          if (match[2] === '~=') {\n            match[3] = ' ' + match[3] + ' ';\n          }\n          return match.slice(0, 4);\n        },\n        CHILD: function (match) {\n          match[1] = match[1].toLowerCase();\n          if (match[1].slice(0, 3) === 'nth') {\n            if (!match[3]) {\n              Sizzle.error(match[0]);\n            }\n            match[4] = +(match[4] ? match[5] + (match[6] || 1) : 2 * (match[3] === 'even' || match[3] === 'odd'));\n            match[5] = +(match[7] + match[8] || match[3] === 'odd');\n          } else if (match[3]) {\n            Sizzle.error(match[0]);\n          }\n          return match;\n        },\n        PSEUDO: function (match) {\n          var excess, unquoted = !match[6] && match[2];\n          if (matchExpr.CHILD.test(match[0])) {\n            return null;\n          }\n          if (match[3]) {\n            match[2] = match[4] || match[5] || '';\n          } else if (unquoted && rpseudo.test(unquoted) && (excess = tokenize(unquoted, true)) && (excess = unquoted.indexOf(')', unquoted.length - excess) - unquoted.length)) {\n            match[0] = match[0].slice(0, excess);\n            match[2] = unquoted.slice(0, excess);\n          }\n          return match.slice(0, 3);\n        }\n      },\n      filter: {\n        TAG: function (nodeNameSelector) {\n          var nodeName = nodeNameSelector.replace(runescape, funescape).toLowerCase();\n          return nodeNameSelector === '*' ? function () {\n            return true;\n          } : function (elem) {\n            return elem.nodeName && elem.nodeName.toLowerCase() === nodeName;\n          };\n        },\n        CLASS: function (className) {\n          var pattern = classCache[className + ' '];\n          return pattern || (pattern = new RegExp('(^|' + whitespace + ')' + className + '(' + whitespace + '|$)')) && classCache(className, function (elem) {\n            return pattern.test(typeof elem.className === 'string' && elem.className || typeof elem.getAttribute !== strundefined && elem.getAttribute('class') || '');\n          });\n        },\n        ATTR: function (name, operator, check) {\n          return function (elem) {\n            var result = Sizzle.attr(elem, name);\n            if (result == null) {\n              return operator === '!=';\n            }\n            if (!operator) {\n              return true;\n            }\n            result += '';\n            return operator === '=' ? result === check : operator === '!=' ? result !== check : operator === '^=' ? check && result.indexOf(check) === 0 : operator === '*=' ? check && result.indexOf(check) > -1 : operator === '$=' ? check && result.slice(-check.length) === check : operator === '~=' ? (' ' + result + ' ').indexOf(check) > -1 : operator === '|=' ? result === check || result.slice(0, check.length + 1) === check + '-' : false;\n          };\n        },\n        CHILD: function (type, what, argument, first, last) {\n          var simple = type.slice(0, 3) !== 'nth', forward = type.slice(-4) !== 'last', ofType = what === 'of-type';\n          return first === 1 && last === 0 ? function (elem) {\n            return !!elem.parentNode;\n          } : function (elem, context, xml) {\n            var cache, outerCache, node, diff, nodeIndex, start, dir = simple !== forward ? 'nextSibling' : 'previousSibling', parent = elem.parentNode, name = ofType && elem.nodeName.toLowerCase(), useCache = !xml && !ofType;\n            if (parent) {\n              if (simple) {\n                while (dir) {\n                  node = elem;\n                  while (node = node[dir]) {\n                    if (ofType ? node.nodeName.toLowerCase() === name : node.nodeType === 1) {\n                      return false;\n                    }\n                  }\n                  start = dir = type === 'only' && !start && 'nextSibling';\n                }\n                return true;\n              }\n              start = [forward ? parent.firstChild : parent.lastChild];\n              if (forward && useCache) {\n                outerCache = parent[expando] || (parent[expando] = {});\n                cache = outerCache[type] || [];\n                nodeIndex = cache[0] === dirruns && cache[1];\n                diff = cache[0] === dirruns && cache[2];\n                node = nodeIndex && parent.childNodes[nodeIndex];\n                while (node = ++nodeIndex && node && node[dir] || (diff = nodeIndex = 0) || start.pop()) {\n                  if (node.nodeType === 1 && ++diff && node === elem) {\n                    outerCache[type] = [\n                      dirruns,\n                      nodeIndex,\n                      diff\n                    ];\n                    break;\n                  }\n                }\n              } else if (useCache && (cache = (elem[expando] || (elem[expando] = {}))[type]) && cache[0] === dirruns) {\n                diff = cache[1];\n              } else {\n                while (node = ++nodeIndex && node && node[dir] || (diff = nodeIndex = 0) || start.pop()) {\n                  if ((ofType ? node.nodeName.toLowerCase() === name : node.nodeType === 1) && ++diff) {\n                    if (useCache) {\n                      (node[expando] || (node[expando] = {}))[type] = [\n                        dirruns,\n                        diff\n                      ];\n                    }\n                    if (node === elem) {\n                      break;\n                    }\n                  }\n                }\n              }\n              diff -= last;\n              return diff === first || diff % first === 0 && diff / first >= 0;\n            }\n          };\n        },\n        PSEUDO: function (pseudo, argument) {\n          var args, fn = Expr.pseudos[pseudo] || Expr.setFilters[pseudo.toLowerCase()] || Sizzle.error('unsupported pseudo: ' + pseudo);\n          if (fn[expando]) {\n            return fn(argument);\n          }\n          if (fn.length > 1) {\n            args = [\n              pseudo,\n              pseudo,\n              '',\n              argument\n            ];\n            return Expr.setFilters.hasOwnProperty(pseudo.toLowerCase()) ? markFunction(function (seed, matches) {\n              var idx, matched = fn(seed, argument), i = matched.length;\n              while (i--) {\n                idx = indexOf$2.call(seed, matched[i]);\n                seed[idx] = !(matches[idx] = matched[i]);\n              }\n            }) : function (elem) {\n              return fn(elem, 0, args);\n            };\n          }\n          return fn;\n        }\n      },\n      pseudos: {\n        not: markFunction(function (selector) {\n          var input = [], results = [], matcher = compile(selector.replace(rtrim, '$1'));\n          return matcher[expando] ? markFunction(function (seed, matches, context, xml) {\n            var elem, unmatched = matcher(seed, null, xml, []), i = seed.length;\n            while (i--) {\n              if (elem = unmatched[i]) {\n                seed[i] = !(matches[i] = elem);\n              }\n            }\n          }) : function (elem, context, xml) {\n            input[0] = elem;\n            matcher(input, null, xml, results);\n            return !results.pop();\n          };\n        }),\n        has: markFunction(function (selector) {\n          return function (elem) {\n            return Sizzle(selector, elem).length > 0;\n          };\n        }),\n        contains: markFunction(function (text) {\n          text = text.replace(runescape, funescape);\n          return function (elem) {\n            return (elem.textContent || elem.innerText || getText(elem)).indexOf(text) > -1;\n          };\n        }),\n        lang: markFunction(function (lang) {\n          if (!ridentifier.test(lang || '')) {\n            Sizzle.error('unsupported lang: ' + lang);\n          }\n          lang = lang.replace(runescape, funescape).toLowerCase();\n          return function (elem) {\n            var elemLang;\n            do {\n              if (elemLang = documentIsHTML ? elem.lang : elem.getAttribute('xml:lang') || elem.getAttribute('lang')) {\n                elemLang = elemLang.toLowerCase();\n                return elemLang === lang || elemLang.indexOf(lang + '-') === 0;\n              }\n            } while ((elem = elem.parentNode) && elem.nodeType === 1);\n            return false;\n          };\n        }),\n        target: function (elem) {\n          var hash = window.location && window.location.hash;\n          return hash && hash.slice(1) === elem.id;\n        },\n        root: function (elem) {\n          return elem === docElem;\n        },\n        focus: function (elem) {\n          return elem === document$1.activeElement && (!document$1.hasFocus || document$1.hasFocus()) && !!(elem.type || elem.href || ~elem.tabIndex);\n        },\n        enabled: function (elem) {\n          return elem.disabled === false;\n        },\n        disabled: function (elem) {\n          return elem.disabled === true;\n        },\n        checked: function (elem) {\n          var nodeName = elem.nodeName.toLowerCase();\n          return nodeName === 'input' && !!elem.checked || nodeName === 'option' && !!elem.selected;\n        },\n        selected: function (elem) {\n          if (elem.parentNode) {\n            elem.parentNode.selectedIndex;\n          }\n          return elem.selected === true;\n        },\n        empty: function (elem) {\n          for (elem = elem.firstChild; elem; elem = elem.nextSibling) {\n            if (elem.nodeType < 6) {\n              return false;\n            }\n          }\n          return true;\n        },\n        parent: function (elem) {\n          return !Expr.pseudos.empty(elem);\n        },\n        header: function (elem) {\n          return rheader.test(elem.nodeName);\n        },\n        input: function (elem) {\n          return rinputs.test(elem.nodeName);\n        },\n        button: function (elem) {\n          var name = elem.nodeName.toLowerCase();\n          return name === 'input' && elem.type === 'button' || name === 'button';\n        },\n        text: function (elem) {\n          var attr;\n          return elem.nodeName.toLowerCase() === 'input' && elem.type === 'text' && ((attr = elem.getAttribute('type')) == null || attr.toLowerCase() === 'text');\n        },\n        first: createPositionalPseudo(function () {\n          return [0];\n        }),\n        last: createPositionalPseudo(function (matchIndexes, length) {\n          return [length - 1];\n        }),\n        eq: createPositionalPseudo(function (matchIndexes, length, argument) {\n          return [argument < 0 ? argument + length : argument];\n        }),\n        even: createPositionalPseudo(function (matchIndexes, length) {\n          var i = 0;\n          for (; i < length; i += 2) {\n            matchIndexes.push(i);\n          }\n          return matchIndexes;\n        }),\n        odd: createPositionalPseudo(function (matchIndexes, length) {\n          var i = 1;\n          for (; i < length; i += 2) {\n            matchIndexes.push(i);\n          }\n          return matchIndexes;\n        }),\n        lt: createPositionalPseudo(function (matchIndexes, length, argument) {\n          var i = argument < 0 ? argument + length : argument;\n          for (; --i >= 0;) {\n            matchIndexes.push(i);\n          }\n          return matchIndexes;\n        }),\n        gt: createPositionalPseudo(function (matchIndexes, length, argument) {\n          var i = argument < 0 ? argument + length : argument;\n          for (; ++i < length;) {\n            matchIndexes.push(i);\n          }\n          return matchIndexes;\n        })\n      }\n    };\n    Expr.pseudos.nth = Expr.pseudos.eq;\n    each([\n      'radio',\n      'checkbox',\n      'file',\n      'password',\n      'image'\n    ], function (i) {\n      Expr.pseudos[i] = createInputPseudo(i);\n    });\n    each([\n      'submit',\n      'reset'\n    ], function (i) {\n      Expr.pseudos[i] = createButtonPseudo(i);\n    });\n    function setFilters() {\n    }\n    setFilters.prototype = Expr.filters = Expr.pseudos;\n    Expr.setFilters = new setFilters();\n    tokenize = Sizzle.tokenize = function (selector, parseOnly) {\n      var matched, match, tokens, type, soFar, groups, preFilters, cached = tokenCache[selector + ' '];\n      if (cached) {\n        return parseOnly ? 0 : cached.slice(0);\n      }\n      soFar = selector;\n      groups = [];\n      preFilters = Expr.preFilter;\n      while (soFar) {\n        if (!matched || (match = rcomma.exec(soFar))) {\n          if (match) {\n            soFar = soFar.slice(match[0].length) || soFar;\n          }\n          groups.push(tokens = []);\n        }\n        matched = false;\n        if (match = rcombinators.exec(soFar)) {\n          matched = match.shift();\n          tokens.push({\n            value: matched,\n            type: match[0].replace(rtrim, ' ')\n          });\n          soFar = soFar.slice(matched.length);\n        }\n        for (type in Expr.filter) {\n          if (!Expr.filter.hasOwnProperty(type)) {\n            continue;\n          }\n          if ((match = matchExpr[type].exec(soFar)) && (!preFilters[type] || (match = preFilters[type](match)))) {\n            matched = match.shift();\n            tokens.push({\n              value: matched,\n              type: type,\n              matches: match\n            });\n            soFar = soFar.slice(matched.length);\n          }\n        }\n        if (!matched) {\n          break;\n        }\n      }\n      return parseOnly ? soFar.length : soFar ? Sizzle.error(selector) : tokenCache(selector, groups).slice(0);\n    };\n    function toSelector(tokens) {\n      var i = 0, len = tokens.length, selector = '';\n      for (; i < len; i++) {\n        selector += tokens[i].value;\n      }\n      return selector;\n    }\n    function addCombinator(matcher, combinator, base) {\n      var dir = combinator.dir, checkNonElements = base && dir === 'parentNode', doneName = done++;\n      return combinator.first ? function (elem, context, xml) {\n        while (elem = elem[dir]) {\n          if (elem.nodeType === 1 || checkNonElements) {\n            return matcher(elem, context, xml);\n          }\n        }\n      } : function (elem, context, xml) {\n        var oldCache, outerCache, newCache = [\n            dirruns,\n            doneName\n          ];\n        if (xml) {\n          while (elem = elem[dir]) {\n            if (elem.nodeType === 1 || checkNonElements) {\n              if (matcher(elem, context, xml)) {\n                return true;\n              }\n            }\n          }\n        } else {\n          while (elem = elem[dir]) {\n            if (elem.nodeType === 1 || checkNonElements) {\n              outerCache = elem[expando] || (elem[expando] = {});\n              if ((oldCache = outerCache[dir]) && oldCache[0] === dirruns && oldCache[1] === doneName) {\n                return newCache[2] = oldCache[2];\n              } else {\n                outerCache[dir] = newCache;\n                if (newCache[2] = matcher(elem, context, xml)) {\n                  return true;\n                }\n              }\n            }\n          }\n        }\n      };\n    }\n    function elementMatcher(matchers) {\n      return matchers.length > 1 ? function (elem, context, xml) {\n        var i = matchers.length;\n        while (i--) {\n          if (!matchers[i](elem, context, xml)) {\n            return false;\n          }\n        }\n        return true;\n      } : matchers[0];\n    }\n    function multipleContexts(selector, contexts, results) {\n      var i = 0, len = contexts.length;\n      for (; i < len; i++) {\n        Sizzle(selector, contexts[i], results);\n      }\n      return results;\n    }\n    function condense(unmatched, map, filter, context, xml) {\n      var elem, newUnmatched = [], i = 0, len = unmatched.length, mapped = map != null;\n      for (; i < len; i++) {\n        if (elem = unmatched[i]) {\n          if (!filter || filter(elem, context, xml)) {\n            newUnmatched.push(elem);\n            if (mapped) {\n              map.push(i);\n            }\n          }\n        }\n      }\n      return newUnmatched;\n    }\n    function setMatcher(preFilter, selector, matcher, postFilter, postFinder, postSelector) {\n      if (postFilter && !postFilter[expando]) {\n        postFilter = setMatcher(postFilter);\n      }\n      if (postFinder && !postFinder[expando]) {\n        postFinder = setMatcher(postFinder, postSelector);\n      }\n      return markFunction(function (seed, results, context, xml) {\n        var temp, i, elem, preMap = [], postMap = [], preexisting = results.length, elems = seed || multipleContexts(selector || '*', context.nodeType ? [context] : context, []), matcherIn = preFilter && (seed || !selector) ? condense(elems, preMap, preFilter, context, xml) : elems, matcherOut = matcher ? postFinder || (seed ? preFilter : preexisting || postFilter) ? [] : results : matcherIn;\n        if (matcher) {\n          matcher(matcherIn, matcherOut, context, xml);\n        }\n        if (postFilter) {\n          temp = condense(matcherOut, postMap);\n          postFilter(temp, [], context, xml);\n          i = temp.length;\n          while (i--) {\n            if (elem = temp[i]) {\n              matcherOut[postMap[i]] = !(matcherIn[postMap[i]] = elem);\n            }\n          }\n        }\n        if (seed) {\n          if (postFinder || preFilter) {\n            if (postFinder) {\n              temp = [];\n              i = matcherOut.length;\n              while (i--) {\n                if (elem = matcherOut[i]) {\n                  temp.push(matcherIn[i] = elem);\n                }\n              }\n              postFinder(null, matcherOut = [], temp, xml);\n            }\n            i = matcherOut.length;\n            while (i--) {\n              if ((elem = matcherOut[i]) && (temp = postFinder ? indexOf$2.call(seed, elem) : preMap[i]) > -1) {\n                seed[temp] = !(results[temp] = elem);\n              }\n            }\n          }\n        } else {\n          matcherOut = condense(matcherOut === results ? matcherOut.splice(preexisting, matcherOut.length) : matcherOut);\n          if (postFinder) {\n            postFinder(null, results, matcherOut, xml);\n          } else {\n            push.apply(results, matcherOut);\n          }\n        }\n      });\n    }\n    function matcherFromTokens(tokens) {\n      var checkContext, matcher, j, len = tokens.length, leadingRelative = Expr.relative[tokens[0].type], implicitRelative = leadingRelative || Expr.relative[' '], i = leadingRelative ? 1 : 0, matchContext = addCombinator(function (elem) {\n          return elem === checkContext;\n        }, implicitRelative, true), matchAnyContext = addCombinator(function (elem) {\n          return indexOf$2.call(checkContext, elem) > -1;\n        }, implicitRelative, true), matchers = [function (elem, context, xml) {\n            return !leadingRelative && (xml || context !== outermostContext) || ((checkContext = context).nodeType ? matchContext(elem, context, xml) : matchAnyContext(elem, context, xml));\n          }];\n      for (; i < len; i++) {\n        if (matcher = Expr.relative[tokens[i].type]) {\n          matchers = [addCombinator(elementMatcher(matchers), matcher)];\n        } else {\n          matcher = Expr.filter[tokens[i].type].apply(null, tokens[i].matches);\n          if (matcher[expando]) {\n            j = ++i;\n            for (; j < len; j++) {\n              if (Expr.relative[tokens[j].type]) {\n                break;\n              }\n            }\n            return setMatcher(i > 1 && elementMatcher(matchers), i > 1 && toSelector(tokens.slice(0, i - 1).concat({ value: tokens[i - 2].type === ' ' ? '*' : '' })).replace(rtrim, '$1'), matcher, i < j && matcherFromTokens(tokens.slice(i, j)), j < len && matcherFromTokens(tokens = tokens.slice(j)), j < len && toSelector(tokens));\n          }\n          matchers.push(matcher);\n        }\n      }\n      return elementMatcher(matchers);\n    }\n    function matcherFromGroupMatchers(elementMatchers, setMatchers) {\n      var bySet = setMatchers.length > 0, byElement = elementMatchers.length > 0, superMatcher = function (seed, context, xml, results, outermost) {\n          var elem, j, matcher, matchedCount = 0, i = '0', unmatched = seed && [], setMatched = [], contextBackup = outermostContext, elems = seed || byElement && Expr.find.TAG('*', outermost), dirrunsUnique = dirruns += contextBackup == null ? 1 : Math.random() || 0.1, len = elems.length;\n          if (outermost) {\n            outermostContext = context !== document$1 && context;\n          }\n          for (; i !== len && (elem = elems[i]) != null; i++) {\n            if (byElement && elem) {\n              j = 0;\n              while (matcher = elementMatchers[j++]) {\n                if (matcher(elem, context, xml)) {\n                  results.push(elem);\n                  break;\n                }\n              }\n              if (outermost) {\n                dirruns = dirrunsUnique;\n              }\n            }\n            if (bySet) {\n              if (elem = !matcher && elem) {\n                matchedCount--;\n              }\n              if (seed) {\n                unmatched.push(elem);\n              }\n            }\n          }\n          matchedCount += i;\n          if (bySet && i !== matchedCount) {\n            j = 0;\n            while (matcher = setMatchers[j++]) {\n              matcher(unmatched, setMatched, context, xml);\n            }\n            if (seed) {\n              if (matchedCount > 0) {\n                while (i--) {\n                  if (!(unmatched[i] || setMatched[i])) {\n                    setMatched[i] = pop.call(results);\n                  }\n                }\n              }\n              setMatched = condense(setMatched);\n            }\n            push.apply(results, setMatched);\n            if (outermost && !seed && setMatched.length > 0 && matchedCount + setMatchers.length > 1) {\n              Sizzle.uniqueSort(results);\n            }\n          }\n          if (outermost) {\n            dirruns = dirrunsUnique;\n            outermostContext = contextBackup;\n          }\n          return unmatched;\n        };\n      return bySet ? markFunction(superMatcher) : superMatcher;\n    }\n    compile = Sizzle.compile = function (selector, match) {\n      var i, setMatchers = [], elementMatchers = [], cached = compilerCache[selector + ' '];\n      if (!cached) {\n        if (!match) {\n          match = tokenize(selector);\n        }\n        i = match.length;\n        while (i--) {\n          cached = matcherFromTokens(match[i]);\n          if (cached[expando]) {\n            setMatchers.push(cached);\n          } else {\n            elementMatchers.push(cached);\n          }\n        }\n        cached = compilerCache(selector, matcherFromGroupMatchers(elementMatchers, setMatchers));\n        cached.selector = selector;\n      }\n      return cached;\n    };\n    select = Sizzle.select = function (selector, context, results, seed) {\n      var i, tokens, token, type, find, compiled = typeof selector === 'function' && selector, match = !seed && tokenize(selector = compiled.selector || selector);\n      results = results || [];\n      if (match.length === 1) {\n        tokens = match[0] = match[0].slice(0);\n        if (tokens.length > 2 && (token = tokens[0]).type === 'ID' && support.getById && context.nodeType === 9 && documentIsHTML && Expr.relative[tokens[1].type]) {\n          context = (Expr.find.ID(token.matches[0].replace(runescape, funescape), context) || [])[0];\n          if (!context) {\n            return results;\n          } else if (compiled) {\n            context = context.parentNode;\n          }\n          selector = selector.slice(tokens.shift().value.length);\n        }\n        i = matchExpr.needsContext.test(selector) ? 0 : tokens.length;\n        while (i--) {\n          token = tokens[i];\n          if (Expr.relative[type = token.type]) {\n            break;\n          }\n          if (find = Expr.find[type]) {\n            if (seed = find(token.matches[0].replace(runescape, funescape), rsibling.test(tokens[0].type) && testContext(context.parentNode) || context)) {\n              tokens.splice(i, 1);\n              selector = seed.length && toSelector(tokens);\n              if (!selector) {\n                push.apply(results, seed);\n                return results;\n              }\n              break;\n            }\n          }\n        }\n      }\n      (compiled || compile(selector, match))(seed, context, !documentIsHTML, results, rsibling.test(selector) && testContext(context.parentNode) || context);\n      return results;\n    };\n    support.sortStable = expando.split('').sort(sortOrder).join('') === expando;\n    support.detectDuplicates = !!hasDuplicate;\n    setDocument();\n    support.sortDetached = true;\n\n    var doc = document, push$1 = Array.prototype.push, slice$1 = Array.prototype.slice;\n    var rquickExpr$1 = /^(?:[^#<]*(<[\\w\\W]+>)[^>]*$|#([\\w\\-]*)$)/;\n    var Event = EventUtils.Event;\n    var skipUniques = Tools.makeMap('children,contents,next,prev');\n    var isDefined = function (obj) {\n      return typeof obj !== 'undefined';\n    };\n    var isString$1 = function (obj) {\n      return typeof obj === 'string';\n    };\n    var isWindow = function (obj) {\n      return obj && obj === obj.window;\n    };\n    var createFragment = function (html, fragDoc) {\n      fragDoc = fragDoc || doc;\n      var container = fragDoc.createElement('div');\n      var frag = fragDoc.createDocumentFragment();\n      container.innerHTML = html;\n      var node;\n      while (node = container.firstChild) {\n        frag.appendChild(node);\n      }\n      return frag;\n    };\n    var domManipulate = function (targetNodes, sourceItem, callback, reverse) {\n      var i;\n      if (isString$1(sourceItem)) {\n        sourceItem = createFragment(sourceItem, getElementDocument(targetNodes[0]));\n      } else if (sourceItem.length && !sourceItem.nodeType) {\n        sourceItem = DomQuery.makeArray(sourceItem);\n        if (reverse) {\n          for (i = sourceItem.length - 1; i >= 0; i--) {\n            domManipulate(targetNodes, sourceItem[i], callback, reverse);\n          }\n        } else {\n          for (i = 0; i < sourceItem.length; i++) {\n            domManipulate(targetNodes, sourceItem[i], callback, reverse);\n          }\n        }\n        return targetNodes;\n      }\n      if (sourceItem.nodeType) {\n        i = targetNodes.length;\n        while (i--) {\n          callback.call(targetNodes[i], sourceItem);\n        }\n      }\n      return targetNodes;\n    };\n    var hasClass = function (node, className) {\n      return node && className && (' ' + node.className + ' ').indexOf(' ' + className + ' ') !== -1;\n    };\n    var wrap$1 = function (elements, wrapper, all) {\n      var lastParent, newWrapper;\n      wrapper = DomQuery(wrapper)[0];\n      elements.each(function () {\n        var self = this;\n        if (!all || lastParent !== self.parentNode) {\n          lastParent = self.parentNode;\n          newWrapper = wrapper.cloneNode(false);\n          self.parentNode.insertBefore(newWrapper, self);\n          newWrapper.appendChild(self);\n        } else {\n          newWrapper.appendChild(self);\n        }\n      });\n      return elements;\n    };\n    var numericCssMap = Tools.makeMap('fillOpacity fontWeight lineHeight opacity orphans widows zIndex zoom', ' ');\n    var booleanMap = Tools.makeMap('checked compact declare defer disabled ismap multiple nohref noshade nowrap readonly selected', ' ');\n    var propFix = {\n      for: 'htmlFor',\n      class: 'className',\n      readonly: 'readOnly'\n    };\n    var cssFix = { float: 'cssFloat' };\n    var attrHooks = {}, cssHooks = {};\n    var DomQueryConstructor = function (selector, context) {\n      return new DomQuery.fn.init(selector, context);\n    };\n    var inArray$1 = function (item, array) {\n      var i;\n      if (array.indexOf) {\n        return array.indexOf(item);\n      }\n      i = array.length;\n      while (i--) {\n        if (array[i] === item) {\n          return i;\n        }\n      }\n      return -1;\n    };\n    var whiteSpaceRegExp$2 = /^\\s*|\\s*$/g;\n    var trim$3 = function (str) {\n      return str === null || str === undefined ? '' : ('' + str).replace(whiteSpaceRegExp$2, '');\n    };\n    var each$4 = function (obj, callback) {\n      var length, key, i, value;\n      if (obj) {\n        length = obj.length;\n        if (length === undefined) {\n          for (key in obj) {\n            if (obj.hasOwnProperty(key)) {\n              value = obj[key];\n              if (callback.call(value, key, value) === false) {\n                break;\n              }\n            }\n          }\n        } else {\n          for (i = 0; i < length; i++) {\n            value = obj[i];\n            if (callback.call(value, i, value) === false) {\n              break;\n            }\n          }\n        }\n      }\n      return obj;\n    };\n    var grep = function (array, callback) {\n      var out = [];\n      each$4(array, function (i, item) {\n        if (callback(item, i)) {\n          out.push(item);\n        }\n      });\n      return out;\n    };\n    var getElementDocument = function (element) {\n      if (!element) {\n        return doc;\n      }\n      if (element.nodeType === 9) {\n        return element;\n      }\n      return element.ownerDocument;\n    };\n    DomQueryConstructor.fn = DomQueryConstructor.prototype = {\n      constructor: DomQueryConstructor,\n      selector: '',\n      context: null,\n      length: 0,\n      init: function (selector, context) {\n        var self = this;\n        var match, node;\n        if (!selector) {\n          return self;\n        }\n        if (selector.nodeType) {\n          self.context = self[0] = selector;\n          self.length = 1;\n          return self;\n        }\n        if (context && context.nodeType) {\n          self.context = context;\n        } else {\n          if (context) {\n            return DomQuery(selector).attr(context);\n          }\n          self.context = context = document;\n        }\n        if (isString$1(selector)) {\n          self.selector = selector;\n          if (selector.charAt(0) === '<' && selector.charAt(selector.length - 1) === '>' && selector.length >= 3) {\n            match = [\n              null,\n              selector,\n              null\n            ];\n          } else {\n            match = rquickExpr$1.exec(selector);\n          }\n          if (match) {\n            if (match[1]) {\n              node = createFragment(selector, getElementDocument(context)).firstChild;\n              while (node) {\n                push$1.call(self, node);\n                node = node.nextSibling;\n              }\n            } else {\n              node = getElementDocument(context).getElementById(match[2]);\n              if (!node) {\n                return self;\n              }\n              if (node.id !== match[2]) {\n                return self.find(selector);\n              }\n              self.length = 1;\n              self[0] = node;\n            }\n          } else {\n            return DomQuery(context).find(selector);\n          }\n        } else {\n          this.add(selector, false);\n        }\n        return self;\n      },\n      toArray: function () {\n        return Tools.toArray(this);\n      },\n      add: function (items, sort) {\n        var self = this;\n        var nodes, i;\n        if (isString$1(items)) {\n          return self.add(DomQuery(items));\n        }\n        if (sort !== false) {\n          nodes = DomQuery.unique(self.toArray().concat(DomQuery.makeArray(items)));\n          self.length = nodes.length;\n          for (i = 0; i < nodes.length; i++) {\n            self[i] = nodes[i];\n          }\n        } else {\n          push$1.apply(self, DomQuery.makeArray(items));\n        }\n        return self;\n      },\n      attr: function (name, value) {\n        var self = this;\n        var hook;\n        if (typeof name === 'object') {\n          each$4(name, function (name, value) {\n            self.attr(name, value);\n          });\n        } else if (isDefined(value)) {\n          this.each(function () {\n            var hook;\n            if (this.nodeType === 1) {\n              hook = attrHooks[name];\n              if (hook && hook.set) {\n                hook.set(this, value);\n                return;\n              }\n              if (value === null) {\n                this.removeAttribute(name, 2);\n              } else {\n                this.setAttribute(name, value, 2);\n              }\n            }\n          });\n        } else {\n          if (self[0] && self[0].nodeType === 1) {\n            hook = attrHooks[name];\n            if (hook && hook.get) {\n              return hook.get(self[0], name);\n            }\n            if (booleanMap[name]) {\n              return self.prop(name) ? name : undefined;\n            }\n            value = self[0].getAttribute(name, 2);\n            if (value === null) {\n              value = undefined;\n            }\n          }\n          return value;\n        }\n        return self;\n      },\n      removeAttr: function (name) {\n        return this.attr(name, null);\n      },\n      prop: function (name, value) {\n        var self = this;\n        name = propFix[name] || name;\n        if (typeof name === 'object') {\n          each$4(name, function (name, value) {\n            self.prop(name, value);\n          });\n        } else if (isDefined(value)) {\n          this.each(function () {\n            if (this.nodeType === 1) {\n              this[name] = value;\n            }\n          });\n        } else {\n          if (self[0] && self[0].nodeType && name in self[0]) {\n            return self[0][name];\n          }\n          return value;\n        }\n        return self;\n      },\n      css: function (name, value) {\n        var self = this;\n        var elm, hook;\n        var camel = function (name) {\n          return name.replace(/-(\\D)/g, function (a, b) {\n            return b.toUpperCase();\n          });\n        };\n        var dashed = function (name) {\n          return name.replace(/[A-Z]/g, function (a) {\n            return '-' + a;\n          });\n        };\n        if (typeof name === 'object') {\n          each$4(name, function (name, value) {\n            self.css(name, value);\n          });\n        } else {\n          if (isDefined(value)) {\n            name = camel(name);\n            if (typeof value === 'number' && !numericCssMap[name]) {\n              value = value.toString() + 'px';\n            }\n            self.each(function () {\n              var style = this.style;\n              hook = cssHooks[name];\n              if (hook && hook.set) {\n                hook.set(this, value);\n                return;\n              }\n              try {\n                this.style[cssFix[name] || name] = value;\n              } catch (ex) {\n              }\n              if (value === null || value === '') {\n                if (style.removeProperty) {\n                  style.removeProperty(dashed(name));\n                } else {\n                  style.removeAttribute(name);\n                }\n              }\n            });\n          } else {\n            elm = self[0];\n            hook = cssHooks[name];\n            if (hook && hook.get) {\n              return hook.get(elm);\n            }\n            if (elm.ownerDocument.defaultView) {\n              try {\n                return elm.ownerDocument.defaultView.getComputedStyle(elm, null).getPropertyValue(dashed(name));\n              } catch (ex) {\n                return undefined;\n              }\n            } else if (elm.currentStyle) {\n              return elm.currentStyle[camel(name)];\n            } else {\n              return '';\n            }\n          }\n        }\n        return self;\n      },\n      remove: function () {\n        var self = this;\n        var node, i = this.length;\n        while (i--) {\n          node = self[i];\n          Event.clean(node);\n          if (node.parentNode) {\n            node.parentNode.removeChild(node);\n          }\n        }\n        return this;\n      },\n      empty: function () {\n        var self = this;\n        var node, i = this.length;\n        while (i--) {\n          node = self[i];\n          while (node.firstChild) {\n            node.removeChild(node.firstChild);\n          }\n        }\n        return this;\n      },\n      html: function (value) {\n        var self = this;\n        var i;\n        if (isDefined(value)) {\n          i = self.length;\n          try {\n            while (i--) {\n              self[i].innerHTML = value;\n            }\n          } catch (ex) {\n            DomQuery(self[i]).empty().append(value);\n          }\n          return self;\n        }\n        return self[0] ? self[0].innerHTML : '';\n      },\n      text: function (value) {\n        var self = this;\n        var i;\n        if (isDefined(value)) {\n          i = self.length;\n          while (i--) {\n            if ('innerText' in self[i]) {\n              self[i].innerText = value;\n            } else {\n              self[0].textContent = value;\n            }\n          }\n          return self;\n        }\n        return self[0] ? self[0].innerText || self[0].textContent : '';\n      },\n      append: function () {\n        return domManipulate(this, arguments, function (node) {\n          if (this.nodeType === 1 || this.host && this.host.nodeType === 1) {\n            this.appendChild(node);\n          }\n        });\n      },\n      prepend: function () {\n        return domManipulate(this, arguments, function (node) {\n          if (this.nodeType === 1 || this.host && this.host.nodeType === 1) {\n            this.insertBefore(node, this.firstChild);\n          }\n        }, true);\n      },\n      before: function () {\n        var self = this;\n        if (self[0] && self[0].parentNode) {\n          return domManipulate(self, arguments, function (node) {\n            this.parentNode.insertBefore(node, this);\n          });\n        }\n        return self;\n      },\n      after: function () {\n        var self = this;\n        if (self[0] && self[0].parentNode) {\n          return domManipulate(self, arguments, function (node) {\n            this.parentNode.insertBefore(node, this.nextSibling);\n          }, true);\n        }\n        return self;\n      },\n      appendTo: function (val) {\n        DomQuery(val).append(this);\n        return this;\n      },\n      prependTo: function (val) {\n        DomQuery(val).prepend(this);\n        return this;\n      },\n      replaceWith: function (content) {\n        return this.before(content).remove();\n      },\n      wrap: function (content) {\n        return wrap$1(this, content);\n      },\n      wrapAll: function (content) {\n        return wrap$1(this, content, true);\n      },\n      wrapInner: function (content) {\n        this.each(function () {\n          DomQuery(this).contents().wrapAll(content);\n        });\n        return this;\n      },\n      unwrap: function () {\n        return this.parent().each(function () {\n          DomQuery(this).replaceWith(this.childNodes);\n        });\n      },\n      clone: function () {\n        var result = [];\n        this.each(function () {\n          result.push(this.cloneNode(true));\n        });\n        return DomQuery(result);\n      },\n      addClass: function (className) {\n        return this.toggleClass(className, true);\n      },\n      removeClass: function (className) {\n        return this.toggleClass(className, false);\n      },\n      toggleClass: function (className, state) {\n        var self = this;\n        if (typeof className !== 'string') {\n          return self;\n        }\n        if (className.indexOf(' ') !== -1) {\n          each$4(className.split(' '), function () {\n            self.toggleClass(this, state);\n          });\n        } else {\n          self.each(function (index, node) {\n            var classState = hasClass(node, className);\n            if (classState !== state) {\n              var existingClassName = node.className;\n              if (classState) {\n                node.className = trim$3((' ' + existingClassName + ' ').replace(' ' + className + ' ', ' '));\n              } else {\n                node.className += existingClassName ? ' ' + className : className;\n              }\n            }\n          });\n        }\n        return self;\n      },\n      hasClass: function (className) {\n        return hasClass(this[0], className);\n      },\n      each: function (callback) {\n        return each$4(this, callback);\n      },\n      on: function (name, callback) {\n        return this.each(function () {\n          Event.bind(this, name, callback);\n        });\n      },\n      off: function (name, callback) {\n        return this.each(function () {\n          Event.unbind(this, name, callback);\n        });\n      },\n      trigger: function (name) {\n        return this.each(function () {\n          if (typeof name === 'object') {\n            Event.fire(this, name.type, name);\n          } else {\n            Event.fire(this, name);\n          }\n        });\n      },\n      show: function () {\n        return this.css('display', '');\n      },\n      hide: function () {\n        return this.css('display', 'none');\n      },\n      slice: function () {\n        return new DomQuery(slice$1.apply(this, arguments));\n      },\n      eq: function (index) {\n        return index === -1 ? this.slice(index) : this.slice(index, +index + 1);\n      },\n      first: function () {\n        return this.eq(0);\n      },\n      last: function () {\n        return this.eq(-1);\n      },\n      find: function (selector) {\n        var i, l;\n        var ret = [];\n        for (i = 0, l = this.length; i < l; i++) {\n          DomQuery.find(selector, this[i], ret);\n        }\n        return DomQuery(ret);\n      },\n      filter: function (selector) {\n        if (typeof selector === 'function') {\n          return DomQuery(grep(this.toArray(), function (item, i) {\n            return selector(i, item);\n          }));\n        }\n        return DomQuery(DomQuery.filter(selector, this.toArray()));\n      },\n      closest: function (selector) {\n        var result = [];\n        if (selector instanceof DomQuery) {\n          selector = selector[0];\n        }\n        this.each(function (i, node) {\n          while (node) {\n            if (typeof selector === 'string' && DomQuery(node).is(selector)) {\n              result.push(node);\n              break;\n            } else if (node === selector) {\n              result.push(node);\n              break;\n            }\n            node = node.parentNode;\n          }\n        });\n        return DomQuery(result);\n      },\n      offset: function (offset) {\n        var elm, doc, docElm;\n        var x = 0, y = 0, pos;\n        if (!offset) {\n          elm = this[0];\n          if (elm) {\n            doc = elm.ownerDocument;\n            docElm = doc.documentElement;\n            if (elm.getBoundingClientRect) {\n              pos = elm.getBoundingClientRect();\n              x = pos.left + (docElm.scrollLeft || doc.body.scrollLeft) - docElm.clientLeft;\n              y = pos.top + (docElm.scrollTop || doc.body.scrollTop) - docElm.clientTop;\n            }\n          }\n          return {\n            left: x,\n            top: y\n          };\n        }\n        return this.css(offset);\n      },\n      push: push$1,\n      sort: Array.prototype.sort,\n      splice: Array.prototype.splice\n    };\n    Tools.extend(DomQueryConstructor, {\n      extend: Tools.extend,\n      makeArray: function (object) {\n        if (isWindow(object) || object.nodeType) {\n          return [object];\n        }\n        return Tools.toArray(object);\n      },\n      inArray: inArray$1,\n      isArray: Tools.isArray,\n      each: each$4,\n      trim: trim$3,\n      grep: grep,\n      find: Sizzle,\n      expr: Sizzle.selectors,\n      unique: Sizzle.uniqueSort,\n      text: Sizzle.getText,\n      contains: Sizzle.contains,\n      filter: function (expr, elems, not) {\n        var i = elems.length;\n        if (not) {\n          expr = ':not(' + expr + ')';\n        }\n        while (i--) {\n          if (elems[i].nodeType !== 1) {\n            elems.splice(i, 1);\n          }\n        }\n        if (elems.length === 1) {\n          elems = DomQuery.find.matchesSelector(elems[0], expr) ? [elems[0]] : [];\n        } else {\n          elems = DomQuery.find.matches(expr, elems);\n        }\n        return elems;\n      }\n    });\n    var dir = function (el, prop, until) {\n      var matched = [];\n      var cur = el[prop];\n      if (typeof until !== 'string' && until instanceof DomQuery) {\n        until = until[0];\n      }\n      while (cur && cur.nodeType !== 9) {\n        if (until !== undefined) {\n          if (cur === until) {\n            break;\n          }\n          if (typeof until === 'string' && DomQuery(cur).is(until)) {\n            break;\n          }\n        }\n        if (cur.nodeType === 1) {\n          matched.push(cur);\n        }\n        cur = cur[prop];\n      }\n      return matched;\n    };\n    var sibling = function (node, siblingName, nodeType, until) {\n      var result = [];\n      if (until instanceof DomQuery) {\n        until = until[0];\n      }\n      for (; node; node = node[siblingName]) {\n        if (nodeType && node.nodeType !== nodeType) {\n          continue;\n        }\n        if (until !== undefined) {\n          if (node === until) {\n            break;\n          }\n          if (typeof until === 'string' && DomQuery(node).is(until)) {\n            break;\n          }\n        }\n        result.push(node);\n      }\n      return result;\n    };\n    var firstSibling = function (node, siblingName, nodeType) {\n      for (node = node[siblingName]; node; node = node[siblingName]) {\n        if (node.nodeType === nodeType) {\n          return node;\n        }\n      }\n      return null;\n    };\n    each$4({\n      parent: function (node) {\n        var parent = node.parentNode;\n        return parent && parent.nodeType !== 11 ? parent : null;\n      },\n      parents: function (node) {\n        return dir(node, 'parentNode');\n      },\n      next: function (node) {\n        return firstSibling(node, 'nextSibling', 1);\n      },\n      prev: function (node) {\n        return firstSibling(node, 'previousSibling', 1);\n      },\n      children: function (node) {\n        return sibling(node.firstChild, 'nextSibling', 1);\n      },\n      contents: function (node) {\n        return Tools.toArray((node.nodeName === 'iframe' ? node.contentDocument || node.contentWindow.document : node).childNodes);\n      }\n    }, function (name, fn) {\n      DomQueryConstructor.fn[name] = function (selector) {\n        var self = this;\n        var result = [];\n        self.each(function () {\n          var nodes = fn.call(result, this, selector, result);\n          if (nodes) {\n            if (DomQuery.isArray(nodes)) {\n              result.push.apply(result, nodes);\n            } else {\n              result.push(nodes);\n            }\n          }\n        });\n        if (this.length > 1) {\n          if (!skipUniques[name]) {\n            result = DomQuery.unique(result);\n          }\n          if (name.indexOf('parents') === 0) {\n            result = result.reverse();\n          }\n        }\n        var wrappedResult = DomQuery(result);\n        if (selector) {\n          return wrappedResult.filter(selector);\n        }\n        return wrappedResult;\n      };\n    });\n    each$4({\n      parentsUntil: function (node, until) {\n        return dir(node, 'parentNode', until);\n      },\n      nextUntil: function (node, until) {\n        return sibling(node, 'nextSibling', 1, until).slice(1);\n      },\n      prevUntil: function (node, until) {\n        return sibling(node, 'previousSibling', 1, until).slice(1);\n      }\n    }, function (name, fn) {\n      DomQueryConstructor.fn[name] = function (selector, filter) {\n        var self = this;\n        var result = [];\n        self.each(function () {\n          var nodes = fn.call(result, this, selector, result);\n          if (nodes) {\n            if (DomQuery.isArray(nodes)) {\n              result.push.apply(result, nodes);\n            } else {\n              result.push(nodes);\n            }\n          }\n        });\n        if (this.length > 1) {\n          result = DomQuery.unique(result);\n          if (name.indexOf('parents') === 0 || name === 'prevUntil') {\n            result = result.reverse();\n          }\n        }\n        var wrappedResult = DomQuery(result);\n        if (filter) {\n          return wrappedResult.filter(filter);\n        }\n        return wrappedResult;\n      };\n    });\n    DomQueryConstructor.fn.is = function (selector) {\n      return !!selector && this.filter(selector).length > 0;\n    };\n    DomQueryConstructor.fn.init.prototype = DomQueryConstructor.fn;\n    DomQueryConstructor.overrideDefaults = function (callback) {\n      var defaults;\n      var sub = function (selector, context) {\n        defaults = defaults || callback();\n        if (arguments.length === 0) {\n          selector = defaults.element;\n        }\n        if (!context) {\n          context = defaults.context;\n        }\n        return new sub.fn.init(selector, context);\n      };\n      DomQuery.extend(sub, this);\n      return sub;\n    };\n    DomQueryConstructor.attrHooks = attrHooks;\n    DomQueryConstructor.cssHooks = cssHooks;\n    var DomQuery = DomQueryConstructor;\n\n    var each$5 = Tools.each;\n    var grep$1 = Tools.grep;\n    var isIE = Env.ie;\n    var simpleSelectorRe = /^([a-z0-9],?)+$/i;\n    var setupAttrHooks = function (styles, settings, getContext) {\n      var keepValues = settings.keep_values;\n      var keepUrlHook = {\n        set: function ($elm, value, name) {\n          if (settings.url_converter) {\n            value = settings.url_converter.call(settings.url_converter_scope || getContext(), value, name, $elm[0]);\n          }\n          $elm.attr('data-mce-' + name, value).attr(name, value);\n        },\n        get: function ($elm, name) {\n          return $elm.attr('data-mce-' + name) || $elm.attr(name);\n        }\n      };\n      var attrHooks = {\n        style: {\n          set: function ($elm, value) {\n            if (value !== null && typeof value === 'object') {\n              $elm.css(value);\n              return;\n            }\n            if (keepValues) {\n              $elm.attr('data-mce-style', value);\n            }\n            if (value !== null && typeof value === 'string') {\n              $elm.removeAttr('style');\n              $elm.css(styles.parse(value));\n            } else {\n              $elm.attr('style', value);\n            }\n          },\n          get: function ($elm) {\n            var value = $elm.attr('data-mce-style') || $elm.attr('style');\n            value = styles.serialize(styles.parse(value), $elm[0].nodeName);\n            return value;\n          }\n        }\n      };\n      if (keepValues) {\n        attrHooks.href = attrHooks.src = keepUrlHook;\n      }\n      return attrHooks;\n    };\n    var updateInternalStyleAttr = function (styles, $elm) {\n      var rawValue = $elm.attr('style');\n      var value = styles.serialize(styles.parse(rawValue), $elm[0].nodeName);\n      if (!value) {\n        value = null;\n      }\n      $elm.attr('data-mce-style', value);\n    };\n    var findNodeIndex = function (node, normalized) {\n      var idx = 0, lastNodeType, nodeType;\n      if (node) {\n        for (lastNodeType = node.nodeType, node = node.previousSibling; node; node = node.previousSibling) {\n          nodeType = node.nodeType;\n          if (normalized && nodeType === 3) {\n            if (nodeType === lastNodeType || !node.nodeValue.length) {\n              continue;\n            }\n          }\n          idx++;\n          lastNodeType = nodeType;\n        }\n      }\n      return idx;\n    };\n    function DOMUtils(doc, settings) {\n      var _this = this;\n      if (settings === void 0) {\n        settings = {};\n      }\n      var addedStyles = {};\n      var win = window;\n      var files = {};\n      var counter = 0;\n      var stdMode = true;\n      var boxModel = true;\n      var styleSheetLoader = instance.forElement(SugarElement.fromDom(doc), {\n        contentCssCors: settings.contentCssCors,\n        referrerPolicy: settings.referrerPolicy\n      });\n      var boundEvents = [];\n      var schema = settings.schema ? settings.schema : Schema({});\n      var styles = Styles({\n        url_converter: settings.url_converter,\n        url_converter_scope: settings.url_converter_scope\n      }, settings.schema);\n      var events = settings.ownEvents ? new EventUtils() : EventUtils.Event;\n      var blockElementsMap = schema.getBlockElements();\n      var $ = DomQuery.overrideDefaults(function () {\n        return {\n          context: doc,\n          element: self.getRoot()\n        };\n      });\n      var isBlock = function (node) {\n        if (typeof node === 'string') {\n          return !!blockElementsMap[node];\n        } else if (node) {\n          var type = node.nodeType;\n          if (type) {\n            return !!(type === 1 && blockElementsMap[node.nodeName]);\n          }\n        }\n        return false;\n      };\n      var get = function (elm) {\n        return elm && doc && isString(elm) ? doc.getElementById(elm) : elm;\n      };\n      var $$ = function (elm) {\n        return $(typeof elm === 'string' ? get(elm) : elm);\n      };\n      var getAttrib = function (elm, name, defaultVal) {\n        var hook, value;\n        var $elm = $$(elm);\n        if ($elm.length) {\n          hook = attrHooks[name];\n          if (hook && hook.get) {\n            value = hook.get($elm, name);\n          } else {\n            value = $elm.attr(name);\n          }\n        }\n        if (typeof value === 'undefined') {\n          value = defaultVal || '';\n        }\n        return value;\n      };\n      var getAttribs = function (elm) {\n        var node = get(elm);\n        if (!node) {\n          return [];\n        }\n        return node.attributes;\n      };\n      var setAttrib = function (elm, name, value) {\n        if (value === '') {\n          value = null;\n        }\n        var $elm = $$(elm);\n        var originalValue = $elm.attr(name);\n        if (!$elm.length) {\n          return;\n        }\n        var hook = attrHooks[name];\n        if (hook && hook.set) {\n          hook.set($elm, value, name);\n        } else {\n          $elm.attr(name, value);\n        }\n        if (originalValue !== value && settings.onSetAttrib) {\n          settings.onSetAttrib({\n            attrElm: $elm,\n            attrName: name,\n            attrValue: value\n          });\n        }\n      };\n      var clone = function (node, deep) {\n        if (!isIE || node.nodeType !== 1 || deep) {\n          return node.cloneNode(deep);\n        } else {\n          var clone_1 = doc.createElement(node.nodeName);\n          each$5(getAttribs(node), function (attr) {\n            setAttrib(clone_1, attr.nodeName, getAttrib(node, attr.nodeName));\n          });\n          return clone_1;\n        }\n      };\n      var getRoot = function () {\n        return settings.root_element || doc.body;\n      };\n      var getViewPort = function (argWin) {\n        var vp = getBounds(argWin);\n        return {\n          x: vp.x,\n          y: vp.y,\n          w: vp.width,\n          h: vp.height\n        };\n      };\n      var getPos$1 = function (elm, rootElm) {\n        return getPos(doc.body, get(elm), rootElm);\n      };\n      var setStyle = function (elm, name, value) {\n        var $elm = isString(name) ? $$(elm).css(name, value) : $$(elm).css(name);\n        if (settings.update_styles) {\n          updateInternalStyleAttr(styles, $elm);\n        }\n      };\n      var setStyles = function (elm, stylesArg) {\n        var $elm = $$(elm).css(stylesArg);\n        if (settings.update_styles) {\n          updateInternalStyleAttr(styles, $elm);\n        }\n      };\n      var getStyle = function (elm, name, computed) {\n        var $elm = $$(elm);\n        if (computed) {\n          return $elm.css(name);\n        }\n        name = name.replace(/-(\\D)/g, function (a, b) {\n          return b.toUpperCase();\n        });\n        if (name === 'float') {\n          name = Env.browser.isIE() ? 'styleFloat' : 'cssFloat';\n        }\n        return $elm[0] && $elm[0].style ? $elm[0].style[name] : undefined;\n      };\n      var getSize = function (elm) {\n        var w, h;\n        elm = get(elm);\n        w = getStyle(elm, 'width');\n        h = getStyle(elm, 'height');\n        if (w.indexOf('px') === -1) {\n          w = 0;\n        }\n        if (h.indexOf('px') === -1) {\n          h = 0;\n        }\n        return {\n          w: parseInt(w, 10) || elm.offsetWidth || elm.clientWidth,\n          h: parseInt(h, 10) || elm.offsetHeight || elm.clientHeight\n        };\n      };\n      var getRect = function (elm) {\n        elm = get(elm);\n        var pos = getPos$1(elm);\n        var size = getSize(elm);\n        return {\n          x: pos.x,\n          y: pos.y,\n          w: size.w,\n          h: size.h\n        };\n      };\n      var is = function (elm, selector) {\n        var i;\n        if (!elm) {\n          return false;\n        }\n        if (!Array.isArray(elm)) {\n          if (selector === '*') {\n            return elm.nodeType === 1;\n          }\n          if (simpleSelectorRe.test(selector)) {\n            var selectors = selector.toLowerCase().split(/,/);\n            var elmName = elm.nodeName.toLowerCase();\n            for (i = selectors.length - 1; i >= 0; i--) {\n              if (selectors[i] === elmName) {\n                return true;\n              }\n            }\n            return false;\n          }\n          if (elm.nodeType && elm.nodeType !== 1) {\n            return false;\n          }\n        }\n        var elms = !Array.isArray(elm) ? [elm] : elm;\n        return Sizzle(selector, elms[0].ownerDocument || elms[0], null, elms).length > 0;\n      };\n      var getParents = function (elm, selector, root, collect) {\n        var result = [];\n        var selectorVal;\n        var node = get(elm);\n        collect = collect === undefined;\n        root = root || (getRoot().nodeName !== 'BODY' ? getRoot().parentNode : null);\n        if (Tools.is(selector, 'string')) {\n          selectorVal = selector;\n          if (selector === '*') {\n            selector = function (node) {\n              return node.nodeType === 1;\n            };\n          } else {\n            selector = function (node) {\n              return is(node, selectorVal);\n            };\n          }\n        }\n        while (node) {\n          if (node === root || !node.nodeType || node.nodeType === 9) {\n            break;\n          }\n          if (!selector || typeof selector === 'function' && selector(node)) {\n            if (collect) {\n              result.push(node);\n            } else {\n              return [node];\n            }\n          }\n          node = node.parentNode;\n        }\n        return collect ? result : null;\n      };\n      var getParent = function (node, selector, root) {\n        var parents = getParents(node, selector, root, false);\n        return parents && parents.length > 0 ? parents[0] : null;\n      };\n      var _findSib = function (node, selector, name) {\n        var func = selector;\n        if (node) {\n          if (typeof selector === 'string') {\n            func = function (node) {\n              return is(node, selector);\n            };\n          }\n          for (node = node[name]; node; node = node[name]) {\n            if (typeof func === 'function' && func(node)) {\n              return node;\n            }\n          }\n        }\n        return null;\n      };\n      var getNext = function (node, selector) {\n        return _findSib(node, selector, 'nextSibling');\n      };\n      var getPrev = function (node, selector) {\n        return _findSib(node, selector, 'previousSibling');\n      };\n      var select = function (selector, scope) {\n        return Sizzle(selector, get(scope) || settings.root_element || doc, []);\n      };\n      var run = function (elm, func, scope) {\n        var result;\n        var node = typeof elm === 'string' ? get(elm) : elm;\n        if (!node) {\n          return false;\n        }\n        if (Tools.isArray(node) && (node.length || node.length === 0)) {\n          result = [];\n          each$5(node, function (elm, i) {\n            if (elm) {\n              result.push(func.call(scope, typeof elm === 'string' ? get(elm) : elm, i));\n            }\n          });\n          return result;\n        }\n        var context = scope ? scope : _this;\n        return func.call(context, node);\n      };\n      var setAttribs = function (elm, attrs) {\n        $$(elm).each(function (i, node) {\n          each$5(attrs, function (value, name) {\n            setAttrib(node, name, value);\n          });\n        });\n      };\n      var setHTML = function (elm, html) {\n        var $elm = $$(elm);\n        if (isIE) {\n          $elm.each(function (i, target) {\n            if (target.canHaveHTML === false) {\n              return;\n            }\n            while (target.firstChild) {\n              target.removeChild(target.firstChild);\n            }\n            try {\n              target.innerHTML = '<br>' + html;\n              target.removeChild(target.firstChild);\n            } catch (ex) {\n              DomQuery('<div></div>').html('<br>' + html).contents().slice(1).appendTo(target);\n            }\n            return html;\n          });\n        } else {\n          $elm.html(html);\n        }\n      };\n      var add = function (parentElm, name, attrs, html, create) {\n        return run(parentElm, function (parentElm) {\n          var newElm = typeof name === 'string' ? doc.createElement(name) : name;\n          setAttribs(newElm, attrs);\n          if (html) {\n            if (typeof html !== 'string' && html.nodeType) {\n              newElm.appendChild(html);\n            } else if (typeof html === 'string') {\n              setHTML(newElm, html);\n            }\n          }\n          return !create ? parentElm.appendChild(newElm) : newElm;\n        });\n      };\n      var create = function (name, attrs, html) {\n        return add(doc.createElement(name), name, attrs, html, true);\n      };\n      var decode = Entities.decode;\n      var encode = Entities.encodeAllRaw;\n      var createHTML = function (name, attrs, html) {\n        var outHtml = '', key;\n        outHtml += '<' + name;\n        for (key in attrs) {\n          if (attrs.hasOwnProperty(key) && attrs[key] !== null && typeof attrs[key] !== 'undefined') {\n            outHtml += ' ' + key + '=\"' + encode(attrs[key]) + '\"';\n          }\n        }\n        if (typeof html !== 'undefined') {\n          return outHtml + '>' + html + '</' + name + '>';\n        }\n        return outHtml + ' />';\n      };\n      var createFragment = function (html) {\n        var node;\n        var container = doc.createElement('div');\n        var frag = doc.createDocumentFragment();\n        frag.appendChild(container);\n        if (html) {\n          container.innerHTML = html;\n        }\n        while (node = container.firstChild) {\n          frag.appendChild(node);\n        }\n        frag.removeChild(container);\n        return frag;\n      };\n      var remove = function (node, keepChildren) {\n        var $node = $$(node);\n        if (keepChildren) {\n          $node.each(function () {\n            var child;\n            while (child = this.firstChild) {\n              if (child.nodeType === 3 && child.data.length === 0) {\n                this.removeChild(child);\n              } else {\n                this.parentNode.insertBefore(child, this);\n              }\n            }\n          }).remove();\n        } else {\n          $node.remove();\n        }\n        return $node.length > 1 ? $node.toArray() : $node[0];\n      };\n      var removeAllAttribs = function (e) {\n        return run(e, function (e) {\n          var i;\n          var attrs = e.attributes;\n          for (i = attrs.length - 1; i >= 0; i--) {\n            e.removeAttributeNode(attrs.item(i));\n          }\n        });\n      };\n      var parseStyle = function (cssText) {\n        return styles.parse(cssText);\n      };\n      var serializeStyle = function (stylesArg, name) {\n        return styles.serialize(stylesArg, name);\n      };\n      var addStyle = function (cssText) {\n        var head, styleElm;\n        if (self !== DOMUtils.DOM && doc === document) {\n          if (addedStyles[cssText]) {\n            return;\n          }\n          addedStyles[cssText] = true;\n        }\n        styleElm = doc.getElementById('mceDefaultStyles');\n        if (!styleElm) {\n          styleElm = doc.createElement('style');\n          styleElm.id = 'mceDefaultStyles';\n          styleElm.type = 'text/css';\n          head = doc.getElementsByTagName('head')[0];\n          if (head.firstChild) {\n            head.insertBefore(styleElm, head.firstChild);\n          } else {\n            head.appendChild(styleElm);\n          }\n        }\n        if (styleElm.styleSheet) {\n          styleElm.styleSheet.cssText += cssText;\n        } else {\n          styleElm.appendChild(doc.createTextNode(cssText));\n        }\n      };\n      var loadCSS = function (urls) {\n        if (!urls) {\n          urls = '';\n        }\n        each(urls.split(','), function (url) {\n          files[url] = true;\n          styleSheetLoader.load(url, noop);\n        });\n      };\n      var toggleClass = function (elm, cls, state) {\n        $$(elm).toggleClass(cls, state).each(function () {\n          if (this.className === '') {\n            DomQuery(this).attr('class', null);\n          }\n        });\n      };\n      var addClass = function (elm, cls) {\n        $$(elm).addClass(cls);\n      };\n      var removeClass = function (elm, cls) {\n        toggleClass(elm, cls, false);\n      };\n      var hasClass = function (elm, cls) {\n        return $$(elm).hasClass(cls);\n      };\n      var show = function (elm) {\n        $$(elm).show();\n      };\n      var hide = function (elm) {\n        $$(elm).hide();\n      };\n      var isHidden = function (elm) {\n        return $$(elm).css('display') === 'none';\n      };\n      var uniqueId = function (prefix) {\n        return (!prefix ? 'mce_' : prefix) + counter++;\n      };\n      var getOuterHTML = function (elm) {\n        var node = typeof elm === 'string' ? get(elm) : elm;\n        return isElement$1(node) ? node.outerHTML : DomQuery('<div></div>').append(DomQuery(node).clone()).html();\n      };\n      var setOuterHTML = function (elm, html) {\n        $$(elm).each(function () {\n          try {\n            if ('outerHTML' in this) {\n              this.outerHTML = html;\n              return;\n            }\n          } catch (ex) {\n          }\n          remove(DomQuery(this).html(html), true);\n        });\n      };\n      var insertAfter = function (node, reference) {\n        var referenceNode = get(reference);\n        return run(node, function (node) {\n          var parent = referenceNode.parentNode;\n          var nextSibling = referenceNode.nextSibling;\n          if (nextSibling) {\n            parent.insertBefore(node, nextSibling);\n          } else {\n            parent.appendChild(node);\n          }\n          return node;\n        });\n      };\n      var replace = function (newElm, oldElm, keepChildren) {\n        return run(oldElm, function (oldElm) {\n          if (Tools.is(oldElm, 'array')) {\n            newElm = newElm.cloneNode(true);\n          }\n          if (keepChildren) {\n            each$5(grep$1(oldElm.childNodes), function (node) {\n              newElm.appendChild(node);\n            });\n          }\n          return oldElm.parentNode.replaceChild(newElm, oldElm);\n        });\n      };\n      var rename = function (elm, name) {\n        var newElm;\n        if (elm.nodeName !== name.toUpperCase()) {\n          newElm = create(name);\n          each$5(getAttribs(elm), function (attrNode) {\n            setAttrib(newElm, attrNode.nodeName, getAttrib(elm, attrNode.nodeName));\n          });\n          replace(newElm, elm, true);\n        }\n        return newElm || elm;\n      };\n      var findCommonAncestor = function (a, b) {\n        var ps = a, pe;\n        while (ps) {\n          pe = b;\n          while (pe && ps !== pe) {\n            pe = pe.parentNode;\n          }\n          if (ps === pe) {\n            break;\n          }\n          ps = ps.parentNode;\n        }\n        if (!ps && a.ownerDocument) {\n          return a.ownerDocument.documentElement;\n        }\n        return ps;\n      };\n      var toHex = function (rgbVal) {\n        return styles.toHex(Tools.trim(rgbVal));\n      };\n      var isNonEmptyElement = function (node) {\n        if (isElement$1(node)) {\n          var isNamedAnchor = node.nodeName.toLowerCase() === 'a' && !getAttrib(node, 'href') && getAttrib(node, 'id');\n          if (getAttrib(node, 'name') || getAttrib(node, 'data-mce-bookmark') || isNamedAnchor) {\n            return true;\n          }\n        }\n        return false;\n      };\n      var isEmpty = function (node, elements) {\n        var type, name, brCount = 0;\n        if (isNonEmptyElement(node)) {\n          return false;\n        }\n        node = node.firstChild;\n        if (node) {\n          var walker = new DomTreeWalker(node, node.parentNode);\n          var whitespace = schema ? schema.getWhiteSpaceElements() : {};\n          elements = elements || (schema ? schema.getNonEmptyElements() : null);\n          do {\n            type = node.nodeType;\n            if (isElement$1(node)) {\n              var bogusVal = node.getAttribute('data-mce-bogus');\n              if (bogusVal) {\n                node = walker.next(bogusVal === 'all');\n                continue;\n              }\n              name = node.nodeName.toLowerCase();\n              if (elements && elements[name]) {\n                if (name === 'br') {\n                  brCount++;\n                  node = walker.next();\n                  continue;\n                }\n                return false;\n              }\n              if (isNonEmptyElement(node)) {\n                return false;\n              }\n            }\n            if (type === 8) {\n              return false;\n            }\n            if (type === 3 && !isWhitespaceText(node.nodeValue)) {\n              return false;\n            }\n            if (type === 3 && node.parentNode && whitespace[node.parentNode.nodeName] && isWhitespaceText(node.nodeValue)) {\n              return false;\n            }\n            node = walker.next();\n          } while (node);\n        }\n        return brCount <= 1;\n      };\n      var createRng = function () {\n        return doc.createRange();\n      };\n      var split = function (parentElm, splitElm, replacementElm) {\n        var range = createRng();\n        var beforeFragment;\n        var afterFragment;\n        var parentNode;\n        if (parentElm && splitElm) {\n          range.setStart(parentElm.parentNode, findNodeIndex(parentElm));\n          range.setEnd(splitElm.parentNode, findNodeIndex(splitElm));\n          beforeFragment = range.extractContents();\n          range = createRng();\n          range.setStart(splitElm.parentNode, findNodeIndex(splitElm) + 1);\n          range.setEnd(parentElm.parentNode, findNodeIndex(parentElm) + 1);\n          afterFragment = range.extractContents();\n          parentNode = parentElm.parentNode;\n          parentNode.insertBefore(trimNode(self, beforeFragment), parentElm);\n          if (replacementElm) {\n            parentNode.insertBefore(replacementElm, parentElm);\n          } else {\n            parentNode.insertBefore(splitElm, parentElm);\n          }\n          parentNode.insertBefore(trimNode(self, afterFragment), parentElm);\n          remove(parentElm);\n          return replacementElm || splitElm;\n        }\n      };\n      var bind = function (target, name, func, scope) {\n        if (Tools.isArray(target)) {\n          var i = target.length;\n          var rv = [];\n          while (i--) {\n            rv[i] = bind(target[i], name, func, scope);\n          }\n          return rv;\n        }\n        if (settings.collect && (target === doc || target === win)) {\n          boundEvents.push([\n            target,\n            name,\n            func,\n            scope\n          ]);\n        }\n        var output = events.bind(target, name, func, scope || self);\n        return output;\n      };\n      var unbind = function (target, name, func) {\n        if (Tools.isArray(target)) {\n          var i = target.length;\n          var rv = [];\n          while (i--) {\n            rv[i] = unbind(target[i], name, func);\n          }\n          return rv;\n        } else {\n          if (boundEvents.length > 0 && (target === doc || target === win)) {\n            var i = boundEvents.length;\n            while (i--) {\n              var item = boundEvents[i];\n              if (target === item[0] && (!name || name === item[1]) && (!func || func === item[2])) {\n                events.unbind(item[0], item[1], item[2]);\n              }\n            }\n          }\n          return events.unbind(target, name, func);\n        }\n      };\n      var fire = function (target, name, evt) {\n        return events.fire(target, name, evt);\n      };\n      var getContentEditable = function (node) {\n        if (node && isElement$1(node)) {\n          var contentEditable = node.getAttribute('data-mce-contenteditable');\n          if (contentEditable && contentEditable !== 'inherit') {\n            return contentEditable;\n          }\n          return node.contentEditable !== 'inherit' ? node.contentEditable : null;\n        } else {\n          return null;\n        }\n      };\n      var getContentEditableParent = function (node) {\n        var root = getRoot();\n        var state = null;\n        for (; node && node !== root; node = node.parentNode) {\n          state = getContentEditable(node);\n          if (state !== null) {\n            break;\n          }\n        }\n        return state;\n      };\n      var destroy = function () {\n        if (boundEvents.length > 0) {\n          var i = boundEvents.length;\n          while (i--) {\n            var item = boundEvents[i];\n            events.unbind(item[0], item[1], item[2]);\n          }\n        }\n        each$1(files, function (_, url) {\n          styleSheetLoader.unload(url);\n          delete files[url];\n        });\n        if (Sizzle.setDocument) {\n          Sizzle.setDocument();\n        }\n      };\n      var isChildOf = function (node, parent) {\n        while (node) {\n          if (parent === node) {\n            return true;\n          }\n          node = node.parentNode;\n        }\n        return false;\n      };\n      var dumpRng = function (r) {\n        return 'startContainer: ' + r.startContainer.nodeName + ', startOffset: ' + r.startOffset + ', endContainer: ' + r.endContainer.nodeName + ', endOffset: ' + r.endOffset;\n      };\n      var self = {\n        doc: doc,\n        settings: settings,\n        win: win,\n        files: files,\n        stdMode: stdMode,\n        boxModel: boxModel,\n        styleSheetLoader: styleSheetLoader,\n        boundEvents: boundEvents,\n        styles: styles,\n        schema: schema,\n        events: events,\n        isBlock: isBlock,\n        $: $,\n        $$: $$,\n        root: null,\n        clone: clone,\n        getRoot: getRoot,\n        getViewPort: getViewPort,\n        getRect: getRect,\n        getSize: getSize,\n        getParent: getParent,\n        getParents: getParents,\n        get: get,\n        getNext: getNext,\n        getPrev: getPrev,\n        select: select,\n        is: is,\n        add: add,\n        create: create,\n        createHTML: createHTML,\n        createFragment: createFragment,\n        remove: remove,\n        setStyle: setStyle,\n        getStyle: getStyle,\n        setStyles: setStyles,\n        removeAllAttribs: removeAllAttribs,\n        setAttrib: setAttrib,\n        setAttribs: setAttribs,\n        getAttrib: getAttrib,\n        getPos: getPos$1,\n        parseStyle: parseStyle,\n        serializeStyle: serializeStyle,\n        addStyle: addStyle,\n        loadCSS: loadCSS,\n        addClass: addClass,\n        removeClass: removeClass,\n        hasClass: hasClass,\n        toggleClass: toggleClass,\n        show: show,\n        hide: hide,\n        isHidden: isHidden,\n        uniqueId: uniqueId,\n        setHTML: setHTML,\n        getOuterHTML: getOuterHTML,\n        setOuterHTML: setOuterHTML,\n        decode: decode,\n        encode: encode,\n        insertAfter: insertAfter,\n        replace: replace,\n        rename: rename,\n        findCommonAncestor: findCommonAncestor,\n        toHex: toHex,\n        run: run,\n        getAttribs: getAttribs,\n        isEmpty: isEmpty,\n        createRng: createRng,\n        nodeIndex: findNodeIndex,\n        split: split,\n        bind: bind,\n        unbind: unbind,\n        fire: fire,\n        getContentEditable: getContentEditable,\n        getContentEditableParent: getContentEditableParent,\n        destroy: destroy,\n        isChildOf: isChildOf,\n        dumpRng: dumpRng\n      };\n      var attrHooks = setupAttrHooks(styles, settings, function () {\n        return self;\n      });\n      return self;\n    }\n    (function (DOMUtils) {\n      DOMUtils.DOM = DOMUtils(document);\n      DOMUtils.nodeIndex = findNodeIndex;\n    }(DOMUtils || (DOMUtils = {})));\n    var DOMUtils$1 = DOMUtils;\n\n    var DOM = DOMUtils$1.DOM;\n    var each$6 = Tools.each, grep$2 = Tools.grep;\n    var QUEUED = 0;\n    var LOADING = 1;\n    var LOADED = 2;\n    var FAILED = 3;\n    var ScriptLoader = function () {\n      function ScriptLoader(settings) {\n        if (settings === void 0) {\n          settings = {};\n        }\n        this.states = {};\n        this.queue = [];\n        this.scriptLoadedCallbacks = {};\n        this.queueLoadedCallbacks = [];\n        this.loading = 0;\n        this.settings = settings;\n      }\n      ScriptLoader.prototype._setReferrerPolicy = function (referrerPolicy) {\n        this.settings.referrerPolicy = referrerPolicy;\n      };\n      ScriptLoader.prototype.loadScript = function (url, success, failure) {\n        var dom = DOM;\n        var elm;\n        var done = function () {\n          dom.remove(id);\n          if (elm) {\n            elm.onreadystatechange = elm.onload = elm = null;\n          }\n          success();\n        };\n        var error = function () {\n          if (isFunction(failure)) {\n            failure();\n          } else {\n            if (typeof console !== 'undefined' && console.log) {\n              console.log('Failed to load script: ' + url);\n            }\n          }\n        };\n        var id = dom.uniqueId();\n        elm = document.createElement('script');\n        elm.id = id;\n        elm.type = 'text/javascript';\n        elm.src = Tools._addCacheSuffix(url);\n        if (this.settings.referrerPolicy) {\n          dom.setAttrib(elm, 'referrerpolicy', this.settings.referrerPolicy);\n        }\n        elm.onload = done;\n        elm.onerror = error;\n        (document.getElementsByTagName('head')[0] || document.body).appendChild(elm);\n      };\n      ScriptLoader.prototype.isDone = function (url) {\n        return this.states[url] === LOADED;\n      };\n      ScriptLoader.prototype.markDone = function (url) {\n        this.states[url] = LOADED;\n      };\n      ScriptLoader.prototype.add = function (url, success, scope, failure) {\n        var state = this.states[url];\n        if (state === undefined) {\n          this.queue.push(url);\n          this.states[url] = QUEUED;\n        }\n        if (success) {\n          if (!this.scriptLoadedCallbacks[url]) {\n            this.scriptLoadedCallbacks[url] = [];\n          }\n          this.scriptLoadedCallbacks[url].push({\n            success: success,\n            failure: failure,\n            scope: scope || this\n          });\n        }\n      };\n      ScriptLoader.prototype.load = function (url, success, scope, failure) {\n        return this.add(url, success, scope, failure);\n      };\n      ScriptLoader.prototype.remove = function (url) {\n        delete this.states[url];\n        delete this.scriptLoadedCallbacks[url];\n      };\n      ScriptLoader.prototype.loadQueue = function (success, scope, failure) {\n        this.loadScripts(this.queue, success, scope, failure);\n      };\n      ScriptLoader.prototype.loadScripts = function (scripts, success, scope, failure) {\n        var self = this;\n        var failures = [];\n        var execCallbacks = function (name, url) {\n          each$6(self.scriptLoadedCallbacks[url], function (callback) {\n            if (isFunction(callback[name])) {\n              callback[name].call(callback.scope);\n            }\n          });\n          self.scriptLoadedCallbacks[url] = undefined;\n        };\n        self.queueLoadedCallbacks.push({\n          success: success,\n          failure: failure,\n          scope: scope || this\n        });\n        var loadScripts = function () {\n          var loadingScripts = grep$2(scripts);\n          scripts.length = 0;\n          each$6(loadingScripts, function (url) {\n            if (self.states[url] === LOADED) {\n              execCallbacks('success', url);\n              return;\n            }\n            if (self.states[url] === FAILED) {\n              execCallbacks('failure', url);\n              return;\n            }\n            if (self.states[url] !== LOADING) {\n              self.states[url] = LOADING;\n              self.loading++;\n              self.loadScript(url, function () {\n                self.states[url] = LOADED;\n                self.loading--;\n                execCallbacks('success', url);\n                loadScripts();\n              }, function () {\n                self.states[url] = FAILED;\n                self.loading--;\n                failures.push(url);\n                execCallbacks('failure', url);\n                loadScripts();\n              });\n            }\n          });\n          if (!self.loading) {\n            var notifyCallbacks = self.queueLoadedCallbacks.slice(0);\n            self.queueLoadedCallbacks.length = 0;\n            each$6(notifyCallbacks, function (callback) {\n              if (failures.length === 0) {\n                if (isFunction(callback.success)) {\n                  callback.success.call(callback.scope);\n                }\n              } else {\n                if (isFunction(callback.failure)) {\n                  callback.failure.call(callback.scope, failures);\n                }\n              }\n            });\n          }\n        };\n        loadScripts();\n      };\n      ScriptLoader.ScriptLoader = new ScriptLoader();\n      return ScriptLoader;\n    }();\n\n    var Cell = function (initial) {\n      var value = initial;\n      var get = function () {\n        return value;\n      };\n      var set = function (v) {\n        value = v;\n      };\n      return {\n        get: get,\n        set: set\n      };\n    };\n\n    var isRaw = function (str) {\n      return isObject(str) && has(str, 'raw');\n    };\n    var isTokenised = function (str) {\n      return isArray(str) && str.length > 1;\n    };\n    var data = {};\n    var currentCode = Cell('en');\n    var getLanguageData = function () {\n      return get(data, currentCode.get());\n    };\n    var getData = function () {\n      return map$1(data, function (value) {\n        return __assign({}, value);\n      });\n    };\n    var setCode = function (newCode) {\n      if (newCode) {\n        currentCode.set(newCode);\n      }\n    };\n    var getCode = function () {\n      return currentCode.get();\n    };\n    var add = function (code, items) {\n      var langData = data[code];\n      if (!langData) {\n        data[code] = langData = {};\n      }\n      each$1(items, function (translation, name) {\n        langData[name.toLowerCase()] = translation;\n      });\n    };\n    var translate = function (text) {\n      var langData = getLanguageData().getOr({});\n      var toString = function (obj) {\n        if (isFunction(obj)) {\n          return Object.prototype.toString.call(obj);\n        }\n        return !isEmpty(obj) ? '' + obj : '';\n      };\n      var isEmpty = function (text) {\n        return text === '' || text === null || text === undefined;\n      };\n      var getLangData = function (text) {\n        var textstr = toString(text);\n        return get(langData, textstr.toLowerCase()).map(toString).getOr(textstr);\n      };\n      var removeContext = function (str) {\n        return str.replace(/{context:\\w+}$/, '');\n      };\n      if (isEmpty(text)) {\n        return '';\n      }\n      if (isRaw(text)) {\n        return toString(text.raw);\n      }\n      if (isTokenised(text)) {\n        var values_1 = text.slice(1);\n        var substitued = getLangData(text[0]).replace(/\\{([0-9]+)\\}/g, function ($1, $2) {\n          return has(values_1, $2) ? toString(values_1[$2]) : $1;\n        });\n        return removeContext(substitued);\n      }\n      return removeContext(getLangData(text));\n    };\n    var isRtl = function () {\n      return getLanguageData().bind(function (items) {\n        return get(items, '_dir');\n      }).exists(function (dir) {\n        return dir === 'rtl';\n      });\n    };\n    var hasCode = function (code) {\n      return has(data, code);\n    };\n    var I18n = {\n      getData: getData,\n      setCode: setCode,\n      getCode: getCode,\n      add: add,\n      translate: translate,\n      isRtl: isRtl,\n      hasCode: hasCode\n    };\n\n    function AddOnManager() {\n      var _this = this;\n      var items = [];\n      var urls = {};\n      var lookup = {};\n      var _listeners = [];\n      var runListeners = function (name, state) {\n        var matchedListeners = filter(_listeners, function (listener) {\n          return listener.name === name && listener.state === state;\n        });\n        each(matchedListeners, function (listener) {\n          return listener.callback();\n        });\n      };\n      var get = function (name) {\n        if (lookup[name]) {\n          return lookup[name].instance;\n        }\n        return undefined;\n      };\n      var dependencies = function (name) {\n        var result;\n        if (lookup[name]) {\n          result = lookup[name].dependencies;\n        }\n        return result || [];\n      };\n      var requireLangPack = function (name, languages) {\n        if (AddOnManager.languageLoad !== false) {\n          waitFor(name, function () {\n            var language = I18n.getCode();\n            var wrappedLanguages = ',' + (languages || '') + ',';\n            if (!language || languages && wrappedLanguages.indexOf(',' + language + ',') === -1) {\n              return;\n            }\n            ScriptLoader.ScriptLoader.add(urls[name] + '/langs/' + language + '.js');\n          }, 'loaded');\n        }\n      };\n      var add = function (id, addOn, dependencies) {\n        var addOnConstructor = addOn;\n        items.push(addOnConstructor);\n        lookup[id] = {\n          instance: addOnConstructor,\n          dependencies: dependencies\n        };\n        runListeners(id, 'added');\n        return addOnConstructor;\n      };\n      var remove = function (name) {\n        delete urls[name];\n        delete lookup[name];\n      };\n      var createUrl = function (baseUrl, dep) {\n        if (typeof dep === 'object') {\n          return dep;\n        }\n        return typeof baseUrl === 'string' ? {\n          prefix: '',\n          resource: dep,\n          suffix: ''\n        } : {\n          prefix: baseUrl.prefix,\n          resource: dep,\n          suffix: baseUrl.suffix\n        };\n      };\n      var addComponents = function (pluginName, scripts) {\n        var pluginUrl = _this.urls[pluginName];\n        each(scripts, function (script) {\n          ScriptLoader.ScriptLoader.add(pluginUrl + '/' + script);\n        });\n      };\n      var loadDependencies = function (name, addOnUrl, success, scope) {\n        var deps = dependencies(name);\n        each(deps, function (dep) {\n          var newUrl = createUrl(addOnUrl, dep);\n          load(newUrl.resource, newUrl, undefined, undefined);\n        });\n        if (success) {\n          if (scope) {\n            success.call(scope);\n          } else {\n            success.call(ScriptLoader);\n          }\n        }\n      };\n      var load = function (name, addOnUrl, success, scope, failure) {\n        if (urls[name]) {\n          return;\n        }\n        var urlString = typeof addOnUrl === 'string' ? addOnUrl : addOnUrl.prefix + addOnUrl.resource + addOnUrl.suffix;\n        if (urlString.indexOf('/') !== 0 && urlString.indexOf('://') === -1) {\n          urlString = AddOnManager.baseURL + '/' + urlString;\n        }\n        urls[name] = urlString.substring(0, urlString.lastIndexOf('/'));\n        var done = function () {\n          runListeners(name, 'loaded');\n          loadDependencies(name, addOnUrl, success, scope);\n        };\n        if (lookup[name]) {\n          done();\n        } else {\n          ScriptLoader.ScriptLoader.add(urlString, done, scope, failure);\n        }\n      };\n      var waitFor = function (name, callback, state) {\n        if (state === void 0) {\n          state = 'added';\n        }\n        if (has(lookup, name) && state === 'added') {\n          callback();\n        } else if (has(urls, name) && state === 'loaded') {\n          callback();\n        } else {\n          _listeners.push({\n            name: name,\n            state: state,\n            callback: callback\n          });\n        }\n      };\n      return {\n        items: items,\n        urls: urls,\n        lookup: lookup,\n        _listeners: _listeners,\n        get: get,\n        dependencies: dependencies,\n        requireLangPack: requireLangPack,\n        add: add,\n        remove: remove,\n        createUrl: createUrl,\n        addComponents: addComponents,\n        load: load,\n        waitFor: waitFor\n      };\n    }\n    (function (AddOnManager) {\n      AddOnManager.PluginManager = AddOnManager();\n      AddOnManager.ThemeManager = AddOnManager();\n    }(AddOnManager || (AddOnManager = {})));\n    var AddOnManager$1 = AddOnManager;\n\n    var first = function (fn, rate) {\n      var timer = null;\n      var cancel = function () {\n        if (timer !== null) {\n          clearTimeout(timer);\n          timer = null;\n        }\n      };\n      var throttle = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n          args[_i] = arguments[_i];\n        }\n        if (timer === null) {\n          timer = setTimeout(function () {\n            fn.apply(null, args);\n            timer = null;\n          }, rate);\n        }\n      };\n      return {\n        cancel: cancel,\n        throttle: throttle\n      };\n    };\n    var last$2 = function (fn, rate) {\n      var timer = null;\n      var cancel = function () {\n        if (timer !== null) {\n          clearTimeout(timer);\n          timer = null;\n        }\n      };\n      var throttle = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n          args[_i] = arguments[_i];\n        }\n        if (timer !== null) {\n          clearTimeout(timer);\n        }\n        timer = setTimeout(function () {\n          fn.apply(null, args);\n          timer = null;\n        }, rate);\n      };\n      return {\n        cancel: cancel,\n        throttle: throttle\n      };\n    };\n\n    var read = function (element, attr) {\n      var value = get$3(element, attr);\n      return value === undefined || value === '' ? [] : value.split(' ');\n    };\n    var add$1 = function (element, attr, id) {\n      var old = read(element, attr);\n      var nu = old.concat([id]);\n      set(element, attr, nu.join(' '));\n      return true;\n    };\n    var remove$2 = function (element, attr, id) {\n      var nu = filter(read(element, attr), function (v) {\n        return v !== id;\n      });\n      if (nu.length > 0) {\n        set(element, attr, nu.join(' '));\n      } else {\n        remove$1(element, attr);\n      }\n      return false;\n    };\n\n    var supports = function (element) {\n      return element.dom.classList !== undefined;\n    };\n    var get$5 = function (element) {\n      return read(element, 'class');\n    };\n    var add$2 = function (element, clazz) {\n      return add$1(element, 'class', clazz);\n    };\n    var remove$3 = function (element, clazz) {\n      return remove$2(element, 'class', clazz);\n    };\n\n    var add$3 = function (element, clazz) {\n      if (supports(element)) {\n        element.dom.classList.add(clazz);\n      } else {\n        add$2(element, clazz);\n      }\n    };\n    var cleanClass = function (element) {\n      var classList = supports(element) ? element.dom.classList : get$5(element);\n      if (classList.length === 0) {\n        remove$1(element, 'class');\n      }\n    };\n    var remove$4 = function (element, clazz) {\n      if (supports(element)) {\n        var classList = element.dom.classList;\n        classList.remove(clazz);\n      } else {\n        remove$3(element, clazz);\n      }\n      cleanClass(element);\n    };\n    var has$2 = function (element, clazz) {\n      return supports(element) && element.dom.classList.contains(clazz);\n    };\n\n    var descendants = function (scope, predicate) {\n      var result = [];\n      each(children(scope), function (x) {\n        if (predicate(x)) {\n          result = result.concat([x]);\n        }\n        result = result.concat(descendants(x, predicate));\n      });\n      return result;\n    };\n\n    var descendants$1 = function (scope, selector) {\n      return all(selector, scope);\n    };\n\n    var annotation = constant('mce-annotation');\n    var dataAnnotation = constant('data-mce-annotation');\n    var dataAnnotationId = constant('data-mce-annotation-uid');\n\n    var identify = function (editor, annotationName) {\n      var rng = editor.selection.getRng();\n      var start = SugarElement.fromDom(rng.startContainer);\n      var root = SugarElement.fromDom(editor.getBody());\n      var selector = annotationName.fold(function () {\n        return '.' + annotation();\n      }, function (an) {\n        return '[' + dataAnnotation() + '=\"' + an + '\"]';\n      });\n      var newStart = child(start, rng.startOffset).getOr(start);\n      var closest = closest$1(newStart, selector, function (n) {\n        return eq$2(n, root);\n      });\n      var getAttr = function (c, property) {\n        if (has$1(c, property)) {\n          return Optional.some(get$3(c, property));\n        } else {\n          return Optional.none();\n        }\n      };\n      return closest.bind(function (c) {\n        return getAttr(c, '' + dataAnnotationId()).bind(function (uid) {\n          return getAttr(c, '' + dataAnnotation()).map(function (name) {\n            var elements = findMarkers(editor, uid);\n            return {\n              uid: uid,\n              name: name,\n              elements: elements\n            };\n          });\n        });\n      });\n    };\n    var isAnnotation = function (elem) {\n      return isElement(elem) && has$2(elem, annotation());\n    };\n    var findMarkers = function (editor, uid) {\n      var body = SugarElement.fromDom(editor.getBody());\n      return descendants$1(body, '[' + dataAnnotationId() + '=\"' + uid + '\"]');\n    };\n    var findAll = function (editor, name) {\n      var body = SugarElement.fromDom(editor.getBody());\n      var markers = descendants$1(body, '[' + dataAnnotation() + '=\"' + name + '\"]');\n      var directory = {};\n      each(markers, function (m) {\n        var uid = get$3(m, dataAnnotationId());\n        var nodesAlready = directory.hasOwnProperty(uid) ? directory[uid] : [];\n        directory[uid] = nodesAlready.concat([m]);\n      });\n      return directory;\n    };\n\n    var setup = function (editor, _registry) {\n      var changeCallbacks = Cell({});\n      var initData = function () {\n        return {\n          listeners: [],\n          previous: Cell(Optional.none())\n        };\n      };\n      var withCallbacks = function (name, f) {\n        updateCallbacks(name, function (data) {\n          f(data);\n          return data;\n        });\n      };\n      var updateCallbacks = function (name, f) {\n        var callbackMap = changeCallbacks.get();\n        var data = callbackMap.hasOwnProperty(name) ? callbackMap[name] : initData();\n        var outputData = f(data);\n        callbackMap[name] = outputData;\n        changeCallbacks.set(callbackMap);\n      };\n      var fireCallbacks = function (name, uid, elements) {\n        withCallbacks(name, function (data) {\n          each(data.listeners, function (f) {\n            return f(true, name, {\n              uid: uid,\n              nodes: map(elements, function (elem) {\n                return elem.dom;\n              })\n            });\n          });\n        });\n      };\n      var fireNoAnnotation = function (name) {\n        withCallbacks(name, function (data) {\n          each(data.listeners, function (f) {\n            return f(false, name);\n          });\n        });\n      };\n      var onNodeChange = last$2(function () {\n        var callbackMap = changeCallbacks.get();\n        var annotations = sort$1(keys(callbackMap));\n        each(annotations, function (name) {\n          updateCallbacks(name, function (data) {\n            var prev = data.previous.get();\n            identify(editor, Optional.some(name)).fold(function () {\n              if (prev.isSome()) {\n                fireNoAnnotation(name);\n                data.previous.set(Optional.none());\n              }\n            }, function (_a) {\n              var uid = _a.uid, name = _a.name, elements = _a.elements;\n              if (!prev.is(uid)) {\n                fireCallbacks(name, uid, elements);\n                data.previous.set(Optional.some(uid));\n              }\n            });\n            return {\n              previous: data.previous,\n              listeners: data.listeners\n            };\n          });\n        });\n      }, 30);\n      editor.on('remove', function () {\n        onNodeChange.cancel();\n      });\n      editor.on('NodeChange', function () {\n        onNodeChange.throttle();\n      });\n      var addListener = function (name, f) {\n        updateCallbacks(name, function (data) {\n          return {\n            previous: data.previous,\n            listeners: data.listeners.concat([f])\n          };\n        });\n      };\n      return { addListener: addListener };\n    };\n\n    var setup$1 = function (editor, registry) {\n      var identifyParserNode = function (span) {\n        return Optional.from(span.attr(dataAnnotation())).bind(registry.lookup);\n      };\n      editor.on('init', function () {\n        editor.serializer.addNodeFilter('span', function (spans) {\n          each(spans, function (span) {\n            identifyParserNode(span).each(function (settings) {\n              if (settings.persistent === false) {\n                span.unwrap();\n              }\n            });\n          });\n        });\n      });\n    };\n\n    var create$2 = function () {\n      var annotations = {};\n      var register = function (name, settings) {\n        annotations[name] = {\n          name: name,\n          settings: settings\n        };\n      };\n      var lookup = function (name) {\n        return annotations.hasOwnProperty(name) ? Optional.from(annotations[name]).map(function (a) {\n          return a.settings;\n        }) : Optional.none();\n      };\n      return {\n        register: register,\n        lookup: lookup\n      };\n    };\n\n    var unique = 0;\n    var generate$1 = function (prefix) {\n      var date = new Date();\n      var time = date.getTime();\n      var random = Math.floor(Math.random() * 1000000000);\n      unique++;\n      return prefix + '_' + random + unique + String(time);\n    };\n\n    var add$4 = function (element, classes) {\n      each(classes, function (x) {\n        add$3(element, x);\n      });\n    };\n\n    var fromHtml$1 = function (html, scope) {\n      var doc = scope || document;\n      var div = doc.createElement('div');\n      div.innerHTML = html;\n      return children(SugarElement.fromDom(div));\n    };\n\n    var get$6 = function (element) {\n      return element.dom.innerHTML;\n    };\n    var set$1 = function (element, content) {\n      var owner$1 = owner(element);\n      var docDom = owner$1.dom;\n      var fragment = SugarElement.fromDom(docDom.createDocumentFragment());\n      var contentElements = fromHtml$1(content, docDom);\n      append$1(fragment, contentElements);\n      empty(element);\n      append(element, fragment);\n    };\n\n    var clone$1 = function (original, isDeep) {\n      return SugarElement.fromDom(original.dom.cloneNode(isDeep));\n    };\n    var shallow = function (original) {\n      return clone$1(original, false);\n    };\n    var deep = function (original) {\n      return clone$1(original, true);\n    };\n\n    var TextWalker = function (startNode, rootNode, isBoundary) {\n      if (isBoundary === void 0) {\n        isBoundary = never;\n      }\n      var walker = new DomTreeWalker(startNode, rootNode);\n      var walk = function (direction) {\n        var next;\n        do {\n          next = walker[direction]();\n        } while (next && !isText$1(next) && !isBoundary(next));\n        return Optional.from(next).filter(isText$1);\n      };\n      return {\n        current: function () {\n          return Optional.from(walker.current()).filter(isText$1);\n        },\n        next: function () {\n          return walk('next');\n        },\n        prev: function () {\n          return walk('prev');\n        },\n        prev2: function () {\n          return walk('prev2');\n        }\n      };\n    };\n\n    var TextSeeker = function (dom, isBoundary) {\n      var isBlockBoundary = isBoundary ? isBoundary : function (node) {\n        return dom.isBlock(node) || isBr(node) || isContentEditableFalse(node);\n      };\n      var walk = function (node, offset, walker, process) {\n        if (isText$1(node)) {\n          var newOffset = process(node, offset, node.data);\n          if (newOffset !== -1) {\n            return Optional.some({\n              container: node,\n              offset: newOffset\n            });\n          }\n        }\n        return walker().bind(function (next) {\n          return walk(next.container, next.offset, walker, process);\n        });\n      };\n      var backwards = function (node, offset, process, root) {\n        var walker = TextWalker(node, root, isBlockBoundary);\n        return walk(node, offset, function () {\n          return walker.prev().map(function (prev) {\n            return {\n              container: prev,\n              offset: prev.length\n            };\n          });\n        }, process).getOrNull();\n      };\n      var forwards = function (node, offset, process, root) {\n        var walker = TextWalker(node, root, isBlockBoundary);\n        return walk(node, offset, function () {\n          return walker.next().map(function (next) {\n            return {\n              container: next,\n              offset: 0\n            };\n          });\n        }, process).getOrNull();\n      };\n      return {\n        backwards: backwards,\n        forwards: forwards\n      };\n    };\n\n    var cat = function (arr) {\n      var r = [];\n      var push = function (x) {\n        r.push(x);\n      };\n      for (var i = 0; i < arr.length; i++) {\n        arr[i].each(push);\n      }\n      return r;\n    };\n    var lift2 = function (oa, ob, f) {\n      return oa.isSome() && ob.isSome() ? Optional.some(f(oa.getOrDie(), ob.getOrDie())) : Optional.none();\n    };\n    var lift3 = function (oa, ob, oc, f) {\n      return oa.isSome() && ob.isSome() && oc.isSome() ? Optional.some(f(oa.getOrDie(), ob.getOrDie(), oc.getOrDie())) : Optional.none();\n    };\n    var someIf = function (b, a) {\n      return b ? Optional.some(a) : Optional.none();\n    };\n\n    var round = Math.round;\n    var clone$2 = function (rect) {\n      if (!rect) {\n        return {\n          left: 0,\n          top: 0,\n          bottom: 0,\n          right: 0,\n          width: 0,\n          height: 0\n        };\n      }\n      return {\n        left: round(rect.left),\n        top: round(rect.top),\n        bottom: round(rect.bottom),\n        right: round(rect.right),\n        width: round(rect.width),\n        height: round(rect.height)\n      };\n    };\n    var collapse = function (rect, toStart) {\n      rect = clone$2(rect);\n      if (toStart) {\n        rect.right = rect.left;\n      } else {\n        rect.left = rect.left + rect.width;\n        rect.right = rect.left;\n      }\n      rect.width = 0;\n      return rect;\n    };\n    var isEqual = function (rect1, rect2) {\n      return rect1.left === rect2.left && rect1.top === rect2.top && rect1.bottom === rect2.bottom && rect1.right === rect2.right;\n    };\n    var isValidOverflow = function (overflowY, rect1, rect2) {\n      return overflowY >= 0 && overflowY <= Math.min(rect1.height, rect2.height) / 2;\n    };\n    var isAbove = function (rect1, rect2) {\n      var halfHeight = Math.min(rect2.height / 2, rect1.height / 2);\n      if (rect1.bottom - halfHeight < rect2.top) {\n        return true;\n      }\n      if (rect1.top > rect2.bottom) {\n        return false;\n      }\n      return isValidOverflow(rect2.top - rect1.bottom, rect1, rect2);\n    };\n    var isBelow = function (rect1, rect2) {\n      if (rect1.top > rect2.bottom) {\n        return true;\n      }\n      if (rect1.bottom < rect2.top) {\n        return false;\n      }\n      return isValidOverflow(rect2.bottom - rect1.top, rect1, rect2);\n    };\n    var containsXY = function (rect, clientX, clientY) {\n      return clientX >= rect.left && clientX <= rect.right && clientY >= rect.top && clientY <= rect.bottom;\n    };\n\n    var getSelectedNode = function (range) {\n      var startContainer = range.startContainer, startOffset = range.startOffset;\n      if (startContainer.hasChildNodes() && range.endOffset === startOffset + 1) {\n        return startContainer.childNodes[startOffset];\n      }\n      return null;\n    };\n    var getNode = function (container, offset) {\n      if (container.nodeType === 1 && container.hasChildNodes()) {\n        if (offset >= container.childNodes.length) {\n          offset = container.childNodes.length - 1;\n        }\n        container = container.childNodes[offset];\n      }\n      return container;\n    };\n\n    var extendingChars = new RegExp('[\\u0300-\\u036f\\u0483-\\u0487\\u0488-\\u0489\\u0591-\\u05bd\\u05bf\\u05c1-\\u05c2\\u05c4-\\u05c5\\u05c7\\u0610-\\u061a' + '\\u064b-\\u065f\\u0670\\u06d6-\\u06dc\\u06df-\\u06e4\\u06e7-\\u06e8\\u06ea-\\u06ed\\u0711\\u0730-\\u074a\\u07a6-\\u07b0' + '\\u07eb-\\u07f3\\u0816-\\u0819\\u081b-\\u0823\\u0825-\\u0827\\u0829-\\u082d\\u0859-\\u085b\\u08e3-\\u0902\\u093a\\u093c' + '\\u0941-\\u0948\\u094d\\u0951-\\u0957\\u0962-\\u0963\\u0981\\u09bc\\u09be\\u09c1-\\u09c4\\u09cd\\u09d7\\u09e2-\\u09e3' + '\\u0a01-\\u0a02\\u0a3c\\u0a41-\\u0a42\\u0a47-\\u0a48\\u0a4b-\\u0a4d\\u0a51\\u0a70-\\u0a71\\u0a75\\u0a81-\\u0a82\\u0abc' + '\\u0ac1-\\u0ac5\\u0ac7-\\u0ac8\\u0acd\\u0ae2-\\u0ae3\\u0b01\\u0b3c\\u0b3e\\u0b3f\\u0b41-\\u0b44\\u0b4d\\u0b56\\u0b57' + '\\u0b62-\\u0b63\\u0b82\\u0bbe\\u0bc0\\u0bcd\\u0bd7\\u0c00\\u0c3e-\\u0c40\\u0c46-\\u0c48\\u0c4a-\\u0c4d\\u0c55-\\u0c56' + '\\u0c62-\\u0c63\\u0c81\\u0cbc\\u0cbf\\u0cc2\\u0cc6\\u0ccc-\\u0ccd\\u0cd5-\\u0cd6\\u0ce2-\\u0ce3\\u0d01\\u0d3e\\u0d41-\\u0d44' + '\\u0d4d\\u0d57\\u0d62-\\u0d63\\u0dca\\u0dcf\\u0dd2-\\u0dd4\\u0dd6\\u0ddf\\u0e31\\u0e34-\\u0e3a\\u0e47-\\u0e4e\\u0eb1\\u0eb4-\\u0eb9' + '\\u0ebb-\\u0ebc\\u0ec8-\\u0ecd\\u0f18-\\u0f19\\u0f35\\u0f37\\u0f39\\u0f71-\\u0f7e\\u0f80-\\u0f84\\u0f86-\\u0f87\\u0f8d-\\u0f97' + '\\u0f99-\\u0fbc\\u0fc6\\u102d-\\u1030\\u1032-\\u1037\\u1039-\\u103a\\u103d-\\u103e\\u1058-\\u1059\\u105e-\\u1060\\u1071-\\u1074' + '\\u1082\\u1085-\\u1086\\u108d\\u109d\\u135d-\\u135f\\u1712-\\u1714\\u1732-\\u1734\\u1752-\\u1753\\u1772-\\u1773\\u17b4-\\u17b5' + '\\u17b7-\\u17bd\\u17c6\\u17c9-\\u17d3\\u17dd\\u180b-\\u180d\\u18a9\\u1920-\\u1922\\u1927-\\u1928\\u1932\\u1939-\\u193b\\u1a17-\\u1a18' + '\\u1a1b\\u1a56\\u1a58-\\u1a5e\\u1a60\\u1a62\\u1a65-\\u1a6c\\u1a73-\\u1a7c\\u1a7f\\u1ab0-\\u1abd\\u1ABE\\u1b00-\\u1b03\\u1b34' + '\\u1b36-\\u1b3a\\u1b3c\\u1b42\\u1b6b-\\u1b73\\u1b80-\\u1b81\\u1ba2-\\u1ba5\\u1ba8-\\u1ba9\\u1bab-\\u1bad\\u1be6\\u1be8-\\u1be9' + '\\u1bed\\u1bef-\\u1bf1\\u1c2c-\\u1c33\\u1c36-\\u1c37\\u1cd0-\\u1cd2\\u1cd4-\\u1ce0\\u1ce2-\\u1ce8\\u1ced\\u1cf4\\u1cf8-\\u1cf9' + '\\u1dc0-\\u1df5\\u1dfc-\\u1dff\\u200c-\\u200d\\u20d0-\\u20dc\\u20DD-\\u20E0\\u20e1\\u20E2-\\u20E4\\u20e5-\\u20f0\\u2cef-\\u2cf1' + '\\u2d7f\\u2de0-\\u2dff\\u302a-\\u302d\\u302e-\\u302f\\u3099-\\u309a\\ua66f\\uA670-\\uA672\\ua674-\\ua67d\\ua69e-\\ua69f\\ua6f0-\\ua6f1' + '\\ua802\\ua806\\ua80b\\ua825-\\ua826\\ua8c4\\ua8e0-\\ua8f1\\ua926-\\ua92d\\ua947-\\ua951\\ua980-\\ua982\\ua9b3\\ua9b6-\\ua9b9\\ua9bc' + '\\ua9e5\\uaa29-\\uaa2e\\uaa31-\\uaa32\\uaa35-\\uaa36\\uaa43\\uaa4c\\uaa7c\\uaab0\\uaab2-\\uaab4\\uaab7-\\uaab8\\uaabe-\\uaabf\\uaac1' + '\\uaaec-\\uaaed\\uaaf6\\uabe5\\uabe8\\uabed\\ufb1e\\ufe00-\\ufe0f\\ufe20-\\ufe2f\\uff9e-\\uff9f]');\n    var isExtendingChar = function (ch) {\n      return typeof ch === 'string' && ch.charCodeAt(0) >= 768 && extendingChars.test(ch);\n    };\n\n    var or = function () {\n      var args = [];\n      for (var _i = 0; _i < arguments.length; _i++) {\n        args[_i] = arguments[_i];\n      }\n      return function (x) {\n        for (var i = 0; i < args.length; i++) {\n          if (args[i](x)) {\n            return true;\n          }\n        }\n        return false;\n      };\n    };\n    var and = function () {\n      var args = [];\n      for (var _i = 0; _i < arguments.length; _i++) {\n        args[_i] = arguments[_i];\n      }\n      return function (x) {\n        for (var i = 0; i < args.length; i++) {\n          if (!args[i](x)) {\n            return false;\n          }\n        }\n        return true;\n      };\n    };\n\n    var isElement$3 = isElement$1;\n    var isCaretCandidate$1 = isCaretCandidate;\n    var isBlock$1 = matchStyleValues('display', 'block table');\n    var isFloated = matchStyleValues('float', 'left right');\n    var isValidElementCaretCandidate = and(isElement$3, isCaretCandidate$1, not(isFloated));\n    var isNotPre = not(matchStyleValues('white-space', 'pre pre-line pre-wrap'));\n    var isText$4 = isText$1;\n    var isBr$3 = isBr;\n    var nodeIndex = DOMUtils$1.nodeIndex;\n    var resolveIndex = getNode;\n    var createRange = function (doc) {\n      return 'createRange' in doc ? doc.createRange() : DOMUtils$1.DOM.createRng();\n    };\n    var isWhiteSpace = function (chr) {\n      return chr && /[\\r\\n\\t ]/.test(chr);\n    };\n    var isRange = function (rng) {\n      return !!rng.setStart && !!rng.setEnd;\n    };\n    var isHiddenWhiteSpaceRange = function (range) {\n      var container = range.startContainer;\n      var offset = range.startOffset;\n      var text;\n      if (isWhiteSpace(range.toString()) && isNotPre(container.parentNode) && isText$1(container)) {\n        text = container.data;\n        if (isWhiteSpace(text[offset - 1]) || isWhiteSpace(text[offset + 1])) {\n          return true;\n        }\n      }\n      return false;\n    };\n    var getBrClientRect = function (brNode) {\n      var doc = brNode.ownerDocument;\n      var rng = createRange(doc);\n      var nbsp$1 = doc.createTextNode(nbsp);\n      var parentNode = brNode.parentNode;\n      parentNode.insertBefore(nbsp$1, brNode);\n      rng.setStart(nbsp$1, 0);\n      rng.setEnd(nbsp$1, 1);\n      var clientRect = clone$2(rng.getBoundingClientRect());\n      parentNode.removeChild(nbsp$1);\n      return clientRect;\n    };\n    var getBoundingClientRectWebKitText = function (rng) {\n      var sc = rng.startContainer;\n      var ec = rng.endContainer;\n      var so = rng.startOffset;\n      var eo = rng.endOffset;\n      if (sc === ec && isText$1(ec) && so === 0 && eo === 1) {\n        var newRng = rng.cloneRange();\n        newRng.setEndAfter(ec);\n        return getBoundingClientRect(newRng);\n      } else {\n        return null;\n      }\n    };\n    var isZeroRect = function (r) {\n      return r.left === 0 && r.right === 0 && r.top === 0 && r.bottom === 0;\n    };\n    var getBoundingClientRect = function (item) {\n      var clientRect;\n      var clientRects = item.getClientRects();\n      if (clientRects.length > 0) {\n        clientRect = clone$2(clientRects[0]);\n      } else {\n        clientRect = clone$2(item.getBoundingClientRect());\n      }\n      if (!isRange(item) && isBr$3(item) && isZeroRect(clientRect)) {\n        return getBrClientRect(item);\n      }\n      if (isZeroRect(clientRect) && isRange(item)) {\n        return getBoundingClientRectWebKitText(item);\n      }\n      return clientRect;\n    };\n    var collapseAndInflateWidth = function (clientRect, toStart) {\n      var newClientRect = collapse(clientRect, toStart);\n      newClientRect.width = 1;\n      newClientRect.right = newClientRect.left + 1;\n      return newClientRect;\n    };\n    var getCaretPositionClientRects = function (caretPosition) {\n      var clientRects = [];\n      var beforeNode, node;\n      var addUniqueAndValidRect = function (clientRect) {\n        if (clientRect.height === 0) {\n          return;\n        }\n        if (clientRects.length > 0) {\n          if (isEqual(clientRect, clientRects[clientRects.length - 1])) {\n            return;\n          }\n        }\n        clientRects.push(clientRect);\n      };\n      var addCharacterOffset = function (container, offset) {\n        var range = createRange(container.ownerDocument);\n        if (offset < container.data.length) {\n          if (isExtendingChar(container.data[offset])) {\n            return clientRects;\n          }\n          if (isExtendingChar(container.data[offset - 1])) {\n            range.setStart(container, offset);\n            range.setEnd(container, offset + 1);\n            if (!isHiddenWhiteSpaceRange(range)) {\n              addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(range), false));\n              return clientRects;\n            }\n          }\n        }\n        if (offset > 0) {\n          range.setStart(container, offset - 1);\n          range.setEnd(container, offset);\n          if (!isHiddenWhiteSpaceRange(range)) {\n            addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(range), false));\n          }\n        }\n        if (offset < container.data.length) {\n          range.setStart(container, offset);\n          range.setEnd(container, offset + 1);\n          if (!isHiddenWhiteSpaceRange(range)) {\n            addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(range), true));\n          }\n        }\n      };\n      if (isText$4(caretPosition.container())) {\n        addCharacterOffset(caretPosition.container(), caretPosition.offset());\n        return clientRects;\n      }\n      if (isElement$3(caretPosition.container())) {\n        if (caretPosition.isAtEnd()) {\n          node = resolveIndex(caretPosition.container(), caretPosition.offset());\n          if (isText$4(node)) {\n            addCharacterOffset(node, node.data.length);\n          }\n          if (isValidElementCaretCandidate(node) && !isBr$3(node)) {\n            addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(node), false));\n          }\n        } else {\n          node = resolveIndex(caretPosition.container(), caretPosition.offset());\n          if (isText$4(node)) {\n            addCharacterOffset(node, 0);\n          }\n          if (isValidElementCaretCandidate(node) && caretPosition.isAtEnd()) {\n            addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(node), false));\n            return clientRects;\n          }\n          beforeNode = resolveIndex(caretPosition.container(), caretPosition.offset() - 1);\n          if (isValidElementCaretCandidate(beforeNode) && !isBr$3(beforeNode)) {\n            if (isBlock$1(beforeNode) || isBlock$1(node) || !isValidElementCaretCandidate(node)) {\n              addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(beforeNode), false));\n            }\n          }\n          if (isValidElementCaretCandidate(node)) {\n            addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(node), true));\n          }\n        }\n      }\n      return clientRects;\n    };\n    function CaretPosition(container, offset, clientRects) {\n      var isAtStart = function () {\n        if (isText$4(container)) {\n          return offset === 0;\n        }\n        return offset === 0;\n      };\n      var isAtEnd = function () {\n        if (isText$4(container)) {\n          return offset >= container.data.length;\n        }\n        return offset >= container.childNodes.length;\n      };\n      var toRange = function () {\n        var range = createRange(container.ownerDocument);\n        range.setStart(container, offset);\n        range.setEnd(container, offset);\n        return range;\n      };\n      var getClientRects = function () {\n        if (!clientRects) {\n          clientRects = getCaretPositionClientRects(CaretPosition(container, offset));\n        }\n        return clientRects;\n      };\n      var isVisible = function () {\n        return getClientRects().length > 0;\n      };\n      var isEqual = function (caretPosition) {\n        return caretPosition && container === caretPosition.container() && offset === caretPosition.offset();\n      };\n      var getNode = function (before) {\n        return resolveIndex(container, before ? offset - 1 : offset);\n      };\n      return {\n        container: constant(container),\n        offset: constant(offset),\n        toRange: toRange,\n        getClientRects: getClientRects,\n        isVisible: isVisible,\n        isAtStart: isAtStart,\n        isAtEnd: isAtEnd,\n        isEqual: isEqual,\n        getNode: getNode\n      };\n    }\n    (function (CaretPosition) {\n      CaretPosition.fromRangeStart = function (range) {\n        return CaretPosition(range.startContainer, range.startOffset);\n      };\n      CaretPosition.fromRangeEnd = function (range) {\n        return CaretPosition(range.endContainer, range.endOffset);\n      };\n      CaretPosition.after = function (node) {\n        return CaretPosition(node.parentNode, nodeIndex(node) + 1);\n      };\n      CaretPosition.before = function (node) {\n        return CaretPosition(node.parentNode, nodeIndex(node));\n      };\n      CaretPosition.isAbove = function (pos1, pos2) {\n        return lift2(head(pos2.getClientRects()), last(pos1.getClientRects()), isAbove).getOr(false);\n      };\n      CaretPosition.isBelow = function (pos1, pos2) {\n        return lift2(last(pos2.getClientRects()), head(pos1.getClientRects()), isBelow).getOr(false);\n      };\n      CaretPosition.isAtStart = function (pos) {\n        return pos ? pos.isAtStart() : false;\n      };\n      CaretPosition.isAtEnd = function (pos) {\n        return pos ? pos.isAtEnd() : false;\n      };\n      CaretPosition.isTextPosition = function (pos) {\n        return pos ? isText$1(pos.container()) : false;\n      };\n      CaretPosition.isElementPosition = function (pos) {\n        return CaretPosition.isTextPosition(pos) === false;\n      };\n    }(CaretPosition || (CaretPosition = {})));\n    var CaretPosition$1 = CaretPosition;\n\n    var trimEmptyTextNode = function (dom, node) {\n      if (isText$1(node) && node.data.length === 0) {\n        dom.remove(node);\n      }\n    };\n    var insertNode = function (dom, rng, node) {\n      rng.insertNode(node);\n      trimEmptyTextNode(dom, node.previousSibling);\n      trimEmptyTextNode(dom, node.nextSibling);\n    };\n    var insertFragment = function (dom, rng, frag) {\n      var firstChild = Optional.from(frag.firstChild);\n      var lastChild = Optional.from(frag.lastChild);\n      rng.insertNode(frag);\n      firstChild.each(function (child) {\n        return trimEmptyTextNode(dom, child.previousSibling);\n      });\n      lastChild.each(function (child) {\n        return trimEmptyTextNode(dom, child.nextSibling);\n      });\n    };\n    var rangeInsertNode = function (dom, rng, node) {\n      if (isDocumentFragment$1(node)) {\n        insertFragment(dom, rng, node);\n      } else {\n        insertNode(dom, rng, node);\n      }\n    };\n\n    var isText$5 = isText$1;\n    var isBogus$2 = isBogus;\n    var nodeIndex$1 = DOMUtils$1.nodeIndex;\n    var normalizedParent = function (node) {\n      var parentNode = node.parentNode;\n      if (isBogus$2(parentNode)) {\n        return normalizedParent(parentNode);\n      }\n      return parentNode;\n    };\n    var getChildNodes = function (node) {\n      if (!node) {\n        return [];\n      }\n      return reduce(node.childNodes, function (result, node) {\n        if (isBogus$2(node) && node.nodeName !== 'BR') {\n          result = result.concat(getChildNodes(node));\n        } else {\n          result.push(node);\n        }\n        return result;\n      }, []);\n    };\n    var normalizedTextOffset = function (node, offset) {\n      while (node = node.previousSibling) {\n        if (!isText$5(node)) {\n          break;\n        }\n        offset += node.data.length;\n      }\n      return offset;\n    };\n    var equal$1 = function (a) {\n      return function (b) {\n        return a === b;\n      };\n    };\n    var normalizedNodeIndex = function (node) {\n      var nodes, index;\n      nodes = getChildNodes(normalizedParent(node));\n      index = findIndex$1(nodes, equal$1(node), node);\n      nodes = nodes.slice(0, index + 1);\n      var numTextFragments = reduce(nodes, function (result, node, i) {\n        if (isText$5(node) && isText$5(nodes[i - 1])) {\n          result++;\n        }\n        return result;\n      }, 0);\n      nodes = filter$2(nodes, matchNodeNames([node.nodeName]));\n      index = findIndex$1(nodes, equal$1(node), node);\n      return index - numTextFragments;\n    };\n    var createPathItem = function (node) {\n      var name;\n      if (isText$5(node)) {\n        name = 'text()';\n      } else {\n        name = node.nodeName.toLowerCase();\n      }\n      return name + '[' + normalizedNodeIndex(node) + ']';\n    };\n    var parentsUntil = function (root, node, predicate) {\n      var parents = [];\n      for (node = node.parentNode; node !== root; node = node.parentNode) {\n        if (predicate && predicate(node)) {\n          break;\n        }\n        parents.push(node);\n      }\n      return parents;\n    };\n    var create$3 = function (root, caretPosition) {\n      var container, offset, path = [], outputOffset, childNodes, parents;\n      container = caretPosition.container();\n      offset = caretPosition.offset();\n      if (isText$5(container)) {\n        outputOffset = normalizedTextOffset(container, offset);\n      } else {\n        childNodes = container.childNodes;\n        if (offset >= childNodes.length) {\n          outputOffset = 'after';\n          offset = childNodes.length - 1;\n        } else {\n          outputOffset = 'before';\n        }\n        container = childNodes[offset];\n      }\n      path.push(createPathItem(container));\n      parents = parentsUntil(root, container);\n      parents = filter$2(parents, not(isBogus));\n      path = path.concat(map$2(parents, function (node) {\n        return createPathItem(node);\n      }));\n      return path.reverse().join('/') + ',' + outputOffset;\n    };\n    var resolvePathItem = function (node, name, index) {\n      var nodes = getChildNodes(node);\n      nodes = filter$2(nodes, function (node, index) {\n        return !isText$5(node) || !isText$5(nodes[index - 1]);\n      });\n      nodes = filter$2(nodes, matchNodeNames([name]));\n      return nodes[index];\n    };\n    var findTextPosition = function (container, offset) {\n      var node = container, targetOffset = 0, dataLen;\n      while (isText$5(node)) {\n        dataLen = node.data.length;\n        if (offset >= targetOffset && offset <= targetOffset + dataLen) {\n          container = node;\n          offset = offset - targetOffset;\n          break;\n        }\n        if (!isText$5(node.nextSibling)) {\n          container = node;\n          offset = dataLen;\n          break;\n        }\n        targetOffset += dataLen;\n        node = node.nextSibling;\n      }\n      if (isText$5(container) && offset > container.data.length) {\n        offset = container.data.length;\n      }\n      return CaretPosition$1(container, offset);\n    };\n    var resolve$1 = function (root, path) {\n      var offset;\n      if (!path) {\n        return null;\n      }\n      var parts = path.split(',');\n      var paths = parts[0].split('/');\n      offset = parts.length > 1 ? parts[1] : 'before';\n      var container = reduce(paths, function (result, value) {\n        var match = /([\\w\\-\\(\\)]+)\\[([0-9]+)\\]/.exec(value);\n        if (!match) {\n          return null;\n        }\n        if (match[1] === 'text()') {\n          match[1] = '#text';\n        }\n        return resolvePathItem(result, match[1], parseInt(match[2], 10));\n      }, root);\n      if (!container) {\n        return null;\n      }\n      if (!isText$5(container)) {\n        if (offset === 'after') {\n          offset = nodeIndex$1(container) + 1;\n        } else {\n          offset = nodeIndex$1(container);\n        }\n        return CaretPosition$1(container.parentNode, offset);\n      }\n      return findTextPosition(container, parseInt(offset, 10));\n    };\n\n    var isContentEditableFalse$2 = isContentEditableFalse;\n    var getNormalizedTextOffset = function (trim, container, offset) {\n      var node, trimmedOffset;\n      trimmedOffset = trim(container.data.slice(0, offset)).length;\n      for (node = container.previousSibling; node && isText$1(node); node = node.previousSibling) {\n        trimmedOffset += trim(node.data).length;\n      }\n      return trimmedOffset;\n    };\n    var getPoint = function (dom, trim, normalized, rng, start) {\n      var container = rng[start ? 'startContainer' : 'endContainer'];\n      var offset = rng[start ? 'startOffset' : 'endOffset'];\n      var point = [];\n      var childNodes, after = 0;\n      var root = dom.getRoot();\n      if (isText$1(container)) {\n        point.push(normalized ? getNormalizedTextOffset(trim, container, offset) : offset);\n      } else {\n        childNodes = container.childNodes;\n        if (offset >= childNodes.length && childNodes.length) {\n          after = 1;\n          offset = Math.max(0, childNodes.length - 1);\n        }\n        point.push(dom.nodeIndex(childNodes[offset], normalized) + after);\n      }\n      for (; container && container !== root; container = container.parentNode) {\n        point.push(dom.nodeIndex(container, normalized));\n      }\n      return point;\n    };\n    var getLocation = function (trim, selection, normalized, rng) {\n      var dom = selection.dom, bookmark = {};\n      bookmark.start = getPoint(dom, trim, normalized, rng, true);\n      if (!selection.isCollapsed()) {\n        bookmark.end = getPoint(dom, trim, normalized, rng, false);\n      }\n      return bookmark;\n    };\n    var findIndex$2 = function (dom, name, element) {\n      var count = 0;\n      Tools.each(dom.select(name), function (node) {\n        if (node.getAttribute('data-mce-bogus') === 'all') {\n          return;\n        }\n        if (node === element) {\n          return false;\n        }\n        count++;\n      });\n      return count;\n    };\n    var moveEndPoint = function (rng, start) {\n      var container, offset, childNodes;\n      var prefix = start ? 'start' : 'end';\n      container = rng[prefix + 'Container'];\n      offset = rng[prefix + 'Offset'];\n      if (isElement$1(container) && container.nodeName === 'TR') {\n        childNodes = container.childNodes;\n        container = childNodes[Math.min(start ? offset : offset - 1, childNodes.length - 1)];\n        if (container) {\n          offset = start ? 0 : container.childNodes.length;\n          rng['set' + (start ? 'Start' : 'End')](container, offset);\n        }\n      }\n    };\n    var normalizeTableCellSelection = function (rng) {\n      moveEndPoint(rng, true);\n      moveEndPoint(rng, false);\n      return rng;\n    };\n    var findSibling = function (node, offset) {\n      var sibling;\n      if (isElement$1(node)) {\n        node = getNode(node, offset);\n        if (isContentEditableFalse$2(node)) {\n          return node;\n        }\n      }\n      if (isCaretContainer(node)) {\n        if (isText$1(node) && isCaretContainerBlock(node)) {\n          node = node.parentNode;\n        }\n        sibling = node.previousSibling;\n        if (isContentEditableFalse$2(sibling)) {\n          return sibling;\n        }\n        sibling = node.nextSibling;\n        if (isContentEditableFalse$2(sibling)) {\n          return sibling;\n        }\n      }\n    };\n    var findAdjacentContentEditableFalseElm = function (rng) {\n      return findSibling(rng.startContainer, rng.startOffset) || findSibling(rng.endContainer, rng.endOffset);\n    };\n    var getOffsetBookmark = function (trim, normalized, selection) {\n      var element = selection.getNode();\n      var name = element ? element.nodeName : null;\n      var rng = selection.getRng();\n      if (isContentEditableFalse$2(element) || name === 'IMG') {\n        return {\n          name: name,\n          index: findIndex$2(selection.dom, name, element)\n        };\n      }\n      var sibling = findAdjacentContentEditableFalseElm(rng);\n      if (sibling) {\n        name = sibling.tagName;\n        return {\n          name: name,\n          index: findIndex$2(selection.dom, name, sibling)\n        };\n      }\n      return getLocation(trim, selection, normalized, rng);\n    };\n    var getCaretBookmark = function (selection) {\n      var rng = selection.getRng();\n      return {\n        start: create$3(selection.dom.getRoot(), CaretPosition$1.fromRangeStart(rng)),\n        end: create$3(selection.dom.getRoot(), CaretPosition$1.fromRangeEnd(rng))\n      };\n    };\n    var getRangeBookmark = function (selection) {\n      return { rng: selection.getRng() };\n    };\n    var createBookmarkSpan = function (dom, id, filled) {\n      var args = {\n        'data-mce-type': 'bookmark',\n        id: id,\n        'style': 'overflow:hidden;line-height:0px'\n      };\n      return filled ? dom.create('span', args, '&#xFEFF;') : dom.create('span', args);\n    };\n    var getPersistentBookmark = function (selection, filled) {\n      var dom = selection.dom;\n      var rng = selection.getRng();\n      var id = dom.uniqueId();\n      var collapsed = selection.isCollapsed();\n      var element = selection.getNode();\n      var name = element.nodeName;\n      if (name === 'IMG') {\n        return {\n          name: name,\n          index: findIndex$2(dom, name, element)\n        };\n      }\n      var rng2 = normalizeTableCellSelection(rng.cloneRange());\n      if (!collapsed) {\n        rng2.collapse(false);\n        var endBookmarkNode = createBookmarkSpan(dom, id + '_end', filled);\n        rangeInsertNode(dom, rng2, endBookmarkNode);\n      }\n      rng = normalizeTableCellSelection(rng);\n      rng.collapse(true);\n      var startBookmarkNode = createBookmarkSpan(dom, id + '_start', filled);\n      rangeInsertNode(dom, rng, startBookmarkNode);\n      selection.moveToBookmark({\n        id: id,\n        keep: true\n      });\n      return { id: id };\n    };\n    var getBookmark = function (selection, type, normalized) {\n      if (type === 2) {\n        return getOffsetBookmark(trim$2, normalized, selection);\n      } else if (type === 3) {\n        return getCaretBookmark(selection);\n      } else if (type) {\n        return getRangeBookmark(selection);\n      } else {\n        return getPersistentBookmark(selection, false);\n      }\n    };\n    var getUndoBookmark = curry(getOffsetBookmark, identity, true);\n\n    var DOM$1 = DOMUtils$1.DOM;\n    var defaultPreviewStyles = 'font-family font-size font-weight font-style text-decoration text-transform color background-color border border-radius outline text-shadow';\n    var getBodySetting = function (editor, name, defaultValue) {\n      var value = editor.getParam(name, defaultValue);\n      if (value.indexOf('=') !== -1) {\n        var bodyObj = editor.getParam(name, '', 'hash');\n        return bodyObj.hasOwnProperty(editor.id) ? bodyObj[editor.id] : defaultValue;\n      } else {\n        return value;\n      }\n    };\n    var getIframeAttrs = function (editor) {\n      return editor.getParam('iframe_attrs', {});\n    };\n    var getDocType = function (editor) {\n      return editor.getParam('doctype', '<!DOCTYPE html>');\n    };\n    var getDocumentBaseUrl = function (editor) {\n      return editor.getParam('document_base_url', '');\n    };\n    var getBodyId = function (editor) {\n      return getBodySetting(editor, 'body_id', 'tinymce');\n    };\n    var getBodyClass = function (editor) {\n      return getBodySetting(editor, 'body_class', '');\n    };\n    var getContentSecurityPolicy = function (editor) {\n      return editor.getParam('content_security_policy', '');\n    };\n    var shouldPutBrInPre = function (editor) {\n      return editor.getParam('br_in_pre', true);\n    };\n    var getForcedRootBlock = function (editor) {\n      if (editor.getParam('force_p_newlines', false)) {\n        return 'p';\n      }\n      var block = editor.getParam('forced_root_block', 'p');\n      if (block === false) {\n        return '';\n      } else if (block === true) {\n        return 'p';\n      } else {\n        return block;\n      }\n    };\n    var getForcedRootBlockAttrs = function (editor) {\n      return editor.getParam('forced_root_block_attrs', {});\n    };\n    var getBrNewLineSelector = function (editor) {\n      return editor.getParam('br_newline_selector', '.mce-toc h2,figcaption,caption');\n    };\n    var getNoNewLineSelector = function (editor) {\n      return editor.getParam('no_newline_selector', '');\n    };\n    var shouldKeepStyles = function (editor) {\n      return editor.getParam('keep_styles', true);\n    };\n    var shouldEndContainerOnEmptyBlock = function (editor) {\n      return editor.getParam('end_container_on_empty_block', false);\n    };\n    var getFontStyleValues = function (editor) {\n      return Tools.explode(editor.getParam('font_size_style_values', 'xx-small,x-small,small,medium,large,x-large,xx-large'));\n    };\n    var getFontSizeClasses = function (editor) {\n      return Tools.explode(editor.getParam('font_size_classes', ''));\n    };\n    var getImagesDataImgFilter = function (editor) {\n      return editor.getParam('images_dataimg_filter', always, 'function');\n    };\n    var isAutomaticUploadsEnabled = function (editor) {\n      return editor.getParam('automatic_uploads', true, 'boolean');\n    };\n    var shouldReuseFileName = function (editor) {\n      return editor.getParam('images_reuse_filename', false, 'boolean');\n    };\n    var shouldReplaceBlobUris = function (editor) {\n      return editor.getParam('images_replace_blob_uris', true, 'boolean');\n    };\n    var getIconPackName = function (editor) {\n      return editor.getParam('icons', '', 'string');\n    };\n    var getIconsUrl = function (editor) {\n      return editor.getParam('icons_url', '', 'string');\n    };\n    var getImageUploadUrl = function (editor) {\n      return editor.getParam('images_upload_url', '', 'string');\n    };\n    var getImageUploadBasePath = function (editor) {\n      return editor.getParam('images_upload_base_path', '', 'string');\n    };\n    var getImagesUploadCredentials = function (editor) {\n      return editor.getParam('images_upload_credentials', false, 'boolean');\n    };\n    var getImagesUploadHandler = function (editor) {\n      return editor.getParam('images_upload_handler', null, 'function');\n    };\n    var shouldUseContentCssCors = function (editor) {\n      return editor.getParam('content_css_cors', false, 'boolean');\n    };\n    var getReferrerPolicy = function (editor) {\n      return editor.getParam('referrer_policy', '', 'string');\n    };\n    var getLanguageCode = function (editor) {\n      return editor.getParam('language', 'en', 'string');\n    };\n    var getLanguageUrl = function (editor) {\n      return editor.getParam('language_url', '', 'string');\n    };\n    var shouldIndentUseMargin = function (editor) {\n      return editor.getParam('indent_use_margin', false);\n    };\n    var getIndentation = function (editor) {\n      return editor.getParam('indentation', '40px', 'string');\n    };\n    var getContentCss = function (editor) {\n      var contentCss = editor.getParam('content_css');\n      if (isString(contentCss)) {\n        return map(contentCss.split(','), trim);\n      } else if (isArray(contentCss)) {\n        return contentCss;\n      } else if (contentCss === false || editor.inline) {\n        return [];\n      } else {\n        return ['default'];\n      }\n    };\n    var getDirectionality = function (editor) {\n      return editor.getParam('directionality', I18n.isRtl() ? 'rtl' : undefined);\n    };\n    var getInlineBoundarySelector = function (editor) {\n      return editor.getParam('inline_boundaries_selector', 'a[href],code,.mce-annotation', 'string');\n    };\n    var getObjectResizing = function (editor) {\n      var selector = editor.getParam('object_resizing');\n      if (selector === false || Env.iOS) {\n        return false;\n      } else {\n        return isString(selector) ? selector : 'table,img,figure.image,div';\n      }\n    };\n    var getResizeImgProportional = function (editor) {\n      return editor.getParam('resize_img_proportional', true, 'boolean');\n    };\n    var getPlaceholder = function (editor) {\n      return editor.getParam('placeholder', DOM$1.getAttrib(editor.getElement(), 'placeholder'), 'string');\n    };\n    var getEventRoot = function (editor) {\n      return editor.getParam('event_root');\n    };\n    var getServiceMessage = function (editor) {\n      return editor.getParam('service_message');\n    };\n    var getTheme = function (editor) {\n      return editor.getParam('theme');\n    };\n    var shouldValidate = function (editor) {\n      return editor.getParam('validate');\n    };\n    var isInlineBoundariesEnabled = function (editor) {\n      return editor.getParam('inline_boundaries') !== false;\n    };\n    var getFormats = function (editor) {\n      return editor.getParam('formats');\n    };\n    var getPreviewStyles = function (editor) {\n      var style = editor.getParam('preview_styles', defaultPreviewStyles);\n      if (isString(style)) {\n        return style;\n      } else {\n        return '';\n      }\n    };\n    var getCustomUiSelector = function (editor) {\n      return editor.getParam('custom_ui_selector', '', 'string');\n    };\n    var getThemeUrl = function (editor) {\n      return editor.getParam('theme_url');\n    };\n    var isInline$1 = function (editor) {\n      return editor.getParam('inline');\n    };\n    var hasHiddenInput = function (editor) {\n      return editor.getParam('hidden_input');\n    };\n    var shouldPatchSubmit = function (editor) {\n      return editor.getParam('submit_patch');\n    };\n    var isEncodingXml = function (editor) {\n      return editor.getParam('encoding') === 'xml';\n    };\n    var shouldAddFormSubmitTrigger = function (editor) {\n      return editor.getParam('add_form_submit_trigger');\n    };\n    var shouldAddUnloadTrigger = function (editor) {\n      return editor.getParam('add_unload_trigger');\n    };\n    var hasForcedRootBlock = function (editor) {\n      return getForcedRootBlock(editor) !== '';\n    };\n    var getCustomUndoRedoLevels = function (editor) {\n      return editor.getParam('custom_undo_redo_levels', 0, 'number');\n    };\n    var shouldDisableNodeChange = function (editor) {\n      return editor.getParam('disable_nodechange');\n    };\n    var isReadOnly = function (editor) {\n      return editor.getParam('readonly');\n    };\n    var hasContentCssCors = function (editor) {\n      return editor.getParam('content_css_cors');\n    };\n    var getPlugins = function (editor) {\n      return editor.getParam('plugins', '', 'string');\n    };\n    var getExternalPlugins = function (editor) {\n      return editor.getParam('external_plugins');\n    };\n    var shouldBlockUnsupportedDrop = function (editor) {\n      return editor.getParam('block_unsupported_drop', true, 'boolean');\n    };\n\n    var isElement$4 = isElement$1;\n    var isText$6 = isText$1;\n    var removeNode = function (node) {\n      var parentNode = node.parentNode;\n      if (parentNode) {\n        parentNode.removeChild(node);\n      }\n    };\n    var trimCount = function (text) {\n      var trimmedText = trim$2(text);\n      return {\n        count: text.length - trimmedText.length,\n        text: trimmedText\n      };\n    };\n    var deleteZwspChars = function (caretContainer) {\n      var idx;\n      while ((idx = caretContainer.data.lastIndexOf(ZWSP)) !== -1) {\n        caretContainer.deleteData(idx, 1);\n      }\n    };\n    var removeUnchanged = function (caretContainer, pos) {\n      remove$5(caretContainer);\n      return pos;\n    };\n    var removeTextAndReposition = function (caretContainer, pos) {\n      var before = trimCount(caretContainer.data.substr(0, pos.offset()));\n      var after = trimCount(caretContainer.data.substr(pos.offset()));\n      var text = before.text + after.text;\n      if (text.length > 0) {\n        deleteZwspChars(caretContainer);\n        return CaretPosition$1(caretContainer, pos.offset() - before.count);\n      } else {\n        return pos;\n      }\n    };\n    var removeElementAndReposition = function (caretContainer, pos) {\n      var parentNode = pos.container();\n      var newPosition = indexOf(from$1(parentNode.childNodes), caretContainer).map(function (index) {\n        return index < pos.offset() ? CaretPosition$1(parentNode, pos.offset() - 1) : pos;\n      }).getOr(pos);\n      remove$5(caretContainer);\n      return newPosition;\n    };\n    var removeTextCaretContainer = function (caretContainer, pos) {\n      return isText$6(caretContainer) && pos.container() === caretContainer ? removeTextAndReposition(caretContainer, pos) : removeUnchanged(caretContainer, pos);\n    };\n    var removeElementCaretContainer = function (caretContainer, pos) {\n      return pos.container() === caretContainer.parentNode ? removeElementAndReposition(caretContainer, pos) : removeUnchanged(caretContainer, pos);\n    };\n    var removeAndReposition = function (container, pos) {\n      return CaretPosition$1.isTextPosition(pos) ? removeTextCaretContainer(container, pos) : removeElementCaretContainer(container, pos);\n    };\n    var remove$5 = function (caretContainerNode) {\n      if (isElement$4(caretContainerNode) && isCaretContainer(caretContainerNode)) {\n        if (hasContent(caretContainerNode)) {\n          caretContainerNode.removeAttribute('data-mce-caret');\n        } else {\n          removeNode(caretContainerNode);\n        }\n      }\n      if (isText$6(caretContainerNode)) {\n        deleteZwspChars(caretContainerNode);\n        if (caretContainerNode.data.length === 0) {\n          removeNode(caretContainerNode);\n        }\n      }\n    };\n\n    var browser$2 = detect$3().browser;\n    var isContentEditableFalse$3 = isContentEditableFalse;\n    var isMedia$1 = isMedia;\n    var isTableCell$2 = isTableCell;\n    var inlineFakeCaretSelector = '*[contentEditable=false],video,audio,embed,object';\n    var getAbsoluteClientRect = function (root, element, before) {\n      var clientRect = collapse(element.getBoundingClientRect(), before);\n      var docElm, scrollX, scrollY, margin, rootRect;\n      if (root.tagName === 'BODY') {\n        docElm = root.ownerDocument.documentElement;\n        scrollX = root.scrollLeft || docElm.scrollLeft;\n        scrollY = root.scrollTop || docElm.scrollTop;\n      } else {\n        rootRect = root.getBoundingClientRect();\n        scrollX = root.scrollLeft - rootRect.left;\n        scrollY = root.scrollTop - rootRect.top;\n      }\n      clientRect.left += scrollX;\n      clientRect.right += scrollX;\n      clientRect.top += scrollY;\n      clientRect.bottom += scrollY;\n      clientRect.width = 1;\n      margin = element.offsetWidth - element.clientWidth;\n      if (margin > 0) {\n        if (before) {\n          margin *= -1;\n        }\n        clientRect.left += margin;\n        clientRect.right += margin;\n      }\n      return clientRect;\n    };\n    var trimInlineCaretContainers = function (root) {\n      var fakeCaretTargetNodes = descendants$1(SugarElement.fromDom(root), inlineFakeCaretSelector);\n      for (var i = 0; i < fakeCaretTargetNodes.length; i++) {\n        var node = fakeCaretTargetNodes[i].dom;\n        var sibling = node.previousSibling;\n        if (endsWithCaretContainer(sibling)) {\n          var data = sibling.data;\n          if (data.length === 1) {\n            sibling.parentNode.removeChild(sibling);\n          } else {\n            sibling.deleteData(data.length - 1, 1);\n          }\n        }\n        sibling = node.nextSibling;\n        if (startsWithCaretContainer(sibling)) {\n          var data = sibling.data;\n          if (data.length === 1) {\n            sibling.parentNode.removeChild(sibling);\n          } else {\n            sibling.deleteData(0, 1);\n          }\n        }\n      }\n    };\n    var FakeCaret = function (editor, root, isBlock, hasFocus) {\n      var lastVisualCaret = Cell(Optional.none());\n      var cursorInterval, caretContainerNode;\n      var rootBlock = getForcedRootBlock(editor);\n      var caretBlock = rootBlock.length > 0 ? rootBlock : 'p';\n      var show = function (before, element) {\n        var clientRect, rng;\n        hide();\n        if (isTableCell$2(element)) {\n          return null;\n        }\n        if (isBlock(element)) {\n          caretContainerNode = insertBlock(caretBlock, element, before);\n          clientRect = getAbsoluteClientRect(root, element, before);\n          DomQuery(caretContainerNode).css('top', clientRect.top);\n          var caret = DomQuery('<div class=\"mce-visual-caret\" data-mce-bogus=\"all\"></div>').css(clientRect).appendTo(root)[0];\n          lastVisualCaret.set(Optional.some({\n            caret: caret,\n            element: element,\n            before: before\n          }));\n          lastVisualCaret.get().each(function (caretState) {\n            if (before) {\n              DomQuery(caretState.caret).addClass('mce-visual-caret-before');\n            }\n          });\n          startBlink();\n          rng = element.ownerDocument.createRange();\n          rng.setStart(caretContainerNode, 0);\n          rng.setEnd(caretContainerNode, 0);\n        } else {\n          caretContainerNode = insertInline(element, before);\n          rng = element.ownerDocument.createRange();\n          if (isInlineFakeCaretTarget(caretContainerNode.nextSibling)) {\n            rng.setStart(caretContainerNode, 0);\n            rng.setEnd(caretContainerNode, 0);\n          } else {\n            rng.setStart(caretContainerNode, 1);\n            rng.setEnd(caretContainerNode, 1);\n          }\n          return rng;\n        }\n        return rng;\n      };\n      var hide = function () {\n        trimInlineCaretContainers(root);\n        if (caretContainerNode) {\n          remove$5(caretContainerNode);\n          caretContainerNode = null;\n        }\n        lastVisualCaret.get().each(function (caretState) {\n          DomQuery(caretState.caret).remove();\n          lastVisualCaret.set(Optional.none());\n        });\n        if (cursorInterval) {\n          Delay.clearInterval(cursorInterval);\n          cursorInterval = null;\n        }\n      };\n      var startBlink = function () {\n        cursorInterval = Delay.setInterval(function () {\n          if (hasFocus()) {\n            DomQuery('div.mce-visual-caret', root).toggleClass('mce-visual-caret-hidden');\n          } else {\n            DomQuery('div.mce-visual-caret', root).addClass('mce-visual-caret-hidden');\n          }\n        }, 500);\n      };\n      var reposition = function () {\n        lastVisualCaret.get().each(function (caretState) {\n          var clientRect = getAbsoluteClientRect(root, caretState.element, caretState.before);\n          DomQuery(caretState.caret).css(__assign({}, clientRect));\n        });\n      };\n      var destroy = function () {\n        return Delay.clearInterval(cursorInterval);\n      };\n      var getCss = function () {\n        return '.mce-visual-caret {' + 'position: absolute;' + 'background-color: black;' + 'background-color: currentcolor;' + '}' + '.mce-visual-caret-hidden {' + 'display: none;' + '}' + '*[data-mce-caret] {' + 'position: absolute;' + 'left: -1000px;' + 'right: auto;' + 'top: 0;' + 'margin: 0;' + 'padding: 0;' + '}';\n      };\n      return {\n        show: show,\n        hide: hide,\n        getCss: getCss,\n        reposition: reposition,\n        destroy: destroy\n      };\n    };\n    var isFakeCaretTableBrowser = function () {\n      return browser$2.isIE() || browser$2.isEdge() || browser$2.isFirefox();\n    };\n    var isInlineFakeCaretTarget = function (node) {\n      return isContentEditableFalse$3(node) || isMedia$1(node);\n    };\n    var isFakeCaretTarget = function (node) {\n      return isInlineFakeCaretTarget(node) || isTable(node) && isFakeCaretTableBrowser();\n    };\n\n    var isContentEditableFalse$4 = isContentEditableFalse;\n    var isMedia$2 = isMedia;\n    var isBlockLike = matchStyleValues('display', 'block table table-cell table-caption list-item');\n    var isCaretContainer$2 = isCaretContainer;\n    var isCaretContainerBlock$1 = isCaretContainerBlock;\n    var isElement$5 = isElement$1;\n    var isCaretCandidate$2 = isCaretCandidate;\n    var isForwards = function (direction) {\n      return direction > 0;\n    };\n    var isBackwards = function (direction) {\n      return direction < 0;\n    };\n    var skipCaretContainers = function (walk, shallow) {\n      var node;\n      while (node = walk(shallow)) {\n        if (!isCaretContainerBlock$1(node)) {\n          return node;\n        }\n      }\n      return null;\n    };\n    var findNode = function (node, direction, predicateFn, rootNode, shallow) {\n      var walker = new DomTreeWalker(node, rootNode);\n      var isCefOrCaretContainer = isContentEditableFalse$4(node) || isCaretContainerBlock$1(node);\n      if (isBackwards(direction)) {\n        if (isCefOrCaretContainer) {\n          node = skipCaretContainers(walker.prev, true);\n          if (predicateFn(node)) {\n            return node;\n          }\n        }\n        while (node = skipCaretContainers(walker.prev, shallow)) {\n          if (predicateFn(node)) {\n            return node;\n          }\n        }\n      }\n      if (isForwards(direction)) {\n        if (isCefOrCaretContainer) {\n          node = skipCaretContainers(walker.next, true);\n          if (predicateFn(node)) {\n            return node;\n          }\n        }\n        while (node = skipCaretContainers(walker.next, shallow)) {\n          if (predicateFn(node)) {\n            return node;\n          }\n        }\n      }\n      return null;\n    };\n    var getParentBlock = function (node, rootNode) {\n      while (node && node !== rootNode) {\n        if (isBlockLike(node)) {\n          return node;\n        }\n        node = node.parentNode;\n      }\n      return null;\n    };\n    var isInSameBlock = function (caretPosition1, caretPosition2, rootNode) {\n      return getParentBlock(caretPosition1.container(), rootNode) === getParentBlock(caretPosition2.container(), rootNode);\n    };\n    var getChildNodeAtRelativeOffset = function (relativeOffset, caretPosition) {\n      if (!caretPosition) {\n        return null;\n      }\n      var container = caretPosition.container();\n      var offset = caretPosition.offset();\n      if (!isElement$5(container)) {\n        return null;\n      }\n      return container.childNodes[offset + relativeOffset];\n    };\n    var beforeAfter = function (before, node) {\n      var range = node.ownerDocument.createRange();\n      if (before) {\n        range.setStartBefore(node);\n        range.setEndBefore(node);\n      } else {\n        range.setStartAfter(node);\n        range.setEndAfter(node);\n      }\n      return range;\n    };\n    var isNodesInSameBlock = function (root, node1, node2) {\n      return getParentBlock(node1, root) === getParentBlock(node2, root);\n    };\n    var lean = function (left, root, node) {\n      var sibling, siblingName;\n      if (left) {\n        siblingName = 'previousSibling';\n      } else {\n        siblingName = 'nextSibling';\n      }\n      while (node && node !== root) {\n        sibling = node[siblingName];\n        if (isCaretContainer$2(sibling)) {\n          sibling = sibling[siblingName];\n        }\n        if (isContentEditableFalse$4(sibling) || isMedia$2(sibling)) {\n          if (isNodesInSameBlock(root, sibling, node)) {\n            return sibling;\n          }\n          break;\n        }\n        if (isCaretCandidate$2(sibling)) {\n          break;\n        }\n        node = node.parentNode;\n      }\n      return null;\n    };\n    var before$2 = curry(beforeAfter, true);\n    var after$1 = curry(beforeAfter, false);\n    var normalizeRange = function (direction, root, range) {\n      var node, container, location;\n      var leanLeft = curry(lean, true, root);\n      var leanRight = curry(lean, false, root);\n      container = range.startContainer;\n      var offset = range.startOffset;\n      if (isCaretContainerBlock(container)) {\n        if (!isElement$5(container)) {\n          container = container.parentNode;\n        }\n        location = container.getAttribute('data-mce-caret');\n        if (location === 'before') {\n          node = container.nextSibling;\n          if (isFakeCaretTarget(node)) {\n            return before$2(node);\n          }\n        }\n        if (location === 'after') {\n          node = container.previousSibling;\n          if (isFakeCaretTarget(node)) {\n            return after$1(node);\n          }\n        }\n      }\n      if (!range.collapsed) {\n        return range;\n      }\n      if (isText$1(container)) {\n        if (isCaretContainer$2(container)) {\n          if (direction === 1) {\n            node = leanRight(container);\n            if (node) {\n              return before$2(node);\n            }\n            node = leanLeft(container);\n            if (node) {\n              return after$1(node);\n            }\n          }\n          if (direction === -1) {\n            node = leanLeft(container);\n            if (node) {\n              return after$1(node);\n            }\n            node = leanRight(container);\n            if (node) {\n              return before$2(node);\n            }\n          }\n          return range;\n        }\n        if (endsWithCaretContainer(container) && offset >= container.data.length - 1) {\n          if (direction === 1) {\n            node = leanRight(container);\n            if (node) {\n              return before$2(node);\n            }\n          }\n          return range;\n        }\n        if (startsWithCaretContainer(container) && offset <= 1) {\n          if (direction === -1) {\n            node = leanLeft(container);\n            if (node) {\n              return after$1(node);\n            }\n          }\n          return range;\n        }\n        if (offset === container.data.length) {\n          node = leanRight(container);\n          if (node) {\n            return before$2(node);\n          }\n          return range;\n        }\n        if (offset === 0) {\n          node = leanLeft(container);\n          if (node) {\n            return after$1(node);\n          }\n          return range;\n        }\n      }\n      return range;\n    };\n    var getRelativeCefElm = function (forward, caretPosition) {\n      return Optional.from(getChildNodeAtRelativeOffset(forward ? 0 : -1, caretPosition)).filter(isContentEditableFalse$4);\n    };\n    var getNormalizedRangeEndPoint = function (direction, root, range) {\n      var normalizedRange = normalizeRange(direction, root, range);\n      if (direction === -1) {\n        return CaretPosition.fromRangeStart(normalizedRange);\n      }\n      return CaretPosition.fromRangeEnd(normalizedRange);\n    };\n    var getElementFromPosition = function (pos) {\n      return Optional.from(pos.getNode()).map(SugarElement.fromDom);\n    };\n    var getElementFromPrevPosition = function (pos) {\n      return Optional.from(pos.getNode(true)).map(SugarElement.fromDom);\n    };\n    var getVisualCaretPosition = function (walkFn, caretPosition) {\n      while (caretPosition = walkFn(caretPosition)) {\n        if (caretPosition.isVisible()) {\n          return caretPosition;\n        }\n      }\n      return caretPosition;\n    };\n    var isMoveInsideSameBlock = function (from, to) {\n      var inSameBlock = isInSameBlock(from, to);\n      if (!inSameBlock && isBr(from.getNode())) {\n        return true;\n      }\n      return inSameBlock;\n    };\n\n    var HDirection;\n    (function (HDirection) {\n      HDirection[HDirection['Backwards'] = -1] = 'Backwards';\n      HDirection[HDirection['Forwards'] = 1] = 'Forwards';\n    }(HDirection || (HDirection = {})));\n    var isContentEditableFalse$5 = isContentEditableFalse;\n    var isText$7 = isText$1;\n    var isElement$6 = isElement$1;\n    var isBr$4 = isBr;\n    var isCaretCandidate$3 = isCaretCandidate;\n    var isAtomic$1 = isAtomic;\n    var isEditableCaretCandidate$1 = isEditableCaretCandidate;\n    var getParents = function (node, root) {\n      var parents = [];\n      while (node && node !== root) {\n        parents.push(node);\n        node = node.parentNode;\n      }\n      return parents;\n    };\n    var nodeAtIndex = function (container, offset) {\n      if (container.hasChildNodes() && offset < container.childNodes.length) {\n        return container.childNodes[offset];\n      }\n      return null;\n    };\n    var getCaretCandidatePosition = function (direction, node) {\n      if (isForwards(direction)) {\n        if (isCaretCandidate$3(node.previousSibling) && !isText$7(node.previousSibling)) {\n          return CaretPosition$1.before(node);\n        }\n        if (isText$7(node)) {\n          return CaretPosition$1(node, 0);\n        }\n      }\n      if (isBackwards(direction)) {\n        if (isCaretCandidate$3(node.nextSibling) && !isText$7(node.nextSibling)) {\n          return CaretPosition$1.after(node);\n        }\n        if (isText$7(node)) {\n          return CaretPosition$1(node, node.data.length);\n        }\n      }\n      if (isBackwards(direction)) {\n        if (isBr$4(node)) {\n          return CaretPosition$1.before(node);\n        }\n        return CaretPosition$1.after(node);\n      }\n      return CaretPosition$1.before(node);\n    };\n    var moveForwardFromBr = function (root, nextNode) {\n      var nextSibling = nextNode.nextSibling;\n      if (nextSibling && isCaretCandidate$3(nextSibling)) {\n        if (isText$7(nextSibling)) {\n          return CaretPosition$1(nextSibling, 0);\n        } else {\n          return CaretPosition$1.before(nextSibling);\n        }\n      } else {\n        return findCaretPosition(HDirection.Forwards, CaretPosition$1.after(nextNode), root);\n      }\n    };\n    var findCaretPosition = function (direction, startPos, root) {\n      var node, nextNode, innerNode;\n      var caretPosition;\n      if (!isElement$6(root) || !startPos) {\n        return null;\n      }\n      if (startPos.isEqual(CaretPosition$1.after(root)) && root.lastChild) {\n        caretPosition = CaretPosition$1.after(root.lastChild);\n        if (isBackwards(direction) && isCaretCandidate$3(root.lastChild) && isElement$6(root.lastChild)) {\n          return isBr$4(root.lastChild) ? CaretPosition$1.before(root.lastChild) : caretPosition;\n        }\n      } else {\n        caretPosition = startPos;\n      }\n      var container = caretPosition.container();\n      var offset = caretPosition.offset();\n      if (isText$7(container)) {\n        if (isBackwards(direction) && offset > 0) {\n          return CaretPosition$1(container, --offset);\n        }\n        if (isForwards(direction) && offset < container.length) {\n          return CaretPosition$1(container, ++offset);\n        }\n        node = container;\n      } else {\n        if (isBackwards(direction) && offset > 0) {\n          nextNode = nodeAtIndex(container, offset - 1);\n          if (isCaretCandidate$3(nextNode)) {\n            if (!isAtomic$1(nextNode)) {\n              innerNode = findNode(nextNode, direction, isEditableCaretCandidate$1, nextNode);\n              if (innerNode) {\n                if (isText$7(innerNode)) {\n                  return CaretPosition$1(innerNode, innerNode.data.length);\n                }\n                return CaretPosition$1.after(innerNode);\n              }\n            }\n            if (isText$7(nextNode)) {\n              return CaretPosition$1(nextNode, nextNode.data.length);\n            }\n            return CaretPosition$1.before(nextNode);\n          }\n        }\n        if (isForwards(direction) && offset < container.childNodes.length) {\n          nextNode = nodeAtIndex(container, offset);\n          if (isCaretCandidate$3(nextNode)) {\n            if (isBr$4(nextNode)) {\n              return moveForwardFromBr(root, nextNode);\n            }\n            if (!isAtomic$1(nextNode)) {\n              innerNode = findNode(nextNode, direction, isEditableCaretCandidate$1, nextNode);\n              if (innerNode) {\n                if (isText$7(innerNode)) {\n                  return CaretPosition$1(innerNode, 0);\n                }\n                return CaretPosition$1.before(innerNode);\n              }\n            }\n            if (isText$7(nextNode)) {\n              return CaretPosition$1(nextNode, 0);\n            }\n            return CaretPosition$1.after(nextNode);\n          }\n        }\n        node = nextNode ? nextNode : caretPosition.getNode();\n      }\n      if (isForwards(direction) && caretPosition.isAtEnd() || isBackwards(direction) && caretPosition.isAtStart()) {\n        node = findNode(node, direction, always, root, true);\n        if (isEditableCaretCandidate$1(node, root)) {\n          return getCaretCandidatePosition(direction, node);\n        }\n      }\n      nextNode = findNode(node, direction, isEditableCaretCandidate$1, root);\n      var rootContentEditableFalseElm = last$1(filter(getParents(container, root), isContentEditableFalse$5));\n      if (rootContentEditableFalseElm && (!nextNode || !rootContentEditableFalseElm.contains(nextNode))) {\n        if (isForwards(direction)) {\n          caretPosition = CaretPosition$1.after(rootContentEditableFalseElm);\n        } else {\n          caretPosition = CaretPosition$1.before(rootContentEditableFalseElm);\n        }\n        return caretPosition;\n      }\n      if (nextNode) {\n        return getCaretCandidatePosition(direction, nextNode);\n      }\n      return null;\n    };\n    var CaretWalker = function (root) {\n      return {\n        next: function (caretPosition) {\n          return findCaretPosition(HDirection.Forwards, caretPosition, root);\n        },\n        prev: function (caretPosition) {\n          return findCaretPosition(HDirection.Backwards, caretPosition, root);\n        }\n      };\n    };\n\n    var walkToPositionIn = function (forward, root, start) {\n      var position = forward ? CaretPosition$1.before(start) : CaretPosition$1.after(start);\n      return fromPosition(forward, root, position);\n    };\n    var afterElement = function (node) {\n      return isBr(node) ? CaretPosition$1.before(node) : CaretPosition$1.after(node);\n    };\n    var isBeforeOrStart = function (position) {\n      if (CaretPosition$1.isTextPosition(position)) {\n        return position.offset() === 0;\n      } else {\n        return isCaretCandidate(position.getNode());\n      }\n    };\n    var isAfterOrEnd = function (position) {\n      if (CaretPosition$1.isTextPosition(position)) {\n        var container = position.container();\n        return position.offset() === container.data.length;\n      } else {\n        return isCaretCandidate(position.getNode(true));\n      }\n    };\n    var isBeforeAfterSameElement = function (from, to) {\n      return !CaretPosition$1.isTextPosition(from) && !CaretPosition$1.isTextPosition(to) && from.getNode() === to.getNode(true);\n    };\n    var isAtBr = function (position) {\n      return !CaretPosition$1.isTextPosition(position) && isBr(position.getNode());\n    };\n    var shouldSkipPosition = function (forward, from, to) {\n      if (forward) {\n        return !isBeforeAfterSameElement(from, to) && !isAtBr(from) && isAfterOrEnd(from) && isBeforeOrStart(to);\n      } else {\n        return !isBeforeAfterSameElement(to, from) && isBeforeOrStart(from) && isAfterOrEnd(to);\n      }\n    };\n    var fromPosition = function (forward, root, pos) {\n      var walker = CaretWalker(root);\n      return Optional.from(forward ? walker.next(pos) : walker.prev(pos));\n    };\n    var navigate = function (forward, root, from) {\n      return fromPosition(forward, root, from).bind(function (to) {\n        if (isInSameBlock(from, to, root) && shouldSkipPosition(forward, from, to)) {\n          return fromPosition(forward, root, to);\n        } else {\n          return Optional.some(to);\n        }\n      });\n    };\n    var navigateIgnore = function (forward, root, from, ignoreFilter) {\n      return navigate(forward, root, from).bind(function (pos) {\n        return ignoreFilter(pos) ? navigateIgnore(forward, root, pos, ignoreFilter) : Optional.some(pos);\n      });\n    };\n    var positionIn = function (forward, element) {\n      var startNode = forward ? element.firstChild : element.lastChild;\n      if (isText$1(startNode)) {\n        return Optional.some(CaretPosition$1(startNode, forward ? 0 : startNode.data.length));\n      } else if (startNode) {\n        if (isCaretCandidate(startNode)) {\n          return Optional.some(forward ? CaretPosition$1.before(startNode) : afterElement(startNode));\n        } else {\n          return walkToPositionIn(forward, element, startNode);\n        }\n      } else {\n        return Optional.none();\n      }\n    };\n    var nextPosition = curry(fromPosition, true);\n    var prevPosition = curry(fromPosition, false);\n    var firstPositionIn = curry(positionIn, true);\n    var lastPositionIn = curry(positionIn, false);\n\n    var CARET_ID = '_mce_caret';\n    var isCaretNode = function (node) {\n      return isElement$1(node) && node.id === CARET_ID;\n    };\n    var getParentCaretContainer = function (body, node) {\n      while (node && node !== body) {\n        if (node.id === CARET_ID) {\n          return node;\n        }\n        node = node.parentNode;\n      }\n      return null;\n    };\n\n    var isStringPathBookmark = function (bookmark) {\n      return typeof bookmark.start === 'string';\n    };\n    var isRangeBookmark = function (bookmark) {\n      return bookmark.hasOwnProperty('rng');\n    };\n    var isIdBookmark = function (bookmark) {\n      return bookmark.hasOwnProperty('id');\n    };\n    var isIndexBookmark = function (bookmark) {\n      return bookmark.hasOwnProperty('name');\n    };\n    var isPathBookmark = function (bookmark) {\n      return Tools.isArray(bookmark.start);\n    };\n\n    var addBogus = function (dom, node) {\n      if (isElement$1(node) && dom.isBlock(node) && !node.innerHTML && !Env.ie) {\n        node.innerHTML = '<br data-mce-bogus=\"1\" />';\n      }\n      return node;\n    };\n    var resolveCaretPositionBookmark = function (dom, bookmark) {\n      var pos;\n      var rng = dom.createRng();\n      pos = resolve$1(dom.getRoot(), bookmark.start);\n      rng.setStart(pos.container(), pos.offset());\n      pos = resolve$1(dom.getRoot(), bookmark.end);\n      rng.setEnd(pos.container(), pos.offset());\n      return rng;\n    };\n    var insertZwsp = function (node, rng) {\n      var textNode = node.ownerDocument.createTextNode(ZWSP);\n      node.appendChild(textNode);\n      rng.setStart(textNode, 0);\n      rng.setEnd(textNode, 0);\n    };\n    var isEmpty$1 = function (node) {\n      return node.hasChildNodes() === false;\n    };\n    var tryFindRangePosition = function (node, rng) {\n      return lastPositionIn(node).fold(function () {\n        return false;\n      }, function (pos) {\n        rng.setStart(pos.container(), pos.offset());\n        rng.setEnd(pos.container(), pos.offset());\n        return true;\n      });\n    };\n    var padEmptyCaretContainer = function (root, node, rng) {\n      if (isEmpty$1(node) && getParentCaretContainer(root, node)) {\n        insertZwsp(node, rng);\n        return true;\n      } else {\n        return false;\n      }\n    };\n    var setEndPoint = function (dom, start, bookmark, rng) {\n      var point = bookmark[start ? 'start' : 'end'];\n      var i, node, offset, children;\n      var root = dom.getRoot();\n      if (point) {\n        offset = point[0];\n        for (node = root, i = point.length - 1; i >= 1; i--) {\n          children = node.childNodes;\n          if (padEmptyCaretContainer(root, node, rng)) {\n            return true;\n          }\n          if (point[i] > children.length - 1) {\n            if (padEmptyCaretContainer(root, node, rng)) {\n              return true;\n            }\n            return tryFindRangePosition(node, rng);\n          }\n          node = children[point[i]];\n        }\n        if (node.nodeType === 3) {\n          offset = Math.min(point[0], node.nodeValue.length);\n        }\n        if (node.nodeType === 1) {\n          offset = Math.min(point[0], node.childNodes.length);\n        }\n        if (start) {\n          rng.setStart(node, offset);\n        } else {\n          rng.setEnd(node, offset);\n        }\n      }\n      return true;\n    };\n    var isValidTextNode = function (node) {\n      return isText$1(node) && node.data.length > 0;\n    };\n    var restoreEndPoint = function (dom, suffix, bookmark) {\n      var marker = dom.get(bookmark.id + '_' + suffix), node, idx, next, prev;\n      var keep = bookmark.keep;\n      var container, offset;\n      if (marker) {\n        node = marker.parentNode;\n        if (suffix === 'start') {\n          if (!keep) {\n            idx = dom.nodeIndex(marker);\n          } else {\n            if (marker.hasChildNodes()) {\n              node = marker.firstChild;\n              idx = 1;\n            } else if (isValidTextNode(marker.nextSibling)) {\n              node = marker.nextSibling;\n              idx = 0;\n            } else if (isValidTextNode(marker.previousSibling)) {\n              node = marker.previousSibling;\n              idx = marker.previousSibling.data.length;\n            } else {\n              node = marker.parentNode;\n              idx = dom.nodeIndex(marker) + 1;\n            }\n          }\n          container = node;\n          offset = idx;\n        } else {\n          if (!keep) {\n            idx = dom.nodeIndex(marker);\n          } else {\n            if (marker.hasChildNodes()) {\n              node = marker.firstChild;\n              idx = 1;\n            } else if (isValidTextNode(marker.previousSibling)) {\n              node = marker.previousSibling;\n              idx = marker.previousSibling.data.length;\n            } else {\n              node = marker.parentNode;\n              idx = dom.nodeIndex(marker);\n            }\n          }\n          container = node;\n          offset = idx;\n        }\n        if (!keep) {\n          prev = marker.previousSibling;\n          next = marker.nextSibling;\n          Tools.each(Tools.grep(marker.childNodes), function (node) {\n            if (isText$1(node)) {\n              node.nodeValue = node.nodeValue.replace(/\\uFEFF/g, '');\n            }\n          });\n          while (marker = dom.get(bookmark.id + '_' + suffix)) {\n            dom.remove(marker, true);\n          }\n          if (prev && next && prev.nodeType === next.nodeType && isText$1(prev) && !Env.opera) {\n            idx = prev.nodeValue.length;\n            prev.appendData(next.nodeValue);\n            dom.remove(next);\n            container = prev;\n            offset = idx;\n          }\n        }\n        return Optional.some(CaretPosition$1(container, offset));\n      } else {\n        return Optional.none();\n      }\n    };\n    var resolvePaths = function (dom, bookmark) {\n      var rng = dom.createRng();\n      if (setEndPoint(dom, true, bookmark, rng) && setEndPoint(dom, false, bookmark, rng)) {\n        return Optional.some(rng);\n      } else {\n        return Optional.none();\n      }\n    };\n    var resolveId = function (dom, bookmark) {\n      var startPos = restoreEndPoint(dom, 'start', bookmark);\n      var endPos = restoreEndPoint(dom, 'end', bookmark);\n      return lift2(startPos, endPos.or(startPos), function (spos, epos) {\n        var rng = dom.createRng();\n        rng.setStart(addBogus(dom, spos.container()), spos.offset());\n        rng.setEnd(addBogus(dom, epos.container()), epos.offset());\n        return rng;\n      });\n    };\n    var resolveIndex$1 = function (dom, bookmark) {\n      return Optional.from(dom.select(bookmark.name)[bookmark.index]).map(function (elm) {\n        var rng = dom.createRng();\n        rng.selectNode(elm);\n        return rng;\n      });\n    };\n    var resolve$2 = function (selection, bookmark) {\n      var dom = selection.dom;\n      if (bookmark) {\n        if (isPathBookmark(bookmark)) {\n          return resolvePaths(dom, bookmark);\n        } else if (isStringPathBookmark(bookmark)) {\n          return Optional.some(resolveCaretPositionBookmark(dom, bookmark));\n        } else if (isIdBookmark(bookmark)) {\n          return resolveId(dom, bookmark);\n        } else if (isIndexBookmark(bookmark)) {\n          return resolveIndex$1(dom, bookmark);\n        } else if (isRangeBookmark(bookmark)) {\n          return Optional.some(bookmark.rng);\n        }\n      }\n      return Optional.none();\n    };\n\n    var getBookmark$1 = function (selection, type, normalized) {\n      return getBookmark(selection, type, normalized);\n    };\n    var moveToBookmark = function (selection, bookmark) {\n      resolve$2(selection, bookmark).each(function (rng) {\n        selection.setRng(rng);\n      });\n    };\n    var isBookmarkNode$1 = function (node) {\n      return isElement$1(node) && node.tagName === 'SPAN' && node.getAttribute('data-mce-type') === 'bookmark';\n    };\n\n    var is$2 = function (expected) {\n      return function (actual) {\n        return expected === actual;\n      };\n    };\n    var isNbsp = is$2(nbsp);\n    var isWhiteSpace$1 = function (chr) {\n      return chr !== '' && ' \\f\\n\\r\\t\\x0B'.indexOf(chr) !== -1;\n    };\n    var isContent$1 = function (chr) {\n      return !isWhiteSpace$1(chr) && !isNbsp(chr);\n    };\n\n    var isNode = function (node) {\n      return !!node.nodeType;\n    };\n    var isInlineBlock = function (node) {\n      return node && /^(IMG)$/.test(node.nodeName);\n    };\n    var moveStart = function (dom, selection, rng) {\n      var offset = rng.startOffset;\n      var container = rng.startContainer, walker, node, nodes;\n      if (rng.startContainer === rng.endContainer) {\n        if (isInlineBlock(rng.startContainer.childNodes[rng.startOffset])) {\n          return;\n        }\n      }\n      if (container.nodeType === 1) {\n        nodes = container.childNodes;\n        if (offset < nodes.length) {\n          container = nodes[offset];\n          walker = new DomTreeWalker(container, dom.getParent(container, dom.isBlock));\n        } else {\n          container = nodes[nodes.length - 1];\n          walker = new DomTreeWalker(container, dom.getParent(container, dom.isBlock));\n          walker.next(true);\n        }\n        for (node = walker.current(); node; node = walker.next()) {\n          if (node.nodeType === 3 && !isWhiteSpaceNode(node)) {\n            rng.setStart(node, 0);\n            selection.setRng(rng);\n            return;\n          }\n        }\n      }\n    };\n    var getNonWhiteSpaceSibling = function (node, next, inc) {\n      if (node) {\n        var nextName = next ? 'nextSibling' : 'previousSibling';\n        for (node = inc ? node : node[nextName]; node; node = node[nextName]) {\n          if (node.nodeType === 1 || !isWhiteSpaceNode(node)) {\n            return node;\n          }\n        }\n      }\n    };\n    var isTextBlock$1 = function (editor, name) {\n      if (isNode(name)) {\n        name = name.nodeName;\n      }\n      return !!editor.schema.getTextBlockElements()[name.toLowerCase()];\n    };\n    var isValid = function (ed, parent, child) {\n      return ed.schema.isValidChild(parent, child);\n    };\n    var isWhiteSpaceNode = function (node) {\n      return node && isText$1(node) && /^([\\t \\r\\n]+|)$/.test(node.nodeValue);\n    };\n    var isEmptyTextNode = function (node) {\n      return node && isText$1(node) && node.length === 0;\n    };\n    var replaceVars = function (value, vars) {\n      if (typeof value !== 'string') {\n        value = value(vars);\n      } else if (vars) {\n        value = value.replace(/%(\\w+)/g, function (str, name) {\n          return vars[name] || str;\n        });\n      }\n      return value;\n    };\n    var isEq = function (str1, str2) {\n      str1 = str1 || '';\n      str2 = str2 || '';\n      str1 = '' + (str1.nodeName || str1);\n      str2 = '' + (str2.nodeName || str2);\n      return str1.toLowerCase() === str2.toLowerCase();\n    };\n    var normalizeStyleValue = function (dom, value, name) {\n      if (name === 'color' || name === 'backgroundColor') {\n        value = dom.toHex(value);\n      }\n      if (name === 'fontWeight' && value === 700) {\n        value = 'bold';\n      }\n      if (name === 'fontFamily') {\n        value = value.replace(/[\\'\\\"]/g, '').replace(/,\\s+/g, ',');\n      }\n      return '' + value;\n    };\n    var getStyle = function (dom, node, name) {\n      return normalizeStyleValue(dom, dom.getStyle(node, name), name);\n    };\n    var getTextDecoration = function (dom, node) {\n      var decoration;\n      dom.getParent(node, function (n) {\n        decoration = dom.getStyle(n, 'text-decoration');\n        return decoration && decoration !== 'none';\n      });\n      return decoration;\n    };\n    var getParents$1 = function (dom, node, selector) {\n      return dom.getParents(node, selector, dom.getRoot());\n    };\n    var isVariableFormatName = function (editor, formatName) {\n      var hasVariableValues = function (format) {\n        var isVariableValue = function (val) {\n          return val.length > 1 && val.charAt(0) === '%';\n        };\n        return exists([\n          'styles',\n          'attributes'\n        ], function (key) {\n          return get(format, key).exists(function (field) {\n            var fieldValues = isArray(field) ? field : values(field);\n            return exists(fieldValues, isVariableValue);\n          });\n        });\n      };\n      return exists(editor.formatter.get(formatName), hasVariableValues);\n    };\n    var areSimilarFormats = function (editor, formatName, otherFormatName) {\n      var validKeys = [\n        'inline',\n        'block',\n        'selector',\n        'attributes',\n        'styles',\n        'classes'\n      ];\n      var filterObj = function (format) {\n        return filter$1(format, function (_, key) {\n          return exists(validKeys, function (validKey) {\n            return validKey === key;\n          });\n        });\n      };\n      return exists(editor.formatter.get(formatName), function (fmt1) {\n        var filteredFmt1 = filterObj(fmt1);\n        return exists(editor.formatter.get(otherFormatName), function (fmt2) {\n          var filteredFmt2 = filterObj(fmt2);\n          return equal(filteredFmt1, filteredFmt2);\n        });\n      });\n    };\n\n    var isBookmarkNode$2 = isBookmarkNode$1;\n    var getParents$2 = getParents$1;\n    var isWhiteSpaceNode$1 = isWhiteSpaceNode;\n    var isTextBlock$2 = isTextBlock$1;\n    var isBogusBr = function (node) {\n      return node.nodeName === 'BR' && node.getAttribute('data-mce-bogus') && !node.nextSibling;\n    };\n    var findParentContentEditable = function (dom, node) {\n      var parent = node;\n      while (parent) {\n        if (isElement$1(parent) && dom.getContentEditable(parent)) {\n          return dom.getContentEditable(parent) === 'false' ? parent : node;\n        }\n        parent = parent.parentNode;\n      }\n      return node;\n    };\n    var walkText = function (start, node, offset, predicate) {\n      var str = node.data;\n      for (var i = offset; start ? i >= 0 : i < str.length; start ? i-- : i++) {\n        if (predicate(str.charAt(i))) {\n          return start ? i + 1 : i;\n        }\n      }\n      return -1;\n    };\n    var findSpace = function (start, node, offset) {\n      return walkText(start, node, offset, function (c) {\n        return isNbsp(c) || isWhiteSpace$1(c);\n      });\n    };\n    var findContent = function (start, node, offset) {\n      return walkText(start, node, offset, isContent$1);\n    };\n    var findWordEndPoint = function (dom, body, container, offset, start, includeTrailingSpaces) {\n      var lastTextNode;\n      var rootNode = dom.getParent(container, dom.isBlock) || body;\n      var walk = function (container, offset, pred) {\n        var textSeeker = TextSeeker(dom);\n        var walker = start ? textSeeker.backwards : textSeeker.forwards;\n        return Optional.from(walker(container, offset, function (text, textOffset) {\n          if (isBookmarkNode$2(text.parentNode)) {\n            return -1;\n          } else {\n            lastTextNode = text;\n            return pred(start, text, textOffset);\n          }\n        }, rootNode));\n      };\n      var spaceResult = walk(container, offset, findSpace);\n      return spaceResult.bind(function (result) {\n        return includeTrailingSpaces ? walk(result.container, result.offset + (start ? -1 : 0), findContent) : Optional.some(result);\n      }).orThunk(function () {\n        return lastTextNode ? Optional.some({\n          container: lastTextNode,\n          offset: start ? 0 : lastTextNode.length\n        }) : Optional.none();\n      });\n    };\n    var findSelectorEndPoint = function (dom, format, rng, container, siblingName) {\n      if (isText$1(container) && container.nodeValue.length === 0 && container[siblingName]) {\n        container = container[siblingName];\n      }\n      var parents = getParents$2(dom, container);\n      for (var i = 0; i < parents.length; i++) {\n        for (var y = 0; y < format.length; y++) {\n          var curFormat = format[y];\n          if ('collapsed' in curFormat && curFormat.collapsed !== rng.collapsed) {\n            continue;\n          }\n          if (dom.is(parents[i], curFormat.selector)) {\n            return parents[i];\n          }\n        }\n      }\n      return container;\n    };\n    var findBlockEndPoint = function (editor, format, container, siblingName) {\n      var node;\n      var dom = editor.dom;\n      var root = dom.getRoot();\n      if (!format[0].wrapper) {\n        node = dom.getParent(container, format[0].block, root);\n      }\n      if (!node) {\n        var scopeRoot = dom.getParent(container, 'LI,TD,TH');\n        node = dom.getParent(isText$1(container) ? container.parentNode : container, function (node) {\n          return node !== root && isTextBlock$2(editor, node);\n        }, scopeRoot);\n      }\n      if (node && format[0].wrapper) {\n        node = getParents$2(dom, node, 'ul,ol').reverse()[0] || node;\n      }\n      if (!node) {\n        node = container;\n        while (node[siblingName] && !dom.isBlock(node[siblingName])) {\n          node = node[siblingName];\n          if (isEq(node, 'br')) {\n            break;\n          }\n        }\n      }\n      return node || container;\n    };\n    var findParentContainer = function (dom, format, startContainer, startOffset, endContainer, endOffset, start) {\n      var container, parent, sibling;\n      container = parent = start ? startContainer : endContainer;\n      var siblingName = start ? 'previousSibling' : 'nextSibling';\n      var root = dom.getRoot();\n      if (isText$1(container) && !isWhiteSpaceNode$1(container)) {\n        if (start ? startOffset > 0 : endOffset < container.nodeValue.length) {\n          return container;\n        }\n      }\n      while (true) {\n        if (!format[0].block_expand && dom.isBlock(parent)) {\n          return parent;\n        }\n        for (sibling = parent[siblingName]; sibling; sibling = sibling[siblingName]) {\n          if (!isBookmarkNode$2(sibling) && !isWhiteSpaceNode$1(sibling) && !isBogusBr(sibling)) {\n            return parent;\n          }\n        }\n        if (parent === root || parent.parentNode === root) {\n          container = parent;\n          break;\n        }\n        parent = parent.parentNode;\n      }\n      return container;\n    };\n    var expandRng = function (editor, rng, format, includeTrailingSpace) {\n      if (includeTrailingSpace === void 0) {\n        includeTrailingSpace = false;\n      }\n      var startContainer = rng.startContainer, startOffset = rng.startOffset, endContainer = rng.endContainer, endOffset = rng.endOffset;\n      var dom = editor.dom;\n      if (isElement$1(startContainer) && startContainer.hasChildNodes()) {\n        startContainer = getNode(startContainer, startOffset);\n        if (isText$1(startContainer)) {\n          startOffset = 0;\n        }\n      }\n      if (isElement$1(endContainer) && endContainer.hasChildNodes()) {\n        endContainer = getNode(endContainer, rng.collapsed ? endOffset : endOffset - 1);\n        if (isText$1(endContainer)) {\n          endOffset = endContainer.nodeValue.length;\n        }\n      }\n      startContainer = findParentContentEditable(dom, startContainer);\n      endContainer = findParentContentEditable(dom, endContainer);\n      if (isBookmarkNode$2(startContainer.parentNode) || isBookmarkNode$2(startContainer)) {\n        startContainer = isBookmarkNode$2(startContainer) ? startContainer : startContainer.parentNode;\n        if (rng.collapsed) {\n          startContainer = startContainer.previousSibling || startContainer;\n        } else {\n          startContainer = startContainer.nextSibling || startContainer;\n        }\n        if (isText$1(startContainer)) {\n          startOffset = rng.collapsed ? startContainer.length : 0;\n        }\n      }\n      if (isBookmarkNode$2(endContainer.parentNode) || isBookmarkNode$2(endContainer)) {\n        endContainer = isBookmarkNode$2(endContainer) ? endContainer : endContainer.parentNode;\n        if (rng.collapsed) {\n          endContainer = endContainer.nextSibling || endContainer;\n        } else {\n          endContainer = endContainer.previousSibling || endContainer;\n        }\n        if (isText$1(endContainer)) {\n          endOffset = rng.collapsed ? 0 : endContainer.length;\n        }\n      }\n      if (rng.collapsed) {\n        var startPoint = findWordEndPoint(dom, editor.getBody(), startContainer, startOffset, true, includeTrailingSpace);\n        startPoint.each(function (_a) {\n          var container = _a.container, offset = _a.offset;\n          startContainer = container;\n          startOffset = offset;\n        });\n        var endPoint = findWordEndPoint(dom, editor.getBody(), endContainer, endOffset, false, includeTrailingSpace);\n        endPoint.each(function (_a) {\n          var container = _a.container, offset = _a.offset;\n          endContainer = container;\n          endOffset = offset;\n        });\n      }\n      if (format[0].inline || format[0].block_expand) {\n        if (!format[0].inline || (!isText$1(startContainer) || startOffset === 0)) {\n          startContainer = findParentContainer(dom, format, startContainer, startOffset, endContainer, endOffset, true);\n        }\n        if (!format[0].inline || (!isText$1(endContainer) || endOffset === endContainer.nodeValue.length)) {\n          endContainer = findParentContainer(dom, format, startContainer, startOffset, endContainer, endOffset, false);\n        }\n      }\n      if (format[0].selector && format[0].expand !== false && !format[0].inline) {\n        startContainer = findSelectorEndPoint(dom, format, rng, startContainer, 'previousSibling');\n        endContainer = findSelectorEndPoint(dom, format, rng, endContainer, 'nextSibling');\n      }\n      if (format[0].block || format[0].selector) {\n        startContainer = findBlockEndPoint(editor, format, startContainer, 'previousSibling');\n        endContainer = findBlockEndPoint(editor, format, endContainer, 'nextSibling');\n        if (format[0].block) {\n          if (!dom.isBlock(startContainer)) {\n            startContainer = findParentContainer(dom, format, startContainer, startOffset, endContainer, endOffset, true);\n          }\n          if (!dom.isBlock(endContainer)) {\n            endContainer = findParentContainer(dom, format, startContainer, startOffset, endContainer, endOffset, false);\n          }\n        }\n      }\n      if (isElement$1(startContainer)) {\n        startOffset = dom.nodeIndex(startContainer);\n        startContainer = startContainer.parentNode;\n      }\n      if (isElement$1(endContainer)) {\n        endOffset = dom.nodeIndex(endContainer) + 1;\n        endContainer = endContainer.parentNode;\n      }\n      return {\n        startContainer: startContainer,\n        startOffset: startOffset,\n        endContainer: endContainer,\n        endOffset: endOffset\n      };\n    };\n\n    var clampToExistingChildren = function (container, index) {\n      var childNodes = container.childNodes;\n      if (index >= childNodes.length) {\n        index = childNodes.length - 1;\n      } else if (index < 0) {\n        index = 0;\n      }\n      return childNodes[index] || container;\n    };\n    var getEndChild = function (container, index) {\n      return clampToExistingChildren(container, index - 1);\n    };\n    var walk$1 = function (dom, rng, callback) {\n      var startContainer = rng.startContainer;\n      var startOffset = rng.startOffset;\n      var endContainer = rng.endContainer;\n      var endOffset = rng.endOffset;\n      var exclude = function (nodes) {\n        var node;\n        node = nodes[0];\n        if (node.nodeType === 3 && node === startContainer && startOffset >= node.nodeValue.length) {\n          nodes.splice(0, 1);\n        }\n        node = nodes[nodes.length - 1];\n        if (endOffset === 0 && nodes.length > 0 && node === endContainer && node.nodeType === 3) {\n          nodes.splice(nodes.length - 1, 1);\n        }\n        return nodes;\n      };\n      var collectSiblings = function (node, name, endNode) {\n        var siblings = [];\n        for (; node && node !== endNode; node = node[name]) {\n          siblings.push(node);\n        }\n        return siblings;\n      };\n      var findEndPoint = function (node, root) {\n        do {\n          if (node.parentNode === root) {\n            return node;\n          }\n          node = node.parentNode;\n        } while (node);\n      };\n      var walkBoundary = function (startNode, endNode, next) {\n        var siblingName = next ? 'nextSibling' : 'previousSibling';\n        for (var node = startNode, parent_1 = node.parentNode; node && node !== endNode; node = parent_1) {\n          parent_1 = node.parentNode;\n          var siblings_1 = collectSiblings(node === startNode ? node : node[siblingName], siblingName);\n          if (siblings_1.length) {\n            if (!next) {\n              siblings_1.reverse();\n            }\n            callback(exclude(siblings_1));\n          }\n        }\n      };\n      if (startContainer.nodeType === 1 && startContainer.hasChildNodes()) {\n        startContainer = clampToExistingChildren(startContainer, startOffset);\n      }\n      if (endContainer.nodeType === 1 && endContainer.hasChildNodes()) {\n        endContainer = getEndChild(endContainer, endOffset);\n      }\n      if (startContainer === endContainer) {\n        return callback(exclude([startContainer]));\n      }\n      var ancestor = dom.findCommonAncestor(startContainer, endContainer);\n      for (var node = startContainer; node; node = node.parentNode) {\n        if (node === endContainer) {\n          return walkBoundary(startContainer, ancestor, true);\n        }\n        if (node === ancestor) {\n          break;\n        }\n      }\n      for (var node = endContainer; node; node = node.parentNode) {\n        if (node === startContainer) {\n          return walkBoundary(endContainer, ancestor);\n        }\n        if (node === ancestor) {\n          break;\n        }\n      }\n      var startPoint = findEndPoint(startContainer, ancestor) || startContainer;\n      var endPoint = findEndPoint(endContainer, ancestor) || endContainer;\n      walkBoundary(startContainer, startPoint, true);\n      var siblings = collectSiblings(startPoint === startContainer ? startPoint : startPoint.nextSibling, 'nextSibling', endPoint === endContainer ? endPoint.nextSibling : endPoint);\n      if (siblings.length) {\n        callback(exclude(siblings));\n      }\n      walkBoundary(endContainer, endPoint);\n    };\n\n    var getRanges = function (selection) {\n      var ranges = [];\n      if (selection) {\n        for (var i = 0; i < selection.rangeCount; i++) {\n          ranges.push(selection.getRangeAt(i));\n        }\n      }\n      return ranges;\n    };\n    var getSelectedNodes = function (ranges) {\n      return bind(ranges, function (range) {\n        var node = getSelectedNode(range);\n        return node ? [SugarElement.fromDom(node)] : [];\n      });\n    };\n    var hasMultipleRanges = function (selection) {\n      return getRanges(selection).length > 1;\n    };\n\n    var getCellsFromRanges = function (ranges) {\n      return filter(getSelectedNodes(ranges), isTableCell$1);\n    };\n    var getCellsFromElement = function (elm) {\n      return descendants$1(elm, 'td[data-mce-selected],th[data-mce-selected]');\n    };\n    var getCellsFromElementOrRanges = function (ranges, element) {\n      var selectedCells = getCellsFromElement(element);\n      return selectedCells.length > 0 ? selectedCells : getCellsFromRanges(ranges);\n    };\n    var getCellsFromEditor = function (editor) {\n      return getCellsFromElementOrRanges(getRanges(editor.selection.getSel()), SugarElement.fromDom(editor.getBody()));\n    };\n\n    var getStartNode = function (rng) {\n      var sc = rng.startContainer, so = rng.startOffset;\n      if (isText$1(sc)) {\n        return so === 0 ? Optional.some(SugarElement.fromDom(sc)) : Optional.none();\n      } else {\n        return Optional.from(sc.childNodes[so]).map(SugarElement.fromDom);\n      }\n    };\n    var getEndNode = function (rng) {\n      var ec = rng.endContainer, eo = rng.endOffset;\n      if (isText$1(ec)) {\n        return eo === ec.data.length ? Optional.some(SugarElement.fromDom(ec)) : Optional.none();\n      } else {\n        return Optional.from(ec.childNodes[eo - 1]).map(SugarElement.fromDom);\n      }\n    };\n    var getFirstChildren = function (node) {\n      return firstChild(node).fold(constant([node]), function (child) {\n        return [node].concat(getFirstChildren(child));\n      });\n    };\n    var getLastChildren = function (node) {\n      return lastChild(node).fold(constant([node]), function (child) {\n        if (name(child) === 'br') {\n          return prevSibling(child).map(function (sibling) {\n            return [node].concat(getLastChildren(sibling));\n          }).getOr([]);\n        } else {\n          return [node].concat(getLastChildren(child));\n        }\n      });\n    };\n    var hasAllContentsSelected = function (elm, rng) {\n      return lift2(getStartNode(rng), getEndNode(rng), function (startNode, endNode) {\n        var start = find(getFirstChildren(elm), curry(eq$2, startNode));\n        var end = find(getLastChildren(elm), curry(eq$2, endNode));\n        return start.isSome() && end.isSome();\n      }).getOr(false);\n    };\n    var moveEndPoint$1 = function (dom, rng, node, start) {\n      var root = node, walker = new DomTreeWalker(node, root);\n      var moveCaretBeforeOnEnterElementsMap = filter$1(dom.schema.getMoveCaretBeforeOnEnterElements(), function (_, name) {\n        return !contains([\n          'td',\n          'th',\n          'table'\n        ], name.toLowerCase());\n      });\n      do {\n        if (isText$1(node) && Tools.trim(node.nodeValue).length !== 0) {\n          if (start) {\n            rng.setStart(node, 0);\n          } else {\n            rng.setEnd(node, node.nodeValue.length);\n          }\n          return;\n        }\n        if (moveCaretBeforeOnEnterElementsMap[node.nodeName]) {\n          if (start) {\n            rng.setStartBefore(node);\n          } else {\n            if (node.nodeName === 'BR') {\n              rng.setEndBefore(node);\n            } else {\n              rng.setEndAfter(node);\n            }\n          }\n          return;\n        }\n      } while (node = start ? walker.next() : walker.prev());\n      if (root.nodeName === 'BODY') {\n        if (start) {\n          rng.setStart(root, 0);\n        } else {\n          rng.setEnd(root, root.childNodes.length);\n        }\n      }\n    };\n    var hasAnyRanges = function (editor) {\n      var sel = editor.selection.getSel();\n      return sel && sel.rangeCount > 0;\n    };\n    var runOnRanges = function (editor, executor) {\n      var fakeSelectionNodes = getCellsFromEditor(editor);\n      if (fakeSelectionNodes.length > 0) {\n        each(fakeSelectionNodes, function (elem) {\n          var node = elem.dom;\n          var fakeNodeRng = editor.dom.createRng();\n          fakeNodeRng.setStartBefore(node);\n          fakeNodeRng.setEndAfter(node);\n          executor(fakeNodeRng, true);\n        });\n      } else {\n        executor(editor.selection.getRng(), false);\n      }\n    };\n    var preserve = function (selection, fillBookmark, executor) {\n      var bookmark = getPersistentBookmark(selection, fillBookmark);\n      executor(bookmark);\n      selection.moveToBookmark(bookmark);\n    };\n\n    function NodeValue (is, name) {\n      var get = function (element) {\n        if (!is(element)) {\n          throw new Error('Can only get ' + name + ' value of a ' + name + ' node');\n        }\n        return getOption(element).getOr('');\n      };\n      var getOption = function (element) {\n        return is(element) ? Optional.from(element.dom.nodeValue) : Optional.none();\n      };\n      var set = function (element, value) {\n        if (!is(element)) {\n          throw new Error('Can only set raw ' + name + ' value of a ' + name + ' node');\n        }\n        element.dom.nodeValue = value;\n      };\n      return {\n        get: get,\n        getOption: getOption,\n        set: set\n      };\n    }\n\n    var api = NodeValue(isText, 'text');\n    var get$7 = function (element) {\n      return api.get(element);\n    };\n\n    var isZeroWidth = function (elem) {\n      return isText(elem) && get$7(elem) === ZWSP;\n    };\n    var context = function (editor, elem, wrapName, nodeName) {\n      return parent(elem).fold(function () {\n        return 'skipping';\n      }, function (parent) {\n        if (nodeName === 'br' || isZeroWidth(elem)) {\n          return 'valid';\n        } else if (isAnnotation(elem)) {\n          return 'existing';\n        } else if (isCaretNode(elem.dom)) {\n          return 'caret';\n        } else if (!isValid(editor, wrapName, nodeName) || !isValid(editor, name(parent), wrapName)) {\n          return 'invalid-child';\n        } else {\n          return 'valid';\n        }\n      });\n    };\n\n    var applyWordGrab = function (editor, rng) {\n      var r = expandRng(editor, rng, [{ inline: true }]);\n      rng.setStart(r.startContainer, r.startOffset);\n      rng.setEnd(r.endContainer, r.endOffset);\n      editor.selection.setRng(rng);\n    };\n    var makeAnnotation = function (eDoc, _a, annotationName, decorate) {\n      var _b = _a.uid, uid = _b === void 0 ? generate$1('mce-annotation') : _b, data = __rest(_a, ['uid']);\n      var master = SugarElement.fromTag('span', eDoc);\n      add$3(master, annotation());\n      set(master, '' + dataAnnotationId(), uid);\n      set(master, '' + dataAnnotation(), annotationName);\n      var _c = decorate(uid, data), _d = _c.attributes, attributes = _d === void 0 ? {} : _d, _e = _c.classes, classes = _e === void 0 ? [] : _e;\n      setAll(master, attributes);\n      add$4(master, classes);\n      return master;\n    };\n    var annotate = function (editor, rng, annotationName, decorate, data) {\n      var newWrappers = [];\n      var master = makeAnnotation(editor.getDoc(), data, annotationName, decorate);\n      var wrapper = Cell(Optional.none());\n      var finishWrapper = function () {\n        wrapper.set(Optional.none());\n      };\n      var getOrOpenWrapper = function () {\n        return wrapper.get().getOrThunk(function () {\n          var nu = shallow(master);\n          newWrappers.push(nu);\n          wrapper.set(Optional.some(nu));\n          return nu;\n        });\n      };\n      var processElements = function (elems) {\n        each(elems, processElement);\n      };\n      var processElement = function (elem) {\n        var ctx = context(editor, elem, 'span', name(elem));\n        switch (ctx) {\n        case 'invalid-child': {\n            finishWrapper();\n            var children$1 = children(elem);\n            processElements(children$1);\n            finishWrapper();\n            break;\n          }\n        case 'valid': {\n            var w = getOrOpenWrapper();\n            wrap(elem, w);\n            break;\n          }\n        }\n      };\n      var processNodes = function (nodes) {\n        var elems = map(nodes, SugarElement.fromDom);\n        processElements(elems);\n      };\n      walk$1(editor.dom, rng, function (nodes) {\n        finishWrapper();\n        processNodes(nodes);\n      });\n      return newWrappers;\n    };\n    var annotateWithBookmark = function (editor, name, settings, data) {\n      editor.undoManager.transact(function () {\n        var selection = editor.selection;\n        var initialRng = selection.getRng();\n        var hasFakeSelection = getCellsFromEditor(editor).length > 0;\n        if (initialRng.collapsed && !hasFakeSelection) {\n          applyWordGrab(editor, initialRng);\n        }\n        if (selection.getRng().collapsed && !hasFakeSelection) {\n          var wrapper = makeAnnotation(editor.getDoc(), data, name, settings.decorate);\n          set$1(wrapper, nbsp);\n          selection.getRng().insertNode(wrapper.dom);\n          selection.select(wrapper.dom);\n        } else {\n          preserve(selection, false, function () {\n            runOnRanges(editor, function (selectionRng) {\n              annotate(editor, selectionRng, name, settings.decorate, data);\n            });\n          });\n        }\n      });\n    };\n\n    var Annotator = function (editor) {\n      var registry = create$2();\n      setup$1(editor, registry);\n      var changes = setup(editor);\n      return {\n        register: function (name, settings) {\n          registry.register(name, settings);\n        },\n        annotate: function (name, data) {\n          registry.lookup(name).each(function (settings) {\n            annotateWithBookmark(editor, name, settings, data);\n          });\n        },\n        annotationChanged: function (name, callback) {\n          changes.addListener(name, callback);\n        },\n        remove: function (name) {\n          identify(editor, Optional.some(name)).each(function (_a) {\n            var elements = _a.elements;\n            each(elements, unwrap);\n          });\n        },\n        getAll: function (name) {\n          var directory = findAll(editor, name);\n          return map$1(directory, function (elems) {\n            return map(elems, function (elem) {\n              return elem.dom;\n            });\n          });\n        }\n      };\n    };\n\n    function BookmarkManager(selection) {\n      return {\n        getBookmark: curry(getBookmark$1, selection),\n        moveToBookmark: curry(moveToBookmark, selection)\n      };\n    }\n    (function (BookmarkManager) {\n      BookmarkManager.isBookmarkNode = isBookmarkNode$1;\n    }(BookmarkManager || (BookmarkManager = {})));\n    var BookmarkManager$1 = BookmarkManager;\n\n    var getContentEditableRoot = function (root, node) {\n      while (node && node !== root) {\n        if (isContentEditableTrue(node) || isContentEditableFalse(node)) {\n          return node;\n        }\n        node = node.parentNode;\n      }\n      return null;\n    };\n\n    var isXYWithinRange = function (clientX, clientY, range) {\n      if (range.collapsed) {\n        return false;\n      }\n      if (Env.browser.isIE() && range.startOffset === range.endOffset - 1 && range.startContainer === range.endContainer) {\n        var elm = range.startContainer.childNodes[range.startOffset];\n        if (isElement$1(elm)) {\n          return exists(elm.getClientRects(), function (rect) {\n            return containsXY(rect, clientX, clientY);\n          });\n        }\n      }\n      return exists(range.getClientRects(), function (rect) {\n        return containsXY(rect, clientX, clientY);\n      });\n    };\n\n    var firePreProcess = function (editor, args) {\n      return editor.fire('PreProcess', args);\n    };\n    var firePostProcess = function (editor, args) {\n      return editor.fire('PostProcess', args);\n    };\n    var fireRemove = function (editor) {\n      return editor.fire('remove');\n    };\n    var fireDetach = function (editor) {\n      return editor.fire('detach');\n    };\n    var fireSwitchMode = function (editor, mode) {\n      return editor.fire('SwitchMode', { mode: mode });\n    };\n    var fireObjectResizeStart = function (editor, target, width, height, origin) {\n      editor.fire('ObjectResizeStart', {\n        target: target,\n        width: width,\n        height: height,\n        origin: origin\n      });\n    };\n    var fireObjectResized = function (editor, target, width, height, origin) {\n      editor.fire('ObjectResized', {\n        target: target,\n        width: width,\n        height: height,\n        origin: origin\n      });\n    };\n    var firePreInit = function (editor) {\n      return editor.fire('PreInit');\n    };\n    var firePostRender = function (editor) {\n      return editor.fire('PostRender');\n    };\n    var fireInit = function (editor) {\n      return editor.fire('Init');\n    };\n    var firePlaceholderToggle = function (editor, state) {\n      return editor.fire('PlaceholderToggle', { state: state });\n    };\n    var fireError = function (editor, errorType, error) {\n      return editor.fire(errorType, error);\n    };\n\n    var VK = {\n      BACKSPACE: 8,\n      DELETE: 46,\n      DOWN: 40,\n      ENTER: 13,\n      LEFT: 37,\n      RIGHT: 39,\n      SPACEBAR: 32,\n      TAB: 9,\n      UP: 38,\n      END: 35,\n      HOME: 36,\n      modifierPressed: function (e) {\n        return e.shiftKey || e.ctrlKey || e.altKey || this.metaKeyPressed(e);\n      },\n      metaKeyPressed: function (e) {\n        return Env.mac ? e.metaKey : e.ctrlKey && !e.altKey;\n      }\n    };\n\n    var isContentEditableFalse$6 = isContentEditableFalse;\n    var ControlSelection = function (selection, editor) {\n      var dom = editor.dom, each = Tools.each;\n      var selectedElm, selectedElmGhost, resizeHelper, selectedHandle;\n      var startX, startY, selectedElmX, selectedElmY, startW, startH, ratio, resizeStarted;\n      var width, height;\n      var editableDoc = editor.getDoc(), rootDocument = document;\n      var abs = Math.abs, round = Math.round, rootElement = editor.getBody();\n      var startScrollWidth, startScrollHeight;\n      var resizeHandles = {\n        nw: [\n          0,\n          0,\n          -1,\n          -1\n        ],\n        ne: [\n          1,\n          0,\n          1,\n          -1\n        ],\n        se: [\n          1,\n          1,\n          1,\n          1\n        ],\n        sw: [\n          0,\n          1,\n          -1,\n          1\n        ]\n      };\n      var isImage = function (elm) {\n        return elm && (elm.nodeName === 'IMG' || editor.dom.is(elm, 'figure.image'));\n      };\n      var isEventOnImageOutsideRange = function (evt, range) {\n        if (evt.type === 'longpress' || evt.type.indexOf('touch') === 0) {\n          var touch = evt.touches[0];\n          return isImage(evt.target) && !isXYWithinRange(touch.clientX, touch.clientY, range);\n        } else {\n          return isImage(evt.target) && !isXYWithinRange(evt.clientX, evt.clientY, range);\n        }\n      };\n      var contextMenuSelectImage = function (evt) {\n        var target = evt.target;\n        if (isEventOnImageOutsideRange(evt, editor.selection.getRng()) && !evt.isDefaultPrevented()) {\n          editor.selection.select(target);\n        }\n      };\n      var getResizeTarget = function (elm) {\n        return editor.dom.is(elm, 'figure.image') ? elm.querySelector('img') : elm;\n      };\n      var isResizable = function (elm) {\n        var selector = getObjectResizing(editor);\n        if (!selector) {\n          return false;\n        }\n        if (elm.getAttribute('data-mce-resize') === 'false') {\n          return false;\n        }\n        if (elm === editor.getBody()) {\n          return false;\n        }\n        return is$1(SugarElement.fromDom(elm), selector);\n      };\n      var setGhostElmSize = function (ghostElm, width, height) {\n        dom.setStyles(getResizeTarget(ghostElm), {\n          width: width,\n          height: height\n        });\n      };\n      var resizeGhostElement = function (e) {\n        var deltaX, deltaY, proportional;\n        var resizeHelperX, resizeHelperY;\n        deltaX = e.screenX - startX;\n        deltaY = e.screenY - startY;\n        width = deltaX * selectedHandle[2] + startW;\n        height = deltaY * selectedHandle[3] + startH;\n        width = width < 5 ? 5 : width;\n        height = height < 5 ? 5 : height;\n        if (isImage(selectedElm) && getResizeImgProportional(editor) !== false) {\n          proportional = !VK.modifierPressed(e);\n        } else {\n          proportional = VK.modifierPressed(e);\n        }\n        if (proportional) {\n          if (abs(deltaX) > abs(deltaY)) {\n            height = round(width * ratio);\n            width = round(height / ratio);\n          } else {\n            width = round(height / ratio);\n            height = round(width * ratio);\n          }\n        }\n        setGhostElmSize(selectedElmGhost, width, height);\n        resizeHelperX = selectedHandle.startPos.x + deltaX;\n        resizeHelperY = selectedHandle.startPos.y + deltaY;\n        resizeHelperX = resizeHelperX > 0 ? resizeHelperX : 0;\n        resizeHelperY = resizeHelperY > 0 ? resizeHelperY : 0;\n        dom.setStyles(resizeHelper, {\n          left: resizeHelperX,\n          top: resizeHelperY,\n          display: 'block'\n        });\n        resizeHelper.innerHTML = width + ' &times; ' + height;\n        if (selectedHandle[2] < 0 && selectedElmGhost.clientWidth <= width) {\n          dom.setStyle(selectedElmGhost, 'left', selectedElmX + (startW - width));\n        }\n        if (selectedHandle[3] < 0 && selectedElmGhost.clientHeight <= height) {\n          dom.setStyle(selectedElmGhost, 'top', selectedElmY + (startH - height));\n        }\n        deltaX = rootElement.scrollWidth - startScrollWidth;\n        deltaY = rootElement.scrollHeight - startScrollHeight;\n        if (deltaX + deltaY !== 0) {\n          dom.setStyles(resizeHelper, {\n            left: resizeHelperX - deltaX,\n            top: resizeHelperY - deltaY\n          });\n        }\n        if (!resizeStarted) {\n          fireObjectResizeStart(editor, selectedElm, startW, startH, 'corner-' + selectedHandle.name);\n          resizeStarted = true;\n        }\n      };\n      var endGhostResize = function () {\n        var wasResizeStarted = resizeStarted;\n        resizeStarted = false;\n        var setSizeProp = function (name, value) {\n          if (value) {\n            if (selectedElm.style[name] || !editor.schema.isValid(selectedElm.nodeName.toLowerCase(), name)) {\n              dom.setStyle(getResizeTarget(selectedElm), name, value);\n            } else {\n              dom.setAttrib(getResizeTarget(selectedElm), name, '' + value);\n            }\n          }\n        };\n        if (wasResizeStarted) {\n          setSizeProp('width', width);\n          setSizeProp('height', height);\n        }\n        dom.unbind(editableDoc, 'mousemove', resizeGhostElement);\n        dom.unbind(editableDoc, 'mouseup', endGhostResize);\n        if (rootDocument !== editableDoc) {\n          dom.unbind(rootDocument, 'mousemove', resizeGhostElement);\n          dom.unbind(rootDocument, 'mouseup', endGhostResize);\n        }\n        dom.remove(selectedElmGhost);\n        dom.remove(resizeHelper);\n        showResizeRect(selectedElm);\n        if (wasResizeStarted) {\n          fireObjectResized(editor, selectedElm, width, height, 'corner-' + selectedHandle.name);\n          dom.setAttrib(selectedElm, 'style', dom.getAttrib(selectedElm, 'style'));\n        }\n        editor.nodeChanged();\n      };\n      var showResizeRect = function (targetElm) {\n        hideResizeRect();\n        unbindResizeHandleEvents();\n        var position = dom.getPos(targetElm, rootElement);\n        var selectedElmX = position.x;\n        var selectedElmY = position.y;\n        var rect = targetElm.getBoundingClientRect();\n        var targetWidth = rect.width || rect.right - rect.left;\n        var targetHeight = rect.height || rect.bottom - rect.top;\n        if (selectedElm !== targetElm) {\n          selectedElm = targetElm;\n          width = height = 0;\n        }\n        var e = editor.fire('ObjectSelected', { target: targetElm });\n        if (isResizable(targetElm) && !e.isDefaultPrevented()) {\n          each(resizeHandles, function (handle, name) {\n            var handleElm;\n            var startDrag = function (e) {\n              startX = e.screenX;\n              startY = e.screenY;\n              startW = getResizeTarget(selectedElm).clientWidth;\n              startH = getResizeTarget(selectedElm).clientHeight;\n              ratio = startH / startW;\n              selectedHandle = handle;\n              selectedHandle.name = name;\n              selectedHandle.startPos = {\n                x: targetWidth * handle[0] + selectedElmX,\n                y: targetHeight * handle[1] + selectedElmY\n              };\n              startScrollWidth = rootElement.scrollWidth;\n              startScrollHeight = rootElement.scrollHeight;\n              selectedElmGhost = selectedElm.cloneNode(true);\n              dom.addClass(selectedElmGhost, 'mce-clonedresizable');\n              dom.setAttrib(selectedElmGhost, 'data-mce-bogus', 'all');\n              selectedElmGhost.contentEditable = false;\n              selectedElmGhost.unSelectabe = true;\n              dom.setStyles(selectedElmGhost, {\n                left: selectedElmX,\n                top: selectedElmY,\n                margin: 0\n              });\n              setGhostElmSize(selectedElmGhost, targetWidth, targetHeight);\n              selectedElmGhost.removeAttribute('data-mce-selected');\n              rootElement.appendChild(selectedElmGhost);\n              dom.bind(editableDoc, 'mousemove', resizeGhostElement);\n              dom.bind(editableDoc, 'mouseup', endGhostResize);\n              if (rootDocument !== editableDoc) {\n                dom.bind(rootDocument, 'mousemove', resizeGhostElement);\n                dom.bind(rootDocument, 'mouseup', endGhostResize);\n              }\n              resizeHelper = dom.add(rootElement, 'div', {\n                'class': 'mce-resize-helper',\n                'data-mce-bogus': 'all'\n              }, startW + ' &times; ' + startH);\n            };\n            handleElm = dom.get('mceResizeHandle' + name);\n            if (handleElm) {\n              dom.remove(handleElm);\n            }\n            handleElm = dom.add(rootElement, 'div', {\n              'id': 'mceResizeHandle' + name,\n              'data-mce-bogus': 'all',\n              'class': 'mce-resizehandle',\n              'unselectable': true,\n              'style': 'cursor:' + name + '-resize; margin:0; padding:0'\n            });\n            if (Env.ie === 11) {\n              handleElm.contentEditable = false;\n            }\n            dom.bind(handleElm, 'mousedown', function (e) {\n              e.stopImmediatePropagation();\n              e.preventDefault();\n              startDrag(e);\n            });\n            handle.elm = handleElm;\n            dom.setStyles(handleElm, {\n              left: targetWidth * handle[0] + selectedElmX - handleElm.offsetWidth / 2,\n              top: targetHeight * handle[1] + selectedElmY - handleElm.offsetHeight / 2\n            });\n          });\n        } else {\n          hideResizeRect();\n        }\n        selectedElm.setAttribute('data-mce-selected', '1');\n      };\n      var hideResizeRect = function () {\n        unbindResizeHandleEvents();\n        if (selectedElm) {\n          selectedElm.removeAttribute('data-mce-selected');\n        }\n        each$1(resizeHandles, function (value, name) {\n          var handleElm = dom.get('mceResizeHandle' + name);\n          if (handleElm) {\n            dom.unbind(handleElm);\n            dom.remove(handleElm);\n          }\n        });\n      };\n      var updateResizeRect = function (e) {\n        var startElm, controlElm;\n        var isChildOrEqual = function (node, parent) {\n          if (node) {\n            do {\n              if (node === parent) {\n                return true;\n              }\n            } while (node = node.parentNode);\n          }\n        };\n        if (resizeStarted || editor.removed) {\n          return;\n        }\n        each(dom.select('img[data-mce-selected],hr[data-mce-selected]'), function (img) {\n          img.removeAttribute('data-mce-selected');\n        });\n        controlElm = e.type === 'mousedown' ? e.target : selection.getNode();\n        controlElm = dom.$(controlElm).closest('table,img,figure.image,hr')[0];\n        if (isChildOrEqual(controlElm, rootElement)) {\n          disableGeckoResize();\n          startElm = selection.getStart(true);\n          if (isChildOrEqual(startElm, controlElm) && isChildOrEqual(selection.getEnd(true), controlElm)) {\n            showResizeRect(controlElm);\n            return;\n          }\n        }\n        hideResizeRect();\n      };\n      var isWithinContentEditableFalse = function (elm) {\n        return isContentEditableFalse$6(getContentEditableRoot(editor.getBody(), elm));\n      };\n      var unbindResizeHandleEvents = function () {\n        each$1(resizeHandles, function (handle) {\n          if (handle.elm) {\n            dom.unbind(handle.elm);\n            delete handle.elm;\n          }\n        });\n      };\n      var disableGeckoResize = function () {\n        try {\n          editor.getDoc().execCommand('enableObjectResizing', false, 'false');\n        } catch (ex) {\n        }\n      };\n      editor.on('init', function () {\n        disableGeckoResize();\n        if (Env.browser.isIE() || Env.browser.isEdge()) {\n          editor.on('mousedown click', function (e) {\n            var target = e.target, nodeName = target.nodeName;\n            if (!resizeStarted && /^(TABLE|IMG|HR)$/.test(nodeName) && !isWithinContentEditableFalse(target)) {\n              if (e.button !== 2) {\n                editor.selection.select(target, nodeName === 'TABLE');\n              }\n              if (e.type === 'mousedown') {\n                editor.nodeChanged();\n              }\n            }\n          });\n          var handleMSControlSelect_1 = function (e) {\n            var delayedSelect = function (node) {\n              Delay.setEditorTimeout(editor, function () {\n                return editor.selection.select(node);\n              });\n            };\n            if (isWithinContentEditableFalse(e.target) || isMedia(e.target)) {\n              e.preventDefault();\n              delayedSelect(e.target);\n              return;\n            }\n            if (/^(TABLE|IMG|HR)$/.test(e.target.nodeName)) {\n              e.preventDefault();\n              if (e.target.tagName === 'IMG') {\n                delayedSelect(e.target);\n              }\n            }\n          };\n          dom.bind(rootElement, 'mscontrolselect', handleMSControlSelect_1);\n          editor.on('remove', function () {\n            return dom.unbind(rootElement, 'mscontrolselect', handleMSControlSelect_1);\n          });\n        }\n        var throttledUpdateResizeRect = Delay.throttle(function (e) {\n          if (!editor.composing) {\n            updateResizeRect(e);\n          }\n        });\n        editor.on('nodechange ResizeEditor ResizeWindow ResizeContent drop FullscreenStateChanged', throttledUpdateResizeRect);\n        editor.on('keyup compositionend', function (e) {\n          if (selectedElm && selectedElm.nodeName === 'TABLE') {\n            throttledUpdateResizeRect(e);\n          }\n        });\n        editor.on('hide blur', hideResizeRect);\n        editor.on('contextmenu longpress', contextMenuSelectImage, true);\n      });\n      editor.on('remove', unbindResizeHandleEvents);\n      var destroy = function () {\n        selectedElm = selectedElmGhost = null;\n      };\n      return {\n        isResizable: isResizable,\n        showResizeRect: showResizeRect,\n        hideResizeRect: hideResizeRect,\n        updateResizeRect: updateResizeRect,\n        destroy: destroy\n      };\n    };\n\n    var hasCeProperty = function (node) {\n      return isContentEditableTrue(node) || isContentEditableFalse(node);\n    };\n    var findParent = function (node, rootNode, predicate) {\n      while (node && node !== rootNode) {\n        if (predicate(node)) {\n          return node;\n        }\n        node = node.parentNode;\n      }\n      return null;\n    };\n    var findClosestIeRange = function (clientX, clientY, doc) {\n      var rects;\n      var element = doc.elementFromPoint(clientX, clientY);\n      var rng = doc.body.createTextRange();\n      if (!element || element.tagName === 'HTML') {\n        element = doc.body;\n      }\n      rng.moveToElementText(element);\n      rects = Tools.toArray(rng.getClientRects());\n      rects = rects.sort(function (a, b) {\n        a = Math.abs(Math.max(a.top - clientY, a.bottom - clientY));\n        b = Math.abs(Math.max(b.top - clientY, b.bottom - clientY));\n        return a - b;\n      });\n      if (rects.length > 0) {\n        clientY = (rects[0].bottom + rects[0].top) / 2;\n        try {\n          rng.moveToPoint(clientX, clientY);\n          rng.collapse(true);\n          return rng;\n        } catch (ex) {\n        }\n      }\n      return null;\n    };\n    var moveOutOfContentEditableFalse = function (rng, rootNode) {\n      var parentElement = rng && rng.parentElement ? rng.parentElement() : null;\n      return isContentEditableFalse(findParent(parentElement, rootNode, hasCeProperty)) ? null : rng;\n    };\n    var fromPoint$1 = function (clientX, clientY, doc) {\n      var rng, point;\n      var pointDoc = doc;\n      if (pointDoc.caretPositionFromPoint) {\n        point = pointDoc.caretPositionFromPoint(clientX, clientY);\n        if (point) {\n          rng = doc.createRange();\n          rng.setStart(point.offsetNode, point.offset);\n          rng.collapse(true);\n        }\n      } else if (doc.caretRangeFromPoint) {\n        rng = doc.caretRangeFromPoint(clientX, clientY);\n      } else if (pointDoc.body.createTextRange) {\n        rng = pointDoc.body.createTextRange();\n        try {\n          rng.moveToPoint(clientX, clientY);\n          rng.collapse(true);\n        } catch (ex) {\n          rng = findClosestIeRange(clientX, clientY, doc);\n        }\n        return moveOutOfContentEditableFalse(rng, doc.body);\n      }\n      return rng;\n    };\n\n    var isEq$1 = function (rng1, rng2) {\n      return rng1 && rng2 && (rng1.startContainer === rng2.startContainer && rng1.startOffset === rng2.startOffset) && (rng1.endContainer === rng2.endContainer && rng1.endOffset === rng2.endOffset);\n    };\n\n    var findParent$1 = function (node, rootNode, predicate) {\n      while (node && node !== rootNode) {\n        if (predicate(node)) {\n          return node;\n        }\n        node = node.parentNode;\n      }\n      return null;\n    };\n    var hasParent = function (node, rootNode, predicate) {\n      return findParent$1(node, rootNode, predicate) !== null;\n    };\n    var hasParentWithName = function (node, rootNode, name) {\n      return hasParent(node, rootNode, function (node) {\n        return node.nodeName === name;\n      });\n    };\n    var isTable$3 = function (node) {\n      return node && node.nodeName === 'TABLE';\n    };\n    var isTableCell$3 = function (node) {\n      return node && /^(TD|TH|CAPTION)$/.test(node.nodeName);\n    };\n    var isCeFalseCaretContainer = function (node, rootNode) {\n      return isCaretContainer(node) && hasParent(node, rootNode, isCaretNode) === false;\n    };\n    var hasBrBeforeAfter = function (dom, node, left) {\n      var walker = new DomTreeWalker(node, dom.getParent(node.parentNode, dom.isBlock) || dom.getRoot());\n      while (node = walker[left ? 'prev' : 'next']()) {\n        if (isBr(node)) {\n          return true;\n        }\n      }\n    };\n    var isPrevNode = function (node, name) {\n      return node.previousSibling && node.previousSibling.nodeName === name;\n    };\n    var hasContentEditableFalseParent = function (body, node) {\n      while (node && node !== body) {\n        if (isContentEditableFalse(node)) {\n          return true;\n        }\n        node = node.parentNode;\n      }\n      return false;\n    };\n    var findTextNodeRelative = function (dom, isAfterNode, collapsed, left, startNode) {\n      var lastInlineElement;\n      var body = dom.getRoot();\n      var node;\n      var nonEmptyElementsMap = dom.schema.getNonEmptyElements();\n      var parentBlockContainer = dom.getParent(startNode.parentNode, dom.isBlock) || body;\n      if (left && isBr(startNode) && isAfterNode && dom.isEmpty(parentBlockContainer)) {\n        return Optional.some(CaretPosition(startNode.parentNode, dom.nodeIndex(startNode)));\n      }\n      var walker = new DomTreeWalker(startNode, parentBlockContainer);\n      while (node = walker[left ? 'prev' : 'next']()) {\n        if (dom.getContentEditableParent(node) === 'false' || isCeFalseCaretContainer(node, body)) {\n          return Optional.none();\n        }\n        if (isText$1(node) && node.nodeValue.length > 0) {\n          if (hasParentWithName(node, body, 'A') === false) {\n            return Optional.some(CaretPosition(node, left ? node.nodeValue.length : 0));\n          }\n          return Optional.none();\n        }\n        if (dom.isBlock(node) || nonEmptyElementsMap[node.nodeName.toLowerCase()]) {\n          return Optional.none();\n        }\n        lastInlineElement = node;\n      }\n      if (collapsed && lastInlineElement) {\n        return Optional.some(CaretPosition(lastInlineElement, 0));\n      }\n      return Optional.none();\n    };\n    var normalizeEndPoint = function (dom, collapsed, start, rng) {\n      var container, offset;\n      var body = dom.getRoot();\n      var node;\n      var directionLeft, normalized = false;\n      container = rng[(start ? 'start' : 'end') + 'Container'];\n      offset = rng[(start ? 'start' : 'end') + 'Offset'];\n      var isAfterNode = isElement$1(container) && offset === container.childNodes.length;\n      var nonEmptyElementsMap = dom.schema.getNonEmptyElements();\n      directionLeft = start;\n      if (isCaretContainer(container)) {\n        return Optional.none();\n      }\n      if (isElement$1(container) && offset > container.childNodes.length - 1) {\n        directionLeft = false;\n      }\n      if (isDocument$1(container)) {\n        container = body;\n        offset = 0;\n      }\n      if (container === body) {\n        if (directionLeft) {\n          node = container.childNodes[offset > 0 ? offset - 1 : 0];\n          if (node) {\n            if (isCaretContainer(node)) {\n              return Optional.none();\n            }\n            if (nonEmptyElementsMap[node.nodeName] || isTable$3(node)) {\n              return Optional.none();\n            }\n          }\n        }\n        if (container.hasChildNodes()) {\n          offset = Math.min(!directionLeft && offset > 0 ? offset - 1 : offset, container.childNodes.length - 1);\n          container = container.childNodes[offset];\n          offset = isText$1(container) && isAfterNode ? container.data.length : 0;\n          if (!collapsed && container === body.lastChild && isTable$3(container)) {\n            return Optional.none();\n          }\n          if (hasContentEditableFalseParent(body, container) || isCaretContainer(container)) {\n            return Optional.none();\n          }\n          if (container.hasChildNodes() && isTable$3(container) === false) {\n            node = container;\n            var walker = new DomTreeWalker(container, body);\n            do {\n              if (isContentEditableFalse(node) || isCaretContainer(node)) {\n                normalized = false;\n                break;\n              }\n              if (isText$1(node) && node.nodeValue.length > 0) {\n                offset = directionLeft ? 0 : node.nodeValue.length;\n                container = node;\n                normalized = true;\n                break;\n              }\n              if (nonEmptyElementsMap[node.nodeName.toLowerCase()] && !isTableCell$3(node)) {\n                offset = dom.nodeIndex(node);\n                container = node.parentNode;\n                if (!directionLeft) {\n                  offset++;\n                }\n                normalized = true;\n                break;\n              }\n            } while (node = directionLeft ? walker.next() : walker.prev());\n          }\n        }\n      }\n      if (collapsed) {\n        if (isText$1(container) && offset === 0) {\n          findTextNodeRelative(dom, isAfterNode, collapsed, true, container).each(function (pos) {\n            container = pos.container();\n            offset = pos.offset();\n            normalized = true;\n          });\n        }\n        if (isElement$1(container)) {\n          node = container.childNodes[offset];\n          if (!node) {\n            node = container.childNodes[offset - 1];\n          }\n          if (node && isBr(node) && !isPrevNode(node, 'A') && !hasBrBeforeAfter(dom, node, false) && !hasBrBeforeAfter(dom, node, true)) {\n            findTextNodeRelative(dom, isAfterNode, collapsed, true, node).each(function (pos) {\n              container = pos.container();\n              offset = pos.offset();\n              normalized = true;\n            });\n          }\n        }\n      }\n      if (directionLeft && !collapsed && isText$1(container) && offset === container.nodeValue.length) {\n        findTextNodeRelative(dom, isAfterNode, collapsed, false, container).each(function (pos) {\n          container = pos.container();\n          offset = pos.offset();\n          normalized = true;\n        });\n      }\n      return normalized ? Optional.some(CaretPosition(container, offset)) : Optional.none();\n    };\n    var normalize = function (dom, rng) {\n      var collapsed = rng.collapsed, normRng = rng.cloneRange();\n      var startPos = CaretPosition.fromRangeStart(rng);\n      normalizeEndPoint(dom, collapsed, true, normRng).each(function (pos) {\n        if (!collapsed || !CaretPosition.isAbove(startPos, pos)) {\n          normRng.setStart(pos.container(), pos.offset());\n        }\n      });\n      if (!collapsed) {\n        normalizeEndPoint(dom, collapsed, false, normRng).each(function (pos) {\n          normRng.setEnd(pos.container(), pos.offset());\n        });\n      }\n      if (collapsed) {\n        normRng.collapse(true);\n      }\n      return isEq$1(rng, normRng) ? Optional.none() : Optional.some(normRng);\n    };\n\n    var splitText = function (node, offset) {\n      return node.splitText(offset);\n    };\n    var split$1 = function (rng) {\n      var startContainer = rng.startContainer, startOffset = rng.startOffset, endContainer = rng.endContainer, endOffset = rng.endOffset;\n      if (startContainer === endContainer && isText$1(startContainer)) {\n        if (startOffset > 0 && startOffset < startContainer.nodeValue.length) {\n          endContainer = splitText(startContainer, startOffset);\n          startContainer = endContainer.previousSibling;\n          if (endOffset > startOffset) {\n            endOffset = endOffset - startOffset;\n            startContainer = endContainer = splitText(endContainer, endOffset).previousSibling;\n            endOffset = endContainer.nodeValue.length;\n            startOffset = 0;\n          } else {\n            endOffset = 0;\n          }\n        }\n      } else {\n        if (isText$1(startContainer) && startOffset > 0 && startOffset < startContainer.nodeValue.length) {\n          startContainer = splitText(startContainer, startOffset);\n          startOffset = 0;\n        }\n        if (isText$1(endContainer) && endOffset > 0 && endOffset < endContainer.nodeValue.length) {\n          endContainer = splitText(endContainer, endOffset).previousSibling;\n          endOffset = endContainer.nodeValue.length;\n        }\n      }\n      return {\n        startContainer: startContainer,\n        startOffset: startOffset,\n        endContainer: endContainer,\n        endOffset: endOffset\n      };\n    };\n\n    function RangeUtils(dom) {\n      var walk = function (rng, callback) {\n        return walk$1(dom, rng, callback);\n      };\n      var split = split$1;\n      var normalize$1 = function (rng) {\n        return normalize(dom, rng).fold(never, function (normalizedRng) {\n          rng.setStart(normalizedRng.startContainer, normalizedRng.startOffset);\n          rng.setEnd(normalizedRng.endContainer, normalizedRng.endOffset);\n          return true;\n        });\n      };\n      return {\n        walk: walk,\n        split: split,\n        normalize: normalize$1\n      };\n    }\n    (function (RangeUtils) {\n      RangeUtils.compareRanges = isEq$1;\n      RangeUtils.getCaretRangeFromPoint = fromPoint$1;\n      RangeUtils.getSelectedNode = getSelectedNode;\n      RangeUtils.getNode = getNode;\n    }(RangeUtils || (RangeUtils = {})));\n    var RangeUtils$1 = RangeUtils;\n\n    function Dimension (name, getOffset) {\n      var set = function (element, h) {\n        if (!isNumber(h) && !h.match(/^[0-9]+$/)) {\n          throw new Error(name + '.set accepts only positive integer values. Value was ' + h);\n        }\n        var dom = element.dom;\n        if (isSupported$1(dom)) {\n          dom.style[name] = h + 'px';\n        }\n      };\n      var get = function (element) {\n        var r = getOffset(element);\n        if (r <= 0 || r === null) {\n          var css = get$4(element, name);\n          return parseFloat(css) || 0;\n        }\n        return r;\n      };\n      var getOuter = get;\n      var aggregate = function (element, properties) {\n        return foldl(properties, function (acc, property) {\n          var val = get$4(element, property);\n          var value = val === undefined ? 0 : parseInt(val, 10);\n          return isNaN(value) ? acc : acc + value;\n        }, 0);\n      };\n      var max = function (element, value, properties) {\n        var cumulativeInclusions = aggregate(element, properties);\n        var absoluteMax = value > cumulativeInclusions ? value - cumulativeInclusions : 0;\n        return absoluteMax;\n      };\n      return {\n        set: set,\n        get: get,\n        getOuter: getOuter,\n        aggregate: aggregate,\n        max: max\n      };\n    }\n\n    var api$1 = Dimension('height', function (element) {\n      var dom = element.dom;\n      return inBody(element) ? dom.getBoundingClientRect().height : dom.offsetHeight;\n    });\n    var get$8 = function (element) {\n      return api$1.get(element);\n    };\n\n    var walkUp = function (navigation, doc) {\n      var frame = navigation.view(doc);\n      return frame.fold(constant([]), function (f) {\n        var parent = navigation.owner(f);\n        var rest = walkUp(navigation, parent);\n        return [f].concat(rest);\n      });\n    };\n    var pathTo = function (element, navigation) {\n      var d = navigation.owner(element);\n      return walkUp(navigation, d);\n    };\n\n    var view = function (doc) {\n      var _a;\n      var element = doc.dom === document ? Optional.none() : Optional.from((_a = doc.dom.defaultView) === null || _a === void 0 ? void 0 : _a.frameElement);\n      return element.map(SugarElement.fromDom);\n    };\n    var owner$1 = function (element) {\n      return documentOrOwner(element);\n    };\n\n    var Navigation = /*#__PURE__*/Object.freeze({\n        __proto__: null,\n        view: view,\n        owner: owner$1\n    });\n\n    var find$2 = function (element) {\n      var doc = SugarElement.fromDom(document);\n      var scroll = get$1(doc);\n      var frames = pathTo(element, Navigation);\n      var offset = viewport(element);\n      var r = foldr(frames, function (b, a) {\n        var loc = viewport(a);\n        return {\n          left: b.left + loc.left,\n          top: b.top + loc.top\n        };\n      }, {\n        left: 0,\n        top: 0\n      });\n      return SugarPosition(r.left + offset.left + scroll.left, r.top + offset.top + scroll.top);\n    };\n\n    var excludeFromDescend = function (element) {\n      return name(element) === 'textarea';\n    };\n    var fireScrollIntoViewEvent = function (editor, data) {\n      var scrollEvent = editor.fire('ScrollIntoView', data);\n      return scrollEvent.isDefaultPrevented();\n    };\n    var fireAfterScrollIntoViewEvent = function (editor, data) {\n      editor.fire('AfterScrollIntoView', data);\n    };\n    var descend = function (element, offset) {\n      var children$1 = children(element);\n      if (children$1.length === 0 || excludeFromDescend(element)) {\n        return {\n          element: element,\n          offset: offset\n        };\n      } else if (offset < children$1.length && !excludeFromDescend(children$1[offset])) {\n        return {\n          element: children$1[offset],\n          offset: 0\n        };\n      } else {\n        var last = children$1[children$1.length - 1];\n        if (excludeFromDescend(last)) {\n          return {\n            element: element,\n            offset: offset\n          };\n        } else {\n          if (name(last) === 'img') {\n            return {\n              element: last,\n              offset: 1\n            };\n          } else if (isText(last)) {\n            return {\n              element: last,\n              offset: get$7(last).length\n            };\n          } else {\n            return {\n              element: last,\n              offset: children(last).length\n            };\n          }\n        }\n      }\n    };\n    var markerInfo = function (element, cleanupFun) {\n      var pos = absolute(element);\n      var height = get$8(element);\n      return {\n        element: element,\n        bottom: pos.top + height,\n        height: height,\n        pos: pos,\n        cleanup: cleanupFun\n      };\n    };\n    var createMarker = function (element, offset) {\n      var startPoint = descend(element, offset);\n      var span = SugarElement.fromHtml('<span data-mce-bogus=\"all\">' + ZWSP + '</span>');\n      before(startPoint.element, span);\n      return markerInfo(span, function () {\n        return remove(span);\n      });\n    };\n    var elementMarker = function (element) {\n      return markerInfo(SugarElement.fromDom(element), noop);\n    };\n    var withMarker = function (editor, f, rng, alignToTop) {\n      preserveWith(editor, function (_s, _e) {\n        return applyWithMarker(editor, f, rng, alignToTop);\n      }, rng);\n    };\n    var withScrollEvents = function (editor, doc, f, marker, alignToTop) {\n      var data = {\n        elm: marker.element.dom,\n        alignToTop: alignToTop\n      };\n      if (fireScrollIntoViewEvent(editor, data)) {\n        return;\n      }\n      var scrollTop = get$1(doc).top;\n      f(doc, scrollTop, marker, alignToTop);\n      fireAfterScrollIntoViewEvent(editor, data);\n    };\n    var applyWithMarker = function (editor, f, rng, alignToTop) {\n      var body = SugarElement.fromDom(editor.getBody());\n      var doc = SugarElement.fromDom(editor.getDoc());\n      reflow(body);\n      var marker = createMarker(SugarElement.fromDom(rng.startContainer), rng.startOffset);\n      withScrollEvents(editor, doc, f, marker, alignToTop);\n      marker.cleanup();\n    };\n    var withElement = function (editor, element, f, alignToTop) {\n      var doc = SugarElement.fromDom(editor.getDoc());\n      withScrollEvents(editor, doc, f, elementMarker(element), alignToTop);\n    };\n    var preserveWith = function (editor, f, rng) {\n      var startElement = rng.startContainer;\n      var startOffset = rng.startOffset;\n      var endElement = rng.endContainer;\n      var endOffset = rng.endOffset;\n      f(SugarElement.fromDom(startElement), SugarElement.fromDom(endElement));\n      var newRng = editor.dom.createRng();\n      newRng.setStart(startElement, startOffset);\n      newRng.setEnd(endElement, endOffset);\n      editor.selection.setRng(rng);\n    };\n    var scrollToMarker = function (marker, viewHeight, alignToTop, doc) {\n      var pos = marker.pos;\n      if (alignToTop) {\n        to(pos.left, pos.top, doc);\n      } else {\n        var y = pos.top - viewHeight + marker.height;\n        to(pos.left, y, doc);\n      }\n    };\n    var intoWindowIfNeeded = function (doc, scrollTop, viewHeight, marker, alignToTop) {\n      var viewportBottom = viewHeight + scrollTop;\n      var markerTop = marker.pos.top;\n      var markerBottom = marker.bottom;\n      var largerThanViewport = markerBottom - markerTop >= viewHeight;\n      if (markerTop < scrollTop) {\n        scrollToMarker(marker, viewHeight, alignToTop !== false, doc);\n      } else if (markerTop > viewportBottom) {\n        var align = largerThanViewport ? alignToTop !== false : alignToTop === true;\n        scrollToMarker(marker, viewHeight, align, doc);\n      } else if (markerBottom > viewportBottom && !largerThanViewport) {\n        scrollToMarker(marker, viewHeight, alignToTop === true, doc);\n      }\n    };\n    var intoWindow = function (doc, scrollTop, marker, alignToTop) {\n      var viewHeight = doc.dom.defaultView.innerHeight;\n      intoWindowIfNeeded(doc, scrollTop, viewHeight, marker, alignToTop);\n    };\n    var intoFrame = function (doc, scrollTop, marker, alignToTop) {\n      var frameViewHeight = doc.dom.defaultView.innerHeight;\n      intoWindowIfNeeded(doc, scrollTop, frameViewHeight, marker, alignToTop);\n      var op = find$2(marker.element);\n      var viewportBounds = getBounds(window);\n      if (op.top < viewportBounds.y) {\n        intoView(marker.element, alignToTop !== false);\n      } else if (op.top > viewportBounds.bottom) {\n        intoView(marker.element, alignToTop === true);\n      }\n    };\n    var rangeIntoWindow = function (editor, rng, alignToTop) {\n      return withMarker(editor, intoWindow, rng, alignToTop);\n    };\n    var elementIntoWindow = function (editor, element, alignToTop) {\n      return withElement(editor, element, intoWindow, alignToTop);\n    };\n    var rangeIntoFrame = function (editor, rng, alignToTop) {\n      return withMarker(editor, intoFrame, rng, alignToTop);\n    };\n    var elementIntoFrame = function (editor, element, alignToTop) {\n      return withElement(editor, element, intoFrame, alignToTop);\n    };\n    var scrollElementIntoView = function (editor, element, alignToTop) {\n      var scroller = editor.inline ? elementIntoWindow : elementIntoFrame;\n      scroller(editor, element, alignToTop);\n    };\n    var scrollRangeIntoView = function (editor, rng, alignToTop) {\n      var scroller = editor.inline ? rangeIntoWindow : rangeIntoFrame;\n      scroller(editor, rng, alignToTop);\n    };\n\n    var getDocument = function () {\n      return SugarElement.fromDom(document);\n    };\n\n    var focus = function (element) {\n      return element.dom.focus();\n    };\n    var hasFocus = function (element) {\n      var root = getRootNode(element).dom;\n      return element.dom === root.activeElement;\n    };\n    var active = function (root) {\n      if (root === void 0) {\n        root = getDocument();\n      }\n      return Optional.from(root.dom.activeElement).map(SugarElement.fromDom);\n    };\n    var search = function (element) {\n      return active(getRootNode(element)).filter(function (e) {\n        return element.dom.contains(e.dom);\n      });\n    };\n\n    var create$4 = function (start, soffset, finish, foffset) {\n      return {\n        start: start,\n        soffset: soffset,\n        finish: finish,\n        foffset: foffset\n      };\n    };\n    var SimRange = { create: create$4 };\n\n    var adt = Adt.generate([\n      { before: ['element'] },\n      {\n        on: [\n          'element',\n          'offset'\n        ]\n      },\n      { after: ['element'] }\n    ]);\n    var cata = function (subject, onBefore, onOn, onAfter) {\n      return subject.fold(onBefore, onOn, onAfter);\n    };\n    var getStart = function (situ) {\n      return situ.fold(identity, identity, identity);\n    };\n    var before$3 = adt.before;\n    var on = adt.on;\n    var after$2 = adt.after;\n    var Situ = {\n      before: before$3,\n      on: on,\n      after: after$2,\n      cata: cata,\n      getStart: getStart\n    };\n\n    var adt$1 = Adt.generate([\n      { domRange: ['rng'] },\n      {\n        relative: [\n          'startSitu',\n          'finishSitu'\n        ]\n      },\n      {\n        exact: [\n          'start',\n          'soffset',\n          'finish',\n          'foffset'\n        ]\n      }\n    ]);\n    var exactFromRange = function (simRange) {\n      return adt$1.exact(simRange.start, simRange.soffset, simRange.finish, simRange.foffset);\n    };\n    var getStart$1 = function (selection) {\n      return selection.match({\n        domRange: function (rng) {\n          return SugarElement.fromDom(rng.startContainer);\n        },\n        relative: function (startSitu, _finishSitu) {\n          return Situ.getStart(startSitu);\n        },\n        exact: function (start, _soffset, _finish, _foffset) {\n          return start;\n        }\n      });\n    };\n    var domRange = adt$1.domRange;\n    var relative = adt$1.relative;\n    var exact = adt$1.exact;\n    var getWin = function (selection) {\n      var start = getStart$1(selection);\n      return defaultView(start);\n    };\n    var range = SimRange.create;\n    var SimSelection = {\n      domRange: domRange,\n      relative: relative,\n      exact: exact,\n      exactFromRange: exactFromRange,\n      getWin: getWin,\n      range: range\n    };\n\n    var browser$3 = detect$3().browser;\n    var clamp = function (offset, element) {\n      var max = isText(element) ? get$7(element).length : children(element).length + 1;\n      if (offset > max) {\n        return max;\n      } else if (offset < 0) {\n        return 0;\n      }\n      return offset;\n    };\n    var normalizeRng = function (rng) {\n      return SimSelection.range(rng.start, clamp(rng.soffset, rng.start), rng.finish, clamp(rng.foffset, rng.finish));\n    };\n    var isOrContains = function (root, elm) {\n      return !isRestrictedNode(elm.dom) && (contains$2(root, elm) || eq$2(root, elm));\n    };\n    var isRngInRoot = function (root) {\n      return function (rng) {\n        return isOrContains(root, rng.start) && isOrContains(root, rng.finish);\n      };\n    };\n    var shouldStore = function (editor) {\n      return editor.inline === true || browser$3.isIE();\n    };\n    var nativeRangeToSelectionRange = function (r) {\n      return SimSelection.range(SugarElement.fromDom(r.startContainer), r.startOffset, SugarElement.fromDom(r.endContainer), r.endOffset);\n    };\n    var readRange = function (win) {\n      var selection = win.getSelection();\n      var rng = !selection || selection.rangeCount === 0 ? Optional.none() : Optional.from(selection.getRangeAt(0));\n      return rng.map(nativeRangeToSelectionRange);\n    };\n    var getBookmark$2 = function (root) {\n      var win = defaultView(root);\n      return readRange(win.dom).filter(isRngInRoot(root));\n    };\n    var validate = function (root, bookmark) {\n      return Optional.from(bookmark).filter(isRngInRoot(root)).map(normalizeRng);\n    };\n    var bookmarkToNativeRng = function (bookmark) {\n      var rng = document.createRange();\n      try {\n        rng.setStart(bookmark.start.dom, bookmark.soffset);\n        rng.setEnd(bookmark.finish.dom, bookmark.foffset);\n        return Optional.some(rng);\n      } catch (_) {\n        return Optional.none();\n      }\n    };\n    var store = function (editor) {\n      var newBookmark = shouldStore(editor) ? getBookmark$2(SugarElement.fromDom(editor.getBody())) : Optional.none();\n      editor.bookmark = newBookmark.isSome() ? newBookmark : editor.bookmark;\n    };\n    var storeNative = function (editor, rng) {\n      var root = SugarElement.fromDom(editor.getBody());\n      var range = shouldStore(editor) ? Optional.from(rng) : Optional.none();\n      var newBookmark = range.map(nativeRangeToSelectionRange).filter(isRngInRoot(root));\n      editor.bookmark = newBookmark.isSome() ? newBookmark : editor.bookmark;\n    };\n    var getRng = function (editor) {\n      var bookmark = editor.bookmark ? editor.bookmark : Optional.none();\n      return bookmark.bind(function (x) {\n        return validate(SugarElement.fromDom(editor.getBody()), x);\n      }).bind(bookmarkToNativeRng);\n    };\n    var restore = function (editor) {\n      getRng(editor).each(function (rng) {\n        return editor.selection.setRng(rng);\n      });\n    };\n\n    var isEditorUIElement = function (elm) {\n      var className = elm.className.toString();\n      return className.indexOf('tox-') !== -1 || className.indexOf('mce-') !== -1;\n    };\n    var FocusManager = { isEditorUIElement: isEditorUIElement };\n\n    var isManualNodeChange = function (e) {\n      return e.type === 'nodechange' && e.selectionChange;\n    };\n    var registerPageMouseUp = function (editor, throttledStore) {\n      var mouseUpPage = function () {\n        throttledStore.throttle();\n      };\n      DOMUtils$1.DOM.bind(document, 'mouseup', mouseUpPage);\n      editor.on('remove', function () {\n        DOMUtils$1.DOM.unbind(document, 'mouseup', mouseUpPage);\n      });\n    };\n    var registerFocusOut = function (editor) {\n      editor.on('focusout', function () {\n        store(editor);\n      });\n    };\n    var registerMouseUp = function (editor, throttledStore) {\n      editor.on('mouseup touchend', function (_e) {\n        throttledStore.throttle();\n      });\n    };\n    var registerEditorEvents = function (editor, throttledStore) {\n      var browser = detect$3().browser;\n      if (browser.isIE()) {\n        registerFocusOut(editor);\n      } else {\n        registerMouseUp(editor, throttledStore);\n      }\n      editor.on('keyup NodeChange', function (e) {\n        if (!isManualNodeChange(e)) {\n          store(editor);\n        }\n      });\n    };\n    var register = function (editor) {\n      var throttledStore = first(function () {\n        store(editor);\n      }, 0);\n      editor.on('init', function () {\n        if (editor.inline) {\n          registerPageMouseUp(editor, throttledStore);\n        }\n        registerEditorEvents(editor, throttledStore);\n      });\n      editor.on('remove', function () {\n        throttledStore.cancel();\n      });\n    };\n\n    var documentFocusInHandler;\n    var DOM$2 = DOMUtils$1.DOM;\n    var isEditorUIElement$1 = function (elm) {\n      return FocusManager.isEditorUIElement(elm);\n    };\n    var isEditorContentAreaElement = function (elm) {\n      var classList = elm.classList;\n      if (classList !== undefined) {\n        return classList.contains('tox-edit-area') || classList.contains('tox-edit-area__iframe') || classList.contains('mce-content-body');\n      } else {\n        return false;\n      }\n    };\n    var isUIElement = function (editor, elm) {\n      var customSelector = getCustomUiSelector(editor);\n      var parent = DOM$2.getParent(elm, function (elm) {\n        return isEditorUIElement$1(elm) || (customSelector ? editor.dom.is(elm, customSelector) : false);\n      });\n      return parent !== null;\n    };\n    var getActiveElement = function (editor) {\n      try {\n        var root = getRootNode(SugarElement.fromDom(editor.getElement()));\n        return active(root).fold(function () {\n          return document.body;\n        }, function (x) {\n          return x.dom;\n        });\n      } catch (ex) {\n        return document.body;\n      }\n    };\n    var registerEvents = function (editorManager, e) {\n      var editor = e.editor;\n      register(editor);\n      editor.on('focusin', function () {\n        var self = this;\n        var focusedEditor = editorManager.focusedEditor;\n        if (focusedEditor !== self) {\n          if (focusedEditor) {\n            focusedEditor.fire('blur', { focusedEditor: self });\n          }\n          editorManager.setActive(self);\n          editorManager.focusedEditor = self;\n          self.fire('focus', { blurredEditor: focusedEditor });\n          self.focus(true);\n        }\n      });\n      editor.on('focusout', function () {\n        var self = this;\n        Delay.setEditorTimeout(self, function () {\n          var focusedEditor = editorManager.focusedEditor;\n          if (!isUIElement(self, getActiveElement(self)) && focusedEditor === self) {\n            self.fire('blur', { focusedEditor: null });\n            editorManager.focusedEditor = null;\n          }\n        });\n      });\n      if (!documentFocusInHandler) {\n        documentFocusInHandler = function (e) {\n          var activeEditor = editorManager.activeEditor;\n          if (activeEditor) {\n            getOriginalEventTarget(e).each(function (target) {\n              if (target.ownerDocument === document) {\n                if (target !== document.body && !isUIElement(activeEditor, target) && editorManager.focusedEditor === activeEditor) {\n                  activeEditor.fire('blur', { focusedEditor: null });\n                  editorManager.focusedEditor = null;\n                }\n              }\n            });\n          }\n        };\n        DOM$2.bind(document, 'focusin', documentFocusInHandler);\n      }\n    };\n    var unregisterDocumentEvents = function (editorManager, e) {\n      if (editorManager.focusedEditor === e.editor) {\n        editorManager.focusedEditor = null;\n      }\n      if (!editorManager.activeEditor) {\n        DOM$2.unbind(document, 'focusin', documentFocusInHandler);\n        documentFocusInHandler = null;\n      }\n    };\n    var setup$2 = function (editorManager) {\n      editorManager.on('AddEditor', curry(registerEvents, editorManager));\n      editorManager.on('RemoveEditor', curry(unregisterDocumentEvents, editorManager));\n    };\n\n    var getContentEditableHost = function (editor, node) {\n      return editor.dom.getParent(node, function (node) {\n        return editor.dom.getContentEditable(node) === 'true';\n      });\n    };\n    var getCollapsedNode = function (rng) {\n      return rng.collapsed ? Optional.from(getNode(rng.startContainer, rng.startOffset)).map(SugarElement.fromDom) : Optional.none();\n    };\n    var getFocusInElement = function (root, rng) {\n      return getCollapsedNode(rng).bind(function (node) {\n        if (isTableSection(node)) {\n          return Optional.some(node);\n        } else if (contains$2(root, node) === false) {\n          return Optional.some(root);\n        } else {\n          return Optional.none();\n        }\n      });\n    };\n    var normalizeSelection = function (editor, rng) {\n      getFocusInElement(SugarElement.fromDom(editor.getBody()), rng).bind(function (elm) {\n        return firstPositionIn(elm.dom);\n      }).fold(function () {\n        editor.selection.normalize();\n        return;\n      }, function (caretPos) {\n        return editor.selection.setRng(caretPos.toRange());\n      });\n    };\n    var focusBody = function (body) {\n      if (body.setActive) {\n        try {\n          body.setActive();\n        } catch (ex) {\n          body.focus();\n        }\n      } else {\n        body.focus();\n      }\n    };\n    var hasElementFocus = function (elm) {\n      return hasFocus(elm) || search(elm).isSome();\n    };\n    var hasIframeFocus = function (editor) {\n      return editor.iframeElement && hasFocus(SugarElement.fromDom(editor.iframeElement));\n    };\n    var hasInlineFocus = function (editor) {\n      var rawBody = editor.getBody();\n      return rawBody && hasElementFocus(SugarElement.fromDom(rawBody));\n    };\n    var hasUiFocus = function (editor) {\n      return active().filter(function (elem) {\n        return !isEditorContentAreaElement(elem.dom) && isUIElement(editor, elem.dom);\n      }).isSome();\n    };\n    var hasFocus$1 = function (editor) {\n      return editor.inline ? hasInlineFocus(editor) : hasIframeFocus(editor);\n    };\n    var hasEditorOrUiFocus = function (editor) {\n      return hasFocus$1(editor) || hasUiFocus(editor);\n    };\n    var focusEditor = function (editor) {\n      var selection = editor.selection;\n      var body = editor.getBody();\n      var rng = selection.getRng();\n      editor.quirks.refreshContentEditable();\n      if (editor.bookmark !== undefined && hasFocus$1(editor) === false) {\n        getRng(editor).each(function (bookmarkRng) {\n          editor.selection.setRng(bookmarkRng);\n          rng = bookmarkRng;\n        });\n      }\n      var contentEditableHost = getContentEditableHost(editor, selection.getNode());\n      if (editor.$.contains(body, contentEditableHost)) {\n        focusBody(contentEditableHost);\n        normalizeSelection(editor, rng);\n        activateEditor(editor);\n        return;\n      }\n      if (!editor.inline) {\n        if (!Env.opera) {\n          focusBody(body);\n        }\n        editor.getWin().focus();\n      }\n      if (Env.gecko || editor.inline) {\n        focusBody(body);\n        normalizeSelection(editor, rng);\n      }\n      activateEditor(editor);\n    };\n    var activateEditor = function (editor) {\n      return editor.editorManager.setActive(editor);\n    };\n    var focus$1 = function (editor, skipFocus) {\n      if (editor.removed) {\n        return;\n      }\n      skipFocus ? activateEditor(editor) : focusEditor(editor);\n    };\n\n    var getEndpointElement = function (root, rng, start, real, resolve) {\n      var container = start ? rng.startContainer : rng.endContainer;\n      var offset = start ? rng.startOffset : rng.endOffset;\n      return Optional.from(container).map(SugarElement.fromDom).map(function (elm) {\n        return !real || !rng.collapsed ? child(elm, resolve(elm, offset)).getOr(elm) : elm;\n      }).bind(function (elm) {\n        return isElement(elm) ? Optional.some(elm) : parent(elm).filter(isElement);\n      }).map(function (elm) {\n        return elm.dom;\n      }).getOr(root);\n    };\n    var getStart$2 = function (root, rng, real) {\n      return getEndpointElement(root, rng, true, real, function (elm, offset) {\n        return Math.min(childNodesCount(elm), offset);\n      });\n    };\n    var getEnd = function (root, rng, real) {\n      return getEndpointElement(root, rng, false, real, function (elm, offset) {\n        return offset > 0 ? offset - 1 : offset;\n      });\n    };\n    var skipEmptyTextNodes = function (node, forwards) {\n      var orig = node;\n      while (node && isText$1(node) && node.length === 0) {\n        node = forwards ? node.nextSibling : node.previousSibling;\n      }\n      return node || orig;\n    };\n    var getNode$1 = function (root, rng) {\n      var elm, startContainer, endContainer;\n      if (!rng) {\n        return root;\n      }\n      startContainer = rng.startContainer;\n      endContainer = rng.endContainer;\n      var startOffset = rng.startOffset;\n      var endOffset = rng.endOffset;\n      elm = rng.commonAncestorContainer;\n      if (!rng.collapsed) {\n        if (startContainer === endContainer) {\n          if (endOffset - startOffset < 2) {\n            if (startContainer.hasChildNodes()) {\n              elm = startContainer.childNodes[startOffset];\n            }\n          }\n        }\n        if (startContainer.nodeType === 3 && endContainer.nodeType === 3) {\n          if (startContainer.length === startOffset) {\n            startContainer = skipEmptyTextNodes(startContainer.nextSibling, true);\n          } else {\n            startContainer = startContainer.parentNode;\n          }\n          if (endOffset === 0) {\n            endContainer = skipEmptyTextNodes(endContainer.previousSibling, false);\n          } else {\n            endContainer = endContainer.parentNode;\n          }\n          if (startContainer && startContainer === endContainer) {\n            return startContainer;\n          }\n        }\n      }\n      if (elm && elm.nodeType === 3) {\n        return elm.parentNode;\n      }\n      return elm;\n    };\n    var getSelectedBlocks = function (dom, rng, startElm, endElm) {\n      var node;\n      var selectedBlocks = [];\n      var root = dom.getRoot();\n      startElm = dom.getParent(startElm || getStart$2(root, rng, rng.collapsed), dom.isBlock);\n      endElm = dom.getParent(endElm || getEnd(root, rng, rng.collapsed), dom.isBlock);\n      if (startElm && startElm !== root) {\n        selectedBlocks.push(startElm);\n      }\n      if (startElm && endElm && startElm !== endElm) {\n        node = startElm;\n        var walker = new DomTreeWalker(startElm, root);\n        while ((node = walker.next()) && node !== endElm) {\n          if (dom.isBlock(node)) {\n            selectedBlocks.push(node);\n          }\n        }\n      }\n      if (endElm && startElm !== endElm && endElm !== root) {\n        selectedBlocks.push(endElm);\n      }\n      return selectedBlocks;\n    };\n    var select$1 = function (dom, node, content) {\n      return Optional.from(node).map(function (node) {\n        var idx = dom.nodeIndex(node);\n        var rng = dom.createRng();\n        rng.setStart(node.parentNode, idx);\n        rng.setEnd(node.parentNode, idx + 1);\n        if (content) {\n          moveEndPoint$1(dom, rng, node, true);\n          moveEndPoint$1(dom, rng, node, false);\n        }\n        return rng;\n      });\n    };\n\n    var processRanges = function (editor, ranges) {\n      return map(ranges, function (range) {\n        var evt = editor.fire('GetSelectionRange', { range: range });\n        return evt.range !== range ? evt.range : range;\n      });\n    };\n\n    var typeLookup = {\n      '#text': 3,\n      '#comment': 8,\n      '#cdata': 4,\n      '#pi': 7,\n      '#doctype': 10,\n      '#document-fragment': 11\n    };\n    var walk$2 = function (node, root, prev) {\n      var startName = prev ? 'lastChild' : 'firstChild';\n      var siblingName = prev ? 'prev' : 'next';\n      if (node[startName]) {\n        return node[startName];\n      }\n      if (node !== root) {\n        var sibling = node[siblingName];\n        if (sibling) {\n          return sibling;\n        }\n        for (var parent_1 = node.parent; parent_1 && parent_1 !== root; parent_1 = parent_1.parent) {\n          sibling = parent_1[siblingName];\n          if (sibling) {\n            return sibling;\n          }\n        }\n      }\n    };\n    var isEmptyTextNode$1 = function (node) {\n      if (!isWhitespaceText(node.value)) {\n        return false;\n      }\n      var parentNode = node.parent;\n      if (parentNode && (parentNode.name !== 'span' || parentNode.attr('style')) && /^[ ]+$/.test(node.value)) {\n        return false;\n      }\n      return true;\n    };\n    var isNonEmptyElement = function (node) {\n      var isNamedAnchor = node.name === 'a' && !node.attr('href') && node.attr('id');\n      return node.attr('name') || node.attr('id') && !node.firstChild || node.attr('data-mce-bookmark') || isNamedAnchor;\n    };\n    var AstNode = function () {\n      function AstNode(name, type) {\n        this.name = name;\n        this.type = type;\n        if (type === 1) {\n          this.attributes = [];\n          this.attributes.map = {};\n        }\n      }\n      AstNode.create = function (name, attrs) {\n        var node = new AstNode(name, typeLookup[name] || 1);\n        if (attrs) {\n          each$1(attrs, function (value, attrName) {\n            node.attr(attrName, value);\n          });\n        }\n        return node;\n      };\n      AstNode.prototype.replace = function (node) {\n        var self = this;\n        if (node.parent) {\n          node.remove();\n        }\n        self.insert(node, self);\n        self.remove();\n        return self;\n      };\n      AstNode.prototype.attr = function (name, value) {\n        var self = this;\n        var attrs;\n        if (typeof name !== 'string') {\n          if (name !== undefined && name !== null) {\n            each$1(name, function (value, key) {\n              self.attr(key, value);\n            });\n          }\n          return self;\n        }\n        if (attrs = self.attributes) {\n          if (value !== undefined) {\n            if (value === null) {\n              if (name in attrs.map) {\n                delete attrs.map[name];\n                var i = attrs.length;\n                while (i--) {\n                  if (attrs[i].name === name) {\n                    attrs.splice(i, 1);\n                    return self;\n                  }\n                }\n              }\n              return self;\n            }\n            if (name in attrs.map) {\n              var i = attrs.length;\n              while (i--) {\n                if (attrs[i].name === name) {\n                  attrs[i].value = value;\n                  break;\n                }\n              }\n            } else {\n              attrs.push({\n                name: name,\n                value: value\n              });\n            }\n            attrs.map[name] = value;\n            return self;\n          }\n          return attrs.map[name];\n        }\n      };\n      AstNode.prototype.clone = function () {\n        var self = this;\n        var clone = new AstNode(self.name, self.type);\n        var selfAttrs;\n        if (selfAttrs = self.attributes) {\n          var cloneAttrs = [];\n          cloneAttrs.map = {};\n          for (var i = 0, l = selfAttrs.length; i < l; i++) {\n            var selfAttr = selfAttrs[i];\n            if (selfAttr.name !== 'id') {\n              cloneAttrs[cloneAttrs.length] = {\n                name: selfAttr.name,\n                value: selfAttr.value\n              };\n              cloneAttrs.map[selfAttr.name] = selfAttr.value;\n            }\n          }\n          clone.attributes = cloneAttrs;\n        }\n        clone.value = self.value;\n        clone.shortEnded = self.shortEnded;\n        return clone;\n      };\n      AstNode.prototype.wrap = function (wrapper) {\n        var self = this;\n        self.parent.insert(wrapper, self);\n        wrapper.append(self);\n        return self;\n      };\n      AstNode.prototype.unwrap = function () {\n        var self = this;\n        for (var node = self.firstChild; node;) {\n          var next = node.next;\n          self.insert(node, self, true);\n          node = next;\n        }\n        self.remove();\n      };\n      AstNode.prototype.remove = function () {\n        var self = this, parent = self.parent, next = self.next, prev = self.prev;\n        if (parent) {\n          if (parent.firstChild === self) {\n            parent.firstChild = next;\n            if (next) {\n              next.prev = null;\n            }\n          } else {\n            prev.next = next;\n          }\n          if (parent.lastChild === self) {\n            parent.lastChild = prev;\n            if (prev) {\n              prev.next = null;\n            }\n          } else {\n            next.prev = prev;\n          }\n          self.parent = self.next = self.prev = null;\n        }\n        return self;\n      };\n      AstNode.prototype.append = function (node) {\n        var self = this;\n        if (node.parent) {\n          node.remove();\n        }\n        var last = self.lastChild;\n        if (last) {\n          last.next = node;\n          node.prev = last;\n          self.lastChild = node;\n        } else {\n          self.lastChild = self.firstChild = node;\n        }\n        node.parent = self;\n        return node;\n      };\n      AstNode.prototype.insert = function (node, refNode, before) {\n        if (node.parent) {\n          node.remove();\n        }\n        var parent = refNode.parent || this;\n        if (before) {\n          if (refNode === parent.firstChild) {\n            parent.firstChild = node;\n          } else {\n            refNode.prev.next = node;\n          }\n          node.prev = refNode.prev;\n          node.next = refNode;\n          refNode.prev = node;\n        } else {\n          if (refNode === parent.lastChild) {\n            parent.lastChild = node;\n          } else {\n            refNode.next.prev = node;\n          }\n          node.next = refNode.next;\n          node.prev = refNode;\n          refNode.next = node;\n        }\n        node.parent = parent;\n        return node;\n      };\n      AstNode.prototype.getAll = function (name) {\n        var self = this;\n        var collection = [];\n        for (var node = self.firstChild; node; node = walk$2(node, self)) {\n          if (node.name === name) {\n            collection.push(node);\n          }\n        }\n        return collection;\n      };\n      AstNode.prototype.empty = function () {\n        var self = this;\n        if (self.firstChild) {\n          var nodes = [];\n          for (var node = self.firstChild; node; node = walk$2(node, self)) {\n            nodes.push(node);\n          }\n          var i = nodes.length;\n          while (i--) {\n            var node = nodes[i];\n            node.parent = node.firstChild = node.lastChild = node.next = node.prev = null;\n          }\n        }\n        self.firstChild = self.lastChild = null;\n        return self;\n      };\n      AstNode.prototype.isEmpty = function (elements, whitespace, predicate) {\n        if (whitespace === void 0) {\n          whitespace = {};\n        }\n        var self = this;\n        var node = self.firstChild;\n        if (isNonEmptyElement(self)) {\n          return false;\n        }\n        if (node) {\n          do {\n            if (node.type === 1) {\n              if (node.attr('data-mce-bogus')) {\n                continue;\n              }\n              if (elements[node.name]) {\n                return false;\n              }\n              if (isNonEmptyElement(node)) {\n                return false;\n              }\n            }\n            if (node.type === 8) {\n              return false;\n            }\n            if (node.type === 3 && !isEmptyTextNode$1(node)) {\n              return false;\n            }\n            if (node.type === 3 && node.parent && whitespace[node.parent.name] && isWhitespaceText(node.value)) {\n              return false;\n            }\n            if (predicate && predicate(node)) {\n              return false;\n            }\n          } while (node = walk$2(node, self));\n        }\n        return true;\n      };\n      AstNode.prototype.walk = function (prev) {\n        return walk$2(this, null, prev);\n      };\n      return AstNode;\n    }();\n\n    var makeMap$3 = Tools.makeMap;\n    var Writer = function (settings) {\n      var html = [];\n      settings = settings || {};\n      var indent = settings.indent;\n      var indentBefore = makeMap$3(settings.indent_before || '');\n      var indentAfter = makeMap$3(settings.indent_after || '');\n      var encode = Entities.getEncodeFunc(settings.entity_encoding || 'raw', settings.entities);\n      var htmlOutput = settings.element_format === 'html';\n      return {\n        start: function (name, attrs, empty) {\n          var i, l, attr, value;\n          if (indent && indentBefore[name] && html.length > 0) {\n            value = html[html.length - 1];\n            if (value.length > 0 && value !== '\\n') {\n              html.push('\\n');\n            }\n          }\n          html.push('<', name);\n          if (attrs) {\n            for (i = 0, l = attrs.length; i < l; i++) {\n              attr = attrs[i];\n              html.push(' ', attr.name, '=\"', encode(attr.value, true), '\"');\n            }\n          }\n          if (!empty || htmlOutput) {\n            html[html.length] = '>';\n          } else {\n            html[html.length] = ' />';\n          }\n          if (empty && indent && indentAfter[name] && html.length > 0) {\n            value = html[html.length - 1];\n            if (value.length > 0 && value !== '\\n') {\n              html.push('\\n');\n            }\n          }\n        },\n        end: function (name) {\n          var value;\n          html.push('</', name, '>');\n          if (indent && indentAfter[name] && html.length > 0) {\n            value = html[html.length - 1];\n            if (value.length > 0 && value !== '\\n') {\n              html.push('\\n');\n            }\n          }\n        },\n        text: function (text, raw) {\n          if (text.length > 0) {\n            html[html.length] = raw ? text : encode(text);\n          }\n        },\n        cdata: function (text) {\n          html.push('<![CDATA[', text, ']]>');\n        },\n        comment: function (text) {\n          html.push('<!--', text, '-->');\n        },\n        pi: function (name, text) {\n          if (text) {\n            html.push('<?', name, ' ', encode(text), '?>');\n          } else {\n            html.push('<?', name, '?>');\n          }\n          if (indent) {\n            html.push('\\n');\n          }\n        },\n        doctype: function (text) {\n          html.push('<!DOCTYPE', text, '>', indent ? '\\n' : '');\n        },\n        reset: function () {\n          html.length = 0;\n        },\n        getContent: function () {\n          return html.join('').replace(/\\n$/, '');\n        }\n      };\n    };\n\n    var HtmlSerializer = function (settings, schema) {\n      if (schema === void 0) {\n        schema = Schema();\n      }\n      var writer = Writer(settings);\n      settings = settings || {};\n      settings.validate = 'validate' in settings ? settings.validate : true;\n      var serialize = function (node) {\n        var validate = settings.validate;\n        var handlers = {\n          3: function (node) {\n            writer.text(node.value, node.raw);\n          },\n          8: function (node) {\n            writer.comment(node.value);\n          },\n          7: function (node) {\n            writer.pi(node.name, node.value);\n          },\n          10: function (node) {\n            writer.doctype(node.value);\n          },\n          4: function (node) {\n            writer.cdata(node.value);\n          },\n          11: function (node) {\n            if (node = node.firstChild) {\n              do {\n                walk(node);\n              } while (node = node.next);\n            }\n          }\n        };\n        writer.reset();\n        var walk = function (node) {\n          var handler = handlers[node.type];\n          var name, isEmpty, attrs, attrName, attrValue, sortedAttrs, i, l, elementRule;\n          if (!handler) {\n            name = node.name;\n            isEmpty = node.shortEnded;\n            attrs = node.attributes;\n            if (validate && attrs && attrs.length > 1) {\n              sortedAttrs = [];\n              sortedAttrs.map = {};\n              elementRule = schema.getElementRule(node.name);\n              if (elementRule) {\n                for (i = 0, l = elementRule.attributesOrder.length; i < l; i++) {\n                  attrName = elementRule.attributesOrder[i];\n                  if (attrName in attrs.map) {\n                    attrValue = attrs.map[attrName];\n                    sortedAttrs.map[attrName] = attrValue;\n                    sortedAttrs.push({\n                      name: attrName,\n                      value: attrValue\n                    });\n                  }\n                }\n                for (i = 0, l = attrs.length; i < l; i++) {\n                  attrName = attrs[i].name;\n                  if (!(attrName in sortedAttrs.map)) {\n                    attrValue = attrs.map[attrName];\n                    sortedAttrs.map[attrName] = attrValue;\n                    sortedAttrs.push({\n                      name: attrName,\n                      value: attrValue\n                    });\n                  }\n                }\n                attrs = sortedAttrs;\n              }\n            }\n            writer.start(node.name, attrs, isEmpty);\n            if (!isEmpty) {\n              if (node = node.firstChild) {\n                do {\n                  walk(node);\n                } while (node = node.next);\n              }\n              writer.end(name);\n            }\n          } else {\n            handler(node);\n          }\n        };\n        if (node.type === 1 && !settings.inner) {\n          walk(node);\n        } else {\n          handlers[11](node);\n        }\n        return writer.getContent();\n      };\n      return { serialize: serialize };\n    };\n\n    var extractBase64DataUris = function (html) {\n      var dataImageUri = /data:[^;]+;base64,([a-z0-9\\+\\/=]+)/gi;\n      var chunks = [];\n      var uris = {};\n      var prefix = generate$1('img');\n      var matches;\n      var index = 0;\n      var count = 0;\n      while (matches = dataImageUri.exec(html)) {\n        var uri = matches[0];\n        var imageId = prefix + '_' + count++;\n        uris[imageId] = uri;\n        if (index < matches.index) {\n          chunks.push(html.substr(index, matches.index - index));\n        }\n        chunks.push(imageId);\n        index = matches.index + uri.length;\n      }\n      if (index === 0) {\n        return {\n          prefix: prefix,\n          uris: uris,\n          html: html\n        };\n      } else {\n        if (index < html.length) {\n          chunks.push(html.substr(index));\n        }\n        return {\n          prefix: prefix,\n          uris: uris,\n          html: chunks.join('')\n        };\n      }\n    };\n    var restoreDataUris = function (html, result) {\n      return html.replace(new RegExp(result.prefix + '_[0-9]+', 'g'), function (imageId) {\n        return get(result.uris, imageId).getOr(imageId);\n      });\n    };\n    var parseDataUri = function (uri) {\n      var matches = /data:([^;]+);base64,([a-z0-9\\+\\/=]+)/i.exec(uri);\n      if (matches) {\n        return Optional.some({\n          type: matches[1],\n          data: decodeURIComponent(matches[2])\n        });\n      } else {\n        return Optional.none();\n      }\n    };\n\n    var isValidPrefixAttrName = function (name) {\n      return name.indexOf('data-') === 0 || name.indexOf('aria-') === 0;\n    };\n    var isInvalidUri = function (settings, uri) {\n      if (settings.allow_html_data_urls) {\n        return false;\n      } else if (/^data:image\\//i.test(uri)) {\n        return settings.allow_svg_data_urls === false && /^data:image\\/svg\\+xml/i.test(uri);\n      } else {\n        return /^data:/i.test(uri);\n      }\n    };\n    var findEndTagIndex = function (schema, html, startIndex) {\n      var count = 1, index, matches;\n      var shortEndedElements = schema.getShortEndedElements();\n      var tokenRegExp = /<([!?\\/])?([A-Za-z0-9\\-_\\:\\.]+)((?:\\s+[^\"\\'>]+(?:(?:\"[^\"]*\")|(?:\\'[^\\']*\\')|[^>]*))*|\\/|\\s+)>/g;\n      tokenRegExp.lastIndex = index = startIndex;\n      while (matches = tokenRegExp.exec(html)) {\n        index = tokenRegExp.lastIndex;\n        if (matches[1] === '/') {\n          count--;\n        } else if (!matches[1]) {\n          if (matches[2] in shortEndedElements) {\n            continue;\n          }\n          count++;\n        }\n        if (count === 0) {\n          break;\n        }\n      }\n      return index;\n    };\n    var isConditionalComment = function (html, startIndex) {\n      return /^\\s*\\[if [\\w\\W]+\\]>.*<!\\[endif\\](--!?)?>/.test(html.substr(startIndex));\n    };\n    var findCommentEndIndex = function (html, isBogus, startIndex) {\n      if (startIndex === void 0) {\n        startIndex = 0;\n      }\n      var lcHtml = html.toLowerCase();\n      if (lcHtml.indexOf('[if ', startIndex) !== -1 && isConditionalComment(lcHtml, startIndex)) {\n        var endIfIndex = lcHtml.indexOf('[endif]', startIndex);\n        return lcHtml.indexOf('>', endIfIndex);\n      } else {\n        if (isBogus) {\n          var endIndex = lcHtml.indexOf('>', startIndex);\n          return endIndex !== -1 ? endIndex : lcHtml.length;\n        } else {\n          var endCommentRegexp = /--!?>/;\n          endCommentRegexp.lastIndex = startIndex;\n          var match = endCommentRegexp.exec(html);\n          return match ? match.index + match[0].length : lcHtml.length;\n        }\n      }\n    };\n    var checkBogusAttribute = function (regExp, attrString) {\n      var matches = regExp.exec(attrString);\n      if (matches) {\n        var name_1 = matches[1];\n        var value = matches[2];\n        return typeof name_1 === 'string' && name_1.toLowerCase() === 'data-mce-bogus' ? value : null;\n      } else {\n        return null;\n      }\n    };\n    function SaxParser(settings, schema) {\n      if (schema === void 0) {\n        schema = Schema();\n      }\n      var noop = function () {\n      };\n      settings = settings || {};\n      if (settings.fix_self_closing !== false) {\n        settings.fix_self_closing = true;\n      }\n      var comment = settings.comment ? settings.comment : noop;\n      var cdata = settings.cdata ? settings.cdata : noop;\n      var text = settings.text ? settings.text : noop;\n      var start = settings.start ? settings.start : noop;\n      var end = settings.end ? settings.end : noop;\n      var pi = settings.pi ? settings.pi : noop;\n      var doctype = settings.doctype ? settings.doctype : noop;\n      var parseInternal = function (base64Extract, format) {\n        if (format === void 0) {\n          format = 'html';\n        }\n        var html = base64Extract.html;\n        var matches, index = 0, value, endRegExp;\n        var stack = [];\n        var attrList, i, textData, name;\n        var isInternalElement, isShortEnded;\n        var elementRule, isValidElement, attr, attribsValue, validAttributesMap, validAttributePatterns;\n        var attributesRequired, attributesDefault, attributesForced;\n        var anyAttributesRequired, attrValue, idCount = 0;\n        var decode = Entities.decode;\n        var filteredUrlAttrs = Tools.makeMap('src,href,data,background,formaction,poster,xlink:href');\n        var scriptUriRegExp = /((java|vb)script|mhtml):/i;\n        var parsingMode = format === 'html' ? 0 : 1;\n        var processEndTag = function (name) {\n          var pos, i;\n          pos = stack.length;\n          while (pos--) {\n            if (stack[pos].name === name) {\n              break;\n            }\n          }\n          if (pos >= 0) {\n            for (i = stack.length - 1; i >= pos; i--) {\n              name = stack[i];\n              if (name.valid) {\n                end(name.name);\n              }\n            }\n            stack.length = pos;\n          }\n        };\n        var processText = function (value, raw) {\n          return text(restoreDataUris(value, base64Extract), raw);\n        };\n        var processComment = function (value) {\n          if (value === '') {\n            return;\n          }\n          if (value.charAt(0) === '>') {\n            value = ' ' + value;\n          }\n          if (!settings.allow_conditional_comments && value.substr(0, 3).toLowerCase() === '[if') {\n            value = ' ' + value;\n          }\n          comment(restoreDataUris(value, base64Extract));\n        };\n        var processAttr = function (value) {\n          return get(base64Extract.uris, value).getOr(value);\n        };\n        var processMalformedComment = function (value, startIndex) {\n          var startTag = value || '';\n          var isBogus = !startsWith(startTag, '--');\n          var endIndex = findCommentEndIndex(html, isBogus, startIndex);\n          value = html.substr(startIndex, endIndex - startIndex);\n          processComment(isBogus ? startTag + value : value);\n          return endIndex + 1;\n        };\n        var parseAttribute = function (match, name, value, val2, val3) {\n          var attrRule, i;\n          var trimRegExp = /[\\s\\u0000-\\u001F]+/g;\n          name = name.toLowerCase();\n          value = processAttr(name in fillAttrsMap ? name : decode(value || val2 || val3 || ''));\n          if (validate && !isInternalElement && isValidPrefixAttrName(name) === false) {\n            attrRule = validAttributesMap[name];\n            if (!attrRule && validAttributePatterns) {\n              i = validAttributePatterns.length;\n              while (i--) {\n                attrRule = validAttributePatterns[i];\n                if (attrRule.pattern.test(name)) {\n                  break;\n                }\n              }\n              if (i === -1) {\n                attrRule = null;\n              }\n            }\n            if (!attrRule) {\n              return;\n            }\n            if (attrRule.validValues && !(value in attrRule.validValues)) {\n              return;\n            }\n          }\n          if (filteredUrlAttrs[name] && !settings.allow_script_urls) {\n            var uri = value.replace(trimRegExp, '');\n            try {\n              uri = decodeURIComponent(uri);\n            } catch (ex) {\n              uri = unescape(uri);\n            }\n            if (scriptUriRegExp.test(uri)) {\n              return;\n            }\n            if (isInvalidUri(settings, uri)) {\n              return;\n            }\n          }\n          if (isInternalElement && (name in filteredUrlAttrs || name.indexOf('on') === 0)) {\n            return;\n          }\n          attrList.map[name] = value;\n          attrList.push({\n            name: name,\n            value: value\n          });\n        };\n        var tokenRegExp = new RegExp('<(?:' + '(?:!--([\\\\w\\\\W]*?)--!?>)|' + '(?:!\\\\[CDATA\\\\[([\\\\w\\\\W]*?)\\\\]\\\\]>)|' + '(?:![Dd][Oo][Cc][Tt][Yy][Pp][Ee]([\\\\w\\\\W]*?)>)|' + '(?:!(--)?)|' + '(?:\\\\?([^\\\\s\\\\/<>]+) ?([\\\\w\\\\W]*?)[?/]>)|' + '(?:\\\\/([A-Za-z][A-Za-z0-9\\\\-_\\\\:\\\\.]*)>)|' + '(?:([A-Za-z][A-Za-z0-9\\\\-_\\\\:\\\\.]*)((?:\\\\s+[^\"\\'>]+(?:(?:\"[^\"]*\")|(?:\\'[^\\']*\\')|[^>]*))*|\\\\/|\\\\s+)>)' + ')', 'g');\n        var attrRegExp = /([\\w:\\-]+)(?:\\s*=\\s*(?:(?:\\\"((?:[^\\\"])*)\\\")|(?:\\'((?:[^\\'])*)\\')|([^>\\s]+)))?/g;\n        var shortEndedElements = schema.getShortEndedElements();\n        var selfClosing = settings.self_closing_elements || schema.getSelfClosingElements();\n        var fillAttrsMap = schema.getBoolAttrs();\n        var validate = settings.validate;\n        var removeInternalElements = settings.remove_internals;\n        var fixSelfClosing = settings.fix_self_closing;\n        var specialElements = schema.getSpecialElements();\n        var processHtml = html + '>';\n        while (matches = tokenRegExp.exec(processHtml)) {\n          var matchText = matches[0];\n          if (index < matches.index) {\n            processText(decode(html.substr(index, matches.index - index)));\n          }\n          if (value = matches[7]) {\n            value = value.toLowerCase();\n            if (value.charAt(0) === ':') {\n              value = value.substr(1);\n            }\n            processEndTag(value);\n          } else if (value = matches[8]) {\n            if (matches.index + matchText.length > html.length) {\n              processText(decode(html.substr(matches.index)));\n              index = matches.index + matchText.length;\n              continue;\n            }\n            value = value.toLowerCase();\n            if (value.charAt(0) === ':') {\n              value = value.substr(1);\n            }\n            isShortEnded = value in shortEndedElements;\n            if (fixSelfClosing && selfClosing[value] && stack.length > 0 && stack[stack.length - 1].name === value) {\n              processEndTag(value);\n            }\n            var bogusValue = checkBogusAttribute(attrRegExp, matches[9]);\n            if (bogusValue !== null) {\n              if (bogusValue === 'all') {\n                index = findEndTagIndex(schema, html, tokenRegExp.lastIndex);\n                tokenRegExp.lastIndex = index;\n                continue;\n              }\n              isValidElement = false;\n            }\n            if (!validate || (elementRule = schema.getElementRule(value))) {\n              isValidElement = true;\n              if (validate) {\n                validAttributesMap = elementRule.attributes;\n                validAttributePatterns = elementRule.attributePatterns;\n              }\n              if (attribsValue = matches[9]) {\n                isInternalElement = attribsValue.indexOf('data-mce-type') !== -1;\n                if (isInternalElement && removeInternalElements) {\n                  isValidElement = false;\n                }\n                attrList = [];\n                attrList.map = {};\n                attribsValue.replace(attrRegExp, parseAttribute);\n              } else {\n                attrList = [];\n                attrList.map = {};\n              }\n              if (validate && !isInternalElement) {\n                attributesRequired = elementRule.attributesRequired;\n                attributesDefault = elementRule.attributesDefault;\n                attributesForced = elementRule.attributesForced;\n                anyAttributesRequired = elementRule.removeEmptyAttrs;\n                if (anyAttributesRequired && !attrList.length) {\n                  isValidElement = false;\n                }\n                if (attributesForced) {\n                  i = attributesForced.length;\n                  while (i--) {\n                    attr = attributesForced[i];\n                    name = attr.name;\n                    attrValue = attr.value;\n                    if (attrValue === '{$uid}') {\n                      attrValue = 'mce_' + idCount++;\n                    }\n                    attrList.map[name] = attrValue;\n                    attrList.push({\n                      name: name,\n                      value: attrValue\n                    });\n                  }\n                }\n                if (attributesDefault) {\n                  i = attributesDefault.length;\n                  while (i--) {\n                    attr = attributesDefault[i];\n                    name = attr.name;\n                    if (!(name in attrList.map)) {\n                      attrValue = attr.value;\n                      if (attrValue === '{$uid}') {\n                        attrValue = 'mce_' + idCount++;\n                      }\n                      attrList.map[name] = attrValue;\n                      attrList.push({\n                        name: name,\n                        value: attrValue\n                      });\n                    }\n                  }\n                }\n                if (attributesRequired) {\n                  i = attributesRequired.length;\n                  while (i--) {\n                    if (attributesRequired[i] in attrList.map) {\n                      break;\n                    }\n                  }\n                  if (i === -1) {\n                    isValidElement = false;\n                  }\n                }\n                if (attr = attrList.map['data-mce-bogus']) {\n                  if (attr === 'all') {\n                    index = findEndTagIndex(schema, html, tokenRegExp.lastIndex);\n                    tokenRegExp.lastIndex = index;\n                    continue;\n                  }\n                  isValidElement = false;\n                }\n              }\n              if (isValidElement) {\n                start(value, attrList, isShortEnded);\n              }\n            } else {\n              isValidElement = false;\n            }\n            if (endRegExp = specialElements[value]) {\n              endRegExp.lastIndex = index = matches.index + matchText.length;\n              if (matches = endRegExp.exec(html)) {\n                if (isValidElement) {\n                  textData = html.substr(index, matches.index - index);\n                }\n                index = matches.index + matches[0].length;\n              } else {\n                textData = html.substr(index);\n                index = html.length;\n              }\n              if (isValidElement) {\n                if (textData.length > 0) {\n                  processText(textData, true);\n                }\n                end(value);\n              }\n              tokenRegExp.lastIndex = index;\n              continue;\n            }\n            if (!isShortEnded) {\n              if (!attribsValue || attribsValue.indexOf('/') !== attribsValue.length - 1) {\n                stack.push({\n                  name: value,\n                  valid: isValidElement\n                });\n              } else if (isValidElement) {\n                end(value);\n              }\n            }\n          } else if (value = matches[1]) {\n            processComment(value);\n          } else if (value = matches[2]) {\n            var isValidCdataSection = parsingMode === 1 || settings.preserve_cdata || stack.length > 0 && schema.isValidChild(stack[stack.length - 1].name, '#cdata');\n            if (isValidCdataSection) {\n              cdata(value);\n            } else {\n              index = processMalformedComment('', matches.index + 2);\n              tokenRegExp.lastIndex = index;\n              continue;\n            }\n          } else if (value = matches[3]) {\n            doctype(value);\n          } else if ((value = matches[4]) || matchText === '<!') {\n            index = processMalformedComment(value, matches.index + matchText.length);\n            tokenRegExp.lastIndex = index;\n            continue;\n          } else if (value = matches[5]) {\n            if (parsingMode === 1) {\n              pi(value, matches[6]);\n            } else {\n              index = processMalformedComment('?', matches.index + 2);\n              tokenRegExp.lastIndex = index;\n              continue;\n            }\n          }\n          index = matches.index + matchText.length;\n        }\n        if (index < html.length) {\n          processText(decode(html.substr(index)));\n        }\n        for (i = stack.length - 1; i >= 0; i--) {\n          value = stack[i];\n          if (value.valid) {\n            end(value.name);\n          }\n        }\n      };\n      var parse = function (html, format) {\n        if (format === void 0) {\n          format = 'html';\n        }\n        parseInternal(extractBase64DataUris(html), format);\n      };\n      return { parse: parse };\n    }\n    (function (SaxParser) {\n      SaxParser.findEndTag = findEndTagIndex;\n    }(SaxParser || (SaxParser = {})));\n    var SaxParser$1 = SaxParser;\n\n    var trimHtml = function (tempAttrs, html) {\n      var trimContentRegExp = new RegExp(['\\\\s?(' + tempAttrs.join('|') + ')=\"[^\"]+\"'].join('|'), 'gi');\n      return html.replace(trimContentRegExp, '');\n    };\n    var trimInternal = function (serializer, html) {\n      var content = html;\n      var bogusAllRegExp = /<(\\w+) [^>]*data-mce-bogus=\"all\"[^>]*>/g;\n      var endTagIndex, index, matchLength, matches;\n      var schema = serializer.schema;\n      content = trimHtml(serializer.getTempAttrs(), content);\n      var shortEndedElements = schema.getShortEndedElements();\n      while (matches = bogusAllRegExp.exec(content)) {\n        index = bogusAllRegExp.lastIndex;\n        matchLength = matches[0].length;\n        if (shortEndedElements[matches[1]]) {\n          endTagIndex = index;\n        } else {\n          endTagIndex = SaxParser$1.findEndTag(schema, content, index);\n        }\n        content = content.substring(0, index - matchLength) + content.substring(endTagIndex);\n        bogusAllRegExp.lastIndex = index - matchLength;\n      }\n      return trim$2(content);\n    };\n    var trimExternal = trimInternal;\n\n    var trimEmptyContents = function (editor, html) {\n      var blockName = getForcedRootBlock(editor);\n      var emptyRegExp = new RegExp('^(<' + blockName + '[^>]*>(&nbsp;|&#160;|\\\\s|\\xA0|<br \\\\/>|)<\\\\/' + blockName + '>[\\r\\n]*|<br \\\\/>[\\r\\n]*)$');\n      return html.replace(emptyRegExp, '');\n    };\n    var getContentFromBody = function (editor, args, format, body) {\n      var content;\n      args.format = format;\n      args.get = true;\n      args.getInner = true;\n      if (!args.no_events) {\n        editor.fire('BeforeGetContent', args);\n      }\n      if (args.format === 'raw') {\n        content = Tools.trim(trimExternal(editor.serializer, body.innerHTML));\n      } else if (args.format === 'text') {\n        content = trim$2(body.innerText || body.textContent);\n      } else if (args.format === 'tree') {\n        return editor.serializer.serialize(body, args);\n      } else {\n        content = trimEmptyContents(editor, editor.serializer.serialize(body, args));\n      }\n      if (args.format !== 'text' && !isWsPreserveElement(SugarElement.fromDom(body))) {\n        args.content = Tools.trim(content);\n      } else {\n        args.content = content;\n      }\n      if (!args.no_events) {\n        editor.fire('GetContent', args);\n      }\n      return args.content;\n    };\n    var getContentInternal = function (editor, args, format) {\n      return Optional.from(editor.getBody()).fold(constant(args.format === 'tree' ? new AstNode('body', 11) : ''), function (body) {\n        return getContentFromBody(editor, args, format, body);\n      });\n    };\n\n    var each$7 = Tools.each;\n    var ElementUtils = function (dom) {\n      this.compare = function (node1, node2) {\n        if (node1.nodeName !== node2.nodeName) {\n          return false;\n        }\n        var getAttribs = function (node) {\n          var attribs = {};\n          each$7(dom.getAttribs(node), function (attr) {\n            var name = attr.nodeName.toLowerCase();\n            if (name.indexOf('_') !== 0 && name !== 'style' && name.indexOf('data-') !== 0) {\n              attribs[name] = dom.getAttrib(node, name);\n            }\n          });\n          return attribs;\n        };\n        var compareObjects = function (obj1, obj2) {\n          var value, name;\n          for (name in obj1) {\n            if (obj1.hasOwnProperty(name)) {\n              value = obj2[name];\n              if (typeof value === 'undefined') {\n                return false;\n              }\n              if (obj1[name] !== value) {\n                return false;\n              }\n              delete obj2[name];\n            }\n          }\n          for (name in obj2) {\n            if (obj2.hasOwnProperty(name)) {\n              return false;\n            }\n          }\n          return true;\n        };\n        if (!compareObjects(getAttribs(node1), getAttribs(node2))) {\n          return false;\n        }\n        if (!compareObjects(dom.parseStyle(dom.getAttrib(node1, 'style')), dom.parseStyle(dom.getAttrib(node2, 'style')))) {\n          return false;\n        }\n        return !isBookmarkNode$1(node1) && !isBookmarkNode$1(node2);\n      };\n    };\n\n    var isChar = function (forward, predicate, pos) {\n      return Optional.from(pos.container()).filter(isText$1).exists(function (text) {\n        var delta = forward ? 0 : -1;\n        return predicate(text.data.charAt(pos.offset() + delta));\n      });\n    };\n    var isBeforeSpace = curry(isChar, true, isWhiteSpace$1);\n    var isAfterSpace = curry(isChar, false, isWhiteSpace$1);\n    var isEmptyText = function (pos) {\n      var container = pos.container();\n      return isText$1(container) && (container.data.length === 0 || isZwsp$1(container.data) && BookmarkManager$1.isBookmarkNode(container.parentNode));\n    };\n    var matchesElementPosition = function (before, predicate) {\n      return function (pos) {\n        return Optional.from(getChildNodeAtRelativeOffset(before ? 0 : -1, pos)).filter(predicate).isSome();\n      };\n    };\n    var isImageBlock = function (node) {\n      return isImg(node) && get$4(SugarElement.fromDom(node), 'display') === 'block';\n    };\n    var isCefNode = function (node) {\n      return isContentEditableFalse(node) && !isBogusAll(node);\n    };\n    var isBeforeImageBlock = matchesElementPosition(true, isImageBlock);\n    var isAfterImageBlock = matchesElementPosition(false, isImageBlock);\n    var isBeforeMedia = matchesElementPosition(true, isMedia);\n    var isAfterMedia = matchesElementPosition(false, isMedia);\n    var isBeforeTable = matchesElementPosition(true, isTable);\n    var isAfterTable = matchesElementPosition(false, isTable);\n    var isBeforeContentEditableFalse = matchesElementPosition(true, isCefNode);\n    var isAfterContentEditableFalse = matchesElementPosition(false, isCefNode);\n\n    var getLastChildren$1 = function (elm) {\n      var children = [];\n      var rawNode = elm.dom;\n      while (rawNode) {\n        children.push(SugarElement.fromDom(rawNode));\n        rawNode = rawNode.lastChild;\n      }\n      return children;\n    };\n    var removeTrailingBr = function (elm) {\n      var allBrs = descendants$1(elm, 'br');\n      var brs = filter(getLastChildren$1(elm).slice(-1), isBr$1);\n      if (allBrs.length === brs.length) {\n        each(brs, remove);\n      }\n    };\n    var fillWithPaddingBr = function (elm) {\n      empty(elm);\n      append(elm, SugarElement.fromHtml('<br data-mce-bogus=\"1\">'));\n    };\n    var trimBlockTrailingBr = function (elm) {\n      lastChild(elm).each(function (lastChild) {\n        prevSibling(lastChild).each(function (lastChildPrevSibling) {\n          if (isBlock(elm) && isBr$1(lastChild) && isBlock(lastChildPrevSibling)) {\n            remove(lastChild);\n          }\n        });\n      });\n    };\n\n    var dropLast = function (xs) {\n      return xs.slice(0, -1);\n    };\n    var parentsUntil$1 = function (start, root, predicate) {\n      if (contains$2(root, start)) {\n        return dropLast(parents(start, function (elm) {\n          return predicate(elm) || eq$2(elm, root);\n        }));\n      } else {\n        return [];\n      }\n    };\n    var parents$1 = function (start, root) {\n      return parentsUntil$1(start, root, never);\n    };\n    var parentsAndSelf = function (start, root) {\n      return [start].concat(parents$1(start, root));\n    };\n\n    var navigateIgnoreEmptyTextNodes = function (forward, root, from) {\n      return navigateIgnore(forward, root, from, isEmptyText);\n    };\n    var getClosestBlock = function (root, pos) {\n      return find(parentsAndSelf(SugarElement.fromDom(pos.container()), root), isBlock);\n    };\n    var isAtBeforeAfterBlockBoundary = function (forward, root, pos) {\n      return navigateIgnoreEmptyTextNodes(forward, root.dom, pos).forall(function (newPos) {\n        return getClosestBlock(root, pos).fold(function () {\n          return isInSameBlock(newPos, pos, root.dom) === false;\n        }, function (fromBlock) {\n          return isInSameBlock(newPos, pos, root.dom) === false && contains$2(fromBlock, SugarElement.fromDom(newPos.container()));\n        });\n      });\n    };\n    var isAtBlockBoundary = function (forward, root, pos) {\n      return getClosestBlock(root, pos).fold(function () {\n        return navigateIgnoreEmptyTextNodes(forward, root.dom, pos).forall(function (newPos) {\n          return isInSameBlock(newPos, pos, root.dom) === false;\n        });\n      }, function (parent) {\n        return navigateIgnoreEmptyTextNodes(forward, parent.dom, pos).isNone();\n      });\n    };\n    var isAtStartOfBlock = curry(isAtBlockBoundary, false);\n    var isAtEndOfBlock = curry(isAtBlockBoundary, true);\n    var isBeforeBlock = curry(isAtBeforeAfterBlockBoundary, false);\n    var isAfterBlock = curry(isAtBeforeAfterBlockBoundary, true);\n\n    var isBr$5 = function (pos) {\n      return getElementFromPosition(pos).exists(isBr$1);\n    };\n    var findBr = function (forward, root, pos) {\n      var parentBlocks = filter(parentsAndSelf(SugarElement.fromDom(pos.container()), root), isBlock);\n      var scope = head(parentBlocks).getOr(root);\n      return fromPosition(forward, scope.dom, pos).filter(isBr$5);\n    };\n    var isBeforeBr = function (root, pos) {\n      return getElementFromPosition(pos).exists(isBr$1) || findBr(true, root, pos).isSome();\n    };\n    var isAfterBr = function (root, pos) {\n      return getElementFromPrevPosition(pos).exists(isBr$1) || findBr(false, root, pos).isSome();\n    };\n    var findPreviousBr = curry(findBr, false);\n    var findNextBr = curry(findBr, true);\n\n    var isInMiddleOfText = function (pos) {\n      return CaretPosition.isTextPosition(pos) && !pos.isAtStart() && !pos.isAtEnd();\n    };\n    var getClosestBlock$1 = function (root, pos) {\n      var parentBlocks = filter(parentsAndSelf(SugarElement.fromDom(pos.container()), root), isBlock);\n      return head(parentBlocks).getOr(root);\n    };\n    var hasSpaceBefore = function (root, pos) {\n      if (isInMiddleOfText(pos)) {\n        return isAfterSpace(pos);\n      } else {\n        return isAfterSpace(pos) || prevPosition(getClosestBlock$1(root, pos).dom, pos).exists(isAfterSpace);\n      }\n    };\n    var hasSpaceAfter = function (root, pos) {\n      if (isInMiddleOfText(pos)) {\n        return isBeforeSpace(pos);\n      } else {\n        return isBeforeSpace(pos) || nextPosition(getClosestBlock$1(root, pos).dom, pos).exists(isBeforeSpace);\n      }\n    };\n    var isPreValue = function (value) {\n      return contains([\n        'pre',\n        'pre-wrap'\n      ], value);\n    };\n    var isInPre = function (pos) {\n      return getElementFromPosition(pos).bind(function (elm) {\n        return closest(elm, isElement);\n      }).exists(function (elm) {\n        return isPreValue(get$4(elm, 'white-space'));\n      });\n    };\n    var isAtBeginningOfBody = function (root, pos) {\n      return prevPosition(root.dom, pos).isNone();\n    };\n    var isAtEndOfBody = function (root, pos) {\n      return nextPosition(root.dom, pos).isNone();\n    };\n    var isAtLineBoundary = function (root, pos) {\n      return isAtBeginningOfBody(root, pos) || isAtEndOfBody(root, pos) || isAtStartOfBlock(root, pos) || isAtEndOfBlock(root, pos) || isAfterBr(root, pos) || isBeforeBr(root, pos);\n    };\n    var needsToHaveNbsp = function (root, pos) {\n      if (isInPre(pos)) {\n        return false;\n      } else {\n        return isAtLineBoundary(root, pos) || hasSpaceBefore(root, pos) || hasSpaceAfter(root, pos);\n      }\n    };\n    var needsToBeNbspLeft = function (root, pos) {\n      if (isInPre(pos)) {\n        return false;\n      } else {\n        return isAtStartOfBlock(root, pos) || isBeforeBlock(root, pos) || isAfterBr(root, pos) || hasSpaceBefore(root, pos);\n      }\n    };\n    var leanRight = function (pos) {\n      var container = pos.container();\n      var offset = pos.offset();\n      if (isText$1(container) && offset < container.data.length) {\n        return CaretPosition(container, offset + 1);\n      } else {\n        return pos;\n      }\n    };\n    var needsToBeNbspRight = function (root, pos) {\n      if (isInPre(pos)) {\n        return false;\n      } else {\n        return isAtEndOfBlock(root, pos) || isAfterBlock(root, pos) || isBeforeBr(root, pos) || hasSpaceAfter(root, pos);\n      }\n    };\n    var needsToBeNbsp = function (root, pos) {\n      return needsToBeNbspLeft(root, pos) || needsToBeNbspRight(root, leanRight(pos));\n    };\n    var isNbspAt = function (text, offset) {\n      return isNbsp(text.charAt(offset));\n    };\n    var hasNbsp = function (pos) {\n      var container = pos.container();\n      return isText$1(container) && contains$1(container.data, nbsp);\n    };\n    var normalizeNbspMiddle = function (text) {\n      var chars = text.split('');\n      return map(chars, function (chr, i) {\n        if (isNbsp(chr) && i > 0 && i < chars.length - 1 && isContent$1(chars[i - 1]) && isContent$1(chars[i + 1])) {\n          return ' ';\n        } else {\n          return chr;\n        }\n      }).join('');\n    };\n    var normalizeNbspAtStart = function (root, node) {\n      var text = node.data;\n      var firstPos = CaretPosition(node, 0);\n      if (isNbspAt(text, 0) && !needsToBeNbsp(root, firstPos)) {\n        node.data = ' ' + text.slice(1);\n        return true;\n      } else {\n        return false;\n      }\n    };\n    var normalizeNbspInMiddleOfTextNode = function (node) {\n      var text = node.data;\n      var newText = normalizeNbspMiddle(text);\n      if (newText !== text) {\n        node.data = newText;\n        return true;\n      } else {\n        return false;\n      }\n    };\n    var normalizeNbspAtEnd = function (root, node) {\n      var text = node.data;\n      var lastPos = CaretPosition(node, text.length - 1);\n      if (isNbspAt(text, text.length - 1) && !needsToBeNbsp(root, lastPos)) {\n        node.data = text.slice(0, -1) + ' ';\n        return true;\n      } else {\n        return false;\n      }\n    };\n    var normalizeNbsps = function (root, pos) {\n      return Optional.some(pos).filter(hasNbsp).bind(function (pos) {\n        var container = pos.container();\n        var normalized = normalizeNbspAtStart(root, container) || normalizeNbspInMiddleOfTextNode(container) || normalizeNbspAtEnd(root, container);\n        return normalized ? Optional.some(pos) : Optional.none();\n      });\n    };\n    var normalizeNbspsInEditor = function (editor) {\n      var root = SugarElement.fromDom(editor.getBody());\n      if (editor.selection.isCollapsed()) {\n        normalizeNbsps(root, CaretPosition.fromRangeStart(editor.selection.getRng())).each(function (pos) {\n          editor.selection.setRng(pos.toRange());\n        });\n      }\n    };\n\n    var normalizeContent = function (content, isStartOfContent, isEndOfContent) {\n      var result = foldl(content, function (acc, c) {\n        if (isWhiteSpace$1(c) || isNbsp(c)) {\n          if (acc.previousCharIsSpace || acc.str === '' && isStartOfContent || acc.str.length === content.length - 1 && isEndOfContent) {\n            return {\n              previousCharIsSpace: false,\n              str: acc.str + nbsp\n            };\n          } else {\n            return {\n              previousCharIsSpace: true,\n              str: acc.str + ' '\n            };\n          }\n        } else {\n          return {\n            previousCharIsSpace: false,\n            str: acc.str + c\n          };\n        }\n      }, {\n        previousCharIsSpace: false,\n        str: ''\n      });\n      return result.str;\n    };\n    var normalize$1 = function (node, offset, count) {\n      if (count === 0) {\n        return;\n      }\n      var elm = SugarElement.fromDom(node);\n      var root = ancestor(elm, isBlock).getOr(elm);\n      var whitespace = node.data.slice(offset, offset + count);\n      var isEndOfContent = offset + count >= node.data.length && needsToBeNbspRight(root, CaretPosition$1(node, node.data.length));\n      var isStartOfContent = offset === 0 && needsToBeNbspLeft(root, CaretPosition$1(node, 0));\n      node.replaceData(offset, count, normalizeContent(whitespace, isStartOfContent, isEndOfContent));\n    };\n    var normalizeWhitespaceAfter = function (node, offset) {\n      var content = node.data.slice(offset);\n      var whitespaceCount = content.length - lTrim(content).length;\n      return normalize$1(node, offset, whitespaceCount);\n    };\n    var normalizeWhitespaceBefore = function (node, offset) {\n      var content = node.data.slice(0, offset);\n      var whitespaceCount = content.length - rTrim(content).length;\n      return normalize$1(node, offset - whitespaceCount, whitespaceCount);\n    };\n    var mergeTextNodes = function (prevNode, nextNode, normalizeWhitespace, mergeToPrev) {\n      if (mergeToPrev === void 0) {\n        mergeToPrev = true;\n      }\n      var whitespaceOffset = rTrim(prevNode.data).length;\n      var newNode = mergeToPrev ? prevNode : nextNode;\n      var removeNode = mergeToPrev ? nextNode : prevNode;\n      if (mergeToPrev) {\n        newNode.appendData(removeNode.data);\n      } else {\n        newNode.insertData(0, removeNode.data);\n      }\n      remove(SugarElement.fromDom(removeNode));\n      if (normalizeWhitespace) {\n        normalizeWhitespaceAfter(newNode, whitespaceOffset);\n      }\n      return newNode;\n    };\n\n    var needsReposition = function (pos, elm) {\n      var container = pos.container();\n      var offset = pos.offset();\n      return CaretPosition$1.isTextPosition(pos) === false && container === elm.parentNode && offset > CaretPosition$1.before(elm).offset();\n    };\n    var reposition = function (elm, pos) {\n      return needsReposition(pos, elm) ? CaretPosition$1(pos.container(), pos.offset() - 1) : pos;\n    };\n    var beforeOrStartOf = function (node) {\n      return isText$1(node) ? CaretPosition$1(node, 0) : CaretPosition$1.before(node);\n    };\n    var afterOrEndOf = function (node) {\n      return isText$1(node) ? CaretPosition$1(node, node.data.length) : CaretPosition$1.after(node);\n    };\n    var getPreviousSiblingCaretPosition = function (elm) {\n      if (isCaretCandidate(elm.previousSibling)) {\n        return Optional.some(afterOrEndOf(elm.previousSibling));\n      } else {\n        return elm.previousSibling ? lastPositionIn(elm.previousSibling) : Optional.none();\n      }\n    };\n    var getNextSiblingCaretPosition = function (elm) {\n      if (isCaretCandidate(elm.nextSibling)) {\n        return Optional.some(beforeOrStartOf(elm.nextSibling));\n      } else {\n        return elm.nextSibling ? firstPositionIn(elm.nextSibling) : Optional.none();\n      }\n    };\n    var findCaretPositionBackwardsFromElm = function (rootElement, elm) {\n      var startPosition = CaretPosition$1.before(elm.previousSibling ? elm.previousSibling : elm.parentNode);\n      return prevPosition(rootElement, startPosition).fold(function () {\n        return nextPosition(rootElement, CaretPosition$1.after(elm));\n      }, Optional.some);\n    };\n    var findCaretPositionForwardsFromElm = function (rootElement, elm) {\n      return nextPosition(rootElement, CaretPosition$1.after(elm)).fold(function () {\n        return prevPosition(rootElement, CaretPosition$1.before(elm));\n      }, Optional.some);\n    };\n    var findCaretPositionBackwards = function (rootElement, elm) {\n      return getPreviousSiblingCaretPosition(elm).orThunk(function () {\n        return getNextSiblingCaretPosition(elm);\n      }).orThunk(function () {\n        return findCaretPositionBackwardsFromElm(rootElement, elm);\n      });\n    };\n    var findCaretPositionForward = function (rootElement, elm) {\n      return getNextSiblingCaretPosition(elm).orThunk(function () {\n        return getPreviousSiblingCaretPosition(elm);\n      }).orThunk(function () {\n        return findCaretPositionForwardsFromElm(rootElement, elm);\n      });\n    };\n    var findCaretPosition$1 = function (forward, rootElement, elm) {\n      return forward ? findCaretPositionForward(rootElement, elm) : findCaretPositionBackwards(rootElement, elm);\n    };\n    var findCaretPosOutsideElmAfterDelete = function (forward, rootElement, elm) {\n      return findCaretPosition$1(forward, rootElement, elm).map(curry(reposition, elm));\n    };\n    var setSelection = function (editor, forward, pos) {\n      pos.fold(function () {\n        editor.focus();\n      }, function (pos) {\n        editor.selection.setRng(pos.toRange(), forward);\n      });\n    };\n    var eqRawNode = function (rawNode) {\n      return function (elm) {\n        return elm.dom === rawNode;\n      };\n    };\n    var isBlock$2 = function (editor, elm) {\n      return elm && has(editor.schema.getBlockElements(), name(elm));\n    };\n    var paddEmptyBlock = function (elm) {\n      if (isEmpty(elm)) {\n        var br = SugarElement.fromHtml('<br data-mce-bogus=\"1\">');\n        empty(elm);\n        append(elm, br);\n        return Optional.some(CaretPosition$1.before(br.dom));\n      } else {\n        return Optional.none();\n      }\n    };\n    var deleteNormalized = function (elm, afterDeletePosOpt, normalizeWhitespace) {\n      var prevTextOpt = prevSibling(elm).filter(isText);\n      var nextTextOpt = nextSibling(elm).filter(isText);\n      remove(elm);\n      return lift3(prevTextOpt, nextTextOpt, afterDeletePosOpt, function (prev, next, pos) {\n        var prevNode = prev.dom, nextNode = next.dom;\n        var offset = prevNode.data.length;\n        mergeTextNodes(prevNode, nextNode, normalizeWhitespace);\n        return pos.container() === nextNode ? CaretPosition$1(prevNode, offset) : pos;\n      }).orThunk(function () {\n        if (normalizeWhitespace) {\n          prevTextOpt.each(function (elm) {\n            return normalizeWhitespaceBefore(elm.dom, elm.dom.length);\n          });\n          nextTextOpt.each(function (elm) {\n            return normalizeWhitespaceAfter(elm.dom, 0);\n          });\n        }\n        return afterDeletePosOpt;\n      });\n    };\n    var isInlineElement = function (editor, element) {\n      return has(editor.schema.getTextInlineElements(), name(element));\n    };\n    var deleteElement = function (editor, forward, elm, moveCaret) {\n      if (moveCaret === void 0) {\n        moveCaret = true;\n      }\n      var afterDeletePos = findCaretPosOutsideElmAfterDelete(forward, editor.getBody(), elm.dom);\n      var parentBlock = ancestor(elm, curry(isBlock$2, editor), eqRawNode(editor.getBody()));\n      var normalizedAfterDeletePos = deleteNormalized(elm, afterDeletePos, isInlineElement(editor, elm));\n      if (editor.dom.isEmpty(editor.getBody())) {\n        editor.setContent('');\n        editor.selection.setCursorLocation();\n      } else {\n        parentBlock.bind(paddEmptyBlock).fold(function () {\n          if (moveCaret) {\n            setSelection(editor, forward, normalizedAfterDeletePos);\n          }\n        }, function (paddPos) {\n          if (moveCaret) {\n            setSelection(editor, forward, Optional.some(paddPos));\n          }\n        });\n      }\n    };\n\n    var tableCellRng = function (start, end) {\n      return {\n        start: start,\n        end: end\n      };\n    };\n    var tableSelection = function (rng, table, cells) {\n      return {\n        rng: rng,\n        table: table,\n        cells: cells\n      };\n    };\n    var deleteAction = Adt.generate([\n      { removeTable: ['element'] },\n      { emptyCells: ['cells'] },\n      {\n        deleteCellSelection: [\n          'rng',\n          'cell'\n        ]\n      }\n    ]);\n    var isRootFromElement = function (root) {\n      return function (cur) {\n        return eq$2(root, cur);\n      };\n    };\n    var getClosestCell = function (container, isRoot) {\n      return closest$1(SugarElement.fromDom(container), 'td,th', isRoot);\n    };\n    var getClosestTable = function (cell, isRoot) {\n      return ancestor$1(cell, 'table', isRoot);\n    };\n    var isExpandedCellRng = function (cellRng) {\n      return !eq$2(cellRng.start, cellRng.end);\n    };\n    var getTableFromCellRng = function (cellRng, isRoot) {\n      return getClosestTable(cellRng.start, isRoot).bind(function (startParentTable) {\n        return getClosestTable(cellRng.end, isRoot).bind(function (endParentTable) {\n          return someIf(eq$2(startParentTable, endParentTable), startParentTable);\n        });\n      });\n    };\n    var isSingleCellTable = function (cellRng, isRoot) {\n      return !isExpandedCellRng(cellRng) && getTableFromCellRng(cellRng, isRoot).exists(function (table) {\n        var rows = table.dom.rows;\n        return rows.length === 1 && rows[0].cells.length === 1;\n      });\n    };\n    var getTableCells = function (table) {\n      return descendants$1(table, 'td,th');\n    };\n    var getCellRng = function (rng, isRoot) {\n      var startCell = getClosestCell(rng.startContainer, isRoot);\n      var endCell = getClosestCell(rng.endContainer, isRoot);\n      return lift2(startCell, endCell, tableCellRng);\n    };\n    var getCellRangeFromStartTable = function (cellRng, isRoot) {\n      return getClosestTable(cellRng.start, isRoot).bind(function (table) {\n        return last(getTableCells(table)).map(function (endCell) {\n          return tableCellRng(cellRng.start, endCell);\n        });\n      });\n    };\n    var partialSelection = function (isRoot, rng) {\n      var startCell = getClosestCell(rng.startContainer, isRoot);\n      var endCell = getClosestCell(rng.endContainer, isRoot);\n      return rng.collapsed ? Optional.none() : lift2(startCell, endCell, tableCellRng).fold(function () {\n        return startCell.fold(function () {\n          return endCell.bind(function (endCell) {\n            return getClosestTable(endCell, isRoot).bind(function (table) {\n              return head(getTableCells(table)).map(function (startCell) {\n                return tableCellRng(startCell, endCell);\n              });\n            });\n          });\n        }, function (startCell) {\n          return getClosestTable(startCell, isRoot).bind(function (table) {\n            return last(getTableCells(table)).map(function (endCell) {\n              return tableCellRng(startCell, endCell);\n            });\n          });\n        });\n      }, function (cellRng) {\n        return isWithinSameTable(isRoot, cellRng) ? Optional.none() : getCellRangeFromStartTable(cellRng, isRoot);\n      });\n    };\n    var isWithinSameTable = function (isRoot, cellRng) {\n      return getTableFromCellRng(cellRng, isRoot).isSome();\n    };\n    var getTableSelectionFromCellRng = function (cellRng, isRoot) {\n      return getTableFromCellRng(cellRng, isRoot).map(function (table) {\n        return tableSelection(cellRng, table, getTableCells(table));\n      });\n    };\n    var getTableSelection = function (optCellRng, rng, isRoot) {\n      return optCellRng.filter(function (cellRng) {\n        return isExpandedCellRng(cellRng) && isWithinSameTable(isRoot, cellRng);\n      }).orThunk(function () {\n        return partialSelection(isRoot, rng);\n      }).bind(function (cRng) {\n        return getTableSelectionFromCellRng(cRng, isRoot);\n      });\n    };\n    var getCellIndex = function (cells, cell) {\n      return findIndex(cells, function (x) {\n        return eq$2(x, cell);\n      });\n    };\n    var getSelectedCells = function (tableSelection) {\n      return lift2(getCellIndex(tableSelection.cells, tableSelection.rng.start), getCellIndex(tableSelection.cells, tableSelection.rng.end), function (startIndex, endIndex) {\n        return tableSelection.cells.slice(startIndex, endIndex + 1);\n      });\n    };\n    var isSingleCellTableContentSelected = function (optCellRng, rng, isRoot) {\n      return optCellRng.filter(function (cellRng) {\n        return isSingleCellTable(cellRng, isRoot) && hasAllContentsSelected(cellRng.start, rng);\n      }).map(function (cellRng) {\n        return cellRng.start;\n      });\n    };\n    var getAction = function (tableSelection) {\n      return getSelectedCells(tableSelection).map(function (selected) {\n        var cells = tableSelection.cells;\n        return selected.length === cells.length ? deleteAction.removeTable(tableSelection.table) : deleteAction.emptyCells(selected);\n      });\n    };\n    var getActionFromRange = function (root, rng) {\n      var isRoot = isRootFromElement(root);\n      var optCellRng = getCellRng(rng, isRoot);\n      return isSingleCellTableContentSelected(optCellRng, rng, isRoot).map(function (cell) {\n        return deleteAction.deleteCellSelection(rng, cell);\n      }).orThunk(function () {\n        return getTableSelection(optCellRng, rng, isRoot).bind(getAction);\n      });\n    };\n\n    var freefallRtl = function (root) {\n      var child = isComment(root) ? prevSibling(root) : lastChild(root);\n      return child.bind(freefallRtl).orThunk(function () {\n        return Optional.some(root);\n      });\n    };\n    var emptyCells = function (editor, cells) {\n      each(cells, fillWithPaddingBr);\n      editor.selection.setCursorLocation(cells[0].dom, 0);\n      return true;\n    };\n    var deleteCellContents = function (editor, rng, cell) {\n      rng.deleteContents();\n      var lastNode = freefallRtl(cell).getOr(cell);\n      var lastBlock = SugarElement.fromDom(editor.dom.getParent(lastNode.dom, editor.dom.isBlock));\n      if (isEmpty(lastBlock)) {\n        fillWithPaddingBr(lastBlock);\n        editor.selection.setCursorLocation(lastBlock.dom, 0);\n      }\n      if (!eq$2(cell, lastBlock)) {\n        var additionalCleanupNodes = parent(lastBlock).is(cell) ? [] : siblings(lastBlock);\n        each(additionalCleanupNodes.concat(children(cell)), function (node) {\n          if (!eq$2(node, lastBlock) && !contains$2(node, lastBlock)) {\n            remove(node);\n          }\n        });\n      }\n      return true;\n    };\n    var deleteTableElement = function (editor, table) {\n      deleteElement(editor, false, table);\n      return true;\n    };\n    var deleteCellRange = function (editor, rootElm, rng) {\n      return getActionFromRange(rootElm, rng).map(function (action) {\n        return action.fold(curry(deleteTableElement, editor), curry(emptyCells, editor), curry(deleteCellContents, editor));\n      });\n    };\n    var deleteCaptionRange = function (editor, caption) {\n      return emptyElement(editor, caption);\n    };\n    var deleteTableRange = function (editor, rootElm, rng, startElm) {\n      return getParentCaption(rootElm, startElm).fold(function () {\n        return deleteCellRange(editor, rootElm, rng);\n      }, function (caption) {\n        return deleteCaptionRange(editor, caption);\n      }).getOr(false);\n    };\n    var deleteRange = function (editor, startElm) {\n      var rootNode = SugarElement.fromDom(editor.getBody());\n      var rng = editor.selection.getRng();\n      var selectedCells = getCellsFromEditor(editor);\n      return selectedCells.length !== 0 ? emptyCells(editor, selectedCells) : deleteTableRange(editor, rootNode, rng, startElm);\n    };\n    var getParentCell = function (rootElm, elm) {\n      return find(parentsAndSelf(elm, rootElm), isTableCell$1);\n    };\n    var getParentCaption = function (rootElm, elm) {\n      return find(parentsAndSelf(elm, rootElm), function (elm) {\n        return name(elm) === 'caption';\n      });\n    };\n    var deleteBetweenCells = function (editor, rootElm, forward, fromCell, from) {\n      return navigate(forward, editor.getBody(), from).bind(function (to) {\n        return getParentCell(rootElm, SugarElement.fromDom(to.getNode())).map(function (toCell) {\n          return eq$2(toCell, fromCell) === false;\n        });\n      });\n    };\n    var emptyElement = function (editor, elm) {\n      fillWithPaddingBr(elm);\n      editor.selection.setCursorLocation(elm.dom, 0);\n      return Optional.some(true);\n    };\n    var isDeleteOfLastCharPos = function (fromCaption, forward, from, to) {\n      return firstPositionIn(fromCaption.dom).bind(function (first) {\n        return lastPositionIn(fromCaption.dom).map(function (last) {\n          return forward ? from.isEqual(first) && to.isEqual(last) : from.isEqual(last) && to.isEqual(first);\n        });\n      }).getOr(true);\n    };\n    var emptyCaretCaption = function (editor, elm) {\n      return emptyElement(editor, elm);\n    };\n    var validateCaretCaption = function (rootElm, fromCaption, to) {\n      return getParentCaption(rootElm, SugarElement.fromDom(to.getNode())).map(function (toCaption) {\n        return eq$2(toCaption, fromCaption) === false;\n      });\n    };\n    var deleteCaretInsideCaption = function (editor, rootElm, forward, fromCaption, from) {\n      return navigate(forward, editor.getBody(), from).bind(function (to) {\n        return isDeleteOfLastCharPos(fromCaption, forward, from, to) ? emptyCaretCaption(editor, fromCaption) : validateCaretCaption(rootElm, fromCaption, to);\n      }).or(Optional.some(true));\n    };\n    var deleteCaretCells = function (editor, forward, rootElm, startElm) {\n      var from = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n      return getParentCell(rootElm, startElm).bind(function (fromCell) {\n        return isEmpty(fromCell) ? emptyElement(editor, fromCell) : deleteBetweenCells(editor, rootElm, forward, fromCell, from);\n      }).getOr(false);\n    };\n    var deleteCaretCaption = function (editor, forward, rootElm, fromCaption) {\n      var from = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n      return isEmpty(fromCaption) ? emptyElement(editor, fromCaption) : deleteCaretInsideCaption(editor, rootElm, forward, fromCaption, from);\n    };\n    var isNearTable = function (forward, pos) {\n      return forward ? isBeforeTable(pos) : isAfterTable(pos);\n    };\n    var isBeforeOrAfterTable = function (editor, forward) {\n      var fromPos = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n      return isNearTable(forward, fromPos) || fromPosition(forward, editor.getBody(), fromPos).exists(function (pos) {\n        return isNearTable(forward, pos);\n      });\n    };\n    var deleteCaret = function (editor, forward, startElm) {\n      var rootElm = SugarElement.fromDom(editor.getBody());\n      return getParentCaption(rootElm, startElm).fold(function () {\n        return deleteCaretCells(editor, forward, rootElm, startElm) || isBeforeOrAfterTable(editor, forward);\n      }, function (fromCaption) {\n        return deleteCaretCaption(editor, forward, rootElm, fromCaption).getOr(false);\n      });\n    };\n    var backspaceDelete = function (editor, forward) {\n      var startElm = SugarElement.fromDom(editor.selection.getStart(true));\n      var cells = getCellsFromEditor(editor);\n      return editor.selection.isCollapsed() && cells.length === 0 ? deleteCaret(editor, forward, startElm) : deleteRange(editor, startElm);\n    };\n\n    var createRange$1 = function (sc, so, ec, eo) {\n      var rng = document.createRange();\n      rng.setStart(sc, so);\n      rng.setEnd(ec, eo);\n      return rng;\n    };\n    var normalizeBlockSelectionRange = function (rng) {\n      var startPos = CaretPosition$1.fromRangeStart(rng);\n      var endPos = CaretPosition$1.fromRangeEnd(rng);\n      var rootNode = rng.commonAncestorContainer;\n      return fromPosition(false, rootNode, endPos).map(function (newEndPos) {\n        if (!isInSameBlock(startPos, endPos, rootNode) && isInSameBlock(startPos, newEndPos, rootNode)) {\n          return createRange$1(startPos.container(), startPos.offset(), newEndPos.container(), newEndPos.offset());\n        } else {\n          return rng;\n        }\n      }).getOr(rng);\n    };\n    var normalize$2 = function (rng) {\n      return rng.collapsed ? rng : normalizeBlockSelectionRange(rng);\n    };\n\n    var hasOnlyOneChild = function (node) {\n      return node.firstChild && node.firstChild === node.lastChild;\n    };\n    var isPaddingNode = function (node) {\n      return node.name === 'br' || node.value === nbsp;\n    };\n    var isPaddedEmptyBlock = function (schema, node) {\n      var blockElements = schema.getBlockElements();\n      return blockElements[node.name] && hasOnlyOneChild(node) && isPaddingNode(node.firstChild);\n    };\n    var isEmptyFragmentElement = function (schema, node) {\n      var nonEmptyElements = schema.getNonEmptyElements();\n      return node && (node.isEmpty(nonEmptyElements) || isPaddedEmptyBlock(schema, node));\n    };\n    var isListFragment = function (schema, fragment) {\n      var firstChild = fragment.firstChild;\n      var lastChild = fragment.lastChild;\n      if (firstChild && firstChild.name === 'meta') {\n        firstChild = firstChild.next;\n      }\n      if (lastChild && lastChild.attr('id') === 'mce_marker') {\n        lastChild = lastChild.prev;\n      }\n      if (isEmptyFragmentElement(schema, lastChild)) {\n        lastChild = lastChild.prev;\n      }\n      if (!firstChild || firstChild !== lastChild) {\n        return false;\n      }\n      return firstChild.name === 'ul' || firstChild.name === 'ol';\n    };\n    var cleanupDomFragment = function (domFragment) {\n      var firstChild = domFragment.firstChild;\n      var lastChild = domFragment.lastChild;\n      if (firstChild && firstChild.nodeName === 'META') {\n        firstChild.parentNode.removeChild(firstChild);\n      }\n      if (lastChild && lastChild.id === 'mce_marker') {\n        lastChild.parentNode.removeChild(lastChild);\n      }\n      return domFragment;\n    };\n    var toDomFragment = function (dom, serializer, fragment) {\n      var html = serializer.serialize(fragment);\n      var domFragment = dom.createFragment(html);\n      return cleanupDomFragment(domFragment);\n    };\n    var listItems$1 = function (elm) {\n      return Tools.grep(elm.childNodes, function (child) {\n        return child.nodeName === 'LI';\n      });\n    };\n    var isPadding = function (node) {\n      return node.data === nbsp || isBr(node);\n    };\n    var isListItemPadded = function (node) {\n      return node && node.firstChild && node.firstChild === node.lastChild && isPadding(node.firstChild);\n    };\n    var isEmptyOrPadded = function (elm) {\n      return !elm.firstChild || isListItemPadded(elm);\n    };\n    var trimListItems = function (elms) {\n      return elms.length > 0 && isEmptyOrPadded(elms[elms.length - 1]) ? elms.slice(0, -1) : elms;\n    };\n    var getParentLi = function (dom, node) {\n      var parentBlock = dom.getParent(node, dom.isBlock);\n      return parentBlock && parentBlock.nodeName === 'LI' ? parentBlock : null;\n    };\n    var isParentBlockLi = function (dom, node) {\n      return !!getParentLi(dom, node);\n    };\n    var getSplit = function (parentNode, rng) {\n      var beforeRng = rng.cloneRange();\n      var afterRng = rng.cloneRange();\n      beforeRng.setStartBefore(parentNode);\n      afterRng.setEndAfter(parentNode);\n      return [\n        beforeRng.cloneContents(),\n        afterRng.cloneContents()\n      ];\n    };\n    var findFirstIn = function (node, rootNode) {\n      var caretPos = CaretPosition$1.before(node);\n      var caretWalker = CaretWalker(rootNode);\n      var newCaretPos = caretWalker.next(caretPos);\n      return newCaretPos ? newCaretPos.toRange() : null;\n    };\n    var findLastOf = function (node, rootNode) {\n      var caretPos = CaretPosition$1.after(node);\n      var caretWalker = CaretWalker(rootNode);\n      var newCaretPos = caretWalker.prev(caretPos);\n      return newCaretPos ? newCaretPos.toRange() : null;\n    };\n    var insertMiddle = function (target, elms, rootNode, rng) {\n      var parts = getSplit(target, rng);\n      var parentElm = target.parentNode;\n      parentElm.insertBefore(parts[0], target);\n      Tools.each(elms, function (li) {\n        parentElm.insertBefore(li, target);\n      });\n      parentElm.insertBefore(parts[1], target);\n      parentElm.removeChild(target);\n      return findLastOf(elms[elms.length - 1], rootNode);\n    };\n    var insertBefore = function (target, elms, rootNode) {\n      var parentElm = target.parentNode;\n      Tools.each(elms, function (elm) {\n        parentElm.insertBefore(elm, target);\n      });\n      return findFirstIn(target, rootNode);\n    };\n    var insertAfter = function (target, elms, rootNode, dom) {\n      dom.insertAfter(elms.reverse(), target);\n      return findLastOf(elms[0], rootNode);\n    };\n    var insertAtCaret = function (serializer, dom, rng, fragment) {\n      var domFragment = toDomFragment(dom, serializer, fragment);\n      var liTarget = getParentLi(dom, rng.startContainer);\n      var liElms = trimListItems(listItems$1(domFragment.firstChild));\n      var BEGINNING = 1, END = 2;\n      var rootNode = dom.getRoot();\n      var isAt = function (location) {\n        var caretPos = CaretPosition$1.fromRangeStart(rng);\n        var caretWalker = CaretWalker(dom.getRoot());\n        var newPos = location === BEGINNING ? caretWalker.prev(caretPos) : caretWalker.next(caretPos);\n        return newPos ? getParentLi(dom, newPos.getNode()) !== liTarget : true;\n      };\n      if (isAt(BEGINNING)) {\n        return insertBefore(liTarget, liElms, rootNode);\n      } else if (isAt(END)) {\n        return insertAfter(liTarget, liElms, rootNode, dom);\n      }\n      return insertMiddle(liTarget, liElms, rootNode, rng);\n    };\n\n    var trimOrPadLeftRight = function (dom, rng, html) {\n      var root = SugarElement.fromDom(dom.getRoot());\n      if (needsToBeNbspLeft(root, CaretPosition$1.fromRangeStart(rng))) {\n        html = html.replace(/^ /, '&nbsp;');\n      } else {\n        html = html.replace(/^&nbsp;/, ' ');\n      }\n      if (needsToBeNbspRight(root, CaretPosition$1.fromRangeEnd(rng))) {\n        html = html.replace(/(&nbsp;| )(<br( \\/)>)?$/, '&nbsp;');\n      } else {\n        html = html.replace(/&nbsp;(<br( \\/)?>)?$/, ' ');\n      }\n      return html;\n    };\n\n    var isTableCell$4 = isTableCell;\n    var isTableCellContentSelected = function (dom, rng, cell) {\n      if (cell !== null) {\n        var endCell = dom.getParent(rng.endContainer, isTableCell$4);\n        return cell === endCell && hasAllContentsSelected(SugarElement.fromDom(cell), rng);\n      } else {\n        return false;\n      }\n    };\n    var validInsertion = function (editor, value, parentNode) {\n      if (parentNode.getAttribute('data-mce-bogus') === 'all') {\n        parentNode.parentNode.insertBefore(editor.dom.createFragment(value), parentNode);\n      } else {\n        var node = parentNode.firstChild;\n        var node2 = parentNode.lastChild;\n        if (!node || node === node2 && node.nodeName === 'BR') {\n          editor.dom.setHTML(parentNode, value);\n        } else {\n          editor.selection.setContent(value);\n        }\n      }\n    };\n    var trimBrsFromTableCell = function (dom, elm) {\n      Optional.from(dom.getParent(elm, 'td,th')).map(SugarElement.fromDom).each(trimBlockTrailingBr);\n    };\n    var reduceInlineTextElements = function (editor, merge) {\n      var textInlineElements = editor.schema.getTextInlineElements();\n      var dom = editor.dom;\n      if (merge) {\n        var root_1 = editor.getBody(), elementUtils_1 = new ElementUtils(dom);\n        Tools.each(dom.select('*[data-mce-fragment]'), function (node) {\n          for (var testNode = node.parentNode; testNode && testNode !== root_1; testNode = testNode.parentNode) {\n            if (textInlineElements[node.nodeName.toLowerCase()] && elementUtils_1.compare(testNode, node)) {\n              dom.remove(node, true);\n            }\n          }\n        });\n      }\n    };\n    var markFragmentElements = function (fragment) {\n      var node = fragment;\n      while (node = node.walk()) {\n        if (node.type === 1) {\n          node.attr('data-mce-fragment', '1');\n        }\n      }\n    };\n    var unmarkFragmentElements = function (elm) {\n      Tools.each(elm.getElementsByTagName('*'), function (elm) {\n        elm.removeAttribute('data-mce-fragment');\n      });\n    };\n    var isPartOfFragment = function (node) {\n      return !!node.getAttribute('data-mce-fragment');\n    };\n    var canHaveChildren = function (editor, node) {\n      return node && !editor.schema.getShortEndedElements()[node.nodeName];\n    };\n    var moveSelectionToMarker = function (editor, marker) {\n      var nextRng;\n      var dom = editor.dom, selection = editor.selection;\n      var node2;\n      var getContentEditableFalseParent = function (node) {\n        var root = editor.getBody();\n        for (; node && node !== root; node = node.parentNode) {\n          if (dom.getContentEditable(node) === 'false') {\n            return node;\n          }\n        }\n        return null;\n      };\n      if (!marker) {\n        return;\n      }\n      selection.scrollIntoView(marker);\n      var parentEditableFalseElm = getContentEditableFalseParent(marker);\n      if (parentEditableFalseElm) {\n        dom.remove(marker);\n        selection.select(parentEditableFalseElm);\n        return;\n      }\n      var rng = dom.createRng();\n      var node = marker.previousSibling;\n      if (node && node.nodeType === 3) {\n        rng.setStart(node, node.nodeValue.length);\n        if (!Env.ie) {\n          node2 = marker.nextSibling;\n          if (node2 && node2.nodeType === 3) {\n            node.appendData(node2.data);\n            node2.parentNode.removeChild(node2);\n          }\n        }\n      } else {\n        rng.setStartBefore(marker);\n        rng.setEndBefore(marker);\n      }\n      var findNextCaretRng = function (rng) {\n        var caretPos = CaretPosition$1.fromRangeStart(rng);\n        var caretWalker = CaretWalker(editor.getBody());\n        caretPos = caretWalker.next(caretPos);\n        if (caretPos) {\n          return caretPos.toRange();\n        }\n      };\n      var parentBlock = dom.getParent(marker, dom.isBlock);\n      dom.remove(marker);\n      if (parentBlock && dom.isEmpty(parentBlock)) {\n        editor.$(parentBlock).empty();\n        rng.setStart(parentBlock, 0);\n        rng.setEnd(parentBlock, 0);\n        if (!isTableCell$4(parentBlock) && !isPartOfFragment(parentBlock) && (nextRng = findNextCaretRng(rng))) {\n          rng = nextRng;\n          dom.remove(parentBlock);\n        } else {\n          dom.add(parentBlock, dom.create('br', { 'data-mce-bogus': '1' }));\n        }\n      }\n      selection.setRng(rng);\n    };\n    var deleteSelectedContent = function (editor) {\n      var dom = editor.dom;\n      var rng = normalize$2(editor.selection.getRng());\n      editor.selection.setRng(rng);\n      var startCell = dom.getParent(rng.startContainer, isTableCell$4);\n      if (isTableCellContentSelected(dom, rng, startCell)) {\n        deleteCellContents(editor, rng, SugarElement.fromDom(startCell));\n      } else {\n        editor.getDoc().execCommand('Delete', false, null);\n      }\n    };\n    var insertHtmlAtCaret = function (editor, value, details) {\n      var parentNode, rootNode, args;\n      var marker, rng, node;\n      var selection = editor.selection, dom = editor.dom;\n      if (/^ | $/.test(value)) {\n        value = trimOrPadLeftRight(dom, selection.getRng(), value);\n      }\n      var parser = editor.parser;\n      var merge = details.merge;\n      var serializer = HtmlSerializer({ validate: shouldValidate(editor) }, editor.schema);\n      var bookmarkHtml = '<span id=\"mce_marker\" data-mce-type=\"bookmark\">&#xFEFF;</span>';\n      args = {\n        content: value,\n        format: 'html',\n        selection: true,\n        paste: details.paste\n      };\n      args = editor.fire('BeforeSetContent', args);\n      if (args.isDefaultPrevented()) {\n        editor.fire('SetContent', {\n          content: args.content,\n          format: 'html',\n          selection: true,\n          paste: details.paste\n        });\n        return;\n      }\n      value = args.content;\n      if (value.indexOf('{$caret}') === -1) {\n        value += '{$caret}';\n      }\n      value = value.replace(/\\{\\$caret\\}/, bookmarkHtml);\n      rng = selection.getRng();\n      var caretElement = rng.startContainer || (rng.parentElement ? rng.parentElement() : null);\n      var body = editor.getBody();\n      if (caretElement === body && selection.isCollapsed()) {\n        if (dom.isBlock(body.firstChild) && canHaveChildren(editor, body.firstChild) && dom.isEmpty(body.firstChild)) {\n          rng = dom.createRng();\n          rng.setStart(body.firstChild, 0);\n          rng.setEnd(body.firstChild, 0);\n          selection.setRng(rng);\n        }\n      }\n      if (!selection.isCollapsed()) {\n        deleteSelectedContent(editor);\n      }\n      parentNode = selection.getNode();\n      var parserArgs = {\n        context: parentNode.nodeName.toLowerCase(),\n        data: details.data,\n        insert: true\n      };\n      var fragment = parser.parse(value, parserArgs);\n      if (details.paste === true && isListFragment(editor.schema, fragment) && isParentBlockLi(dom, parentNode)) {\n        rng = insertAtCaret(serializer, dom, selection.getRng(), fragment);\n        selection.setRng(rng);\n        editor.fire('SetContent', args);\n        return;\n      }\n      markFragmentElements(fragment);\n      node = fragment.lastChild;\n      if (node.attr('id') === 'mce_marker') {\n        marker = node;\n        for (node = node.prev; node; node = node.walk(true)) {\n          if (node.type === 3 || !dom.isBlock(node.name)) {\n            if (editor.schema.isValidChild(node.parent.name, 'span')) {\n              node.parent.insert(marker, node, node.name === 'br');\n            }\n            break;\n          }\n        }\n      }\n      editor._selectionOverrides.showBlockCaretContainer(parentNode);\n      if (!parserArgs.invalid) {\n        value = serializer.serialize(fragment);\n        validInsertion(editor, value, parentNode);\n      } else {\n        editor.selection.setContent(bookmarkHtml);\n        parentNode = selection.getNode();\n        rootNode = editor.getBody();\n        if (parentNode.nodeType === 9) {\n          parentNode = node = rootNode;\n        } else {\n          node = parentNode;\n        }\n        while (node !== rootNode) {\n          parentNode = node;\n          node = node.parentNode;\n        }\n        value = parentNode === rootNode ? rootNode.innerHTML : dom.getOuterHTML(parentNode);\n        value = serializer.serialize(parser.parse(value.replace(/<span (id=\"mce_marker\"|id=mce_marker).+?<\\/span>/i, function () {\n          return serializer.serialize(fragment);\n        })));\n        if (parentNode === rootNode) {\n          dom.setHTML(rootNode, value);\n        } else {\n          dom.setOuterHTML(parentNode, value);\n        }\n      }\n      reduceInlineTextElements(editor, merge);\n      moveSelectionToMarker(editor, dom.get('mce_marker'));\n      unmarkFragmentElements(editor.getBody());\n      trimBrsFromTableCell(dom, selection.getStart());\n      editor.fire('SetContent', args);\n      editor.addVisual();\n    };\n\n    var traverse = function (node, fn) {\n      fn(node);\n      if (node.firstChild) {\n        traverse(node.firstChild, fn);\n      }\n      if (node.next) {\n        traverse(node.next, fn);\n      }\n    };\n    var findMatchingNodes = function (nodeFilters, attributeFilters, node) {\n      var nodeMatches = {};\n      var attrMatches = {};\n      var matches = [];\n      if (node.firstChild) {\n        traverse(node.firstChild, function (node) {\n          each(nodeFilters, function (filter) {\n            if (filter.name === node.name) {\n              if (nodeMatches[filter.name]) {\n                nodeMatches[filter.name].nodes.push(node);\n              } else {\n                nodeMatches[filter.name] = {\n                  filter: filter,\n                  nodes: [node]\n                };\n              }\n            }\n          });\n          each(attributeFilters, function (filter) {\n            if (typeof node.attr(filter.name) === 'string') {\n              if (attrMatches[filter.name]) {\n                attrMatches[filter.name].nodes.push(node);\n              } else {\n                attrMatches[filter.name] = {\n                  filter: filter,\n                  nodes: [node]\n                };\n              }\n            }\n          });\n        });\n      }\n      for (var name_1 in nodeMatches) {\n        if (nodeMatches.hasOwnProperty(name_1)) {\n          matches.push(nodeMatches[name_1]);\n        }\n      }\n      for (var name_2 in attrMatches) {\n        if (attrMatches.hasOwnProperty(name_2)) {\n          matches.push(attrMatches[name_2]);\n        }\n      }\n      return matches;\n    };\n    var filter$3 = function (nodeFilters, attributeFilters, node) {\n      var matches = findMatchingNodes(nodeFilters, attributeFilters, node);\n      each(matches, function (match) {\n        each(match.filter.callbacks, function (callback) {\n          callback(match.nodes, match.filter.name, {});\n        });\n      });\n    };\n\n    var defaultFormat = 'html';\n    var isTreeNode = function (content) {\n      return content instanceof AstNode;\n    };\n    var moveSelection = function (editor) {\n      if (hasFocus$1(editor)) {\n        firstPositionIn(editor.getBody()).each(function (pos) {\n          var node = pos.getNode();\n          var caretPos = isTable(node) ? firstPositionIn(node).getOr(pos) : pos;\n          editor.selection.setRng(caretPos.toRange());\n        });\n      }\n    };\n    var setEditorHtml = function (editor, html) {\n      editor.dom.setHTML(editor.getBody(), html);\n      moveSelection(editor);\n    };\n    var setContentString = function (editor, body, content, args) {\n      var forcedRootBlockName, padd;\n      if (content.length === 0 || /^\\s+$/.test(content)) {\n        padd = '<br data-mce-bogus=\"1\">';\n        if (body.nodeName === 'TABLE') {\n          content = '<tr><td>' + padd + '</td></tr>';\n        } else if (/^(UL|OL)$/.test(body.nodeName)) {\n          content = '<li>' + padd + '</li>';\n        }\n        forcedRootBlockName = getForcedRootBlock(editor);\n        if (forcedRootBlockName && editor.schema.isValidChild(body.nodeName.toLowerCase(), forcedRootBlockName.toLowerCase())) {\n          content = padd;\n          content = editor.dom.createHTML(forcedRootBlockName, getForcedRootBlockAttrs(editor), content);\n        } else if (!content) {\n          content = '<br data-mce-bogus=\"1\">';\n        }\n        setEditorHtml(editor, content);\n        editor.fire('SetContent', args);\n      } else {\n        if (args.format !== 'raw') {\n          content = HtmlSerializer({ validate: editor.validate }, editor.schema).serialize(editor.parser.parse(content, {\n            isRootContent: true,\n            insert: true\n          }));\n        }\n        args.content = isWsPreserveElement(SugarElement.fromDom(body)) ? content : Tools.trim(content);\n        setEditorHtml(editor, args.content);\n        if (!args.no_events) {\n          editor.fire('SetContent', args);\n        }\n      }\n      return args.content;\n    };\n    var setContentTree = function (editor, body, content, args) {\n      filter$3(editor.parser.getNodeFilters(), editor.parser.getAttributeFilters(), content);\n      var html = HtmlSerializer({ validate: editor.validate }, editor.schema).serialize(content);\n      args.content = isWsPreserveElement(SugarElement.fromDom(body)) ? html : Tools.trim(html);\n      setEditorHtml(editor, args.content);\n      if (!args.no_events) {\n        editor.fire('SetContent', args);\n      }\n      return content;\n    };\n    var setContentInternal = function (editor, content, args) {\n      args.format = args.format ? args.format : defaultFormat;\n      args.set = true;\n      args.content = isTreeNode(content) ? '' : content;\n      if (!isTreeNode(content) && !args.no_events) {\n        editor.fire('BeforeSetContent', args);\n        content = args.content;\n      }\n      return Optional.from(editor.getBody()).fold(constant(content), function (body) {\n        return isTreeNode(content) ? setContentTree(editor, body, content, args) : setContentString(editor, body, content, args);\n      });\n    };\n\n    var isEq$2 = isEq;\n    var matchesUnInheritedFormatSelector = function (ed, node, name) {\n      var formatList = ed.formatter.get(name);\n      if (formatList) {\n        for (var i = 0; i < formatList.length; i++) {\n          if (formatList[i].inherit === false && ed.dom.is(node, formatList[i].selector)) {\n            return true;\n          }\n        }\n      }\n      return false;\n    };\n    var matchParents = function (editor, node, name, vars) {\n      var root = editor.dom.getRoot();\n      if (node === root) {\n        return false;\n      }\n      node = editor.dom.getParent(node, function (node) {\n        if (matchesUnInheritedFormatSelector(editor, node, name)) {\n          return true;\n        }\n        return node.parentNode === root || !!matchNode(editor, node, name, vars, true);\n      });\n      return matchNode(editor, node, name, vars);\n    };\n    var matchName = function (dom, node, format) {\n      if (isEq$2(node, format.inline)) {\n        return true;\n      }\n      if (isEq$2(node, format.block)) {\n        return true;\n      }\n      if (format.selector) {\n        return node.nodeType === 1 && dom.is(node, format.selector);\n      }\n    };\n    var matchItems = function (dom, node, format, itemName, similar, vars) {\n      var key, value;\n      var items = format[itemName];\n      var i;\n      if (format.onmatch) {\n        return format.onmatch(node, format, itemName);\n      }\n      if (items) {\n        if (typeof items.length === 'undefined') {\n          for (key in items) {\n            if (items.hasOwnProperty(key)) {\n              if (itemName === 'attributes') {\n                value = dom.getAttrib(node, key);\n              } else {\n                value = getStyle(dom, node, key);\n              }\n              if (similar && !value && !format.exact) {\n                return;\n              }\n              if ((!similar || format.exact) && !isEq$2(value, normalizeStyleValue(dom, replaceVars(items[key], vars), key))) {\n                return;\n              }\n            }\n          }\n        } else {\n          for (i = 0; i < items.length; i++) {\n            if (itemName === 'attributes' ? dom.getAttrib(node, items[i]) : getStyle(dom, node, items[i])) {\n              return format;\n            }\n          }\n        }\n      }\n      return format;\n    };\n    var matchNode = function (ed, node, name, vars, similar) {\n      var formatList = ed.formatter.get(name);\n      var format, i, x, classes;\n      var dom = ed.dom;\n      if (formatList && node) {\n        for (i = 0; i < formatList.length; i++) {\n          format = formatList[i];\n          if (matchName(ed.dom, node, format) && matchItems(dom, node, format, 'attributes', similar, vars) && matchItems(dom, node, format, 'styles', similar, vars)) {\n            if (classes = format.classes) {\n              for (x = 0; x < classes.length; x++) {\n                if (!ed.dom.hasClass(node, classes[x])) {\n                  return;\n                }\n              }\n            }\n            return format;\n          }\n        }\n      }\n    };\n    var match = function (editor, name, vars, node) {\n      if (node) {\n        return matchParents(editor, node, name, vars);\n      }\n      node = editor.selection.getNode();\n      if (matchParents(editor, node, name, vars)) {\n        return true;\n      }\n      var startNode = editor.selection.getStart();\n      if (startNode !== node) {\n        if (matchParents(editor, startNode, name, vars)) {\n          return true;\n        }\n      }\n      return false;\n    };\n    var matchAll = function (editor, names, vars) {\n      var matchedFormatNames = [];\n      var checkedMap = {};\n      var startElement = editor.selection.getStart();\n      editor.dom.getParent(startElement, function (node) {\n        for (var i = 0; i < names.length; i++) {\n          var name_1 = names[i];\n          if (!checkedMap[name_1] && matchNode(editor, node, name_1, vars)) {\n            checkedMap[name_1] = true;\n            matchedFormatNames.push(name_1);\n          }\n        }\n      }, editor.dom.getRoot());\n      return matchedFormatNames;\n    };\n    var canApply = function (editor, name) {\n      var formatList = editor.formatter.get(name);\n      var startNode, parents, i, x, selector;\n      var dom = editor.dom;\n      if (formatList) {\n        startNode = editor.selection.getStart();\n        parents = getParents$1(dom, startNode);\n        for (x = formatList.length - 1; x >= 0; x--) {\n          selector = formatList[x].selector;\n          if (!selector || formatList[x].defaultBlock) {\n            return true;\n          }\n          for (i = parents.length - 1; i >= 0; i--) {\n            if (dom.is(parents[i], selector)) {\n              return true;\n            }\n          }\n        }\n      }\n      return false;\n    };\n    var matchAllOnNode = function (editor, node, formatNames) {\n      return foldl(formatNames, function (acc, name) {\n        var matchSimilar = isVariableFormatName(editor, name);\n        if (editor.formatter.matchNode(node, name, {}, matchSimilar)) {\n          return acc.concat([name]);\n        } else {\n          return acc;\n        }\n      }, []);\n    };\n\n    var ZWSP$1 = ZWSP, CARET_ID$1 = '_mce_caret';\n    var importNode = function (ownerDocument, node) {\n      return ownerDocument.importNode(node, true);\n    };\n    var getEmptyCaretContainers = function (node) {\n      var nodes = [];\n      while (node) {\n        if (node.nodeType === 3 && node.nodeValue !== ZWSP$1 || node.childNodes.length > 1) {\n          return [];\n        }\n        if (node.nodeType === 1) {\n          nodes.push(node);\n        }\n        node = node.firstChild;\n      }\n      return nodes;\n    };\n    var isCaretContainerEmpty = function (node) {\n      return getEmptyCaretContainers(node).length > 0;\n    };\n    var findFirstTextNode = function (node) {\n      if (node) {\n        var walker = new DomTreeWalker(node, node);\n        for (node = walker.current(); node; node = walker.next()) {\n          if (isText$1(node)) {\n            return node;\n          }\n        }\n      }\n      return null;\n    };\n    var createCaretContainer = function (fill) {\n      var caretContainer = SugarElement.fromTag('span');\n      setAll(caretContainer, {\n        'id': CARET_ID$1,\n        'data-mce-bogus': '1',\n        'data-mce-type': 'format-caret'\n      });\n      if (fill) {\n        append(caretContainer, SugarElement.fromText(ZWSP$1));\n      }\n      return caretContainer;\n    };\n    var trimZwspFromCaretContainer = function (caretContainerNode) {\n      var textNode = findFirstTextNode(caretContainerNode);\n      if (textNode && textNode.nodeValue.charAt(0) === ZWSP$1) {\n        textNode.deleteData(0, 1);\n      }\n      return textNode;\n    };\n    var removeCaretContainerNode = function (editor, node, moveCaret) {\n      if (moveCaret === void 0) {\n        moveCaret = true;\n      }\n      var dom = editor.dom, selection = editor.selection;\n      if (isCaretContainerEmpty(node)) {\n        deleteElement(editor, false, SugarElement.fromDom(node), moveCaret);\n      } else {\n        var rng = selection.getRng();\n        var block = dom.getParent(node, dom.isBlock);\n        var startContainer = rng.startContainer;\n        var startOffset = rng.startOffset;\n        var endContainer = rng.endContainer;\n        var endOffset = rng.endOffset;\n        var textNode = trimZwspFromCaretContainer(node);\n        dom.remove(node, true);\n        if (startContainer === textNode && startOffset > 0) {\n          rng.setStart(textNode, startOffset - 1);\n        }\n        if (endContainer === textNode && endOffset > 0) {\n          rng.setEnd(textNode, endOffset - 1);\n        }\n        if (block && dom.isEmpty(block)) {\n          fillWithPaddingBr(SugarElement.fromDom(block));\n        }\n        selection.setRng(rng);\n      }\n    };\n    var removeCaretContainer = function (editor, node, moveCaret) {\n      if (moveCaret === void 0) {\n        moveCaret = true;\n      }\n      var dom = editor.dom, selection = editor.selection;\n      if (!node) {\n        node = getParentCaretContainer(editor.getBody(), selection.getStart());\n        if (!node) {\n          while (node = dom.get(CARET_ID$1)) {\n            removeCaretContainerNode(editor, node, false);\n          }\n        }\n      } else {\n        removeCaretContainerNode(editor, node, moveCaret);\n      }\n    };\n    var insertCaretContainerNode = function (editor, caretContainer, formatNode) {\n      var dom = editor.dom, block = dom.getParent(formatNode, curry(isTextBlock$1, editor));\n      if (block && dom.isEmpty(block)) {\n        formatNode.parentNode.replaceChild(caretContainer, formatNode);\n      } else {\n        removeTrailingBr(SugarElement.fromDom(formatNode));\n        if (dom.isEmpty(formatNode)) {\n          formatNode.parentNode.replaceChild(caretContainer, formatNode);\n        } else {\n          dom.insertAfter(caretContainer, formatNode);\n        }\n      }\n    };\n    var appendNode = function (parentNode, node) {\n      parentNode.appendChild(node);\n      return node;\n    };\n    var insertFormatNodesIntoCaretContainer = function (formatNodes, caretContainer) {\n      var innerMostFormatNode = foldr(formatNodes, function (parentNode, formatNode) {\n        return appendNode(parentNode, formatNode.cloneNode(false));\n      }, caretContainer);\n      return appendNode(innerMostFormatNode, innerMostFormatNode.ownerDocument.createTextNode(ZWSP$1));\n    };\n    var cleanFormatNode = function (editor, caretContainer, formatNode, name, vars, similar) {\n      var formatter = editor.formatter;\n      var dom = editor.dom;\n      var validFormats = filter(keys(formatter.get()), function (formatName) {\n        return formatName !== name && !contains$1(formatName, 'removeformat');\n      });\n      var matchedFormats = matchAllOnNode(editor, formatNode, validFormats);\n      var uniqueFormats = filter(matchedFormats, function (fmtName) {\n        return !areSimilarFormats(editor, fmtName, name);\n      });\n      if (uniqueFormats.length > 0) {\n        var clonedFormatNode = formatNode.cloneNode(false);\n        dom.add(caretContainer, clonedFormatNode);\n        formatter.remove(name, vars, clonedFormatNode, similar);\n        dom.remove(clonedFormatNode);\n        return Optional.some(clonedFormatNode);\n      } else {\n        return Optional.none();\n      }\n    };\n    var applyCaretFormat = function (editor, name, vars) {\n      var caretContainer, textNode;\n      var selection = editor.selection;\n      var selectionRng = selection.getRng();\n      var offset = selectionRng.startOffset;\n      var container = selectionRng.startContainer;\n      var text = container.nodeValue;\n      caretContainer = getParentCaretContainer(editor.getBody(), selection.getStart());\n      if (caretContainer) {\n        textNode = findFirstTextNode(caretContainer);\n      }\n      var wordcharRegex = /[^\\s\\u00a0\\u00ad\\u200b\\ufeff]/;\n      if (text && offset > 0 && offset < text.length && wordcharRegex.test(text.charAt(offset)) && wordcharRegex.test(text.charAt(offset - 1))) {\n        var bookmark = selection.getBookmark();\n        selectionRng.collapse(true);\n        var rng = expandRng(editor, selectionRng, editor.formatter.get(name));\n        rng = split$1(rng);\n        editor.formatter.apply(name, vars, rng);\n        selection.moveToBookmark(bookmark);\n      } else {\n        if (!caretContainer || textNode.nodeValue !== ZWSP$1) {\n          caretContainer = importNode(editor.getDoc(), createCaretContainer(true).dom);\n          textNode = caretContainer.firstChild;\n          selectionRng.insertNode(caretContainer);\n          offset = 1;\n          editor.formatter.apply(name, vars, caretContainer);\n        } else {\n          editor.formatter.apply(name, vars, caretContainer);\n        }\n        selection.setCursorLocation(textNode, offset);\n      }\n    };\n    var removeCaretFormat = function (editor, name, vars, similar) {\n      var dom = editor.dom;\n      var selection = editor.selection;\n      var hasContentAfter, node, formatNode;\n      var parents = [];\n      var rng = selection.getRng();\n      var container = rng.startContainer;\n      var offset = rng.startOffset;\n      node = container;\n      if (container.nodeType === 3) {\n        if (offset !== container.nodeValue.length) {\n          hasContentAfter = true;\n        }\n        node = node.parentNode;\n      }\n      while (node) {\n        if (matchNode(editor, node, name, vars, similar)) {\n          formatNode = node;\n          break;\n        }\n        if (node.nextSibling) {\n          hasContentAfter = true;\n        }\n        parents.push(node);\n        node = node.parentNode;\n      }\n      if (!formatNode) {\n        return;\n      }\n      if (hasContentAfter) {\n        var bookmark = selection.getBookmark();\n        rng.collapse(true);\n        var expandedRng = expandRng(editor, rng, editor.formatter.get(name), true);\n        expandedRng = split$1(expandedRng);\n        editor.formatter.remove(name, vars, expandedRng, similar);\n        selection.moveToBookmark(bookmark);\n      } else {\n        var caretContainer = getParentCaretContainer(editor.getBody(), formatNode);\n        var newCaretContainer = createCaretContainer(false).dom;\n        insertCaretContainerNode(editor, newCaretContainer, caretContainer !== null ? caretContainer : formatNode);\n        var cleanedFormatNode = cleanFormatNode(editor, newCaretContainer, formatNode, name, vars, similar);\n        var caretTextNode = insertFormatNodesIntoCaretContainer(parents.concat(cleanedFormatNode.toArray()), newCaretContainer);\n        removeCaretContainerNode(editor, caretContainer, false);\n        selection.setCursorLocation(caretTextNode, 1);\n        if (dom.isEmpty(formatNode)) {\n          dom.remove(formatNode);\n        }\n      }\n    };\n    var disableCaretContainer = function (editor, keyCode) {\n      var selection = editor.selection, body = editor.getBody();\n      removeCaretContainer(editor, null, false);\n      if ((keyCode === 8 || keyCode === 46) && selection.isCollapsed() && selection.getStart().innerHTML === ZWSP$1) {\n        removeCaretContainer(editor, getParentCaretContainer(body, selection.getStart()));\n      }\n      if (keyCode === 37 || keyCode === 39) {\n        removeCaretContainer(editor, getParentCaretContainer(body, selection.getStart()));\n      }\n    };\n    var setup$3 = function (editor) {\n      editor.on('mouseup keydown', function (e) {\n        disableCaretContainer(editor, e.keyCode);\n      });\n    };\n    var replaceWithCaretFormat = function (targetNode, formatNodes) {\n      var caretContainer = createCaretContainer(false);\n      var innerMost = insertFormatNodesIntoCaretContainer(formatNodes, caretContainer.dom);\n      before(SugarElement.fromDom(targetNode), caretContainer);\n      remove(SugarElement.fromDom(targetNode));\n      return CaretPosition$1(innerMost, 0);\n    };\n    var isFormatElement = function (editor, element) {\n      var inlineElements = editor.schema.getTextInlineElements();\n      return inlineElements.hasOwnProperty(name(element)) && !isCaretNode(element.dom) && !isBogus(element.dom);\n    };\n    var isEmptyCaretFormatElement = function (element) {\n      return isCaretNode(element.dom) && isCaretContainerEmpty(element.dom);\n    };\n\n    var postProcessHooks = {};\n    var filter$4 = filter$2;\n    var each$8 = each$2;\n    var addPostProcessHook = function (name, hook) {\n      var hooks = postProcessHooks[name];\n      if (!hooks) {\n        postProcessHooks[name] = [];\n      }\n      postProcessHooks[name].push(hook);\n    };\n    var postProcess = function (name, editor) {\n      each$8(postProcessHooks[name], function (hook) {\n        hook(editor);\n      });\n    };\n    addPostProcessHook('pre', function (editor) {\n      var rng = editor.selection.getRng();\n      var blocks;\n      var hasPreSibling = function (pre) {\n        return isPre(pre.previousSibling) && indexOf$1(blocks, pre.previousSibling) !== -1;\n      };\n      var joinPre = function (pre1, pre2) {\n        DomQuery(pre2).remove();\n        DomQuery(pre1).append('<br><br>').append(pre2.childNodes);\n      };\n      var isPre = matchNodeNames(['pre']);\n      if (!rng.collapsed) {\n        blocks = editor.selection.getSelectedBlocks();\n        each$8(filter$4(filter$4(blocks, isPre), hasPreSibling), function (pre) {\n          joinPre(pre.previousSibling, pre);\n        });\n      }\n    });\n\n    var each$9 = Tools.each;\n    var isElementNode = function (node) {\n      return isElement$1(node) && !isBookmarkNode$1(node) && !isCaretNode(node) && !isBogus(node);\n    };\n    var findElementSibling = function (node, siblingName) {\n      var sibling;\n      for (sibling = node; sibling; sibling = sibling[siblingName]) {\n        if (isText$1(sibling) && sibling.nodeValue.length !== 0) {\n          return node;\n        }\n        if (isElement$1(sibling) && !isBookmarkNode$1(sibling)) {\n          return sibling;\n        }\n      }\n      return node;\n    };\n    var mergeSiblingsNodes = function (dom, prev, next) {\n      var sibling, tmpSibling;\n      var elementUtils = new ElementUtils(dom);\n      if (prev && next) {\n        prev = findElementSibling(prev, 'previousSibling');\n        next = findElementSibling(next, 'nextSibling');\n        if (elementUtils.compare(prev, next)) {\n          for (sibling = prev.nextSibling; sibling && sibling !== next;) {\n            tmpSibling = sibling;\n            sibling = sibling.nextSibling;\n            prev.appendChild(tmpSibling);\n          }\n          dom.remove(next);\n          Tools.each(Tools.grep(next.childNodes), function (node) {\n            prev.appendChild(node);\n          });\n          return prev;\n        }\n      }\n      return next;\n    };\n    var mergeSiblings = function (dom, format, vars, node) {\n      if (node && format.merge_siblings !== false) {\n        var newNode = mergeSiblingsNodes(dom, getNonWhiteSpaceSibling(node), node);\n        mergeSiblingsNodes(dom, newNode, getNonWhiteSpaceSibling(newNode, true));\n      }\n    };\n    var clearChildStyles = function (dom, format, node) {\n      if (format.clear_child_styles) {\n        var selector = format.links ? '*:not(a)' : '*';\n        each$9(dom.select(selector, node), function (node) {\n          if (isElementNode(node)) {\n            each$9(format.styles, function (value, name) {\n              dom.setStyle(node, name, '');\n            });\n          }\n        });\n      }\n    };\n    var processChildElements = function (node, filter, process) {\n      each$9(node.childNodes, function (node) {\n        if (isElementNode(node)) {\n          if (filter(node)) {\n            process(node);\n          }\n          if (node.hasChildNodes()) {\n            processChildElements(node, filter, process);\n          }\n        }\n      });\n    };\n    var unwrapEmptySpan = function (dom, node) {\n      if (node.nodeName === 'SPAN' && dom.getAttribs(node).length === 0) {\n        dom.remove(node, true);\n      }\n    };\n    var hasStyle = function (dom, name) {\n      return function (node) {\n        return !!(node && getStyle(dom, node, name));\n      };\n    };\n    var applyStyle = function (dom, name, value) {\n      return function (node) {\n        dom.setStyle(node, name, value);\n        if (node.getAttribute('style') === '') {\n          node.removeAttribute('style');\n        }\n        unwrapEmptySpan(dom, node);\n      };\n    };\n\n    var removeResult = Adt.generate([\n      { keep: [] },\n      { rename: ['name'] },\n      { removed: [] }\n    ]);\n    var MCE_ATTR_RE = /^(src|href|style)$/;\n    var each$a = Tools.each;\n    var isEq$3 = isEq;\n    var isTableCellOrRow = function (node) {\n      return /^(TR|TH|TD)$/.test(node.nodeName);\n    };\n    var isChildOfInlineParent = function (dom, node, parent) {\n      return dom.isChildOf(node, parent) && node !== parent && !dom.isBlock(parent);\n    };\n    var getContainer = function (ed, rng, start) {\n      var container, offset;\n      container = rng[start ? 'startContainer' : 'endContainer'];\n      offset = rng[start ? 'startOffset' : 'endOffset'];\n      if (isElement$1(container)) {\n        var lastIdx = container.childNodes.length - 1;\n        if (!start && offset) {\n          offset--;\n        }\n        container = container.childNodes[offset > lastIdx ? lastIdx : offset];\n      }\n      if (isText$1(container) && start && offset >= container.nodeValue.length) {\n        container = new DomTreeWalker(container, ed.getBody()).next() || container;\n      }\n      if (isText$1(container) && !start && offset === 0) {\n        container = new DomTreeWalker(container, ed.getBody()).prev() || container;\n      }\n      return container;\n    };\n    var normalizeTableSelection = function (node, start) {\n      var prop = start ? 'firstChild' : 'lastChild';\n      if (isTableCellOrRow(node) && node[prop]) {\n        var childNode = node[prop];\n        if (node.nodeName === 'TR') {\n          return childNode[prop] || childNode;\n        } else {\n          return childNode;\n        }\n      }\n      return node;\n    };\n    var wrap$2 = function (dom, node, name, attrs) {\n      var wrapper = dom.create(name, attrs);\n      node.parentNode.insertBefore(wrapper, node);\n      wrapper.appendChild(node);\n      return wrapper;\n    };\n    var wrapWithSiblings = function (dom, node, next, name, attrs) {\n      var start = SugarElement.fromDom(node);\n      var wrapper = SugarElement.fromDom(dom.create(name, attrs));\n      var siblings = next ? nextSiblings(start) : prevSiblings(start);\n      append$1(wrapper, siblings);\n      if (next) {\n        before(start, wrapper);\n        prepend(wrapper, start);\n      } else {\n        after(start, wrapper);\n        append(wrapper, start);\n      }\n      return wrapper.dom;\n    };\n    var matchName$1 = function (dom, node, format) {\n      if (isEq$3(node, format.inline)) {\n        return true;\n      }\n      if (isEq$3(node, format.block)) {\n        return true;\n      }\n      if (format.selector) {\n        return isElement$1(node) && dom.is(node, format.selector);\n      }\n    };\n    var isColorFormatAndAnchor = function (node, format) {\n      return format.links && node.nodeName === 'A';\n    };\n    var find$3 = function (dom, node, next, inc) {\n      node = getNonWhiteSpaceSibling(node, next, inc);\n      return !node || (node.nodeName === 'BR' || dom.isBlock(node));\n    };\n    var removeNode$1 = function (ed, node, format) {\n      var parentNode = node.parentNode;\n      var rootBlockElm;\n      var dom = ed.dom, forcedRootBlock = getForcedRootBlock(ed);\n      if (format.block) {\n        if (!forcedRootBlock) {\n          if (dom.isBlock(node) && !dom.isBlock(parentNode)) {\n            if (!find$3(dom, node, false) && !find$3(dom, node.firstChild, true, true)) {\n              node.insertBefore(dom.create('br'), node.firstChild);\n            }\n            if (!find$3(dom, node, true) && !find$3(dom, node.lastChild, false, true)) {\n              node.appendChild(dom.create('br'));\n            }\n          }\n        } else {\n          if (parentNode === dom.getRoot()) {\n            if (!format.list_block || !isEq$3(node, format.list_block)) {\n              each(from$1(node.childNodes), function (node) {\n                if (isValid(ed, forcedRootBlock, node.nodeName.toLowerCase())) {\n                  if (!rootBlockElm) {\n                    rootBlockElm = wrap$2(dom, node, forcedRootBlock);\n                    dom.setAttribs(rootBlockElm, ed.settings.forced_root_block_attrs);\n                  } else {\n                    rootBlockElm.appendChild(node);\n                  }\n                } else {\n                  rootBlockElm = 0;\n                }\n              });\n            }\n          }\n        }\n      }\n      if (format.selector && format.inline && !isEq$3(format.inline, node)) {\n        return;\n      }\n      dom.remove(node, true);\n    };\n    var removeFormatInternal = function (ed, format, vars, node, compareNode) {\n      var stylesModified;\n      var dom = ed.dom;\n      if (!matchName$1(dom, node, format) && !isColorFormatAndAnchor(node, format)) {\n        return removeResult.keep();\n      }\n      var elm = node;\n      if (format.inline && format.remove === 'all' && isArray(format.preserve_attributes)) {\n        var attrsToPreserve = filter(dom.getAttribs(elm), function (attr) {\n          return contains(format.preserve_attributes, attr.name.toLowerCase());\n        });\n        dom.removeAllAttribs(elm);\n        each(attrsToPreserve, function (attr) {\n          return dom.setAttrib(elm, attr.name, attr.value);\n        });\n        if (attrsToPreserve.length > 0) {\n          return removeResult.rename('span');\n        }\n      }\n      if (format.remove !== 'all') {\n        each$a(format.styles, function (value, name) {\n          value = normalizeStyleValue(dom, replaceVars(value, vars), name + '');\n          if (isNumber(name)) {\n            name = value;\n            compareNode = null;\n          }\n          if (format.remove_similar || (!compareNode || isEq$3(getStyle(dom, compareNode, name), value))) {\n            dom.setStyle(elm, name, '');\n          }\n          stylesModified = true;\n        });\n        if (stylesModified && dom.getAttrib(elm, 'style') === '') {\n          elm.removeAttribute('style');\n          elm.removeAttribute('data-mce-style');\n        }\n        each$a(format.attributes, function (value, name) {\n          var valueOut;\n          value = replaceVars(value, vars);\n          if (isNumber(name)) {\n            name = value;\n            compareNode = null;\n          }\n          if (format.remove_similar || (!compareNode || isEq$3(dom.getAttrib(compareNode, name), value))) {\n            if (name === 'class') {\n              value = dom.getAttrib(elm, name);\n              if (value) {\n                valueOut = '';\n                each(value.split(/\\s+/), function (cls) {\n                  if (/mce\\-\\w+/.test(cls)) {\n                    valueOut += (valueOut ? ' ' : '') + cls;\n                  }\n                });\n                if (valueOut) {\n                  dom.setAttrib(elm, name, valueOut);\n                  return;\n                }\n              }\n            }\n            if (name === 'class') {\n              elm.removeAttribute('className');\n            }\n            if (MCE_ATTR_RE.test(name)) {\n              elm.removeAttribute('data-mce-' + name);\n            }\n            elm.removeAttribute(name);\n          }\n        });\n        each$a(format.classes, function (value) {\n          value = replaceVars(value, vars);\n          if (!compareNode || dom.hasClass(compareNode, value)) {\n            dom.removeClass(elm, value);\n          }\n        });\n        var attrs = dom.getAttribs(elm);\n        for (var i = 0; i < attrs.length; i++) {\n          var attrName = attrs[i].nodeName;\n          if (attrName.indexOf('_') !== 0 && attrName.indexOf('data-') !== 0) {\n            return removeResult.keep();\n          }\n        }\n      }\n      if (format.remove !== 'none') {\n        removeNode$1(ed, elm, format);\n        return removeResult.removed();\n      }\n      return removeResult.keep();\n    };\n    var removeFormat = function (ed, format, vars, node, compareNode) {\n      return removeFormatInternal(ed, format, vars, node, compareNode).fold(never, function (newName) {\n        ed.dom.rename(node, newName);\n        return true;\n      }, always);\n    };\n    var findFormatRoot = function (editor, container, name, vars, similar) {\n      var formatRoot;\n      each(getParents$1(editor.dom, container.parentNode).reverse(), function (parent) {\n        if (!formatRoot && parent.id !== '_start' && parent.id !== '_end') {\n          var format = matchNode(editor, parent, name, vars, similar);\n          if (format && format.split !== false) {\n            formatRoot = parent;\n          }\n        }\n      });\n      return formatRoot;\n    };\n    var removeFormatFromClone = function (editor, format, vars, clone) {\n      return removeFormatInternal(editor, format, vars, clone, clone).fold(constant(clone), function (newName) {\n        var fragment = editor.dom.createFragment();\n        fragment.appendChild(clone);\n        return editor.dom.rename(clone, newName);\n      }, constant(null));\n    };\n    var wrapAndSplit = function (editor, formatList, formatRoot, container, target, split, format, vars) {\n      var clone, lastClone, firstClone;\n      var dom = editor.dom;\n      if (formatRoot) {\n        var formatRootParent = formatRoot.parentNode;\n        for (var parent_1 = container.parentNode; parent_1 && parent_1 !== formatRootParent; parent_1 = parent_1.parentNode) {\n          clone = dom.clone(parent_1, false);\n          for (var i = 0; i < formatList.length; i++) {\n            clone = removeFormatFromClone(editor, formatList[i], vars, clone);\n            if (clone === null) {\n              break;\n            }\n          }\n          if (clone) {\n            if (lastClone) {\n              clone.appendChild(lastClone);\n            }\n            if (!firstClone) {\n              firstClone = clone;\n            }\n            lastClone = clone;\n          }\n        }\n        if (split && (!format.mixed || !dom.isBlock(formatRoot))) {\n          container = dom.split(formatRoot, container);\n        }\n        if (lastClone) {\n          target.parentNode.insertBefore(lastClone, target);\n          firstClone.appendChild(target);\n          if (format.inline) {\n            mergeSiblings(dom, format, vars, lastClone);\n          }\n        }\n      }\n      return container;\n    };\n    var remove$6 = function (ed, name, vars, node, similar) {\n      var formatList = ed.formatter.get(name);\n      var format = formatList[0];\n      var contentEditable = true;\n      var dom = ed.dom;\n      var selection = ed.selection;\n      var splitToFormatRoot = function (container) {\n        var formatRoot = findFormatRoot(ed, container, name, vars, similar);\n        return wrapAndSplit(ed, formatList, formatRoot, container, container, true, format, vars);\n      };\n      var isRemoveBookmarkNode = function (node) {\n        return isBookmarkNode$1(node) && isElement$1(node) && (node.id === '_start' || node.id === '_end');\n      };\n      var process = function (node) {\n        var lastContentEditable, hasContentEditableState;\n        if (isElement$1(node) && dom.getContentEditable(node)) {\n          lastContentEditable = contentEditable;\n          contentEditable = dom.getContentEditable(node) === 'true';\n          hasContentEditableState = true;\n        }\n        var children = from$1(node.childNodes);\n        if (contentEditable && !hasContentEditableState) {\n          for (var i = 0; i < formatList.length; i++) {\n            if (removeFormat(ed, formatList[i], vars, node, node)) {\n              break;\n            }\n          }\n        }\n        if (format.deep) {\n          if (children.length) {\n            for (var i = 0; i < children.length; i++) {\n              process(children[i]);\n            }\n            if (hasContentEditableState) {\n              contentEditable = lastContentEditable;\n            }\n          }\n        }\n      };\n      var unwrap = function (start) {\n        var node = dom.get(start ? '_start' : '_end');\n        var out = node[start ? 'firstChild' : 'lastChild'];\n        if (isRemoveBookmarkNode(out)) {\n          out = out[start ? 'firstChild' : 'lastChild'];\n        }\n        if (isText$1(out) && out.data.length === 0) {\n          out = start ? node.previousSibling || node.nextSibling : node.nextSibling || node.previousSibling;\n        }\n        dom.remove(node, true);\n        return out;\n      };\n      var removeRngStyle = function (rng) {\n        var startContainer, endContainer;\n        var expandedRng = expandRng(ed, rng, formatList, true);\n        if (format.split) {\n          expandedRng = split$1(expandedRng);\n          startContainer = getContainer(ed, expandedRng, true);\n          endContainer = getContainer(ed, expandedRng);\n          if (startContainer !== endContainer) {\n            startContainer = normalizeTableSelection(startContainer, true);\n            endContainer = normalizeTableSelection(endContainer, false);\n            if (isChildOfInlineParent(dom, startContainer, endContainer)) {\n              var marker = Optional.from(startContainer.firstChild).getOr(startContainer);\n              splitToFormatRoot(wrapWithSiblings(dom, marker, true, 'span', {\n                'id': '_start',\n                'data-mce-type': 'bookmark'\n              }));\n              unwrap(true);\n              return;\n            }\n            if (isChildOfInlineParent(dom, endContainer, startContainer)) {\n              var marker = Optional.from(endContainer.lastChild).getOr(endContainer);\n              splitToFormatRoot(wrapWithSiblings(dom, marker, false, 'span', {\n                'id': '_end',\n                'data-mce-type': 'bookmark'\n              }));\n              unwrap(false);\n              return;\n            }\n            startContainer = wrap$2(dom, startContainer, 'span', {\n              'id': '_start',\n              'data-mce-type': 'bookmark'\n            });\n            endContainer = wrap$2(dom, endContainer, 'span', {\n              'id': '_end',\n              'data-mce-type': 'bookmark'\n            });\n            var newRng = dom.createRng();\n            newRng.setStartAfter(startContainer);\n            newRng.setEndBefore(endContainer);\n            walk$1(dom, newRng, function (nodes) {\n              each(nodes, function (n) {\n                if (!isBookmarkNode$1(n) && !isBookmarkNode$1(n.parentNode)) {\n                  splitToFormatRoot(n);\n                }\n              });\n            });\n            splitToFormatRoot(startContainer);\n            splitToFormatRoot(endContainer);\n            startContainer = unwrap(true);\n            endContainer = unwrap();\n          } else {\n            startContainer = endContainer = splitToFormatRoot(startContainer);\n          }\n          expandedRng.startContainer = startContainer.parentNode ? startContainer.parentNode : startContainer;\n          expandedRng.startOffset = dom.nodeIndex(startContainer);\n          expandedRng.endContainer = endContainer.parentNode ? endContainer.parentNode : endContainer;\n          expandedRng.endOffset = dom.nodeIndex(endContainer) + 1;\n        }\n        walk$1(dom, expandedRng, function (nodes) {\n          each(nodes, function (node) {\n            process(node);\n            var textDecorations = [\n              'underline',\n              'line-through',\n              'overline'\n            ];\n            each(textDecorations, function (decoration) {\n              if (isElement$1(node) && ed.dom.getStyle(node, 'text-decoration') === decoration && node.parentNode && getTextDecoration(dom, node.parentNode) === decoration) {\n                removeFormat(ed, {\n                  deep: false,\n                  exact: true,\n                  inline: 'span',\n                  styles: { textDecoration: decoration }\n                }, null, node);\n              }\n            });\n          });\n        });\n      };\n      if (node) {\n        if (isNode(node)) {\n          var rng = dom.createRng();\n          rng.setStartBefore(node);\n          rng.setEndAfter(node);\n          removeRngStyle(rng);\n        } else {\n          removeRngStyle(node);\n        }\n        return;\n      }\n      if (dom.getContentEditable(selection.getNode()) === 'false') {\n        node = selection.getNode();\n        for (var i = 0; i < formatList.length; i++) {\n          if (formatList[i].ceFalseOverride) {\n            if (removeFormat(ed, formatList[i], vars, node, node)) {\n              break;\n            }\n          }\n        }\n        return;\n      }\n      if (!selection.isCollapsed() || !format.inline || getCellsFromEditor(ed).length) {\n        preserve(selection, true, function () {\n          runOnRanges(ed, removeRngStyle);\n        });\n        if (format.inline && match(ed, name, vars, selection.getStart())) {\n          moveStart(dom, selection, selection.getRng());\n        }\n        ed.nodeChanged();\n      } else {\n        removeCaretFormat(ed, name, vars, similar);\n      }\n    };\n\n    var each$b = Tools.each;\n    var mergeTextDecorationsAndColor = function (dom, format, vars, node) {\n      var processTextDecorationsAndColor = function (n) {\n        if (n.nodeType === 1 && n.parentNode && n.parentNode.nodeType === 1) {\n          var textDecoration = getTextDecoration(dom, n.parentNode);\n          if (dom.getStyle(n, 'color') && textDecoration) {\n            dom.setStyle(n, 'text-decoration', textDecoration);\n          } else if (dom.getStyle(n, 'text-decoration') === textDecoration) {\n            dom.setStyle(n, 'text-decoration', null);\n          }\n        }\n      };\n      if (format.styles && (format.styles.color || format.styles.textDecoration)) {\n        Tools.walk(node, processTextDecorationsAndColor, 'childNodes');\n        processTextDecorationsAndColor(node);\n      }\n    };\n    var mergeBackgroundColorAndFontSize = function (dom, format, vars, node) {\n      if (format.styles && format.styles.backgroundColor) {\n        processChildElements(node, hasStyle(dom, 'fontSize'), applyStyle(dom, 'backgroundColor', replaceVars(format.styles.backgroundColor, vars)));\n      }\n    };\n    var mergeSubSup = function (dom, format, vars, node) {\n      if (format.inline === 'sub' || format.inline === 'sup') {\n        processChildElements(node, hasStyle(dom, 'fontSize'), applyStyle(dom, 'fontSize', ''));\n        dom.remove(dom.select(format.inline === 'sup' ? 'sub' : 'sup', node), true);\n      }\n    };\n    var mergeWithChildren = function (editor, formatList, vars, node) {\n      each$b(formatList, function (format) {\n        each$b(editor.dom.select(format.inline, node), function (child) {\n          if (!isElementNode(child)) {\n            return;\n          }\n          removeFormat(editor, format, vars, child, format.exact ? child : null);\n        });\n        clearChildStyles(editor.dom, format, node);\n      });\n    };\n    var mergeWithParents = function (editor, format, name, vars, node) {\n      if (matchNode(editor, node.parentNode, name, vars)) {\n        if (removeFormat(editor, format, vars, node)) {\n          return;\n        }\n      }\n      if (format.merge_with_parents) {\n        editor.dom.getParent(node.parentNode, function (parent) {\n          if (matchNode(editor, parent, name, vars)) {\n            removeFormat(editor, format, vars, node);\n            return true;\n          }\n        });\n      }\n    };\n\n    var each$c = Tools.each;\n    var isElementNode$1 = function (node) {\n      return node && node.nodeType === 1 && !isBookmarkNode$1(node) && !isCaretNode(node) && !isBogus(node);\n    };\n    var applyFormat = function (ed, name, vars, node) {\n      var formatList = ed.formatter.get(name);\n      var format = formatList[0];\n      var rng;\n      var isCollapsed = !node && ed.selection.isCollapsed();\n      var dom = ed.dom, selection = ed.selection;\n      var setElementFormat = function (elm, fmt) {\n        fmt = fmt || format;\n        if (elm) {\n          if (fmt.onformat) {\n            fmt.onformat(elm, fmt, vars, node);\n          }\n          each$c(fmt.styles, function (value, name) {\n            dom.setStyle(elm, name, replaceVars(value, vars));\n          });\n          if (fmt.styles) {\n            var styleVal = dom.getAttrib(elm, 'style');\n            if (styleVal) {\n              dom.setAttrib(elm, 'data-mce-style', styleVal);\n            }\n          }\n          each$c(fmt.attributes, function (value, name) {\n            dom.setAttrib(elm, name, replaceVars(value, vars));\n          });\n          each$c(fmt.classes, function (value) {\n            value = replaceVars(value, vars);\n            if (!dom.hasClass(elm, value)) {\n              dom.addClass(elm, value);\n            }\n          });\n        }\n      };\n      var applyNodeStyle = function (formatList, node) {\n        var found = false;\n        if (!format.selector) {\n          return false;\n        }\n        each$c(formatList, function (format) {\n          if ('collapsed' in format && format.collapsed !== isCollapsed) {\n            return;\n          }\n          if (dom.is(node, format.selector) && !isCaretNode(node)) {\n            setElementFormat(node, format);\n            found = true;\n            return false;\n          }\n        });\n        return found;\n      };\n      var applyRngStyle = function (dom, rng, bookmark, nodeSpecific) {\n        var newWrappers = [];\n        var contentEditable = true;\n        var wrapName = format.inline || format.block;\n        var wrapElm = dom.create(wrapName);\n        setElementFormat(wrapElm);\n        walk$1(dom, rng, function (nodes) {\n          var currentWrapElm;\n          var process = function (node) {\n            var hasContentEditableState = false;\n            var lastContentEditable = contentEditable;\n            var nodeName = node.nodeName.toLowerCase();\n            var parentName = node.parentNode.nodeName.toLowerCase();\n            if (isElement$1(node) && dom.getContentEditable(node)) {\n              lastContentEditable = contentEditable;\n              contentEditable = dom.getContentEditable(node) === 'true';\n              hasContentEditableState = true;\n            }\n            if (isEq(nodeName, 'br')) {\n              currentWrapElm = 0;\n              if (format.block) {\n                dom.remove(node);\n              }\n              return;\n            }\n            if (format.wrapper && matchNode(ed, node, name, vars)) {\n              currentWrapElm = 0;\n              return;\n            }\n            if (contentEditable && !hasContentEditableState && format.block && !format.wrapper && isTextBlock$1(ed, nodeName) && isValid(ed, parentName, wrapName)) {\n              var elm = dom.rename(node, wrapName);\n              setElementFormat(elm);\n              newWrappers.push(elm);\n              currentWrapElm = 0;\n              return;\n            }\n            if (format.selector) {\n              var found = applyNodeStyle(formatList, node);\n              if (!format.inline || found) {\n                currentWrapElm = 0;\n                return;\n              }\n            }\n            if (contentEditable && !hasContentEditableState && isValid(ed, wrapName, nodeName) && isValid(ed, parentName, wrapName) && !(!nodeSpecific && node.nodeType === 3 && node.nodeValue.length === 1 && node.nodeValue.charCodeAt(0) === 65279) && !isCaretNode(node) && (!format.inline || !dom.isBlock(node))) {\n              if (!currentWrapElm) {\n                currentWrapElm = dom.clone(wrapElm, false);\n                node.parentNode.insertBefore(currentWrapElm, node);\n                newWrappers.push(currentWrapElm);\n              }\n              currentWrapElm.appendChild(node);\n            } else {\n              currentWrapElm = 0;\n              each$c(Tools.grep(node.childNodes), process);\n              if (hasContentEditableState) {\n                contentEditable = lastContentEditable;\n              }\n              currentWrapElm = 0;\n            }\n          };\n          each$c(nodes, process);\n        });\n        if (format.links === true) {\n          each$c(newWrappers, function (node) {\n            var process = function (node) {\n              if (node.nodeName === 'A') {\n                setElementFormat(node, format);\n              }\n              each$c(Tools.grep(node.childNodes), process);\n            };\n            process(node);\n          });\n        }\n        each$c(newWrappers, function (node) {\n          var getChildCount = function (node) {\n            var count = 0;\n            each$c(node.childNodes, function (node) {\n              if (!isEmptyTextNode(node) && !isBookmarkNode$1(node)) {\n                count++;\n              }\n            });\n            return count;\n          };\n          var getChildElementNode = function (root) {\n            var child = false;\n            each$c(root.childNodes, function (node) {\n              if (isElementNode$1(node)) {\n                child = node;\n                return false;\n              }\n            });\n            return child;\n          };\n          var mergeStyles = function (node) {\n            var clone;\n            var child = getChildElementNode(node);\n            if (child && !isBookmarkNode$1(child) && matchName(dom, child, format)) {\n              clone = dom.clone(child, false);\n              setElementFormat(clone);\n              dom.replace(clone, node, true);\n              dom.remove(child, true);\n            }\n            return clone || node;\n          };\n          var childCount = getChildCount(node);\n          if ((newWrappers.length > 1 || !dom.isBlock(node)) && childCount === 0) {\n            dom.remove(node, true);\n            return;\n          }\n          if (format.inline || format.wrapper) {\n            if (!format.exact && childCount === 1) {\n              node = mergeStyles(node);\n            }\n            mergeWithChildren(ed, formatList, vars, node);\n            mergeWithParents(ed, format, name, vars, node);\n            mergeBackgroundColorAndFontSize(dom, format, vars, node);\n            mergeTextDecorationsAndColor(dom, format, vars, node);\n            mergeSubSup(dom, format, vars, node);\n            mergeSiblings(dom, format, vars, node);\n          }\n        });\n      };\n      if (dom.getContentEditable(selection.getNode()) === 'false') {\n        node = selection.getNode();\n        for (var i = 0, l = formatList.length; i < l; i++) {\n          if (formatList[i].ceFalseOverride && dom.is(node, formatList[i].selector)) {\n            setElementFormat(node, formatList[i]);\n            return;\n          }\n        }\n        return;\n      }\n      if (format) {\n        if (node) {\n          if (isNode(node)) {\n            if (!applyNodeStyle(formatList, node)) {\n              rng = dom.createRng();\n              rng.setStartBefore(node);\n              rng.setEndAfter(node);\n              applyRngStyle(dom, expandRng(ed, rng, formatList), null, true);\n            }\n          } else {\n            applyRngStyle(dom, node, null, true);\n          }\n        } else {\n          if (!isCollapsed || !format.inline || getCellsFromEditor(ed).length) {\n            var curSelNode = selection.getNode();\n            if (!ed.settings.forced_root_block && formatList[0].defaultBlock && !dom.getParent(curSelNode, dom.isBlock)) {\n              applyFormat(ed, formatList[0].defaultBlock);\n            }\n            selection.setRng(normalize$2(selection.getRng()));\n            preserve(selection, true, function (bookmark) {\n              runOnRanges(ed, function (selectionRng, fake) {\n                var expandedRng = fake ? selectionRng : expandRng(ed, selectionRng, formatList);\n                applyRngStyle(dom, expandedRng);\n              });\n            });\n            moveStart(dom, selection, selection.getRng());\n            ed.nodeChanged();\n          } else {\n            applyCaretFormat(ed, name, vars);\n          }\n        }\n        postProcess(name, ed);\n      }\n    };\n\n    var toggle = function (editor, name, vars, node) {\n      var fmt = editor.formatter.get(name);\n      if (match(editor, name, vars, node) && (!('toggle' in fmt[0]) || fmt[0].toggle)) {\n        remove$6(editor, name, vars, node);\n      } else {\n        applyFormat(editor, name, vars, node);\n      }\n    };\n\n    var fromElements = function (elements, scope) {\n      var doc = scope || document;\n      var fragment = doc.createDocumentFragment();\n      each(elements, function (element) {\n        fragment.appendChild(element.dom);\n      });\n      return SugarElement.fromDom(fragment);\n    };\n\n    var tableModel = function (element, width, rows) {\n      return {\n        element: element,\n        width: width,\n        rows: rows\n      };\n    };\n    var tableRow = function (element, cells) {\n      return {\n        element: element,\n        cells: cells\n      };\n    };\n    var cellPosition = function (x, y) {\n      return {\n        x: x,\n        y: y\n      };\n    };\n    var getSpan = function (td, key) {\n      var value = parseInt(get$3(td, key), 10);\n      return isNaN(value) ? 1 : value;\n    };\n    var fillout = function (table, x, y, tr, td) {\n      var rowspan = getSpan(td, 'rowspan');\n      var colspan = getSpan(td, 'colspan');\n      var rows = table.rows;\n      for (var y2 = y; y2 < y + rowspan; y2++) {\n        if (!rows[y2]) {\n          rows[y2] = tableRow(deep(tr), []);\n        }\n        for (var x2 = x; x2 < x + colspan; x2++) {\n          var cells = rows[y2].cells;\n          cells[x2] = y2 === y && x2 === x ? td : shallow(td);\n        }\n      }\n    };\n    var cellExists = function (table, x, y) {\n      var rows = table.rows;\n      var cells = rows[y] ? rows[y].cells : [];\n      return !!cells[x];\n    };\n    var skipCellsX = function (table, x, y) {\n      while (cellExists(table, x, y)) {\n        x++;\n      }\n      return x;\n    };\n    var getWidth = function (rows) {\n      return foldl(rows, function (acc, row) {\n        return row.cells.length > acc ? row.cells.length : acc;\n      }, 0);\n    };\n    var findElementPos = function (table, element) {\n      var rows = table.rows;\n      for (var y = 0; y < rows.length; y++) {\n        var cells = rows[y].cells;\n        for (var x = 0; x < cells.length; x++) {\n          if (eq$2(cells[x], element)) {\n            return Optional.some(cellPosition(x, y));\n          }\n        }\n      }\n      return Optional.none();\n    };\n    var extractRows = function (table, sx, sy, ex, ey) {\n      var newRows = [];\n      var rows = table.rows;\n      for (var y = sy; y <= ey; y++) {\n        var cells = rows[y].cells;\n        var slice = sx < ex ? cells.slice(sx, ex + 1) : cells.slice(ex, sx + 1);\n        newRows.push(tableRow(rows[y].element, slice));\n      }\n      return newRows;\n    };\n    var subTable = function (table, startPos, endPos) {\n      var sx = startPos.x, sy = startPos.y;\n      var ex = endPos.x, ey = endPos.y;\n      var newRows = sy < ey ? extractRows(table, sx, sy, ex, ey) : extractRows(table, sx, ey, ex, sy);\n      return tableModel(table.element, getWidth(newRows), newRows);\n    };\n    var createDomTable = function (table, rows) {\n      var tableElement = shallow(table.element);\n      var tableBody = SugarElement.fromTag('tbody');\n      append$1(tableBody, rows);\n      append(tableElement, tableBody);\n      return tableElement;\n    };\n    var modelRowsToDomRows = function (table) {\n      return map(table.rows, function (row) {\n        var cells = map(row.cells, function (cell) {\n          var td = deep(cell);\n          remove$1(td, 'colspan');\n          remove$1(td, 'rowspan');\n          return td;\n        });\n        var tr = shallow(row.element);\n        append$1(tr, cells);\n        return tr;\n      });\n    };\n    var fromDom$1 = function (tableElm) {\n      var table = tableModel(shallow(tableElm), 0, []);\n      each(descendants$1(tableElm, 'tr'), function (tr, y) {\n        each(descendants$1(tr, 'td,th'), function (td, x) {\n          fillout(table, skipCellsX(table, x, y), y, tr, td);\n        });\n      });\n      return tableModel(table.element, getWidth(table.rows), table.rows);\n    };\n    var toDom = function (table) {\n      return createDomTable(table, modelRowsToDomRows(table));\n    };\n    var subsection = function (table, startElement, endElement) {\n      return findElementPos(table, startElement).bind(function (startPos) {\n        return findElementPos(table, endElement).map(function (endPos) {\n          return subTable(table, startPos, endPos);\n        });\n      });\n    };\n\n    var findParentListContainer = function (parents) {\n      return find(parents, function (elm) {\n        return name(elm) === 'ul' || name(elm) === 'ol';\n      });\n    };\n    var getFullySelectedListWrappers = function (parents, rng) {\n      return find(parents, function (elm) {\n        return name(elm) === 'li' && hasAllContentsSelected(elm, rng);\n      }).fold(constant([]), function (_li) {\n        return findParentListContainer(parents).map(function (listCont) {\n          var listElm = SugarElement.fromTag(name(listCont));\n          var listStyles = filter$1(getAllRaw(listCont), function (_style, name) {\n            return startsWith(name, 'list-style');\n          });\n          setAll$1(listElm, listStyles);\n          return [\n            SugarElement.fromTag('li'),\n            listElm\n          ];\n        }).getOr([]);\n      });\n    };\n    var wrap$3 = function (innerElm, elms) {\n      var wrapped = foldl(elms, function (acc, elm) {\n        append(elm, acc);\n        return elm;\n      }, innerElm);\n      return elms.length > 0 ? fromElements([wrapped]) : wrapped;\n    };\n    var directListWrappers = function (commonAnchorContainer) {\n      if (isListItem(commonAnchorContainer)) {\n        return parent(commonAnchorContainer).filter(isList).fold(constant([]), function (listElm) {\n          return [\n            commonAnchorContainer,\n            listElm\n          ];\n        });\n      } else {\n        return isList(commonAnchorContainer) ? [commonAnchorContainer] : [];\n      }\n    };\n    var getWrapElements = function (rootNode, rng) {\n      var commonAnchorContainer = SugarElement.fromDom(rng.commonAncestorContainer);\n      var parents = parentsAndSelf(commonAnchorContainer, rootNode);\n      var wrapElements = filter(parents, function (elm) {\n        return isInline(elm) || isHeading(elm);\n      });\n      var listWrappers = getFullySelectedListWrappers(parents, rng);\n      var allWrappers = wrapElements.concat(listWrappers.length ? listWrappers : directListWrappers(commonAnchorContainer));\n      return map(allWrappers, shallow);\n    };\n    var emptyFragment = function () {\n      return fromElements([]);\n    };\n    var getFragmentFromRange = function (rootNode, rng) {\n      return wrap$3(SugarElement.fromDom(rng.cloneContents()), getWrapElements(rootNode, rng));\n    };\n    var getParentTable = function (rootElm, cell) {\n      return ancestor$1(cell, 'table', curry(eq$2, rootElm));\n    };\n    var getTableFragment = function (rootNode, selectedTableCells) {\n      return getParentTable(rootNode, selectedTableCells[0]).bind(function (tableElm) {\n        var firstCell = selectedTableCells[0];\n        var lastCell = selectedTableCells[selectedTableCells.length - 1];\n        var fullTableModel = fromDom$1(tableElm);\n        return subsection(fullTableModel, firstCell, lastCell).map(function (sectionedTableModel) {\n          return fromElements([toDom(sectionedTableModel)]);\n        });\n      }).getOrThunk(emptyFragment);\n    };\n    var getSelectionFragment = function (rootNode, ranges) {\n      return ranges.length > 0 && ranges[0].collapsed ? emptyFragment() : getFragmentFromRange(rootNode, ranges[0]);\n    };\n    var read$1 = function (rootNode, ranges) {\n      var selectedCells = getCellsFromElementOrRanges(ranges, rootNode);\n      return selectedCells.length > 0 ? getTableFragment(rootNode, selectedCells) : getSelectionFragment(rootNode, ranges);\n    };\n\n    var trimLeadingCollapsibleText = function (text) {\n      return text.replace(/^[ \\f\\n\\r\\t\\v]+/, '');\n    };\n    var isCollapsibleWhitespace = function (text, index) {\n      return index >= 0 && index < text.length && isWhiteSpace$1(text.charAt(index));\n    };\n    var getInnerText = function (bin) {\n      var text = trim$2(bin.innerText);\n      return Env.browser.isIE() ? trimLeadingCollapsibleText(text) : text;\n    };\n    var getTextContent = function (editor) {\n      return Optional.from(editor.selection.getRng()).map(function (rng) {\n        var bin = editor.dom.add(editor.getBody(), 'div', {\n          'data-mce-bogus': 'all',\n          'style': 'overflow: hidden; opacity: 0;'\n        }, rng.cloneContents());\n        var text = getInnerText(bin);\n        var nonRenderedText = trim$2(bin.textContent);\n        editor.dom.remove(bin);\n        if (isCollapsibleWhitespace(nonRenderedText, 0) || isCollapsibleWhitespace(nonRenderedText, nonRenderedText.length - 1)) {\n          var parentBlock = editor.dom.getParent(rng.commonAncestorContainer, editor.dom.isBlock);\n          var parentBlockText = getInnerText(parentBlock);\n          var textIndex = parentBlockText.indexOf(text);\n          if (textIndex !== -1) {\n            var hasProceedingSpace = isCollapsibleWhitespace(parentBlockText, textIndex - 1);\n            var hasTrailingSpace = isCollapsibleWhitespace(parentBlockText, textIndex + text.length);\n            return (hasProceedingSpace ? ' ' : '') + text + (hasTrailingSpace ? ' ' : '');\n          } else {\n            return text;\n          }\n        } else {\n          return text;\n        }\n      }).getOr('');\n    };\n    var getSerializedContent = function (editor, args) {\n      var rng = editor.selection.getRng(), tmpElm = editor.dom.create('body');\n      var sel = editor.selection.getSel();\n      var ranges = processRanges(editor, getRanges(sel));\n      var fragment = args.contextual ? read$1(SugarElement.fromDom(editor.getBody()), ranges).dom : rng.cloneContents();\n      if (fragment) {\n        tmpElm.appendChild(fragment);\n      }\n      return editor.selection.serializer.serialize(tmpElm, args);\n    };\n    var getSelectedContentInternal = function (editor, format, args) {\n      if (args === void 0) {\n        args = {};\n      }\n      args.get = true;\n      args.format = format;\n      args.selection = true;\n      args = editor.fire('BeforeGetContent', args);\n      if (args.isDefaultPrevented()) {\n        editor.fire('GetContent', args);\n        return args.content;\n      }\n      if (args.format === 'text') {\n        return getTextContent(editor);\n      } else {\n        args.getInner = true;\n        var content = getSerializedContent(editor, args);\n        if (args.format === 'tree') {\n          return content;\n        } else {\n          args.content = editor.selection.isCollapsed() ? '' : content;\n          editor.fire('GetContent', args);\n          return args.content;\n        }\n      }\n    };\n\n    var KEEP = 0, INSERT = 1, DELETE = 2;\n    var diff = function (left, right) {\n      var size = left.length + right.length + 2;\n      var vDown = new Array(size);\n      var vUp = new Array(size);\n      var snake = function (start, end, diag) {\n        return {\n          start: start,\n          end: end,\n          diag: diag\n        };\n      };\n      var buildScript = function (start1, end1, start2, end2, script) {\n        var middle = getMiddleSnake(start1, end1, start2, end2);\n        if (middle === null || middle.start === end1 && middle.diag === end1 - end2 || middle.end === start1 && middle.diag === start1 - start2) {\n          var i = start1;\n          var j = start2;\n          while (i < end1 || j < end2) {\n            if (i < end1 && j < end2 && left[i] === right[j]) {\n              script.push([\n                KEEP,\n                left[i]\n              ]);\n              ++i;\n              ++j;\n            } else {\n              if (end1 - start1 > end2 - start2) {\n                script.push([\n                  DELETE,\n                  left[i]\n                ]);\n                ++i;\n              } else {\n                script.push([\n                  INSERT,\n                  right[j]\n                ]);\n                ++j;\n              }\n            }\n          }\n        } else {\n          buildScript(start1, middle.start, start2, middle.start - middle.diag, script);\n          for (var i2 = middle.start; i2 < middle.end; ++i2) {\n            script.push([\n              KEEP,\n              left[i2]\n            ]);\n          }\n          buildScript(middle.end, end1, middle.end - middle.diag, end2, script);\n        }\n      };\n      var buildSnake = function (start, diag, end1, end2) {\n        var end = start;\n        while (end - diag < end2 && end < end1 && left[end] === right[end - diag]) {\n          ++end;\n        }\n        return snake(start, end, diag);\n      };\n      var getMiddleSnake = function (start1, end1, start2, end2) {\n        var m = end1 - start1;\n        var n = end2 - start2;\n        if (m === 0 || n === 0) {\n          return null;\n        }\n        var delta = m - n;\n        var sum = n + m;\n        var offset = (sum % 2 === 0 ? sum : sum + 1) / 2;\n        vDown[1 + offset] = start1;\n        vUp[1 + offset] = end1 + 1;\n        var d, k, i, x, y;\n        for (d = 0; d <= offset; ++d) {\n          for (k = -d; k <= d; k += 2) {\n            i = k + offset;\n            if (k === -d || k !== d && vDown[i - 1] < vDown[i + 1]) {\n              vDown[i] = vDown[i + 1];\n            } else {\n              vDown[i] = vDown[i - 1] + 1;\n            }\n            x = vDown[i];\n            y = x - start1 + start2 - k;\n            while (x < end1 && y < end2 && left[x] === right[y]) {\n              vDown[i] = ++x;\n              ++y;\n            }\n            if (delta % 2 !== 0 && delta - d <= k && k <= delta + d) {\n              if (vUp[i - delta] <= vDown[i]) {\n                return buildSnake(vUp[i - delta], k + start1 - start2, end1, end2);\n              }\n            }\n          }\n          for (k = delta - d; k <= delta + d; k += 2) {\n            i = k + offset - delta;\n            if (k === delta - d || k !== delta + d && vUp[i + 1] <= vUp[i - 1]) {\n              vUp[i] = vUp[i + 1] - 1;\n            } else {\n              vUp[i] = vUp[i - 1];\n            }\n            x = vUp[i] - 1;\n            y = x - start1 + start2 - k;\n            while (x >= start1 && y >= start2 && left[x] === right[y]) {\n              vUp[i] = x--;\n              y--;\n            }\n            if (delta % 2 === 0 && -d <= k && k <= d) {\n              if (vUp[i] <= vDown[i + delta]) {\n                return buildSnake(vUp[i], k + start1 - start2, end1, end2);\n              }\n            }\n          }\n        }\n      };\n      var script = [];\n      buildScript(0, left.length, 0, right.length, script);\n      return script;\n    };\n\n    var getOuterHtml = function (elm) {\n      if (isElement$1(elm)) {\n        return elm.outerHTML;\n      } else if (isText$1(elm)) {\n        return Entities.encodeRaw(elm.data, false);\n      } else if (isComment$1(elm)) {\n        return '<!--' + elm.data + '-->';\n      }\n      return '';\n    };\n    var createFragment$1 = function (html) {\n      var node;\n      var container = document.createElement('div');\n      var frag = document.createDocumentFragment();\n      if (html) {\n        container.innerHTML = html;\n      }\n      while (node = container.firstChild) {\n        frag.appendChild(node);\n      }\n      return frag;\n    };\n    var insertAt = function (elm, html, index) {\n      var fragment = createFragment$1(html);\n      if (elm.hasChildNodes() && index < elm.childNodes.length) {\n        var target = elm.childNodes[index];\n        target.parentNode.insertBefore(fragment, target);\n      } else {\n        elm.appendChild(fragment);\n      }\n    };\n    var removeAt = function (elm, index) {\n      if (elm.hasChildNodes() && index < elm.childNodes.length) {\n        var target = elm.childNodes[index];\n        target.parentNode.removeChild(target);\n      }\n    };\n    var applyDiff = function (diff, elm) {\n      var index = 0;\n      each(diff, function (action) {\n        if (action[0] === KEEP) {\n          index++;\n        } else if (action[0] === INSERT) {\n          insertAt(elm, action[1], index);\n          index++;\n        } else if (action[0] === DELETE) {\n          removeAt(elm, index);\n        }\n      });\n    };\n    var read$2 = function (elm) {\n      return filter(map(from$1(elm.childNodes), getOuterHtml), function (item) {\n        return item.length > 0;\n      });\n    };\n    var write = function (fragments, elm) {\n      var currentFragments = map(from$1(elm.childNodes), getOuterHtml);\n      applyDiff(diff(currentFragments, fragments), elm);\n      return elm;\n    };\n\n    var undoLevelDocument = Cell(Optional.none());\n    var lazyTempDocument = function () {\n      return undoLevelDocument.get().getOrThunk(function () {\n        var doc = document.implementation.createHTMLDocument('undo');\n        undoLevelDocument.set(Optional.some(doc));\n        return doc;\n      });\n    };\n    var hasIframes = function (html) {\n      return html.indexOf('</iframe>') !== -1;\n    };\n    var createFragmentedLevel = function (fragments) {\n      return {\n        type: 'fragmented',\n        fragments: fragments,\n        content: '',\n        bookmark: null,\n        beforeBookmark: null\n      };\n    };\n    var createCompleteLevel = function (content) {\n      return {\n        type: 'complete',\n        fragments: null,\n        content: content,\n        bookmark: null,\n        beforeBookmark: null\n      };\n    };\n    var createFromEditor = function (editor) {\n      var fragments = read$2(editor.getBody());\n      var trimmedFragments = bind(fragments, function (html) {\n        var trimmed = trimInternal(editor.serializer, html);\n        return trimmed.length > 0 ? [trimmed] : [];\n      });\n      var content = trimmedFragments.join('');\n      return hasIframes(content) ? createFragmentedLevel(trimmedFragments) : createCompleteLevel(content);\n    };\n    var applyToEditor = function (editor, level, before) {\n      if (level.type === 'fragmented') {\n        write(level.fragments, editor.getBody());\n      } else {\n        editor.setContent(level.content, { format: 'raw' });\n      }\n      editor.selection.moveToBookmark(before ? level.beforeBookmark : level.bookmark);\n    };\n    var getLevelContent = function (level) {\n      return level.type === 'fragmented' ? level.fragments.join('') : level.content;\n    };\n    var getCleanLevelContent = function (level) {\n      var elm = SugarElement.fromTag('body', lazyTempDocument());\n      set$1(elm, getLevelContent(level));\n      each(descendants$1(elm, '*[data-mce-bogus]'), unwrap);\n      return get$6(elm);\n    };\n    var hasEqualContent = function (level1, level2) {\n      return getLevelContent(level1) === getLevelContent(level2);\n    };\n    var hasEqualCleanedContent = function (level1, level2) {\n      return getCleanLevelContent(level1) === getCleanLevelContent(level2);\n    };\n    var isEq$4 = function (level1, level2) {\n      if (!level1 || !level2) {\n        return false;\n      } else if (hasEqualContent(level1, level2)) {\n        return true;\n      } else {\n        return hasEqualCleanedContent(level1, level2);\n      }\n    };\n\n    var isUnlocked = function (locks) {\n      return locks.get() === 0;\n    };\n\n    var setTyping = function (undoManager, typing, locks) {\n      if (isUnlocked(locks)) {\n        undoManager.typing = typing;\n      }\n    };\n    var endTyping = function (undoManager, locks) {\n      if (undoManager.typing) {\n        setTyping(undoManager, false, locks);\n        undoManager.add();\n      }\n    };\n    var endTypingLevelIgnoreLocks = function (undoManager) {\n      if (undoManager.typing) {\n        undoManager.typing = false;\n        undoManager.add();\n      }\n    };\n\n    var beforeChange = function (editor, locks, beforeBookmark) {\n      if (isUnlocked(locks)) {\n        beforeBookmark.set(Optional.some(getUndoBookmark(editor.selection)));\n      }\n    };\n    var addUndoLevel = function (editor, undoManager, index, locks, beforeBookmark, level, event) {\n      var currentLevel = createFromEditor(editor);\n      level = level || {};\n      level = Tools.extend(level, currentLevel);\n      if (isUnlocked(locks) === false || editor.removed) {\n        return null;\n      }\n      var lastLevel = undoManager.data[index.get()];\n      if (editor.fire('BeforeAddUndo', {\n          level: level,\n          lastLevel: lastLevel,\n          originalEvent: event\n        }).isDefaultPrevented()) {\n        return null;\n      }\n      if (lastLevel && isEq$4(lastLevel, level)) {\n        return null;\n      }\n      if (undoManager.data[index.get()]) {\n        beforeBookmark.get().each(function (bm) {\n          undoManager.data[index.get()].beforeBookmark = bm;\n        });\n      }\n      var customUndoRedoLevels = getCustomUndoRedoLevels(editor);\n      if (customUndoRedoLevels) {\n        if (undoManager.data.length > customUndoRedoLevels) {\n          for (var i = 0; i < undoManager.data.length - 1; i++) {\n            undoManager.data[i] = undoManager.data[i + 1];\n          }\n          undoManager.data.length--;\n          index.set(undoManager.data.length);\n        }\n      }\n      level.bookmark = getUndoBookmark(editor.selection);\n      if (index.get() < undoManager.data.length - 1) {\n        undoManager.data.length = index.get() + 1;\n      }\n      undoManager.data.push(level);\n      index.set(undoManager.data.length - 1);\n      var args = {\n        level: level,\n        lastLevel: lastLevel,\n        originalEvent: event\n      };\n      if (index.get() > 0) {\n        editor.setDirty(true);\n        editor.fire('AddUndo', args);\n        editor.fire('change', args);\n      } else {\n        editor.fire('AddUndo', args);\n      }\n      return level;\n    };\n    var clear = function (editor, undoManager, index) {\n      undoManager.data = [];\n      index.set(0);\n      undoManager.typing = false;\n      editor.fire('ClearUndos');\n    };\n    var extra = function (editor, undoManager, index, callback1, callback2) {\n      if (undoManager.transact(callback1)) {\n        var bookmark = undoManager.data[index.get()].bookmark;\n        var lastLevel = undoManager.data[index.get() - 1];\n        applyToEditor(editor, lastLevel, true);\n        if (undoManager.transact(callback2)) {\n          undoManager.data[index.get() - 1].beforeBookmark = bookmark;\n        }\n      }\n    };\n    var redo = function (editor, index, data) {\n      var level;\n      if (index.get() < data.length - 1) {\n        index.set(index.get() + 1);\n        level = data[index.get()];\n        applyToEditor(editor, level, false);\n        editor.setDirty(true);\n        editor.fire('Redo', { level: level });\n      }\n      return level;\n    };\n    var undo = function (editor, undoManager, locks, index) {\n      var level;\n      if (undoManager.typing) {\n        undoManager.add();\n        undoManager.typing = false;\n        setTyping(undoManager, false, locks);\n      }\n      if (index.get() > 0) {\n        index.set(index.get() - 1);\n        level = undoManager.data[index.get()];\n        applyToEditor(editor, level, true);\n        editor.setDirty(true);\n        editor.fire('Undo', { level: level });\n      }\n      return level;\n    };\n    var reset = function (undoManager) {\n      undoManager.clear();\n      undoManager.add();\n    };\n    var hasUndo = function (editor, undoManager, index) {\n      return index.get() > 0 || undoManager.typing && undoManager.data[0] && !isEq$4(createFromEditor(editor), undoManager.data[0]);\n    };\n    var hasRedo = function (undoManager, index) {\n      return index.get() < undoManager.data.length - 1 && !undoManager.typing;\n    };\n    var transact = function (undoManager, locks, callback) {\n      endTyping(undoManager, locks);\n      undoManager.beforeChange();\n      undoManager.ignore(callback);\n      return undoManager.add();\n    };\n    var ignore = function (locks, callback) {\n      try {\n        locks.set(locks.get() + 1);\n        callback();\n      } finally {\n        locks.set(locks.get() - 1);\n      }\n    };\n\n    var isTreeNode$1 = function (content) {\n      return content instanceof AstNode;\n    };\n    var runSerializerFiltersOnFragment = function (editor, fragment) {\n      filter$3(editor.serializer.getNodeFilters(), editor.serializer.getAttributeFilters(), fragment);\n    };\n    var getInsertContext = function (editor) {\n      return Optional.from(editor.selection.getStart(true)).map(function (elm) {\n        return elm.nodeName.toLowerCase();\n      });\n    };\n    var createDummyUndoLevel = function () {\n      return {\n        type: 'complete',\n        fragments: [],\n        content: '',\n        bookmark: null,\n        beforeBookmark: null\n      };\n    };\n    var makePlainAdaptor = function (editor) {\n      return {\n        undoManager: {\n          beforeChange: function (locks, beforeBookmark) {\n            return beforeChange(editor, locks, beforeBookmark);\n          },\n          addUndoLevel: function (undoManager, index, locks, beforeBookmark, level, event) {\n            return addUndoLevel(editor, undoManager, index, locks, beforeBookmark, level, event);\n          },\n          undo: function (undoManager, locks, index) {\n            return undo(editor, undoManager, locks, index);\n          },\n          redo: function (index, data) {\n            return redo(editor, index, data);\n          },\n          clear: function (undoManager, index) {\n            return clear(editor, undoManager, index);\n          },\n          reset: function (undoManager) {\n            return reset(undoManager);\n          },\n          hasUndo: function (undoManager, index) {\n            return hasUndo(editor, undoManager, index);\n          },\n          hasRedo: function (undoManager, index) {\n            return hasRedo(undoManager, index);\n          },\n          transact: function (undoManager, locks, callback) {\n            return transact(undoManager, locks, callback);\n          },\n          ignore: function (locks, callback) {\n            return ignore(locks, callback);\n          },\n          extra: function (undoManager, index, callback1, callback2) {\n            return extra(editor, undoManager, index, callback1, callback2);\n          }\n        },\n        formatter: {\n          apply: function (name, vars, node) {\n            return applyFormat(editor, name, vars, node);\n          },\n          remove: function (name, vars, node, similar) {\n            return remove$6(editor, name, vars, node, similar);\n          },\n          toggle: function (name, vars, node) {\n            return toggle(editor, name, vars, node);\n          }\n        },\n        editor: {\n          getContent: function (args, format) {\n            return getContentInternal(editor, args, format);\n          },\n          setContent: function (content, args) {\n            return setContentInternal(editor, content, args);\n          },\n          insertContent: function (value, details) {\n            return insertHtmlAtCaret(editor, value, details);\n          }\n        },\n        selection: {\n          getContent: function (format, args) {\n            return getSelectedContentInternal(editor, format, args);\n          }\n        },\n        raw: {\n          getModel: function () {\n            return Optional.none();\n          }\n        }\n      };\n    };\n    var makeRtcAdaptor = function (tinymceEditor, rtcEditor) {\n      var defaultVars = function (vars) {\n        return isObject(vars) ? vars : {};\n      };\n      var unsupported = die('Unimplemented feature for rtc');\n      var ignore = noop;\n      return {\n        undoManager: {\n          beforeChange: ignore,\n          addUndoLevel: unsupported,\n          undo: function () {\n            rtcEditor.undo();\n            return createDummyUndoLevel();\n          },\n          redo: function () {\n            rtcEditor.redo();\n            return createDummyUndoLevel();\n          },\n          clear: unsupported,\n          reset: unsupported,\n          hasUndo: function () {\n            return rtcEditor.hasUndo();\n          },\n          hasRedo: function () {\n            return rtcEditor.hasRedo();\n          },\n          transact: function (_undoManager, _locks, fn) {\n            rtcEditor.transact(fn);\n            return createDummyUndoLevel();\n          },\n          ignore: unsupported,\n          extra: unsupported\n        },\n        formatter: {\n          apply: function (name, vars, _node) {\n            return rtcEditor.applyFormat(name, defaultVars(vars));\n          },\n          remove: function (name, vars, _node, _similar) {\n            return rtcEditor.removeFormat(name, defaultVars(vars));\n          },\n          toggle: function (name, vars, _node) {\n            return rtcEditor.toggleFormat(name, defaultVars(vars));\n          }\n        },\n        editor: {\n          getContent: function (args, format) {\n            if (format === 'html' || format === 'tree') {\n              var fragment = rtcEditor.getContent();\n              var serializer = HtmlSerializer({ inner: true });\n              runSerializerFiltersOnFragment(tinymceEditor, fragment);\n              return format === 'tree' ? fragment : serializer.serialize(fragment);\n            } else {\n              return makePlainAdaptor(tinymceEditor).editor.getContent(args, format);\n            }\n          },\n          setContent: function (content, _args) {\n            var fragment = isTreeNode$1(content) ? content : tinymceEditor.parser.parse(content, {\n              isRootContent: true,\n              insert: true\n            });\n            rtcEditor.setContent(fragment);\n            return content;\n          },\n          insertContent: function (value, _details) {\n            var contextArgs = getInsertContext(tinymceEditor).fold(function () {\n              return {};\n            }, function (context) {\n              return { context: context };\n            });\n            var fragment = isTreeNode$1(value) ? value : tinymceEditor.parser.parse(value, __assign(__assign({}, contextArgs), { insert: true }));\n            rtcEditor.insertContent(fragment);\n          }\n        },\n        selection: {\n          getContent: function (format, args) {\n            if (format === 'html' || format === 'tree') {\n              var fragment = rtcEditor.getSelectedContent();\n              var serializer = HtmlSerializer({});\n              runSerializerFiltersOnFragment(tinymceEditor, fragment);\n              return format === 'tree' ? fragment : serializer.serialize(fragment);\n            } else {\n              return makePlainAdaptor(tinymceEditor).selection.getContent(format, args);\n            }\n          }\n        },\n        raw: {\n          getModel: function () {\n            return Optional.some(rtcEditor.getRawModel());\n          }\n        }\n      };\n    };\n    var isRtc = function (editor) {\n      return has(editor.plugins, 'rtc');\n    };\n    var setup$4 = function (editor) {\n      var editorCast = editor;\n      return get(editor.plugins, 'rtc').fold(function () {\n        editorCast.rtcInstance = makePlainAdaptor(editor);\n        return Optional.none();\n      }, function (rtc) {\n        return Optional.some(rtc.setup().then(function (rtcEditor) {\n          editorCast.rtcInstance = makeRtcAdaptor(editor, rtcEditor);\n          return rtcEditor.isRemote;\n        }));\n      });\n    };\n    var getRtcInstanceWithFallback = function (editor) {\n      return editor.rtcInstance ? editor.rtcInstance : makePlainAdaptor(editor);\n    };\n    var getRtcInstanceWithError = function (editor) {\n      var rtcInstance = editor.rtcInstance;\n      if (!rtcInstance) {\n        throw new Error('Failed to get RTC instance not yet initialized.');\n      } else {\n        return rtcInstance;\n      }\n    };\n    var beforeChange$1 = function (editor, locks, beforeBookmark) {\n      getRtcInstanceWithError(editor).undoManager.beforeChange(locks, beforeBookmark);\n    };\n    var addUndoLevel$1 = function (editor, undoManager, index, locks, beforeBookmark, level, event) {\n      return getRtcInstanceWithError(editor).undoManager.addUndoLevel(undoManager, index, locks, beforeBookmark, level, event);\n    };\n    var undo$1 = function (editor, undoManager, locks, index) {\n      return getRtcInstanceWithError(editor).undoManager.undo(undoManager, locks, index);\n    };\n    var redo$1 = function (editor, index, data) {\n      return getRtcInstanceWithError(editor).undoManager.redo(index, data);\n    };\n    var clear$1 = function (editor, undoManager, index) {\n      getRtcInstanceWithError(editor).undoManager.clear(undoManager, index);\n    };\n    var reset$1 = function (editor, undoManager) {\n      getRtcInstanceWithError(editor).undoManager.reset(undoManager);\n    };\n    var hasUndo$1 = function (editor, undoManager, index) {\n      return getRtcInstanceWithError(editor).undoManager.hasUndo(undoManager, index);\n    };\n    var hasRedo$1 = function (editor, undoManager, index) {\n      return getRtcInstanceWithError(editor).undoManager.hasRedo(undoManager, index);\n    };\n    var transact$1 = function (editor, undoManager, locks, callback) {\n      return getRtcInstanceWithError(editor).undoManager.transact(undoManager, locks, callback);\n    };\n    var ignore$1 = function (editor, locks, callback) {\n      getRtcInstanceWithError(editor).undoManager.ignore(locks, callback);\n    };\n    var extra$1 = function (editor, undoManager, index, callback1, callback2) {\n      getRtcInstanceWithError(editor).undoManager.extra(undoManager, index, callback1, callback2);\n    };\n    var applyFormat$1 = function (editor, name, vars, node) {\n      getRtcInstanceWithError(editor).formatter.apply(name, vars, node);\n    };\n    var removeFormat$1 = function (editor, name, vars, node, similar) {\n      getRtcInstanceWithError(editor).formatter.remove(name, vars, node, similar);\n    };\n    var toggleFormat = function (editor, name, vars, node) {\n      getRtcInstanceWithError(editor).formatter.toggle(name, vars, node);\n    };\n    var getContent = function (editor, args, format) {\n      return getRtcInstanceWithFallback(editor).editor.getContent(args, format);\n    };\n    var setContent = function (editor, content, args) {\n      return getRtcInstanceWithFallback(editor).editor.setContent(content, args);\n    };\n    var insertContent = function (editor, value, details) {\n      return getRtcInstanceWithFallback(editor).editor.insertContent(value, details);\n    };\n    var getSelectedContent = function (editor, format, args) {\n      return getRtcInstanceWithError(editor).selection.getContent(format, args);\n    };\n\n    var getContent$1 = function (editor, args) {\n      if (args === void 0) {\n        args = {};\n      }\n      var format = args.format ? args.format : 'html';\n      return getSelectedContent(editor, format, args);\n    };\n\n    var removeEmpty = function (text) {\n      if (text.dom.length === 0) {\n        remove(text);\n        return Optional.none();\n      } else {\n        return Optional.some(text);\n      }\n    };\n    var walkPastBookmark = function (node, start) {\n      return node.filter(function (elm) {\n        return BookmarkManager$1.isBookmarkNode(elm.dom);\n      }).bind(start ? nextSibling : prevSibling);\n    };\n    var merge = function (outer, inner, rng, start) {\n      var outerElm = outer.dom;\n      var innerElm = inner.dom;\n      var oldLength = start ? outerElm.length : innerElm.length;\n      if (start) {\n        mergeTextNodes(outerElm, innerElm, false, !start);\n        rng.setStart(innerElm, oldLength);\n      } else {\n        mergeTextNodes(innerElm, outerElm, false, !start);\n        rng.setEnd(innerElm, oldLength);\n      }\n    };\n    var normalizeTextIfRequired = function (inner, start) {\n      parent(inner).each(function (root) {\n        var text = inner.dom;\n        if (start && needsToBeNbspLeft(root, CaretPosition$1(text, 0))) {\n          normalizeWhitespaceAfter(text, 0);\n        } else if (!start && needsToBeNbspRight(root, CaretPosition$1(text, text.length))) {\n          normalizeWhitespaceBefore(text, text.length);\n        }\n      });\n    };\n    var mergeAndNormalizeText = function (outerNode, innerNode, rng, start) {\n      outerNode.bind(function (outer) {\n        var normalizer = start ? normalizeWhitespaceBefore : normalizeWhitespaceAfter;\n        normalizer(outer.dom, start ? outer.dom.length : 0);\n        return innerNode.filter(isText).map(function (inner) {\n          return merge(outer, inner, rng, start);\n        });\n      }).orThunk(function () {\n        var innerTextNode = walkPastBookmark(innerNode, start).or(innerNode).filter(isText);\n        return innerTextNode.map(function (inner) {\n          return normalizeTextIfRequired(inner, start);\n        });\n      });\n    };\n    var rngSetContent = function (rng, fragment) {\n      var firstChild = Optional.from(fragment.firstChild).map(SugarElement.fromDom);\n      var lastChild = Optional.from(fragment.lastChild).map(SugarElement.fromDom);\n      rng.deleteContents();\n      rng.insertNode(fragment);\n      var prevText = firstChild.bind(prevSibling).filter(isText).bind(removeEmpty);\n      var nextText = lastChild.bind(nextSibling).filter(isText).bind(removeEmpty);\n      mergeAndNormalizeText(prevText, firstChild, rng, true);\n      mergeAndNormalizeText(nextText, lastChild, rng, false);\n      rng.collapse(false);\n    };\n    var setupArgs = function (args, content) {\n      return __assign(__assign({ format: 'html' }, args), {\n        set: true,\n        selection: true,\n        content: content\n      });\n    };\n    var cleanContent = function (editor, args) {\n      if (args.format !== 'raw') {\n        var rng = editor.selection.getRng();\n        var contextBlock = editor.dom.getParent(rng.commonAncestorContainer, editor.dom.isBlock);\n        var contextArgs = contextBlock ? { context: contextBlock.nodeName.toLowerCase() } : {};\n        var node = editor.parser.parse(args.content, __assign(__assign({\n          isRootContent: true,\n          forced_root_block: false\n        }, contextArgs), args));\n        return HtmlSerializer({ validate: editor.validate }, editor.schema).serialize(node);\n      } else {\n        return args.content;\n      }\n    };\n    var setContent$1 = function (editor, content, args) {\n      if (args === void 0) {\n        args = {};\n      }\n      var contentArgs = setupArgs(args, content);\n      if (!contentArgs.no_events) {\n        contentArgs = editor.fire('BeforeSetContent', contentArgs);\n        if (contentArgs.isDefaultPrevented()) {\n          editor.fire('SetContent', contentArgs);\n          return;\n        }\n      }\n      args.content = cleanContent(editor, contentArgs);\n      var rng = editor.selection.getRng();\n      rngSetContent(rng, rng.createContextualFragment(args.content));\n      editor.selection.setRng(rng);\n      scrollRangeIntoView(editor, rng);\n      if (!contentArgs.no_events) {\n        editor.fire('SetContent', contentArgs);\n      }\n    };\n\n    var deleteFromCallbackMap = function (callbackMap, selector, callback) {\n      if (callbackMap && callbackMap.hasOwnProperty(selector)) {\n        var newCallbacks = filter(callbackMap[selector], function (cb) {\n          return cb !== callback;\n        });\n        if (newCallbacks.length === 0) {\n          delete callbackMap[selector];\n        } else {\n          callbackMap[selector] = newCallbacks;\n        }\n      }\n    };\n    function SelectorChanged (dom, editor) {\n      var selectorChangedData;\n      var currentSelectors;\n      return {\n        selectorChangedWithUnbind: function (selector, callback) {\n          if (!selectorChangedData) {\n            selectorChangedData = {};\n            currentSelectors = {};\n            editor.on('NodeChange', function (e) {\n              var node = e.element, parents = dom.getParents(node, null, dom.getRoot()), matchedSelectors = {};\n              Tools.each(selectorChangedData, function (callbacks, selector) {\n                Tools.each(parents, function (node) {\n                  if (dom.is(node, selector)) {\n                    if (!currentSelectors[selector]) {\n                      Tools.each(callbacks, function (callback) {\n                        callback(true, {\n                          node: node,\n                          selector: selector,\n                          parents: parents\n                        });\n                      });\n                      currentSelectors[selector] = callbacks;\n                    }\n                    matchedSelectors[selector] = callbacks;\n                    return false;\n                  }\n                });\n              });\n              Tools.each(currentSelectors, function (callbacks, selector) {\n                if (!matchedSelectors[selector]) {\n                  delete currentSelectors[selector];\n                  Tools.each(callbacks, function (callback) {\n                    callback(false, {\n                      node: node,\n                      selector: selector,\n                      parents: parents\n                    });\n                  });\n                }\n              });\n            });\n          }\n          if (!selectorChangedData[selector]) {\n            selectorChangedData[selector] = [];\n          }\n          selectorChangedData[selector].push(callback);\n          return {\n            unbind: function () {\n              deleteFromCallbackMap(selectorChangedData, selector, callback);\n              deleteFromCallbackMap(currentSelectors, selector, callback);\n            }\n          };\n        }\n      };\n    }\n\n    var isNativeIeSelection = function (rng) {\n      return !!rng.select;\n    };\n    var isAttachedToDom = function (node) {\n      return !!(node && node.ownerDocument) && contains$2(SugarElement.fromDom(node.ownerDocument), SugarElement.fromDom(node));\n    };\n    var isValidRange = function (rng) {\n      if (!rng) {\n        return false;\n      } else if (isNativeIeSelection(rng)) {\n        return true;\n      } else {\n        return isAttachedToDom(rng.startContainer) && isAttachedToDom(rng.endContainer);\n      }\n    };\n    var EditorSelection = function (dom, win, serializer, editor) {\n      var selectedRange;\n      var explicitRange;\n      var selectorChangedWithUnbind = SelectorChanged(dom, editor).selectorChangedWithUnbind;\n      var setCursorLocation = function (node, offset) {\n        var rng = dom.createRng();\n        if (!node) {\n          moveEndPoint$1(dom, rng, editor.getBody(), true);\n          setRng(rng);\n        } else {\n          rng.setStart(node, offset);\n          rng.setEnd(node, offset);\n          setRng(rng);\n          collapse(false);\n        }\n      };\n      var getContent = function (args) {\n        return getContent$1(editor, args);\n      };\n      var setContent = function (content, args) {\n        return setContent$1(editor, content, args);\n      };\n      var getStart = function (real) {\n        return getStart$2(editor.getBody(), getRng$1(), real);\n      };\n      var getEnd$1 = function (real) {\n        return getEnd(editor.getBody(), getRng$1(), real);\n      };\n      var getBookmark = function (type, normalized) {\n        return bookmarkManager.getBookmark(type, normalized);\n      };\n      var moveToBookmark = function (bookmark) {\n        return bookmarkManager.moveToBookmark(bookmark);\n      };\n      var select = function (node, content) {\n        select$1(dom, node, content).each(setRng);\n        return node;\n      };\n      var isCollapsed = function () {\n        var rng = getRng$1(), sel = getSel();\n        if (!rng || rng.item) {\n          return false;\n        }\n        if (rng.compareEndPoints) {\n          return rng.compareEndPoints('StartToEnd', rng) === 0;\n        }\n        return !sel || rng.collapsed;\n      };\n      var collapse = function (toStart) {\n        var rng = getRng$1();\n        rng.collapse(!!toStart);\n        setRng(rng);\n      };\n      var getSel = function () {\n        return win.getSelection ? win.getSelection() : win.document.selection;\n      };\n      var getRng$1 = function () {\n        var selection, rng, elm;\n        var tryCompareBoundaryPoints = function (how, sourceRange, destinationRange) {\n          try {\n            return sourceRange.compareBoundaryPoints(how, destinationRange);\n          } catch (ex) {\n            return -1;\n          }\n        };\n        if (!win) {\n          return null;\n        }\n        var doc = win.document;\n        if (typeof doc === 'undefined' || doc === null) {\n          return null;\n        }\n        if (editor.bookmark !== undefined && hasFocus$1(editor) === false) {\n          var bookmark = getRng(editor);\n          if (bookmark.isSome()) {\n            return bookmark.map(function (r) {\n              return processRanges(editor, [r])[0];\n            }).getOr(doc.createRange());\n          }\n        }\n        try {\n          if ((selection = getSel()) && !isRestrictedNode(selection.anchorNode)) {\n            if (selection.rangeCount > 0) {\n              rng = selection.getRangeAt(0);\n            } else {\n              rng = selection.createRange ? selection.createRange() : doc.createRange();\n            }\n            rng = processRanges(editor, [rng])[0];\n          }\n        } catch (ex) {\n        }\n        if (!rng) {\n          rng = doc.createRange ? doc.createRange() : doc.body.createTextRange();\n        }\n        if (rng.setStart && rng.startContainer.nodeType === 9 && rng.collapsed) {\n          elm = dom.getRoot();\n          rng.setStart(elm, 0);\n          rng.setEnd(elm, 0);\n        }\n        if (selectedRange && explicitRange) {\n          if (tryCompareBoundaryPoints(rng.START_TO_START, rng, selectedRange) === 0 && tryCompareBoundaryPoints(rng.END_TO_END, rng, selectedRange) === 0) {\n            rng = explicitRange;\n          } else {\n            selectedRange = null;\n            explicitRange = null;\n          }\n        }\n        return rng;\n      };\n      var setRng = function (rng, forward) {\n        var node;\n        if (!isValidRange(rng)) {\n          return;\n        }\n        var ieRange = isNativeIeSelection(rng) ? rng : null;\n        if (ieRange) {\n          explicitRange = null;\n          try {\n            ieRange.select();\n          } catch (ex) {\n          }\n          return;\n        }\n        var sel = getSel();\n        var evt = editor.fire('SetSelectionRange', {\n          range: rng,\n          forward: forward\n        });\n        rng = evt.range;\n        if (sel) {\n          explicitRange = rng;\n          try {\n            sel.removeAllRanges();\n            sel.addRange(rng);\n          } catch (ex) {\n          }\n          if (forward === false && sel.extend) {\n            sel.collapse(rng.endContainer, rng.endOffset);\n            sel.extend(rng.startContainer, rng.startOffset);\n          }\n          selectedRange = sel.rangeCount > 0 ? sel.getRangeAt(0) : null;\n        }\n        if (!rng.collapsed && rng.startContainer === rng.endContainer && sel.setBaseAndExtent && !Env.ie) {\n          if (rng.endOffset - rng.startOffset < 2) {\n            if (rng.startContainer.hasChildNodes()) {\n              node = rng.startContainer.childNodes[rng.startOffset];\n              if (node && node.tagName === 'IMG') {\n                sel.setBaseAndExtent(rng.startContainer, rng.startOffset, rng.endContainer, rng.endOffset);\n                if (sel.anchorNode !== rng.startContainer || sel.focusNode !== rng.endContainer) {\n                  sel.setBaseAndExtent(node, 0, node, 1);\n                }\n              }\n            }\n          }\n        }\n        editor.fire('AfterSetSelectionRange', {\n          range: rng,\n          forward: forward\n        });\n      };\n      var setNode = function (elm) {\n        setContent(dom.getOuterHTML(elm));\n        return elm;\n      };\n      var getNode = function () {\n        return getNode$1(editor.getBody(), getRng$1());\n      };\n      var getSelectedBlocks$1 = function (startElm, endElm) {\n        return getSelectedBlocks(dom, getRng$1(), startElm, endElm);\n      };\n      var isForward = function () {\n        var sel = getSel();\n        var anchorNode = sel === null || sel === void 0 ? void 0 : sel.anchorNode;\n        var focusNode = sel === null || sel === void 0 ? void 0 : sel.focusNode;\n        if (!sel || !anchorNode || !focusNode || isRestrictedNode(anchorNode) || isRestrictedNode(focusNode)) {\n          return true;\n        }\n        var anchorRange = dom.createRng();\n        anchorRange.setStart(anchorNode, sel.anchorOffset);\n        anchorRange.collapse(true);\n        var focusRange = dom.createRng();\n        focusRange.setStart(focusNode, sel.focusOffset);\n        focusRange.collapse(true);\n        return anchorRange.compareBoundaryPoints(anchorRange.START_TO_START, focusRange) <= 0;\n      };\n      var normalize$1 = function () {\n        var rng = getRng$1();\n        var sel = getSel();\n        if (!hasMultipleRanges(sel) && hasAnyRanges(editor)) {\n          var normRng = normalize(dom, rng);\n          normRng.each(function (normRng) {\n            setRng(normRng, isForward());\n          });\n          return normRng.getOr(rng);\n        }\n        return rng;\n      };\n      var selectorChanged = function (selector, callback) {\n        selectorChangedWithUnbind(selector, callback);\n        return exports;\n      };\n      var getScrollContainer = function () {\n        var scrollContainer;\n        var node = dom.getRoot();\n        while (node && node.nodeName !== 'BODY') {\n          if (node.scrollHeight > node.clientHeight) {\n            scrollContainer = node;\n            break;\n          }\n          node = node.parentNode;\n        }\n        return scrollContainer;\n      };\n      var scrollIntoView = function (elm, alignToTop) {\n        return scrollElementIntoView(editor, elm, alignToTop);\n      };\n      var placeCaretAt = function (clientX, clientY) {\n        return setRng(fromPoint$1(clientX, clientY, editor.getDoc()));\n      };\n      var getBoundingClientRect = function () {\n        var rng = getRng$1();\n        return rng.collapsed ? CaretPosition$1.fromRangeStart(rng).getClientRects()[0] : rng.getBoundingClientRect();\n      };\n      var destroy = function () {\n        win = selectedRange = explicitRange = null;\n        controlSelection.destroy();\n      };\n      var exports = {\n        bookmarkManager: null,\n        controlSelection: null,\n        dom: dom,\n        win: win,\n        serializer: serializer,\n        editor: editor,\n        collapse: collapse,\n        setCursorLocation: setCursorLocation,\n        getContent: getContent,\n        setContent: setContent,\n        getBookmark: getBookmark,\n        moveToBookmark: moveToBookmark,\n        select: select,\n        isCollapsed: isCollapsed,\n        isForward: isForward,\n        setNode: setNode,\n        getNode: getNode,\n        getSel: getSel,\n        setRng: setRng,\n        getRng: getRng$1,\n        getStart: getStart,\n        getEnd: getEnd$1,\n        getSelectedBlocks: getSelectedBlocks$1,\n        normalize: normalize$1,\n        selectorChanged: selectorChanged,\n        selectorChangedWithUnbind: selectorChangedWithUnbind,\n        getScrollContainer: getScrollContainer,\n        scrollIntoView: scrollIntoView,\n        placeCaretAt: placeCaretAt,\n        getBoundingClientRect: getBoundingClientRect,\n        destroy: destroy\n      };\n      var bookmarkManager = BookmarkManager$1(exports);\n      var controlSelection = ControlSelection(exports, editor);\n      exports.bookmarkManager = bookmarkManager;\n      exports.controlSelection = controlSelection;\n      return exports;\n    };\n\n    var removeAttrs = function (node, names) {\n      each(names, function (name) {\n        node.attr(name, null);\n      });\n    };\n    var addFontToSpansFilter = function (domParser, styles, fontSizes) {\n      domParser.addNodeFilter('font', function (nodes) {\n        each(nodes, function (node) {\n          var props = styles.parse(node.attr('style'));\n          var color = node.attr('color');\n          var face = node.attr('face');\n          var size = node.attr('size');\n          if (color) {\n            props.color = color;\n          }\n          if (face) {\n            props['font-family'] = face;\n          }\n          if (size) {\n            props['font-size'] = fontSizes[parseInt(node.attr('size'), 10) - 1];\n          }\n          node.name = 'span';\n          node.attr('style', styles.serialize(props));\n          removeAttrs(node, [\n            'color',\n            'face',\n            'size'\n          ]);\n        });\n      });\n    };\n    var addStrikeToSpanFilter = function (domParser, styles) {\n      domParser.addNodeFilter('strike', function (nodes) {\n        each(nodes, function (node) {\n          var props = styles.parse(node.attr('style'));\n          props['text-decoration'] = 'line-through';\n          node.name = 'span';\n          node.attr('style', styles.serialize(props));\n        });\n      });\n    };\n    var addFilters = function (domParser, settings) {\n      var styles = Styles();\n      if (settings.convert_fonts_to_spans) {\n        addFontToSpansFilter(domParser, styles, Tools.explode(settings.font_size_legacy_values));\n      }\n      addStrikeToSpanFilter(domParser, styles);\n    };\n    var register$1 = function (domParser, settings) {\n      if (settings.inline_styles) {\n        addFilters(domParser, settings);\n      }\n    };\n\n    var blobUriToBlob = function (url) {\n      return new promiseObj(function (resolve, reject) {\n        var rejectWithError = function () {\n          reject('Cannot convert ' + url + ' to Blob. Resource might not exist or is inaccessible.');\n        };\n        try {\n          var xhr = new XMLHttpRequest();\n          xhr.open('GET', url, true);\n          xhr.responseType = 'blob';\n          xhr.onload = function () {\n            if (this.status === 200) {\n              resolve(this.response);\n            } else {\n              rejectWithError();\n            }\n          };\n          xhr.onerror = rejectWithError;\n          xhr.send();\n        } catch (ex) {\n          rejectWithError();\n        }\n      });\n    };\n    var parseDataUri$1 = function (uri) {\n      var type;\n      var uriParts = decodeURIComponent(uri).split(',');\n      var matches = /data:([^;]+)/.exec(uriParts[0]);\n      if (matches) {\n        type = matches[1];\n      }\n      return {\n        type: type,\n        data: uriParts[1]\n      };\n    };\n    var buildBlob = function (type, data) {\n      var str;\n      try {\n        str = atob(data);\n      } catch (e) {\n        return Optional.none();\n      }\n      var arr = new Uint8Array(str.length);\n      for (var i = 0; i < arr.length; i++) {\n        arr[i] = str.charCodeAt(i);\n      }\n      return Optional.some(new Blob([arr], { type: type }));\n    };\n    var dataUriToBlob = function (uri) {\n      return new promiseObj(function (resolve) {\n        var _a = parseDataUri$1(uri), type = _a.type, data = _a.data;\n        buildBlob(type, data).fold(function () {\n          return resolve(new Blob([]));\n        }, resolve);\n      });\n    };\n    var uriToBlob = function (url) {\n      if (url.indexOf('blob:') === 0) {\n        return blobUriToBlob(url);\n      }\n      if (url.indexOf('data:') === 0) {\n        return dataUriToBlob(url);\n      }\n      return null;\n    };\n    var blobToDataUri = function (blob) {\n      return new promiseObj(function (resolve) {\n        var reader = new FileReader();\n        reader.onloadend = function () {\n          resolve(reader.result);\n        };\n        reader.readAsDataURL(blob);\n      });\n    };\n\n    var count = 0;\n    var uniqueId = function (prefix) {\n      return (prefix || 'blobid') + count++;\n    };\n    var imageToBlobInfo = function (blobCache, img, resolve, reject) {\n      var base64, blobInfo;\n      if (img.src.indexOf('blob:') === 0) {\n        blobInfo = blobCache.getByUri(img.src);\n        if (blobInfo) {\n          resolve({\n            image: img,\n            blobInfo: blobInfo\n          });\n        } else {\n          uriToBlob(img.src).then(function (blob) {\n            blobToDataUri(blob).then(function (dataUri) {\n              base64 = parseDataUri$1(dataUri).data;\n              blobInfo = blobCache.create(uniqueId(), blob, base64);\n              blobCache.add(blobInfo);\n              resolve({\n                image: img,\n                blobInfo: blobInfo\n              });\n            });\n          }, function (err) {\n            reject(err);\n          });\n        }\n        return;\n      }\n      var _a = parseDataUri$1(img.src), data = _a.data, type = _a.type;\n      base64 = data;\n      blobInfo = blobCache.getByData(base64, type);\n      if (blobInfo) {\n        resolve({\n          image: img,\n          blobInfo: blobInfo\n        });\n      } else {\n        uriToBlob(img.src).then(function (blob) {\n          blobInfo = blobCache.create(uniqueId(), blob, base64);\n          blobCache.add(blobInfo);\n          resolve({\n            image: img,\n            blobInfo: blobInfo\n          });\n        }, function (err) {\n          reject(err);\n        });\n      }\n    };\n    var getAllImages = function (elm) {\n      return elm ? from$1(elm.getElementsByTagName('img')) : [];\n    };\n    function ImageScanner(uploadStatus, blobCache) {\n      var cachedPromises = {};\n      var findAll = function (elm, predicate) {\n        if (!predicate) {\n          predicate = always;\n        }\n        var images = filter(getAllImages(elm), function (img) {\n          var src = img.src;\n          if (!Env.fileApi) {\n            return false;\n          }\n          if (img.hasAttribute('data-mce-bogus')) {\n            return false;\n          }\n          if (img.hasAttribute('data-mce-placeholder')) {\n            return false;\n          }\n          if (!src || src === Env.transparentSrc) {\n            return false;\n          }\n          if (src.indexOf('blob:') === 0) {\n            return !uploadStatus.isUploaded(src) && predicate(img);\n          }\n          if (src.indexOf('data:') === 0) {\n            return predicate(img);\n          }\n          return false;\n        });\n        var promises = map(images, function (img) {\n          if (cachedPromises[img.src] !== undefined) {\n            return new promiseObj(function (resolve) {\n              cachedPromises[img.src].then(function (imageInfo) {\n                if (typeof imageInfo === 'string') {\n                  return imageInfo;\n                }\n                resolve({\n                  image: img,\n                  blobInfo: imageInfo.blobInfo\n                });\n              });\n            });\n          }\n          var newPromise = new promiseObj(function (resolve, reject) {\n            imageToBlobInfo(blobCache, img, resolve, reject);\n          }).then(function (result) {\n            delete cachedPromises[result.image.src];\n            return result;\n          }).catch(function (error) {\n            delete cachedPromises[img.src];\n            return error;\n          });\n          cachedPromises[img.src] = newPromise;\n          return newPromise;\n        });\n        return promiseObj.all(promises);\n      };\n      return { findAll: findAll };\n    }\n\n    var paddEmptyNode = function (settings, args, blockElements, node) {\n      var brPreferred = settings.padd_empty_with_br || args.insert;\n      if (brPreferred && blockElements[node.name]) {\n        node.empty().append(new AstNode('br', 1)).shortEnded = true;\n      } else {\n        node.empty().append(new AstNode('#text', 3)).value = nbsp;\n      }\n    };\n    var isPaddedWithNbsp = function (node) {\n      return hasOnlyChild(node, '#text') && node.firstChild.value === nbsp;\n    };\n    var hasOnlyChild = function (node, name) {\n      return node && node.firstChild && node.firstChild === node.lastChild && node.firstChild.name === name;\n    };\n    var isPadded = function (schema, node) {\n      var rule = schema.getElementRule(node.name);\n      return rule && rule.paddEmpty;\n    };\n    var isEmpty$2 = function (schema, nonEmptyElements, whitespaceElements, node) {\n      return node.isEmpty(nonEmptyElements, whitespaceElements, function (node) {\n        return isPadded(schema, node);\n      });\n    };\n    var isLineBreakNode = function (node, blockElements) {\n      return node && (blockElements[node.name] || node.name === 'br');\n    };\n\n    var isBogusImage = function (img) {\n      return img.attr('data-mce-bogus');\n    };\n    var isInternalImageSource = function (img) {\n      return img.attr('src') === Env.transparentSrc || img.attr('data-mce-placeholder');\n    };\n    var isValidDataImg = function (img, settings) {\n      if (settings.images_dataimg_filter) {\n        var imgElem_1 = new Image();\n        imgElem_1.src = img.attr('src');\n        each$1(img.attributes.map, function (value, key) {\n          imgElem_1.setAttribute(key, value);\n        });\n        return settings.images_dataimg_filter(imgElem_1);\n      } else {\n        return true;\n      }\n    };\n    var registerBase64ImageFilter = function (parser, settings) {\n      var blobCache = settings.blob_cache;\n      var processImage = function (img) {\n        var inputSrc = img.attr('src');\n        if (isInternalImageSource(img) || isBogusImage(img)) {\n          return;\n        }\n        parseDataUri(inputSrc).filter(function () {\n          return isValidDataImg(img, settings);\n        }).bind(function (_a) {\n          var type = _a.type, data = _a.data;\n          return Optional.from(blobCache.getByData(data, type)).orThunk(function () {\n            return buildBlob(type, data).map(function (blob) {\n              var blobInfo = blobCache.create(uniqueId(), blob, data);\n              blobCache.add(blobInfo);\n              return blobInfo;\n            });\n          });\n        }).each(function (blobInfo) {\n          img.attr('src', blobInfo.blobUri());\n        });\n      };\n      if (blobCache) {\n        parser.addAttributeFilter('src', function (nodes) {\n          return each(nodes, processImage);\n        });\n      }\n    };\n    var register$2 = function (parser, settings) {\n      var schema = parser.schema;\n      if (settings.remove_trailing_brs) {\n        parser.addNodeFilter('br', function (nodes, _, args) {\n          var i;\n          var l = nodes.length;\n          var node;\n          var blockElements = Tools.extend({}, schema.getBlockElements());\n          var nonEmptyElements = schema.getNonEmptyElements();\n          var parent, lastParent, prev, prevName;\n          var whiteSpaceElements = schema.getWhiteSpaceElements();\n          var elementRule, textNode;\n          blockElements.body = 1;\n          for (i = 0; i < l; i++) {\n            node = nodes[i];\n            parent = node.parent;\n            if (blockElements[node.parent.name] && node === parent.lastChild) {\n              prev = node.prev;\n              while (prev) {\n                prevName = prev.name;\n                if (prevName !== 'span' || prev.attr('data-mce-type') !== 'bookmark') {\n                  if (prevName === 'br') {\n                    node = null;\n                  }\n                  break;\n                }\n                prev = prev.prev;\n              }\n              if (node) {\n                node.remove();\n                if (isEmpty$2(schema, nonEmptyElements, whiteSpaceElements, parent)) {\n                  elementRule = schema.getElementRule(parent.name);\n                  if (elementRule) {\n                    if (elementRule.removeEmpty) {\n                      parent.remove();\n                    } else if (elementRule.paddEmpty) {\n                      paddEmptyNode(settings, args, blockElements, parent);\n                    }\n                  }\n                }\n              }\n            } else {\n              lastParent = node;\n              while (parent && parent.firstChild === lastParent && parent.lastChild === lastParent) {\n                lastParent = parent;\n                if (blockElements[parent.name]) {\n                  break;\n                }\n                parent = parent.parent;\n              }\n              if (lastParent === parent && settings.padd_empty_with_br !== true) {\n                textNode = new AstNode('#text', 3);\n                textNode.value = nbsp;\n                node.replace(textNode);\n              }\n            }\n          }\n        });\n      }\n      parser.addAttributeFilter('href', function (nodes) {\n        var i = nodes.length;\n        var appendRel = function (rel) {\n          var parts = rel.split(' ').filter(function (p) {\n            return p.length > 0;\n          });\n          return parts.concat(['noopener']).sort().join(' ');\n        };\n        var addNoOpener = function (rel) {\n          var newRel = rel ? Tools.trim(rel) : '';\n          if (!/\\b(noopener)\\b/g.test(newRel)) {\n            return appendRel(newRel);\n          } else {\n            return newRel;\n          }\n        };\n        if (!settings.allow_unsafe_link_target) {\n          while (i--) {\n            var node = nodes[i];\n            if (node.name === 'a' && node.attr('target') === '_blank') {\n              node.attr('rel', addNoOpener(node.attr('rel')));\n            }\n          }\n        }\n      });\n      if (!settings.allow_html_in_named_anchor) {\n        parser.addAttributeFilter('id,name', function (nodes) {\n          var i = nodes.length, sibling, prevSibling, parent, node;\n          while (i--) {\n            node = nodes[i];\n            if (node.name === 'a' && node.firstChild && !node.attr('href')) {\n              parent = node.parent;\n              sibling = node.lastChild;\n              do {\n                prevSibling = sibling.prev;\n                parent.insert(sibling, node);\n                sibling = prevSibling;\n              } while (sibling);\n            }\n          }\n        });\n      }\n      if (settings.fix_list_elements) {\n        parser.addNodeFilter('ul,ol', function (nodes) {\n          var i = nodes.length, node, parentNode;\n          while (i--) {\n            node = nodes[i];\n            parentNode = node.parent;\n            if (parentNode.name === 'ul' || parentNode.name === 'ol') {\n              if (node.prev && node.prev.name === 'li') {\n                node.prev.append(node);\n              } else {\n                var li = new AstNode('li', 1);\n                li.attr('style', 'list-style-type: none');\n                node.wrap(li);\n              }\n            }\n          }\n        });\n      }\n      if (settings.validate && schema.getValidClasses()) {\n        parser.addAttributeFilter('class', function (nodes) {\n          var i = nodes.length, node, classList, ci, className, classValue;\n          var validClasses = schema.getValidClasses();\n          var validClassesMap, valid;\n          while (i--) {\n            node = nodes[i];\n            classList = node.attr('class').split(' ');\n            classValue = '';\n            for (ci = 0; ci < classList.length; ci++) {\n              className = classList[ci];\n              valid = false;\n              validClassesMap = validClasses['*'];\n              if (validClassesMap && validClassesMap[className]) {\n                valid = true;\n              }\n              validClassesMap = validClasses[node.name];\n              if (!valid && validClassesMap && validClassesMap[className]) {\n                valid = true;\n              }\n              if (valid) {\n                if (classValue) {\n                  classValue += ' ';\n                }\n                classValue += className;\n              }\n            }\n            if (!classValue.length) {\n              classValue = null;\n            }\n            node.attr('class', classValue);\n          }\n        });\n      }\n      registerBase64ImageFilter(parser, settings);\n    };\n\n    var makeMap$4 = Tools.makeMap, each$d = Tools.each, explode$2 = Tools.explode, extend$2 = Tools.extend;\n    var DomParser = function (settings, schema) {\n      if (schema === void 0) {\n        schema = Schema();\n      }\n      var nodeFilters = {};\n      var attributeFilters = [];\n      var matchedNodes = {};\n      var matchedAttributes = {};\n      settings = settings || {};\n      settings.validate = 'validate' in settings ? settings.validate : true;\n      settings.root_name = settings.root_name || 'body';\n      var fixInvalidChildren = function (nodes) {\n        var ni, node, parent, parents, newParent, currentNode, tempNode, childNode, i;\n        var sibling, nextNode;\n        var nonSplitableElements = makeMap$4('tr,td,th,tbody,thead,tfoot,table');\n        var nonEmptyElements = schema.getNonEmptyElements();\n        var whitespaceElements = schema.getWhiteSpaceElements();\n        var textBlockElements = schema.getTextBlockElements();\n        var specialElements = schema.getSpecialElements();\n        for (ni = 0; ni < nodes.length; ni++) {\n          node = nodes[ni];\n          if (!node.parent || node.fixed) {\n            continue;\n          }\n          if (textBlockElements[node.name] && node.parent.name === 'li') {\n            sibling = node.next;\n            while (sibling) {\n              if (textBlockElements[sibling.name]) {\n                sibling.name = 'li';\n                sibling.fixed = true;\n                node.parent.insert(sibling, node.parent);\n              } else {\n                break;\n              }\n              sibling = sibling.next;\n            }\n            node.unwrap(node);\n            continue;\n          }\n          parents = [node];\n          for (parent = node.parent; parent && !schema.isValidChild(parent.name, node.name) && !nonSplitableElements[parent.name]; parent = parent.parent) {\n            parents.push(parent);\n          }\n          if (parent && parents.length > 1) {\n            parents.reverse();\n            newParent = currentNode = filterNode(parents[0].clone());\n            for (i = 0; i < parents.length - 1; i++) {\n              if (schema.isValidChild(currentNode.name, parents[i].name)) {\n                tempNode = filterNode(parents[i].clone());\n                currentNode.append(tempNode);\n              } else {\n                tempNode = currentNode;\n              }\n              for (childNode = parents[i].firstChild; childNode && childNode !== parents[i + 1];) {\n                nextNode = childNode.next;\n                tempNode.append(childNode);\n                childNode = nextNode;\n              }\n              currentNode = tempNode;\n            }\n            if (!isEmpty$2(schema, nonEmptyElements, whitespaceElements, newParent)) {\n              parent.insert(newParent, parents[0], true);\n              parent.insert(node, newParent);\n            } else {\n              parent.insert(node, parents[0], true);\n            }\n            parent = parents[0];\n            if (isEmpty$2(schema, nonEmptyElements, whitespaceElements, parent) || hasOnlyChild(parent, 'br')) {\n              parent.empty().remove();\n            }\n          } else if (node.parent) {\n            if (node.name === 'li') {\n              sibling = node.prev;\n              if (sibling && (sibling.name === 'ul' || sibling.name === 'ol')) {\n                sibling.append(node);\n                continue;\n              }\n              sibling = node.next;\n              if (sibling && (sibling.name === 'ul' || sibling.name === 'ol')) {\n                sibling.insert(node, sibling.firstChild, true);\n                continue;\n              }\n              node.wrap(filterNode(new AstNode('ul', 1)));\n              continue;\n            }\n            if (schema.isValidChild(node.parent.name, 'div') && schema.isValidChild('div', node.name)) {\n              node.wrap(filterNode(new AstNode('div', 1)));\n            } else {\n              if (specialElements[node.name]) {\n                node.empty().remove();\n              } else {\n                node.unwrap();\n              }\n            }\n          }\n        }\n      };\n      var filterNode = function (node) {\n        var i, name, list;\n        name = node.name;\n        if (name in nodeFilters) {\n          list = matchedNodes[name];\n          if (list) {\n            list.push(node);\n          } else {\n            matchedNodes[name] = [node];\n          }\n        }\n        i = attributeFilters.length;\n        while (i--) {\n          name = attributeFilters[i].name;\n          if (name in node.attributes.map) {\n            list = matchedAttributes[name];\n            if (list) {\n              list.push(node);\n            } else {\n              matchedAttributes[name] = [node];\n            }\n          }\n        }\n        return node;\n      };\n      var addNodeFilter = function (name, callback) {\n        each$d(explode$2(name), function (name) {\n          var list = nodeFilters[name];\n          if (!list) {\n            nodeFilters[name] = list = [];\n          }\n          list.push(callback);\n        });\n      };\n      var getNodeFilters = function () {\n        var out = [];\n        for (var name_1 in nodeFilters) {\n          if (nodeFilters.hasOwnProperty(name_1)) {\n            out.push({\n              name: name_1,\n              callbacks: nodeFilters[name_1]\n            });\n          }\n        }\n        return out;\n      };\n      var addAttributeFilter = function (name, callback) {\n        each$d(explode$2(name), function (name) {\n          var i;\n          for (i = 0; i < attributeFilters.length; i++) {\n            if (attributeFilters[i].name === name) {\n              attributeFilters[i].callbacks.push(callback);\n              return;\n            }\n          }\n          attributeFilters.push({\n            name: name,\n            callbacks: [callback]\n          });\n        });\n      };\n      var getAttributeFilters = function () {\n        return [].concat(attributeFilters);\n      };\n      var parse = function (html, args) {\n        var nodes, i, l, fi, fl, list, name;\n        var invalidChildren = [];\n        var isInWhiteSpacePreservedElement;\n        var node;\n        var getRootBlockName = function (name) {\n          if (name === false) {\n            return '';\n          } else if (name === true) {\n            return 'p';\n          } else {\n            return name;\n          }\n        };\n        args = args || {};\n        matchedNodes = {};\n        matchedAttributes = {};\n        var blockElements = extend$2(makeMap$4('script,style,head,html,body,title,meta,param'), schema.getBlockElements());\n        var nonEmptyElements = schema.getNonEmptyElements();\n        var children = schema.children;\n        var validate = settings.validate;\n        var forcedRootBlockName = 'forced_root_block' in args ? args.forced_root_block : settings.forced_root_block;\n        var rootBlockName = getRootBlockName(forcedRootBlockName);\n        var whiteSpaceElements = schema.getWhiteSpaceElements();\n        var startWhiteSpaceRegExp = /^[ \\t\\r\\n]+/;\n        var endWhiteSpaceRegExp = /[ \\t\\r\\n]+$/;\n        var allWhiteSpaceRegExp = /[ \\t\\r\\n]+/g;\n        var isAllWhiteSpaceRegExp = /^[ \\t\\r\\n]+$/;\n        isInWhiteSpacePreservedElement = whiteSpaceElements.hasOwnProperty(args.context) || whiteSpaceElements.hasOwnProperty(settings.root_name);\n        var addRootBlocks = function () {\n          var node = rootNode.firstChild, next, rootBlockNode;\n          var trim = function (rootBlockNode) {\n            if (rootBlockNode) {\n              node = rootBlockNode.firstChild;\n              if (node && node.type === 3) {\n                node.value = node.value.replace(startWhiteSpaceRegExp, '');\n              }\n              node = rootBlockNode.lastChild;\n              if (node && node.type === 3) {\n                node.value = node.value.replace(endWhiteSpaceRegExp, '');\n              }\n            }\n          };\n          if (!schema.isValidChild(rootNode.name, rootBlockName.toLowerCase())) {\n            return;\n          }\n          while (node) {\n            next = node.next;\n            if (node.type === 3 || node.type === 1 && node.name !== 'p' && !blockElements[node.name] && !node.attr('data-mce-type')) {\n              if (!rootBlockNode) {\n                rootBlockNode = createNode(rootBlockName, 1);\n                rootBlockNode.attr(settings.forced_root_block_attrs);\n                rootNode.insert(rootBlockNode, node);\n                rootBlockNode.append(node);\n              } else {\n                rootBlockNode.append(node);\n              }\n            } else {\n              trim(rootBlockNode);\n              rootBlockNode = null;\n            }\n            node = next;\n          }\n          trim(rootBlockNode);\n        };\n        var createNode = function (name, type) {\n          var node = new AstNode(name, type);\n          var list;\n          if (name in nodeFilters) {\n            list = matchedNodes[name];\n            if (list) {\n              list.push(node);\n            } else {\n              matchedNodes[name] = [node];\n            }\n          }\n          return node;\n        };\n        var removeWhitespaceBefore = function (node) {\n          var textNode, textNodeNext, textVal, sibling;\n          var blockElements = schema.getBlockElements();\n          for (textNode = node.prev; textNode && textNode.type === 3;) {\n            textVal = textNode.value.replace(endWhiteSpaceRegExp, '');\n            if (textVal.length > 0) {\n              textNode.value = textVal;\n              return;\n            }\n            textNodeNext = textNode.next;\n            if (textNodeNext) {\n              if (textNodeNext.type === 3 && textNodeNext.value.length) {\n                textNode = textNode.prev;\n                continue;\n              }\n              if (!blockElements[textNodeNext.name] && textNodeNext.name !== 'script' && textNodeNext.name !== 'style') {\n                textNode = textNode.prev;\n                continue;\n              }\n            }\n            sibling = textNode.prev;\n            textNode.remove();\n            textNode = sibling;\n          }\n        };\n        var cloneAndExcludeBlocks = function (input) {\n          var name;\n          var output = {};\n          for (name in input) {\n            if (name !== 'li' && name !== 'p') {\n              output[name] = input[name];\n            }\n          }\n          return output;\n        };\n        var parser = SaxParser$1({\n          validate: validate,\n          allow_html_data_urls: settings.allow_html_data_urls,\n          allow_script_urls: settings.allow_script_urls,\n          allow_conditional_comments: settings.allow_conditional_comments,\n          preserve_cdata: settings.preserve_cdata,\n          self_closing_elements: cloneAndExcludeBlocks(schema.getSelfClosingElements()),\n          cdata: function (text) {\n            node.append(createNode('#cdata', 4)).value = text;\n          },\n          text: function (text, raw) {\n            var textNode;\n            if (!isInWhiteSpacePreservedElement) {\n              text = text.replace(allWhiteSpaceRegExp, ' ');\n              if (isLineBreakNode(node.lastChild, blockElements)) {\n                text = text.replace(startWhiteSpaceRegExp, '');\n              }\n            }\n            if (text.length !== 0) {\n              textNode = createNode('#text', 3);\n              textNode.raw = !!raw;\n              node.append(textNode).value = text;\n            }\n          },\n          comment: function (text) {\n            node.append(createNode('#comment', 8)).value = text;\n          },\n          pi: function (name, text) {\n            node.append(createNode(name, 7)).value = text;\n            removeWhitespaceBefore(node);\n          },\n          doctype: function (text) {\n            var newNode = node.append(createNode('#doctype', 10));\n            newNode.value = text;\n            removeWhitespaceBefore(node);\n          },\n          start: function (name, attrs, empty) {\n            var newNode, attrFiltersLen, attrName, parent;\n            var elementRule = validate ? schema.getElementRule(name) : {};\n            if (elementRule) {\n              newNode = createNode(elementRule.outputName || name, 1);\n              newNode.attributes = attrs;\n              newNode.shortEnded = empty;\n              node.append(newNode);\n              parent = children[node.name];\n              if (parent && children[newNode.name] && !parent[newNode.name]) {\n                invalidChildren.push(newNode);\n              }\n              attrFiltersLen = attributeFilters.length;\n              while (attrFiltersLen--) {\n                attrName = attributeFilters[attrFiltersLen].name;\n                if (attrName in attrs.map) {\n                  list = matchedAttributes[attrName];\n                  if (list) {\n                    list.push(newNode);\n                  } else {\n                    matchedAttributes[attrName] = [newNode];\n                  }\n                }\n              }\n              if (blockElements[name]) {\n                removeWhitespaceBefore(newNode);\n              }\n              if (!empty) {\n                node = newNode;\n              }\n              if (!isInWhiteSpacePreservedElement && whiteSpaceElements[name]) {\n                isInWhiteSpacePreservedElement = true;\n              }\n            }\n          },\n          end: function (name) {\n            var textNode, text, sibling, tempNode;\n            var elementRule = validate ? schema.getElementRule(name) : {};\n            if (elementRule) {\n              if (blockElements[name]) {\n                if (!isInWhiteSpacePreservedElement) {\n                  textNode = node.firstChild;\n                  if (textNode && textNode.type === 3) {\n                    text = textNode.value.replace(startWhiteSpaceRegExp, '');\n                    if (text.length > 0) {\n                      textNode.value = text;\n                      textNode = textNode.next;\n                    } else {\n                      sibling = textNode.next;\n                      textNode.remove();\n                      textNode = sibling;\n                      while (textNode && textNode.type === 3) {\n                        text = textNode.value;\n                        sibling = textNode.next;\n                        if (text.length === 0 || isAllWhiteSpaceRegExp.test(text)) {\n                          textNode.remove();\n                          textNode = sibling;\n                        }\n                        textNode = sibling;\n                      }\n                    }\n                  }\n                  textNode = node.lastChild;\n                  if (textNode && textNode.type === 3) {\n                    text = textNode.value.replace(endWhiteSpaceRegExp, '');\n                    if (text.length > 0) {\n                      textNode.value = text;\n                      textNode = textNode.prev;\n                    } else {\n                      sibling = textNode.prev;\n                      textNode.remove();\n                      textNode = sibling;\n                      while (textNode && textNode.type === 3) {\n                        text = textNode.value;\n                        sibling = textNode.prev;\n                        if (text.length === 0 || isAllWhiteSpaceRegExp.test(text)) {\n                          textNode.remove();\n                          textNode = sibling;\n                        }\n                        textNode = sibling;\n                      }\n                    }\n                  }\n                }\n              }\n              if (isInWhiteSpacePreservedElement && whiteSpaceElements[name]) {\n                isInWhiteSpacePreservedElement = false;\n              }\n              if (elementRule.removeEmpty && isEmpty$2(schema, nonEmptyElements, whiteSpaceElements, node)) {\n                tempNode = node.parent;\n                if (blockElements[node.name]) {\n                  node.empty().remove();\n                } else {\n                  node.unwrap();\n                }\n                node = tempNode;\n                return;\n              }\n              if (elementRule.paddEmpty && (isPaddedWithNbsp(node) || isEmpty$2(schema, nonEmptyElements, whiteSpaceElements, node))) {\n                paddEmptyNode(settings, args, blockElements, node);\n              }\n              node = node.parent;\n            }\n          }\n        }, schema);\n        var rootNode = node = new AstNode(args.context || settings.root_name, 11);\n        parser.parse(html, args.format);\n        if (validate && invalidChildren.length) {\n          if (!args.context) {\n            fixInvalidChildren(invalidChildren);\n          } else {\n            args.invalid = true;\n          }\n        }\n        if (rootBlockName && (rootNode.name === 'body' || args.isRootContent)) {\n          addRootBlocks();\n        }\n        if (!args.invalid) {\n          for (name in matchedNodes) {\n            if (!matchedNodes.hasOwnProperty(name)) {\n              continue;\n            }\n            list = nodeFilters[name];\n            nodes = matchedNodes[name];\n            fi = nodes.length;\n            while (fi--) {\n              if (!nodes[fi].parent) {\n                nodes.splice(fi, 1);\n              }\n            }\n            for (i = 0, l = list.length; i < l; i++) {\n              list[i](nodes, name, args);\n            }\n          }\n          for (i = 0, l = attributeFilters.length; i < l; i++) {\n            list = attributeFilters[i];\n            if (list.name in matchedAttributes) {\n              nodes = matchedAttributes[list.name];\n              fi = nodes.length;\n              while (fi--) {\n                if (!nodes[fi].parent) {\n                  nodes.splice(fi, 1);\n                }\n              }\n              for (fi = 0, fl = list.callbacks.length; fi < fl; fi++) {\n                list.callbacks[fi](nodes, list.name, args);\n              }\n            }\n          }\n        }\n        return rootNode;\n      };\n      var exports = {\n        schema: schema,\n        addAttributeFilter: addAttributeFilter,\n        getAttributeFilters: getAttributeFilters,\n        addNodeFilter: addNodeFilter,\n        getNodeFilters: getNodeFilters,\n        filterNode: filterNode,\n        parse: parse\n      };\n      register$2(exports, settings);\n      register$1(exports, settings);\n      return exports;\n    };\n\n    var register$3 = function (htmlParser, settings, dom) {\n      htmlParser.addAttributeFilter('data-mce-tabindex', function (nodes, name) {\n        var i = nodes.length, node;\n        while (i--) {\n          node = nodes[i];\n          node.attr('tabindex', node.attr('data-mce-tabindex'));\n          node.attr(name, null);\n        }\n      });\n      htmlParser.addAttributeFilter('src,href,style', function (nodes, name) {\n        var i = nodes.length, node, value;\n        var internalName = 'data-mce-' + name;\n        var urlConverter = settings.url_converter;\n        var urlConverterScope = settings.url_converter_scope;\n        while (i--) {\n          node = nodes[i];\n          value = node.attr(internalName);\n          if (value !== undefined) {\n            node.attr(name, value.length > 0 ? value : null);\n            node.attr(internalName, null);\n          } else {\n            value = node.attr(name);\n            if (name === 'style') {\n              value = dom.serializeStyle(dom.parseStyle(value), node.name);\n            } else if (urlConverter) {\n              value = urlConverter.call(urlConverterScope, value, name, node.name);\n            }\n            node.attr(name, value.length > 0 ? value : null);\n          }\n        }\n      });\n      htmlParser.addAttributeFilter('class', function (nodes) {\n        var i = nodes.length, node, value;\n        while (i--) {\n          node = nodes[i];\n          value = node.attr('class');\n          if (value) {\n            value = node.attr('class').replace(/(?:^|\\s)mce-item-\\w+(?!\\S)/g, '');\n            node.attr('class', value.length > 0 ? value : null);\n          }\n        }\n      });\n      htmlParser.addAttributeFilter('data-mce-type', function (nodes, name, args) {\n        var i = nodes.length, node;\n        while (i--) {\n          node = nodes[i];\n          if (node.attr('data-mce-type') === 'bookmark' && !args.cleanup) {\n            var hasChildren = Optional.from(node.firstChild).exists(function (firstChild) {\n              return !isZwsp$1(firstChild.value);\n            });\n            if (hasChildren) {\n              node.unwrap();\n            } else {\n              node.remove();\n            }\n          }\n        }\n      });\n      htmlParser.addNodeFilter('noscript', function (nodes) {\n        var i = nodes.length, node;\n        while (i--) {\n          node = nodes[i].firstChild;\n          if (node) {\n            node.value = Entities.decode(node.value);\n          }\n        }\n      });\n      htmlParser.addNodeFilter('script,style', function (nodes, name) {\n        var i = nodes.length, node, value, type;\n        var trim = function (value) {\n          return value.replace(/(<!--\\[CDATA\\[|\\]\\]-->)/g, '\\n').replace(/^[\\r\\n]*|[\\r\\n]*$/g, '').replace(/^\\s*((<!--)?(\\s*\\/\\/)?\\s*<!\\[CDATA\\[|(<!--\\s*)?\\/\\*\\s*<!\\[CDATA\\[\\s*\\*\\/|(\\/\\/)?\\s*<!--|\\/\\*\\s*<!--\\s*\\*\\/)\\s*[\\r\\n]*/gi, '').replace(/\\s*(\\/\\*\\s*\\]\\]>\\s*\\*\\/(-->)?|\\s*\\/\\/\\s*\\]\\]>(-->)?|\\/\\/\\s*(-->)?|\\]\\]>|\\/\\*\\s*-->\\s*\\*\\/|\\s*-->\\s*)\\s*$/g, '');\n        };\n        while (i--) {\n          node = nodes[i];\n          value = node.firstChild ? node.firstChild.value : '';\n          if (name === 'script') {\n            type = node.attr('type');\n            if (type) {\n              node.attr('type', type === 'mce-no/type' ? null : type.replace(/^mce\\-/, ''));\n            }\n            if (settings.element_format === 'xhtml' && value.length > 0) {\n              node.firstChild.value = '// <![CDATA[\\n' + trim(value) + '\\n// ]]>';\n            }\n          } else {\n            if (settings.element_format === 'xhtml' && value.length > 0) {\n              node.firstChild.value = '<!--\\n' + trim(value) + '\\n-->';\n            }\n          }\n        }\n      });\n      htmlParser.addNodeFilter('#comment', function (nodes) {\n        var i = nodes.length, node;\n        while (i--) {\n          node = nodes[i];\n          if (settings.preserve_cdata && node.value.indexOf('[CDATA[') === 0) {\n            node.name = '#cdata';\n            node.type = 4;\n            node.value = dom.decode(node.value.replace(/^\\[CDATA\\[|\\]\\]$/g, ''));\n          } else if (node.value.indexOf('mce:protected ') === 0) {\n            node.name = '#text';\n            node.type = 3;\n            node.raw = true;\n            node.value = unescape(node.value).substr(14);\n          }\n        }\n      });\n      htmlParser.addNodeFilter('xml:namespace,input', function (nodes, name) {\n        var i = nodes.length, node;\n        while (i--) {\n          node = nodes[i];\n          if (node.type === 7) {\n            node.remove();\n          } else if (node.type === 1) {\n            if (name === 'input' && !node.attr('type')) {\n              node.attr('type', 'text');\n            }\n          }\n        }\n      });\n      htmlParser.addAttributeFilter('data-mce-type', function (nodes) {\n        each(nodes, function (node) {\n          if (node.attr('data-mce-type') === 'format-caret') {\n            if (node.isEmpty(htmlParser.schema.getNonEmptyElements())) {\n              node.remove();\n            } else {\n              node.unwrap();\n            }\n          }\n        });\n      });\n      htmlParser.addAttributeFilter('data-mce-src,data-mce-href,data-mce-style,' + 'data-mce-selected,data-mce-expando,' + 'data-mce-type,data-mce-resize,data-mce-placeholder', function (nodes, name) {\n        var i = nodes.length;\n        while (i--) {\n          nodes[i].attr(name, null);\n        }\n      });\n    };\n    var trimTrailingBr = function (rootNode) {\n      var isBr = function (node) {\n        return node && node.name === 'br';\n      };\n      var brNode1 = rootNode.lastChild;\n      if (isBr(brNode1)) {\n        var brNode2 = brNode1.prev;\n        if (isBr(brNode2)) {\n          brNode1.remove();\n          brNode2.remove();\n        }\n      }\n    };\n\n    var preProcess = function (editor, node, args) {\n      var doc, oldDoc;\n      var dom = editor.dom;\n      node = node.cloneNode(true);\n      var impl = document.implementation;\n      if (impl.createHTMLDocument) {\n        doc = impl.createHTMLDocument('');\n        Tools.each(node.nodeName === 'BODY' ? node.childNodes : [node], function (node) {\n          doc.body.appendChild(doc.importNode(node, true));\n        });\n        if (node.nodeName !== 'BODY') {\n          node = doc.body.firstChild;\n        } else {\n          node = doc.body;\n        }\n        oldDoc = dom.doc;\n        dom.doc = doc;\n      }\n      firePreProcess(editor, __assign(__assign({}, args), { node: node }));\n      if (oldDoc) {\n        dom.doc = oldDoc;\n      }\n      return node;\n    };\n    var shouldFireEvent = function (editor, args) {\n      return editor && editor.hasEventListeners('PreProcess') && !args.no_events;\n    };\n    var process = function (editor, node, args) {\n      return shouldFireEvent(editor, args) ? preProcess(editor, node, args) : node;\n    };\n\n    var addTempAttr = function (htmlParser, tempAttrs, name) {\n      if (Tools.inArray(tempAttrs, name) === -1) {\n        htmlParser.addAttributeFilter(name, function (nodes, name) {\n          var i = nodes.length;\n          while (i--) {\n            nodes[i].attr(name, null);\n          }\n        });\n        tempAttrs.push(name);\n      }\n    };\n    var postProcess$1 = function (editor, args, content) {\n      if (!args.no_events && editor) {\n        var outArgs = firePostProcess(editor, __assign(__assign({}, args), { content: content }));\n        return outArgs.content;\n      } else {\n        return content;\n      }\n    };\n    var getHtmlFromNode = function (dom, node, args) {\n      var html = trim$2(args.getInner ? node.innerHTML : dom.getOuterHTML(node));\n      return args.selection || isWsPreserveElement(SugarElement.fromDom(node)) ? html : Tools.trim(html);\n    };\n    var parseHtml = function (htmlParser, html, args) {\n      var parserArgs = args.selection ? __assign({ forced_root_block: false }, args) : args;\n      var rootNode = htmlParser.parse(html, parserArgs);\n      trimTrailingBr(rootNode);\n      return rootNode;\n    };\n    var serializeNode = function (settings, schema, node) {\n      var htmlSerializer = HtmlSerializer(settings, schema);\n      return htmlSerializer.serialize(node);\n    };\n    var toHtml = function (editor, settings, schema, rootNode, args) {\n      var content = serializeNode(settings, schema, rootNode);\n      return postProcess$1(editor, args, content);\n    };\n    var DomSerializerImpl = function (settings, editor) {\n      var tempAttrs = ['data-mce-selected'];\n      var dom = editor && editor.dom ? editor.dom : DOMUtils$1.DOM;\n      var schema = editor && editor.schema ? editor.schema : Schema(settings);\n      settings.entity_encoding = settings.entity_encoding || 'named';\n      settings.remove_trailing_brs = 'remove_trailing_brs' in settings ? settings.remove_trailing_brs : true;\n      var htmlParser = DomParser(settings, schema);\n      register$3(htmlParser, settings, dom);\n      var serialize = function (node, parserArgs) {\n        if (parserArgs === void 0) {\n          parserArgs = {};\n        }\n        var args = __assign({ format: 'html' }, parserArgs);\n        var targetNode = process(editor, node, args);\n        var html = getHtmlFromNode(dom, targetNode, args);\n        var rootNode = parseHtml(htmlParser, html, args);\n        return args.format === 'tree' ? rootNode : toHtml(editor, settings, schema, rootNode, args);\n      };\n      return {\n        schema: schema,\n        addNodeFilter: htmlParser.addNodeFilter,\n        addAttributeFilter: htmlParser.addAttributeFilter,\n        serialize: serialize,\n        addRules: function (rules) {\n          schema.addValidElements(rules);\n        },\n        setRules: function (rules) {\n          schema.setValidElements(rules);\n        },\n        addTempAttr: curry(addTempAttr, htmlParser, tempAttrs),\n        getTempAttrs: function () {\n          return tempAttrs;\n        },\n        getNodeFilters: htmlParser.getNodeFilters,\n        getAttributeFilters: htmlParser.getAttributeFilters\n      };\n    };\n\n    var DomSerializer = function (settings, editor) {\n      var domSerializer = DomSerializerImpl(settings, editor);\n      return {\n        schema: domSerializer.schema,\n        addNodeFilter: domSerializer.addNodeFilter,\n        addAttributeFilter: domSerializer.addAttributeFilter,\n        serialize: domSerializer.serialize,\n        addRules: domSerializer.addRules,\n        setRules: domSerializer.setRules,\n        addTempAttr: domSerializer.addTempAttr,\n        getTempAttrs: domSerializer.getTempAttrs,\n        getNodeFilters: domSerializer.getNodeFilters,\n        getAttributeFilters: domSerializer.getAttributeFilters\n      };\n    };\n\n    var defaultFormat$1 = 'html';\n    var getContent$2 = function (editor, args) {\n      if (args === void 0) {\n        args = {};\n      }\n      var format = args.format ? args.format : defaultFormat$1;\n      return getContent(editor, args, format);\n    };\n\n    var setContent$2 = function (editor, content, args) {\n      if (args === void 0) {\n        args = {};\n      }\n      return setContent(editor, content, args);\n    };\n\n    var DOM$3 = DOMUtils$1.DOM;\n    var restoreOriginalStyles = function (editor) {\n      DOM$3.setStyle(editor.id, 'display', editor.orgDisplay);\n    };\n    var safeDestroy = function (x) {\n      return Optional.from(x).each(function (x) {\n        return x.destroy();\n      });\n    };\n    var clearDomReferences = function (editor) {\n      editor.contentAreaContainer = editor.formElement = editor.container = editor.editorContainer = null;\n      editor.bodyElement = editor.contentDocument = editor.contentWindow = null;\n      editor.iframeElement = editor.targetElm = null;\n      if (editor.selection) {\n        editor.selection = editor.selection.win = editor.selection.dom = editor.selection.dom.doc = null;\n      }\n    };\n    var restoreForm = function (editor) {\n      var form = editor.formElement;\n      if (form) {\n        if (form._mceOldSubmit) {\n          form.submit = form._mceOldSubmit;\n          form._mceOldSubmit = null;\n        }\n        DOM$3.unbind(form, 'submit reset', editor.formEventDelegate);\n      }\n    };\n    var remove$7 = function (editor) {\n      if (!editor.removed) {\n        var _selectionOverrides = editor._selectionOverrides, editorUpload = editor.editorUpload;\n        var body = editor.getBody();\n        var element = editor.getElement();\n        if (body) {\n          editor.save({ is_removing: true });\n        }\n        editor.removed = true;\n        editor.unbindAllNativeEvents();\n        if (editor.hasHiddenInput && element) {\n          DOM$3.remove(element.nextSibling);\n        }\n        fireRemove(editor);\n        editor.editorManager.remove(editor);\n        if (!editor.inline && body) {\n          restoreOriginalStyles(editor);\n        }\n        fireDetach(editor);\n        DOM$3.remove(editor.getContainer());\n        safeDestroy(_selectionOverrides);\n        safeDestroy(editorUpload);\n        editor.destroy();\n      }\n    };\n    var destroy = function (editor, automatic) {\n      var selection = editor.selection, dom = editor.dom;\n      if (editor.destroyed) {\n        return;\n      }\n      if (!automatic && !editor.removed) {\n        editor.remove();\n        return;\n      }\n      if (!automatic) {\n        editor.editorManager.off('beforeunload', editor._beforeUnload);\n        if (editor.theme && editor.theme.destroy) {\n          editor.theme.destroy();\n        }\n        safeDestroy(selection);\n        safeDestroy(dom);\n      }\n      restoreForm(editor);\n      clearDomReferences(editor);\n      editor.destroyed = true;\n    };\n\n    var hasOwnProperty$2 = Object.prototype.hasOwnProperty;\n    var deep$1 = function (old, nu) {\n      var bothObjects = isObject(old) && isObject(nu);\n      return bothObjects ? deepMerge(old, nu) : nu;\n    };\n    var baseMerge = function (merger) {\n      return function () {\n        var objects = new Array(arguments.length);\n        for (var i = 0; i < objects.length; i++) {\n          objects[i] = arguments[i];\n        }\n        if (objects.length === 0) {\n          throw new Error('Can\\'t merge zero objects');\n        }\n        var ret = {};\n        for (var j = 0; j < objects.length; j++) {\n          var curObject = objects[j];\n          for (var key in curObject) {\n            if (hasOwnProperty$2.call(curObject, key)) {\n              ret[key] = merger(ret[key], curObject[key]);\n            }\n          }\n        }\n        return ret;\n      };\n    };\n    var deepMerge = baseMerge(deep$1);\n\n    var sectionResult = function (sections, settings) {\n      return {\n        sections: constant(sections),\n        settings: constant(settings)\n      };\n    };\n    var deviceDetection = detect$3().deviceType;\n    var isTouch = deviceDetection.isTouch();\n    var isPhone = deviceDetection.isPhone();\n    var isTablet = deviceDetection.isTablet();\n    var legacyMobilePlugins = [\n      'lists',\n      'autolink',\n      'autosave'\n    ];\n    var defaultTouchSettings = {\n      table_grid: false,\n      object_resizing: false,\n      resize: false\n    };\n    var normalizePlugins = function (plugins) {\n      var pluginNames = isArray(plugins) ? plugins.join(' ') : plugins;\n      var trimmedPlugins = map(isString(pluginNames) ? pluginNames.split(' ') : [], trim);\n      return filter(trimmedPlugins, function (item) {\n        return item.length > 0;\n      });\n    };\n    var filterLegacyMobilePlugins = function (plugins) {\n      return filter(plugins, curry(contains, legacyMobilePlugins));\n    };\n    var extractSections = function (keys, settings) {\n      var result = bifilter(settings, function (value, key) {\n        return contains(keys, key);\n      });\n      return sectionResult(result.t, result.f);\n    };\n    var getSection = function (sectionResult, name, defaults) {\n      if (defaults === void 0) {\n        defaults = {};\n      }\n      var sections = sectionResult.sections();\n      var sectionSettings = sections.hasOwnProperty(name) ? sections[name] : {};\n      return Tools.extend({}, defaults, sectionSettings);\n    };\n    var hasSection = function (sectionResult, name) {\n      return sectionResult.sections().hasOwnProperty(name);\n    };\n    var isSectionTheme = function (sectionResult, name, theme) {\n      var section = sectionResult.sections();\n      return hasSection(sectionResult, name) && section[name].theme === theme;\n    };\n    var getSectionConfig = function (sectionResult, name) {\n      return hasSection(sectionResult, name) ? sectionResult.sections()[name] : {};\n    };\n    var getToolbarMode = function (settings, defaultVal) {\n      return get(settings, 'toolbar_mode').orThunk(function () {\n        return get(settings, 'toolbar_drawer').map(function (val) {\n          return val === false ? 'wrap' : val;\n        });\n      }).getOr(defaultVal);\n    };\n    var getDefaultSettings = function (settings, id, documentBaseUrl, isTouch, editor) {\n      var baseDefaults = {\n        id: id,\n        theme: 'silver',\n        toolbar_mode: getToolbarMode(settings, 'floating'),\n        plugins: '',\n        document_base_url: documentBaseUrl,\n        add_form_submit_trigger: true,\n        submit_patch: true,\n        add_unload_trigger: true,\n        convert_urls: true,\n        relative_urls: true,\n        remove_script_host: true,\n        object_resizing: true,\n        doctype: '<!DOCTYPE html>',\n        visual: true,\n        font_size_legacy_values: 'xx-small,small,medium,large,x-large,xx-large,300%',\n        forced_root_block: 'p',\n        hidden_input: true,\n        inline_styles: true,\n        convert_fonts_to_spans: true,\n        indent: true,\n        indent_before: 'p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,' + 'tfoot,tbody,tr,section,summary,article,hgroup,aside,figure,figcaption,option,optgroup,datalist',\n        indent_after: 'p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,' + 'tfoot,tbody,tr,section,summary,article,hgroup,aside,figure,figcaption,option,optgroup,datalist',\n        entity_encoding: 'named',\n        url_converter: editor.convertURL,\n        url_converter_scope: editor\n      };\n      return __assign(__assign({}, baseDefaults), isTouch ? defaultTouchSettings : {});\n    };\n    var getDefaultMobileSettings = function (mobileSettings, isPhone) {\n      var defaultMobileSettings = {\n        resize: false,\n        toolbar_mode: getToolbarMode(mobileSettings, 'scrolling'),\n        toolbar_sticky: false\n      };\n      var defaultPhoneSettings = { menubar: false };\n      return __assign(__assign(__assign({}, defaultTouchSettings), defaultMobileSettings), isPhone ? defaultPhoneSettings : {});\n    };\n    var getExternalPlugins$1 = function (overrideSettings, settings) {\n      var userDefinedExternalPlugins = settings.external_plugins ? settings.external_plugins : {};\n      if (overrideSettings && overrideSettings.external_plugins) {\n        return Tools.extend({}, overrideSettings.external_plugins, userDefinedExternalPlugins);\n      } else {\n        return userDefinedExternalPlugins;\n      }\n    };\n    var combinePlugins = function (forcedPlugins, plugins) {\n      return [].concat(normalizePlugins(forcedPlugins)).concat(normalizePlugins(plugins));\n    };\n    var processPlugins = function (isMobileDevice, sectionResult, defaultOverrideSettings, settings) {\n      var forcedPlugins = normalizePlugins(defaultOverrideSettings.forced_plugins);\n      var desktopPlugins = normalizePlugins(settings.plugins);\n      var mobileConfig = getSectionConfig(sectionResult, 'mobile');\n      var mobilePlugins = mobileConfig.plugins ? normalizePlugins(mobileConfig.plugins) : desktopPlugins;\n      var platformPlugins = isMobileDevice && isSectionTheme(sectionResult, 'mobile', 'mobile') ? filterLegacyMobilePlugins(mobilePlugins) : isMobileDevice && hasSection(sectionResult, 'mobile') ? mobilePlugins : desktopPlugins;\n      var combinedPlugins = combinePlugins(forcedPlugins, platformPlugins);\n      return Tools.extend(settings, { plugins: combinedPlugins.join(' ') });\n    };\n    var isOnMobile = function (isMobileDevice, sectionResult) {\n      return isMobileDevice && hasSection(sectionResult, 'mobile');\n    };\n    var combineSettings = function (isMobileDevice, isPhone, defaultSettings, defaultOverrideSettings, settings) {\n      var defaultDeviceSettings = isMobileDevice ? { mobile: getDefaultMobileSettings(settings.mobile || {}, isPhone) } : {};\n      var sectionResult = extractSections(['mobile'], deepMerge(defaultDeviceSettings, settings));\n      var extendedSettings = Tools.extend(defaultSettings, defaultOverrideSettings, sectionResult.settings(), isOnMobile(isMobileDevice, sectionResult) ? getSection(sectionResult, 'mobile') : {}, {\n        validate: true,\n        external_plugins: getExternalPlugins$1(defaultOverrideSettings, sectionResult.settings())\n      });\n      return processPlugins(isMobileDevice, sectionResult, defaultOverrideSettings, extendedSettings);\n    };\n    var getEditorSettings = function (editor, id, documentBaseUrl, defaultOverrideSettings, settings) {\n      var defaultSettings = getDefaultSettings(settings, id, documentBaseUrl, isTouch, editor);\n      return combineSettings(isPhone || isTablet, isPhone, defaultSettings, defaultOverrideSettings, settings);\n    };\n    var getFiltered = function (predicate, editor, name) {\n      return Optional.from(editor.settings[name]).filter(predicate);\n    };\n    var getParamObject = function (value) {\n      var output = {};\n      if (typeof value === 'string') {\n        each(value.indexOf('=') > 0 ? value.split(/[;,](?![^=;,]*(?:[;,]|$))/) : value.split(','), function (val) {\n          var arr = val.split('=');\n          if (arr.length > 1) {\n            output[Tools.trim(arr[0])] = Tools.trim(arr[1]);\n          } else {\n            output[Tools.trim(arr[0])] = Tools.trim(arr[0]);\n          }\n        });\n      } else {\n        output = value;\n      }\n      return output;\n    };\n    var isArrayOf = function (p) {\n      return function (a) {\n        return isArray(a) && forall(a, p);\n      };\n    };\n    var getParam = function (editor, name, defaultVal, type) {\n      var value = name in editor.settings ? editor.settings[name] : defaultVal;\n      if (type === 'hash') {\n        return getParamObject(value);\n      } else if (type === 'string') {\n        return getFiltered(isString, editor, name).getOr(defaultVal);\n      } else if (type === 'number') {\n        return getFiltered(isNumber, editor, name).getOr(defaultVal);\n      } else if (type === 'boolean') {\n        return getFiltered(isBoolean, editor, name).getOr(defaultVal);\n      } else if (type === 'object') {\n        return getFiltered(isObject, editor, name).getOr(defaultVal);\n      } else if (type === 'array') {\n        return getFiltered(isArray, editor, name).getOr(defaultVal);\n      } else if (type === 'string[]') {\n        return getFiltered(isArrayOf(isString), editor, name).getOr(defaultVal);\n      } else if (type === 'function') {\n        return getFiltered(isFunction, editor, name).getOr(defaultVal);\n      } else {\n        return value;\n      }\n    };\n\n    var CreateIconManager = function () {\n      var lookup = {};\n      var add = function (id, iconPack) {\n        lookup[id] = iconPack;\n      };\n      var get = function (id) {\n        if (lookup[id]) {\n          return lookup[id];\n        }\n        return { icons: {} };\n      };\n      var has$1 = function (id) {\n        return has(lookup, id);\n      };\n      return {\n        add: add,\n        get: get,\n        has: has$1\n      };\n    };\n    var IconManager = CreateIconManager();\n\n    var getProp = function (propName, elm) {\n      var rawElm = elm.dom;\n      return rawElm[propName];\n    };\n    var getComputedSizeProp = function (propName, elm) {\n      return parseInt(get$4(elm, propName), 10);\n    };\n    var getClientWidth = curry(getProp, 'clientWidth');\n    var getClientHeight = curry(getProp, 'clientHeight');\n    var getMarginTop = curry(getComputedSizeProp, 'margin-top');\n    var getMarginLeft = curry(getComputedSizeProp, 'margin-left');\n    var getBoundingClientRect$1 = function (elm) {\n      return elm.dom.getBoundingClientRect();\n    };\n    var isInsideElementContentArea = function (bodyElm, clientX, clientY) {\n      var clientWidth = getClientWidth(bodyElm);\n      var clientHeight = getClientHeight(bodyElm);\n      return clientX >= 0 && clientY >= 0 && clientX <= clientWidth && clientY <= clientHeight;\n    };\n    var transpose = function (inline, elm, clientX, clientY) {\n      var clientRect = getBoundingClientRect$1(elm);\n      var deltaX = inline ? clientRect.left + elm.dom.clientLeft + getMarginLeft(elm) : 0;\n      var deltaY = inline ? clientRect.top + elm.dom.clientTop + getMarginTop(elm) : 0;\n      var x = clientX - deltaX;\n      var y = clientY - deltaY;\n      return {\n        x: x,\n        y: y\n      };\n    };\n    var isXYInContentArea = function (editor, clientX, clientY) {\n      var bodyElm = SugarElement.fromDom(editor.getBody());\n      var targetElm = editor.inline ? bodyElm : documentElement(bodyElm);\n      var transposedPoint = transpose(editor.inline, targetElm, clientX, clientY);\n      return isInsideElementContentArea(targetElm, transposedPoint.x, transposedPoint.y);\n    };\n    var fromDomSafe = function (node) {\n      return Optional.from(node).map(SugarElement.fromDom);\n    };\n    var isEditorAttachedToDom = function (editor) {\n      var rawContainer = editor.inline ? editor.getBody() : editor.getContentAreaContainer();\n      return fromDomSafe(rawContainer).map(inBody).getOr(false);\n    };\n\n    function NotificationManagerImpl() {\n      var unimplemented = function () {\n        throw new Error('Theme did not provide a NotificationManager implementation.');\n      };\n      return {\n        open: unimplemented,\n        close: unimplemented,\n        reposition: unimplemented,\n        getArgs: unimplemented\n      };\n    }\n\n    function NotificationManager(editor) {\n      var notifications = [];\n      var getImplementation = function () {\n        var theme = editor.theme;\n        return theme && theme.getNotificationManagerImpl ? theme.getNotificationManagerImpl() : NotificationManagerImpl();\n      };\n      var getTopNotification = function () {\n        return Optional.from(notifications[0]);\n      };\n      var isEqual = function (a, b) {\n        return a.type === b.type && a.text === b.text && !a.progressBar && !a.timeout && !b.progressBar && !b.timeout;\n      };\n      var reposition = function () {\n        if (notifications.length > 0) {\n          getImplementation().reposition(notifications);\n        }\n      };\n      var addNotification = function (notification) {\n        notifications.push(notification);\n      };\n      var closeNotification = function (notification) {\n        findIndex(notifications, function (otherNotification) {\n          return otherNotification === notification;\n        }).each(function (index) {\n          notifications.splice(index, 1);\n        });\n      };\n      var open = function (spec) {\n        if (editor.removed || !isEditorAttachedToDom(editor)) {\n          return;\n        }\n        return find(notifications, function (notification) {\n          return isEqual(getImplementation().getArgs(notification), spec);\n        }).getOrThunk(function () {\n          editor.editorManager.setActive(editor);\n          var notification = getImplementation().open(spec, function () {\n            closeNotification(notification);\n            reposition();\n            getTopNotification().fold(function () {\n              return editor.focus();\n            }, function (top) {\n              return focus(SugarElement.fromDom(top.getEl()));\n            });\n          });\n          addNotification(notification);\n          reposition();\n          return notification;\n        });\n      };\n      var close = function () {\n        getTopNotification().each(function (notification) {\n          getImplementation().close(notification);\n          closeNotification(notification);\n          reposition();\n        });\n      };\n      var getNotifications = function () {\n        return notifications;\n      };\n      var registerEvents = function (editor) {\n        editor.on('SkinLoaded', function () {\n          var serviceMessage = getServiceMessage(editor);\n          if (serviceMessage) {\n            open({\n              text: serviceMessage,\n              type: 'warning',\n              timeout: 0\n            });\n          }\n        });\n        editor.on('ResizeEditor ResizeWindow NodeChange', function () {\n          Delay.requestAnimationFrame(reposition);\n        });\n        editor.on('remove', function () {\n          each(notifications.slice(), function (notification) {\n            getImplementation().close(notification);\n          });\n        });\n      };\n      registerEvents(editor);\n      return {\n        open: open,\n        close: close,\n        getNotifications: getNotifications\n      };\n    }\n\n    var PluginManager = AddOnManager$1.PluginManager;\n\n    var ThemeManager = AddOnManager$1.ThemeManager;\n\n    function WindowManagerImpl () {\n      var unimplemented = function () {\n        throw new Error('Theme did not provide a WindowManager implementation.');\n      };\n      return {\n        open: unimplemented,\n        openUrl: unimplemented,\n        alert: unimplemented,\n        confirm: unimplemented,\n        close: unimplemented,\n        getParams: unimplemented,\n        setParams: unimplemented\n      };\n    }\n\n    var WindowManager = function (editor) {\n      var dialogs = [];\n      var getImplementation = function () {\n        var theme = editor.theme;\n        return theme && theme.getWindowManagerImpl ? theme.getWindowManagerImpl() : WindowManagerImpl();\n      };\n      var funcBind = function (scope, f) {\n        return function () {\n          return f ? f.apply(scope, arguments) : undefined;\n        };\n      };\n      var fireOpenEvent = function (dialog) {\n        editor.fire('OpenWindow', { dialog: dialog });\n      };\n      var fireCloseEvent = function (dialog) {\n        editor.fire('CloseWindow', { dialog: dialog });\n      };\n      var addDialog = function (dialog) {\n        dialogs.push(dialog);\n        fireOpenEvent(dialog);\n      };\n      var closeDialog = function (dialog) {\n        fireCloseEvent(dialog);\n        dialogs = filter(dialogs, function (otherDialog) {\n          return otherDialog !== dialog;\n        });\n        if (dialogs.length === 0) {\n          editor.focus();\n        }\n      };\n      var getTopDialog = function () {\n        return Optional.from(dialogs[dialogs.length - 1]);\n      };\n      var storeSelectionAndOpenDialog = function (openDialog) {\n        editor.editorManager.setActive(editor);\n        store(editor);\n        var dialog = openDialog();\n        addDialog(dialog);\n        return dialog;\n      };\n      var open = function (args, params) {\n        return storeSelectionAndOpenDialog(function () {\n          return getImplementation().open(args, params, closeDialog);\n        });\n      };\n      var openUrl = function (args) {\n        return storeSelectionAndOpenDialog(function () {\n          return getImplementation().openUrl(args, closeDialog);\n        });\n      };\n      var alert = function (message, callback, scope) {\n        getImplementation().alert(message, funcBind(scope ? scope : this, callback));\n      };\n      var confirm = function (message, callback, scope) {\n        getImplementation().confirm(message, funcBind(scope ? scope : this, callback));\n      };\n      var close = function () {\n        getTopDialog().each(function (dialog) {\n          getImplementation().close(dialog);\n          closeDialog(dialog);\n        });\n      };\n      editor.on('remove', function () {\n        each(dialogs, function (dialog) {\n          getImplementation().close(dialog);\n        });\n      });\n      return {\n        open: open,\n        openUrl: openUrl,\n        alert: alert,\n        confirm: confirm,\n        close: close\n      };\n    };\n\n    var displayNotification = function (editor, message) {\n      editor.notificationManager.open({\n        type: 'error',\n        text: message\n      });\n    };\n    var displayError = function (editor, message) {\n      if (editor._skinLoaded) {\n        displayNotification(editor, message);\n      } else {\n        editor.on('SkinLoaded', function () {\n          displayNotification(editor, message);\n        });\n      }\n    };\n    var uploadError = function (editor, message) {\n      displayError(editor, I18n.translate([\n        'Failed to upload image: {0}',\n        message\n      ]));\n    };\n    var logError = function (editor, errorType, msg) {\n      fireError(editor, errorType, { message: msg });\n      console.error(msg);\n    };\n    var createLoadError = function (type, url, name) {\n      return name ? 'Failed to load ' + type + ': ' + name + ' from url ' + url : 'Failed to load ' + type + ' url: ' + url;\n    };\n    var pluginLoadError = function (editor, url, name) {\n      logError(editor, 'PluginLoadError', createLoadError('plugin', url, name));\n    };\n    var iconsLoadError = function (editor, url, name) {\n      logError(editor, 'IconsLoadError', createLoadError('icons', url, name));\n    };\n    var languageLoadError = function (editor, url, name) {\n      logError(editor, 'LanguageLoadError', createLoadError('language', url, name));\n    };\n    var pluginInitError = function (editor, name, err) {\n      var message = I18n.translate([\n        'Failed to initialize plugin: {0}',\n        name\n      ]);\n      initError(message, err);\n      displayError(editor, message);\n    };\n    var initError = function (message) {\n      var x = [];\n      for (var _i = 1; _i < arguments.length; _i++) {\n        x[_i - 1] = arguments[_i];\n      }\n      var console = window.console;\n      if (console) {\n        if (console.error) {\n          console.error.apply(console, __spreadArrays([message], x));\n        } else {\n          console.log.apply(console, __spreadArrays([message], x));\n        }\n      }\n    };\n\n    var isContentCssSkinName = function (url) {\n      return /^[a-z0-9\\-]+$/i.test(url);\n    };\n    var getContentCssUrls = function (editor) {\n      var contentCss = getContentCss(editor);\n      var skinUrl = editor.editorManager.baseURL + '/skins/content';\n      var suffix = editor.editorManager.suffix;\n      var contentCssFile = 'content' + suffix + '.css';\n      var inline = editor.inline === true;\n      return map(contentCss, function (url) {\n        if (isContentCssSkinName(url) && !inline) {\n          return skinUrl + '/' + url + '/' + contentCssFile;\n        } else {\n          return editor.documentBaseURI.toAbsolute(url);\n        }\n      });\n    };\n    var appendContentCssFromSettings = function (editor) {\n      editor.contentCSS = editor.contentCSS.concat(getContentCssUrls(editor));\n    };\n\n    function Uploader(uploadStatus, settings) {\n      var pendingPromises = {};\n      var pathJoin = function (path1, path2) {\n        if (path1) {\n          return path1.replace(/\\/$/, '') + '/' + path2.replace(/^\\//, '');\n        }\n        return path2;\n      };\n      var defaultHandler = function (blobInfo, success, failure, progress) {\n        var xhr = new XMLHttpRequest();\n        xhr.open('POST', settings.url);\n        xhr.withCredentials = settings.credentials;\n        xhr.upload.onprogress = function (e) {\n          progress(e.loaded / e.total * 100);\n        };\n        xhr.onerror = function () {\n          failure('Image upload failed due to a XHR Transport error. Code: ' + xhr.status);\n        };\n        xhr.onload = function () {\n          if (xhr.status < 200 || xhr.status >= 300) {\n            failure('HTTP Error: ' + xhr.status);\n            return;\n          }\n          var json = JSON.parse(xhr.responseText);\n          if (!json || typeof json.location !== 'string') {\n            failure('Invalid JSON: ' + xhr.responseText);\n            return;\n          }\n          success(pathJoin(settings.basePath, json.location));\n        };\n        var formData = new FormData();\n        formData.append('file', blobInfo.blob(), blobInfo.filename());\n        xhr.send(formData);\n      };\n      var noUpload = function () {\n        return new promiseObj(function (resolve) {\n          resolve([]);\n        });\n      };\n      var handlerSuccess = function (blobInfo, url) {\n        return {\n          url: url,\n          blobInfo: blobInfo,\n          status: true\n        };\n      };\n      var handlerFailure = function (blobInfo, message, options) {\n        return {\n          url: '',\n          blobInfo: blobInfo,\n          status: false,\n          error: {\n            message: message,\n            options: options\n          }\n        };\n      };\n      var resolvePending = function (blobUri, result) {\n        Tools.each(pendingPromises[blobUri], function (resolve) {\n          resolve(result);\n        });\n        delete pendingPromises[blobUri];\n      };\n      var uploadBlobInfo = function (blobInfo, handler, openNotification) {\n        uploadStatus.markPending(blobInfo.blobUri());\n        return new promiseObj(function (resolve) {\n          var notification, progress;\n          var noop = function () {\n          };\n          try {\n            var closeNotification_1 = function () {\n              if (notification) {\n                notification.close();\n                progress = noop;\n              }\n            };\n            var success = function (url) {\n              closeNotification_1();\n              uploadStatus.markUploaded(blobInfo.blobUri(), url);\n              resolvePending(blobInfo.blobUri(), handlerSuccess(blobInfo, url));\n              resolve(handlerSuccess(blobInfo, url));\n            };\n            var failure = function (error, options) {\n              var failureOptions = options ? options : {};\n              closeNotification_1();\n              uploadStatus.removeFailed(blobInfo.blobUri());\n              resolvePending(blobInfo.blobUri(), handlerFailure(blobInfo, error, failureOptions));\n              resolve(handlerFailure(blobInfo, error, failureOptions));\n            };\n            progress = function (percent) {\n              if (percent < 0 || percent > 100) {\n                return;\n              }\n              if (!notification) {\n                notification = openNotification();\n              }\n              notification.progressBar.value(percent);\n            };\n            handler(blobInfo, success, failure, progress);\n          } catch (ex) {\n            resolve(handlerFailure(blobInfo, ex.message, {}));\n          }\n        });\n      };\n      var isDefaultHandler = function (handler) {\n        return handler === defaultHandler;\n      };\n      var pendingUploadBlobInfo = function (blobInfo) {\n        var blobUri = blobInfo.blobUri();\n        return new promiseObj(function (resolve) {\n          pendingPromises[blobUri] = pendingPromises[blobUri] || [];\n          pendingPromises[blobUri].push(resolve);\n        });\n      };\n      var uploadBlobs = function (blobInfos, openNotification) {\n        blobInfos = Tools.grep(blobInfos, function (blobInfo) {\n          return !uploadStatus.isUploaded(blobInfo.blobUri());\n        });\n        return promiseObj.all(Tools.map(blobInfos, function (blobInfo) {\n          return uploadStatus.isPending(blobInfo.blobUri()) ? pendingUploadBlobInfo(blobInfo) : uploadBlobInfo(blobInfo, settings.handler, openNotification);\n        }));\n      };\n      var upload = function (blobInfos, openNotification) {\n        return !settings.url && isDefaultHandler(settings.handler) ? noUpload() : uploadBlobs(blobInfos, openNotification);\n      };\n      if (isFunction(settings.handler) === false) {\n        settings.handler = defaultHandler;\n      }\n      return { upload: upload };\n    }\n\n    function UploadStatus () {\n      var PENDING = 1, UPLOADED = 2;\n      var blobUriStatuses = {};\n      var createStatus = function (status, resultUri) {\n        return {\n          status: status,\n          resultUri: resultUri\n        };\n      };\n      var hasBlobUri = function (blobUri) {\n        return blobUri in blobUriStatuses;\n      };\n      var getResultUri = function (blobUri) {\n        var result = blobUriStatuses[blobUri];\n        return result ? result.resultUri : null;\n      };\n      var isPending = function (blobUri) {\n        return hasBlobUri(blobUri) ? blobUriStatuses[blobUri].status === PENDING : false;\n      };\n      var isUploaded = function (blobUri) {\n        return hasBlobUri(blobUri) ? blobUriStatuses[blobUri].status === UPLOADED : false;\n      };\n      var markPending = function (blobUri) {\n        blobUriStatuses[blobUri] = createStatus(PENDING, null);\n      };\n      var markUploaded = function (blobUri, resultUri) {\n        blobUriStatuses[blobUri] = createStatus(UPLOADED, resultUri);\n      };\n      var removeFailed = function (blobUri) {\n        delete blobUriStatuses[blobUri];\n      };\n      var destroy = function () {\n        blobUriStatuses = {};\n      };\n      return {\n        hasBlobUri: hasBlobUri,\n        getResultUri: getResultUri,\n        isPending: isPending,\n        isUploaded: isUploaded,\n        markPending: markPending,\n        markUploaded: markUploaded,\n        removeFailed: removeFailed,\n        destroy: destroy\n      };\n    }\n\n    var count$1 = 0;\n    var seed = function () {\n      var rnd = function () {\n        return Math.round(Math.random() * 4294967295).toString(36);\n      };\n      var now = new Date().getTime();\n      return 's' + now.toString(36) + rnd() + rnd() + rnd();\n    };\n    var uuid = function (prefix) {\n      return prefix + count$1++ + seed();\n    };\n\n    var BlobCache = function () {\n      var cache = [];\n      var mimeToExt = function (mime) {\n        var mimes = {\n          'image/jpeg': 'jpg',\n          'image/jpg': 'jpg',\n          'image/gif': 'gif',\n          'image/png': 'png'\n        };\n        return mimes[mime.toLowerCase()] || 'dat';\n      };\n      var create = function (o, blob, base64, filename) {\n        if (isString(o)) {\n          var id = o;\n          return toBlobInfo({\n            id: id,\n            name: filename,\n            blob: blob,\n            base64: base64\n          });\n        } else if (isObject(o)) {\n          return toBlobInfo(o);\n        } else {\n          throw new Error('Unknown input type');\n        }\n      };\n      var toBlobInfo = function (o) {\n        if (!o.blob || !o.base64) {\n          throw new Error('blob and base64 representations of the image are required for BlobInfo to be created');\n        }\n        var id = o.id || uuid('blobid');\n        var name = o.name || id;\n        return {\n          id: constant(id),\n          name: constant(name),\n          filename: constant(name + '.' + mimeToExt(o.blob.type)),\n          blob: constant(o.blob),\n          base64: constant(o.base64),\n          blobUri: constant(o.blobUri || URL.createObjectURL(o.blob)),\n          uri: constant(o.uri)\n        };\n      };\n      var add = function (blobInfo) {\n        if (!get(blobInfo.id())) {\n          cache.push(blobInfo);\n        }\n      };\n      var findFirst = function (predicate) {\n        return find(cache, predicate).getOrUndefined();\n      };\n      var get = function (id) {\n        return findFirst(function (cachedBlobInfo) {\n          return cachedBlobInfo.id() === id;\n        });\n      };\n      var getByUri = function (blobUri) {\n        return findFirst(function (blobInfo) {\n          return blobInfo.blobUri() === blobUri;\n        });\n      };\n      var getByData = function (base64, type) {\n        return findFirst(function (blobInfo) {\n          return blobInfo.base64() === base64 && blobInfo.blob().type === type;\n        });\n      };\n      var removeByUri = function (blobUri) {\n        cache = filter(cache, function (blobInfo) {\n          if (blobInfo.blobUri() === blobUri) {\n            URL.revokeObjectURL(blobInfo.blobUri());\n            return false;\n          }\n          return true;\n        });\n      };\n      var destroy = function () {\n        each(cache, function (cachedBlobInfo) {\n          URL.revokeObjectURL(cachedBlobInfo.blobUri());\n        });\n        cache = [];\n      };\n      return {\n        create: create,\n        add: add,\n        get: get,\n        getByUri: getByUri,\n        getByData: getByData,\n        findFirst: findFirst,\n        removeByUri: removeByUri,\n        destroy: destroy\n      };\n    };\n\n    var EditorUpload = function (editor) {\n      var blobCache = BlobCache();\n      var uploader, imageScanner;\n      var uploadStatus = UploadStatus();\n      var urlFilters = [];\n      var aliveGuard = function (callback) {\n        return function (result) {\n          if (editor.selection) {\n            return callback(result);\n          }\n          return [];\n        };\n      };\n      var cacheInvalidator = function (url) {\n        return url + (url.indexOf('?') === -1 ? '?' : '&') + new Date().getTime();\n      };\n      var replaceString = function (content, search, replace) {\n        var index = 0;\n        do {\n          index = content.indexOf(search, index);\n          if (index !== -1) {\n            content = content.substring(0, index) + replace + content.substr(index + search.length);\n            index += replace.length - search.length + 1;\n          }\n        } while (index !== -1);\n        return content;\n      };\n      var replaceImageUrl = function (content, targetUrl, replacementUrl) {\n        var replacementString = 'src=\"' + replacementUrl + '\"' + (replacementUrl === Env.transparentSrc ? ' data-mce-placeholder=\"1\"' : '');\n        content = replaceString(content, 'src=\"' + targetUrl + '\"', replacementString);\n        content = replaceString(content, 'data-mce-src=\"' + targetUrl + '\"', 'data-mce-src=\"' + replacementUrl + '\"');\n        return content;\n      };\n      var replaceUrlInUndoStack = function (targetUrl, replacementUrl) {\n        each(editor.undoManager.data, function (level) {\n          if (level.type === 'fragmented') {\n            level.fragments = map(level.fragments, function (fragment) {\n              return replaceImageUrl(fragment, targetUrl, replacementUrl);\n            });\n          } else {\n            level.content = replaceImageUrl(level.content, targetUrl, replacementUrl);\n          }\n        });\n      };\n      var openNotification = function () {\n        return editor.notificationManager.open({\n          text: editor.translate('Image uploading...'),\n          type: 'info',\n          timeout: -1,\n          progressBar: true\n        });\n      };\n      var replaceImageUriInView = function (image, resultUri) {\n        var src = editor.convertURL(resultUri, 'src');\n        replaceUrlInUndoStack(image.src, resultUri);\n        editor.$(image).attr({\n          'src': shouldReuseFileName(editor) ? cacheInvalidator(resultUri) : resultUri,\n          'data-mce-src': src\n        });\n      };\n      var uploadImages = function (callback) {\n        if (!uploader) {\n          uploader = Uploader(uploadStatus, {\n            url: getImageUploadUrl(editor),\n            basePath: getImageUploadBasePath(editor),\n            credentials: getImagesUploadCredentials(editor),\n            handler: getImagesUploadHandler(editor)\n          });\n        }\n        return scanForImages().then(aliveGuard(function (imageInfos) {\n          var blobInfos = map(imageInfos, function (imageInfo) {\n            return imageInfo.blobInfo;\n          });\n          return uploader.upload(blobInfos, openNotification).then(aliveGuard(function (result) {\n            var imagesToRemove = [];\n            var filteredResult = map(result, function (uploadInfo, index) {\n              var blobInfo = imageInfos[index].blobInfo;\n              var image = imageInfos[index].image;\n              if (uploadInfo.status && shouldReplaceBlobUris(editor)) {\n                blobCache.removeByUri(image.src);\n                replaceImageUriInView(image, uploadInfo.url);\n              } else if (uploadInfo.error) {\n                if (uploadInfo.error.options.remove) {\n                  replaceUrlInUndoStack(image.getAttribute('src'), Env.transparentSrc);\n                  imagesToRemove.push(image);\n                }\n                uploadError(editor, uploadInfo.error.message);\n              }\n              return {\n                element: image,\n                status: uploadInfo.status,\n                uploadUri: uploadInfo.url,\n                blobInfo: blobInfo\n              };\n            });\n            if (imagesToRemove.length > 0) {\n              if (isRtc(editor)) {\n                console.error('Removing images on failed uploads is currently unsupported for RTC');\n              } else {\n                editor.undoManager.transact(function () {\n                  each(imagesToRemove, function (element) {\n                    editor.dom.remove(element);\n                    blobCache.removeByUri(element.src);\n                  });\n                });\n              }\n            }\n            if (callback) {\n              callback(filteredResult);\n            }\n            return filteredResult;\n          }));\n        }));\n      };\n      var uploadImagesAuto = function (callback) {\n        if (isAutomaticUploadsEnabled(editor)) {\n          return uploadImages(callback);\n        }\n      };\n      var isValidDataUriImage = function (imgElm) {\n        if (forall(urlFilters, function (filter) {\n            return filter(imgElm);\n          }) === false) {\n          return false;\n        }\n        if (imgElm.getAttribute('src').indexOf('data:') === 0) {\n          var dataImgFilter = getImagesDataImgFilter(editor);\n          return dataImgFilter(imgElm);\n        }\n        return true;\n      };\n      var addFilter = function (filter) {\n        urlFilters.push(filter);\n      };\n      var scanForImages = function () {\n        if (!imageScanner) {\n          imageScanner = ImageScanner(uploadStatus, blobCache);\n        }\n        return imageScanner.findAll(editor.getBody(), isValidDataUriImage).then(aliveGuard(function (result) {\n          result = filter(result, function (resultItem) {\n            if (typeof resultItem === 'string') {\n              displayError(editor, resultItem);\n              return false;\n            }\n            return true;\n          });\n          each(result, function (resultItem) {\n            replaceUrlInUndoStack(resultItem.image.src, resultItem.blobInfo.blobUri());\n            resultItem.image.src = resultItem.blobInfo.blobUri();\n            resultItem.image.removeAttribute('data-mce-src');\n          });\n          return result;\n        }));\n      };\n      var destroy = function () {\n        blobCache.destroy();\n        uploadStatus.destroy();\n        imageScanner = uploader = null;\n      };\n      var replaceBlobUris = function (content) {\n        return content.replace(/src=\"(blob:[^\"]+)\"/g, function (match, blobUri) {\n          var resultUri = uploadStatus.getResultUri(blobUri);\n          if (resultUri) {\n            return 'src=\"' + resultUri + '\"';\n          }\n          var blobInfo = blobCache.getByUri(blobUri);\n          if (!blobInfo) {\n            blobInfo = foldl(editor.editorManager.get(), function (result, editor) {\n              return result || editor.editorUpload && editor.editorUpload.blobCache.getByUri(blobUri);\n            }, null);\n          }\n          if (blobInfo) {\n            var blob = blobInfo.blob();\n            return 'src=\"data:' + blob.type + ';base64,' + blobInfo.base64() + '\"';\n          }\n          return match;\n        });\n      };\n      editor.on('SetContent', function () {\n        if (isAutomaticUploadsEnabled(editor)) {\n          uploadImagesAuto();\n        } else {\n          scanForImages();\n        }\n      });\n      editor.on('RawSaveContent', function (e) {\n        e.content = replaceBlobUris(e.content);\n      });\n      editor.on('GetContent', function (e) {\n        if (e.source_view || e.format === 'raw') {\n          return;\n        }\n        e.content = replaceBlobUris(e.content);\n      });\n      editor.on('PostRender', function () {\n        editor.parser.addNodeFilter('img', function (images) {\n          each(images, function (img) {\n            var src = img.attr('src');\n            if (blobCache.getByUri(src)) {\n              return;\n            }\n            var resultUri = uploadStatus.getResultUri(src);\n            if (resultUri) {\n              img.attr('src', resultUri);\n            }\n          });\n        });\n      });\n      return {\n        blobCache: blobCache,\n        addFilter: addFilter,\n        uploadImages: uploadImages,\n        uploadImagesAuto: uploadImagesAuto,\n        scanForImages: scanForImages,\n        destroy: destroy\n      };\n    };\n\n    var setup$5 = function (registeredFormatListeners, editor) {\n      var currentFormats = Cell({});\n      registeredFormatListeners.set({});\n      editor.on('NodeChange', function (e) {\n        updateAndFireChangeCallbacks(editor, e.element, currentFormats, registeredFormatListeners.get());\n      });\n    };\n    var updateAndFireChangeCallbacks = function (editor, elm, currentFormats, formatChangeData) {\n      var formatsList = keys(currentFormats.get());\n      var newFormats = {};\n      var matchedFormats = {};\n      var parents = filter(getParents$1(editor.dom, elm), function (node) {\n        return node.nodeType === 1 && !node.getAttribute('data-mce-bogus');\n      });\n      each$1(formatChangeData, function (data, format) {\n        Tools.each(parents, function (node) {\n          if (editor.formatter.matchNode(node, format, {}, data.similar)) {\n            if (formatsList.indexOf(format) === -1) {\n              each(data.callbacks, function (callback) {\n                callback(true, {\n                  node: node,\n                  format: format,\n                  parents: parents\n                });\n              });\n              newFormats[format] = data.callbacks;\n            }\n            matchedFormats[format] = data.callbacks;\n            return false;\n          }\n          if (matchesUnInheritedFormatSelector(editor, node, format)) {\n            return false;\n          }\n        });\n      });\n      var remainingFormats = filterRemainingFormats(currentFormats.get(), matchedFormats, elm, parents);\n      currentFormats.set(__assign(__assign({}, newFormats), remainingFormats));\n    };\n    var filterRemainingFormats = function (currentFormats, matchedFormats, elm, parents) {\n      return bifilter(currentFormats, function (callbacks, format) {\n        if (!has(matchedFormats, format)) {\n          each(callbacks, function (callback) {\n            callback(false, {\n              node: elm,\n              format: format,\n              parents: parents\n            });\n          });\n          return false;\n        } else {\n          return true;\n        }\n      }).t;\n    };\n    var addListeners = function (registeredFormatListeners, formats, callback, similar) {\n      var formatChangeItems = registeredFormatListeners.get();\n      each(formats.split(','), function (format) {\n        if (!formatChangeItems[format]) {\n          formatChangeItems[format] = {\n            similar: similar,\n            callbacks: []\n          };\n        }\n        formatChangeItems[format].callbacks.push(callback);\n      });\n      registeredFormatListeners.set(formatChangeItems);\n    };\n    var removeListeners = function (registeredFormatListeners, formats, callback) {\n      var formatChangeItems = registeredFormatListeners.get();\n      each(formats.split(','), function (format) {\n        formatChangeItems[format].callbacks = filter(formatChangeItems[format].callbacks, function (c) {\n          return c !== callback;\n        });\n        if (formatChangeItems[format].callbacks.length === 0) {\n          delete formatChangeItems[format];\n        }\n      });\n      registeredFormatListeners.set(formatChangeItems);\n    };\n    var formatChanged = function (editor, registeredFormatListeners, formats, callback, similar) {\n      if (registeredFormatListeners.get() === null) {\n        setup$5(registeredFormatListeners, editor);\n      }\n      addListeners(registeredFormatListeners, formats, callback, similar);\n      return {\n        unbind: function () {\n          return removeListeners(registeredFormatListeners, formats, callback);\n        }\n      };\n    };\n\n    var get$9 = function (dom) {\n      var formats = {\n        valigntop: [{\n            selector: 'td,th',\n            styles: { verticalAlign: 'top' }\n          }],\n        valignmiddle: [{\n            selector: 'td,th',\n            styles: { verticalAlign: 'middle' }\n          }],\n        valignbottom: [{\n            selector: 'td,th',\n            styles: { verticalAlign: 'bottom' }\n          }],\n        alignleft: [\n          {\n            selector: 'figure.image',\n            collapsed: false,\n            classes: 'align-left',\n            ceFalseOverride: true,\n            preview: 'font-family font-size'\n          },\n          {\n            selector: 'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',\n            styles: { textAlign: 'left' },\n            inherit: false,\n            preview: false,\n            defaultBlock: 'div'\n          },\n          {\n            selector: 'img,table',\n            collapsed: false,\n            styles: { float: 'left' },\n            preview: 'font-family font-size'\n          }\n        ],\n        aligncenter: [\n          {\n            selector: 'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',\n            styles: { textAlign: 'center' },\n            inherit: false,\n            preview: 'font-family font-size',\n            defaultBlock: 'div'\n          },\n          {\n            selector: 'figure.image',\n            collapsed: false,\n            classes: 'align-center',\n            ceFalseOverride: true,\n            preview: 'font-family font-size'\n          },\n          {\n            selector: 'img',\n            collapsed: false,\n            styles: {\n              display: 'block',\n              marginLeft: 'auto',\n              marginRight: 'auto'\n            },\n            preview: false\n          },\n          {\n            selector: 'table',\n            collapsed: false,\n            styles: {\n              marginLeft: 'auto',\n              marginRight: 'auto'\n            },\n            preview: 'font-family font-size'\n          }\n        ],\n        alignright: [\n          {\n            selector: 'figure.image',\n            collapsed: false,\n            classes: 'align-right',\n            ceFalseOverride: true,\n            preview: 'font-family font-size'\n          },\n          {\n            selector: 'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',\n            styles: { textAlign: 'right' },\n            inherit: false,\n            preview: 'font-family font-size',\n            defaultBlock: 'div'\n          },\n          {\n            selector: 'img,table',\n            collapsed: false,\n            styles: { float: 'right' },\n            preview: 'font-family font-size'\n          }\n        ],\n        alignjustify: [{\n            selector: 'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',\n            styles: { textAlign: 'justify' },\n            inherit: false,\n            defaultBlock: 'div',\n            preview: 'font-family font-size'\n          }],\n        bold: [\n          {\n            inline: 'strong',\n            remove: 'all',\n            preserve_attributes: [\n              'class',\n              'style'\n            ]\n          },\n          {\n            inline: 'span',\n            styles: { fontWeight: 'bold' }\n          },\n          {\n            inline: 'b',\n            remove: 'all',\n            preserve_attributes: [\n              'class',\n              'style'\n            ]\n          }\n        ],\n        italic: [\n          {\n            inline: 'em',\n            remove: 'all',\n            preserve_attributes: [\n              'class',\n              'style'\n            ]\n          },\n          {\n            inline: 'span',\n            styles: { fontStyle: 'italic' }\n          },\n          {\n            inline: 'i',\n            remove: 'all',\n            preserve_attributes: [\n              'class',\n              'style'\n            ]\n          }\n        ],\n        underline: [\n          {\n            inline: 'span',\n            styles: { textDecoration: 'underline' },\n            exact: true\n          },\n          {\n            inline: 'u',\n            remove: 'all',\n            preserve_attributes: [\n              'class',\n              'style'\n            ]\n          }\n        ],\n        strikethrough: [\n          {\n            inline: 'span',\n            styles: { textDecoration: 'line-through' },\n            exact: true\n          },\n          {\n            inline: 'strike',\n            remove: 'all',\n            preserve_attributes: [\n              'class',\n              'style'\n            ]\n          }\n        ],\n        forecolor: {\n          inline: 'span',\n          styles: { color: '%value' },\n          links: true,\n          remove_similar: true,\n          clear_child_styles: true\n        },\n        hilitecolor: {\n          inline: 'span',\n          styles: { backgroundColor: '%value' },\n          links: true,\n          remove_similar: true,\n          clear_child_styles: true\n        },\n        fontname: {\n          inline: 'span',\n          toggle: false,\n          styles: { fontFamily: '%value' },\n          clear_child_styles: true\n        },\n        fontsize: {\n          inline: 'span',\n          toggle: false,\n          styles: { fontSize: '%value' },\n          clear_child_styles: true\n        },\n        lineheight: {\n          selector: 'h1,h2,h3,h4,h5,h6,p,li,td,th,div',\n          defaultBlock: 'p',\n          styles: { lineHeight: '%value' }\n        },\n        fontsize_class: {\n          inline: 'span',\n          attributes: { class: '%value' }\n        },\n        blockquote: {\n          block: 'blockquote',\n          wrapper: true,\n          remove: 'all'\n        },\n        subscript: { inline: 'sub' },\n        superscript: { inline: 'sup' },\n        code: { inline: 'code' },\n        link: {\n          inline: 'a',\n          selector: 'a',\n          remove: 'all',\n          split: true,\n          deep: true,\n          onmatch: function (node, _fmt, _itemName) {\n            return isElement$1(node) && node.hasAttribute('href');\n          },\n          onformat: function (elm, _fmt, vars) {\n            Tools.each(vars, function (value, key) {\n              dom.setAttrib(elm, key, value);\n            });\n          }\n        },\n        removeformat: [\n          {\n            selector: 'b,strong,em,i,font,u,strike,sub,sup,dfn,code,samp,kbd,var,cite,mark,q,del,ins',\n            remove: 'all',\n            split: true,\n            expand: false,\n            block_expand: true,\n            deep: true\n          },\n          {\n            selector: 'span',\n            attributes: [\n              'style',\n              'class'\n            ],\n            remove: 'empty',\n            split: true,\n            expand: false,\n            deep: true\n          },\n          {\n            selector: '*',\n            attributes: [\n              'style',\n              'class'\n            ],\n            split: false,\n            expand: false,\n            deep: true\n          }\n        ]\n      };\n      Tools.each('p h1 h2 h3 h4 h5 h6 div address pre div dt dd samp'.split(/\\s/), function (name) {\n        formats[name] = {\n          block: name,\n          remove: 'all'\n        };\n      });\n      return formats;\n    };\n\n    function FormatRegistry(editor) {\n      var formats = {};\n      var get = function (name) {\n        return name ? formats[name] : formats;\n      };\n      var has$1 = function (name) {\n        return has(formats, name);\n      };\n      var register = function (name, format) {\n        if (name) {\n          if (typeof name !== 'string') {\n            Tools.each(name, function (format, name) {\n              register(name, format);\n            });\n          } else {\n            if (!isArray(format)) {\n              format = [format];\n            }\n            Tools.each(format, function (format) {\n              if (typeof format.deep === 'undefined') {\n                format.deep = !format.selector;\n              }\n              if (typeof format.split === 'undefined') {\n                format.split = !format.selector || format.inline;\n              }\n              if (typeof format.remove === 'undefined' && format.selector && !format.inline) {\n                format.remove = 'none';\n              }\n              if (format.selector && format.inline) {\n                format.mixed = true;\n                format.block_expand = true;\n              }\n              if (typeof format.classes === 'string') {\n                format.classes = format.classes.split(/\\s+/);\n              }\n            });\n            formats[name] = format;\n          }\n        }\n      };\n      var unregister = function (name) {\n        if (name && formats[name]) {\n          delete formats[name];\n        }\n        return formats;\n      };\n      register(get$9(editor.dom));\n      register(getFormats(editor));\n      return {\n        get: get,\n        has: has$1,\n        register: register,\n        unregister: unregister\n      };\n    }\n\n    var each$e = Tools.each;\n    var dom = DOMUtils$1.DOM;\n    var parsedSelectorToHtml = function (ancestry, editor) {\n      var elm, item, fragment;\n      var schema = editor && editor.schema || Schema({});\n      var decorate = function (elm, item) {\n        if (item.classes.length) {\n          dom.addClass(elm, item.classes.join(' '));\n        }\n        dom.setAttribs(elm, item.attrs);\n      };\n      var createElement = function (sItem) {\n        item = typeof sItem === 'string' ? {\n          name: sItem,\n          classes: [],\n          attrs: {}\n        } : sItem;\n        var elm = dom.create(item.name);\n        decorate(elm, item);\n        return elm;\n      };\n      var getRequiredParent = function (elm, candidate) {\n        var name = typeof elm !== 'string' ? elm.nodeName.toLowerCase() : elm;\n        var elmRule = schema.getElementRule(name);\n        var parentsRequired = elmRule && elmRule.parentsRequired;\n        if (parentsRequired && parentsRequired.length) {\n          return candidate && Tools.inArray(parentsRequired, candidate) !== -1 ? candidate : parentsRequired[0];\n        } else {\n          return false;\n        }\n      };\n      var wrapInHtml = function (elm, ancestry, siblings) {\n        var parent, parentCandidate;\n        var ancestor = ancestry.length > 0 && ancestry[0];\n        var ancestorName = ancestor && ancestor.name;\n        var parentRequired = getRequiredParent(elm, ancestorName);\n        if (parentRequired) {\n          if (ancestorName === parentRequired) {\n            parentCandidate = ancestry[0];\n            ancestry = ancestry.slice(1);\n          } else {\n            parentCandidate = parentRequired;\n          }\n        } else if (ancestor) {\n          parentCandidate = ancestry[0];\n          ancestry = ancestry.slice(1);\n        } else if (!siblings) {\n          return elm;\n        }\n        if (parentCandidate) {\n          parent = createElement(parentCandidate);\n          parent.appendChild(elm);\n        }\n        if (siblings) {\n          if (!parent) {\n            parent = dom.create('div');\n            parent.appendChild(elm);\n          }\n          Tools.each(siblings, function (sibling) {\n            var siblingElm = createElement(sibling);\n            parent.insertBefore(siblingElm, elm);\n          });\n        }\n        return wrapInHtml(parent, ancestry, parentCandidate && parentCandidate.siblings);\n      };\n      if (ancestry && ancestry.length) {\n        item = ancestry[0];\n        elm = createElement(item);\n        fragment = dom.create('div');\n        fragment.appendChild(wrapInHtml(elm, ancestry.slice(1), item.siblings));\n        return fragment;\n      } else {\n        return '';\n      }\n    };\n    var parseSelectorItem = function (item) {\n      var tagName;\n      var obj = {\n        classes: [],\n        attrs: {}\n      };\n      item = obj.selector = Tools.trim(item);\n      if (item !== '*') {\n        tagName = item.replace(/(?:([#\\.]|::?)([\\w\\-]+)|(\\[)([^\\]]+)\\]?)/g, function ($0, $1, $2, $3, $4) {\n          switch ($1) {\n          case '#':\n            obj.attrs.id = $2;\n            break;\n          case '.':\n            obj.classes.push($2);\n            break;\n          case ':':\n            if (Tools.inArray('checked disabled enabled read-only required'.split(' '), $2) !== -1) {\n              obj.attrs[$2] = $2;\n            }\n            break;\n          }\n          if ($3 === '[') {\n            var m = $4.match(/([\\w\\-]+)(?:\\=\\\"([^\\\"]+))?/);\n            if (m) {\n              obj.attrs[m[1]] = m[2];\n            }\n          }\n          return '';\n        });\n      }\n      obj.name = tagName || 'div';\n      return obj;\n    };\n    var parseSelector = function (selector) {\n      if (!selector || typeof selector !== 'string') {\n        return [];\n      }\n      selector = selector.split(/\\s*,\\s*/)[0];\n      selector = selector.replace(/\\s*(~\\+|~|\\+|>)\\s*/g, '$1');\n      return Tools.map(selector.split(/(?:>|\\s+(?![^\\[\\]]+\\]))/), function (item) {\n        var siblings = Tools.map(item.split(/(?:~\\+|~|\\+)/), parseSelectorItem);\n        var obj = siblings.pop();\n        if (siblings.length) {\n          obj.siblings = siblings;\n        }\n        return obj;\n      }).reverse();\n    };\n    var getCssText = function (editor, format) {\n      var name, previewFrag;\n      var previewCss = '', parentFontSize;\n      var previewStyles = getPreviewStyles(editor);\n      if (previewStyles === '') {\n        return '';\n      }\n      var removeVars = function (val) {\n        return val.replace(/%(\\w+)/g, '');\n      };\n      if (typeof format === 'string') {\n        format = editor.formatter.get(format);\n        if (!format) {\n          return;\n        }\n        format = format[0];\n      }\n      if ('preview' in format) {\n        var previewOpt = get(format, 'preview');\n        if (previewOpt.is(false)) {\n          return '';\n        } else {\n          previewStyles = previewOpt.getOr(previewStyles);\n        }\n      }\n      name = format.block || format.inline || 'span';\n      var items = parseSelector(format.selector);\n      if (items.length) {\n        if (!items[0].name) {\n          items[0].name = name;\n        }\n        name = format.selector;\n        previewFrag = parsedSelectorToHtml(items, editor);\n      } else {\n        previewFrag = parsedSelectorToHtml([name], editor);\n      }\n      var previewElm = dom.select(name, previewFrag)[0] || previewFrag.firstChild;\n      each$e(format.styles, function (value, name) {\n        var newValue = removeVars(value);\n        if (newValue) {\n          dom.setStyle(previewElm, name, newValue);\n        }\n      });\n      each$e(format.attributes, function (value, name) {\n        var newValue = removeVars(value);\n        if (newValue) {\n          dom.setAttrib(previewElm, name, newValue);\n        }\n      });\n      each$e(format.classes, function (value) {\n        var newValue = removeVars(value);\n        if (!dom.hasClass(previewElm, newValue)) {\n          dom.addClass(previewElm, newValue);\n        }\n      });\n      editor.fire('PreviewFormats');\n      dom.setStyles(previewFrag, {\n        position: 'absolute',\n        left: -65535\n      });\n      editor.getBody().appendChild(previewFrag);\n      parentFontSize = dom.getStyle(editor.getBody(), 'fontSize', true);\n      parentFontSize = /px$/.test(parentFontSize) ? parseInt(parentFontSize, 10) : 0;\n      each$e(previewStyles.split(' '), function (name) {\n        var value = dom.getStyle(previewElm, name, true);\n        if (name === 'background-color' && /transparent|rgba\\s*\\([^)]+,\\s*0\\)/.test(value)) {\n          value = dom.getStyle(editor.getBody(), name, true);\n          if (dom.toHex(value).toLowerCase() === '#ffffff') {\n            return;\n          }\n        }\n        if (name === 'color') {\n          if (dom.toHex(value).toLowerCase() === '#000000') {\n            return;\n          }\n        }\n        if (name === 'font-size') {\n          if (/em|%$/.test(value)) {\n            if (parentFontSize === 0) {\n              return;\n            }\n            var numValue = parseFloat(value) / (/%$/.test(value) ? 100 : 1);\n            value = numValue * parentFontSize + 'px';\n          }\n        }\n        if (name === 'border' && value) {\n          previewCss += 'padding:0 2px;';\n        }\n        previewCss += name + ':' + value + ';';\n      });\n      editor.fire('AfterPreviewFormats');\n      dom.remove(previewFrag);\n      return previewCss;\n    };\n\n    var setup$6 = function (editor) {\n      editor.addShortcut('meta+b', '', 'Bold');\n      editor.addShortcut('meta+i', '', 'Italic');\n      editor.addShortcut('meta+u', '', 'Underline');\n      for (var i = 1; i <= 6; i++) {\n        editor.addShortcut('access+' + i, '', [\n          'FormatBlock',\n          false,\n          'h' + i\n        ]);\n      }\n      editor.addShortcut('access+7', '', [\n        'FormatBlock',\n        false,\n        'p'\n      ]);\n      editor.addShortcut('access+8', '', [\n        'FormatBlock',\n        false,\n        'div'\n      ]);\n      editor.addShortcut('access+9', '', [\n        'FormatBlock',\n        false,\n        'address'\n      ]);\n    };\n\n    var Formatter = function (editor) {\n      var formats = FormatRegistry(editor);\n      var formatChangeState = Cell(null);\n      setup$6(editor);\n      setup$3(editor);\n      return {\n        get: formats.get,\n        has: formats.has,\n        register: formats.register,\n        unregister: formats.unregister,\n        apply: function (name, vars, node) {\n          applyFormat$1(editor, name, vars, node);\n        },\n        remove: function (name, vars, node, similar) {\n          removeFormat$1(editor, name, vars, node, similar);\n        },\n        toggle: function (name, vars, node) {\n          toggleFormat(editor, name, vars, node);\n        },\n        match: curry(match, editor),\n        matchAll: curry(matchAll, editor),\n        matchNode: curry(matchNode, editor),\n        canApply: curry(canApply, editor),\n        formatChanged: curry(formatChanged, editor, formatChangeState),\n        getCssText: curry(getCssText, editor)\n      };\n    };\n\n    var registerEvents$1 = function (editor, undoManager, locks) {\n      var isFirstTypedCharacter = Cell(false);\n      var addNonTypingUndoLevel = function (e) {\n        setTyping(undoManager, false, locks);\n        undoManager.add({}, e);\n      };\n      editor.on('init', function () {\n        undoManager.add();\n      });\n      editor.on('BeforeExecCommand', function (e) {\n        var cmd = e.command.toLowerCase();\n        if (cmd !== 'undo' && cmd !== 'redo' && cmd !== 'mcerepaint') {\n          endTyping(undoManager, locks);\n          undoManager.beforeChange();\n        }\n      });\n      editor.on('ExecCommand', function (e) {\n        var cmd = e.command.toLowerCase();\n        if (cmd !== 'undo' && cmd !== 'redo' && cmd !== 'mcerepaint') {\n          addNonTypingUndoLevel(e);\n        }\n      });\n      editor.on('ObjectResizeStart cut', function () {\n        undoManager.beforeChange();\n      });\n      editor.on('SaveContent ObjectResized blur', addNonTypingUndoLevel);\n      editor.on('dragend', addNonTypingUndoLevel);\n      editor.on('keyup', function (e) {\n        var keyCode = e.keyCode;\n        if (e.isDefaultPrevented()) {\n          return;\n        }\n        if (keyCode >= 33 && keyCode <= 36 || keyCode >= 37 && keyCode <= 40 || keyCode === 45 || e.ctrlKey) {\n          addNonTypingUndoLevel();\n          editor.nodeChanged();\n        }\n        if (keyCode === 46 || keyCode === 8) {\n          editor.nodeChanged();\n        }\n        if (isFirstTypedCharacter.get() && undoManager.typing && isEq$4(createFromEditor(editor), undoManager.data[0]) === false) {\n          if (editor.isDirty() === false) {\n            editor.setDirty(true);\n            editor.fire('change', {\n              level: undoManager.data[0],\n              lastLevel: null\n            });\n          }\n          editor.fire('TypingUndo');\n          isFirstTypedCharacter.set(false);\n          editor.nodeChanged();\n        }\n      });\n      editor.on('keydown', function (e) {\n        var keyCode = e.keyCode;\n        if (e.isDefaultPrevented()) {\n          return;\n        }\n        if (keyCode >= 33 && keyCode <= 36 || keyCode >= 37 && keyCode <= 40 || keyCode === 45) {\n          if (undoManager.typing) {\n            addNonTypingUndoLevel(e);\n          }\n          return;\n        }\n        var modKey = e.ctrlKey && !e.altKey || e.metaKey;\n        if ((keyCode < 16 || keyCode > 20) && keyCode !== 224 && keyCode !== 91 && !undoManager.typing && !modKey) {\n          undoManager.beforeChange();\n          setTyping(undoManager, true, locks);\n          undoManager.add({}, e);\n          isFirstTypedCharacter.set(true);\n        }\n      });\n      editor.on('mousedown', function (e) {\n        if (undoManager.typing) {\n          addNonTypingUndoLevel(e);\n        }\n      });\n      var isInsertReplacementText = function (event) {\n        return event.inputType === 'insertReplacementText';\n      };\n      var isInsertTextDataNull = function (event) {\n        return event.inputType === 'insertText' && event.data === null;\n      };\n      var isInsertFromPasteOrDrop = function (event) {\n        return event.inputType === 'insertFromPaste' || event.inputType === 'insertFromDrop';\n      };\n      editor.on('input', function (e) {\n        if (e.inputType && (isInsertReplacementText(e) || isInsertTextDataNull(e) || isInsertFromPasteOrDrop(e))) {\n          addNonTypingUndoLevel(e);\n        }\n      });\n      editor.on('AddUndo Undo Redo ClearUndos', function (e) {\n        if (!e.isDefaultPrevented()) {\n          editor.nodeChanged();\n        }\n      });\n    };\n    var addKeyboardShortcuts = function (editor) {\n      editor.addShortcut('meta+z', '', 'Undo');\n      editor.addShortcut('meta+y,meta+shift+z', '', 'Redo');\n    };\n\n    var UndoManager = function (editor) {\n      var beforeBookmark = Cell(Optional.none());\n      var locks = Cell(0);\n      var index = Cell(0);\n      var undoManager = {\n        data: [],\n        typing: false,\n        beforeChange: function () {\n          beforeChange$1(editor, locks, beforeBookmark);\n        },\n        add: function (level, event) {\n          return addUndoLevel$1(editor, undoManager, index, locks, beforeBookmark, level, event);\n        },\n        undo: function () {\n          return undo$1(editor, undoManager, locks, index);\n        },\n        redo: function () {\n          return redo$1(editor, index, undoManager.data);\n        },\n        clear: function () {\n          clear$1(editor, undoManager, index);\n        },\n        reset: function () {\n          reset$1(editor, undoManager);\n        },\n        hasUndo: function () {\n          return hasUndo$1(editor, undoManager, index);\n        },\n        hasRedo: function () {\n          return hasRedo$1(editor, undoManager, index);\n        },\n        transact: function (callback) {\n          return transact$1(editor, undoManager, locks, callback);\n        },\n        ignore: function (callback) {\n          ignore$1(editor, locks, callback);\n        },\n        extra: function (callback1, callback2) {\n          extra$1(editor, undoManager, index, callback1, callback2);\n        }\n      };\n      if (!isRtc(editor)) {\n        registerEvents$1(editor, undoManager, locks);\n      }\n      addKeyboardShortcuts(editor);\n      return undoManager;\n    };\n\n    var nonTypingKeycodes = [\n      9,\n      27,\n      VK.HOME,\n      VK.END,\n      19,\n      20,\n      44,\n      144,\n      145,\n      33,\n      34,\n      45,\n      16,\n      17,\n      18,\n      91,\n      92,\n      93,\n      VK.DOWN,\n      VK.UP,\n      VK.LEFT,\n      VK.RIGHT\n    ].concat(Env.browser.isFirefox() ? [224] : []);\n    var placeholderAttr = 'data-mce-placeholder';\n    var isKeyboardEvent = function (e) {\n      return e.type === 'keydown' || e.type === 'keyup';\n    };\n    var isDeleteEvent = function (e) {\n      var keyCode = e.keyCode;\n      return keyCode === VK.BACKSPACE || keyCode === VK.DELETE;\n    };\n    var isNonTypingKeyboardEvent = function (e) {\n      if (isKeyboardEvent(e)) {\n        var keyCode = e.keyCode;\n        return !isDeleteEvent(e) && (VK.metaKeyPressed(e) || e.altKey || keyCode >= 112 && keyCode <= 123 || contains(nonTypingKeycodes, keyCode));\n      } else {\n        return false;\n      }\n    };\n    var isTypingKeyboardEvent = function (e) {\n      return isKeyboardEvent(e) && !(isDeleteEvent(e) || e.type === 'keyup' && e.keyCode === 229);\n    };\n    var isVisuallyEmpty = function (dom, rootElm, forcedRootBlock) {\n      if (isEmpty(SugarElement.fromDom(rootElm), false)) {\n        var isForcedRootBlockFalse = forcedRootBlock === '';\n        var firstElement = rootElm.firstElementChild;\n        if (!firstElement) {\n          return true;\n        } else if (dom.getStyle(rootElm.firstElementChild, 'padding-left') || dom.getStyle(rootElm.firstElementChild, 'padding-right')) {\n          return false;\n        } else {\n          return isForcedRootBlockFalse ? !dom.isBlock(firstElement) : forcedRootBlock === firstElement.nodeName.toLowerCase();\n        }\n      } else {\n        return false;\n      }\n    };\n    var setup$7 = function (editor) {\n      var dom = editor.dom;\n      var rootBlock = getForcedRootBlock(editor);\n      var placeholder = getPlaceholder(editor);\n      var updatePlaceholder = function (e, initial) {\n        if (isNonTypingKeyboardEvent(e)) {\n          return;\n        }\n        var body = editor.getBody();\n        var showPlaceholder = isTypingKeyboardEvent(e) ? false : isVisuallyEmpty(dom, body, rootBlock);\n        var isPlaceholderShown = dom.getAttrib(body, placeholderAttr) !== '';\n        if (isPlaceholderShown !== showPlaceholder || initial) {\n          dom.setAttrib(body, placeholderAttr, showPlaceholder ? placeholder : null);\n          dom.setAttrib(body, 'aria-placeholder', showPlaceholder ? placeholder : null);\n          firePlaceholderToggle(editor, showPlaceholder);\n          editor.on(showPlaceholder ? 'keydown' : 'keyup', updatePlaceholder);\n          editor.off(showPlaceholder ? 'keyup' : 'keydown', updatePlaceholder);\n        }\n      };\n      if (placeholder) {\n        editor.on('init', function (e) {\n          updatePlaceholder(e, true);\n          editor.on('change SetContent ExecCommand', updatePlaceholder);\n          editor.on('paste', function (e) {\n            return Delay.setEditorTimeout(editor, function () {\n              return updatePlaceholder(e);\n            });\n          });\n        });\n      }\n    };\n\n    var strongRtl = /[\\u0591-\\u07FF\\uFB1D-\\uFDFF\\uFE70-\\uFEFC]/;\n    var hasStrongRtl = function (text) {\n      return strongRtl.test(text);\n    };\n\n    var isInlineTarget = function (editor, elm) {\n      return is$1(SugarElement.fromDom(elm), getInlineBoundarySelector(editor));\n    };\n    var isRtl$1 = function (element) {\n      return DOMUtils$1.DOM.getStyle(element, 'direction', true) === 'rtl' || hasStrongRtl(element.textContent);\n    };\n    var findInlineParents = function (isInlineTarget, rootNode, pos) {\n      return filter(DOMUtils$1.DOM.getParents(pos.container(), '*', rootNode), isInlineTarget);\n    };\n    var findRootInline = function (isInlineTarget, rootNode, pos) {\n      var parents = findInlineParents(isInlineTarget, rootNode, pos);\n      return Optional.from(parents[parents.length - 1]);\n    };\n    var hasSameParentBlock = function (rootNode, node1, node2) {\n      var block1 = getParentBlock(node1, rootNode);\n      var block2 = getParentBlock(node2, rootNode);\n      return block1 && block1 === block2;\n    };\n    var isAtZwsp = function (pos) {\n      return isBeforeInline(pos) || isAfterInline(pos);\n    };\n    var normalizePosition = function (forward, pos) {\n      if (!pos) {\n        return pos;\n      }\n      var container = pos.container(), offset = pos.offset();\n      if (forward) {\n        if (isCaretContainerInline(container)) {\n          if (isText$1(container.nextSibling)) {\n            return CaretPosition$1(container.nextSibling, 0);\n          } else {\n            return CaretPosition$1.after(container);\n          }\n        } else {\n          return isBeforeInline(pos) ? CaretPosition$1(container, offset + 1) : pos;\n        }\n      } else {\n        if (isCaretContainerInline(container)) {\n          if (isText$1(container.previousSibling)) {\n            return CaretPosition$1(container.previousSibling, container.previousSibling.data.length);\n          } else {\n            return CaretPosition$1.before(container);\n          }\n        } else {\n          return isAfterInline(pos) ? CaretPosition$1(container, offset - 1) : pos;\n        }\n      }\n    };\n    var normalizeForwards = curry(normalizePosition, true);\n    var normalizeBackwards = curry(normalizePosition, false);\n\n    var isBeforeRoot = function (rootNode) {\n      return function (elm) {\n        return eq$2(rootNode, SugarElement.fromDom(elm.dom.parentNode));\n      };\n    };\n    var getParentBlock$1 = function (rootNode, elm) {\n      return contains$2(rootNode, elm) ? closest(elm, function (element) {\n        return isTextBlock(element) || isListItem(element);\n      }, isBeforeRoot(rootNode)) : Optional.none();\n    };\n    var placeCaretInEmptyBody = function (editor) {\n      var body = editor.getBody();\n      var node = body.firstChild && editor.dom.isBlock(body.firstChild) ? body.firstChild : body;\n      editor.selection.setCursorLocation(node, 0);\n    };\n    var paddEmptyBody = function (editor) {\n      if (editor.dom.isEmpty(editor.getBody())) {\n        editor.setContent('');\n        placeCaretInEmptyBody(editor);\n      }\n    };\n    var willDeleteLastPositionInElement = function (forward, fromPos, elm) {\n      return lift2(firstPositionIn(elm), lastPositionIn(elm), function (firstPos, lastPos) {\n        var normalizedFirstPos = normalizePosition(true, firstPos);\n        var normalizedLastPos = normalizePosition(false, lastPos);\n        var normalizedFromPos = normalizePosition(false, fromPos);\n        if (forward) {\n          return nextPosition(elm, normalizedFromPos).exists(function (nextPos) {\n            return nextPos.isEqual(normalizedLastPos) && fromPos.isEqual(normalizedFirstPos);\n          });\n        } else {\n          return prevPosition(elm, normalizedFromPos).exists(function (prevPos) {\n            return prevPos.isEqual(normalizedFirstPos) && fromPos.isEqual(normalizedLastPos);\n          });\n        }\n      }).getOr(true);\n    };\n\n    var blockPosition = function (block, position) {\n      return {\n        block: block,\n        position: position\n      };\n    };\n    var blockBoundary = function (from, to) {\n      return {\n        from: from,\n        to: to\n      };\n    };\n    var getBlockPosition = function (rootNode, pos) {\n      var rootElm = SugarElement.fromDom(rootNode);\n      var containerElm = SugarElement.fromDom(pos.container());\n      return getParentBlock$1(rootElm, containerElm).map(function (block) {\n        return blockPosition(block, pos);\n      });\n    };\n    var isDifferentBlocks = function (blockBoundary) {\n      return eq$2(blockBoundary.from.block, blockBoundary.to.block) === false;\n    };\n    var hasSameParent = function (blockBoundary) {\n      return parent(blockBoundary.from.block).bind(function (parent1) {\n        return parent(blockBoundary.to.block).filter(function (parent2) {\n          return eq$2(parent1, parent2);\n        });\n      }).isSome();\n    };\n    var isEditable = function (blockBoundary) {\n      return isContentEditableFalse(blockBoundary.from.block.dom) === false && isContentEditableFalse(blockBoundary.to.block.dom) === false;\n    };\n    var skipLastBr = function (rootNode, forward, blockPosition) {\n      if (isBr(blockPosition.position.getNode()) && isEmpty(blockPosition.block) === false) {\n        return positionIn(false, blockPosition.block.dom).bind(function (lastPositionInBlock) {\n          if (lastPositionInBlock.isEqual(blockPosition.position)) {\n            return fromPosition(forward, rootNode, lastPositionInBlock).bind(function (to) {\n              return getBlockPosition(rootNode, to);\n            });\n          } else {\n            return Optional.some(blockPosition);\n          }\n        }).getOr(blockPosition);\n      } else {\n        return blockPosition;\n      }\n    };\n    var readFromRange = function (rootNode, forward, rng) {\n      var fromBlockPos = getBlockPosition(rootNode, CaretPosition$1.fromRangeStart(rng));\n      var toBlockPos = fromBlockPos.bind(function (blockPos) {\n        return fromPosition(forward, rootNode, blockPos.position).bind(function (to) {\n          return getBlockPosition(rootNode, to).map(function (blockPos) {\n            return skipLastBr(rootNode, forward, blockPos);\n          });\n        });\n      });\n      return lift2(fromBlockPos, toBlockPos, blockBoundary).filter(function (blockBoundary) {\n        return isDifferentBlocks(blockBoundary) && hasSameParent(blockBoundary) && isEditable(blockBoundary);\n      });\n    };\n    var read$3 = function (rootNode, forward, rng) {\n      return rng.collapsed ? readFromRange(rootNode, forward, rng) : Optional.none();\n    };\n\n    var getChildrenUntilBlockBoundary = function (block) {\n      var children$1 = children(block);\n      return findIndex(children$1, isBlock).fold(function () {\n        return children$1;\n      }, function (index) {\n        return children$1.slice(0, index);\n      });\n    };\n    var extractChildren = function (block) {\n      var children = getChildrenUntilBlockBoundary(block);\n      each(children, remove);\n      return children;\n    };\n    var removeEmptyRoot = function (rootNode, block) {\n      var parents = parentsAndSelf(block, rootNode);\n      return find(parents.reverse(), function (element) {\n        return isEmpty(element);\n      }).each(remove);\n    };\n    var isEmptyBefore = function (el) {\n      return filter(prevSiblings(el), function (el) {\n        return !isEmpty(el);\n      }).length === 0;\n    };\n    var nestedBlockMerge = function (rootNode, fromBlock, toBlock, insertionPoint) {\n      if (isEmpty(toBlock)) {\n        fillWithPaddingBr(toBlock);\n        return firstPositionIn(toBlock.dom);\n      }\n      if (isEmptyBefore(insertionPoint) && isEmpty(fromBlock)) {\n        before(insertionPoint, SugarElement.fromTag('br'));\n      }\n      var position = prevPosition(toBlock.dom, CaretPosition$1.before(insertionPoint.dom));\n      each(extractChildren(fromBlock), function (child) {\n        before(insertionPoint, child);\n      });\n      removeEmptyRoot(rootNode, fromBlock);\n      return position;\n    };\n    var sidelongBlockMerge = function (rootNode, fromBlock, toBlock) {\n      if (isEmpty(toBlock)) {\n        remove(toBlock);\n        if (isEmpty(fromBlock)) {\n          fillWithPaddingBr(fromBlock);\n        }\n        return firstPositionIn(fromBlock.dom);\n      }\n      var position = lastPositionIn(toBlock.dom);\n      each(extractChildren(fromBlock), function (child) {\n        append(toBlock, child);\n      });\n      removeEmptyRoot(rootNode, fromBlock);\n      return position;\n    };\n    var findInsertionPoint = function (toBlock, block) {\n      var parentsAndSelf$1 = parentsAndSelf(block, toBlock);\n      return Optional.from(parentsAndSelf$1[parentsAndSelf$1.length - 1]);\n    };\n    var getInsertionPoint = function (fromBlock, toBlock) {\n      return contains$2(toBlock, fromBlock) ? findInsertionPoint(toBlock, fromBlock) : Optional.none();\n    };\n    var trimBr = function (first, block) {\n      positionIn(first, block.dom).map(function (position) {\n        return position.getNode();\n      }).map(SugarElement.fromDom).filter(isBr$1).each(remove);\n    };\n    var mergeBlockInto = function (rootNode, fromBlock, toBlock) {\n      trimBr(true, fromBlock);\n      trimBr(false, toBlock);\n      return getInsertionPoint(fromBlock, toBlock).fold(curry(sidelongBlockMerge, rootNode, fromBlock, toBlock), curry(nestedBlockMerge, rootNode, fromBlock, toBlock));\n    };\n    var mergeBlocks = function (rootNode, forward, block1, block2) {\n      return forward ? mergeBlockInto(rootNode, block2, block1) : mergeBlockInto(rootNode, block1, block2);\n    };\n\n    var backspaceDelete$1 = function (editor, forward) {\n      var rootNode = SugarElement.fromDom(editor.getBody());\n      var position = read$3(rootNode.dom, forward, editor.selection.getRng()).bind(function (blockBoundary) {\n        return mergeBlocks(rootNode, forward, blockBoundary.from.block, blockBoundary.to.block);\n      });\n      position.each(function (pos) {\n        editor.selection.setRng(pos.toRange());\n      });\n      return position.isSome();\n    };\n\n    var deleteRangeMergeBlocks = function (rootNode, selection) {\n      var rng = selection.getRng();\n      return lift2(getParentBlock$1(rootNode, SugarElement.fromDom(rng.startContainer)), getParentBlock$1(rootNode, SugarElement.fromDom(rng.endContainer)), function (block1, block2) {\n        if (eq$2(block1, block2) === false) {\n          rng.deleteContents();\n          mergeBlocks(rootNode, true, block1, block2).each(function (pos) {\n            selection.setRng(pos.toRange());\n          });\n          return true;\n        } else {\n          return false;\n        }\n      }).getOr(false);\n    };\n    var isRawNodeInTable = function (root, rawNode) {\n      var node = SugarElement.fromDom(rawNode);\n      var isRoot = curry(eq$2, root);\n      return ancestor(node, isTableCell$1, isRoot).isSome();\n    };\n    var isSelectionInTable = function (root, rng) {\n      return isRawNodeInTable(root, rng.startContainer) || isRawNodeInTable(root, rng.endContainer);\n    };\n    var isEverythingSelected = function (root, rng) {\n      var noPrevious = prevPosition(root.dom, CaretPosition$1.fromRangeStart(rng)).isNone();\n      var noNext = nextPosition(root.dom, CaretPosition$1.fromRangeEnd(rng)).isNone();\n      return !isSelectionInTable(root, rng) && noPrevious && noNext;\n    };\n    var emptyEditor = function (editor) {\n      editor.setContent('');\n      editor.selection.setCursorLocation();\n      return true;\n    };\n    var deleteRange$1 = function (editor) {\n      var rootNode = SugarElement.fromDom(editor.getBody());\n      var rng = editor.selection.getRng();\n      return isEverythingSelected(rootNode, rng) ? emptyEditor(editor) : deleteRangeMergeBlocks(rootNode, editor.selection);\n    };\n    var backspaceDelete$2 = function (editor, _forward) {\n      return editor.selection.isCollapsed() ? false : deleteRange$1(editor);\n    };\n\n    var isContentEditableTrue$2 = isContentEditableTrue;\n    var isContentEditableFalse$7 = isContentEditableFalse;\n    var showCaret = function (direction, editor, node, before, scrollIntoView) {\n      return Optional.from(editor._selectionOverrides.showCaret(direction, node, before, scrollIntoView));\n    };\n    var getNodeRange = function (node) {\n      var rng = node.ownerDocument.createRange();\n      rng.selectNode(node);\n      return rng;\n    };\n    var selectNode = function (editor, node) {\n      var e = editor.fire('BeforeObjectSelected', { target: node });\n      if (e.isDefaultPrevented()) {\n        return Optional.none();\n      }\n      return Optional.some(getNodeRange(node));\n    };\n    var renderCaretAtRange = function (editor, range, scrollIntoView) {\n      var normalizedRange = normalizeRange(1, editor.getBody(), range);\n      var caretPosition = CaretPosition$1.fromRangeStart(normalizedRange);\n      var caretPositionNode = caretPosition.getNode();\n      if (isInlineFakeCaretTarget(caretPositionNode)) {\n        return showCaret(1, editor, caretPositionNode, !caretPosition.isAtEnd(), false);\n      }\n      var caretPositionBeforeNode = caretPosition.getNode(true);\n      if (isInlineFakeCaretTarget(caretPositionBeforeNode)) {\n        return showCaret(1, editor, caretPositionBeforeNode, false, false);\n      }\n      var ceRoot = editor.dom.getParent(caretPosition.getNode(), function (node) {\n        return isContentEditableFalse$7(node) || isContentEditableTrue$2(node);\n      });\n      if (isInlineFakeCaretTarget(ceRoot)) {\n        return showCaret(1, editor, ceRoot, false, scrollIntoView);\n      }\n      return Optional.none();\n    };\n    var renderRangeCaret = function (editor, range, scrollIntoView) {\n      return range.collapsed ? renderCaretAtRange(editor, range, scrollIntoView).getOr(range) : range;\n    };\n\n    var isBeforeBoundary = function (pos) {\n      return isBeforeContentEditableFalse(pos) || isBeforeMedia(pos);\n    };\n    var isAfterBoundary = function (pos) {\n      return isAfterContentEditableFalse(pos) || isAfterMedia(pos);\n    };\n    var trimEmptyTextNode$1 = function (dom, node) {\n      if (isText$1(node) && node.data.length === 0) {\n        dom.remove(node);\n      }\n    };\n    var deleteContentAndShowCaret = function (editor, range, node, direction, forward, peekCaretPosition) {\n      showCaret(direction, editor, peekCaretPosition.getNode(!forward), forward, true).each(function (caretRange) {\n        if (range.collapsed) {\n          var deleteRange = range.cloneRange();\n          if (forward) {\n            deleteRange.setEnd(caretRange.startContainer, caretRange.startOffset);\n          } else {\n            deleteRange.setStart(caretRange.endContainer, caretRange.endOffset);\n          }\n          deleteRange.deleteContents();\n        } else {\n          range.deleteContents();\n        }\n        editor.selection.setRng(caretRange);\n      });\n      trimEmptyTextNode$1(editor.dom, node);\n      return true;\n    };\n    var deleteBoundaryText = function (editor, forward) {\n      var range = editor.selection.getRng();\n      if (!isText$1(range.commonAncestorContainer)) {\n        return false;\n      }\n      var direction = forward ? HDirection.Forwards : HDirection.Backwards;\n      var caretWalker = CaretWalker(editor.getBody());\n      var getNextPosFn = curry(getVisualCaretPosition, forward ? caretWalker.next : caretWalker.prev);\n      var isBeforeFn = forward ? isBeforeBoundary : isAfterBoundary;\n      var caretPosition = getNormalizedRangeEndPoint(direction, editor.getBody(), range);\n      var nextCaretPosition = normalizePosition(forward, getNextPosFn(caretPosition));\n      if (!nextCaretPosition || !isMoveInsideSameBlock(caretPosition, nextCaretPosition)) {\n        return false;\n      } else if (isBeforeFn(nextCaretPosition)) {\n        return deleteContentAndShowCaret(editor, range, caretPosition.getNode(), direction, forward, nextCaretPosition);\n      }\n      var peekCaretPosition = getNextPosFn(nextCaretPosition);\n      if (peekCaretPosition && isBeforeFn(peekCaretPosition)) {\n        if (isMoveInsideSameBlock(nextCaretPosition, peekCaretPosition)) {\n          return deleteContentAndShowCaret(editor, range, caretPosition.getNode(), direction, forward, peekCaretPosition);\n        }\n      }\n      return false;\n    };\n    var backspaceDelete$3 = function (editor, forward) {\n      return deleteBoundaryText(editor, forward);\n    };\n\n    var isCompoundElement = function (node) {\n      return isTableCell$1(SugarElement.fromDom(node)) || isListItem(SugarElement.fromDom(node));\n    };\n    var DeleteAction = Adt.generate([\n      { remove: ['element'] },\n      { moveToElement: ['element'] },\n      { moveToPosition: ['position'] }\n    ]);\n    var isAtContentEditableBlockCaret = function (forward, from) {\n      var elm = from.getNode(forward === false);\n      var caretLocation = forward ? 'after' : 'before';\n      return isElement$1(elm) && elm.getAttribute('data-mce-caret') === caretLocation;\n    };\n    var isDeleteFromCefDifferentBlocks = function (root, forward, from, to) {\n      var inSameBlock = function (elm) {\n        return isInline(SugarElement.fromDom(elm)) && !isInSameBlock(from, to, root);\n      };\n      return getRelativeCefElm(!forward, from).fold(function () {\n        return getRelativeCefElm(forward, to).fold(never, inSameBlock);\n      }, inSameBlock);\n    };\n    var deleteEmptyBlockOrMoveToCef = function (root, forward, from, to) {\n      var toCefElm = to.getNode(forward === false);\n      return getParentBlock$1(SugarElement.fromDom(root), SugarElement.fromDom(from.getNode())).map(function (blockElm) {\n        return isEmpty(blockElm) ? DeleteAction.remove(blockElm.dom) : DeleteAction.moveToElement(toCefElm);\n      }).orThunk(function () {\n        return Optional.some(DeleteAction.moveToElement(toCefElm));\n      });\n    };\n    var findCefPosition = function (root, forward, from) {\n      return fromPosition(forward, root, from).bind(function (to) {\n        if (isCompoundElement(to.getNode())) {\n          return Optional.none();\n        } else if (isDeleteFromCefDifferentBlocks(root, forward, from, to)) {\n          return Optional.none();\n        } else if (forward && isContentEditableFalse(to.getNode())) {\n          return deleteEmptyBlockOrMoveToCef(root, forward, from, to);\n        } else if (forward === false && isContentEditableFalse(to.getNode(true))) {\n          return deleteEmptyBlockOrMoveToCef(root, forward, from, to);\n        } else if (forward && isAfterContentEditableFalse(from)) {\n          return Optional.some(DeleteAction.moveToPosition(to));\n        } else if (forward === false && isBeforeContentEditableFalse(from)) {\n          return Optional.some(DeleteAction.moveToPosition(to));\n        } else {\n          return Optional.none();\n        }\n      });\n    };\n    var getContentEditableBlockAction = function (forward, elm) {\n      if (forward && isContentEditableFalse(elm.nextSibling)) {\n        return Optional.some(DeleteAction.moveToElement(elm.nextSibling));\n      } else if (forward === false && isContentEditableFalse(elm.previousSibling)) {\n        return Optional.some(DeleteAction.moveToElement(elm.previousSibling));\n      } else {\n        return Optional.none();\n      }\n    };\n    var skipMoveToActionFromInlineCefToContent = function (root, from, deleteAction) {\n      return deleteAction.fold(function (elm) {\n        return Optional.some(DeleteAction.remove(elm));\n      }, function (elm) {\n        return Optional.some(DeleteAction.moveToElement(elm));\n      }, function (to) {\n        if (isInSameBlock(from, to, root)) {\n          return Optional.none();\n        } else {\n          return Optional.some(DeleteAction.moveToPosition(to));\n        }\n      });\n    };\n    var getContentEditableAction = function (root, forward, from) {\n      if (isAtContentEditableBlockCaret(forward, from)) {\n        return getContentEditableBlockAction(forward, from.getNode(forward === false)).fold(function () {\n          return findCefPosition(root, forward, from);\n        }, Optional.some);\n      } else {\n        return findCefPosition(root, forward, from).bind(function (deleteAction) {\n          return skipMoveToActionFromInlineCefToContent(root, from, deleteAction);\n        });\n      }\n    };\n    var read$4 = function (root, forward, rng) {\n      var normalizedRange = normalizeRange(forward ? 1 : -1, root, rng);\n      var from = CaretPosition$1.fromRangeStart(normalizedRange);\n      var rootElement = SugarElement.fromDom(root);\n      if (forward === false && isAfterContentEditableFalse(from)) {\n        return Optional.some(DeleteAction.remove(from.getNode(true)));\n      } else if (forward && isBeforeContentEditableFalse(from)) {\n        return Optional.some(DeleteAction.remove(from.getNode()));\n      } else if (forward === false && isBeforeContentEditableFalse(from) && isAfterBr(rootElement, from)) {\n        return findPreviousBr(rootElement, from).map(function (br) {\n          return DeleteAction.remove(br.getNode());\n        });\n      } else if (forward && isAfterContentEditableFalse(from) && isBeforeBr(rootElement, from)) {\n        return findNextBr(rootElement, from).map(function (br) {\n          return DeleteAction.remove(br.getNode());\n        });\n      } else {\n        return getContentEditableAction(root, forward, from);\n      }\n    };\n\n    var deleteElement$1 = function (editor, forward) {\n      return function (element) {\n        editor._selectionOverrides.hideFakeCaret();\n        deleteElement(editor, forward, SugarElement.fromDom(element));\n        return true;\n      };\n    };\n    var moveToElement = function (editor, forward) {\n      return function (element) {\n        var pos = forward ? CaretPosition$1.before(element) : CaretPosition$1.after(element);\n        editor.selection.setRng(pos.toRange());\n        return true;\n      };\n    };\n    var moveToPosition = function (editor) {\n      return function (pos) {\n        editor.selection.setRng(pos.toRange());\n        return true;\n      };\n    };\n    var getAncestorCe = function (editor, node) {\n      return Optional.from(getContentEditableRoot(editor.getBody(), node));\n    };\n    var backspaceDeleteCaret = function (editor, forward) {\n      var selectedNode = editor.selection.getNode();\n      return getAncestorCe(editor, selectedNode).filter(isContentEditableFalse).fold(function () {\n        return read$4(editor.getBody(), forward, editor.selection.getRng()).exists(function (deleteAction) {\n          return deleteAction.fold(deleteElement$1(editor, forward), moveToElement(editor, forward), moveToPosition(editor));\n        });\n      }, always);\n    };\n    var deleteOffscreenSelection = function (rootElement) {\n      each(descendants$1(rootElement, '.mce-offscreen-selection'), remove);\n    };\n    var backspaceDeleteRange = function (editor, forward) {\n      var selectedNode = editor.selection.getNode();\n      if (isContentEditableFalse(selectedNode)) {\n        var hasCefAncestor = getAncestorCe(editor, selectedNode.parentNode).filter(isContentEditableFalse);\n        return hasCefAncestor.fold(function () {\n          deleteOffscreenSelection(SugarElement.fromDom(editor.getBody()));\n          deleteElement(editor, forward, SugarElement.fromDom(editor.selection.getNode()));\n          paddEmptyBody(editor);\n          return true;\n        }, function () {\n          return true;\n        });\n      }\n      return false;\n    };\n    var paddEmptyElement = function (editor) {\n      var dom = editor.dom, selection = editor.selection;\n      var ceRoot = getContentEditableRoot(editor.getBody(), selection.getNode());\n      if (isContentEditableTrue(ceRoot) && dom.isBlock(ceRoot) && dom.isEmpty(ceRoot)) {\n        var br = dom.create('br', { 'data-mce-bogus': '1' });\n        dom.setHTML(ceRoot, '');\n        ceRoot.appendChild(br);\n        selection.setRng(CaretPosition$1.before(br).toRange());\n      }\n      return true;\n    };\n    var backspaceDelete$4 = function (editor, forward) {\n      if (editor.selection.isCollapsed()) {\n        return backspaceDeleteCaret(editor, forward);\n      } else {\n        return backspaceDeleteRange(editor, forward);\n      }\n    };\n\n    var deleteCaret$1 = function (editor, forward) {\n      var fromPos = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n      return fromPosition(forward, editor.getBody(), fromPos).filter(function (pos) {\n        return forward ? isBeforeImageBlock(pos) : isAfterImageBlock(pos);\n      }).bind(function (pos) {\n        return Optional.from(getChildNodeAtRelativeOffset(forward ? 0 : -1, pos));\n      }).exists(function (elm) {\n        editor.selection.select(elm);\n        return true;\n      });\n    };\n    var backspaceDelete$5 = function (editor, forward) {\n      return editor.selection.isCollapsed() ? deleteCaret$1(editor, forward) : false;\n    };\n\n    var isText$8 = isText$1;\n    var startsWithCaretContainer$1 = function (node) {\n      return isText$8(node) && node.data[0] === ZWSP;\n    };\n    var endsWithCaretContainer$1 = function (node) {\n      return isText$8(node) && node.data[node.data.length - 1] === ZWSP;\n    };\n    var createZwsp = function (node) {\n      return node.ownerDocument.createTextNode(ZWSP);\n    };\n    var insertBefore$1 = function (node) {\n      if (isText$8(node.previousSibling)) {\n        if (endsWithCaretContainer$1(node.previousSibling)) {\n          return node.previousSibling;\n        } else {\n          node.previousSibling.appendData(ZWSP);\n          return node.previousSibling;\n        }\n      } else if (isText$8(node)) {\n        if (startsWithCaretContainer$1(node)) {\n          return node;\n        } else {\n          node.insertData(0, ZWSP);\n          return node;\n        }\n      } else {\n        var newNode = createZwsp(node);\n        node.parentNode.insertBefore(newNode, node);\n        return newNode;\n      }\n    };\n    var insertAfter$1 = function (node) {\n      if (isText$8(node.nextSibling)) {\n        if (startsWithCaretContainer$1(node.nextSibling)) {\n          return node.nextSibling;\n        } else {\n          node.nextSibling.insertData(0, ZWSP);\n          return node.nextSibling;\n        }\n      } else if (isText$8(node)) {\n        if (endsWithCaretContainer$1(node)) {\n          return node;\n        } else {\n          node.appendData(ZWSP);\n          return node;\n        }\n      } else {\n        var newNode = createZwsp(node);\n        if (node.nextSibling) {\n          node.parentNode.insertBefore(newNode, node.nextSibling);\n        } else {\n          node.parentNode.appendChild(newNode);\n        }\n        return newNode;\n      }\n    };\n    var insertInline$1 = function (before, node) {\n      return before ? insertBefore$1(node) : insertAfter$1(node);\n    };\n    var insertInlineBefore = curry(insertInline$1, true);\n    var insertInlineAfter = curry(insertInline$1, false);\n\n    var insertInlinePos = function (pos, before) {\n      if (isText$1(pos.container())) {\n        return insertInline$1(before, pos.container());\n      } else {\n        return insertInline$1(before, pos.getNode());\n      }\n    };\n    var isPosCaretContainer = function (pos, caret) {\n      var caretNode = caret.get();\n      return caretNode && pos.container() === caretNode && isCaretContainerInline(caretNode);\n    };\n    var renderCaret = function (caret, location) {\n      return location.fold(function (element) {\n        remove$5(caret.get());\n        var text = insertInlineBefore(element);\n        caret.set(text);\n        return Optional.some(CaretPosition$1(text, text.length - 1));\n      }, function (element) {\n        return firstPositionIn(element).map(function (pos) {\n          if (!isPosCaretContainer(pos, caret)) {\n            remove$5(caret.get());\n            var text = insertInlinePos(pos, true);\n            caret.set(text);\n            return CaretPosition$1(text, 1);\n          } else {\n            return CaretPosition$1(caret.get(), 1);\n          }\n        });\n      }, function (element) {\n        return lastPositionIn(element).map(function (pos) {\n          if (!isPosCaretContainer(pos, caret)) {\n            remove$5(caret.get());\n            var text = insertInlinePos(pos, false);\n            caret.set(text);\n            return CaretPosition$1(text, text.length - 1);\n          } else {\n            return CaretPosition$1(caret.get(), caret.get().length - 1);\n          }\n        });\n      }, function (element) {\n        remove$5(caret.get());\n        var text = insertInlineAfter(element);\n        caret.set(text);\n        return Optional.some(CaretPosition$1(text, 1));\n      });\n    };\n\n    var evaluateUntil = function (fns, args) {\n      for (var i = 0; i < fns.length; i++) {\n        var result = fns[i].apply(null, args);\n        if (result.isSome()) {\n          return result;\n        }\n      }\n      return Optional.none();\n    };\n\n    var Location = Adt.generate([\n      { before: ['element'] },\n      { start: ['element'] },\n      { end: ['element'] },\n      { after: ['element'] }\n    ]);\n    var rescope = function (rootNode, node) {\n      var parentBlock = getParentBlock(node, rootNode);\n      return parentBlock ? parentBlock : rootNode;\n    };\n    var before$4 = function (isInlineTarget, rootNode, pos) {\n      var nPos = normalizeForwards(pos);\n      var scope = rescope(rootNode, nPos.container());\n      return findRootInline(isInlineTarget, scope, nPos).fold(function () {\n        return nextPosition(scope, nPos).bind(curry(findRootInline, isInlineTarget, scope)).map(function (inline) {\n          return Location.before(inline);\n        });\n      }, Optional.none);\n    };\n    var isNotInsideFormatCaretContainer = function (rootNode, elm) {\n      return getParentCaretContainer(rootNode, elm) === null;\n    };\n    var findInsideRootInline = function (isInlineTarget, rootNode, pos) {\n      return findRootInline(isInlineTarget, rootNode, pos).filter(curry(isNotInsideFormatCaretContainer, rootNode));\n    };\n    var start = function (isInlineTarget, rootNode, pos) {\n      var nPos = normalizeBackwards(pos);\n      return findInsideRootInline(isInlineTarget, rootNode, nPos).bind(function (inline) {\n        var prevPos = prevPosition(inline, nPos);\n        return prevPos.isNone() ? Optional.some(Location.start(inline)) : Optional.none();\n      });\n    };\n    var end = function (isInlineTarget, rootNode, pos) {\n      var nPos = normalizeForwards(pos);\n      return findInsideRootInline(isInlineTarget, rootNode, nPos).bind(function (inline) {\n        var nextPos = nextPosition(inline, nPos);\n        return nextPos.isNone() ? Optional.some(Location.end(inline)) : Optional.none();\n      });\n    };\n    var after$3 = function (isInlineTarget, rootNode, pos) {\n      var nPos = normalizeBackwards(pos);\n      var scope = rescope(rootNode, nPos.container());\n      return findRootInline(isInlineTarget, scope, nPos).fold(function () {\n        return prevPosition(scope, nPos).bind(curry(findRootInline, isInlineTarget, scope)).map(function (inline) {\n          return Location.after(inline);\n        });\n      }, Optional.none);\n    };\n    var isValidLocation = function (location) {\n      return isRtl$1(getElement(location)) === false;\n    };\n    var readLocation = function (isInlineTarget, rootNode, pos) {\n      var location = evaluateUntil([\n        before$4,\n        start,\n        end,\n        after$3\n      ], [\n        isInlineTarget,\n        rootNode,\n        pos\n      ]);\n      return location.filter(isValidLocation);\n    };\n    var getElement = function (location) {\n      return location.fold(identity, identity, identity, identity);\n    };\n    var getName = function (location) {\n      return location.fold(constant('before'), constant('start'), constant('end'), constant('after'));\n    };\n    var outside = function (location) {\n      return location.fold(Location.before, Location.before, Location.after, Location.after);\n    };\n    var inside = function (location) {\n      return location.fold(Location.start, Location.start, Location.end, Location.end);\n    };\n    var isEq$5 = function (location1, location2) {\n      return getName(location1) === getName(location2) && getElement(location1) === getElement(location2);\n    };\n    var betweenInlines = function (forward, isInlineTarget, rootNode, from, to, location) {\n      return lift2(findRootInline(isInlineTarget, rootNode, from), findRootInline(isInlineTarget, rootNode, to), function (fromInline, toInline) {\n        if (fromInline !== toInline && hasSameParentBlock(rootNode, fromInline, toInline)) {\n          return Location.after(forward ? fromInline : toInline);\n        } else {\n          return location;\n        }\n      }).getOr(location);\n    };\n    var skipNoMovement = function (fromLocation, toLocation) {\n      return fromLocation.fold(always, function (fromLocation) {\n        return !isEq$5(fromLocation, toLocation);\n      });\n    };\n    var findLocationTraverse = function (forward, isInlineTarget, rootNode, fromLocation, pos) {\n      var from = normalizePosition(forward, pos);\n      var to = fromPosition(forward, rootNode, from).map(curry(normalizePosition, forward));\n      var location = to.fold(function () {\n        return fromLocation.map(outside);\n      }, function (to) {\n        return readLocation(isInlineTarget, rootNode, to).map(curry(betweenInlines, forward, isInlineTarget, rootNode, from, to)).filter(curry(skipNoMovement, fromLocation));\n      });\n      return location.filter(isValidLocation);\n    };\n    var findLocationSimple = function (forward, location) {\n      if (forward) {\n        return location.fold(compose(Optional.some, Location.start), Optional.none, compose(Optional.some, Location.after), Optional.none);\n      } else {\n        return location.fold(Optional.none, compose(Optional.some, Location.before), Optional.none, compose(Optional.some, Location.end));\n      }\n    };\n    var findLocation = function (forward, isInlineTarget, rootNode, pos) {\n      var from = normalizePosition(forward, pos);\n      var fromLocation = readLocation(isInlineTarget, rootNode, from);\n      return readLocation(isInlineTarget, rootNode, from).bind(curry(findLocationSimple, forward)).orThunk(function () {\n        return findLocationTraverse(forward, isInlineTarget, rootNode, fromLocation, pos);\n      });\n    };\n    var prevLocation = curry(findLocation, false);\n    var nextLocation = curry(findLocation, true);\n\n    var hasSelectionModifyApi = function (editor) {\n      return isFunction(editor.selection.getSel().modify);\n    };\n    var moveRel = function (forward, selection, pos) {\n      var delta = forward ? 1 : -1;\n      selection.setRng(CaretPosition$1(pos.container(), pos.offset() + delta).toRange());\n      selection.getSel().modify('move', forward ? 'forward' : 'backward', 'word');\n      return true;\n    };\n    var moveByWord = function (forward, editor) {\n      var rng = editor.selection.getRng();\n      var pos = forward ? CaretPosition$1.fromRangeEnd(rng) : CaretPosition$1.fromRangeStart(rng);\n      if (!hasSelectionModifyApi(editor)) {\n        return false;\n      } else if (forward && isBeforeInline(pos)) {\n        return moveRel(true, editor.selection, pos);\n      } else if (!forward && isAfterInline(pos)) {\n        return moveRel(false, editor.selection, pos);\n      } else {\n        return false;\n      }\n    };\n\n    var setCaretPosition = function (editor, pos) {\n      var rng = editor.dom.createRng();\n      rng.setStart(pos.container(), pos.offset());\n      rng.setEnd(pos.container(), pos.offset());\n      editor.selection.setRng(rng);\n    };\n    var setSelected = function (state, elm) {\n      if (state) {\n        elm.setAttribute('data-mce-selected', 'inline-boundary');\n      } else {\n        elm.removeAttribute('data-mce-selected');\n      }\n    };\n    var renderCaretLocation = function (editor, caret, location) {\n      return renderCaret(caret, location).map(function (pos) {\n        setCaretPosition(editor, pos);\n        return location;\n      });\n    };\n    var findLocation$1 = function (editor, caret, forward) {\n      var rootNode = editor.getBody();\n      var from = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n      var isInlineTarget$1 = curry(isInlineTarget, editor);\n      var location = findLocation(forward, isInlineTarget$1, rootNode, from);\n      return location.bind(function (location) {\n        return renderCaretLocation(editor, caret, location);\n      });\n    };\n    var toggleInlines = function (isInlineTarget, dom, elms) {\n      var inlineBoundaries = map(descendants$1(SugarElement.fromDom(dom.getRoot()), '*[data-mce-selected=\"inline-boundary\"]'), function (e) {\n        return e.dom;\n      });\n      var selectedInlines = filter(inlineBoundaries, isInlineTarget);\n      var targetInlines = filter(elms, isInlineTarget);\n      each(difference(selectedInlines, targetInlines), curry(setSelected, false));\n      each(difference(targetInlines, selectedInlines), curry(setSelected, true));\n    };\n    var safeRemoveCaretContainer = function (editor, caret) {\n      if (editor.selection.isCollapsed() && editor.composing !== true && caret.get()) {\n        var pos = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n        if (CaretPosition$1.isTextPosition(pos) && isAtZwsp(pos) === false) {\n          setCaretPosition(editor, removeAndReposition(caret.get(), pos));\n          caret.set(null);\n        }\n      }\n    };\n    var renderInsideInlineCaret = function (isInlineTarget, editor, caret, elms) {\n      if (editor.selection.isCollapsed()) {\n        var inlines = filter(elms, isInlineTarget);\n        each(inlines, function (_inline) {\n          var pos = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n          readLocation(isInlineTarget, editor.getBody(), pos).bind(function (location) {\n            return renderCaretLocation(editor, caret, location);\n          });\n        });\n      }\n    };\n    var move = function (editor, caret, forward) {\n      return isInlineBoundariesEnabled(editor) ? findLocation$1(editor, caret, forward).isSome() : false;\n    };\n    var moveWord = function (forward, editor, _caret) {\n      return isInlineBoundariesEnabled(editor) ? moveByWord(forward, editor) : false;\n    };\n    var setupSelectedState = function (editor) {\n      var caret = Cell(null);\n      var isInlineTarget$1 = curry(isInlineTarget, editor);\n      editor.on('NodeChange', function (e) {\n        if (isInlineBoundariesEnabled(editor) && !(Env.browser.isIE() && e.initial)) {\n          toggleInlines(isInlineTarget$1, editor.dom, e.parents);\n          safeRemoveCaretContainer(editor, caret);\n          renderInsideInlineCaret(isInlineTarget$1, editor, caret, e.parents);\n        }\n      });\n      return caret;\n    };\n    var moveNextWord = curry(moveWord, true);\n    var movePrevWord = curry(moveWord, false);\n\n    var rangeFromPositions = function (from, to) {\n      var range = document.createRange();\n      range.setStart(from.container(), from.offset());\n      range.setEnd(to.container(), to.offset());\n      return range;\n    };\n    var hasOnlyTwoOrLessPositionsLeft = function (elm) {\n      return lift2(firstPositionIn(elm), lastPositionIn(elm), function (firstPos, lastPos) {\n        var normalizedFirstPos = normalizePosition(true, firstPos);\n        var normalizedLastPos = normalizePosition(false, lastPos);\n        return nextPosition(elm, normalizedFirstPos).forall(function (pos) {\n          return pos.isEqual(normalizedLastPos);\n        });\n      }).getOr(true);\n    };\n    var setCaretLocation = function (editor, caret) {\n      return function (location) {\n        return renderCaret(caret, location).exists(function (pos) {\n          setCaretPosition(editor, pos);\n          return true;\n        });\n      };\n    };\n    var deleteFromTo = function (editor, caret, from, to) {\n      var rootNode = editor.getBody();\n      var isInlineTarget$1 = curry(isInlineTarget, editor);\n      editor.undoManager.ignore(function () {\n        editor.selection.setRng(rangeFromPositions(from, to));\n        editor.execCommand('Delete');\n        readLocation(isInlineTarget$1, rootNode, CaretPosition$1.fromRangeStart(editor.selection.getRng())).map(inside).map(setCaretLocation(editor, caret));\n      });\n      editor.nodeChanged();\n    };\n    var rescope$1 = function (rootNode, node) {\n      var parentBlock = getParentBlock(node, rootNode);\n      return parentBlock ? parentBlock : rootNode;\n    };\n    var backspaceDeleteCollapsed = function (editor, caret, forward, from) {\n      var rootNode = rescope$1(editor.getBody(), from.container());\n      var isInlineTarget$1 = curry(isInlineTarget, editor);\n      var fromLocation = readLocation(isInlineTarget$1, rootNode, from);\n      return fromLocation.bind(function (location) {\n        if (forward) {\n          return location.fold(constant(Optional.some(inside(location))), Optional.none, constant(Optional.some(outside(location))), Optional.none);\n        } else {\n          return location.fold(Optional.none, constant(Optional.some(outside(location))), Optional.none, constant(Optional.some(inside(location))));\n        }\n      }).map(setCaretLocation(editor, caret)).getOrThunk(function () {\n        var toPosition = navigate(forward, rootNode, from);\n        var toLocation = toPosition.bind(function (pos) {\n          return readLocation(isInlineTarget$1, rootNode, pos);\n        });\n        return lift2(fromLocation, toLocation, function () {\n          return findRootInline(isInlineTarget$1, rootNode, from).exists(function (elm) {\n            if (hasOnlyTwoOrLessPositionsLeft(elm)) {\n              deleteElement(editor, forward, SugarElement.fromDom(elm));\n              return true;\n            } else {\n              return false;\n            }\n          });\n        }).orThunk(function () {\n          return toLocation.bind(function (_) {\n            return toPosition.map(function (to) {\n              if (forward) {\n                deleteFromTo(editor, caret, from, to);\n              } else {\n                deleteFromTo(editor, caret, to, from);\n              }\n              return true;\n            });\n          });\n        }).getOr(false);\n      });\n    };\n    var backspaceDelete$6 = function (editor, caret, forward) {\n      if (editor.selection.isCollapsed() && isInlineBoundariesEnabled(editor)) {\n        var from = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n        return backspaceDeleteCollapsed(editor, caret, forward, from);\n      }\n      return false;\n    };\n\n    var getParentInlines = function (rootElm, startElm) {\n      var parents = parentsAndSelf(startElm, rootElm);\n      return findIndex(parents, isBlock).fold(constant(parents), function (index) {\n        return parents.slice(0, index);\n      });\n    };\n    var hasOnlyOneChild$1 = function (elm) {\n      return children(elm).length === 1;\n    };\n    var deleteLastPosition = function (forward, editor, target, parentInlines) {\n      var isFormatElement$1 = curry(isFormatElement, editor);\n      var formatNodes = map(filter(parentInlines, isFormatElement$1), function (elm) {\n        return elm.dom;\n      });\n      if (formatNodes.length === 0) {\n        deleteElement(editor, forward, target);\n      } else {\n        var pos = replaceWithCaretFormat(target.dom, formatNodes);\n        editor.selection.setRng(pos.toRange());\n      }\n    };\n    var deleteCaret$2 = function (editor, forward) {\n      var rootElm = SugarElement.fromDom(editor.getBody());\n      var startElm = SugarElement.fromDom(editor.selection.getStart());\n      var parentInlines = filter(getParentInlines(rootElm, startElm), hasOnlyOneChild$1);\n      return last(parentInlines).exists(function (target) {\n        var fromPos = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n        if (willDeleteLastPositionInElement(forward, fromPos, target.dom) && !isEmptyCaretFormatElement(target)) {\n          deleteLastPosition(forward, editor, target, parentInlines);\n          return true;\n        } else {\n          return false;\n        }\n      });\n    };\n    var backspaceDelete$7 = function (editor, forward) {\n      return editor.selection.isCollapsed() ? deleteCaret$2(editor, forward) : false;\n    };\n\n    var deleteElement$2 = function (editor, forward, element) {\n      editor._selectionOverrides.hideFakeCaret();\n      deleteElement(editor, forward, SugarElement.fromDom(element));\n      return true;\n    };\n    var deleteCaret$3 = function (editor, forward) {\n      var isNearMedia = forward ? isBeforeMedia : isAfterMedia;\n      var direction = forward ? HDirection.Forwards : HDirection.Backwards;\n      var fromPos = getNormalizedRangeEndPoint(direction, editor.getBody(), editor.selection.getRng());\n      if (isNearMedia(fromPos)) {\n        return deleteElement$2(editor, forward, fromPos.getNode(!forward));\n      } else {\n        return Optional.from(normalizePosition(forward, fromPos)).filter(function (pos) {\n          return isNearMedia(pos) && isMoveInsideSameBlock(fromPos, pos);\n        }).exists(function (pos) {\n          return deleteElement$2(editor, forward, pos.getNode(!forward));\n        });\n      }\n    };\n    var deleteRange$2 = function (editor, forward) {\n      var selectedNode = editor.selection.getNode();\n      return isMedia(selectedNode) ? deleteElement$2(editor, forward, selectedNode) : false;\n    };\n    var backspaceDelete$8 = function (editor, forward) {\n      return editor.selection.isCollapsed() ? deleteCaret$3(editor, forward) : deleteRange$2(editor, forward);\n    };\n\n    var isEditable$1 = function (target) {\n      return closest(target, function (elm) {\n        return isContentEditableTrue(elm.dom) || isContentEditableFalse(elm.dom);\n      }).exists(function (elm) {\n        return isContentEditableTrue(elm.dom);\n      });\n    };\n    var parseIndentValue = function (value) {\n      var number = parseInt(value, 10);\n      return isNaN(number) ? 0 : number;\n    };\n    var getIndentStyleName = function (useMargin, element) {\n      var indentStyleName = useMargin || isTable$1(element) ? 'margin' : 'padding';\n      var suffix = get$4(element, 'direction') === 'rtl' ? '-right' : '-left';\n      return indentStyleName + suffix;\n    };\n    var indentElement = function (dom, command, useMargin, value, unit, element) {\n      var indentStyleName = getIndentStyleName(useMargin, SugarElement.fromDom(element));\n      if (command === 'outdent') {\n        var styleValue = Math.max(0, parseIndentValue(element.style[indentStyleName]) - value);\n        dom.setStyle(element, indentStyleName, styleValue ? styleValue + unit : '');\n      } else {\n        var styleValue = parseIndentValue(element.style[indentStyleName]) + value + unit;\n        dom.setStyle(element, indentStyleName, styleValue);\n      }\n    };\n    var validateBlocks = function (editor, blocks) {\n      return forall(blocks, function (block) {\n        var indentStyleName = getIndentStyleName(shouldIndentUseMargin(editor), block);\n        var intentValue = getRaw(block, indentStyleName).map(parseIndentValue).getOr(0);\n        var contentEditable = editor.dom.getContentEditable(block.dom);\n        return contentEditable !== 'false' && intentValue > 0;\n      });\n    };\n    var canOutdent = function (editor) {\n      var blocks = getBlocksToIndent(editor);\n      return !editor.mode.isReadOnly() && (blocks.length > 1 || validateBlocks(editor, blocks));\n    };\n    var isListComponent = function (el) {\n      return isList(el) || isListItem(el);\n    };\n    var parentIsListComponent = function (el) {\n      return parent(el).map(isListComponent).getOr(false);\n    };\n    var getBlocksToIndent = function (editor) {\n      return filter(map(editor.selection.getSelectedBlocks(), SugarElement.fromDom), function (el) {\n        return !isListComponent(el) && !parentIsListComponent(el) && isEditable$1(el);\n      });\n    };\n    var handle = function (editor, command) {\n      var dom = editor.dom, selection = editor.selection, formatter = editor.formatter;\n      var indentation = getIndentation(editor);\n      var indentUnit = /[a-z%]+$/i.exec(indentation)[0];\n      var indentValue = parseInt(indentation, 10);\n      var useMargin = shouldIndentUseMargin(editor);\n      var forcedRootBlock = getForcedRootBlock(editor);\n      if (!editor.queryCommandState('InsertUnorderedList') && !editor.queryCommandState('InsertOrderedList')) {\n        if (forcedRootBlock === '' && !dom.getParent(selection.getNode(), dom.isBlock)) {\n          formatter.apply('div');\n        }\n      }\n      each(getBlocksToIndent(editor), function (block) {\n        indentElement(dom, command, useMargin, indentValue, indentUnit, block.dom);\n      });\n    };\n\n    var backspaceDelete$9 = function (editor, _forward) {\n      if (editor.selection.isCollapsed() && canOutdent(editor)) {\n        var dom = editor.dom;\n        var rng = editor.selection.getRng();\n        var pos = CaretPosition$1.fromRangeStart(rng);\n        var block = dom.getParent(rng.startContainer, dom.isBlock);\n        if (block !== null && isAtStartOfBlock(SugarElement.fromDom(block), pos)) {\n          handle(editor, 'outdent');\n          return true;\n        }\n      }\n      return false;\n    };\n\n    var nativeCommand = function (editor, command) {\n      editor.getDoc().execCommand(command, false, null);\n    };\n    var deleteCommand = function (editor, caret) {\n      if (backspaceDelete$9(editor)) {\n        return;\n      } else if (backspaceDelete$4(editor, false)) {\n        return;\n      } else if (backspaceDelete$3(editor, false)) {\n        return;\n      } else if (backspaceDelete$6(editor, caret, false)) {\n        return;\n      } else if (backspaceDelete$1(editor, false)) {\n        return;\n      } else if (backspaceDelete(editor)) {\n        return;\n      } else if (backspaceDelete$5(editor, false)) {\n        return;\n      } else if (backspaceDelete$8(editor, false)) {\n        return;\n      } else if (backspaceDelete$2(editor)) {\n        return;\n      } else if (backspaceDelete$7(editor, false)) {\n        return;\n      } else {\n        nativeCommand(editor, 'Delete');\n        paddEmptyBody(editor);\n      }\n    };\n    var forwardDeleteCommand = function (editor, caret) {\n      if (backspaceDelete$4(editor, true)) {\n        return;\n      } else if (backspaceDelete$3(editor, true)) {\n        return;\n      } else if (backspaceDelete$6(editor, caret, true)) {\n        return;\n      } else if (backspaceDelete$1(editor, true)) {\n        return;\n      } else if (backspaceDelete(editor)) {\n        return;\n      } else if (backspaceDelete$5(editor, true)) {\n        return;\n      } else if (backspaceDelete$8(editor, true)) {\n        return;\n      } else if (backspaceDelete$2(editor)) {\n        return;\n      } else if (backspaceDelete$7(editor, true)) {\n        return;\n      } else {\n        nativeCommand(editor, 'ForwardDelete');\n      }\n    };\n    var setup$8 = function (editor, caret) {\n      editor.addCommand('delete', function () {\n        deleteCommand(editor, caret);\n      });\n      editor.addCommand('forwardDelete', function () {\n        forwardDeleteCommand(editor, caret);\n      });\n    };\n\n    var SIGNIFICANT_MOVE = 5;\n    var LONGPRESS_DELAY = 400;\n    var getTouch = function (event) {\n      if (event.touches === undefined || event.touches.length !== 1) {\n        return Optional.none();\n      }\n      return Optional.some(event.touches[0]);\n    };\n    var isFarEnough = function (touch, data) {\n      var distX = Math.abs(touch.clientX - data.x);\n      var distY = Math.abs(touch.clientY - data.y);\n      return distX > SIGNIFICANT_MOVE || distY > SIGNIFICANT_MOVE;\n    };\n    var setup$9 = function (editor) {\n      var startData = Cell(Optional.none());\n      var longpressFired = Cell(false);\n      var debounceLongpress = last$2(function (e) {\n        editor.fire('longpress', __assign(__assign({}, e), { type: 'longpress' }));\n        longpressFired.set(true);\n      }, LONGPRESS_DELAY);\n      editor.on('touchstart', function (e) {\n        getTouch(e).each(function (touch) {\n          debounceLongpress.cancel();\n          var data = {\n            x: touch.clientX,\n            y: touch.clientY,\n            target: e.target\n          };\n          debounceLongpress.throttle(e);\n          longpressFired.set(false);\n          startData.set(Optional.some(data));\n        });\n      }, true);\n      editor.on('touchmove', function (e) {\n        debounceLongpress.cancel();\n        getTouch(e).each(function (touch) {\n          startData.get().each(function (data) {\n            if (isFarEnough(touch, data)) {\n              startData.set(Optional.none());\n              longpressFired.set(false);\n              editor.fire('longpresscancel');\n            }\n          });\n        });\n      }, true);\n      editor.on('touchend touchcancel', function (e) {\n        debounceLongpress.cancel();\n        if (e.type === 'touchcancel') {\n          return;\n        }\n        startData.get().filter(function (data) {\n          return data.target.isEqualNode(e.target);\n        }).each(function () {\n          if (longpressFired.get()) {\n            e.preventDefault();\n          } else {\n            editor.fire('tap', __assign(__assign({}, e), { type: 'tap' }));\n          }\n        });\n      }, true);\n    };\n\n    var isBlockElement = function (blockElements, node) {\n      return blockElements.hasOwnProperty(node.nodeName);\n    };\n    var isValidTarget = function (blockElements, node) {\n      if (isText$1(node)) {\n        return true;\n      } else if (isElement$1(node)) {\n        return !isBlockElement(blockElements, node) && !isBookmarkNode$1(node);\n      } else {\n        return false;\n      }\n    };\n    var hasBlockParent = function (blockElements, root, node) {\n      return exists(parents$1(SugarElement.fromDom(node), SugarElement.fromDom(root)), function (elm) {\n        return isBlockElement(blockElements, elm.dom);\n      });\n    };\n    var shouldRemoveTextNode = function (blockElements, node) {\n      if (isText$1(node)) {\n        if (node.nodeValue.length === 0) {\n          return true;\n        } else if (/^\\s+$/.test(node.nodeValue) && (!node.nextSibling || isBlockElement(blockElements, node.nextSibling))) {\n          return true;\n        }\n      }\n      return false;\n    };\n    var addRootBlocks = function (editor) {\n      var dom = editor.dom, selection = editor.selection;\n      var schema = editor.schema, blockElements = schema.getBlockElements();\n      var node = selection.getStart();\n      var rootNode = editor.getBody();\n      var rootBlockNode, tempNode, wrapped;\n      var forcedRootBlock = getForcedRootBlock(editor);\n      if (!node || !isElement$1(node) || !forcedRootBlock) {\n        return;\n      }\n      var rootNodeName = rootNode.nodeName.toLowerCase();\n      if (!schema.isValidChild(rootNodeName, forcedRootBlock.toLowerCase()) || hasBlockParent(blockElements, rootNode, node)) {\n        return;\n      }\n      var rng = selection.getRng();\n      var startContainer = rng.startContainer;\n      var startOffset = rng.startOffset;\n      var endContainer = rng.endContainer;\n      var endOffset = rng.endOffset;\n      var restoreSelection = hasFocus$1(editor);\n      node = rootNode.firstChild;\n      while (node) {\n        if (isValidTarget(blockElements, node)) {\n          if (shouldRemoveTextNode(blockElements, node)) {\n            tempNode = node;\n            node = node.nextSibling;\n            dom.remove(tempNode);\n            continue;\n          }\n          if (!rootBlockNode) {\n            rootBlockNode = dom.create(forcedRootBlock, getForcedRootBlockAttrs(editor));\n            node.parentNode.insertBefore(rootBlockNode, node);\n            wrapped = true;\n          }\n          tempNode = node;\n          node = node.nextSibling;\n          rootBlockNode.appendChild(tempNode);\n        } else {\n          rootBlockNode = null;\n          node = node.nextSibling;\n        }\n      }\n      if (wrapped && restoreSelection) {\n        rng.setStart(startContainer, startOffset);\n        rng.setEnd(endContainer, endOffset);\n        selection.setRng(rng);\n        editor.nodeChanged();\n      }\n    };\n    var setup$a = function (editor) {\n      if (getForcedRootBlock(editor)) {\n        editor.on('NodeChange', curry(addRootBlocks, editor));\n      }\n    };\n\n    var findBlockCaretContainer = function (editor) {\n      return descendant(SugarElement.fromDom(editor.getBody()), '*[data-mce-caret]').fold(constant(null), function (elm) {\n        return elm.dom;\n      });\n    };\n    var removeIeControlRect = function (editor) {\n      editor.selection.setRng(editor.selection.getRng());\n    };\n    var showBlockCaretContainer = function (editor, blockCaretContainer) {\n      if (blockCaretContainer.hasAttribute('data-mce-caret')) {\n        showCaretContainerBlock(blockCaretContainer);\n        removeIeControlRect(editor);\n        editor.selection.scrollIntoView(blockCaretContainer);\n      }\n    };\n    var handleBlockContainer = function (editor, e) {\n      var blockCaretContainer = findBlockCaretContainer(editor);\n      if (!blockCaretContainer) {\n        return;\n      }\n      if (e.type === 'compositionstart') {\n        e.preventDefault();\n        e.stopPropagation();\n        showBlockCaretContainer(editor, blockCaretContainer);\n        return;\n      }\n      if (hasContent(blockCaretContainer)) {\n        showBlockCaretContainer(editor, blockCaretContainer);\n        editor.undoManager.add();\n      }\n    };\n    var setup$b = function (editor) {\n      editor.on('keyup compositionstart', curry(handleBlockContainer, editor));\n    };\n\n    var BreakType;\n    (function (BreakType) {\n      BreakType[BreakType['Br'] = 0] = 'Br';\n      BreakType[BreakType['Block'] = 1] = 'Block';\n      BreakType[BreakType['Wrap'] = 2] = 'Wrap';\n      BreakType[BreakType['Eol'] = 3] = 'Eol';\n    }(BreakType || (BreakType = {})));\n    var flip = function (direction, positions) {\n      return direction === HDirection.Backwards ? reverse(positions) : positions;\n    };\n    var walk$3 = function (direction, caretWalker, pos) {\n      return direction === HDirection.Forwards ? caretWalker.next(pos) : caretWalker.prev(pos);\n    };\n    var getBreakType = function (scope, direction, currentPos, nextPos) {\n      if (isBr(nextPos.getNode(direction === HDirection.Forwards))) {\n        return BreakType.Br;\n      } else if (isInSameBlock(currentPos, nextPos) === false) {\n        return BreakType.Block;\n      } else {\n        return BreakType.Wrap;\n      }\n    };\n    var getPositionsUntil = function (predicate, direction, scope, start) {\n      var caretWalker = CaretWalker(scope);\n      var currentPos = start, nextPos;\n      var positions = [];\n      while (currentPos) {\n        nextPos = walk$3(direction, caretWalker, currentPos);\n        if (!nextPos) {\n          break;\n        }\n        if (isBr(nextPos.getNode(false))) {\n          if (direction === HDirection.Forwards) {\n            return {\n              positions: flip(direction, positions).concat([nextPos]),\n              breakType: BreakType.Br,\n              breakAt: Optional.some(nextPos)\n            };\n          } else {\n            return {\n              positions: flip(direction, positions),\n              breakType: BreakType.Br,\n              breakAt: Optional.some(nextPos)\n            };\n          }\n        }\n        if (!nextPos.isVisible()) {\n          currentPos = nextPos;\n          continue;\n        }\n        if (predicate(currentPos, nextPos)) {\n          var breakType = getBreakType(scope, direction, currentPos, nextPos);\n          return {\n            positions: flip(direction, positions),\n            breakType: breakType,\n            breakAt: Optional.some(nextPos)\n          };\n        }\n        positions.push(nextPos);\n        currentPos = nextPos;\n      }\n      return {\n        positions: flip(direction, positions),\n        breakType: BreakType.Eol,\n        breakAt: Optional.none()\n      };\n    };\n    var getAdjacentLinePositions = function (direction, getPositionsUntilBreak, scope, start) {\n      return getPositionsUntilBreak(scope, start).breakAt.map(function (pos) {\n        var positions = getPositionsUntilBreak(scope, pos).positions;\n        return direction === HDirection.Backwards ? positions.concat(pos) : [pos].concat(positions);\n      }).getOr([]);\n    };\n    var findClosestHorizontalPositionFromPoint = function (positions, x) {\n      return foldl(positions, function (acc, newPos) {\n        return acc.fold(function () {\n          return Optional.some(newPos);\n        }, function (lastPos) {\n          return lift2(head(lastPos.getClientRects()), head(newPos.getClientRects()), function (lastRect, newRect) {\n            var lastDist = Math.abs(x - lastRect.left);\n            var newDist = Math.abs(x - newRect.left);\n            return newDist <= lastDist ? newPos : lastPos;\n          }).or(acc);\n        });\n      }, Optional.none());\n    };\n    var findClosestHorizontalPosition = function (positions, pos) {\n      return head(pos.getClientRects()).bind(function (targetRect) {\n        return findClosestHorizontalPositionFromPoint(positions, targetRect.left);\n      });\n    };\n    var getPositionsUntilPreviousLine = curry(getPositionsUntil, CaretPosition.isAbove, -1);\n    var getPositionsUntilNextLine = curry(getPositionsUntil, CaretPosition.isBelow, 1);\n    var isAtFirstLine = function (scope, pos) {\n      return getPositionsUntilPreviousLine(scope, pos).breakAt.isNone();\n    };\n    var isAtLastLine = function (scope, pos) {\n      return getPositionsUntilNextLine(scope, pos).breakAt.isNone();\n    };\n    var getPositionsAbove = curry(getAdjacentLinePositions, -1, getPositionsUntilPreviousLine);\n    var getPositionsBelow = curry(getAdjacentLinePositions, 1, getPositionsUntilNextLine);\n    var getFirstLinePositions = function (scope) {\n      return firstPositionIn(scope).map(function (pos) {\n        return [pos].concat(getPositionsUntilNextLine(scope, pos).positions);\n      }).getOr([]);\n    };\n    var getLastLinePositions = function (scope) {\n      return lastPositionIn(scope).map(function (pos) {\n        return getPositionsUntilPreviousLine(scope, pos).positions.concat(pos);\n      }).getOr([]);\n    };\n\n    var getNodeClientRects = function (node) {\n      var toArrayWithNode = function (clientRects) {\n        return map(clientRects, function (clientRect) {\n          clientRect = clone$2(clientRect);\n          clientRect.node = node;\n          return clientRect;\n        });\n      };\n      if (isElement$1(node)) {\n        return toArrayWithNode(node.getClientRects());\n      }\n      if (isText$1(node)) {\n        var rng = node.ownerDocument.createRange();\n        rng.setStart(node, 0);\n        rng.setEnd(node, node.data.length);\n        return toArrayWithNode(rng.getClientRects());\n      }\n    };\n    var getClientRects = function (nodes) {\n      return bind(nodes, getNodeClientRects);\n    };\n\n    var VDirection;\n    (function (VDirection) {\n      VDirection[VDirection['Up'] = -1] = 'Up';\n      VDirection[VDirection['Down'] = 1] = 'Down';\n    }(VDirection || (VDirection = {})));\n    var findUntil$1 = function (direction, root, predicateFn, node) {\n      while (node = findNode(node, direction, isEditableCaretCandidate, root)) {\n        if (predicateFn(node)) {\n          return;\n        }\n      }\n    };\n    var walkUntil = function (direction, isAboveFn, isBeflowFn, root, predicateFn, caretPosition) {\n      var line = 0;\n      var result = [];\n      var add = function (node) {\n        var i, clientRect, clientRects;\n        clientRects = getClientRects([node]);\n        if (direction === -1) {\n          clientRects = clientRects.reverse();\n        }\n        for (i = 0; i < clientRects.length; i++) {\n          clientRect = clientRects[i];\n          if (isBeflowFn(clientRect, targetClientRect)) {\n            continue;\n          }\n          if (result.length > 0 && isAboveFn(clientRect, last$1(result))) {\n            line++;\n          }\n          clientRect.line = line;\n          if (predicateFn(clientRect)) {\n            return true;\n          }\n          result.push(clientRect);\n        }\n      };\n      var targetClientRect = last$1(caretPosition.getClientRects());\n      if (!targetClientRect) {\n        return result;\n      }\n      var node = caretPosition.getNode();\n      add(node);\n      findUntil$1(direction, root, add, node);\n      return result;\n    };\n    var aboveLineNumber = function (lineNumber, clientRect) {\n      return clientRect.line > lineNumber;\n    };\n    var isLineNumber = function (lineNumber, clientRect) {\n      return clientRect.line === lineNumber;\n    };\n    var upUntil = curry(walkUntil, VDirection.Up, isAbove, isBelow);\n    var downUntil = curry(walkUntil, VDirection.Down, isBelow, isAbove);\n    var positionsUntil = function (direction, root, predicateFn, node) {\n      var caretWalker = CaretWalker(root);\n      var walkFn, isBelowFn, isAboveFn, caretPosition;\n      var result = [];\n      var line = 0, clientRect;\n      var getClientRect = function (caretPosition) {\n        if (direction === 1) {\n          return last$1(caretPosition.getClientRects());\n        }\n        return last$1(caretPosition.getClientRects());\n      };\n      if (direction === 1) {\n        walkFn = caretWalker.next;\n        isBelowFn = isBelow;\n        isAboveFn = isAbove;\n        caretPosition = CaretPosition$1.after(node);\n      } else {\n        walkFn = caretWalker.prev;\n        isBelowFn = isAbove;\n        isAboveFn = isBelow;\n        caretPosition = CaretPosition$1.before(node);\n      }\n      var targetClientRect = getClientRect(caretPosition);\n      do {\n        if (!caretPosition.isVisible()) {\n          continue;\n        }\n        clientRect = getClientRect(caretPosition);\n        if (isAboveFn(clientRect, targetClientRect)) {\n          continue;\n        }\n        if (result.length > 0 && isBelowFn(clientRect, last$1(result))) {\n          line++;\n        }\n        clientRect = clone$2(clientRect);\n        clientRect.position = caretPosition;\n        clientRect.line = line;\n        if (predicateFn(clientRect)) {\n          return result;\n        }\n        result.push(clientRect);\n      } while (caretPosition = walkFn(caretPosition));\n      return result;\n    };\n    var isAboveLine = function (lineNumber) {\n      return function (clientRect) {\n        return aboveLineNumber(lineNumber, clientRect);\n      };\n    };\n    var isLine = function (lineNumber) {\n      return function (clientRect) {\n        return isLineNumber(lineNumber, clientRect);\n      };\n    };\n\n    var isContentEditableFalse$8 = isContentEditableFalse;\n    var findNode$1 = findNode;\n    var distanceToRectLeft = function (clientRect, clientX) {\n      return Math.abs(clientRect.left - clientX);\n    };\n    var distanceToRectRight = function (clientRect, clientX) {\n      return Math.abs(clientRect.right - clientX);\n    };\n    var isInsideX = function (clientX, clientRect) {\n      return clientX >= clientRect.left && clientX <= clientRect.right;\n    };\n    var isInsideY = function (clientY, clientRect) {\n      return clientY >= clientRect.top && clientY <= clientRect.bottom;\n    };\n    var findClosestClientRect = function (clientRects, clientX) {\n      return reduce(clientRects, function (oldClientRect, clientRect) {\n        var oldDistance = Math.min(distanceToRectLeft(oldClientRect, clientX), distanceToRectRight(oldClientRect, clientX));\n        var newDistance = Math.min(distanceToRectLeft(clientRect, clientX), distanceToRectRight(clientRect, clientX));\n        if (isInsideX(clientX, clientRect)) {\n          return clientRect;\n        }\n        if (isInsideX(clientX, oldClientRect)) {\n          return oldClientRect;\n        }\n        if (newDistance === oldDistance && isContentEditableFalse$8(clientRect.node)) {\n          return clientRect;\n        }\n        if (newDistance < oldDistance) {\n          return clientRect;\n        }\n        return oldClientRect;\n      });\n    };\n    var walkUntil$1 = function (direction, root, predicateFn, startNode, includeChildren) {\n      var node = findNode$1(startNode, direction, isEditableCaretCandidate, root, !includeChildren);\n      do {\n        if (!node || predicateFn(node)) {\n          return;\n        }\n      } while (node = findNode$1(node, direction, isEditableCaretCandidate, root));\n    };\n    var findLineNodeRects = function (root, targetNodeRect, includeChildren) {\n      if (includeChildren === void 0) {\n        includeChildren = true;\n      }\n      var clientRects = [];\n      var collect = function (checkPosFn, node) {\n        var lineRects = filter(getClientRects([node]), function (clientRect) {\n          return !checkPosFn(clientRect, targetNodeRect);\n        });\n        clientRects = clientRects.concat(lineRects);\n        return lineRects.length === 0;\n      };\n      clientRects.push(targetNodeRect);\n      walkUntil$1(VDirection.Up, root, curry(collect, isAbove), targetNodeRect.node, includeChildren);\n      walkUntil$1(VDirection.Down, root, curry(collect, isBelow), targetNodeRect.node, includeChildren);\n      return clientRects;\n    };\n    var getFakeCaretTargets = function (root) {\n      return filter(from$1(root.getElementsByTagName('*')), isFakeCaretTarget);\n    };\n    var caretInfo = function (clientRect, clientX) {\n      return {\n        node: clientRect.node,\n        before: distanceToRectLeft(clientRect, clientX) < distanceToRectRight(clientRect, clientX)\n      };\n    };\n    var closestFakeCaret = function (root, clientX, clientY) {\n      var fakeTargetNodeRects = getClientRects(getFakeCaretTargets(root));\n      var targetNodeRects = filter(fakeTargetNodeRects, curry(isInsideY, clientY));\n      var closestNodeRect = findClosestClientRect(targetNodeRects, clientX);\n      if (closestNodeRect) {\n        var includeChildren = !isTable(closestNodeRect.node) && !isMedia(closestNodeRect.node);\n        closestNodeRect = findClosestClientRect(findLineNodeRects(root, closestNodeRect, includeChildren), clientX);\n        if (closestNodeRect && isFakeCaretTarget(closestNodeRect.node)) {\n          return caretInfo(closestNodeRect, clientX);\n        }\n      }\n      return null;\n    };\n\n    var moveToRange = function (editor, rng) {\n      editor.selection.setRng(rng);\n      scrollRangeIntoView(editor, editor.selection.getRng());\n    };\n    var renderRangeCaretOpt = function (editor, range, scrollIntoView) {\n      return Optional.some(renderRangeCaret(editor, range, scrollIntoView));\n    };\n    var moveHorizontally = function (editor, direction, range, isBefore, isAfter, isElement) {\n      var forwards = direction === HDirection.Forwards;\n      var caretWalker = CaretWalker(editor.getBody());\n      var getNextPosFn = curry(getVisualCaretPosition, forwards ? caretWalker.next : caretWalker.prev);\n      var isBeforeFn = forwards ? isBefore : isAfter;\n      if (!range.collapsed) {\n        var node = getSelectedNode(range);\n        if (isElement(node)) {\n          return showCaret(direction, editor, node, direction === HDirection.Backwards, false);\n        }\n      }\n      var caretPosition = getNormalizedRangeEndPoint(direction, editor.getBody(), range);\n      if (isBeforeFn(caretPosition)) {\n        return selectNode(editor, caretPosition.getNode(!forwards));\n      }\n      var nextCaretPosition = normalizePosition(forwards, getNextPosFn(caretPosition));\n      var rangeIsInContainerBlock = isRangeInCaretContainerBlock(range);\n      if (!nextCaretPosition) {\n        return rangeIsInContainerBlock ? Optional.some(range) : Optional.none();\n      }\n      if (isBeforeFn(nextCaretPosition)) {\n        return showCaret(direction, editor, nextCaretPosition.getNode(!forwards), forwards, false);\n      }\n      var peekCaretPosition = getNextPosFn(nextCaretPosition);\n      if (peekCaretPosition && isBeforeFn(peekCaretPosition)) {\n        if (isMoveInsideSameBlock(nextCaretPosition, peekCaretPosition)) {\n          return showCaret(direction, editor, peekCaretPosition.getNode(!forwards), forwards, false);\n        }\n      }\n      if (rangeIsInContainerBlock) {\n        return renderRangeCaretOpt(editor, nextCaretPosition.toRange(), false);\n      }\n      return Optional.none();\n    };\n    var moveVertically = function (editor, direction, range, isBefore, isAfter, isElement) {\n      var caretPosition = getNormalizedRangeEndPoint(direction, editor.getBody(), range);\n      var caretClientRect = last$1(caretPosition.getClientRects());\n      var forwards = direction === VDirection.Down;\n      if (!caretClientRect) {\n        return Optional.none();\n      }\n      var walkerFn = forwards ? downUntil : upUntil;\n      var linePositions = walkerFn(editor.getBody(), isAboveLine(1), caretPosition);\n      var nextLinePositions = filter(linePositions, isLine(1));\n      var clientX = caretClientRect.left;\n      var nextLineRect = findClosestClientRect(nextLinePositions, clientX);\n      if (nextLineRect && isElement(nextLineRect.node)) {\n        var dist1 = Math.abs(clientX - nextLineRect.left);\n        var dist2 = Math.abs(clientX - nextLineRect.right);\n        return showCaret(direction, editor, nextLineRect.node, dist1 < dist2, false);\n      }\n      var currentNode;\n      if (isBefore(caretPosition)) {\n        currentNode = caretPosition.getNode();\n      } else if (isAfter(caretPosition)) {\n        currentNode = caretPosition.getNode(true);\n      } else {\n        currentNode = getSelectedNode(range);\n      }\n      if (currentNode) {\n        var caretPositions = positionsUntil(direction, editor.getBody(), isAboveLine(1), currentNode);\n        var closestNextLineRect = findClosestClientRect(filter(caretPositions, isLine(1)), clientX);\n        if (closestNextLineRect) {\n          return renderRangeCaretOpt(editor, closestNextLineRect.position.toRange(), false);\n        }\n        closestNextLineRect = last$1(filter(caretPositions, isLine(0)));\n        if (closestNextLineRect) {\n          return renderRangeCaretOpt(editor, closestNextLineRect.position.toRange(), false);\n        }\n      }\n      if (nextLinePositions.length === 0) {\n        return getLineEndPoint(editor, forwards).filter(forwards ? isAfter : isBefore).map(function (pos) {\n          return renderRangeCaret(editor, pos.toRange(), false);\n        });\n      }\n      return Optional.none();\n    };\n    var getLineEndPoint = function (editor, forward) {\n      var rng = editor.selection.getRng();\n      var body = editor.getBody();\n      if (forward) {\n        var from = CaretPosition$1.fromRangeEnd(rng);\n        var result = getPositionsUntilNextLine(body, from);\n        return last(result.positions);\n      } else {\n        var from = CaretPosition$1.fromRangeStart(rng);\n        var result = getPositionsUntilPreviousLine(body, from);\n        return head(result.positions);\n      }\n    };\n    var moveToLineEndPoint = function (editor, forward, isElementPosition) {\n      return getLineEndPoint(editor, forward).filter(isElementPosition).exists(function (pos) {\n        editor.selection.setRng(pos.toRange());\n        return true;\n      });\n    };\n\n    var isContentEditableFalse$9 = isContentEditableFalse;\n    var moveToCeFalseHorizontally = function (direction, editor, range) {\n      return moveHorizontally(editor, direction, range, isBeforeContentEditableFalse, isAfterContentEditableFalse, isContentEditableFalse$9);\n    };\n    var moveToCeFalseVertically = function (direction, editor, range) {\n      var isBefore = function (caretPosition) {\n        return isBeforeContentEditableFalse(caretPosition) || isBeforeTable(caretPosition);\n      };\n      var isAfter = function (caretPosition) {\n        return isAfterContentEditableFalse(caretPosition) || isAfterTable(caretPosition);\n      };\n      return moveVertically(editor, direction, range, isBefore, isAfter, isContentEditableFalse$9);\n    };\n    var createTextBlock = function (editor) {\n      var textBlock = editor.dom.create(getForcedRootBlock(editor));\n      if (!Env.ie || Env.ie >= 11) {\n        textBlock.innerHTML = '<br data-mce-bogus=\"1\">';\n      }\n      return textBlock;\n    };\n    var exitPreBlock = function (editor, direction, range) {\n      var caretWalker = CaretWalker(editor.getBody());\n      var getVisualCaretPosition$1 = curry(getVisualCaretPosition, direction === 1 ? caretWalker.next : caretWalker.prev);\n      if (range.collapsed && hasForcedRootBlock(editor)) {\n        var pre = editor.dom.getParent(range.startContainer, 'PRE');\n        if (!pre) {\n          return;\n        }\n        var caretPos = getVisualCaretPosition$1(CaretPosition$1.fromRangeStart(range));\n        if (!caretPos) {\n          var newBlock = createTextBlock(editor);\n          if (direction === 1) {\n            editor.$(pre).after(newBlock);\n          } else {\n            editor.$(pre).before(newBlock);\n          }\n          editor.selection.select(newBlock, true);\n          editor.selection.collapse();\n        }\n      }\n    };\n    var getHorizontalRange = function (editor, forward) {\n      var direction = forward ? HDirection.Forwards : HDirection.Backwards;\n      var range = editor.selection.getRng();\n      return moveToCeFalseHorizontally(direction, editor, range).orThunk(function () {\n        exitPreBlock(editor, direction, range);\n        return Optional.none();\n      });\n    };\n    var getVerticalRange = function (editor, down) {\n      var direction = down ? 1 : -1;\n      var range = editor.selection.getRng();\n      return moveToCeFalseVertically(direction, editor, range).orThunk(function () {\n        exitPreBlock(editor, direction, range);\n        return Optional.none();\n      });\n    };\n    var moveH = function (editor, forward) {\n      return getHorizontalRange(editor, forward).exists(function (newRange) {\n        moveToRange(editor, newRange);\n        return true;\n      });\n    };\n    var moveV = function (editor, down) {\n      return getVerticalRange(editor, down).exists(function (newRange) {\n        moveToRange(editor, newRange);\n        return true;\n      });\n    };\n    var moveToLineEndPoint$1 = function (editor, forward) {\n      var isCefPosition = forward ? isAfterContentEditableFalse : isBeforeContentEditableFalse;\n      return moveToLineEndPoint(editor, forward, isCefPosition);\n    };\n\n    var isTarget = function (node) {\n      return contains(['figcaption'], name(node));\n    };\n    var rangeBefore = function (target) {\n      var rng = document.createRange();\n      rng.setStartBefore(target.dom);\n      rng.setEndBefore(target.dom);\n      return rng;\n    };\n    var insertElement = function (root, elm, forward) {\n      if (forward) {\n        append(root, elm);\n      } else {\n        prepend(root, elm);\n      }\n    };\n    var insertBr = function (root, forward) {\n      var br = SugarElement.fromTag('br');\n      insertElement(root, br, forward);\n      return rangeBefore(br);\n    };\n    var insertBlock$1 = function (root, forward, blockName, attrs) {\n      var block = SugarElement.fromTag(blockName);\n      var br = SugarElement.fromTag('br');\n      setAll(block, attrs);\n      append(block, br);\n      insertElement(root, block, forward);\n      return rangeBefore(br);\n    };\n    var insertEmptyLine = function (root, rootBlockName, attrs, forward) {\n      if (rootBlockName === '') {\n        return insertBr(root, forward);\n      } else {\n        return insertBlock$1(root, forward, rootBlockName, attrs);\n      }\n    };\n    var getClosestTargetBlock = function (pos, root) {\n      var isRoot = curry(eq$2, root);\n      return closest(SugarElement.fromDom(pos.container()), isBlock, isRoot).filter(isTarget);\n    };\n    var isAtFirstOrLastLine = function (root, forward, pos) {\n      return forward ? isAtLastLine(root.dom, pos) : isAtFirstLine(root.dom, pos);\n    };\n    var moveCaretToNewEmptyLine = function (editor, forward) {\n      var root = SugarElement.fromDom(editor.getBody());\n      var pos = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n      var rootBlock = getForcedRootBlock(editor);\n      var rootBlockAttrs = getForcedRootBlockAttrs(editor);\n      return getClosestTargetBlock(pos, root).exists(function () {\n        if (isAtFirstOrLastLine(root, forward, pos)) {\n          var rng = insertEmptyLine(root, rootBlock, rootBlockAttrs, forward);\n          editor.selection.setRng(rng);\n          return true;\n        } else {\n          return false;\n        }\n      });\n    };\n    var moveV$1 = function (editor, forward) {\n      if (editor.selection.isCollapsed()) {\n        return moveCaretToNewEmptyLine(editor, forward);\n      } else {\n        return false;\n      }\n    };\n\n    var defaultPatterns = function (patterns) {\n      return map(patterns, function (pattern) {\n        return __assign({\n          shiftKey: false,\n          altKey: false,\n          ctrlKey: false,\n          metaKey: false,\n          keyCode: 0,\n          action: noop\n        }, pattern);\n      });\n    };\n    var matchesEvent = function (pattern, evt) {\n      return evt.keyCode === pattern.keyCode && evt.shiftKey === pattern.shiftKey && evt.altKey === pattern.altKey && evt.ctrlKey === pattern.ctrlKey && evt.metaKey === pattern.metaKey;\n    };\n    var match$1 = function (patterns, evt) {\n      return bind(defaultPatterns(patterns), function (pattern) {\n        return matchesEvent(pattern, evt) ? [pattern] : [];\n      });\n    };\n    var action = function (f) {\n      var x = [];\n      for (var _i = 1; _i < arguments.length; _i++) {\n        x[_i - 1] = arguments[_i];\n      }\n      return function () {\n        return f.apply(null, x);\n      };\n    };\n    var execute = function (patterns, evt) {\n      return find(match$1(patterns, evt), function (pattern) {\n        return pattern.action();\n      });\n    };\n\n    var moveH$1 = function (editor, forward) {\n      var direction = forward ? HDirection.Forwards : HDirection.Backwards;\n      var range = editor.selection.getRng();\n      return moveHorizontally(editor, direction, range, isBeforeMedia, isAfterMedia, isMedia).exists(function (newRange) {\n        moveToRange(editor, newRange);\n        return true;\n      });\n    };\n    var moveV$2 = function (editor, down) {\n      var direction = down ? 1 : -1;\n      var range = editor.selection.getRng();\n      return moveVertically(editor, direction, range, isBeforeMedia, isAfterMedia, isMedia).exists(function (newRange) {\n        moveToRange(editor, newRange);\n        return true;\n      });\n    };\n    var moveToLineEndPoint$2 = function (editor, forward) {\n      var isNearMedia = forward ? isAfterMedia : isBeforeMedia;\n      return moveToLineEndPoint(editor, forward, isNearMedia);\n    };\n\n    var deflate = function (rect, delta) {\n      return {\n        left: rect.left - delta,\n        top: rect.top - delta,\n        right: rect.right + delta * 2,\n        bottom: rect.bottom + delta * 2,\n        width: rect.width + delta,\n        height: rect.height + delta\n      };\n    };\n    var getCorners = function (getYAxisValue, tds) {\n      return bind(tds, function (td) {\n        var rect = deflate(clone$2(td.getBoundingClientRect()), -1);\n        return [\n          {\n            x: rect.left,\n            y: getYAxisValue(rect),\n            cell: td\n          },\n          {\n            x: rect.right,\n            y: getYAxisValue(rect),\n            cell: td\n          }\n        ];\n      });\n    };\n    var findClosestCorner = function (corners, x, y) {\n      return foldl(corners, function (acc, newCorner) {\n        return acc.fold(function () {\n          return Optional.some(newCorner);\n        }, function (oldCorner) {\n          var oldDist = Math.sqrt(Math.abs(oldCorner.x - x) + Math.abs(oldCorner.y - y));\n          var newDist = Math.sqrt(Math.abs(newCorner.x - x) + Math.abs(newCorner.y - y));\n          return Optional.some(newDist < oldDist ? newCorner : oldCorner);\n        });\n      }, Optional.none());\n    };\n    var getClosestCell$1 = function (getYAxisValue, isTargetCorner, table, x, y) {\n      var cells = descendants$1(SugarElement.fromDom(table), 'td,th,caption').map(function (e) {\n        return e.dom;\n      });\n      var corners = filter(getCorners(getYAxisValue, cells), function (corner) {\n        return isTargetCorner(corner, y);\n      });\n      return findClosestCorner(corners, x, y).map(function (corner) {\n        return corner.cell;\n      });\n    };\n    var getBottomValue = function (rect) {\n      return rect.bottom;\n    };\n    var getTopValue = function (rect) {\n      return rect.top;\n    };\n    var isAbove$1 = function (corner, y) {\n      return corner.y < y;\n    };\n    var isBelow$1 = function (corner, y) {\n      return corner.y > y;\n    };\n    var getClosestCellAbove = curry(getClosestCell$1, getBottomValue, isAbove$1);\n    var getClosestCellBelow = curry(getClosestCell$1, getTopValue, isBelow$1);\n    var findClosestPositionInAboveCell = function (table, pos) {\n      return head(pos.getClientRects()).bind(function (rect) {\n        return getClosestCellAbove(table, rect.left, rect.top);\n      }).bind(function (cell) {\n        return findClosestHorizontalPosition(getLastLinePositions(cell), pos);\n      });\n    };\n    var findClosestPositionInBelowCell = function (table, pos) {\n      return last(pos.getClientRects()).bind(function (rect) {\n        return getClosestCellBelow(table, rect.left, rect.top);\n      }).bind(function (cell) {\n        return findClosestHorizontalPosition(getFirstLinePositions(cell), pos);\n      });\n    };\n\n    var hasNextBreak = function (getPositionsUntil, scope, lineInfo) {\n      return lineInfo.breakAt.exists(function (breakPos) {\n        return getPositionsUntil(scope, breakPos).breakAt.isSome();\n      });\n    };\n    var startsWithWrapBreak = function (lineInfo) {\n      return lineInfo.breakType === BreakType.Wrap && lineInfo.positions.length === 0;\n    };\n    var startsWithBrBreak = function (lineInfo) {\n      return lineInfo.breakType === BreakType.Br && lineInfo.positions.length === 1;\n    };\n    var isAtTableCellLine = function (getPositionsUntil, scope, pos) {\n      var lineInfo = getPositionsUntil(scope, pos);\n      if (startsWithWrapBreak(lineInfo) || !isBr(pos.getNode()) && startsWithBrBreak(lineInfo)) {\n        return !hasNextBreak(getPositionsUntil, scope, lineInfo);\n      } else {\n        return lineInfo.breakAt.isNone();\n      }\n    };\n    var isAtFirstTableCellLine = curry(isAtTableCellLine, getPositionsUntilPreviousLine);\n    var isAtLastTableCellLine = curry(isAtTableCellLine, getPositionsUntilNextLine);\n    var isCaretAtStartOrEndOfTable = function (forward, rng, table) {\n      var caretPos = CaretPosition$1.fromRangeStart(rng);\n      return positionIn(!forward, table).exists(function (pos) {\n        return pos.isEqual(caretPos);\n      });\n    };\n    var navigateHorizontally = function (editor, forward, table, _td) {\n      var rng = editor.selection.getRng();\n      var direction = forward ? 1 : -1;\n      if (isFakeCaretTableBrowser() && isCaretAtStartOrEndOfTable(forward, rng, table)) {\n        showCaret(direction, editor, table, !forward, false).each(function (newRng) {\n          moveToRange(editor, newRng);\n        });\n        return true;\n      }\n      return false;\n    };\n    var getClosestAbovePosition = function (root, table, start) {\n      return findClosestPositionInAboveCell(table, start).orThunk(function () {\n        return head(start.getClientRects()).bind(function (rect) {\n          return findClosestHorizontalPositionFromPoint(getPositionsAbove(root, CaretPosition$1.before(table)), rect.left);\n        });\n      }).getOr(CaretPosition$1.before(table));\n    };\n    var getClosestBelowPosition = function (root, table, start) {\n      return findClosestPositionInBelowCell(table, start).orThunk(function () {\n        return head(start.getClientRects()).bind(function (rect) {\n          return findClosestHorizontalPositionFromPoint(getPositionsBelow(root, CaretPosition$1.after(table)), rect.left);\n        });\n      }).getOr(CaretPosition$1.after(table));\n    };\n    var getTable = function (previous, pos) {\n      var node = pos.getNode(previous);\n      return isElement$1(node) && node.nodeName === 'TABLE' ? Optional.some(node) : Optional.none();\n    };\n    var renderBlock = function (down, editor, table, pos) {\n      var forcedRootBlock = getForcedRootBlock(editor);\n      if (forcedRootBlock) {\n        editor.undoManager.transact(function () {\n          var element = SugarElement.fromTag(forcedRootBlock);\n          setAll(element, getForcedRootBlockAttrs(editor));\n          append(element, SugarElement.fromTag('br'));\n          if (down) {\n            after(SugarElement.fromDom(table), element);\n          } else {\n            before(SugarElement.fromDom(table), element);\n          }\n          var rng = editor.dom.createRng();\n          rng.setStart(element.dom, 0);\n          rng.setEnd(element.dom, 0);\n          moveToRange(editor, rng);\n        });\n      } else {\n        moveToRange(editor, pos.toRange());\n      }\n    };\n    var moveCaret = function (editor, down, pos) {\n      var table = down ? getTable(true, pos) : getTable(false, pos);\n      var last = down === false;\n      table.fold(function () {\n        return moveToRange(editor, pos.toRange());\n      }, function (table) {\n        return positionIn(last, editor.getBody()).filter(function (lastPos) {\n          return lastPos.isEqual(pos);\n        }).fold(function () {\n          return moveToRange(editor, pos.toRange());\n        }, function (_) {\n          return renderBlock(down, editor, table, pos);\n        });\n      });\n    };\n    var navigateVertically = function (editor, down, table, td) {\n      var rng = editor.selection.getRng();\n      var pos = CaretPosition$1.fromRangeStart(rng);\n      var root = editor.getBody();\n      if (!down && isAtFirstTableCellLine(td, pos)) {\n        var newPos = getClosestAbovePosition(root, table, pos);\n        moveCaret(editor, down, newPos);\n        return true;\n      } else if (down && isAtLastTableCellLine(td, pos)) {\n        var newPos = getClosestBelowPosition(root, table, pos);\n        moveCaret(editor, down, newPos);\n        return true;\n      } else {\n        return false;\n      }\n    };\n    var move$1 = function (editor, forward, mover) {\n      return Optional.from(editor.dom.getParent(editor.selection.getNode(), 'td,th')).bind(function (td) {\n        return Optional.from(editor.dom.getParent(td, 'table')).map(function (table) {\n          return mover(editor, forward, table, td);\n        });\n      }).getOr(false);\n    };\n    var moveH$2 = function (editor, forward) {\n      return move$1(editor, forward, navigateHorizontally);\n    };\n    var moveV$3 = function (editor, forward) {\n      return move$1(editor, forward, navigateVertically);\n    };\n\n    var executeKeydownOverride = function (editor, caret, evt) {\n      var os = detect$3().os;\n      execute([\n        {\n          keyCode: VK.RIGHT,\n          action: action(moveH, editor, true)\n        },\n        {\n          keyCode: VK.LEFT,\n          action: action(moveH, editor, false)\n        },\n        {\n          keyCode: VK.UP,\n          action: action(moveV, editor, false)\n        },\n        {\n          keyCode: VK.DOWN,\n          action: action(moveV, editor, true)\n        },\n        {\n          keyCode: VK.RIGHT,\n          action: action(moveH$2, editor, true)\n        },\n        {\n          keyCode: VK.LEFT,\n          action: action(moveH$2, editor, false)\n        },\n        {\n          keyCode: VK.UP,\n          action: action(moveV$3, editor, false)\n        },\n        {\n          keyCode: VK.DOWN,\n          action: action(moveV$3, editor, true)\n        },\n        {\n          keyCode: VK.RIGHT,\n          action: action(moveH$1, editor, true)\n        },\n        {\n          keyCode: VK.LEFT,\n          action: action(moveH$1, editor, false)\n        },\n        {\n          keyCode: VK.UP,\n          action: action(moveV$2, editor, false)\n        },\n        {\n          keyCode: VK.DOWN,\n          action: action(moveV$2, editor, true)\n        },\n        {\n          keyCode: VK.RIGHT,\n          action: action(move, editor, caret, true)\n        },\n        {\n          keyCode: VK.LEFT,\n          action: action(move, editor, caret, false)\n        },\n        {\n          keyCode: VK.RIGHT,\n          ctrlKey: !os.isOSX(),\n          altKey: os.isOSX(),\n          action: action(moveNextWord, editor, caret)\n        },\n        {\n          keyCode: VK.LEFT,\n          ctrlKey: !os.isOSX(),\n          altKey: os.isOSX(),\n          action: action(movePrevWord, editor, caret)\n        },\n        {\n          keyCode: VK.UP,\n          action: action(moveV$1, editor, false)\n        },\n        {\n          keyCode: VK.DOWN,\n          action: action(moveV$1, editor, true)\n        }\n      ], evt).each(function (_) {\n        evt.preventDefault();\n      });\n    };\n    var setup$c = function (editor, caret) {\n      editor.on('keydown', function (evt) {\n        if (evt.isDefaultPrevented() === false) {\n          executeKeydownOverride(editor, caret, evt);\n        }\n      });\n    };\n\n    var executeKeydownOverride$1 = function (editor, caret, evt) {\n      execute([\n        {\n          keyCode: VK.BACKSPACE,\n          action: action(backspaceDelete$9, editor, false)\n        },\n        {\n          keyCode: VK.BACKSPACE,\n          action: action(backspaceDelete$4, editor, false)\n        },\n        {\n          keyCode: VK.DELETE,\n          action: action(backspaceDelete$4, editor, true)\n        },\n        {\n          keyCode: VK.BACKSPACE,\n          action: action(backspaceDelete$3, editor, false)\n        },\n        {\n          keyCode: VK.DELETE,\n          action: action(backspaceDelete$3, editor, true)\n        },\n        {\n          keyCode: VK.BACKSPACE,\n          action: action(backspaceDelete$6, editor, caret, false)\n        },\n        {\n          keyCode: VK.DELETE,\n          action: action(backspaceDelete$6, editor, caret, true)\n        },\n        {\n          keyCode: VK.BACKSPACE,\n          action: action(backspaceDelete, editor, false)\n        },\n        {\n          keyCode: VK.DELETE,\n          action: action(backspaceDelete, editor, true)\n        },\n        {\n          keyCode: VK.BACKSPACE,\n          action: action(backspaceDelete$5, editor, false)\n        },\n        {\n          keyCode: VK.DELETE,\n          action: action(backspaceDelete$5, editor, true)\n        },\n        {\n          keyCode: VK.BACKSPACE,\n          action: action(backspaceDelete$8, editor, false)\n        },\n        {\n          keyCode: VK.DELETE,\n          action: action(backspaceDelete$8, editor, true)\n        },\n        {\n          keyCode: VK.BACKSPACE,\n          action: action(backspaceDelete$2, editor, false)\n        },\n        {\n          keyCode: VK.DELETE,\n          action: action(backspaceDelete$2, editor, true)\n        },\n        {\n          keyCode: VK.BACKSPACE,\n          action: action(backspaceDelete$1, editor, false)\n        },\n        {\n          keyCode: VK.DELETE,\n          action: action(backspaceDelete$1, editor, true)\n        },\n        {\n          keyCode: VK.BACKSPACE,\n          action: action(backspaceDelete$7, editor, false)\n        },\n        {\n          keyCode: VK.DELETE,\n          action: action(backspaceDelete$7, editor, true)\n        }\n      ], evt).each(function (_) {\n        evt.preventDefault();\n      });\n    };\n    var executeKeyupOverride = function (editor, evt) {\n      execute([\n        {\n          keyCode: VK.BACKSPACE,\n          action: action(paddEmptyElement, editor)\n        },\n        {\n          keyCode: VK.DELETE,\n          action: action(paddEmptyElement, editor)\n        }\n      ], evt);\n    };\n    var setup$d = function (editor, caret) {\n      editor.on('keydown', function (evt) {\n        if (evt.isDefaultPrevented() === false) {\n          executeKeydownOverride$1(editor, caret, evt);\n        }\n      });\n      editor.on('keyup', function (evt) {\n        if (evt.isDefaultPrevented() === false) {\n          executeKeyupOverride(editor, evt);\n        }\n      });\n    };\n\n    var firstNonWhiteSpaceNodeSibling = function (node) {\n      while (node) {\n        if (node.nodeType === 1 || node.nodeType === 3 && node.data && /[\\r\\n\\s]/.test(node.data)) {\n          return node;\n        }\n        node = node.nextSibling;\n      }\n    };\n    var moveToCaretPosition = function (editor, root) {\n      var node, lastNode = root;\n      var dom = editor.dom;\n      var moveCaretBeforeOnEnterElementsMap = editor.schema.getMoveCaretBeforeOnEnterElements();\n      if (!root) {\n        return;\n      }\n      if (/^(LI|DT|DD)$/.test(root.nodeName)) {\n        var firstChild = firstNonWhiteSpaceNodeSibling(root.firstChild);\n        if (firstChild && /^(UL|OL|DL)$/.test(firstChild.nodeName)) {\n          root.insertBefore(dom.doc.createTextNode(nbsp), root.firstChild);\n        }\n      }\n      var rng = dom.createRng();\n      root.normalize();\n      if (root.hasChildNodes()) {\n        var walker = new DomTreeWalker(root, root);\n        while (node = walker.current()) {\n          if (isText$1(node)) {\n            rng.setStart(node, 0);\n            rng.setEnd(node, 0);\n            break;\n          }\n          if (moveCaretBeforeOnEnterElementsMap[node.nodeName.toLowerCase()]) {\n            rng.setStartBefore(node);\n            rng.setEndBefore(node);\n            break;\n          }\n          lastNode = node;\n          node = walker.next();\n        }\n        if (!node) {\n          rng.setStart(lastNode, 0);\n          rng.setEnd(lastNode, 0);\n        }\n      } else {\n        if (isBr(root)) {\n          if (root.nextSibling && dom.isBlock(root.nextSibling)) {\n            rng.setStartBefore(root);\n            rng.setEndBefore(root);\n          } else {\n            rng.setStartAfter(root);\n            rng.setEndAfter(root);\n          }\n        } else {\n          rng.setStart(root, 0);\n          rng.setEnd(root, 0);\n        }\n      }\n      editor.selection.setRng(rng);\n      scrollRangeIntoView(editor, rng);\n    };\n    var getEditableRoot = function (dom, node) {\n      var root = dom.getRoot();\n      var parent, editableRoot;\n      parent = node;\n      while (parent !== root && dom.getContentEditable(parent) !== 'false') {\n        if (dom.getContentEditable(parent) === 'true') {\n          editableRoot = parent;\n        }\n        parent = parent.parentNode;\n      }\n      return parent !== root ? editableRoot : root;\n    };\n    var getParentBlock$2 = function (editor) {\n      return Optional.from(editor.dom.getParent(editor.selection.getStart(true), editor.dom.isBlock));\n    };\n    var getParentBlockName = function (editor) {\n      return getParentBlock$2(editor).fold(constant(''), function (parentBlock) {\n        return parentBlock.nodeName.toUpperCase();\n      });\n    };\n    var isListItemParentBlock = function (editor) {\n      return getParentBlock$2(editor).filter(function (elm) {\n        return isListItem(SugarElement.fromDom(elm));\n      }).isSome();\n    };\n\n    var hasFirstChild = function (elm, name) {\n      return elm.firstChild && elm.firstChild.nodeName === name;\n    };\n    var hasParent$1 = function (elm, parentName) {\n      return elm && elm.parentNode && elm.parentNode.nodeName === parentName;\n    };\n    var isListBlock = function (elm) {\n      return elm && /^(OL|UL|LI)$/.test(elm.nodeName);\n    };\n    var isNestedList = function (elm) {\n      return isListBlock(elm) && isListBlock(elm.parentNode);\n    };\n    var getContainerBlock = function (containerBlock) {\n      var containerBlockParent = containerBlock.parentNode;\n      if (/^(LI|DT|DD)$/.test(containerBlockParent.nodeName)) {\n        return containerBlockParent;\n      }\n      return containerBlock;\n    };\n    var isFirstOrLastLi = function (containerBlock, parentBlock, first) {\n      var node = containerBlock[first ? 'firstChild' : 'lastChild'];\n      while (node) {\n        if (isElement$1(node)) {\n          break;\n        }\n        node = node[first ? 'nextSibling' : 'previousSibling'];\n      }\n      return node === parentBlock;\n    };\n    var insert = function (editor, createNewBlock, containerBlock, parentBlock, newBlockName) {\n      var dom = editor.dom;\n      var rng = editor.selection.getRng();\n      if (containerBlock === editor.getBody()) {\n        return;\n      }\n      if (isNestedList(containerBlock)) {\n        newBlockName = 'LI';\n      }\n      var newBlock = newBlockName ? createNewBlock(newBlockName) : dom.create('BR');\n      if (isFirstOrLastLi(containerBlock, parentBlock, true) && isFirstOrLastLi(containerBlock, parentBlock, false)) {\n        if (hasParent$1(containerBlock, 'LI')) {\n          dom.insertAfter(newBlock, getContainerBlock(containerBlock));\n        } else {\n          dom.replace(newBlock, containerBlock);\n        }\n      } else if (isFirstOrLastLi(containerBlock, parentBlock, true)) {\n        if (hasParent$1(containerBlock, 'LI')) {\n          dom.insertAfter(newBlock, getContainerBlock(containerBlock));\n          newBlock.appendChild(dom.doc.createTextNode(' '));\n          newBlock.appendChild(containerBlock);\n        } else {\n          containerBlock.parentNode.insertBefore(newBlock, containerBlock);\n        }\n      } else if (isFirstOrLastLi(containerBlock, parentBlock, false)) {\n        dom.insertAfter(newBlock, getContainerBlock(containerBlock));\n      } else {\n        containerBlock = getContainerBlock(containerBlock);\n        var tmpRng = rng.cloneRange();\n        tmpRng.setStartAfter(parentBlock);\n        tmpRng.setEndAfter(containerBlock);\n        var fragment = tmpRng.extractContents();\n        if (newBlockName === 'LI' && hasFirstChild(fragment, 'LI')) {\n          newBlock = fragment.firstChild;\n          dom.insertAfter(fragment, containerBlock);\n        } else {\n          dom.insertAfter(fragment, containerBlock);\n          dom.insertAfter(newBlock, containerBlock);\n        }\n      }\n      dom.remove(parentBlock);\n      moveToCaretPosition(editor, newBlock);\n    };\n\n    var trimZwsp = function (fragment) {\n      each(descendants(SugarElement.fromDom(fragment), isText), function (text) {\n        var rawNode = text.dom;\n        rawNode.nodeValue = trim$2(rawNode.nodeValue);\n      });\n    };\n    var isEmptyAnchor = function (dom, elm) {\n      return elm && elm.nodeName === 'A' && dom.isEmpty(elm);\n    };\n    var isTableCell$5 = function (node) {\n      return node && /^(TD|TH|CAPTION)$/.test(node.nodeName);\n    };\n    var emptyBlock = function (elm) {\n      elm.innerHTML = '<br data-mce-bogus=\"1\">';\n    };\n    var containerAndSiblingName = function (container, nodeName) {\n      return container.nodeName === nodeName || container.previousSibling && container.previousSibling.nodeName === nodeName;\n    };\n    var canSplitBlock = function (dom, node) {\n      return node && dom.isBlock(node) && !/^(TD|TH|CAPTION|FORM)$/.test(node.nodeName) && !/^(fixed|absolute)/i.test(node.style.position) && dom.getContentEditable(node) !== 'true';\n    };\n    var trimInlineElementsOnLeftSideOfBlock = function (dom, nonEmptyElementsMap, block) {\n      var node = block;\n      var firstChilds = [];\n      var i;\n      if (!node) {\n        return;\n      }\n      while (node = node.firstChild) {\n        if (dom.isBlock(node)) {\n          return;\n        }\n        if (isElement$1(node) && !nonEmptyElementsMap[node.nodeName.toLowerCase()]) {\n          firstChilds.push(node);\n        }\n      }\n      i = firstChilds.length;\n      while (i--) {\n        node = firstChilds[i];\n        if (!node.hasChildNodes() || node.firstChild === node.lastChild && node.firstChild.nodeValue === '') {\n          dom.remove(node);\n        } else {\n          if (isEmptyAnchor(dom, node)) {\n            dom.remove(node);\n          }\n        }\n      }\n    };\n    var normalizeZwspOffset = function (start, container, offset) {\n      if (isText$1(container) === false) {\n        return offset;\n      } else if (start) {\n        return offset === 1 && container.data.charAt(offset - 1) === ZWSP ? 0 : offset;\n      } else {\n        return offset === container.data.length - 1 && container.data.charAt(offset) === ZWSP ? container.data.length : offset;\n      }\n    };\n    var includeZwspInRange = function (rng) {\n      var newRng = rng.cloneRange();\n      newRng.setStart(rng.startContainer, normalizeZwspOffset(true, rng.startContainer, rng.startOffset));\n      newRng.setEnd(rng.endContainer, normalizeZwspOffset(false, rng.endContainer, rng.endOffset));\n      return newRng;\n    };\n    var trimLeadingLineBreaks = function (node) {\n      do {\n        if (isText$1(node)) {\n          node.nodeValue = node.nodeValue.replace(/^[\\r\\n]+/, '');\n        }\n        node = node.firstChild;\n      } while (node);\n    };\n    var getEditableRoot$1 = function (dom, node) {\n      var root = dom.getRoot();\n      var parent, editableRoot;\n      parent = node;\n      while (parent !== root && dom.getContentEditable(parent) !== 'false') {\n        if (dom.getContentEditable(parent) === 'true') {\n          editableRoot = parent;\n        }\n        parent = parent.parentNode;\n      }\n      return parent !== root ? editableRoot : root;\n    };\n    var applyAttributes = function (editor, node, forcedRootBlockAttrs) {\n      var dom = editor.dom;\n      Optional.from(forcedRootBlockAttrs.style).map(dom.parseStyle).each(function (attrStyles) {\n        var currentStyles = getAllRaw(SugarElement.fromDom(node));\n        var newStyles = __assign(__assign({}, currentStyles), attrStyles);\n        dom.setStyles(node, newStyles);\n      });\n      var attrClassesOpt = Optional.from(forcedRootBlockAttrs.class).map(function (attrClasses) {\n        return attrClasses.split(/\\s+/);\n      });\n      var currentClassesOpt = Optional.from(node.className).map(function (currentClasses) {\n        return filter(currentClasses.split(/\\s+/), function (clazz) {\n          return clazz !== '';\n        });\n      });\n      lift2(attrClassesOpt, currentClassesOpt, function (attrClasses, currentClasses) {\n        var filteredClasses = filter(currentClasses, function (clazz) {\n          return !contains(attrClasses, clazz);\n        });\n        var newClasses = __spreadArrays(attrClasses, filteredClasses);\n        dom.setAttrib(node, 'class', newClasses.join(' '));\n      });\n      var appliedAttrs = [\n        'style',\n        'class'\n      ];\n      var remainingAttrs = filter$1(forcedRootBlockAttrs, function (_, attrs) {\n        return !contains(appliedAttrs, attrs);\n      });\n      dom.setAttribs(node, remainingAttrs);\n    };\n    var setForcedBlockAttrs = function (editor, node) {\n      var forcedRootBlockName = getForcedRootBlock(editor);\n      if (forcedRootBlockName && forcedRootBlockName.toLowerCase() === node.tagName.toLowerCase()) {\n        var forcedRootBlockAttrs = getForcedRootBlockAttrs(editor);\n        applyAttributes(editor, node, forcedRootBlockAttrs);\n      }\n    };\n    var wrapSelfAndSiblingsInDefaultBlock = function (editor, newBlockName, rng, container, offset) {\n      var newBlock, parentBlock, startNode, node, next, rootBlockName;\n      var blockName = newBlockName || 'P';\n      var dom = editor.dom, editableRoot = getEditableRoot$1(dom, container);\n      parentBlock = dom.getParent(container, dom.isBlock);\n      if (!parentBlock || !canSplitBlock(dom, parentBlock)) {\n        parentBlock = parentBlock || editableRoot;\n        if (parentBlock === editor.getBody() || isTableCell$5(parentBlock)) {\n          rootBlockName = parentBlock.nodeName.toLowerCase();\n        } else {\n          rootBlockName = parentBlock.parentNode.nodeName.toLowerCase();\n        }\n        if (!parentBlock.hasChildNodes()) {\n          newBlock = dom.create(blockName);\n          setForcedBlockAttrs(editor, newBlock);\n          parentBlock.appendChild(newBlock);\n          rng.setStart(newBlock, 0);\n          rng.setEnd(newBlock, 0);\n          return newBlock;\n        }\n        node = container;\n        while (node.parentNode !== parentBlock) {\n          node = node.parentNode;\n        }\n        while (node && !dom.isBlock(node)) {\n          startNode = node;\n          node = node.previousSibling;\n        }\n        if (startNode && editor.schema.isValidChild(rootBlockName, blockName.toLowerCase())) {\n          newBlock = dom.create(blockName);\n          setForcedBlockAttrs(editor, newBlock);\n          startNode.parentNode.insertBefore(newBlock, startNode);\n          node = startNode;\n          while (node && !dom.isBlock(node)) {\n            next = node.nextSibling;\n            newBlock.appendChild(node);\n            node = next;\n          }\n          rng.setStart(container, offset);\n          rng.setEnd(container, offset);\n        }\n      }\n      return container;\n    };\n    var addBrToBlockIfNeeded = function (dom, block) {\n      block.normalize();\n      var lastChild = block.lastChild;\n      if (!lastChild || /^(left|right)$/gi.test(dom.getStyle(lastChild, 'float', true))) {\n        dom.add(block, 'br');\n      }\n    };\n    var insert$1 = function (editor, evt) {\n      var tmpRng, container, offset, parentBlock;\n      var newBlock, fragment, containerBlock, parentBlockName, newBlockName, isAfterLastNodeInContainer;\n      var dom = editor.dom;\n      var schema = editor.schema, nonEmptyElementsMap = schema.getNonEmptyElements();\n      var rng = editor.selection.getRng();\n      var createNewBlock = function (name) {\n        var node = container, block, clonedNode, caretNode;\n        var textInlineElements = schema.getTextInlineElements();\n        if (name || parentBlockName === 'TABLE' || parentBlockName === 'HR') {\n          block = dom.create(name || newBlockName);\n        } else {\n          block = parentBlock.cloneNode(false);\n        }\n        caretNode = block;\n        if (shouldKeepStyles(editor) === false) {\n          dom.setAttrib(block, 'style', null);\n          dom.setAttrib(block, 'class', null);\n        } else {\n          do {\n            if (textInlineElements[node.nodeName]) {\n              if (isCaretNode(node) || isBookmarkNode$1(node)) {\n                continue;\n              }\n              clonedNode = node.cloneNode(false);\n              dom.setAttrib(clonedNode, 'id', '');\n              if (block.hasChildNodes()) {\n                clonedNode.appendChild(block.firstChild);\n                block.appendChild(clonedNode);\n              } else {\n                caretNode = clonedNode;\n                block.appendChild(clonedNode);\n              }\n            }\n          } while ((node = node.parentNode) && node !== editableRoot);\n        }\n        setForcedBlockAttrs(editor, block);\n        emptyBlock(caretNode);\n        return block;\n      };\n      var isCaretAtStartOrEndOfBlock = function (start) {\n        var node, name;\n        var normalizedOffset = normalizeZwspOffset(start, container, offset);\n        if (isText$1(container) && (start ? normalizedOffset > 0 : normalizedOffset < container.nodeValue.length)) {\n          return false;\n        }\n        if (container.parentNode === parentBlock && isAfterLastNodeInContainer && !start) {\n          return true;\n        }\n        if (start && isElement$1(container) && container === parentBlock.firstChild) {\n          return true;\n        }\n        if (containerAndSiblingName(container, 'TABLE') || containerAndSiblingName(container, 'HR')) {\n          return isAfterLastNodeInContainer && !start || !isAfterLastNodeInContainer && start;\n        }\n        var walker = new DomTreeWalker(container, parentBlock);\n        if (isText$1(container)) {\n          if (start && normalizedOffset === 0) {\n            walker.prev();\n          } else if (!start && normalizedOffset === container.nodeValue.length) {\n            walker.next();\n          }\n        }\n        while (node = walker.current()) {\n          if (isElement$1(node)) {\n            if (!node.getAttribute('data-mce-bogus')) {\n              name = node.nodeName.toLowerCase();\n              if (nonEmptyElementsMap[name] && name !== 'br') {\n                return false;\n              }\n            }\n          } else if (isText$1(node) && !isWhitespaceText(node.nodeValue)) {\n            return false;\n          }\n          if (start) {\n            walker.prev();\n          } else {\n            walker.next();\n          }\n        }\n        return true;\n      };\n      var insertNewBlockAfter = function () {\n        if (/^(H[1-6]|PRE|FIGURE)$/.test(parentBlockName) && containerBlockName !== 'HGROUP') {\n          newBlock = createNewBlock(newBlockName);\n        } else {\n          newBlock = createNewBlock();\n        }\n        if (shouldEndContainerOnEmptyBlock(editor) && canSplitBlock(dom, containerBlock) && dom.isEmpty(parentBlock)) {\n          newBlock = dom.split(containerBlock, parentBlock);\n        } else {\n          dom.insertAfter(newBlock, parentBlock);\n        }\n        moveToCaretPosition(editor, newBlock);\n      };\n      normalize(dom, rng).each(function (normRng) {\n        rng.setStart(normRng.startContainer, normRng.startOffset);\n        rng.setEnd(normRng.endContainer, normRng.endOffset);\n      });\n      container = rng.startContainer;\n      offset = rng.startOffset;\n      newBlockName = getForcedRootBlock(editor);\n      var shiftKey = !!(evt && evt.shiftKey);\n      var ctrlKey = !!(evt && evt.ctrlKey);\n      if (isElement$1(container) && container.hasChildNodes()) {\n        isAfterLastNodeInContainer = offset > container.childNodes.length - 1;\n        container = container.childNodes[Math.min(offset, container.childNodes.length - 1)] || container;\n        if (isAfterLastNodeInContainer && isText$1(container)) {\n          offset = container.nodeValue.length;\n        } else {\n          offset = 0;\n        }\n      }\n      var editableRoot = getEditableRoot$1(dom, container);\n      if (!editableRoot) {\n        return;\n      }\n      if (newBlockName && !shiftKey || !newBlockName && shiftKey) {\n        container = wrapSelfAndSiblingsInDefaultBlock(editor, newBlockName, rng, container, offset);\n      }\n      parentBlock = dom.getParent(container, dom.isBlock);\n      containerBlock = parentBlock ? dom.getParent(parentBlock.parentNode, dom.isBlock) : null;\n      parentBlockName = parentBlock ? parentBlock.nodeName.toUpperCase() : '';\n      var containerBlockName = containerBlock ? containerBlock.nodeName.toUpperCase() : '';\n      if (containerBlockName === 'LI' && !ctrlKey) {\n        parentBlock = containerBlock;\n        containerBlock = containerBlock.parentNode;\n        parentBlockName = containerBlockName;\n      }\n      if (/^(LI|DT|DD)$/.test(parentBlockName)) {\n        if (dom.isEmpty(parentBlock)) {\n          insert(editor, createNewBlock, containerBlock, parentBlock, newBlockName);\n          return;\n        }\n      }\n      if (newBlockName && parentBlock === editor.getBody()) {\n        return;\n      }\n      newBlockName = newBlockName || 'P';\n      if (isCaretContainerBlock(parentBlock)) {\n        newBlock = showCaretContainerBlock(parentBlock);\n        if (dom.isEmpty(parentBlock)) {\n          emptyBlock(parentBlock);\n        }\n        setForcedBlockAttrs(editor, newBlock);\n        moveToCaretPosition(editor, newBlock);\n      } else if (isCaretAtStartOrEndOfBlock()) {\n        insertNewBlockAfter();\n      } else if (isCaretAtStartOrEndOfBlock(true)) {\n        newBlock = parentBlock.parentNode.insertBefore(createNewBlock(), parentBlock);\n        moveToCaretPosition(editor, containerAndSiblingName(parentBlock, 'HR') ? newBlock : parentBlock);\n      } else {\n        tmpRng = includeZwspInRange(rng).cloneRange();\n        tmpRng.setEndAfter(parentBlock);\n        fragment = tmpRng.extractContents();\n        trimZwsp(fragment);\n        trimLeadingLineBreaks(fragment);\n        newBlock = fragment.firstChild;\n        dom.insertAfter(fragment, parentBlock);\n        trimInlineElementsOnLeftSideOfBlock(dom, nonEmptyElementsMap, newBlock);\n        addBrToBlockIfNeeded(dom, parentBlock);\n        if (dom.isEmpty(parentBlock)) {\n          emptyBlock(parentBlock);\n        }\n        newBlock.normalize();\n        if (dom.isEmpty(newBlock)) {\n          dom.remove(newBlock);\n          insertNewBlockAfter();\n        } else {\n          setForcedBlockAttrs(editor, newBlock);\n          moveToCaretPosition(editor, newBlock);\n        }\n      }\n      dom.setAttrib(newBlock, 'id', '');\n      editor.fire('NewBlock', { newBlock: newBlock });\n    };\n\n    var hasRightSideContent = function (schema, container, parentBlock) {\n      var walker = new DomTreeWalker(container, parentBlock);\n      var node;\n      var nonEmptyElementsMap = schema.getNonEmptyElements();\n      while (node = walker.next()) {\n        if (nonEmptyElementsMap[node.nodeName.toLowerCase()] || node.length > 0) {\n          return true;\n        }\n      }\n    };\n    var scrollToBr = function (dom, selection, brElm) {\n      var marker = dom.create('span', {}, '&nbsp;');\n      brElm.parentNode.insertBefore(marker, brElm);\n      selection.scrollIntoView(marker);\n      dom.remove(marker);\n    };\n    var moveSelectionToBr = function (dom, selection, brElm, extraBr) {\n      var rng = dom.createRng();\n      if (!extraBr) {\n        rng.setStartAfter(brElm);\n        rng.setEndAfter(brElm);\n      } else {\n        rng.setStartBefore(brElm);\n        rng.setEndBefore(brElm);\n      }\n      selection.setRng(rng);\n    };\n    var insertBrAtCaret = function (editor, evt) {\n      var selection = editor.selection;\n      var dom = editor.dom;\n      var rng = selection.getRng();\n      var brElm;\n      var extraBr;\n      normalize(dom, rng).each(function (normRng) {\n        rng.setStart(normRng.startContainer, normRng.startOffset);\n        rng.setEnd(normRng.endContainer, normRng.endOffset);\n      });\n      var offset = rng.startOffset;\n      var container = rng.startContainer;\n      if (container.nodeType === 1 && container.hasChildNodes()) {\n        var isAfterLastNodeInContainer = offset > container.childNodes.length - 1;\n        container = container.childNodes[Math.min(offset, container.childNodes.length - 1)] || container;\n        if (isAfterLastNodeInContainer && container.nodeType === 3) {\n          offset = container.nodeValue.length;\n        } else {\n          offset = 0;\n        }\n      }\n      var parentBlock = dom.getParent(container, dom.isBlock);\n      var containerBlock = parentBlock ? dom.getParent(parentBlock.parentNode, dom.isBlock) : null;\n      var containerBlockName = containerBlock ? containerBlock.nodeName.toUpperCase() : '';\n      var isControlKey = !!(evt && evt.ctrlKey);\n      if (containerBlockName === 'LI' && !isControlKey) {\n        parentBlock = containerBlock;\n      }\n      if (container && container.nodeType === 3 && offset >= container.nodeValue.length) {\n        if (!hasRightSideContent(editor.schema, container, parentBlock)) {\n          brElm = dom.create('br');\n          rng.insertNode(brElm);\n          rng.setStartAfter(brElm);\n          rng.setEndAfter(brElm);\n          extraBr = true;\n        }\n      }\n      brElm = dom.create('br');\n      rangeInsertNode(dom, rng, brElm);\n      scrollToBr(dom, selection, brElm);\n      moveSelectionToBr(dom, selection, brElm, extraBr);\n      editor.undoManager.add();\n    };\n    var insertBrBefore = function (editor, inline) {\n      var br = SugarElement.fromTag('br');\n      before(SugarElement.fromDom(inline), br);\n      editor.undoManager.add();\n    };\n    var insertBrAfter = function (editor, inline) {\n      if (!hasBrAfter(editor.getBody(), inline)) {\n        after(SugarElement.fromDom(inline), SugarElement.fromTag('br'));\n      }\n      var br = SugarElement.fromTag('br');\n      after(SugarElement.fromDom(inline), br);\n      scrollToBr(editor.dom, editor.selection, br.dom);\n      moveSelectionToBr(editor.dom, editor.selection, br.dom, false);\n      editor.undoManager.add();\n    };\n    var isBeforeBr$1 = function (pos) {\n      return isBr(pos.getNode());\n    };\n    var hasBrAfter = function (rootNode, startNode) {\n      if (isBeforeBr$1(CaretPosition$1.after(startNode))) {\n        return true;\n      } else {\n        return nextPosition(rootNode, CaretPosition$1.after(startNode)).map(function (pos) {\n          return isBr(pos.getNode());\n        }).getOr(false);\n      }\n    };\n    var isAnchorLink = function (elm) {\n      return elm && elm.nodeName === 'A' && 'href' in elm;\n    };\n    var isInsideAnchor = function (location) {\n      return location.fold(never, isAnchorLink, isAnchorLink, never);\n    };\n    var readInlineAnchorLocation = function (editor) {\n      var isInlineTarget$1 = curry(isInlineTarget, editor);\n      var position = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n      return readLocation(isInlineTarget$1, editor.getBody(), position).filter(isInsideAnchor);\n    };\n    var insertBrOutsideAnchor = function (editor, location) {\n      location.fold(noop, curry(insertBrBefore, editor), curry(insertBrAfter, editor), noop);\n    };\n    var insert$2 = function (editor, evt) {\n      var anchorLocation = readInlineAnchorLocation(editor);\n      if (anchorLocation.isSome()) {\n        anchorLocation.each(curry(insertBrOutsideAnchor, editor));\n      } else {\n        insertBrAtCaret(editor, evt);\n      }\n    };\n\n    var matchesSelector = function (editor, selector) {\n      return getParentBlock$2(editor).filter(function (parentBlock) {\n        return selector.length > 0 && is$1(SugarElement.fromDom(parentBlock), selector);\n      }).isSome();\n    };\n    var shouldInsertBr = function (editor) {\n      return matchesSelector(editor, getBrNewLineSelector(editor));\n    };\n    var shouldBlockNewLine = function (editor) {\n      return matchesSelector(editor, getNoNewLineSelector(editor));\n    };\n\n    var newLineAction = Adt.generate([\n      { br: [] },\n      { block: [] },\n      { none: [] }\n    ]);\n    var shouldBlockNewLine$1 = function (editor, _shiftKey) {\n      return shouldBlockNewLine(editor);\n    };\n    var isBrMode = function (requiredState) {\n      return function (editor, _shiftKey) {\n        var brMode = getForcedRootBlock(editor) === '';\n        return brMode === requiredState;\n      };\n    };\n    var inListBlock = function (requiredState) {\n      return function (editor, _shiftKey) {\n        return isListItemParentBlock(editor) === requiredState;\n      };\n    };\n    var inBlock = function (blockName, requiredState) {\n      return function (editor, _shiftKey) {\n        var state = getParentBlockName(editor) === blockName.toUpperCase();\n        return state === requiredState;\n      };\n    };\n    var inPreBlock = function (requiredState) {\n      return inBlock('pre', requiredState);\n    };\n    var inSummaryBlock = function () {\n      return inBlock('summary', true);\n    };\n    var shouldPutBrInPre$1 = function (requiredState) {\n      return function (editor, _shiftKey) {\n        return shouldPutBrInPre(editor) === requiredState;\n      };\n    };\n    var inBrContext = function (editor, _shiftKey) {\n      return shouldInsertBr(editor);\n    };\n    var hasShiftKey = function (_editor, shiftKey) {\n      return shiftKey;\n    };\n    var canInsertIntoEditableRoot = function (editor) {\n      var forcedRootBlock = getForcedRootBlock(editor);\n      var rootEditable = getEditableRoot(editor.dom, editor.selection.getStart());\n      return rootEditable && editor.schema.isValidChild(rootEditable.nodeName, forcedRootBlock ? forcedRootBlock : 'P');\n    };\n    var match$2 = function (predicates, action) {\n      return function (editor, shiftKey) {\n        var isMatch = foldl(predicates, function (res, p) {\n          return res && p(editor, shiftKey);\n        }, true);\n        return isMatch ? Optional.some(action) : Optional.none();\n      };\n    };\n    var getAction$1 = function (editor, evt) {\n      return evaluateUntil([\n        match$2([shouldBlockNewLine$1], newLineAction.none()),\n        match$2([inSummaryBlock()], newLineAction.br()),\n        match$2([\n          inPreBlock(true),\n          shouldPutBrInPre$1(false),\n          hasShiftKey\n        ], newLineAction.br()),\n        match$2([\n          inPreBlock(true),\n          shouldPutBrInPre$1(false)\n        ], newLineAction.block()),\n        match$2([\n          inPreBlock(true),\n          shouldPutBrInPre$1(true),\n          hasShiftKey\n        ], newLineAction.block()),\n        match$2([\n          inPreBlock(true),\n          shouldPutBrInPre$1(true)\n        ], newLineAction.br()),\n        match$2([\n          inListBlock(true),\n          hasShiftKey\n        ], newLineAction.br()),\n        match$2([inListBlock(true)], newLineAction.block()),\n        match$2([\n          isBrMode(true),\n          hasShiftKey,\n          canInsertIntoEditableRoot\n        ], newLineAction.block()),\n        match$2([isBrMode(true)], newLineAction.br()),\n        match$2([inBrContext], newLineAction.br()),\n        match$2([\n          isBrMode(false),\n          hasShiftKey\n        ], newLineAction.br()),\n        match$2([canInsertIntoEditableRoot], newLineAction.block())\n      ], [\n        editor,\n        !!(evt && evt.shiftKey)\n      ]).getOr(newLineAction.none());\n    };\n\n    var insert$3 = function (editor, evt) {\n      getAction$1(editor, evt).fold(function () {\n        insert$2(editor, evt);\n      }, function () {\n        insert$1(editor, evt);\n      }, noop);\n    };\n\n    var handleEnterKeyEvent = function (editor, event) {\n      if (event.isDefaultPrevented()) {\n        return;\n      }\n      event.preventDefault();\n      endTypingLevelIgnoreLocks(editor.undoManager);\n      editor.undoManager.transact(function () {\n        if (editor.selection.isCollapsed() === false) {\n          editor.execCommand('Delete');\n        }\n        insert$3(editor, event);\n      });\n    };\n    var setup$e = function (editor) {\n      editor.on('keydown', function (event) {\n        if (event.keyCode === VK.ENTER) {\n          handleEnterKeyEvent(editor, event);\n        }\n      });\n    };\n\n    var executeKeydownOverride$2 = function (editor, evt) {\n      execute([\n        {\n          keyCode: VK.END,\n          action: action(moveToLineEndPoint$1, editor, true)\n        },\n        {\n          keyCode: VK.HOME,\n          action: action(moveToLineEndPoint$1, editor, false)\n        },\n        {\n          keyCode: VK.END,\n          action: action(moveToLineEndPoint$2, editor, true)\n        },\n        {\n          keyCode: VK.HOME,\n          action: action(moveToLineEndPoint$2, editor, false)\n        }\n      ], evt).each(function (_) {\n        evt.preventDefault();\n      });\n    };\n    var setup$f = function (editor) {\n      editor.on('keydown', function (evt) {\n        if (evt.isDefaultPrevented() === false) {\n          executeKeydownOverride$2(editor, evt);\n        }\n      });\n    };\n\n    var browser$4 = detect$3().browser;\n    var setupIeInput = function (editor) {\n      var keypressThrotter = first(function () {\n        if (!editor.composing) {\n          normalizeNbspsInEditor(editor);\n        }\n      }, 0);\n      if (browser$4.isIE()) {\n        editor.on('keypress', function (_e) {\n          keypressThrotter.throttle();\n        });\n        editor.on('remove', function (_e) {\n          keypressThrotter.cancel();\n        });\n      }\n    };\n    var setup$g = function (editor) {\n      setupIeInput(editor);\n      editor.on('input', function (e) {\n        if (e.isComposing === false) {\n          normalizeNbspsInEditor(editor);\n        }\n      });\n    };\n\n    var insertTextAtPosition = function (text, pos) {\n      var container = pos.container();\n      var offset = pos.offset();\n      if (isText$1(container)) {\n        container.insertData(offset, text);\n        return Optional.some(CaretPosition(container, offset + text.length));\n      } else {\n        return getElementFromPosition(pos).map(function (elm) {\n          var textNode = SugarElement.fromText(text);\n          if (pos.isAtEnd()) {\n            after(elm, textNode);\n          } else {\n            before(elm, textNode);\n          }\n          return CaretPosition(textNode.dom, text.length);\n        });\n      }\n    };\n    var insertNbspAtPosition = curry(insertTextAtPosition, nbsp);\n    var insertSpaceAtPosition = curry(insertTextAtPosition, ' ');\n\n    var locationToCaretPosition = function (root) {\n      return function (location) {\n        return location.fold(function (element) {\n          return prevPosition(root.dom, CaretPosition$1.before(element));\n        }, function (element) {\n          return firstPositionIn(element);\n        }, function (element) {\n          return lastPositionIn(element);\n        }, function (element) {\n          return nextPosition(root.dom, CaretPosition$1.after(element));\n        });\n      };\n    };\n    var insertInlineBoundarySpaceOrNbsp = function (root, pos) {\n      return function (checkPos) {\n        return needsToHaveNbsp(root, checkPos) ? insertNbspAtPosition(pos) : insertSpaceAtPosition(pos);\n      };\n    };\n    var setSelection$1 = function (editor) {\n      return function (pos) {\n        editor.selection.setRng(pos.toRange());\n        editor.nodeChanged();\n        return true;\n      };\n    };\n    var insertSpaceOrNbspAtSelection = function (editor) {\n      var pos = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n      var root = SugarElement.fromDom(editor.getBody());\n      if (editor.selection.isCollapsed()) {\n        var isInlineTarget$1 = curry(isInlineTarget, editor);\n        var caretPosition = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n        return readLocation(isInlineTarget$1, editor.getBody(), caretPosition).bind(locationToCaretPosition(root)).bind(insertInlineBoundarySpaceOrNbsp(root, pos)).exists(setSelection$1(editor));\n      } else {\n        return false;\n      }\n    };\n\n    var executeKeydownOverride$3 = function (editor, evt) {\n      execute([{\n          keyCode: VK.SPACEBAR,\n          action: action(insertSpaceOrNbspAtSelection, editor)\n        }], evt).each(function (_) {\n        evt.preventDefault();\n      });\n    };\n    var setup$h = function (editor) {\n      editor.on('keydown', function (evt) {\n        if (evt.isDefaultPrevented() === false) {\n          executeKeydownOverride$3(editor, evt);\n        }\n      });\n    };\n\n    var registerKeyboardOverrides = function (editor) {\n      var caret = setupSelectedState(editor);\n      setup$b(editor);\n      setup$c(editor, caret);\n      setup$d(editor, caret);\n      setup$e(editor);\n      setup$h(editor);\n      setup$g(editor);\n      setup$f(editor);\n      return caret;\n    };\n    var setup$i = function (editor) {\n      if (!isRtc(editor)) {\n        return registerKeyboardOverrides(editor);\n      } else {\n        return Cell(null);\n      }\n    };\n\n    var NodeChange = function () {\n      function NodeChange(editor) {\n        this.lastPath = [];\n        this.editor = editor;\n        var lastRng;\n        var self = this;\n        if (!('onselectionchange' in editor.getDoc())) {\n          editor.on('NodeChange click mouseup keyup focus', function (e) {\n            var nativeRng = editor.selection.getRng();\n            var fakeRng = {\n              startContainer: nativeRng.startContainer,\n              startOffset: nativeRng.startOffset,\n              endContainer: nativeRng.endContainer,\n              endOffset: nativeRng.endOffset\n            };\n            if (e.type === 'nodechange' || !isEq$1(fakeRng, lastRng)) {\n              editor.fire('SelectionChange');\n            }\n            lastRng = fakeRng;\n          });\n        }\n        editor.on('contextmenu', function () {\n          editor.fire('SelectionChange');\n        });\n        editor.on('SelectionChange', function () {\n          var startElm = editor.selection.getStart(true);\n          if (!startElm || !Env.range && editor.selection.isCollapsed()) {\n            return;\n          }\n          if (hasAnyRanges(editor) && !self.isSameElementPath(startElm) && editor.dom.isChildOf(startElm, editor.getBody())) {\n            editor.nodeChanged({ selectionChange: true });\n          }\n        });\n        editor.on('mouseup', function (e) {\n          if (!e.isDefaultPrevented() && hasAnyRanges(editor)) {\n            if (editor.selection.getNode().nodeName === 'IMG') {\n              Delay.setEditorTimeout(editor, function () {\n                editor.nodeChanged();\n              });\n            } else {\n              editor.nodeChanged();\n            }\n          }\n        });\n      }\n      NodeChange.prototype.nodeChanged = function (args) {\n        var selection = this.editor.selection;\n        var node, parents, root;\n        if (this.editor.initialized && selection && !shouldDisableNodeChange(this.editor) && !this.editor.mode.isReadOnly()) {\n          root = this.editor.getBody();\n          node = selection.getStart(true) || root;\n          if (node.ownerDocument !== this.editor.getDoc() || !this.editor.dom.isChildOf(node, root)) {\n            node = root;\n          }\n          parents = [];\n          this.editor.dom.getParent(node, function (node) {\n            if (node === root) {\n              return true;\n            }\n            parents.push(node);\n          });\n          args = args || {};\n          args.element = node;\n          args.parents = parents;\n          this.editor.fire('NodeChange', args);\n        }\n      };\n      NodeChange.prototype.isSameElementPath = function (startElm) {\n        var i;\n        var currentPath = this.editor.$(startElm).parentsUntil(this.editor.getBody()).add(startElm);\n        if (currentPath.length === this.lastPath.length) {\n          for (i = currentPath.length; i >= 0; i--) {\n            if (currentPath[i] !== this.lastPath[i]) {\n              break;\n            }\n          }\n          if (i === -1) {\n            this.lastPath = currentPath;\n            return true;\n          }\n        }\n        this.lastPath = currentPath;\n        return false;\n      };\n      return NodeChange;\n    }();\n\n    var preventSummaryToggle = function (editor) {\n      editor.on('click', function (e) {\n        if (editor.dom.getParent(e.target, 'details')) {\n          e.preventDefault();\n        }\n      });\n    };\n    var filterDetails = function (editor) {\n      editor.parser.addNodeFilter('details', function (elms) {\n        each(elms, function (details) {\n          details.attr('data-mce-open', details.attr('open'));\n          details.attr('open', 'open');\n        });\n      });\n      editor.serializer.addNodeFilter('details', function (elms) {\n        each(elms, function (details) {\n          var open = details.attr('data-mce-open');\n          details.attr('open', isString(open) ? open : null);\n          details.attr('data-mce-open', null);\n        });\n      });\n    };\n    var setup$j = function (editor) {\n      preventSummaryToggle(editor);\n      filterDetails(editor);\n    };\n\n    var isTextBlockNode = function (node) {\n      return isElement$1(node) && isTextBlock(SugarElement.fromDom(node));\n    };\n    var normalizeSelection$1 = function (editor) {\n      var rng = editor.selection.getRng();\n      var startPos = CaretPosition.fromRangeStart(rng);\n      var endPos = CaretPosition.fromRangeEnd(rng);\n      if (CaretPosition.isElementPosition(startPos)) {\n        var container = startPos.container();\n        if (isTextBlockNode(container)) {\n          firstPositionIn(container).each(function (pos) {\n            return rng.setStart(pos.container(), pos.offset());\n          });\n        }\n      }\n      if (CaretPosition.isElementPosition(endPos)) {\n        var container = startPos.container();\n        if (isTextBlockNode(container)) {\n          lastPositionIn(container).each(function (pos) {\n            return rng.setEnd(pos.container(), pos.offset());\n          });\n        }\n      }\n      editor.selection.setRng(normalize$2(rng));\n    };\n    var setup$k = function (editor) {\n      editor.on('click', function (e) {\n        if (e.detail >= 3) {\n          normalizeSelection$1(editor);\n        }\n      });\n    };\n\n    var value$1 = function () {\n      var subject = Cell(Optional.none());\n      var clear = function () {\n        return subject.set(Optional.none());\n      };\n      var set = function (s) {\n        return subject.set(Optional.some(s));\n      };\n      var isSet = function () {\n        return subject.get().isSome();\n      };\n      var on = function (f) {\n        return subject.get().each(f);\n      };\n      return {\n        clear: clear,\n        set: set,\n        isSet: isSet,\n        on: on\n      };\n    };\n\n    var getAbsolutePosition = function (elm) {\n      var clientRect = elm.getBoundingClientRect();\n      var doc = elm.ownerDocument;\n      var docElem = doc.documentElement;\n      var win = doc.defaultView;\n      return {\n        top: clientRect.top + win.pageYOffset - docElem.clientTop,\n        left: clientRect.left + win.pageXOffset - docElem.clientLeft\n      };\n    };\n    var getBodyPosition = function (editor) {\n      return editor.inline ? getAbsolutePosition(editor.getBody()) : {\n        left: 0,\n        top: 0\n      };\n    };\n    var getScrollPosition = function (editor) {\n      var body = editor.getBody();\n      return editor.inline ? {\n        left: body.scrollLeft,\n        top: body.scrollTop\n      } : {\n        left: 0,\n        top: 0\n      };\n    };\n    var getBodyScroll = function (editor) {\n      var body = editor.getBody(), docElm = editor.getDoc().documentElement;\n      var inlineScroll = {\n        left: body.scrollLeft,\n        top: body.scrollTop\n      };\n      var iframeScroll = {\n        left: body.scrollLeft || docElm.scrollLeft,\n        top: body.scrollTop || docElm.scrollTop\n      };\n      return editor.inline ? inlineScroll : iframeScroll;\n    };\n    var getMousePosition = function (editor, event) {\n      if (event.target.ownerDocument !== editor.getDoc()) {\n        var iframePosition = getAbsolutePosition(editor.getContentAreaContainer());\n        var scrollPosition = getBodyScroll(editor);\n        return {\n          left: event.pageX - iframePosition.left + scrollPosition.left,\n          top: event.pageY - iframePosition.top + scrollPosition.top\n        };\n      }\n      return {\n        left: event.pageX,\n        top: event.pageY\n      };\n    };\n    var calculatePosition = function (bodyPosition, scrollPosition, mousePosition) {\n      return {\n        pageX: mousePosition.left - bodyPosition.left + scrollPosition.left,\n        pageY: mousePosition.top - bodyPosition.top + scrollPosition.top\n      };\n    };\n    var calc = function (editor, event) {\n      return calculatePosition(getBodyPosition(editor), getScrollPosition(editor), getMousePosition(editor, event));\n    };\n\n    var isContentEditableFalse$a = isContentEditableFalse, isContentEditableTrue$3 = isContentEditableTrue;\n    var isDraggable = function (rootElm, elm) {\n      return isContentEditableFalse$a(elm) && elm !== rootElm;\n    };\n    var isValidDropTarget = function (editor, targetElement, dragElement) {\n      if (targetElement === dragElement || editor.dom.isChildOf(targetElement, dragElement)) {\n        return false;\n      }\n      return !isContentEditableFalse$a(targetElement);\n    };\n    var cloneElement = function (elm) {\n      var cloneElm = elm.cloneNode(true);\n      cloneElm.removeAttribute('data-mce-selected');\n      return cloneElm;\n    };\n    var createGhost = function (editor, elm, width, height) {\n      var dom = editor.dom;\n      var clonedElm = elm.cloneNode(true);\n      dom.setStyles(clonedElm, {\n        width: width,\n        height: height\n      });\n      dom.setAttrib(clonedElm, 'data-mce-selected', null);\n      var ghostElm = dom.create('div', {\n        'class': 'mce-drag-container',\n        'data-mce-bogus': 'all',\n        'unselectable': 'on',\n        'contenteditable': 'false'\n      });\n      dom.setStyles(ghostElm, {\n        position: 'absolute',\n        opacity: 0.5,\n        overflow: 'hidden',\n        border: 0,\n        padding: 0,\n        margin: 0,\n        width: width,\n        height: height\n      });\n      dom.setStyles(clonedElm, {\n        margin: 0,\n        boxSizing: 'border-box'\n      });\n      ghostElm.appendChild(clonedElm);\n      return ghostElm;\n    };\n    var appendGhostToBody = function (ghostElm, bodyElm) {\n      if (ghostElm.parentNode !== bodyElm) {\n        bodyElm.appendChild(ghostElm);\n      }\n    };\n    var moveGhost = function (ghostElm, position, width, height, maxX, maxY) {\n      var overflowX = 0, overflowY = 0;\n      ghostElm.style.left = position.pageX + 'px';\n      ghostElm.style.top = position.pageY + 'px';\n      if (position.pageX + width > maxX) {\n        overflowX = position.pageX + width - maxX;\n      }\n      if (position.pageY + height > maxY) {\n        overflowY = position.pageY + height - maxY;\n      }\n      ghostElm.style.width = width - overflowX + 'px';\n      ghostElm.style.height = height - overflowY + 'px';\n    };\n    var removeElement = function (elm) {\n      if (elm && elm.parentNode) {\n        elm.parentNode.removeChild(elm);\n      }\n    };\n    var isLeftMouseButtonPressed = function (e) {\n      return e.button === 0;\n    };\n    var applyRelPos = function (state, position) {\n      return {\n        pageX: position.pageX - state.relX,\n        pageY: position.pageY + 5\n      };\n    };\n    var start$1 = function (state, editor) {\n      return function (e) {\n        if (isLeftMouseButtonPressed(e)) {\n          var ceElm = find(editor.dom.getParents(e.target), or(isContentEditableFalse$a, isContentEditableTrue$3)).getOr(null);\n          if (isDraggable(editor.getBody(), ceElm)) {\n            var elmPos = editor.dom.getPos(ceElm);\n            var bodyElm = editor.getBody();\n            var docElm = editor.getDoc().documentElement;\n            state.set({\n              element: ceElm,\n              dragging: false,\n              screenX: e.screenX,\n              screenY: e.screenY,\n              maxX: (editor.inline ? bodyElm.scrollWidth : docElm.offsetWidth) - 2,\n              maxY: (editor.inline ? bodyElm.scrollHeight : docElm.offsetHeight) - 2,\n              relX: e.pageX - elmPos.x,\n              relY: e.pageY - elmPos.y,\n              width: ceElm.offsetWidth,\n              height: ceElm.offsetHeight,\n              ghost: createGhost(editor, ceElm, ceElm.offsetWidth, ceElm.offsetHeight)\n            });\n          }\n        }\n      };\n    };\n    var move$2 = function (state, editor) {\n      var throttledPlaceCaretAt = Delay.throttle(function (clientX, clientY) {\n        editor._selectionOverrides.hideFakeCaret();\n        editor.selection.placeCaretAt(clientX, clientY);\n      }, 0);\n      return function (e) {\n        return state.on(function (state) {\n          var movement = Math.max(Math.abs(e.screenX - state.screenX), Math.abs(e.screenY - state.screenY));\n          if (!state.dragging && movement > 10) {\n            var args = editor.fire('dragstart', { target: state.element });\n            if (args.isDefaultPrevented()) {\n              return;\n            }\n            state.dragging = true;\n            editor.focus();\n          }\n          if (state.dragging) {\n            var targetPos = applyRelPos(state, calc(editor, e));\n            appendGhostToBody(state.ghost, editor.getBody());\n            moveGhost(state.ghost, targetPos, state.width, state.height, state.maxX, state.maxY);\n            throttledPlaceCaretAt(e.clientX, e.clientY);\n          }\n        });\n      };\n    };\n    var getRawTarget = function (selection) {\n      var rng = selection.getSel().getRangeAt(0);\n      var startContainer = rng.startContainer;\n      return startContainer.nodeType === 3 ? startContainer.parentNode : startContainer;\n    };\n    var drop = function (state, editor) {\n      return function (e) {\n        state.on(function (state) {\n          if (state.dragging) {\n            if (isValidDropTarget(editor, getRawTarget(editor.selection), state.element)) {\n              var targetClone_1 = cloneElement(state.element);\n              var args = editor.fire('drop', {\n                clientX: e.clientX,\n                clientY: e.clientY\n              });\n              if (!args.isDefaultPrevented()) {\n                editor.undoManager.transact(function () {\n                  removeElement(state.element);\n                  editor.insertContent(editor.dom.getOuterHTML(targetClone_1));\n                  editor._selectionOverrides.hideFakeCaret();\n                });\n              }\n            }\n          }\n        });\n        removeDragState(state);\n      };\n    };\n    var stop = function (state, editor) {\n      return function () {\n        state.on(function (state) {\n          if (state.dragging) {\n            editor.fire('dragend');\n          }\n        });\n        removeDragState(state);\n      };\n    };\n    var removeDragState = function (state) {\n      state.on(function (state) {\n        removeElement(state.ghost);\n      });\n      state.clear();\n    };\n    var bindFakeDragEvents = function (editor) {\n      var state = value$1();\n      var pageDom = DOMUtils$1.DOM;\n      var rootDocument = document;\n      var dragStartHandler = start$1(state, editor);\n      var dragHandler = move$2(state, editor);\n      var dropHandler = drop(state, editor);\n      var dragEndHandler = stop(state, editor);\n      editor.on('mousedown', dragStartHandler);\n      editor.on('mousemove', dragHandler);\n      editor.on('mouseup', dropHandler);\n      pageDom.bind(rootDocument, 'mousemove', dragHandler);\n      pageDom.bind(rootDocument, 'mouseup', dragEndHandler);\n      editor.on('remove', function () {\n        pageDom.unbind(rootDocument, 'mousemove', dragHandler);\n        pageDom.unbind(rootDocument, 'mouseup', dragEndHandler);\n      });\n    };\n    var blockIeDrop = function (editor) {\n      editor.on('drop', function (e) {\n        var realTarget = typeof e.clientX !== 'undefined' ? editor.getDoc().elementFromPoint(e.clientX, e.clientY) : null;\n        if (isContentEditableFalse$a(realTarget) || editor.dom.getContentEditableParent(realTarget) === 'false') {\n          e.preventDefault();\n        }\n      });\n    };\n    var blockUnsupportedFileDrop = function (editor) {\n      var preventFileDrop = function (e) {\n        if (!e.defaultPrevented) {\n          var dataTransfer = e.dataTransfer;\n          if (dataTransfer && (contains(dataTransfer.types, 'Files') || dataTransfer.files.length > 0)) {\n            e.preventDefault();\n            if (e.type === 'drop') {\n              displayError(editor, 'Dropped file type is not supported');\n            }\n          }\n        }\n      };\n      var preventFileDropIfUIElement = function (e) {\n        if (isUIElement(editor, e.target)) {\n          preventFileDrop(e);\n        }\n      };\n      var setup = function () {\n        var pageDom = DOMUtils$1.DOM;\n        var dom = editor.dom;\n        var doc = document;\n        var editorRoot = editor.inline ? editor.getBody() : editor.getDoc();\n        var eventNames = [\n          'drop',\n          'dragover'\n        ];\n        each(eventNames, function (name) {\n          pageDom.bind(doc, name, preventFileDropIfUIElement);\n          dom.bind(editorRoot, name, preventFileDrop);\n        });\n        editor.on('remove', function () {\n          each(eventNames, function (name) {\n            pageDom.unbind(doc, name, preventFileDropIfUIElement);\n            dom.unbind(editorRoot, name, preventFileDrop);\n          });\n        });\n      };\n      editor.on('init', function () {\n        Delay.setEditorTimeout(editor, setup, 0);\n      });\n    };\n    var init = function (editor) {\n      bindFakeDragEvents(editor);\n      blockIeDrop(editor);\n      if (shouldBlockUnsupportedDrop(editor)) {\n        blockUnsupportedFileDrop(editor);\n      }\n    };\n\n    var setup$l = function (editor) {\n      var renderFocusCaret = first(function () {\n        if (!editor.removed && editor.getBody().contains(document.activeElement)) {\n          var rng = editor.selection.getRng();\n          if (rng.collapsed) {\n            var caretRange = renderRangeCaret(editor, rng, false);\n            editor.selection.setRng(caretRange);\n          }\n        }\n      }, 0);\n      editor.on('focus', function () {\n        renderFocusCaret.throttle();\n      });\n      editor.on('blur', function () {\n        renderFocusCaret.cancel();\n      });\n    };\n\n    var setup$m = function (editor) {\n      editor.on('init', function () {\n        editor.on('focusin', function (e) {\n          var target = e.target;\n          if (isMedia(target)) {\n            var ceRoot = getContentEditableRoot(editor.getBody(), target);\n            var node = isContentEditableFalse(ceRoot) ? ceRoot : target;\n            if (editor.selection.getNode() !== node) {\n              selectNode(editor, node).each(function (rng) {\n                return editor.selection.setRng(rng);\n              });\n            }\n          }\n        });\n      });\n    };\n\n    var isContentEditableTrue$4 = isContentEditableTrue;\n    var isContentEditableFalse$b = isContentEditableFalse;\n    var getContentEditableRoot$1 = function (editor, node) {\n      return getContentEditableRoot(editor.getBody(), node);\n    };\n    var SelectionOverrides = function (editor) {\n      var selection = editor.selection, dom = editor.dom;\n      var isBlock = dom.isBlock;\n      var rootNode = editor.getBody();\n      var fakeCaret = FakeCaret(editor, rootNode, isBlock, function () {\n        return hasFocus$1(editor);\n      });\n      var realSelectionId = 'sel-' + dom.uniqueId();\n      var elementSelectionAttr = 'data-mce-selected';\n      var selectedElement;\n      var isFakeSelectionElement = function (node) {\n        return dom.hasClass(node, 'mce-offscreen-selection');\n      };\n      var isFakeSelectionTargetElement = function (node) {\n        return isContentEditableFalse$b(node) || isMedia(node);\n      };\n      var isNearFakeSelectionElement = function (pos) {\n        return isBeforeContentEditableFalse(pos) || isAfterContentEditableFalse(pos) || isBeforeMedia(pos) || isAfterMedia(pos);\n      };\n      var getRealSelectionElement = function () {\n        var container = dom.get(realSelectionId);\n        return container ? container.getElementsByTagName('*')[0] : container;\n      };\n      var setRange = function (range) {\n        if (range) {\n          selection.setRng(range);\n        }\n      };\n      var getRange = selection.getRng;\n      var showCaret = function (direction, node, before, scrollIntoView) {\n        if (scrollIntoView === void 0) {\n          scrollIntoView = true;\n        }\n        var e = editor.fire('ShowCaret', {\n          target: node,\n          direction: direction,\n          before: before\n        });\n        if (e.isDefaultPrevented()) {\n          return null;\n        }\n        if (scrollIntoView) {\n          selection.scrollIntoView(node, direction === -1);\n        }\n        return fakeCaret.show(before, node);\n      };\n      var showBlockCaretContainer = function (blockCaretContainer) {\n        if (blockCaretContainer.hasAttribute('data-mce-caret')) {\n          showCaretContainerBlock(blockCaretContainer);\n          setRange(getRange());\n          selection.scrollIntoView(blockCaretContainer);\n        }\n      };\n      var registerEvents = function () {\n        editor.on('mouseup', function (e) {\n          var range = getRange();\n          if (range.collapsed && isXYInContentArea(editor, e.clientX, e.clientY)) {\n            renderCaretAtRange(editor, range, false).each(setRange);\n          }\n        });\n        editor.on('click', function (e) {\n          var contentEditableRoot = getContentEditableRoot$1(editor, e.target);\n          if (contentEditableRoot) {\n            if (isContentEditableFalse$b(contentEditableRoot)) {\n              e.preventDefault();\n              editor.focus();\n            }\n            if (isContentEditableTrue$4(contentEditableRoot)) {\n              if (dom.isChildOf(contentEditableRoot, selection.getNode())) {\n                removeElementSelection();\n              }\n            }\n          }\n        });\n        editor.on('blur NewBlock', removeElementSelection);\n        editor.on('ResizeWindow FullscreenStateChanged', fakeCaret.reposition);\n        var hasNormalCaretPosition = function (elm) {\n          var caretWalker = CaretWalker(elm);\n          if (!elm.firstChild) {\n            return false;\n          }\n          var startPos = CaretPosition$1.before(elm.firstChild);\n          var newPos = caretWalker.next(startPos);\n          return newPos && !isNearFakeSelectionElement(newPos);\n        };\n        var isInSameBlock = function (node1, node2) {\n          var block1 = dom.getParent(node1, isBlock);\n          var block2 = dom.getParent(node2, isBlock);\n          return block1 === block2;\n        };\n        var hasBetterMouseTarget = function (targetNode, caretNode) {\n          var targetBlock = dom.getParent(targetNode, isBlock);\n          var caretBlock = dom.getParent(caretNode, isBlock);\n          if (targetBlock && targetNode !== caretBlock && dom.isChildOf(targetBlock, caretBlock) && isContentEditableFalse$b(getContentEditableRoot$1(editor, targetBlock)) === false) {\n            return true;\n          }\n          return targetBlock && !isInSameBlock(targetBlock, caretBlock) && hasNormalCaretPosition(targetBlock);\n        };\n        editor.on('tap', function (e) {\n          var targetElm = e.target;\n          var contentEditableRoot = getContentEditableRoot$1(editor, targetElm);\n          if (isContentEditableFalse$b(contentEditableRoot)) {\n            e.preventDefault();\n            selectNode(editor, contentEditableRoot).each(setElementSelection);\n          } else if (isFakeSelectionTargetElement(targetElm)) {\n            selectNode(editor, targetElm).each(setElementSelection);\n          }\n        }, true);\n        editor.on('mousedown', function (e) {\n          var targetElm = e.target;\n          if (targetElm !== rootNode && targetElm.nodeName !== 'HTML' && !dom.isChildOf(targetElm, rootNode)) {\n            return;\n          }\n          if (isXYInContentArea(editor, e.clientX, e.clientY) === false) {\n            return;\n          }\n          var contentEditableRoot = getContentEditableRoot$1(editor, targetElm);\n          if (contentEditableRoot) {\n            if (isContentEditableFalse$b(contentEditableRoot)) {\n              e.preventDefault();\n              selectNode(editor, contentEditableRoot).each(setElementSelection);\n            } else {\n              removeElementSelection();\n              if (!(isContentEditableTrue$4(contentEditableRoot) && e.shiftKey) && !isXYWithinRange(e.clientX, e.clientY, selection.getRng())) {\n                hideFakeCaret();\n                selection.placeCaretAt(e.clientX, e.clientY);\n              }\n            }\n          } else if (isFakeSelectionTargetElement(targetElm)) {\n            selectNode(editor, targetElm).each(setElementSelection);\n          } else if (isFakeCaretTarget(targetElm) === false) {\n            removeElementSelection();\n            hideFakeCaret();\n            var fakeCaretInfo = closestFakeCaret(rootNode, e.clientX, e.clientY);\n            if (fakeCaretInfo) {\n              if (!hasBetterMouseTarget(targetElm, fakeCaretInfo.node)) {\n                e.preventDefault();\n                var range = showCaret(1, fakeCaretInfo.node, fakeCaretInfo.before, false);\n                editor.getBody().focus();\n                setRange(range);\n              }\n            }\n          }\n        });\n        editor.on('keypress', function (e) {\n          if (VK.modifierPressed(e)) {\n            return;\n          }\n          if (isContentEditableFalse$b(selection.getNode())) {\n            e.preventDefault();\n          }\n        });\n        editor.on('GetSelectionRange', function (e) {\n          var rng = e.range;\n          if (selectedElement) {\n            if (!selectedElement.parentNode) {\n              selectedElement = null;\n              return;\n            }\n            rng = rng.cloneRange();\n            rng.selectNode(selectedElement);\n            e.range = rng;\n          }\n        });\n        editor.on('SetSelectionRange', function (e) {\n          e.range = normalizeShortEndedElementSelection(e.range);\n          var rng = setElementSelection(e.range, e.forward);\n          if (rng) {\n            e.range = rng;\n          }\n        });\n        var isPasteBin = function (node) {\n          return node.id === 'mcepastebin';\n        };\n        editor.on('AfterSetSelectionRange', function (e) {\n          var rng = e.range;\n          var parentNode = rng.startContainer.parentNode;\n          if (!isRangeInCaretContainer(rng) && !isPasteBin(parentNode)) {\n            hideFakeCaret();\n          }\n          if (!isFakeSelectionElement(parentNode)) {\n            removeElementSelection();\n          }\n        });\n        editor.on('copy', function (e) {\n          var clipboardData = e.clipboardData;\n          if (!e.isDefaultPrevented() && e.clipboardData && !Env.ie) {\n            var realSelectionElement = getRealSelectionElement();\n            if (realSelectionElement) {\n              e.preventDefault();\n              clipboardData.clearData();\n              clipboardData.setData('text/html', realSelectionElement.outerHTML);\n              clipboardData.setData('text/plain', realSelectionElement.outerText || realSelectionElement.innerText);\n            }\n          }\n        });\n        init(editor);\n        setup$l(editor);\n        setup$m(editor);\n      };\n      var isWithinCaretContainer = function (node) {\n        return isCaretContainer(node) || startsWithCaretContainer(node) || endsWithCaretContainer(node);\n      };\n      var isRangeInCaretContainer = function (rng) {\n        return isWithinCaretContainer(rng.startContainer) || isWithinCaretContainer(rng.endContainer);\n      };\n      var normalizeShortEndedElementSelection = function (rng) {\n        var shortEndedElements = editor.schema.getShortEndedElements();\n        var newRng = dom.createRng();\n        var startContainer = rng.startContainer;\n        var startOffset = rng.startOffset;\n        var endContainer = rng.endContainer;\n        var endOffset = rng.endOffset;\n        if (has(shortEndedElements, startContainer.nodeName.toLowerCase())) {\n          if (startOffset === 0) {\n            newRng.setStartBefore(startContainer);\n          } else {\n            newRng.setStartAfter(startContainer);\n          }\n        } else {\n          newRng.setStart(startContainer, startOffset);\n        }\n        if (has(shortEndedElements, endContainer.nodeName.toLowerCase())) {\n          if (endOffset === 0) {\n            newRng.setEndBefore(endContainer);\n          } else {\n            newRng.setEndAfter(endContainer);\n          }\n        } else {\n          newRng.setEnd(endContainer, endOffset);\n        }\n        return newRng;\n      };\n      var setupOffscreenSelection = function (node, targetClone, origTargetClone) {\n        var $ = editor.$;\n        var $realSelectionContainer = descendant(SugarElement.fromDom(editor.getBody()), '#' + realSelectionId).fold(function () {\n          return $([]);\n        }, function (elm) {\n          return $([elm.dom]);\n        });\n        if ($realSelectionContainer.length === 0) {\n          $realSelectionContainer = $('<div data-mce-bogus=\"all\" class=\"mce-offscreen-selection\"></div>').attr('id', realSelectionId);\n          $realSelectionContainer.appendTo(editor.getBody());\n        }\n        var newRange = dom.createRng();\n        if (targetClone === origTargetClone && Env.ie) {\n          $realSelectionContainer.empty().append('<p style=\"font-size: 0\" data-mce-bogus=\"all\">\\xA0</p>').append(targetClone);\n          newRange.setStartAfter($realSelectionContainer[0].firstChild.firstChild);\n          newRange.setEndAfter(targetClone);\n        } else {\n          $realSelectionContainer.empty().append(nbsp).append(targetClone).append(nbsp);\n          newRange.setStart($realSelectionContainer[0].firstChild, 1);\n          newRange.setEnd($realSelectionContainer[0].lastChild, 0);\n        }\n        $realSelectionContainer.css({ top: dom.getPos(node, editor.getBody()).y });\n        $realSelectionContainer[0].focus();\n        var sel = selection.getSel();\n        sel.removeAllRanges();\n        sel.addRange(newRange);\n        return newRange;\n      };\n      var selectElement = function (elm) {\n        var targetClone = elm.cloneNode(true);\n        var e = editor.fire('ObjectSelected', {\n          target: elm,\n          targetClone: targetClone\n        });\n        if (e.isDefaultPrevented()) {\n          return null;\n        }\n        var range = setupOffscreenSelection(elm, e.targetClone, targetClone);\n        var nodeElm = SugarElement.fromDom(elm);\n        each(descendants$1(SugarElement.fromDom(editor.getBody()), '*[data-mce-selected]'), function (elm) {\n          if (!eq$2(nodeElm, elm)) {\n            remove$1(elm, elementSelectionAttr);\n          }\n        });\n        if (!dom.getAttrib(elm, elementSelectionAttr)) {\n          elm.setAttribute(elementSelectionAttr, '1');\n        }\n        selectedElement = elm;\n        hideFakeCaret();\n        return range;\n      };\n      var setElementSelection = function (range, forward) {\n        if (!range) {\n          return null;\n        }\n        if (range.collapsed) {\n          if (!isRangeInCaretContainer(range)) {\n            var dir = forward ? 1 : -1;\n            var caretPosition = getNormalizedRangeEndPoint(dir, rootNode, range);\n            var beforeNode = caretPosition.getNode(!forward);\n            if (isFakeCaretTarget(beforeNode)) {\n              return showCaret(dir, beforeNode, forward ? !caretPosition.isAtEnd() : false, false);\n            }\n            var afterNode = caretPosition.getNode(forward);\n            if (isFakeCaretTarget(afterNode)) {\n              return showCaret(dir, afterNode, forward ? false : !caretPosition.isAtEnd(), false);\n            }\n          }\n          return null;\n        }\n        var startContainer = range.startContainer;\n        var startOffset = range.startOffset;\n        var endOffset = range.endOffset;\n        if (startContainer.nodeType === 3 && startOffset === 0 && isContentEditableFalse$b(startContainer.parentNode)) {\n          startContainer = startContainer.parentNode;\n          startOffset = dom.nodeIndex(startContainer);\n          startContainer = startContainer.parentNode;\n        }\n        if (startContainer.nodeType !== 1) {\n          return null;\n        }\n        if (endOffset === startOffset + 1 && startContainer === range.endContainer) {\n          var node = startContainer.childNodes[startOffset];\n          if (isFakeSelectionTargetElement(node)) {\n            return selectElement(node);\n          }\n        }\n        return null;\n      };\n      var removeElementSelection = function () {\n        if (selectedElement) {\n          selectedElement.removeAttribute(elementSelectionAttr);\n        }\n        descendant(SugarElement.fromDom(editor.getBody()), '#' + realSelectionId).each(remove);\n        selectedElement = null;\n      };\n      var destroy = function () {\n        fakeCaret.destroy();\n        selectedElement = null;\n      };\n      var hideFakeCaret = function () {\n        fakeCaret.hide();\n      };\n      if (Env.ceFalse) {\n        registerEvents();\n      }\n      return {\n        showCaret: showCaret,\n        showBlockCaretContainer: showBlockCaretContainer,\n        hideFakeCaret: hideFakeCaret,\n        destroy: destroy\n      };\n    };\n\n    var Quirks = function (editor) {\n      var each = Tools.each;\n      var BACKSPACE = VK.BACKSPACE, DELETE = VK.DELETE, dom = editor.dom, selection = editor.selection, parser = editor.parser;\n      var isGecko = Env.gecko, isIE = Env.ie, isWebKit = Env.webkit;\n      var mceInternalUrlPrefix = 'data:text/mce-internal,';\n      var mceInternalDataType = isIE ? 'Text' : 'URL';\n      var setEditorCommandState = function (cmd, state) {\n        try {\n          editor.getDoc().execCommand(cmd, false, state);\n        } catch (ex) {\n        }\n      };\n      var isDefaultPrevented = function (e) {\n        return e.isDefaultPrevented();\n      };\n      var setMceInternalContent = function (e) {\n        var selectionHtml, internalContent;\n        if (e.dataTransfer) {\n          if (editor.selection.isCollapsed() && e.target.tagName === 'IMG') {\n            selection.select(e.target);\n          }\n          selectionHtml = editor.selection.getContent();\n          if (selectionHtml.length > 0) {\n            internalContent = mceInternalUrlPrefix + escape(editor.id) + ',' + escape(selectionHtml);\n            e.dataTransfer.setData(mceInternalDataType, internalContent);\n          }\n        }\n      };\n      var getMceInternalContent = function (e) {\n        var internalContent;\n        if (e.dataTransfer) {\n          internalContent = e.dataTransfer.getData(mceInternalDataType);\n          if (internalContent && internalContent.indexOf(mceInternalUrlPrefix) >= 0) {\n            internalContent = internalContent.substr(mceInternalUrlPrefix.length).split(',');\n            return {\n              id: unescape(internalContent[0]),\n              html: unescape(internalContent[1])\n            };\n          }\n        }\n        return null;\n      };\n      var insertClipboardContents = function (content, internal) {\n        if (editor.queryCommandSupported('mceInsertClipboardContent')) {\n          editor.execCommand('mceInsertClipboardContent', false, {\n            content: content,\n            internal: internal\n          });\n        } else {\n          editor.execCommand('mceInsertContent', false, content);\n        }\n      };\n      var emptyEditorWhenDeleting = function () {\n        var serializeRng = function (rng) {\n          var body = dom.create('body');\n          var contents = rng.cloneContents();\n          body.appendChild(contents);\n          return selection.serializer.serialize(body, { format: 'html' });\n        };\n        var allContentsSelected = function (rng) {\n          var selection = serializeRng(rng);\n          var allRng = dom.createRng();\n          allRng.selectNode(editor.getBody());\n          var allSelection = serializeRng(allRng);\n          return selection === allSelection;\n        };\n        editor.on('keydown', function (e) {\n          var keyCode = e.keyCode;\n          var isCollapsed, body;\n          if (!isDefaultPrevented(e) && (keyCode === DELETE || keyCode === BACKSPACE)) {\n            isCollapsed = editor.selection.isCollapsed();\n            body = editor.getBody();\n            if (isCollapsed && !dom.isEmpty(body)) {\n              return;\n            }\n            if (!isCollapsed && !allContentsSelected(editor.selection.getRng())) {\n              return;\n            }\n            e.preventDefault();\n            editor.setContent('');\n            if (body.firstChild && dom.isBlock(body.firstChild)) {\n              editor.selection.setCursorLocation(body.firstChild, 0);\n            } else {\n              editor.selection.setCursorLocation(body, 0);\n            }\n            editor.nodeChanged();\n          }\n        });\n      };\n      var selectAll = function () {\n        editor.shortcuts.add('meta+a', null, 'SelectAll');\n      };\n      var inputMethodFocus = function () {\n        if (!editor.inline) {\n          dom.bind(editor.getDoc(), 'mousedown mouseup', function (e) {\n            var rng;\n            if (e.target === editor.getDoc().documentElement) {\n              rng = selection.getRng();\n              editor.getBody().focus();\n              if (e.type === 'mousedown') {\n                if (isCaretContainer(rng.startContainer)) {\n                  return;\n                }\n                selection.placeCaretAt(e.clientX, e.clientY);\n              } else {\n                selection.setRng(rng);\n              }\n            }\n          });\n        }\n      };\n      var removeHrOnBackspace = function () {\n        editor.on('keydown', function (e) {\n          if (!isDefaultPrevented(e) && e.keyCode === BACKSPACE) {\n            if (!editor.getBody().getElementsByTagName('hr').length) {\n              return;\n            }\n            if (selection.isCollapsed() && selection.getRng().startOffset === 0) {\n              var node = selection.getNode();\n              var previousSibling = node.previousSibling;\n              if (node.nodeName === 'HR') {\n                dom.remove(node);\n                e.preventDefault();\n                return;\n              }\n              if (previousSibling && previousSibling.nodeName && previousSibling.nodeName.toLowerCase() === 'hr') {\n                dom.remove(previousSibling);\n                e.preventDefault();\n              }\n            }\n          }\n        });\n      };\n      var focusBody = function () {\n        if (!Range.prototype.getClientRects) {\n          editor.on('mousedown', function (e) {\n            if (!isDefaultPrevented(e) && e.target.nodeName === 'HTML') {\n              var body_1 = editor.getBody();\n              body_1.blur();\n              Delay.setEditorTimeout(editor, function () {\n                body_1.focus();\n              });\n            }\n          });\n        }\n      };\n      var selectControlElements = function () {\n        editor.on('click', function (e) {\n          var target = e.target;\n          if (/^(IMG|HR)$/.test(target.nodeName) && dom.getContentEditableParent(target) !== 'false') {\n            e.preventDefault();\n            editor.selection.select(target);\n            editor.nodeChanged();\n          }\n          if (target.nodeName === 'A' && dom.hasClass(target, 'mce-item-anchor')) {\n            e.preventDefault();\n            selection.select(target);\n          }\n        });\n      };\n      var removeStylesWhenDeletingAcrossBlockElements = function () {\n        var getAttributeApplyFunction = function () {\n          var template = dom.getAttribs(selection.getStart().cloneNode(false));\n          return function () {\n            var target = selection.getStart();\n            if (target !== editor.getBody()) {\n              dom.setAttrib(target, 'style', null);\n              each(template, function (attr) {\n                target.setAttributeNode(attr.cloneNode(true));\n              });\n            }\n          };\n        };\n        var isSelectionAcrossElements = function () {\n          return !selection.isCollapsed() && dom.getParent(selection.getStart(), dom.isBlock) !== dom.getParent(selection.getEnd(), dom.isBlock);\n        };\n        editor.on('keypress', function (e) {\n          var applyAttributes;\n          if (!isDefaultPrevented(e) && (e.keyCode === 8 || e.keyCode === 46) && isSelectionAcrossElements()) {\n            applyAttributes = getAttributeApplyFunction();\n            editor.getDoc().execCommand('delete', false, null);\n            applyAttributes();\n            e.preventDefault();\n            return false;\n          }\n        });\n        dom.bind(editor.getDoc(), 'cut', function (e) {\n          var applyAttributes;\n          if (!isDefaultPrevented(e) && isSelectionAcrossElements()) {\n            applyAttributes = getAttributeApplyFunction();\n            Delay.setEditorTimeout(editor, function () {\n              applyAttributes();\n            });\n          }\n        });\n      };\n      var disableBackspaceIntoATable = function () {\n        editor.on('keydown', function (e) {\n          if (!isDefaultPrevented(e) && e.keyCode === BACKSPACE) {\n            if (selection.isCollapsed() && selection.getRng().startOffset === 0) {\n              var previousSibling = selection.getNode().previousSibling;\n              if (previousSibling && previousSibling.nodeName && previousSibling.nodeName.toLowerCase() === 'table') {\n                e.preventDefault();\n                return false;\n              }\n            }\n          }\n        });\n      };\n      var removeBlockQuoteOnBackSpace = function () {\n        editor.on('keydown', function (e) {\n          var rng, parent;\n          if (isDefaultPrevented(e) || e.keyCode !== VK.BACKSPACE) {\n            return;\n          }\n          rng = selection.getRng();\n          var container = rng.startContainer;\n          var offset = rng.startOffset;\n          var root = dom.getRoot();\n          parent = container;\n          if (!rng.collapsed || offset !== 0) {\n            return;\n          }\n          while (parent && parent.parentNode && parent.parentNode.firstChild === parent && parent.parentNode !== root) {\n            parent = parent.parentNode;\n          }\n          if (parent.tagName === 'BLOCKQUOTE') {\n            editor.formatter.toggle('blockquote', null, parent);\n            rng = dom.createRng();\n            rng.setStart(container, 0);\n            rng.setEnd(container, 0);\n            selection.setRng(rng);\n          }\n        });\n      };\n      var setGeckoEditingOptions = function () {\n        var setOpts = function () {\n          setEditorCommandState('StyleWithCSS', false);\n          setEditorCommandState('enableInlineTableEditing', false);\n          if (!getObjectResizing(editor)) {\n            setEditorCommandState('enableObjectResizing', false);\n          }\n        };\n        if (!isReadOnly(editor)) {\n          editor.on('BeforeExecCommand mousedown', setOpts);\n        }\n      };\n      var addBrAfterLastLinks = function () {\n        var fixLinks = function () {\n          each(dom.select('a'), function (node) {\n            var parentNode = node.parentNode;\n            var root = dom.getRoot();\n            if (parentNode.lastChild === node) {\n              while (parentNode && !dom.isBlock(parentNode)) {\n                if (parentNode.parentNode.lastChild !== parentNode || parentNode === root) {\n                  return;\n                }\n                parentNode = parentNode.parentNode;\n              }\n              dom.add(parentNode, 'br', { 'data-mce-bogus': 1 });\n            }\n          });\n        };\n        editor.on('SetContent ExecCommand', function (e) {\n          if (e.type === 'setcontent' || e.command === 'mceInsertLink') {\n            fixLinks();\n          }\n        });\n      };\n      var setDefaultBlockType = function () {\n        if (getForcedRootBlock(editor)) {\n          editor.on('init', function () {\n            setEditorCommandState('DefaultParagraphSeparator', getForcedRootBlock(editor));\n          });\n        }\n      };\n      var normalizeSelection = function () {\n        editor.on('keyup focusin mouseup', function (e) {\n          if (!VK.modifierPressed(e)) {\n            selection.normalize();\n          }\n        }, true);\n      };\n      var showBrokenImageIcon = function () {\n        editor.contentStyles.push('img:-moz-broken {' + '-moz-force-broken-image-icon:1;' + 'min-width:24px;' + 'min-height:24px' + '}');\n      };\n      var restoreFocusOnKeyDown = function () {\n        if (!editor.inline) {\n          editor.on('keydown', function () {\n            if (document.activeElement === document.body) {\n              editor.getWin().focus();\n            }\n          });\n        }\n      };\n      var bodyHeight = function () {\n        if (!editor.inline) {\n          editor.contentStyles.push('body {min-height: 150px}');\n          editor.on('click', function (e) {\n            var rng;\n            if (e.target.nodeName === 'HTML') {\n              if (Env.ie > 11) {\n                editor.getBody().focus();\n                return;\n              }\n              rng = editor.selection.getRng();\n              editor.getBody().focus();\n              editor.selection.setRng(rng);\n              editor.selection.normalize();\n              editor.nodeChanged();\n            }\n          });\n        }\n      };\n      var blockCmdArrowNavigation = function () {\n        if (Env.mac) {\n          editor.on('keydown', function (e) {\n            if (VK.metaKeyPressed(e) && !e.shiftKey && (e.keyCode === 37 || e.keyCode === 39)) {\n              e.preventDefault();\n              var selection_1 = editor.selection.getSel();\n              selection_1.modify('move', e.keyCode === 37 ? 'backward' : 'forward', 'lineboundary');\n            }\n          });\n        }\n      };\n      var disableAutoUrlDetect = function () {\n        setEditorCommandState('AutoUrlDetect', false);\n      };\n      var tapLinksAndImages = function () {\n        editor.on('click', function (e) {\n          var elm = e.target;\n          do {\n            if (elm.tagName === 'A') {\n              e.preventDefault();\n              return;\n            }\n          } while (elm = elm.parentNode);\n        });\n        editor.contentStyles.push('.mce-content-body {-webkit-touch-callout: none}');\n      };\n      var blockFormSubmitInsideEditor = function () {\n        editor.on('init', function () {\n          editor.dom.bind(editor.getBody(), 'submit', function (e) {\n            e.preventDefault();\n          });\n        });\n      };\n      var removeAppleInterchangeBrs = function () {\n        parser.addNodeFilter('br', function (nodes) {\n          var i = nodes.length;\n          while (i--) {\n            if (nodes[i].attr('class') === 'Apple-interchange-newline') {\n              nodes[i].remove();\n            }\n          }\n        });\n      };\n      var ieInternalDragAndDrop = function () {\n        editor.on('dragstart', function (e) {\n          setMceInternalContent(e);\n        });\n        editor.on('drop', function (e) {\n          if (!isDefaultPrevented(e)) {\n            var internalContent = getMceInternalContent(e);\n            if (internalContent && internalContent.id !== editor.id) {\n              e.preventDefault();\n              var rng = fromPoint$1(e.x, e.y, editor.getDoc());\n              selection.setRng(rng);\n              insertClipboardContents(internalContent.html, true);\n            }\n          }\n        });\n      };\n      var refreshContentEditable = function () {\n      };\n      var isHidden = function () {\n        if (!isGecko || editor.removed) {\n          return false;\n        }\n        var sel = editor.selection.getSel();\n        return !sel || !sel.rangeCount || sel.rangeCount === 0;\n      };\n      removeBlockQuoteOnBackSpace();\n      emptyEditorWhenDeleting();\n      if (!Env.windowsPhone) {\n        normalizeSelection();\n      }\n      if (isWebKit) {\n        inputMethodFocus();\n        selectControlElements();\n        setDefaultBlockType();\n        blockFormSubmitInsideEditor();\n        disableBackspaceIntoATable();\n        removeAppleInterchangeBrs();\n        if (Env.iOS) {\n          restoreFocusOnKeyDown();\n          bodyHeight();\n          tapLinksAndImages();\n        } else {\n          selectAll();\n        }\n      }\n      if (Env.ie >= 11) {\n        bodyHeight();\n        disableBackspaceIntoATable();\n      }\n      if (Env.ie) {\n        selectAll();\n        disableAutoUrlDetect();\n        ieInternalDragAndDrop();\n      }\n      if (isGecko) {\n        removeHrOnBackspace();\n        focusBody();\n        removeStylesWhenDeletingAcrossBlockElements();\n        setGeckoEditingOptions();\n        addBrAfterLastLinks();\n        showBrokenImageIcon();\n        blockCmdArrowNavigation();\n        disableBackspaceIntoATable();\n      }\n      return {\n        refreshContentEditable: refreshContentEditable,\n        isHidden: isHidden\n      };\n    };\n\n    var DOM$4 = DOMUtils$1.DOM;\n    var appendStyle = function (editor, text) {\n      var body = SugarElement.fromDom(editor.getBody());\n      var container = getStyleContainer(getRootNode(body));\n      var style = SugarElement.fromTag('style');\n      set(style, 'type', 'text/css');\n      append(style, SugarElement.fromText(text));\n      append(container, style);\n      editor.on('remove', function () {\n        remove(style);\n      });\n    };\n    var getRootName = function (editor) {\n      return editor.inline ? editor.getElement().nodeName.toLowerCase() : undefined;\n    };\n    var removeUndefined = function (obj) {\n      return filter$1(obj, function (v) {\n        return isUndefined(v) === false;\n      });\n    };\n    var mkParserSettings = function (editor) {\n      var settings = editor.settings;\n      var blobCache = editor.editorUpload.blobCache;\n      return removeUndefined({\n        allow_conditional_comments: settings.allow_conditional_comments,\n        allow_html_data_urls: settings.allow_html_data_urls,\n        allow_html_in_named_anchor: settings.allow_html_in_named_anchor,\n        allow_script_urls: settings.allow_script_urls,\n        allow_unsafe_link_target: settings.allow_unsafe_link_target,\n        convert_fonts_to_spans: settings.convert_fonts_to_spans,\n        fix_list_elements: settings.fix_list_elements,\n        font_size_legacy_values: settings.font_size_legacy_values,\n        forced_root_block: settings.forced_root_block,\n        forced_root_block_attrs: settings.forced_root_block_attrs,\n        padd_empty_with_br: settings.padd_empty_with_br,\n        preserve_cdata: settings.preserve_cdata,\n        remove_trailing_brs: settings.remove_trailing_brs,\n        inline_styles: settings.inline_styles,\n        root_name: getRootName(editor),\n        validate: true,\n        blob_cache: blobCache,\n        images_dataimg_filter: settings.images_dataimg_filter\n      });\n    };\n    var mkSerializerSettings = function (editor) {\n      var settings = editor.settings;\n      return __assign(__assign({}, mkParserSettings(editor)), removeUndefined({\n        url_converter: settings.url_converter,\n        url_converter_scope: settings.url_converter_scope,\n        element_format: settings.element_format,\n        entities: settings.entities,\n        entity_encoding: settings.entity_encoding,\n        indent: settings.indent,\n        indent_after: settings.indent_after,\n        indent_before: settings.indent_before,\n        block_elements: settings.block_elements,\n        boolean_attributes: settings.boolean_attributes,\n        custom_elements: settings.custom_elements,\n        extended_valid_elements: settings.extended_valid_elements,\n        invalid_elements: settings.invalid_elements,\n        invalid_styles: settings.invalid_styles,\n        move_caret_before_on_enter_elements: settings.move_caret_before_on_enter_elements,\n        non_empty_elements: settings.non_empty_elements,\n        schema: settings.schema,\n        self_closing_elements: settings.self_closing_elements,\n        short_ended_elements: settings.short_ended_elements,\n        special: settings.special,\n        text_block_elements: settings.text_block_elements,\n        text_inline_elements: settings.text_inline_elements,\n        valid_children: settings.valid_children,\n        valid_classes: settings.valid_classes,\n        valid_elements: settings.valid_elements,\n        valid_styles: settings.valid_styles,\n        verify_html: settings.verify_html,\n        whitespace_elements: settings.whitespace_elements\n      }));\n    };\n    var createParser = function (editor) {\n      var parser = DomParser(mkParserSettings(editor), editor.schema);\n      parser.addAttributeFilter('src,href,style,tabindex', function (nodes, name) {\n        var i = nodes.length, node, value;\n        var dom = editor.dom;\n        var internalName = 'data-mce-' + name;\n        while (i--) {\n          node = nodes[i];\n          value = node.attr(name);\n          if (value && !node.attr(internalName)) {\n            if (value.indexOf('data:') === 0 || value.indexOf('blob:') === 0) {\n              continue;\n            }\n            if (name === 'style') {\n              value = dom.serializeStyle(dom.parseStyle(value), node.name);\n              if (!value.length) {\n                value = null;\n              }\n              node.attr(internalName, value);\n              node.attr(name, value);\n            } else if (name === 'tabindex') {\n              node.attr(internalName, value);\n              node.attr(name, null);\n            } else {\n              node.attr(internalName, editor.convertURL(value, name, node.name));\n            }\n          }\n        }\n      });\n      parser.addNodeFilter('script', function (nodes) {\n        var i = nodes.length;\n        while (i--) {\n          var node = nodes[i];\n          var type = node.attr('type') || 'no/type';\n          if (type.indexOf('mce-') !== 0) {\n            node.attr('type', 'mce-' + type);\n          }\n        }\n      });\n      if (editor.settings.preserve_cdata) {\n        parser.addNodeFilter('#cdata', function (nodes) {\n          var i = nodes.length;\n          while (i--) {\n            var node = nodes[i];\n            node.type = 8;\n            node.name = '#comment';\n            node.value = '[CDATA[' + editor.dom.encode(node.value) + ']]';\n          }\n        });\n      }\n      parser.addNodeFilter('p,h1,h2,h3,h4,h5,h6,div', function (nodes) {\n        var i = nodes.length;\n        var nonEmptyElements = editor.schema.getNonEmptyElements();\n        while (i--) {\n          var node = nodes[i];\n          if (node.isEmpty(nonEmptyElements) && node.getAll('br').length === 0) {\n            node.append(new AstNode('br', 1)).shortEnded = true;\n          }\n        }\n      });\n      return parser;\n    };\n    var autoFocus = function (editor) {\n      if (editor.settings.auto_focus) {\n        Delay.setEditorTimeout(editor, function () {\n          var focusEditor;\n          if (editor.settings.auto_focus === true) {\n            focusEditor = editor;\n          } else {\n            focusEditor = editor.editorManager.get(editor.settings.auto_focus);\n          }\n          if (!focusEditor.destroyed) {\n            focusEditor.focus();\n          }\n        }, 100);\n      }\n    };\n    var moveSelectionToFirstCaretPosition = function (editor) {\n      var root = editor.dom.getRoot();\n      if (!editor.inline && (!hasAnyRanges(editor) || editor.selection.getStart(true) === root)) {\n        firstPositionIn(root).each(function (pos) {\n          var node = pos.getNode();\n          var caretPos = isTable(node) ? firstPositionIn(node).getOr(pos) : pos;\n          if (Env.browser.isIE()) {\n            storeNative(editor, caretPos.toRange());\n          } else {\n            editor.selection.setRng(caretPos.toRange());\n          }\n        });\n      }\n    };\n    var initEditor = function (editor) {\n      editor.bindPendingEventDelegates();\n      editor.initialized = true;\n      fireInit(editor);\n      editor.focus(true);\n      moveSelectionToFirstCaretPosition(editor);\n      editor.nodeChanged({ initial: true });\n      editor.execCallback('init_instance_callback', editor);\n      autoFocus(editor);\n    };\n    var getStyleSheetLoader = function (editor) {\n      return editor.inline ? editor.ui.styleSheetLoader : editor.dom.styleSheetLoader;\n    };\n    var loadContentCss = function (editor, css) {\n      var styleSheetLoader = getStyleSheetLoader(editor);\n      var loaded = function () {\n        editor.on('remove', function () {\n          return styleSheetLoader.unloadAll(css);\n        });\n        initEditor(editor);\n      };\n      styleSheetLoader.loadAll(css, loaded, loaded);\n    };\n    var preInit = function (editor, rtcMode) {\n      var settings = editor.settings, doc = editor.getDoc(), body = editor.getBody();\n      if (!settings.browser_spellcheck && !settings.gecko_spellcheck) {\n        doc.body.spellcheck = false;\n        DOM$4.setAttrib(body, 'spellcheck', 'false');\n      }\n      editor.quirks = Quirks(editor);\n      firePostRender(editor);\n      var directionality = getDirectionality(editor);\n      if (directionality !== undefined) {\n        body.dir = directionality;\n      }\n      if (settings.protect) {\n        editor.on('BeforeSetContent', function (e) {\n          Tools.each(settings.protect, function (pattern) {\n            e.content = e.content.replace(pattern, function (str) {\n              return '<!--mce:protected ' + escape(str) + '-->';\n            });\n          });\n        });\n      }\n      editor.on('SetContent', function () {\n        editor.addVisual(editor.getBody());\n      });\n      if (rtcMode === false) {\n        editor.load({\n          initial: true,\n          format: 'html'\n        });\n      }\n      editor.startContent = editor.getContent({ format: 'raw' });\n      editor.on('compositionstart compositionend', function (e) {\n        editor.composing = e.type === 'compositionstart';\n      });\n      if (editor.contentStyles.length > 0) {\n        var contentCssText_1 = '';\n        Tools.each(editor.contentStyles, function (style) {\n          contentCssText_1 += style + '\\r\\n';\n        });\n        editor.dom.addStyle(contentCssText_1);\n      }\n      loadContentCss(editor, editor.contentCSS);\n      if (settings.content_style) {\n        appendStyle(editor, settings.content_style);\n      }\n    };\n    var initContentBody = function (editor, skipWrite) {\n      var settings = editor.settings;\n      var targetElm = editor.getElement();\n      var doc = editor.getDoc();\n      if (!settings.inline) {\n        editor.getElement().style.visibility = editor.orgVisibility;\n      }\n      if (!skipWrite && !editor.inline) {\n        doc.open();\n        doc.write(editor.iframeHTML);\n        doc.close();\n      }\n      if (editor.inline) {\n        DOM$4.addClass(targetElm, 'mce-content-body');\n        editor.contentDocument = doc = document;\n        editor.contentWindow = window;\n        editor.bodyElement = targetElm;\n        editor.contentAreaContainer = targetElm;\n      }\n      var body = editor.getBody();\n      body.disabled = true;\n      editor.readonly = !!settings.readonly;\n      if (!editor.readonly) {\n        if (editor.inline && DOM$4.getStyle(body, 'position', true) === 'static') {\n          body.style.position = 'relative';\n        }\n        body.contentEditable = editor.getParam('content_editable_state', true);\n      }\n      body.disabled = false;\n      editor.editorUpload = EditorUpload(editor);\n      editor.schema = Schema(settings);\n      editor.dom = DOMUtils$1(doc, {\n        keep_values: true,\n        url_converter: editor.convertURL,\n        url_converter_scope: editor,\n        hex_colors: settings.force_hex_style_colors,\n        update_styles: true,\n        root_element: editor.inline ? editor.getBody() : null,\n        collect: function () {\n          return editor.inline;\n        },\n        schema: editor.schema,\n        contentCssCors: shouldUseContentCssCors(editor),\n        referrerPolicy: getReferrerPolicy(editor),\n        onSetAttrib: function (e) {\n          editor.fire('SetAttrib', e);\n        }\n      });\n      editor.parser = createParser(editor);\n      editor.serializer = DomSerializer(mkSerializerSettings(editor), editor);\n      editor.selection = EditorSelection(editor.dom, editor.getWin(), editor.serializer, editor);\n      editor.annotator = Annotator(editor);\n      editor.formatter = Formatter(editor);\n      editor.undoManager = UndoManager(editor);\n      editor._nodeChangeDispatcher = new NodeChange(editor);\n      editor._selectionOverrides = SelectionOverrides(editor);\n      setup$9(editor);\n      setup$j(editor);\n      if (!isRtc(editor)) {\n        setup$k(editor);\n      }\n      var caret = setup$i(editor);\n      setup$8(editor, caret);\n      setup$a(editor);\n      setup$7(editor);\n      firePreInit(editor);\n      setup$4(editor).fold(function () {\n        preInit(editor, false);\n      }, function (loadingRtc) {\n        editor.setProgressState(true);\n        loadingRtc.then(function (rtcMode) {\n          editor.setProgressState(false);\n          preInit(editor, rtcMode);\n        });\n      });\n    };\n\n    var DOM$5 = DOMUtils$1.DOM;\n    var relaxDomain = function (editor, ifr) {\n      if (document.domain !== window.location.hostname && Env.browser.isIE()) {\n        var bodyUuid = uuid('mce');\n        editor[bodyUuid] = function () {\n          initContentBody(editor);\n        };\n        var domainRelaxUrl = 'javascript:(function(){' + 'document.open();document.domain=\"' + document.domain + '\";' + 'var ed = window.parent.tinymce.get(\"' + editor.id + '\");document.write(ed.iframeHTML);' + 'document.close();ed.' + bodyUuid + '(true);})()';\n        DOM$5.setAttrib(ifr, 'src', domainRelaxUrl);\n        return true;\n      }\n      return false;\n    };\n    var createIframeElement = function (id, title, height, customAttrs) {\n      var iframe = SugarElement.fromTag('iframe');\n      setAll(iframe, customAttrs);\n      setAll(iframe, {\n        id: id + '_ifr',\n        frameBorder: '0',\n        allowTransparency: 'true',\n        title: title\n      });\n      add$3(iframe, 'tox-edit-area__iframe');\n      return iframe;\n    };\n    var getIframeHtml = function (editor) {\n      var iframeHTML = getDocType(editor) + '<html><head>';\n      if (getDocumentBaseUrl(editor) !== editor.documentBaseUrl) {\n        iframeHTML += '<base href=\"' + editor.documentBaseURI.getURI() + '\" />';\n      }\n      iframeHTML += '<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />';\n      var bodyId = getBodyId(editor);\n      var bodyClass = getBodyClass(editor);\n      if (getContentSecurityPolicy(editor)) {\n        iframeHTML += '<meta http-equiv=\"Content-Security-Policy\" content=\"' + getContentSecurityPolicy(editor) + '\" />';\n      }\n      iframeHTML += '</head><body id=\"' + bodyId + '\" class=\"mce-content-body ' + bodyClass + '\" data-id=\"' + editor.id + '\"><br></body></html>';\n      return iframeHTML;\n    };\n    var createIframe = function (editor, o) {\n      var title = editor.editorManager.translate('Rich Text Area. Press ALT-0 for help.');\n      var ifr = createIframeElement(editor.id, title, o.height, getIframeAttrs(editor)).dom;\n      ifr.onload = function () {\n        ifr.onload = null;\n        editor.fire('load');\n      };\n      var isDomainRelaxed = relaxDomain(editor, ifr);\n      editor.contentAreaContainer = o.iframeContainer;\n      editor.iframeElement = ifr;\n      editor.iframeHTML = getIframeHtml(editor);\n      DOM$5.add(o.iframeContainer, ifr);\n      return isDomainRelaxed;\n    };\n    var init$1 = function (editor, boxInfo) {\n      var isDomainRelaxed = createIframe(editor, boxInfo);\n      if (boxInfo.editorContainer) {\n        DOM$5.get(boxInfo.editorContainer).style.display = editor.orgDisplay;\n        editor.hidden = DOM$5.isHidden(boxInfo.editorContainer);\n      }\n      editor.getElement().style.display = 'none';\n      DOM$5.setAttrib(editor.id, 'aria-hidden', 'true');\n      if (!isDomainRelaxed) {\n        initContentBody(editor);\n      }\n    };\n\n    var DOM$6 = DOMUtils$1.DOM;\n    var initPlugin = function (editor, initializedPlugins, plugin) {\n      var Plugin = PluginManager.get(plugin);\n      var pluginUrl = PluginManager.urls[plugin] || editor.documentBaseUrl.replace(/\\/$/, '');\n      plugin = Tools.trim(plugin);\n      if (Plugin && Tools.inArray(initializedPlugins, plugin) === -1) {\n        Tools.each(PluginManager.dependencies(plugin), function (dep) {\n          initPlugin(editor, initializedPlugins, dep);\n        });\n        if (editor.plugins[plugin]) {\n          return;\n        }\n        try {\n          var pluginInstance = new Plugin(editor, pluginUrl, editor.$);\n          editor.plugins[plugin] = pluginInstance;\n          if (pluginInstance.init) {\n            pluginInstance.init(editor, pluginUrl);\n            initializedPlugins.push(plugin);\n          }\n        } catch (e) {\n          pluginInitError(editor, plugin, e);\n        }\n      }\n    };\n    var trimLegacyPrefix = function (name) {\n      return name.replace(/^\\-/, '');\n    };\n    var initPlugins = function (editor) {\n      var initializedPlugins = [];\n      Tools.each(getPlugins(editor).split(/[ ,]/), function (name) {\n        initPlugin(editor, initializedPlugins, trimLegacyPrefix(name));\n      });\n    };\n    var initIcons = function (editor) {\n      var iconPackName = Tools.trim(getIconPackName(editor));\n      var currentIcons = editor.ui.registry.getAll().icons;\n      var loadIcons = __assign(__assign({}, IconManager.get('default').icons), IconManager.get(iconPackName).icons);\n      each$1(loadIcons, function (svgData, icon) {\n        if (!has(currentIcons, icon)) {\n          editor.ui.registry.addIcon(icon, svgData);\n        }\n      });\n    };\n    var initTheme = function (editor) {\n      var theme = getTheme(editor);\n      if (isString(theme)) {\n        editor.settings.theme = trimLegacyPrefix(theme);\n        var Theme = ThemeManager.get(theme);\n        editor.theme = new Theme(editor, ThemeManager.urls[theme]);\n        if (editor.theme.init) {\n          editor.theme.init(editor, ThemeManager.urls[theme] || editor.documentBaseUrl.replace(/\\/$/, ''), editor.$);\n        }\n      } else {\n        editor.theme = {};\n      }\n    };\n    var renderFromLoadedTheme = function (editor) {\n      return editor.theme.renderUI();\n    };\n    var renderFromThemeFunc = function (editor) {\n      var elm = editor.getElement();\n      var theme = getTheme(editor);\n      var info = theme(editor, elm);\n      if (info.editorContainer.nodeType) {\n        info.editorContainer.id = info.editorContainer.id || editor.id + '_parent';\n      }\n      if (info.iframeContainer && info.iframeContainer.nodeType) {\n        info.iframeContainer.id = info.iframeContainer.id || editor.id + '_iframecontainer';\n      }\n      info.height = info.iframeHeight ? info.iframeHeight : elm.offsetHeight;\n      return info;\n    };\n    var createThemeFalseResult = function (element) {\n      return {\n        editorContainer: element,\n        iframeContainer: element,\n        api: {}\n      };\n    };\n    var renderThemeFalseIframe = function (targetElement) {\n      var iframeContainer = DOM$6.create('div');\n      DOM$6.insertAfter(iframeContainer, targetElement);\n      return createThemeFalseResult(iframeContainer);\n    };\n    var renderThemeFalse = function (editor) {\n      var targetElement = editor.getElement();\n      return editor.inline ? createThemeFalseResult(null) : renderThemeFalseIframe(targetElement);\n    };\n    var renderThemeUi = function (editor) {\n      var elm = editor.getElement();\n      editor.orgDisplay = elm.style.display;\n      if (isString(getTheme(editor))) {\n        return renderFromLoadedTheme(editor);\n      } else if (isFunction(getTheme(editor))) {\n        return renderFromThemeFunc(editor);\n      } else {\n        return renderThemeFalse(editor);\n      }\n    };\n    var init$2 = function (editor) {\n      editor.fire('ScriptsLoaded');\n      initIcons(editor);\n      initTheme(editor);\n      initPlugins(editor);\n      var renderInfo = renderThemeUi(editor);\n      editor.ui = __assign(__assign({}, editor.ui), renderInfo.api);\n      var boxInfo = {\n        editorContainer: renderInfo.editorContainer,\n        iframeContainer: renderInfo.iframeContainer\n      };\n      editor.editorContainer = boxInfo.editorContainer ? boxInfo.editorContainer : null;\n      appendContentCssFromSettings(editor);\n      if (editor.inline) {\n        return initContentBody(editor);\n      } else {\n        return init$1(editor, boxInfo);\n      }\n    };\n\n    var DOM$7 = DOMUtils$1.DOM;\n    var hasSkipLoadPrefix = function (name) {\n      return name.charAt(0) === '-';\n    };\n    var loadLanguage = function (scriptLoader, editor) {\n      var languageCode = getLanguageCode(editor);\n      var languageUrl = getLanguageUrl(editor);\n      if (I18n.hasCode(languageCode) === false && languageCode !== 'en') {\n        var url_1 = languageUrl !== '' ? languageUrl : editor.editorManager.baseURL + '/langs/' + languageCode + '.js';\n        scriptLoader.add(url_1, noop, undefined, function () {\n          languageLoadError(editor, url_1, languageCode);\n        });\n      }\n    };\n    var loadTheme = function (scriptLoader, editor, suffix, callback) {\n      var theme = getTheme(editor);\n      if (isString(theme)) {\n        if (!hasSkipLoadPrefix(theme) && !ThemeManager.urls.hasOwnProperty(theme)) {\n          var themeUrl = getThemeUrl(editor);\n          if (themeUrl) {\n            ThemeManager.load(theme, editor.documentBaseURI.toAbsolute(themeUrl));\n          } else {\n            ThemeManager.load(theme, 'themes/' + theme + '/theme' + suffix + '.js');\n          }\n        }\n        scriptLoader.loadQueue(function () {\n          ThemeManager.waitFor(theme, callback);\n        });\n      } else {\n        callback();\n      }\n    };\n    var getIconsUrlMetaFromUrl = function (editor) {\n      return Optional.from(getIconsUrl(editor)).filter(function (url) {\n        return url.length > 0;\n      }).map(function (url) {\n        return {\n          url: url,\n          name: Optional.none()\n        };\n      });\n    };\n    var getIconsUrlMetaFromName = function (editor, name, suffix) {\n      return Optional.from(name).filter(function (name) {\n        return name.length > 0 && !IconManager.has(name);\n      }).map(function (name) {\n        return {\n          url: editor.editorManager.baseURL + '/icons/' + name + '/icons' + suffix + '.js',\n          name: Optional.some(name)\n        };\n      });\n    };\n    var loadIcons = function (scriptLoader, editor, suffix) {\n      var defaultIconsUrl = getIconsUrlMetaFromName(editor, 'default', suffix);\n      var customIconsUrl = getIconsUrlMetaFromUrl(editor).orThunk(function () {\n        return getIconsUrlMetaFromName(editor, getIconPackName(editor), '');\n      });\n      each(cat([\n        defaultIconsUrl,\n        customIconsUrl\n      ]), function (urlMeta) {\n        scriptLoader.add(urlMeta.url, noop, undefined, function () {\n          iconsLoadError(editor, urlMeta.url, urlMeta.name.getOrUndefined());\n        });\n      });\n    };\n    var loadPlugins = function (editor, suffix) {\n      Tools.each(getExternalPlugins(editor), function (url, name) {\n        PluginManager.load(name, url, noop, undefined, function () {\n          pluginLoadError(editor, url, name);\n        });\n        editor.settings.plugins += ' ' + name;\n      });\n      Tools.each(getPlugins(editor).split(/[ ,]/), function (plugin) {\n        plugin = Tools.trim(plugin);\n        if (plugin && !PluginManager.urls[plugin]) {\n          if (hasSkipLoadPrefix(plugin)) {\n            plugin = plugin.substr(1, plugin.length);\n            var dependencies = PluginManager.dependencies(plugin);\n            Tools.each(dependencies, function (depPlugin) {\n              var defaultSettings = {\n                prefix: 'plugins/',\n                resource: depPlugin,\n                suffix: '/plugin' + suffix + '.js'\n              };\n              var dep = PluginManager.createUrl(defaultSettings, depPlugin);\n              PluginManager.load(dep.resource, dep, noop, undefined, function () {\n                pluginLoadError(editor, dep.prefix + dep.resource + dep.suffix, dep.resource);\n              });\n            });\n          } else {\n            var url_2 = {\n              prefix: 'plugins/',\n              resource: plugin,\n              suffix: '/plugin' + suffix + '.js'\n            };\n            PluginManager.load(plugin, url_2, noop, undefined, function () {\n              pluginLoadError(editor, url_2.prefix + url_2.resource + url_2.suffix, plugin);\n            });\n          }\n        }\n      });\n    };\n    var loadScripts = function (editor, suffix) {\n      var scriptLoader = ScriptLoader.ScriptLoader;\n      loadTheme(scriptLoader, editor, suffix, function () {\n        loadLanguage(scriptLoader, editor);\n        loadIcons(scriptLoader, editor, suffix);\n        loadPlugins(editor, suffix);\n        scriptLoader.loadQueue(function () {\n          if (!editor.removed) {\n            init$2(editor);\n          }\n        }, editor, function () {\n          if (!editor.removed) {\n            init$2(editor);\n          }\n        });\n      });\n    };\n    var getStyleSheetLoader$1 = function (element, editor) {\n      return instance.forElement(element, {\n        contentCssCors: hasContentCssCors(editor),\n        referrerPolicy: getReferrerPolicy(editor)\n      });\n    };\n    var render = function (editor) {\n      var id = editor.id;\n      I18n.setCode(getLanguageCode(editor));\n      var readyHandler = function () {\n        DOM$7.unbind(window, 'ready', readyHandler);\n        editor.render();\n      };\n      if (!EventUtils.Event.domLoaded) {\n        DOM$7.bind(window, 'ready', readyHandler);\n        return;\n      }\n      if (!editor.getElement()) {\n        return;\n      }\n      if (!Env.contentEditable) {\n        return;\n      }\n      var element = SugarElement.fromDom(editor.getElement());\n      var snapshot = clone(element);\n      editor.on('remove', function () {\n        eachr(element.dom.attributes, function (attr) {\n          return remove$1(element, attr.name);\n        });\n        setAll(element, snapshot);\n      });\n      editor.ui.styleSheetLoader = getStyleSheetLoader$1(element, editor);\n      if (!isInline$1(editor)) {\n        editor.orgVisibility = editor.getElement().style.visibility;\n        editor.getElement().style.visibility = 'hidden';\n      } else {\n        editor.inline = true;\n      }\n      var form = editor.getElement().form || DOM$7.getParent(id, 'form');\n      if (form) {\n        editor.formElement = form;\n        if (hasHiddenInput(editor) && !isTextareaOrInput(editor.getElement())) {\n          DOM$7.insertAfter(DOM$7.create('input', {\n            type: 'hidden',\n            name: id\n          }), id);\n          editor.hasHiddenInput = true;\n        }\n        editor.formEventDelegate = function (e) {\n          editor.fire(e.type, e);\n        };\n        DOM$7.bind(form, 'submit reset', editor.formEventDelegate);\n        editor.on('reset', function () {\n          editor.resetContent();\n        });\n        if (shouldPatchSubmit(editor) && !form.submit.nodeType && !form.submit.length && !form._mceOldSubmit) {\n          form._mceOldSubmit = form.submit;\n          form.submit = function () {\n            editor.editorManager.triggerSave();\n            editor.setDirty(false);\n            return form._mceOldSubmit(form);\n          };\n        }\n      }\n      editor.windowManager = WindowManager(editor);\n      editor.notificationManager = NotificationManager(editor);\n      if (isEncodingXml(editor)) {\n        editor.on('GetContent', function (e) {\n          if (e.save) {\n            e.content = DOM$7.encode(e.content);\n          }\n        });\n      }\n      if (shouldAddFormSubmitTrigger(editor)) {\n        editor.on('submit', function () {\n          if (editor.initialized) {\n            editor.save();\n          }\n        });\n      }\n      if (shouldAddUnloadTrigger(editor)) {\n        editor._beforeUnload = function () {\n          if (editor.initialized && !editor.destroyed && !editor.isHidden()) {\n            editor.save({\n              format: 'raw',\n              no_events: true,\n              set_dirty: false\n            });\n          }\n        };\n        editor.editorManager.on('BeforeUnload', editor._beforeUnload);\n      }\n      editor.editorManager.add(editor);\n      loadScripts(editor, editor.suffix);\n    };\n\n    var ensureIsRoot = function (isRoot) {\n      return isFunction(isRoot) ? isRoot : never;\n    };\n    var ancestor$3 = function (scope, transform, isRoot) {\n      var element = scope.dom;\n      var stop = ensureIsRoot(isRoot);\n      while (element.parentNode) {\n        element = element.parentNode;\n        var el = SugarElement.fromDom(element);\n        var transformed = transform(el);\n        if (transformed.isSome()) {\n          return transformed;\n        } else if (stop(el)) {\n          break;\n        }\n      }\n      return Optional.none();\n    };\n    var closest$2 = function (scope, transform, isRoot) {\n      var current = transform(scope);\n      var stop = ensureIsRoot(isRoot);\n      return current.orThunk(function () {\n        return stop(scope) ? Optional.none() : ancestor$3(scope, transform, stop);\n      });\n    };\n\n    var legacyPropNames = {\n      'font-size': 'size',\n      'font-family': 'face'\n    };\n    var getSpecifiedFontProp = function (propName, rootElm, elm) {\n      var getProperty = function (elm) {\n        return getRaw(elm, propName).orThunk(function () {\n          if (name(elm) === 'font') {\n            return get(legacyPropNames, propName).bind(function (legacyPropName) {\n              return getOpt(elm, legacyPropName);\n            });\n          } else {\n            return Optional.none();\n          }\n        });\n      };\n      var isRoot = function (elm) {\n        return eq$2(SugarElement.fromDom(rootElm), elm);\n      };\n      return closest$2(SugarElement.fromDom(elm), function (elm) {\n        return getProperty(elm);\n      }, isRoot);\n    };\n    var normalizeFontFamily = function (fontFamily) {\n      return fontFamily.replace(/[\\'\\\"\\\\]/g, '').replace(/,\\s+/g, ',');\n    };\n    var getComputedFontProp = function (propName, elm) {\n      return Optional.from(DOMUtils$1.DOM.getStyle(elm, propName, true));\n    };\n    var getFontProp = function (propName) {\n      return function (rootElm, elm) {\n        return Optional.from(elm).map(SugarElement.fromDom).filter(isElement).bind(function (element) {\n          return getSpecifiedFontProp(propName, rootElm, element.dom).or(getComputedFontProp(propName, element.dom));\n        }).getOr('');\n      };\n    };\n    var getFontSize = getFontProp('font-size');\n    var getFontFamily = compose(normalizeFontFamily, getFontProp('font-family'));\n\n    var findFirstCaretElement = function (editor) {\n      return firstPositionIn(editor.getBody()).map(function (caret) {\n        var container = caret.container();\n        return isText$1(container) ? container.parentNode : container;\n      });\n    };\n    var getCaretElement = function (editor) {\n      return Optional.from(editor.selection.getRng()).bind(function (rng) {\n        var root = editor.getBody();\n        var atStartOfNode = rng.startContainer === root && rng.startOffset === 0;\n        return atStartOfNode ? Optional.none() : Optional.from(editor.selection.getStart(true));\n      });\n    };\n    var mapRange = function (editor, mapper) {\n      return getCaretElement(editor).orThunk(curry(findFirstCaretElement, editor)).map(SugarElement.fromDom).filter(isElement).map(mapper);\n    };\n\n    var fromFontSizeNumber = function (editor, value) {\n      if (/^[0-9.]+$/.test(value)) {\n        var fontSizeNumber = parseInt(value, 10);\n        if (fontSizeNumber >= 1 && fontSizeNumber <= 7) {\n          var fontSizes = getFontStyleValues(editor);\n          var fontClasses = getFontSizeClasses(editor);\n          if (fontClasses) {\n            return fontClasses[fontSizeNumber - 1] || value;\n          } else {\n            return fontSizes[fontSizeNumber - 1] || value;\n          }\n        } else {\n          return value;\n        }\n      } else {\n        return value;\n      }\n    };\n    var normalizeFontNames = function (font) {\n      var fonts = font.split(/\\s*,\\s*/);\n      return map(fonts, function (font) {\n        if (font.indexOf(' ') !== -1 && !(startsWith(font, '\"') || startsWith(font, '\\''))) {\n          return '\\'' + font + '\\'';\n        } else {\n          return font;\n        }\n      }).join(',');\n    };\n    var fontNameAction = function (editor, value) {\n      var font = fromFontSizeNumber(editor, value);\n      editor.formatter.toggle('fontname', { value: normalizeFontNames(font) });\n      editor.nodeChanged();\n    };\n    var fontNameQuery = function (editor) {\n      return mapRange(editor, function (elm) {\n        return getFontFamily(editor.getBody(), elm.dom);\n      }).getOr('');\n    };\n    var fontSizeAction = function (editor, value) {\n      editor.formatter.toggle('fontsize', { value: fromFontSizeNumber(editor, value) });\n      editor.nodeChanged();\n    };\n    var fontSizeQuery = function (editor) {\n      return mapRange(editor, function (elm) {\n        return getFontSize(editor.getBody(), elm.dom);\n      }).getOr('');\n    };\n\n    var lineHeightQuery = function (editor) {\n      return mapRange(editor, function (elm) {\n        var root = SugarElement.fromDom(editor.getBody());\n        var specifiedStyle = closest$2(elm, function (elm) {\n          return getRaw(elm, 'line-height');\n        }, curry(eq$2, root));\n        var computedStyle = function () {\n          var lineHeight = parseFloat(get$4(elm, 'line-height'));\n          var fontSize = parseFloat(get$4(elm, 'font-size'));\n          return String(lineHeight / fontSize);\n        };\n        return specifiedStyle.getOrThunk(computedStyle);\n      }).getOr('');\n    };\n    var lineHeightAction = function (editor, lineHeight) {\n      editor.undoManager.transact(function () {\n        editor.formatter.toggle('lineheight', { value: String(lineHeight) });\n        editor.nodeChanged();\n      });\n    };\n\n    var processValue = function (value) {\n      var details;\n      if (typeof value !== 'string') {\n        details = Tools.extend({\n          paste: value.paste,\n          data: { paste: value.paste }\n        }, value);\n        return {\n          content: value.content,\n          details: details\n        };\n      }\n      return {\n        content: value,\n        details: {}\n      };\n    };\n    var insertAtCaret$1 = function (editor, value) {\n      var result = processValue(value);\n      insertContent(editor, result.content, result.details);\n    };\n\n    var each$f = Tools.each;\n    var map$3 = Tools.map, inArray$2 = Tools.inArray;\n    var EditorCommands = function () {\n      function EditorCommands(editor) {\n        this.commands = {\n          state: {},\n          exec: {},\n          value: {}\n        };\n        this.editor = editor;\n        this.setupCommands(editor);\n      }\n      EditorCommands.prototype.execCommand = function (command, ui, value, args) {\n        var func, state = false;\n        var self = this;\n        if (self.editor.removed) {\n          return;\n        }\n        if (!/^(mceAddUndoLevel|mceEndUndoLevel|mceBeginUndoLevel|mceRepaint)$/.test(command) && (!args || !args.skip_focus)) {\n          self.editor.focus();\n        } else {\n          restore(self.editor);\n        }\n        args = self.editor.fire('BeforeExecCommand', {\n          command: command,\n          ui: ui,\n          value: value\n        });\n        if (args.isDefaultPrevented()) {\n          return false;\n        }\n        var customCommand = command.toLowerCase();\n        if (func = self.commands.exec[customCommand]) {\n          func(customCommand, ui, value);\n          self.editor.fire('ExecCommand', {\n            command: command,\n            ui: ui,\n            value: value\n          });\n          return true;\n        }\n        each$f(this.editor.plugins, function (p) {\n          if (p.execCommand && p.execCommand(command, ui, value)) {\n            self.editor.fire('ExecCommand', {\n              command: command,\n              ui: ui,\n              value: value\n            });\n            state = true;\n            return false;\n          }\n        });\n        if (state) {\n          return state;\n        }\n        if (self.editor.theme && self.editor.theme.execCommand && self.editor.theme.execCommand(command, ui, value)) {\n          self.editor.fire('ExecCommand', {\n            command: command,\n            ui: ui,\n            value: value\n          });\n          return true;\n        }\n        try {\n          state = self.editor.getDoc().execCommand(command, ui, value);\n        } catch (ex) {\n        }\n        if (state) {\n          self.editor.fire('ExecCommand', {\n            command: command,\n            ui: ui,\n            value: value\n          });\n          return true;\n        }\n        return false;\n      };\n      EditorCommands.prototype.queryCommandState = function (command) {\n        var func;\n        if (this.editor.quirks.isHidden() || this.editor.removed) {\n          return;\n        }\n        command = command.toLowerCase();\n        if (func = this.commands.state[command]) {\n          return func(command);\n        }\n        try {\n          return this.editor.getDoc().queryCommandState(command);\n        } catch (ex) {\n        }\n        return false;\n      };\n      EditorCommands.prototype.queryCommandValue = function (command) {\n        var func;\n        if (this.editor.quirks.isHidden() || this.editor.removed) {\n          return;\n        }\n        command = command.toLowerCase();\n        if (func = this.commands.value[command]) {\n          return func(command);\n        }\n        try {\n          return this.editor.getDoc().queryCommandValue(command);\n        } catch (ex) {\n        }\n      };\n      EditorCommands.prototype.addCommands = function (commandList, type) {\n        if (type === void 0) {\n          type = 'exec';\n        }\n        var self = this;\n        each$f(commandList, function (callback, command) {\n          each$f(command.toLowerCase().split(','), function (command) {\n            self.commands[type][command] = callback;\n          });\n        });\n      };\n      EditorCommands.prototype.addCommand = function (command, callback, scope) {\n        var _this = this;\n        command = command.toLowerCase();\n        this.commands.exec[command] = function (command, ui, value, args) {\n          return callback.call(scope || _this.editor, ui, value, args);\n        };\n      };\n      EditorCommands.prototype.queryCommandSupported = function (command) {\n        command = command.toLowerCase();\n        if (this.commands.exec[command]) {\n          return true;\n        }\n        try {\n          return this.editor.getDoc().queryCommandSupported(command);\n        } catch (ex) {\n        }\n        return false;\n      };\n      EditorCommands.prototype.addQueryStateHandler = function (command, callback, scope) {\n        var _this = this;\n        command = command.toLowerCase();\n        this.commands.state[command] = function () {\n          return callback.call(scope || _this.editor);\n        };\n      };\n      EditorCommands.prototype.addQueryValueHandler = function (command, callback, scope) {\n        var _this = this;\n        command = command.toLowerCase();\n        this.commands.value[command] = function () {\n          return callback.call(scope || _this.editor);\n        };\n      };\n      EditorCommands.prototype.hasCustomCommand = function (command) {\n        command = command.toLowerCase();\n        return !!this.commands.exec[command];\n      };\n      EditorCommands.prototype.execNativeCommand = function (command, ui, value) {\n        if (ui === undefined) {\n          ui = false;\n        }\n        if (value === undefined) {\n          value = null;\n        }\n        return this.editor.getDoc().execCommand(command, ui, value);\n      };\n      EditorCommands.prototype.isFormatMatch = function (name) {\n        return this.editor.formatter.match(name);\n      };\n      EditorCommands.prototype.toggleFormat = function (name, value) {\n        this.editor.formatter.toggle(name, value ? { value: value } : undefined);\n        this.editor.nodeChanged();\n      };\n      EditorCommands.prototype.storeSelection = function (type) {\n        this.selectionBookmark = this.editor.selection.getBookmark(type);\n      };\n      EditorCommands.prototype.restoreSelection = function () {\n        this.editor.selection.moveToBookmark(this.selectionBookmark);\n      };\n      EditorCommands.prototype.setupCommands = function (editor) {\n        var self = this;\n        this.addCommands({\n          'mceResetDesignMode,mceBeginUndoLevel': function () {\n          },\n          'mceEndUndoLevel,mceAddUndoLevel': function () {\n            editor.undoManager.add();\n          },\n          'Cut,Copy,Paste': function (command) {\n            var doc = editor.getDoc();\n            var failed;\n            try {\n              self.execNativeCommand(command);\n            } catch (ex) {\n              failed = true;\n            }\n            if (command === 'paste' && !doc.queryCommandEnabled(command)) {\n              failed = true;\n            }\n            if (failed || !doc.queryCommandSupported(command)) {\n              var msg = editor.translate('Your browser doesn\\'t support direct access to the clipboard. ' + 'Please use the Ctrl+X/C/V keyboard shortcuts instead.');\n              if (Env.mac) {\n                msg = msg.replace(/Ctrl\\+/g, '\\u2318+');\n              }\n              editor.notificationManager.open({\n                text: msg,\n                type: 'error'\n              });\n            }\n          },\n          'unlink': function () {\n            if (editor.selection.isCollapsed()) {\n              var elm = editor.dom.getParent(editor.selection.getStart(), 'a');\n              if (elm) {\n                editor.dom.remove(elm, true);\n              }\n              return;\n            }\n            editor.formatter.remove('link');\n          },\n          'JustifyLeft,JustifyCenter,JustifyRight,JustifyFull,JustifyNone': function (command) {\n            var align = command.substring(7);\n            if (align === 'full') {\n              align = 'justify';\n            }\n            each$f('left,center,right,justify'.split(','), function (name) {\n              if (align !== name) {\n                editor.formatter.remove('align' + name);\n              }\n            });\n            if (align !== 'none') {\n              self.toggleFormat('align' + align);\n            }\n          },\n          'InsertUnorderedList,InsertOrderedList': function (command) {\n            var listParent;\n            self.execNativeCommand(command);\n            var listElm = editor.dom.getParent(editor.selection.getNode(), 'ol,ul');\n            if (listElm) {\n              listParent = listElm.parentNode;\n              if (/^(H[1-6]|P|ADDRESS|PRE)$/.test(listParent.nodeName)) {\n                self.storeSelection();\n                editor.dom.split(listParent, listElm);\n                self.restoreSelection();\n              }\n            }\n          },\n          'Bold,Italic,Underline,Strikethrough,Superscript,Subscript': function (command) {\n            self.toggleFormat(command);\n          },\n          'ForeColor,HiliteColor': function (command, ui, value) {\n            self.toggleFormat(command, value);\n          },\n          'FontName': function (command, ui, value) {\n            fontNameAction(editor, value);\n          },\n          'FontSize': function (command, ui, value) {\n            fontSizeAction(editor, value);\n          },\n          'LineHeight': function (command, ui, value) {\n            lineHeightAction(editor, value);\n          },\n          'RemoveFormat': function (command) {\n            editor.formatter.remove(command);\n          },\n          'mceBlockQuote': function () {\n            self.toggleFormat('blockquote');\n          },\n          'FormatBlock': function (command, ui, value) {\n            return self.toggleFormat(value || 'p');\n          },\n          'mceCleanup': function () {\n            var bookmark = editor.selection.getBookmark();\n            editor.setContent(editor.getContent());\n            editor.selection.moveToBookmark(bookmark);\n          },\n          'mceRemoveNode': function (command, ui, value) {\n            var node = value || editor.selection.getNode();\n            if (node !== editor.getBody()) {\n              self.storeSelection();\n              editor.dom.remove(node, true);\n              self.restoreSelection();\n            }\n          },\n          'mceSelectNodeDepth': function (command, ui, value) {\n            var counter = 0;\n            editor.dom.getParent(editor.selection.getNode(), function (node) {\n              if (node.nodeType === 1 && counter++ === value) {\n                editor.selection.select(node);\n                return false;\n              }\n            }, editor.getBody());\n          },\n          'mceSelectNode': function (command, ui, value) {\n            editor.selection.select(value);\n          },\n          'mceInsertContent': function (command, ui, value) {\n            insertAtCaret$1(editor, value);\n          },\n          'mceInsertRawHTML': function (command, ui, value) {\n            editor.selection.setContent('tiny_mce_marker');\n            var content = editor.getContent();\n            editor.setContent(content.replace(/tiny_mce_marker/g, function () {\n              return value;\n            }));\n          },\n          'mceInsertNewLine': function (command, ui, value) {\n            insert$3(editor, value);\n          },\n          'mceToggleFormat': function (command, ui, value) {\n            self.toggleFormat(value);\n          },\n          'mceSetContent': function (command, ui, value) {\n            editor.setContent(value);\n          },\n          'Indent,Outdent': function (command) {\n            handle(editor, command);\n          },\n          'mceRepaint': function () {\n          },\n          'InsertHorizontalRule': function () {\n            editor.execCommand('mceInsertContent', false, '<hr />');\n          },\n          'mceToggleVisualAid': function () {\n            editor.hasVisual = !editor.hasVisual;\n            editor.addVisual();\n          },\n          'mceReplaceContent': function (command, ui, value) {\n            editor.execCommand('mceInsertContent', false, value.replace(/\\{\\$selection\\}/g, editor.selection.getContent({ format: 'text' })));\n          },\n          'mceInsertLink': function (command, ui, value) {\n            if (typeof value === 'string') {\n              value = { href: value };\n            }\n            var anchor = editor.dom.getParent(editor.selection.getNode(), 'a');\n            value.href = value.href.replace(/ /g, '%20');\n            if (!anchor || !value.href) {\n              editor.formatter.remove('link');\n            }\n            if (value.href) {\n              editor.formatter.apply('link', value, anchor);\n            }\n          },\n          'selectAll': function () {\n            var editingHost = editor.dom.getParent(editor.selection.getStart(), isContentEditableTrue);\n            if (editingHost) {\n              var rng = editor.dom.createRng();\n              rng.selectNodeContents(editingHost);\n              editor.selection.setRng(rng);\n            }\n          },\n          'mceNewDocument': function () {\n            editor.setContent('');\n          },\n          'InsertLineBreak': function (command, ui, value) {\n            insert$2(editor, value);\n            return true;\n          }\n        });\n        var alignStates = function (name) {\n          return function () {\n            var selection = editor.selection;\n            var nodes = selection.isCollapsed() ? [editor.dom.getParent(selection.getNode(), editor.dom.isBlock)] : selection.getSelectedBlocks();\n            var matches = map$3(nodes, function (node) {\n              return !!editor.formatter.matchNode(node, name);\n            });\n            return inArray$2(matches, true) !== -1;\n          };\n        };\n        self.addCommands({\n          'JustifyLeft': alignStates('alignleft'),\n          'JustifyCenter': alignStates('aligncenter'),\n          'JustifyRight': alignStates('alignright'),\n          'JustifyFull': alignStates('alignjustify'),\n          'Bold,Italic,Underline,Strikethrough,Superscript,Subscript': function (command) {\n            return self.isFormatMatch(command);\n          },\n          'mceBlockQuote': function () {\n            return self.isFormatMatch('blockquote');\n          },\n          'Outdent': function () {\n            return canOutdent(editor);\n          },\n          'InsertUnorderedList,InsertOrderedList': function (command) {\n            var list = editor.dom.getParent(editor.selection.getNode(), 'ul,ol');\n            return list && (command === 'insertunorderedlist' && list.tagName === 'UL' || command === 'insertorderedlist' && list.tagName === 'OL');\n          }\n        }, 'state');\n        self.addCommands({\n          Undo: function () {\n            editor.undoManager.undo();\n          },\n          Redo: function () {\n            editor.undoManager.redo();\n          }\n        });\n        self.addQueryValueHandler('FontName', function () {\n          return fontNameQuery(editor);\n        }, this);\n        self.addQueryValueHandler('FontSize', function () {\n          return fontSizeQuery(editor);\n        }, this);\n        self.addQueryValueHandler('LineHeight', function () {\n          return lineHeightQuery(editor);\n        }, this);\n      };\n      return EditorCommands;\n    }();\n\n    var internalContentEditableAttr = 'data-mce-contenteditable';\n    var toggleClass = function (elm, cls, state) {\n      if (has$2(elm, cls) && state === false) {\n        remove$4(elm, cls);\n      } else if (state) {\n        add$3(elm, cls);\n      }\n    };\n    var setEditorCommandState = function (editor, cmd, state) {\n      try {\n        editor.getDoc().execCommand(cmd, false, String(state));\n      } catch (ex) {\n      }\n    };\n    var setContentEditable = function (elm, state) {\n      elm.dom.contentEditable = state ? 'true' : 'false';\n    };\n    var switchOffContentEditableTrue = function (elm) {\n      each(descendants$1(elm, '*[contenteditable=\"true\"]'), function (elm) {\n        set(elm, internalContentEditableAttr, 'true');\n        setContentEditable(elm, false);\n      });\n    };\n    var switchOnContentEditableTrue = function (elm) {\n      each(descendants$1(elm, '*[' + internalContentEditableAttr + '=\"true\"]'), function (elm) {\n        remove$1(elm, internalContentEditableAttr);\n        setContentEditable(elm, true);\n      });\n    };\n    var removeFakeSelection = function (editor) {\n      Optional.from(editor.selection.getNode()).each(function (elm) {\n        elm.removeAttribute('data-mce-selected');\n      });\n    };\n    var restoreFakeSelection = function (editor) {\n      editor.selection.setRng(editor.selection.getRng());\n    };\n    var toggleReadOnly = function (editor, state) {\n      var body = SugarElement.fromDom(editor.getBody());\n      toggleClass(body, 'mce-content-readonly', state);\n      if (state) {\n        editor.selection.controlSelection.hideResizeRect();\n        editor._selectionOverrides.hideFakeCaret();\n        removeFakeSelection(editor);\n        editor.readonly = true;\n        setContentEditable(body, false);\n        switchOffContentEditableTrue(body);\n      } else {\n        editor.readonly = false;\n        setContentEditable(body, true);\n        switchOnContentEditableTrue(body);\n        setEditorCommandState(editor, 'StyleWithCSS', false);\n        setEditorCommandState(editor, 'enableInlineTableEditing', false);\n        setEditorCommandState(editor, 'enableObjectResizing', false);\n        if (hasEditorOrUiFocus(editor)) {\n          editor.focus();\n        }\n        restoreFakeSelection(editor);\n        editor.nodeChanged();\n      }\n    };\n    var isReadOnly$1 = function (editor) {\n      return editor.readonly;\n    };\n    var registerFilters = function (editor) {\n      editor.parser.addAttributeFilter('contenteditable', function (nodes) {\n        if (isReadOnly$1(editor)) {\n          each(nodes, function (node) {\n            node.attr(internalContentEditableAttr, node.attr('contenteditable'));\n            node.attr('contenteditable', 'false');\n          });\n        }\n      });\n      editor.serializer.addAttributeFilter(internalContentEditableAttr, function (nodes) {\n        if (isReadOnly$1(editor)) {\n          each(nodes, function (node) {\n            node.attr('contenteditable', node.attr(internalContentEditableAttr));\n          });\n        }\n      });\n      editor.serializer.addTempAttr(internalContentEditableAttr);\n    };\n    var registerReadOnlyContentFilters = function (editor) {\n      if (editor.serializer) {\n        registerFilters(editor);\n      } else {\n        editor.on('PreInit', function () {\n          registerFilters(editor);\n        });\n      }\n    };\n    var isClickEvent = function (e) {\n      return e.type === 'click';\n    };\n    var isInAnchor = function (editor, target) {\n      return editor.dom.getParent(target, 'a') !== null;\n    };\n    var preventReadOnlyEvents = function (editor, e) {\n      var target = e.target;\n      if (isClickEvent(e) && !VK.metaKeyPressed(e) && isInAnchor(editor, target)) {\n        e.preventDefault();\n      }\n    };\n    var registerReadOnlySelectionBlockers = function (editor) {\n      editor.on('ShowCaret', function (e) {\n        if (isReadOnly$1(editor)) {\n          e.preventDefault();\n        }\n      });\n      editor.on('ObjectSelected', function (e) {\n        if (isReadOnly$1(editor)) {\n          e.preventDefault();\n        }\n      });\n    };\n\n    var nativeEvents = Tools.makeMap('focus blur focusin focusout click dblclick mousedown mouseup mousemove mouseover beforepaste paste cut copy selectionchange ' + 'mouseout mouseenter mouseleave wheel keydown keypress keyup input beforeinput contextmenu dragstart dragend dragover ' + 'draggesture dragdrop drop drag submit ' + 'compositionstart compositionend compositionupdate touchstart touchmove touchend touchcancel', ' ');\n    var EventDispatcher = function () {\n      function EventDispatcher(settings) {\n        this.bindings = {};\n        this.settings = settings || {};\n        this.scope = this.settings.scope || this;\n        this.toggleEvent = this.settings.toggleEvent || never;\n      }\n      EventDispatcher.isNative = function (name) {\n        return !!nativeEvents[name.toLowerCase()];\n      };\n      EventDispatcher.prototype.fire = function (nameIn, argsIn) {\n        var name = nameIn.toLowerCase();\n        var args = argsIn || {};\n        args.type = name;\n        if (!args.target) {\n          args.target = this.scope;\n        }\n        if (!args.preventDefault) {\n          args.preventDefault = function () {\n            args.isDefaultPrevented = always;\n          };\n          args.stopPropagation = function () {\n            args.isPropagationStopped = always;\n          };\n          args.stopImmediatePropagation = function () {\n            args.isImmediatePropagationStopped = always;\n          };\n          args.isDefaultPrevented = never;\n          args.isPropagationStopped = never;\n          args.isImmediatePropagationStopped = never;\n        }\n        if (this.settings.beforeFire) {\n          this.settings.beforeFire(args);\n        }\n        var handlers = this.bindings[name];\n        if (handlers) {\n          for (var i = 0, l = handlers.length; i < l; i++) {\n            var callback = handlers[i];\n            if (callback.once) {\n              this.off(name, callback.func);\n            }\n            if (args.isImmediatePropagationStopped()) {\n              args.stopPropagation();\n              return args;\n            }\n            if (callback.func.call(this.scope, args) === false) {\n              args.preventDefault();\n              return args;\n            }\n          }\n        }\n        return args;\n      };\n      EventDispatcher.prototype.on = function (name, callback, prepend, extra) {\n        if (callback === false) {\n          callback = never;\n        }\n        if (callback) {\n          var wrappedCallback = { func: callback };\n          if (extra) {\n            Tools.extend(wrappedCallback, extra);\n          }\n          var names = name.toLowerCase().split(' ');\n          var i = names.length;\n          while (i--) {\n            var currentName = names[i];\n            var handlers = this.bindings[currentName];\n            if (!handlers) {\n              handlers = this.bindings[currentName] = [];\n              this.toggleEvent(currentName, true);\n            }\n            if (prepend) {\n              handlers.unshift(wrappedCallback);\n            } else {\n              handlers.push(wrappedCallback);\n            }\n          }\n        }\n        return this;\n      };\n      EventDispatcher.prototype.off = function (name, callback) {\n        var _this = this;\n        if (name) {\n          var names = name.toLowerCase().split(' ');\n          var i = names.length;\n          while (i--) {\n            var currentName = names[i];\n            var handlers = this.bindings[currentName];\n            if (!currentName) {\n              each$1(this.bindings, function (_value, bindingName) {\n                _this.toggleEvent(bindingName, false);\n                delete _this.bindings[bindingName];\n              });\n              return this;\n            }\n            if (handlers) {\n              if (!callback) {\n                handlers.length = 0;\n              } else {\n                var hi = handlers.length;\n                while (hi--) {\n                  if (handlers[hi].func === callback) {\n                    handlers = handlers.slice(0, hi).concat(handlers.slice(hi + 1));\n                    this.bindings[currentName] = handlers;\n                  }\n                }\n              }\n              if (!handlers.length) {\n                this.toggleEvent(name, false);\n                delete this.bindings[currentName];\n              }\n            }\n          }\n        } else {\n          each$1(this.bindings, function (_value, name) {\n            _this.toggleEvent(name, false);\n          });\n          this.bindings = {};\n        }\n        return this;\n      };\n      EventDispatcher.prototype.once = function (name, callback, prepend) {\n        return this.on(name, callback, prepend, { once: true });\n      };\n      EventDispatcher.prototype.has = function (name) {\n        name = name.toLowerCase();\n        return !(!this.bindings[name] || this.bindings[name].length === 0);\n      };\n      return EventDispatcher;\n    }();\n\n    var getEventDispatcher = function (obj) {\n      if (!obj._eventDispatcher) {\n        obj._eventDispatcher = new EventDispatcher({\n          scope: obj,\n          toggleEvent: function (name, state) {\n            if (EventDispatcher.isNative(name) && obj.toggleNativeEvent) {\n              obj.toggleNativeEvent(name, state);\n            }\n          }\n        });\n      }\n      return obj._eventDispatcher;\n    };\n    var Observable = {\n      fire: function (name, args, bubble) {\n        var self = this;\n        if (self.removed && name !== 'remove' && name !== 'detach') {\n          return args;\n        }\n        var dispatcherArgs = getEventDispatcher(self).fire(name, args);\n        if (bubble !== false && self.parent) {\n          var parent_1 = self.parent();\n          while (parent_1 && !dispatcherArgs.isPropagationStopped()) {\n            parent_1.fire(name, dispatcherArgs, false);\n            parent_1 = parent_1.parent();\n          }\n        }\n        return dispatcherArgs;\n      },\n      on: function (name, callback, prepend) {\n        return getEventDispatcher(this).on(name, callback, prepend);\n      },\n      off: function (name, callback) {\n        return getEventDispatcher(this).off(name, callback);\n      },\n      once: function (name, callback) {\n        return getEventDispatcher(this).once(name, callback);\n      },\n      hasEventListeners: function (name) {\n        return getEventDispatcher(this).has(name);\n      }\n    };\n\n    var DOM$8 = DOMUtils$1.DOM;\n    var customEventRootDelegates;\n    var getEventTarget = function (editor, eventName) {\n      if (eventName === 'selectionchange') {\n        return editor.getDoc();\n      }\n      if (!editor.inline && /^mouse|touch|click|contextmenu|drop|dragover|dragend/.test(eventName)) {\n        return editor.getDoc().documentElement;\n      }\n      var eventRoot = getEventRoot(editor);\n      if (eventRoot) {\n        if (!editor.eventRoot) {\n          editor.eventRoot = DOM$8.select(eventRoot)[0];\n        }\n        return editor.eventRoot;\n      }\n      return editor.getBody();\n    };\n    var isListening = function (editor) {\n      return !editor.hidden && !isReadOnly$1(editor);\n    };\n    var fireEvent = function (editor, eventName, e) {\n      if (isListening(editor)) {\n        editor.fire(eventName, e);\n      } else if (isReadOnly$1(editor)) {\n        preventReadOnlyEvents(editor, e);\n      }\n    };\n    var bindEventDelegate = function (editor, eventName) {\n      var delegate;\n      if (!editor.delegates) {\n        editor.delegates = {};\n      }\n      if (editor.delegates[eventName] || editor.removed) {\n        return;\n      }\n      var eventRootElm = getEventTarget(editor, eventName);\n      if (getEventRoot(editor)) {\n        if (!customEventRootDelegates) {\n          customEventRootDelegates = {};\n          editor.editorManager.on('removeEditor', function () {\n            if (!editor.editorManager.activeEditor) {\n              if (customEventRootDelegates) {\n                each$1(customEventRootDelegates, function (_value, name) {\n                  editor.dom.unbind(getEventTarget(editor, name));\n                });\n                customEventRootDelegates = null;\n              }\n            }\n          });\n        }\n        if (customEventRootDelegates[eventName]) {\n          return;\n        }\n        delegate = function (e) {\n          var target = e.target;\n          var editors = editor.editorManager.get();\n          var i = editors.length;\n          while (i--) {\n            var body = editors[i].getBody();\n            if (body === target || DOM$8.isChildOf(target, body)) {\n              fireEvent(editors[i], eventName, e);\n            }\n          }\n        };\n        customEventRootDelegates[eventName] = delegate;\n        DOM$8.bind(eventRootElm, eventName, delegate);\n      } else {\n        delegate = function (e) {\n          fireEvent(editor, eventName, e);\n        };\n        DOM$8.bind(eventRootElm, eventName, delegate);\n        editor.delegates[eventName] = delegate;\n      }\n    };\n    var EditorObservable = __assign(__assign({}, Observable), {\n      bindPendingEventDelegates: function () {\n        var self = this;\n        Tools.each(self._pendingNativeEvents, function (name) {\n          bindEventDelegate(self, name);\n        });\n      },\n      toggleNativeEvent: function (name, state) {\n        var self = this;\n        if (name === 'focus' || name === 'blur') {\n          return;\n        }\n        if (state) {\n          if (self.initialized) {\n            bindEventDelegate(self, name);\n          } else {\n            if (!self._pendingNativeEvents) {\n              self._pendingNativeEvents = [name];\n            } else {\n              self._pendingNativeEvents.push(name);\n            }\n          }\n        } else if (self.initialized) {\n          self.dom.unbind(getEventTarget(self, name), name, self.delegates[name]);\n          delete self.delegates[name];\n        }\n      },\n      unbindAllNativeEvents: function () {\n        var self = this;\n        var body = self.getBody();\n        var dom = self.dom;\n        if (self.delegates) {\n          each$1(self.delegates, function (value, name) {\n            self.dom.unbind(getEventTarget(self, name), name, value);\n          });\n          delete self.delegates;\n        }\n        if (!self.inline && body && dom) {\n          body.onload = null;\n          dom.unbind(self.getWin());\n          dom.unbind(self.getDoc());\n        }\n        if (dom) {\n          dom.unbind(body);\n          dom.unbind(self.getContainer());\n        }\n      }\n    });\n\n    var defaultModes = [\n      'design',\n      'readonly'\n    ];\n    var switchToMode = function (editor, activeMode, availableModes, mode) {\n      var oldMode = availableModes[activeMode.get()];\n      var newMode = availableModes[mode];\n      try {\n        newMode.activate();\n      } catch (e) {\n        console.error('problem while activating editor mode ' + mode + ':', e);\n        return;\n      }\n      oldMode.deactivate();\n      if (oldMode.editorReadOnly !== newMode.editorReadOnly) {\n        toggleReadOnly(editor, newMode.editorReadOnly);\n      }\n      activeMode.set(mode);\n      fireSwitchMode(editor, mode);\n    };\n    var setMode = function (editor, availableModes, activeMode, mode) {\n      if (mode === activeMode.get()) {\n        return;\n      } else if (!has(availableModes, mode)) {\n        throw new Error('Editor mode \\'' + mode + '\\' is invalid');\n      }\n      if (editor.initialized) {\n        switchToMode(editor, activeMode, availableModes, mode);\n      } else {\n        editor.on('init', function () {\n          return switchToMode(editor, activeMode, availableModes, mode);\n        });\n      }\n    };\n    var registerMode = function (availableModes, mode, api) {\n      var _a;\n      if (contains(defaultModes, mode)) {\n        throw new Error('Cannot override default mode ' + mode);\n      }\n      return __assign(__assign({}, availableModes), (_a = {}, _a[mode] = __assign(__assign({}, api), {\n        deactivate: function () {\n          try {\n            api.deactivate();\n          } catch (e) {\n            console.error('problem while deactivating editor mode ' + mode + ':', e);\n          }\n        }\n      }), _a));\n    };\n\n    var create$5 = function (editor) {\n      var activeMode = Cell('design');\n      var availableModes = Cell({\n        design: {\n          activate: noop,\n          deactivate: noop,\n          editorReadOnly: false\n        },\n        readonly: {\n          activate: noop,\n          deactivate: noop,\n          editorReadOnly: true\n        }\n      });\n      registerReadOnlyContentFilters(editor);\n      registerReadOnlySelectionBlockers(editor);\n      return {\n        isReadOnly: function () {\n          return isReadOnly$1(editor);\n        },\n        set: function (mode) {\n          return setMode(editor, availableModes.get(), activeMode, mode);\n        },\n        get: function () {\n          return activeMode.get();\n        },\n        register: function (mode, api) {\n          availableModes.set(registerMode(availableModes.get(), mode, api));\n        }\n      };\n    };\n\n    var each$g = Tools.each, explode$3 = Tools.explode;\n    var keyCodeLookup = {\n      f1: 112,\n      f2: 113,\n      f3: 114,\n      f4: 115,\n      f5: 116,\n      f6: 117,\n      f7: 118,\n      f8: 119,\n      f9: 120,\n      f10: 121,\n      f11: 122,\n      f12: 123\n    };\n    var modifierNames = Tools.makeMap('alt,ctrl,shift,meta,access');\n    var Shortcuts = function () {\n      function Shortcuts(editor) {\n        this.shortcuts = {};\n        this.pendingPatterns = [];\n        this.editor = editor;\n        var self = this;\n        editor.on('keyup keypress keydown', function (e) {\n          if ((self.hasModifier(e) || self.isFunctionKey(e)) && !e.isDefaultPrevented()) {\n            each$g(self.shortcuts, function (shortcut) {\n              if (self.matchShortcut(e, shortcut)) {\n                self.pendingPatterns = shortcut.subpatterns.slice(0);\n                if (e.type === 'keydown') {\n                  self.executeShortcutAction(shortcut);\n                }\n                return true;\n              }\n            });\n            if (self.matchShortcut(e, self.pendingPatterns[0])) {\n              if (self.pendingPatterns.length === 1) {\n                if (e.type === 'keydown') {\n                  self.executeShortcutAction(self.pendingPatterns[0]);\n                }\n              }\n              self.pendingPatterns.shift();\n            }\n          }\n        });\n      }\n      Shortcuts.prototype.add = function (pattern, desc, cmdFunc, scope) {\n        var self = this;\n        var func = self.normalizeCommandFunc(cmdFunc);\n        each$g(explode$3(Tools.trim(pattern)), function (pattern) {\n          var shortcut = self.createShortcut(pattern, desc, func, scope);\n          self.shortcuts[shortcut.id] = shortcut;\n        });\n        return true;\n      };\n      Shortcuts.prototype.remove = function (pattern) {\n        var shortcut = this.createShortcut(pattern);\n        if (this.shortcuts[shortcut.id]) {\n          delete this.shortcuts[shortcut.id];\n          return true;\n        }\n        return false;\n      };\n      Shortcuts.prototype.normalizeCommandFunc = function (cmdFunc) {\n        var self = this;\n        var cmd = cmdFunc;\n        if (typeof cmd === 'string') {\n          return function () {\n            self.editor.execCommand(cmd, false, null);\n          };\n        } else if (Tools.isArray(cmd)) {\n          return function () {\n            self.editor.execCommand(cmd[0], cmd[1], cmd[2]);\n          };\n        } else {\n          return cmd;\n        }\n      };\n      Shortcuts.prototype.parseShortcut = function (pattern) {\n        var key;\n        var shortcut = {};\n        each$g(explode$3(pattern.toLowerCase(), '+'), function (value) {\n          if (value in modifierNames) {\n            shortcut[value] = true;\n          } else {\n            if (/^[0-9]{2,}$/.test(value)) {\n              shortcut.keyCode = parseInt(value, 10);\n            } else {\n              shortcut.charCode = value.charCodeAt(0);\n              shortcut.keyCode = keyCodeLookup[value] || value.toUpperCase().charCodeAt(0);\n            }\n          }\n        });\n        var id = [shortcut.keyCode];\n        for (key in modifierNames) {\n          if (shortcut[key]) {\n            id.push(key);\n          } else {\n            shortcut[key] = false;\n          }\n        }\n        shortcut.id = id.join(',');\n        if (shortcut.access) {\n          shortcut.alt = true;\n          if (Env.mac) {\n            shortcut.ctrl = true;\n          } else {\n            shortcut.shift = true;\n          }\n        }\n        if (shortcut.meta) {\n          if (Env.mac) {\n            shortcut.meta = true;\n          } else {\n            shortcut.ctrl = true;\n            shortcut.meta = false;\n          }\n        }\n        return shortcut;\n      };\n      Shortcuts.prototype.createShortcut = function (pattern, desc, cmdFunc, scope) {\n        var shortcuts = Tools.map(explode$3(pattern, '>'), this.parseShortcut);\n        shortcuts[shortcuts.length - 1] = Tools.extend(shortcuts[shortcuts.length - 1], {\n          func: cmdFunc,\n          scope: scope || this.editor\n        });\n        return Tools.extend(shortcuts[0], {\n          desc: this.editor.translate(desc),\n          subpatterns: shortcuts.slice(1)\n        });\n      };\n      Shortcuts.prototype.hasModifier = function (e) {\n        return e.altKey || e.ctrlKey || e.metaKey;\n      };\n      Shortcuts.prototype.isFunctionKey = function (e) {\n        return e.type === 'keydown' && e.keyCode >= 112 && e.keyCode <= 123;\n      };\n      Shortcuts.prototype.matchShortcut = function (e, shortcut) {\n        if (!shortcut) {\n          return false;\n        }\n        if (shortcut.ctrl !== e.ctrlKey || shortcut.meta !== e.metaKey) {\n          return false;\n        }\n        if (shortcut.alt !== e.altKey || shortcut.shift !== e.shiftKey) {\n          return false;\n        }\n        if (e.keyCode === shortcut.keyCode || e.charCode && e.charCode === shortcut.charCode) {\n          e.preventDefault();\n          return true;\n        }\n        return false;\n      };\n      Shortcuts.prototype.executeShortcutAction = function (shortcut) {\n        return shortcut.func ? shortcut.func.call(shortcut.scope) : null;\n      };\n      return Shortcuts;\n    }();\n\n    var create$6 = function () {\n      var buttons = {};\n      var menuItems = {};\n      var popups = {};\n      var icons = {};\n      var contextMenus = {};\n      var contextToolbars = {};\n      var sidebars = {};\n      var add = function (collection, type) {\n        return function (name, spec) {\n          return collection[name.toLowerCase()] = __assign(__assign({}, spec), { type: type });\n        };\n      };\n      var addIcon = function (name, svgData) {\n        return icons[name.toLowerCase()] = svgData;\n      };\n      return {\n        addButton: add(buttons, 'button'),\n        addGroupToolbarButton: add(buttons, 'grouptoolbarbutton'),\n        addToggleButton: add(buttons, 'togglebutton'),\n        addMenuButton: add(buttons, 'menubutton'),\n        addSplitButton: add(buttons, 'splitbutton'),\n        addMenuItem: add(menuItems, 'menuitem'),\n        addNestedMenuItem: add(menuItems, 'nestedmenuitem'),\n        addToggleMenuItem: add(menuItems, 'togglemenuitem'),\n        addAutocompleter: add(popups, 'autocompleter'),\n        addContextMenu: add(contextMenus, 'contextmenu'),\n        addContextToolbar: add(contextToolbars, 'contexttoolbar'),\n        addContextForm: add(contextToolbars, 'contextform'),\n        addSidebar: add(sidebars, 'sidebar'),\n        addIcon: addIcon,\n        getAll: function () {\n          return {\n            buttons: buttons,\n            menuItems: menuItems,\n            icons: icons,\n            popups: popups,\n            contextMenus: contextMenus,\n            contextToolbars: contextToolbars,\n            sidebars: sidebars\n          };\n        }\n      };\n    };\n\n    var registry = function () {\n      var bridge = create$6();\n      return {\n        addAutocompleter: bridge.addAutocompleter,\n        addButton: bridge.addButton,\n        addContextForm: bridge.addContextForm,\n        addContextMenu: bridge.addContextMenu,\n        addContextToolbar: bridge.addContextToolbar,\n        addIcon: bridge.addIcon,\n        addMenuButton: bridge.addMenuButton,\n        addMenuItem: bridge.addMenuItem,\n        addNestedMenuItem: bridge.addNestedMenuItem,\n        addSidebar: bridge.addSidebar,\n        addSplitButton: bridge.addSplitButton,\n        addToggleButton: bridge.addToggleButton,\n        addGroupToolbarButton: bridge.addGroupToolbarButton,\n        addToggleMenuItem: bridge.addToggleMenuItem,\n        getAll: bridge.getAll\n      };\n    };\n\n    var each$h = Tools.each, trim$4 = Tools.trim;\n    var queryParts = 'source protocol authority userInfo user password host port relative path directory file query anchor'.split(' ');\n    var DEFAULT_PORTS = {\n      ftp: 21,\n      http: 80,\n      https: 443,\n      mailto: 25\n    };\n    var URI = function () {\n      function URI(url, settings) {\n        url = trim$4(url);\n        this.settings = settings || {};\n        var baseUri = this.settings.base_uri;\n        var self = this;\n        if (/^([\\w\\-]+):([^\\/]{2})/i.test(url) || /^\\s*#/.test(url)) {\n          self.source = url;\n          return;\n        }\n        var isProtocolRelative = url.indexOf('//') === 0;\n        if (url.indexOf('/') === 0 && !isProtocolRelative) {\n          url = (baseUri ? baseUri.protocol || 'http' : 'http') + '://mce_host' + url;\n        }\n        if (!/^[\\w\\-]*:?\\/\\//.test(url)) {\n          var baseUrl = this.settings.base_uri ? this.settings.base_uri.path : new URI(document.location.href).directory;\n          if (this.settings.base_uri && this.settings.base_uri.protocol == '') {\n            url = '//mce_host' + self.toAbsPath(baseUrl, url);\n          } else {\n            var match = /([^#?]*)([#?]?.*)/.exec(url);\n            url = (baseUri && baseUri.protocol || 'http') + '://mce_host' + self.toAbsPath(baseUrl, match[1]) + match[2];\n          }\n        }\n        url = url.replace(/@@/g, '(mce_at)');\n        var urlMatch = /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@\\/]*):?([^:@\\/]*))?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/.exec(url);\n        each$h(queryParts, function (v, i) {\n          var part = urlMatch[i];\n          if (part) {\n            part = part.replace(/\\(mce_at\\)/g, '@@');\n          }\n          self[v] = part;\n        });\n        if (baseUri) {\n          if (!self.protocol) {\n            self.protocol = baseUri.protocol;\n          }\n          if (!self.userInfo) {\n            self.userInfo = baseUri.userInfo;\n          }\n          if (!self.port && self.host === 'mce_host') {\n            self.port = baseUri.port;\n          }\n          if (!self.host || self.host === 'mce_host') {\n            self.host = baseUri.host;\n          }\n          self.source = '';\n        }\n        if (isProtocolRelative) {\n          self.protocol = '';\n        }\n      }\n      URI.parseDataUri = function (uri) {\n        var type;\n        var uriComponents = decodeURIComponent(uri).split(',');\n        var matches = /data:([^;]+)/.exec(uriComponents[0]);\n        if (matches) {\n          type = matches[1];\n        }\n        return {\n          type: type,\n          data: uriComponents[1]\n        };\n      };\n      URI.getDocumentBaseUrl = function (loc) {\n        var baseUrl;\n        if (loc.protocol.indexOf('http') !== 0 && loc.protocol !== 'file:') {\n          baseUrl = loc.href;\n        } else {\n          baseUrl = loc.protocol + '//' + loc.host + loc.pathname;\n        }\n        if (/^[^:]+:\\/\\/\\/?[^\\/]+\\//.test(baseUrl)) {\n          baseUrl = baseUrl.replace(/[\\?#].*$/, '').replace(/[\\/\\\\][^\\/]+$/, '');\n          if (!/[\\/\\\\]$/.test(baseUrl)) {\n            baseUrl += '/';\n          }\n        }\n        return baseUrl;\n      };\n      URI.prototype.setPath = function (path) {\n        var pathMatch = /^(.*?)\\/?(\\w+)?$/.exec(path);\n        this.path = pathMatch[0];\n        this.directory = pathMatch[1];\n        this.file = pathMatch[2];\n        this.source = '';\n        this.getURI();\n      };\n      URI.prototype.toRelative = function (uri) {\n        var output;\n        if (uri === './') {\n          return uri;\n        }\n        var relativeUri = new URI(uri, { base_uri: this });\n        if (relativeUri.host !== 'mce_host' && this.host !== relativeUri.host && relativeUri.host || this.port !== relativeUri.port || this.protocol !== relativeUri.protocol && relativeUri.protocol !== '') {\n          return relativeUri.getURI();\n        }\n        var tu = this.getURI(), uu = relativeUri.getURI();\n        if (tu === uu || tu.charAt(tu.length - 1) === '/' && tu.substr(0, tu.length - 1) === uu) {\n          return tu;\n        }\n        output = this.toRelPath(this.path, relativeUri.path);\n        if (relativeUri.query) {\n          output += '?' + relativeUri.query;\n        }\n        if (relativeUri.anchor) {\n          output += '#' + relativeUri.anchor;\n        }\n        return output;\n      };\n      URI.prototype.toAbsolute = function (uri, noHost) {\n        var absoluteUri = new URI(uri, { base_uri: this });\n        return absoluteUri.getURI(noHost && this.isSameOrigin(absoluteUri));\n      };\n      URI.prototype.isSameOrigin = function (uri) {\n        if (this.host == uri.host && this.protocol == uri.protocol) {\n          if (this.port == uri.port) {\n            return true;\n          }\n          var defaultPort = DEFAULT_PORTS[this.protocol];\n          if (defaultPort && (this.port || defaultPort) == (uri.port || defaultPort)) {\n            return true;\n          }\n        }\n        return false;\n      };\n      URI.prototype.toRelPath = function (base, path) {\n        var breakPoint = 0, out = '', i, l;\n        var normalizedBase = base.substring(0, base.lastIndexOf('/')).split('/');\n        var items = path.split('/');\n        if (normalizedBase.length >= items.length) {\n          for (i = 0, l = normalizedBase.length; i < l; i++) {\n            if (i >= items.length || normalizedBase[i] !== items[i]) {\n              breakPoint = i + 1;\n              break;\n            }\n          }\n        }\n        if (normalizedBase.length < items.length) {\n          for (i = 0, l = items.length; i < l; i++) {\n            if (i >= normalizedBase.length || normalizedBase[i] !== items[i]) {\n              breakPoint = i + 1;\n              break;\n            }\n          }\n        }\n        if (breakPoint === 1) {\n          return path;\n        }\n        for (i = 0, l = normalizedBase.length - (breakPoint - 1); i < l; i++) {\n          out += '../';\n        }\n        for (i = breakPoint - 1, l = items.length; i < l; i++) {\n          if (i !== breakPoint - 1) {\n            out += '/' + items[i];\n          } else {\n            out += items[i];\n          }\n        }\n        return out;\n      };\n      URI.prototype.toAbsPath = function (base, path) {\n        var i, nb = 0, o = [], outPath;\n        var tr = /\\/$/.test(path) ? '/' : '';\n        var normalizedBase = base.split('/');\n        var normalizedPath = path.split('/');\n        each$h(normalizedBase, function (k) {\n          if (k) {\n            o.push(k);\n          }\n        });\n        normalizedBase = o;\n        for (i = normalizedPath.length - 1, o = []; i >= 0; i--) {\n          if (normalizedPath[i].length === 0 || normalizedPath[i] === '.') {\n            continue;\n          }\n          if (normalizedPath[i] === '..') {\n            nb++;\n            continue;\n          }\n          if (nb > 0) {\n            nb--;\n            continue;\n          }\n          o.push(normalizedPath[i]);\n        }\n        i = normalizedBase.length - nb;\n        if (i <= 0) {\n          outPath = reverse(o).join('/');\n        } else {\n          outPath = normalizedBase.slice(0, i).join('/') + '/' + reverse(o).join('/');\n        }\n        if (outPath.indexOf('/') !== 0) {\n          outPath = '/' + outPath;\n        }\n        if (tr && outPath.lastIndexOf('/') !== outPath.length - 1) {\n          outPath += tr;\n        }\n        return outPath;\n      };\n      URI.prototype.getURI = function (noProtoHost) {\n        if (noProtoHost === void 0) {\n          noProtoHost = false;\n        }\n        var s;\n        if (!this.source || noProtoHost) {\n          s = '';\n          if (!noProtoHost) {\n            if (this.protocol) {\n              s += this.protocol + '://';\n            } else {\n              s += '//';\n            }\n            if (this.userInfo) {\n              s += this.userInfo + '@';\n            }\n            if (this.host) {\n              s += this.host;\n            }\n            if (this.port) {\n              s += ':' + this.port;\n            }\n          }\n          if (this.path) {\n            s += this.path;\n          }\n          if (this.query) {\n            s += '?' + this.query;\n          }\n          if (this.anchor) {\n            s += '#' + this.anchor;\n          }\n          this.source = s;\n        }\n        return this.source;\n      };\n      return URI;\n    }();\n\n    var DOM$9 = DOMUtils$1.DOM;\n    var extend$3 = Tools.extend, each$i = Tools.each;\n    var resolve$3 = Tools.resolve;\n    var ie$1 = Env.ie;\n    var Editor = function () {\n      function Editor(id, settings, editorManager) {\n        var _this = this;\n        this.plugins = {};\n        this.contentCSS = [];\n        this.contentStyles = [];\n        this.loadedCSS = {};\n        this.isNotDirty = false;\n        this.editorManager = editorManager;\n        this.documentBaseUrl = editorManager.documentBaseURL;\n        extend$3(this, EditorObservable);\n        this.settings = getEditorSettings(this, id, this.documentBaseUrl, editorManager.defaultSettings, settings);\n        if (this.settings.suffix) {\n          editorManager.suffix = this.settings.suffix;\n        }\n        this.suffix = editorManager.suffix;\n        if (this.settings.base_url) {\n          editorManager._setBaseUrl(this.settings.base_url);\n        }\n        this.baseUri = editorManager.baseURI;\n        if (this.settings.referrer_policy) {\n          ScriptLoader.ScriptLoader._setReferrerPolicy(this.settings.referrer_policy);\n          DOMUtils$1.DOM.styleSheetLoader._setReferrerPolicy(this.settings.referrer_policy);\n        }\n        AddOnManager$1.languageLoad = this.settings.language_load;\n        AddOnManager$1.baseURL = editorManager.baseURL;\n        this.id = id;\n        this.setDirty(false);\n        this.documentBaseURI = new URI(this.settings.document_base_url, { base_uri: this.baseUri });\n        this.baseURI = this.baseUri;\n        this.inline = !!this.settings.inline;\n        this.shortcuts = new Shortcuts(this);\n        this.editorCommands = new EditorCommands(this);\n        if (this.settings.cache_suffix) {\n          Env.cacheSuffix = this.settings.cache_suffix.replace(/^[\\?\\&]+/, '');\n        }\n        this.ui = {\n          registry: registry(),\n          styleSheetLoader: undefined,\n          show: noop,\n          hide: noop\n        };\n        var self = this;\n        var modeInstance = create$5(self);\n        this.mode = modeInstance;\n        this.setMode = modeInstance.set;\n        editorManager.fire('SetupEditor', { editor: this });\n        this.execCallback('setup', this);\n        this.$ = DomQuery.overrideDefaults(function () {\n          return {\n            context: _this.inline ? _this.getBody() : _this.getDoc(),\n            element: _this.getBody()\n          };\n        });\n      }\n      Editor.prototype.render = function () {\n        render(this);\n      };\n      Editor.prototype.focus = function (skipFocus) {\n        focus$1(this, skipFocus);\n      };\n      Editor.prototype.hasFocus = function () {\n        return hasFocus$1(this);\n      };\n      Editor.prototype.execCallback = function (name) {\n        var x = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n          x[_i - 1] = arguments[_i];\n        }\n        var self = this;\n        var callback = self.settings[name], scope;\n        if (!callback) {\n          return;\n        }\n        if (self.callbackLookup && (scope = self.callbackLookup[name])) {\n          callback = scope.func;\n          scope = scope.scope;\n        }\n        if (typeof callback === 'string') {\n          scope = callback.replace(/\\.\\w+$/, '');\n          scope = scope ? resolve$3(scope) : 0;\n          callback = resolve$3(callback);\n          self.callbackLookup = self.callbackLookup || {};\n          self.callbackLookup[name] = {\n            func: callback,\n            scope: scope\n          };\n        }\n        return callback.apply(scope || self, x);\n      };\n      Editor.prototype.translate = function (text) {\n        return I18n.translate(text);\n      };\n      Editor.prototype.getParam = function (name, defaultVal, type) {\n        return getParam(this, name, defaultVal, type);\n      };\n      Editor.prototype.hasPlugin = function (name, loaded) {\n        var hasPlugin = contains(getPlugins(this).split(/[ ,]/), name);\n        if (hasPlugin) {\n          return loaded ? PluginManager.get(name) !== undefined : true;\n        } else {\n          return false;\n        }\n      };\n      Editor.prototype.nodeChanged = function (args) {\n        this._nodeChangeDispatcher.nodeChanged(args);\n      };\n      Editor.prototype.addCommand = function (name, callback, scope) {\n        this.editorCommands.addCommand(name, callback, scope);\n      };\n      Editor.prototype.addQueryStateHandler = function (name, callback, scope) {\n        this.editorCommands.addQueryStateHandler(name, callback, scope);\n      };\n      Editor.prototype.addQueryValueHandler = function (name, callback, scope) {\n        this.editorCommands.addQueryValueHandler(name, callback, scope);\n      };\n      Editor.prototype.addShortcut = function (pattern, desc, cmdFunc, scope) {\n        this.shortcuts.add(pattern, desc, cmdFunc, scope);\n      };\n      Editor.prototype.execCommand = function (cmd, ui, value, args) {\n        return this.editorCommands.execCommand(cmd, ui, value, args);\n      };\n      Editor.prototype.queryCommandState = function (cmd) {\n        return this.editorCommands.queryCommandState(cmd);\n      };\n      Editor.prototype.queryCommandValue = function (cmd) {\n        return this.editorCommands.queryCommandValue(cmd);\n      };\n      Editor.prototype.queryCommandSupported = function (cmd) {\n        return this.editorCommands.queryCommandSupported(cmd);\n      };\n      Editor.prototype.show = function () {\n        var self = this;\n        if (self.hidden) {\n          self.hidden = false;\n          if (self.inline) {\n            self.getBody().contentEditable = 'true';\n          } else {\n            DOM$9.show(self.getContainer());\n            DOM$9.hide(self.id);\n          }\n          self.load();\n          self.fire('show');\n        }\n      };\n      Editor.prototype.hide = function () {\n        var self = this, doc = self.getDoc();\n        if (!self.hidden) {\n          if (ie$1 && doc && !self.inline) {\n            doc.execCommand('SelectAll');\n          }\n          self.save();\n          if (self.inline) {\n            self.getBody().contentEditable = 'false';\n            if (self === self.editorManager.focusedEditor) {\n              self.editorManager.focusedEditor = null;\n            }\n          } else {\n            DOM$9.hide(self.getContainer());\n            DOM$9.setStyle(self.id, 'display', self.orgDisplay);\n          }\n          self.hidden = true;\n          self.fire('hide');\n        }\n      };\n      Editor.prototype.isHidden = function () {\n        return !!this.hidden;\n      };\n      Editor.prototype.setProgressState = function (state, time) {\n        this.fire('ProgressState', {\n          state: state,\n          time: time\n        });\n      };\n      Editor.prototype.load = function (args) {\n        var self = this;\n        var elm = self.getElement(), html;\n        if (self.removed) {\n          return '';\n        }\n        if (elm) {\n          args = args || {};\n          args.load = true;\n          var value = isTextareaOrInput(elm) ? elm.value : elm.innerHTML;\n          html = self.setContent(value, args);\n          args.element = elm;\n          if (!args.no_events) {\n            self.fire('LoadContent', args);\n          }\n          args.element = elm = null;\n          return html;\n        }\n      };\n      Editor.prototype.save = function (args) {\n        var self = this;\n        var elm = self.getElement(), html, form;\n        if (!elm || !self.initialized || self.removed) {\n          return;\n        }\n        args = args || {};\n        args.save = true;\n        args.element = elm;\n        html = args.content = self.getContent(args);\n        if (!args.no_events) {\n          self.fire('SaveContent', args);\n        }\n        if (args.format === 'raw') {\n          self.fire('RawSaveContent', args);\n        }\n        html = args.content;\n        if (!isTextareaOrInput(elm)) {\n          if (args.is_removing || !self.inline) {\n            elm.innerHTML = html;\n          }\n          if (form = DOM$9.getParent(self.id, 'form')) {\n            each$i(form.elements, function (elm) {\n              if (elm.name === self.id) {\n                elm.value = html;\n                return false;\n              }\n            });\n          }\n        } else {\n          elm.value = html;\n        }\n        args.element = elm = null;\n        if (args.set_dirty !== false) {\n          self.setDirty(false);\n        }\n        return html;\n      };\n      Editor.prototype.setContent = function (content, args) {\n        return setContent$2(this, content, args);\n      };\n      Editor.prototype.getContent = function (args) {\n        return getContent$2(this, args);\n      };\n      Editor.prototype.insertContent = function (content, args) {\n        if (args) {\n          content = extend$3({ content: content }, args);\n        }\n        this.execCommand('mceInsertContent', false, content);\n      };\n      Editor.prototype.resetContent = function (initialContent) {\n        if (initialContent === undefined) {\n          setContent$2(this, this.startContent, { format: 'raw' });\n        } else {\n          setContent$2(this, initialContent);\n        }\n        this.undoManager.reset();\n        this.setDirty(false);\n        this.nodeChanged();\n      };\n      Editor.prototype.isDirty = function () {\n        return !this.isNotDirty;\n      };\n      Editor.prototype.setDirty = function (state) {\n        var oldState = !this.isNotDirty;\n        this.isNotDirty = !state;\n        if (state && state !== oldState) {\n          this.fire('dirty');\n        }\n      };\n      Editor.prototype.getContainer = function () {\n        var self = this;\n        if (!self.container) {\n          self.container = DOM$9.get(self.editorContainer || self.id + '_parent');\n        }\n        return self.container;\n      };\n      Editor.prototype.getContentAreaContainer = function () {\n        return this.contentAreaContainer;\n      };\n      Editor.prototype.getElement = function () {\n        if (!this.targetElm) {\n          this.targetElm = DOM$9.get(this.id);\n        }\n        return this.targetElm;\n      };\n      Editor.prototype.getWin = function () {\n        var self = this;\n        var elm;\n        if (!self.contentWindow) {\n          elm = self.iframeElement;\n          if (elm) {\n            self.contentWindow = elm.contentWindow;\n          }\n        }\n        return self.contentWindow;\n      };\n      Editor.prototype.getDoc = function () {\n        var self = this;\n        var win;\n        if (!self.contentDocument) {\n          win = self.getWin();\n          if (win) {\n            self.contentDocument = win.document;\n          }\n        }\n        return self.contentDocument;\n      };\n      Editor.prototype.getBody = function () {\n        var doc = this.getDoc();\n        return this.bodyElement || (doc ? doc.body : null);\n      };\n      Editor.prototype.convertURL = function (url, name, elm) {\n        var self = this, settings = self.settings;\n        if (settings.urlconverter_callback) {\n          return self.execCallback('urlconverter_callback', url, elm, true, name);\n        }\n        if (!settings.convert_urls || elm && elm.nodeName === 'LINK' || url.indexOf('file:') === 0 || url.length === 0) {\n          return url;\n        }\n        if (settings.relative_urls) {\n          return self.documentBaseURI.toRelative(url);\n        }\n        url = self.documentBaseURI.toAbsolute(url, settings.remove_script_host);\n        return url;\n      };\n      Editor.prototype.addVisual = function (elm) {\n        var self = this;\n        var settings = self.settings;\n        var dom = self.dom;\n        var cls;\n        elm = elm || self.getBody();\n        if (self.hasVisual === undefined) {\n          self.hasVisual = settings.visual;\n        }\n        each$i(dom.select('table,a', elm), function (elm) {\n          var value;\n          switch (elm.nodeName) {\n          case 'TABLE':\n            cls = settings.visual_table_class || 'mce-item-table';\n            value = dom.getAttrib(elm, 'border');\n            if ((!value || value === '0') && self.hasVisual) {\n              dom.addClass(elm, cls);\n            } else {\n              dom.removeClass(elm, cls);\n            }\n            return;\n          case 'A':\n            if (!dom.getAttrib(elm, 'href')) {\n              value = dom.getAttrib(elm, 'name') || elm.id;\n              cls = settings.visual_anchor_class || 'mce-item-anchor';\n              if (value && self.hasVisual) {\n                dom.addClass(elm, cls);\n              } else {\n                dom.removeClass(elm, cls);\n              }\n            }\n            return;\n          }\n        });\n        self.fire('VisualAid', {\n          element: elm,\n          hasVisual: self.hasVisual\n        });\n      };\n      Editor.prototype.remove = function () {\n        remove$7(this);\n      };\n      Editor.prototype.destroy = function (automatic) {\n        destroy(this, automatic);\n      };\n      Editor.prototype.uploadImages = function (callback) {\n        return this.editorUpload.uploadImages(callback);\n      };\n      Editor.prototype._scanForImages = function () {\n        return this.editorUpload.scanForImages();\n      };\n      Editor.prototype.addButton = function () {\n        throw new Error('editor.addButton has been removed in tinymce 5x, use editor.ui.registry.addButton or editor.ui.registry.addToggleButton or editor.ui.registry.addSplitButton instead');\n      };\n      Editor.prototype.addSidebar = function () {\n        throw new Error('editor.addSidebar has been removed in tinymce 5x, use editor.ui.registry.addSidebar instead');\n      };\n      Editor.prototype.addMenuItem = function () {\n        throw new Error('editor.addMenuItem has been removed in tinymce 5x, use editor.ui.registry.addMenuItem instead');\n      };\n      Editor.prototype.addContextToolbar = function () {\n        throw new Error('editor.addContextToolbar has been removed in tinymce 5x, use editor.ui.registry.addContextToolbar instead');\n      };\n      return Editor;\n    }();\n\n    var DOM$a = DOMUtils$1.DOM;\n    var explode$4 = Tools.explode, each$j = Tools.each, extend$4 = Tools.extend;\n    var instanceCounter = 0, boundGlobalEvents = false;\n    var beforeUnloadDelegate;\n    var legacyEditors = [];\n    var editors = [];\n    var isValidLegacyKey = function (id) {\n      return id !== 'length';\n    };\n    var globalEventDelegate = function (e) {\n      var type = e.type;\n      each$j(EditorManager.get(), function (editor) {\n        switch (type) {\n        case 'scroll':\n          editor.fire('ScrollWindow', e);\n          break;\n        case 'resize':\n          editor.fire('ResizeWindow', e);\n          break;\n        }\n      });\n    };\n    var toggleGlobalEvents = function (state) {\n      if (state !== boundGlobalEvents) {\n        if (state) {\n          DomQuery(window).on('resize scroll', globalEventDelegate);\n        } else {\n          DomQuery(window).off('resize scroll', globalEventDelegate);\n        }\n        boundGlobalEvents = state;\n      }\n    };\n    var removeEditorFromList = function (targetEditor) {\n      var oldEditors = editors;\n      delete legacyEditors[targetEditor.id];\n      for (var i = 0; i < legacyEditors.length; i++) {\n        if (legacyEditors[i] === targetEditor) {\n          legacyEditors.splice(i, 1);\n          break;\n        }\n      }\n      editors = filter(editors, function (editor) {\n        return targetEditor !== editor;\n      });\n      if (EditorManager.activeEditor === targetEditor) {\n        EditorManager.activeEditor = editors.length > 0 ? editors[0] : null;\n      }\n      if (EditorManager.focusedEditor === targetEditor) {\n        EditorManager.focusedEditor = null;\n      }\n      return oldEditors.length !== editors.length;\n    };\n    var purgeDestroyedEditor = function (editor) {\n      if (editor && editor.initialized && !(editor.getContainer() || editor.getBody()).parentNode) {\n        removeEditorFromList(editor);\n        editor.unbindAllNativeEvents();\n        editor.destroy(true);\n        editor.removed = true;\n        editor = null;\n      }\n      return editor;\n    };\n    var isQuirksMode = document.compatMode !== 'CSS1Compat';\n    var EditorManager = __assign(__assign({}, Observable), {\n      baseURI: null,\n      baseURL: null,\n      defaultSettings: {},\n      documentBaseURL: null,\n      suffix: null,\n      $: DomQuery,\n      majorVersion: '5',\n      minorVersion: '5.1',\n      releaseDate: '2020-10-01',\n      editors: legacyEditors,\n      i18n: I18n,\n      activeEditor: null,\n      focusedEditor: null,\n      settings: {},\n      setup: function () {\n        var self = this;\n        var baseURL, documentBaseURL, suffix = '';\n        documentBaseURL = URI.getDocumentBaseUrl(document.location);\n        if (/^[^:]+:\\/\\/\\/?[^\\/]+\\//.test(documentBaseURL)) {\n          documentBaseURL = documentBaseURL.replace(/[\\?#].*$/, '').replace(/[\\/\\\\][^\\/]+$/, '');\n          if (!/[\\/\\\\]$/.test(documentBaseURL)) {\n            documentBaseURL += '/';\n          }\n        }\n        var preInit = window.tinymce || window.tinyMCEPreInit;\n        if (preInit) {\n          baseURL = preInit.base || preInit.baseURL;\n          suffix = preInit.suffix;\n        } else {\n          var scripts = document.getElementsByTagName('script');\n          for (var i = 0; i < scripts.length; i++) {\n            var src = scripts[i].src || '';\n            if (src === '') {\n              continue;\n            }\n            var srcScript = src.substring(src.lastIndexOf('/'));\n            if (/tinymce(\\.full|\\.jquery|)(\\.min|\\.dev|)\\.js/.test(src)) {\n              if (srcScript.indexOf('.min') !== -1) {\n                suffix = '.min';\n              }\n              baseURL = src.substring(0, src.lastIndexOf('/'));\n              break;\n            }\n          }\n          if (!baseURL && document.currentScript) {\n            var src = document.currentScript.src;\n            if (src.indexOf('.min') !== -1) {\n              suffix = '.min';\n            }\n            baseURL = src.substring(0, src.lastIndexOf('/'));\n          }\n        }\n        self.baseURL = new URI(documentBaseURL).toAbsolute(baseURL);\n        self.documentBaseURL = documentBaseURL;\n        self.baseURI = new URI(self.baseURL);\n        self.suffix = suffix;\n        setup$2(self);\n      },\n      overrideDefaults: function (defaultSettings) {\n        var baseUrl = defaultSettings.base_url;\n        if (baseUrl) {\n          this._setBaseUrl(baseUrl);\n        }\n        var suffix = defaultSettings.suffix;\n        if (defaultSettings.suffix) {\n          this.suffix = suffix;\n        }\n        this.defaultSettings = defaultSettings;\n        var pluginBaseUrls = defaultSettings.plugin_base_urls;\n        if (pluginBaseUrls !== undefined) {\n          each$1(pluginBaseUrls, function (pluginBaseUrl, pluginName) {\n            AddOnManager$1.PluginManager.urls[pluginName] = pluginBaseUrl;\n          });\n        }\n      },\n      init: function (settings) {\n        var self = this;\n        var result;\n        var invalidInlineTargets = Tools.makeMap('area base basefont br col frame hr img input isindex link meta param embed source wbr track ' + 'colgroup option table tbody tfoot thead tr th td script noscript style textarea video audio iframe object menu', ' ');\n        var isInvalidInlineTarget = function (settings, elm) {\n          return settings.inline && elm.tagName.toLowerCase() in invalidInlineTargets;\n        };\n        var createId = function (elm) {\n          var id = elm.id;\n          if (!id) {\n            id = get(elm, 'name').filter(function (name) {\n              return !DOM$a.get(name);\n            }).getOrThunk(DOM$a.uniqueId);\n            elm.setAttribute('id', id);\n          }\n          return id;\n        };\n        var execCallback = function (name) {\n          var callback = settings[name];\n          if (!callback) {\n            return;\n          }\n          return callback.apply(self, Array.prototype.slice.call(arguments, 2));\n        };\n        var hasClass = function (elm, className) {\n          return className.constructor === RegExp ? className.test(elm.className) : DOM$a.hasClass(elm, className);\n        };\n        var findTargets = function (settings) {\n          var targets = [];\n          if (Env.browser.isIE() && Env.browser.version.major < 11) {\n            initError('TinyMCE does not support the browser you are using. For a list of supported' + ' browsers please see: https://www.tinymce.com/docs/get-started/system-requirements/');\n            return [];\n          } else if (isQuirksMode) {\n            initError('Failed to initialize the editor as the document is not in standards mode. ' + 'TinyMCE requires standards mode.');\n            return [];\n          }\n          if (settings.types) {\n            each$j(settings.types, function (type) {\n              targets = targets.concat(DOM$a.select(type.selector));\n            });\n            return targets;\n          } else if (settings.selector) {\n            return DOM$a.select(settings.selector);\n          } else if (settings.target) {\n            return [settings.target];\n          }\n          switch (settings.mode) {\n          case 'exact':\n            var l = settings.elements || '';\n            if (l.length > 0) {\n              each$j(explode$4(l), function (id) {\n                var elm = DOM$a.get(id);\n                if (elm) {\n                  targets.push(elm);\n                } else {\n                  each$j(document.forms, function (f) {\n                    each$j(f.elements, function (e) {\n                      if (e.name === id) {\n                        id = 'mce_editor_' + instanceCounter++;\n                        DOM$a.setAttrib(e, 'id', id);\n                        targets.push(e);\n                      }\n                    });\n                  });\n                }\n              });\n            }\n            break;\n          case 'textareas':\n          case 'specific_textareas':\n            each$j(DOM$a.select('textarea'), function (elm) {\n              if (settings.editor_deselector && hasClass(elm, settings.editor_deselector)) {\n                return;\n              }\n              if (!settings.editor_selector || hasClass(elm, settings.editor_selector)) {\n                targets.push(elm);\n              }\n            });\n            break;\n          }\n          return targets;\n        };\n        var provideResults = function (editors) {\n          result = editors;\n        };\n        var initEditors = function () {\n          var initCount = 0;\n          var editors = [];\n          var targets;\n          var createEditor = function (id, settings, targetElm) {\n            var editor = new Editor(id, settings, self);\n            editors.push(editor);\n            editor.on('init', function () {\n              if (++initCount === targets.length) {\n                provideResults(editors);\n              }\n            });\n            editor.targetElm = editor.targetElm || targetElm;\n            editor.render();\n          };\n          DOM$a.unbind(window, 'ready', initEditors);\n          execCallback('onpageload');\n          targets = DomQuery.unique(findTargets(settings));\n          if (settings.types) {\n            each$j(settings.types, function (type) {\n              Tools.each(targets, function (elm) {\n                if (DOM$a.is(elm, type.selector)) {\n                  createEditor(createId(elm), extend$4({}, settings, type), elm);\n                  return false;\n                }\n                return true;\n              });\n            });\n            return;\n          }\n          Tools.each(targets, function (elm) {\n            purgeDestroyedEditor(self.get(elm.id));\n          });\n          targets = Tools.grep(targets, function (elm) {\n            return !self.get(elm.id);\n          });\n          if (targets.length === 0) {\n            provideResults([]);\n          } else {\n            each$j(targets, function (elm) {\n              if (isInvalidInlineTarget(settings, elm)) {\n                initError('Could not initialize inline editor on invalid inline target element', elm);\n              } else {\n                createEditor(createId(elm), settings, elm);\n              }\n            });\n          }\n        };\n        self.settings = settings;\n        DOM$a.bind(window, 'ready', initEditors);\n        return new promiseObj(function (resolve) {\n          if (result) {\n            resolve(result);\n          } else {\n            provideResults = function (editors) {\n              resolve(editors);\n            };\n          }\n        });\n      },\n      get: function (id) {\n        if (arguments.length === 0) {\n          return editors.slice(0);\n        } else if (isString(id)) {\n          return find(editors, function (editor) {\n            return editor.id === id;\n          }).getOr(null);\n        } else if (isNumber(id)) {\n          return editors[id] ? editors[id] : null;\n        } else {\n          return null;\n        }\n      },\n      add: function (editor) {\n        var self = this;\n        var existingEditor = legacyEditors[editor.id];\n        if (existingEditor === editor) {\n          return editor;\n        }\n        if (self.get(editor.id) === null) {\n          if (isValidLegacyKey(editor.id)) {\n            legacyEditors[editor.id] = editor;\n          }\n          legacyEditors.push(editor);\n          editors.push(editor);\n        }\n        toggleGlobalEvents(true);\n        self.activeEditor = editor;\n        self.fire('AddEditor', { editor: editor });\n        if (!beforeUnloadDelegate) {\n          beforeUnloadDelegate = function (e) {\n            var event = self.fire('BeforeUnload');\n            if (event.returnValue) {\n              e.preventDefault();\n              e.returnValue = event.returnValue;\n              return event.returnValue;\n            }\n          };\n          window.addEventListener('beforeunload', beforeUnloadDelegate);\n        }\n        return editor;\n      },\n      createEditor: function (id, settings) {\n        return this.add(new Editor(id, settings, this));\n      },\n      remove: function (selector) {\n        var self = this;\n        var i, editor;\n        if (!selector) {\n          for (i = editors.length - 1; i >= 0; i--) {\n            self.remove(editors[i]);\n          }\n          return;\n        }\n        if (isString(selector)) {\n          each$j(DOM$a.select(selector), function (elm) {\n            editor = self.get(elm.id);\n            if (editor) {\n              self.remove(editor);\n            }\n          });\n          return;\n        }\n        editor = selector;\n        if (isNull(self.get(editor.id))) {\n          return null;\n        }\n        if (removeEditorFromList(editor)) {\n          self.fire('RemoveEditor', { editor: editor });\n        }\n        if (editors.length === 0) {\n          window.removeEventListener('beforeunload', beforeUnloadDelegate);\n        }\n        editor.remove();\n        toggleGlobalEvents(editors.length > 0);\n        return editor;\n      },\n      execCommand: function (cmd, ui, value) {\n        var self = this, editor = self.get(value);\n        switch (cmd) {\n        case 'mceAddEditor':\n          if (!self.get(value)) {\n            new Editor(value, self.settings, self).render();\n          }\n          return true;\n        case 'mceRemoveEditor':\n          if (editor) {\n            editor.remove();\n          }\n          return true;\n        case 'mceToggleEditor':\n          if (!editor) {\n            self.execCommand('mceAddEditor', 0, value);\n            return true;\n          }\n          if (editor.isHidden()) {\n            editor.show();\n          } else {\n            editor.hide();\n          }\n          return true;\n        }\n        if (self.activeEditor) {\n          return self.activeEditor.execCommand(cmd, ui, value);\n        }\n        return false;\n      },\n      triggerSave: function () {\n        each$j(editors, function (editor) {\n          editor.save();\n        });\n      },\n      addI18n: function (code, items) {\n        I18n.add(code, items);\n      },\n      translate: function (text) {\n        return I18n.translate(text);\n      },\n      setActive: function (editor) {\n        var activeEditor = this.activeEditor;\n        if (this.activeEditor !== editor) {\n          if (activeEditor) {\n            activeEditor.fire('deactivate', { relatedTarget: editor });\n          }\n          editor.fire('activate', { relatedTarget: activeEditor });\n        }\n        this.activeEditor = editor;\n      },\n      _setBaseUrl: function (baseUrl) {\n        this.baseURL = new URI(this.documentBaseURL).toAbsolute(baseUrl.replace(/\\/+$/, ''));\n        this.baseURI = new URI(this.baseURL);\n      }\n    });\n    EditorManager.setup();\n\n    var min = Math.min, max = Math.max, round$1 = Math.round;\n    var relativePosition = function (rect, targetRect, rel) {\n      var x = targetRect.x;\n      var y = targetRect.y;\n      var w = rect.w;\n      var h = rect.h;\n      var targetW = targetRect.w;\n      var targetH = targetRect.h;\n      var relChars = (rel || '').split('');\n      if (relChars[0] === 'b') {\n        y += targetH;\n      }\n      if (relChars[1] === 'r') {\n        x += targetW;\n      }\n      if (relChars[0] === 'c') {\n        y += round$1(targetH / 2);\n      }\n      if (relChars[1] === 'c') {\n        x += round$1(targetW / 2);\n      }\n      if (relChars[3] === 'b') {\n        y -= h;\n      }\n      if (relChars[4] === 'r') {\n        x -= w;\n      }\n      if (relChars[3] === 'c') {\n        y -= round$1(h / 2);\n      }\n      if (relChars[4] === 'c') {\n        x -= round$1(w / 2);\n      }\n      return create$7(x, y, w, h);\n    };\n    var findBestRelativePosition = function (rect, targetRect, constrainRect, rels) {\n      var pos, i;\n      for (i = 0; i < rels.length; i++) {\n        pos = relativePosition(rect, targetRect, rels[i]);\n        if (pos.x >= constrainRect.x && pos.x + pos.w <= constrainRect.w + constrainRect.x && pos.y >= constrainRect.y && pos.y + pos.h <= constrainRect.h + constrainRect.y) {\n          return rels[i];\n        }\n      }\n      return null;\n    };\n    var inflate = function (rect, w, h) {\n      return create$7(rect.x - w, rect.y - h, rect.w + w * 2, rect.h + h * 2);\n    };\n    var intersect = function (rect, cropRect) {\n      var x1 = max(rect.x, cropRect.x);\n      var y1 = max(rect.y, cropRect.y);\n      var x2 = min(rect.x + rect.w, cropRect.x + cropRect.w);\n      var y2 = min(rect.y + rect.h, cropRect.y + cropRect.h);\n      if (x2 - x1 < 0 || y2 - y1 < 0) {\n        return null;\n      }\n      return create$7(x1, y1, x2 - x1, y2 - y1);\n    };\n    var clamp$1 = function (rect, clampRect, fixedSize) {\n      var x1 = rect.x;\n      var y1 = rect.y;\n      var x2 = rect.x + rect.w;\n      var y2 = rect.y + rect.h;\n      var cx2 = clampRect.x + clampRect.w;\n      var cy2 = clampRect.y + clampRect.h;\n      var underflowX1 = max(0, clampRect.x - x1);\n      var underflowY1 = max(0, clampRect.y - y1);\n      var overflowX2 = max(0, x2 - cx2);\n      var overflowY2 = max(0, y2 - cy2);\n      x1 += underflowX1;\n      y1 += underflowY1;\n      if (fixedSize) {\n        x2 += underflowX1;\n        y2 += underflowY1;\n        x1 -= overflowX2;\n        y1 -= overflowY2;\n      }\n      x2 -= overflowX2;\n      y2 -= overflowY2;\n      return create$7(x1, y1, x2 - x1, y2 - y1);\n    };\n    var create$7 = function (x, y, w, h) {\n      return {\n        x: x,\n        y: y,\n        w: w,\n        h: h\n      };\n    };\n    var fromClientRect = function (clientRect) {\n      return create$7(clientRect.left, clientRect.top, clientRect.width, clientRect.height);\n    };\n    var Rect = {\n      inflate: inflate,\n      relativePosition: relativePosition,\n      findBestRelativePosition: findBestRelativePosition,\n      intersect: intersect,\n      clamp: clamp$1,\n      create: create$7,\n      fromClientRect: fromClientRect\n    };\n\n    var awaiter = function (resolveCb, rejectCb, timeout) {\n      if (timeout === void 0) {\n        timeout = 1000;\n      }\n      var done = false;\n      var timer = null;\n      var complete = function (completer) {\n        return function () {\n          var args = [];\n          for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n          }\n          if (!done) {\n            done = true;\n            if (timer !== null) {\n              clearTimeout(timer);\n              timer = null;\n            }\n            completer.apply(null, args);\n          }\n        };\n      };\n      var resolve = complete(resolveCb);\n      var reject = complete(rejectCb);\n      var start = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n          args[_i] = arguments[_i];\n        }\n        if (!done && timer === null) {\n          timer = setTimeout(function () {\n            return reject.apply(null, args);\n          }, timeout);\n        }\n      };\n      return {\n        start: start,\n        resolve: resolve,\n        reject: reject\n      };\n    };\n    var create$8 = function () {\n      var tasks = {};\n      var resultFns = {};\n      var load = function (id, url) {\n        var loadErrMsg = 'Script at URL \"' + url + '\" failed to load';\n        var runErrMsg = 'Script at URL \"' + url + '\" did not call `tinymce.Resource.add(\\'' + id + '\\', data)` within 1 second';\n        if (tasks[id] !== undefined) {\n          return tasks[id];\n        } else {\n          var task = new promiseObj(function (resolve, reject) {\n            var waiter = awaiter(resolve, reject);\n            resultFns[id] = waiter.resolve;\n            ScriptLoader.ScriptLoader.loadScript(url, function () {\n              return waiter.start(runErrMsg);\n            }, function () {\n              return waiter.reject(loadErrMsg);\n            });\n          });\n          tasks[id] = task;\n          return task;\n        }\n      };\n      var add = function (id, data) {\n        if (resultFns[id] !== undefined) {\n          resultFns[id](data);\n          delete resultFns[id];\n        }\n        tasks[id] = promiseObj.resolve(data);\n      };\n      return {\n        load: load,\n        add: add\n      };\n    };\n    var Resource = create$8();\n\n    var each$k = Tools.each, extend$5 = Tools.extend;\n    var extendClass, initializing;\n    var Class = function () {\n    };\n    Class.extend = extendClass = function (props) {\n      var self = this;\n      var _super = self.prototype;\n      var Class = function () {\n        var i, mixins, mixin;\n        var self = this;\n        if (!initializing) {\n          if (self.init) {\n            self.init.apply(self, arguments);\n          }\n          mixins = self.Mixins;\n          if (mixins) {\n            i = mixins.length;\n            while (i--) {\n              mixin = mixins[i];\n              if (mixin.init) {\n                mixin.init.apply(self, arguments);\n              }\n            }\n          }\n        }\n      };\n      var dummy = function () {\n        return this;\n      };\n      var createMethod = function (name, fn) {\n        return function () {\n          var self = this;\n          var tmp = self._super;\n          self._super = _super[name];\n          var ret = fn.apply(self, arguments);\n          self._super = tmp;\n          return ret;\n        };\n      };\n      initializing = true;\n      var prototype = new self();\n      initializing = false;\n      if (props.Mixins) {\n        each$k(props.Mixins, function (mixin) {\n          for (var name_1 in mixin) {\n            if (name_1 !== 'init') {\n              props[name_1] = mixin[name_1];\n            }\n          }\n        });\n        if (_super.Mixins) {\n          props.Mixins = _super.Mixins.concat(props.Mixins);\n        }\n      }\n      if (props.Methods) {\n        each$k(props.Methods.split(','), function (name) {\n          props[name] = dummy;\n        });\n      }\n      if (props.Properties) {\n        each$k(props.Properties.split(','), function (name) {\n          var fieldName = '_' + name;\n          props[name] = function (value) {\n            var self = this;\n            if (value !== undefined) {\n              self[fieldName] = value;\n              return self;\n            }\n            return self[fieldName];\n          };\n        });\n      }\n      if (props.Statics) {\n        each$k(props.Statics, function (func, name) {\n          Class[name] = func;\n        });\n      }\n      if (props.Defaults && _super.Defaults) {\n        props.Defaults = extend$5({}, _super.Defaults, props.Defaults);\n      }\n      each$1(props, function (member, name) {\n        if (typeof member === 'function' && _super[name]) {\n          prototype[name] = createMethod(name, member);\n        } else {\n          prototype[name] = member;\n        }\n      });\n      Class.prototype = prototype;\n      Class.constructor = Class;\n      Class.extend = extendClass;\n      return Class;\n    };\n\n    var min$1 = Math.min, max$1 = Math.max, round$2 = Math.round;\n    var Color = function (value) {\n      var self = {};\n      var r = 0, g = 0, b = 0;\n      var rgb2hsv = function (r, g, b) {\n        var h, s, v;\n        h = 0;\n        s = 0;\n        v = 0;\n        r = r / 255;\n        g = g / 255;\n        b = b / 255;\n        var minRGB = min$1(r, min$1(g, b));\n        var maxRGB = max$1(r, max$1(g, b));\n        if (minRGB === maxRGB) {\n          v = minRGB;\n          return {\n            h: 0,\n            s: 0,\n            v: v * 100\n          };\n        }\n        var d = r === minRGB ? g - b : b === minRGB ? r - g : b - r;\n        h = r === minRGB ? 3 : b === minRGB ? 1 : 5;\n        h = 60 * (h - d / (maxRGB - minRGB));\n        s = (maxRGB - minRGB) / maxRGB;\n        v = maxRGB;\n        return {\n          h: round$2(h),\n          s: round$2(s * 100),\n          v: round$2(v * 100)\n        };\n      };\n      var hsvToRgb = function (hue, saturation, brightness) {\n        hue = (parseInt(hue, 10) || 0) % 360;\n        saturation = parseInt(saturation, 10) / 100;\n        brightness = parseInt(brightness, 10) / 100;\n        saturation = max$1(0, min$1(saturation, 1));\n        brightness = max$1(0, min$1(brightness, 1));\n        if (saturation === 0) {\n          r = g = b = round$2(255 * brightness);\n          return;\n        }\n        var side = hue / 60;\n        var chroma = brightness * saturation;\n        var x = chroma * (1 - Math.abs(side % 2 - 1));\n        var match = brightness - chroma;\n        switch (Math.floor(side)) {\n        case 0:\n          r = chroma;\n          g = x;\n          b = 0;\n          break;\n        case 1:\n          r = x;\n          g = chroma;\n          b = 0;\n          break;\n        case 2:\n          r = 0;\n          g = chroma;\n          b = x;\n          break;\n        case 3:\n          r = 0;\n          g = x;\n          b = chroma;\n          break;\n        case 4:\n          r = x;\n          g = 0;\n          b = chroma;\n          break;\n        case 5:\n          r = chroma;\n          g = 0;\n          b = x;\n          break;\n        default:\n          r = g = b = 0;\n        }\n        r = round$2(255 * (r + match));\n        g = round$2(255 * (g + match));\n        b = round$2(255 * (b + match));\n      };\n      var toHex = function () {\n        var hex = function (val) {\n          val = parseInt(val, 10).toString(16);\n          return val.length > 1 ? val : '0' + val;\n        };\n        return '#' + hex(r) + hex(g) + hex(b);\n      };\n      var toRgb = function () {\n        return {\n          r: r,\n          g: g,\n          b: b\n        };\n      };\n      var toHsv = function () {\n        return rgb2hsv(r, g, b);\n      };\n      var parse = function (value) {\n        var matches;\n        if (typeof value === 'object') {\n          if ('r' in value) {\n            r = value.r;\n            g = value.g;\n            b = value.b;\n          } else if ('v' in value) {\n            hsvToRgb(value.h, value.s, value.v);\n          }\n        } else {\n          if (matches = /rgb\\s*\\(\\s*([0-9]+)\\s*,\\s*([0-9]+)\\s*,\\s*([0-9]+)[^\\)]*\\)/gi.exec(value)) {\n            r = parseInt(matches[1], 10);\n            g = parseInt(matches[2], 10);\n            b = parseInt(matches[3], 10);\n          } else if (matches = /#([0-F]{2})([0-F]{2})([0-F]{2})/gi.exec(value)) {\n            r = parseInt(matches[1], 16);\n            g = parseInt(matches[2], 16);\n            b = parseInt(matches[3], 16);\n          } else if (matches = /#([0-F])([0-F])([0-F])/gi.exec(value)) {\n            r = parseInt(matches[1] + matches[1], 16);\n            g = parseInt(matches[2] + matches[2], 16);\n            b = parseInt(matches[3] + matches[3], 16);\n          }\n        }\n        r = r < 0 ? 0 : r > 255 ? 255 : r;\n        g = g < 0 ? 0 : g > 255 ? 255 : g;\n        b = b < 0 ? 0 : b > 255 ? 255 : b;\n        return self;\n      };\n      if (value) {\n        parse(value);\n      }\n      self.toRgb = toRgb;\n      self.toHsv = toHsv;\n      self.toHex = toHex;\n      self.parse = parse;\n      return self;\n    };\n\n    var serialize = function (obj) {\n      var data = JSON.stringify(obj);\n      if (!isString(data)) {\n        return data;\n      }\n      return data.replace(/[\\u0080-\\uFFFF]/g, function (match) {\n        var hexCode = match.charCodeAt(0).toString(16);\n        return '\\\\u' + '0000'.substring(hexCode.length) + hexCode;\n      });\n    };\n    var JSONUtils = {\n      serialize: serialize,\n      parse: function (text) {\n        try {\n          return JSON.parse(text);\n        } catch (ex) {\n        }\n      }\n    };\n\n    var JSONP = {\n      callbacks: {},\n      count: 0,\n      send: function (settings) {\n        var self = this, dom = DOMUtils$1.DOM, count = settings.count !== undefined ? settings.count : self.count;\n        var id = 'tinymce_jsonp_' + count;\n        self.callbacks[count] = function (json) {\n          dom.remove(id);\n          delete self.callbacks[count];\n          settings.callback(json);\n        };\n        dom.add(dom.doc.body, 'script', {\n          id: id,\n          src: settings.url,\n          type: 'text/javascript'\n        });\n        self.count++;\n      }\n    };\n\n    var XHR = __assign(__assign({}, Observable), {\n      send: function (settings) {\n        var xhr, count = 0;\n        var ready = function () {\n          if (!settings.async || xhr.readyState === 4 || count++ > 10000) {\n            if (settings.success && count < 10000 && xhr.status === 200) {\n              settings.success.call(settings.success_scope, '' + xhr.responseText, xhr, settings);\n            } else if (settings.error) {\n              settings.error.call(settings.error_scope, count > 10000 ? 'TIMED_OUT' : 'GENERAL', xhr, settings);\n            }\n            xhr = null;\n          } else {\n            Delay.setTimeout(ready, 10);\n          }\n        };\n        settings.scope = settings.scope || this;\n        settings.success_scope = settings.success_scope || settings.scope;\n        settings.error_scope = settings.error_scope || settings.scope;\n        settings.async = settings.async !== false;\n        settings.data = settings.data || '';\n        XHR.fire('beforeInitialize', { settings: settings });\n        xhr = new XMLHttpRequest();\n        if (xhr.overrideMimeType) {\n          xhr.overrideMimeType(settings.content_type);\n        }\n        xhr.open(settings.type || (settings.data ? 'POST' : 'GET'), settings.url, settings.async);\n        if (settings.crossDomain) {\n          xhr.withCredentials = true;\n        }\n        if (settings.content_type) {\n          xhr.setRequestHeader('Content-Type', settings.content_type);\n        }\n        if (settings.requestheaders) {\n          Tools.each(settings.requestheaders, function (header) {\n            xhr.setRequestHeader(header.key, header.value);\n          });\n        }\n        xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\n        xhr = XHR.fire('beforeSend', {\n          xhr: xhr,\n          settings: settings\n        }).xhr;\n        xhr.send(settings.data);\n        if (!settings.async) {\n          return ready();\n        }\n        Delay.setTimeout(ready, 10);\n      }\n    });\n\n    var extend$6 = Tools.extend;\n    var JSONRequest = function () {\n      function JSONRequest(settings) {\n        this.settings = extend$6({}, settings);\n        this.count = 0;\n      }\n      JSONRequest.sendRPC = function (o) {\n        return new JSONRequest().send(o);\n      };\n      JSONRequest.prototype.send = function (args) {\n        var ecb = args.error, scb = args.success;\n        var xhrArgs = extend$6(this.settings, args);\n        xhrArgs.success = function (c, x) {\n          c = JSONUtils.parse(c);\n          if (typeof c === 'undefined') {\n            c = { error: 'JSON Parse error.' };\n          }\n          if (c.error) {\n            ecb.call(xhrArgs.error_scope || xhrArgs.scope, c.error, x);\n          } else {\n            scb.call(xhrArgs.success_scope || xhrArgs.scope, c.result);\n          }\n        };\n        xhrArgs.error = function (ty, x) {\n          if (ecb) {\n            ecb.call(xhrArgs.error_scope || xhrArgs.scope, ty, x);\n          }\n        };\n        xhrArgs.data = JSONUtils.serialize({\n          id: args.id || 'c' + this.count++,\n          method: args.method,\n          params: args.params\n        });\n        xhrArgs.content_type = 'application/json';\n        XHR.send(xhrArgs);\n      };\n      return JSONRequest;\n    }();\n\n    var create$9 = function () {\n      return function () {\n        var data = {};\n        var keys = [];\n        var storage = {\n          getItem: function (key) {\n            var item = data[key];\n            return item ? item : null;\n          },\n          setItem: function (key, value) {\n            keys.push(key);\n            data[key] = String(value);\n          },\n          key: function (index) {\n            return keys[index];\n          },\n          removeItem: function (key) {\n            keys = keys.filter(function (k) {\n              return k === key;\n            });\n            delete data[key];\n          },\n          clear: function () {\n            keys = [];\n            data = {};\n          },\n          length: 0\n        };\n        Object.defineProperty(storage, 'length', {\n          get: function () {\n            return keys.length;\n          },\n          configurable: false,\n          enumerable: false\n        });\n        return storage;\n      }();\n    };\n\n    var localStorage;\n    try {\n      var test = '__storage_test__';\n      localStorage = window.localStorage;\n      localStorage.setItem(test, test);\n      localStorage.removeItem(test);\n    } catch (e) {\n      localStorage = create$9();\n    }\n    var LocalStorage = localStorage;\n\n    var publicApi = {\n      geom: { Rect: Rect },\n      util: {\n        Promise: promiseObj,\n        Delay: Delay,\n        Tools: Tools,\n        VK: VK,\n        URI: URI,\n        Class: Class,\n        EventDispatcher: EventDispatcher,\n        Observable: Observable,\n        I18n: I18n,\n        XHR: XHR,\n        JSON: JSONUtils,\n        JSONRequest: JSONRequest,\n        JSONP: JSONP,\n        LocalStorage: LocalStorage,\n        Color: Color\n      },\n      dom: {\n        EventUtils: EventUtils,\n        Sizzle: Sizzle,\n        DomQuery: DomQuery,\n        TreeWalker: DomTreeWalker,\n        TextSeeker: TextSeeker,\n        DOMUtils: DOMUtils$1,\n        ScriptLoader: ScriptLoader,\n        RangeUtils: RangeUtils$1,\n        Serializer: DomSerializer,\n        StyleSheetLoader: StyleSheetLoader,\n        ControlSelection: ControlSelection,\n        BookmarkManager: BookmarkManager$1,\n        Selection: EditorSelection,\n        Event: EventUtils.Event\n      },\n      html: {\n        Styles: Styles,\n        Entities: Entities,\n        Node: AstNode,\n        Schema: Schema,\n        SaxParser: SaxParser$1,\n        DomParser: DomParser,\n        Writer: Writer,\n        Serializer: HtmlSerializer\n      },\n      Env: Env,\n      AddOnManager: AddOnManager$1,\n      Annotator: Annotator,\n      Formatter: Formatter,\n      UndoManager: UndoManager,\n      EditorCommands: EditorCommands,\n      WindowManager: WindowManager,\n      NotificationManager: NotificationManager,\n      EditorObservable: EditorObservable,\n      Shortcuts: Shortcuts,\n      Editor: Editor,\n      FocusManager: FocusManager,\n      EditorManager: EditorManager,\n      DOM: DOMUtils$1.DOM,\n      ScriptLoader: ScriptLoader.ScriptLoader,\n      PluginManager: PluginManager,\n      ThemeManager: ThemeManager,\n      IconManager: IconManager,\n      Resource: Resource,\n      trim: Tools.trim,\n      isArray: Tools.isArray,\n      is: Tools.is,\n      toArray: Tools.toArray,\n      makeMap: Tools.makeMap,\n      each: Tools.each,\n      map: Tools.map,\n      grep: Tools.grep,\n      inArray: Tools.inArray,\n      extend: Tools.extend,\n      create: Tools.create,\n      walk: Tools.walk,\n      createNS: Tools.createNS,\n      resolve: Tools.resolve,\n      explode: Tools.explode,\n      _addCacheSuffix: Tools._addCacheSuffix,\n      isOpera: Env.opera,\n      isWebKit: Env.webkit,\n      isIE: Env.ie,\n      isGecko: Env.gecko,\n      isMac: Env.mac\n    };\n    var tinymce = Tools.extend(EditorManager, publicApi);\n\n    var exportToModuleLoaders = function (tinymce) {\n      if (typeof module === 'object') {\n        try {\n          module.exports = tinymce;\n        } catch (_) {\n        }\n      }\n    };\n    var exportToWindowGlobal = function (tinymce) {\n      window.tinymce = tinymce;\n      window.tinyMCE = tinymce;\n    };\n    exportToWindowGlobal(tinymce);\n    exportToModuleLoaders(tinymce);\n\n}());\n"]},"metadata":{},"sourceType":"script"}